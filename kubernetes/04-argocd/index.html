<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="爱运维,运维日常实践,devops,aiops,dataops,xops,kubernetes,linux,os,nginx,prometheus,运维,系统,内核,监控,开发,数据,智能,随记 爱运维,运维虾的在线文档囊括运维日常实践、Kubernetes、运维开发、数据处理、人工智能、生活随记"><meta name=author content=Jesse><link href=https://books.8ops.top/kubernetes/04-argocd/ rel=canonical><link href=../08-docker/ rel=prev><link href=../05-helm/ rel=next><link rel=icon href=../../favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.5"><title>ArgoCD - 爱运维</title><link rel=stylesheet href=../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#argocd class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=爱运维 class="md-header__button md-logo" aria-label=爱运维 data-md-component=logo> <img src=../../logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 爱运维 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ArgoCD </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=teal aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=teal aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/8ops/mkdocs title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> 8ops/mkdocs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../daily/09-ansible/ class=md-tabs__link> 日常实践 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../01-cluster-init/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../ops/01-devops/ class=md-tabs__link> 运维进阶 </a> </li> <li class=md-tabs__item> <a href=../../dev/10-golang/ class=md-tabs__link> 运维开发 </a> </li> <li class=md-tabs__item> <a href=../../data/01-mysql/ class=md-tabs__link> 数据处理 </a> </li> <li class=md-tabs__item> <a href=../../note/00-class/ class=md-tabs__link> 生活随记 </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> 关于我 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=爱运维 class="md-nav__button md-logo" aria-label=爱运维 data-md-component=logo> <img src=../../logo.png alt=logo> </a> 爱运维 </label> <div class=md-nav__source> <a href=https://github.com/8ops/mkdocs title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> 8ops/mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 日常实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 日常实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 【系统能力】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 【系统能力】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../daily/09-ansible/ class=md-nav__link> <span class=md-ellipsis> Ansible </span> </a> </li> <li class=md-nav__item> <a href=../../daily/10-hardware/ class=md-nav__link> <span class=md-ellipsis> 硬件管理 </span> </a> </li> <li class=md-nav__item> <a href=../../daily/11-system/ class=md-nav__link> <span class=md-ellipsis> 系统管理 </span> </a> </li> <li class=md-nav__item> <a href=../../daily/12-command/ class=md-nav__link> <span class=md-ellipsis> 常用命令 </span> </a> </li> <li class=md-nav__item> <a href=../../daily/14-imagemagick/ class=md-nav__link> <span class=md-ellipsis> 图片处理 </span> </a> </li> <li class=md-nav__item> <a href=../../daily/15-openssl/ class=md-nav__link> <span class=md-ellipsis> 证书管理 </span> </a> </li> <li class=md-nav__item> <a href=../../daily/16-network/ class=md-nav__link> <span class=md-ellipsis> 网络信息 </span> </a> </li> <li class=md-nav__item> <a href=../../daily/17-io/ class=md-nav__link> <span class=md-ellipsis> io </span> </a> </li> <li class=md-nav__item> <a href=../../daily/18-git/ class=md-nav__link> <span class=md-ellipsis> git </span> </a> </li> <li class=md-nav__item> <a href=../../daily/19-firewall/ class=md-nav__link> <span class=md-ellipsis> firewall </span> </a> </li> <li class=md-nav__item> <a href=../../daily/20-curl/ class=md-nav__link> <span class=md-ellipsis> curl </span> </a> </li> <li class=md-nav__item> <a href=../../daily/21-oauth2/ class=md-nav__link> <span class=md-ellipsis> oauth2 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 【常用组件】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 【常用组件】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../daily/33-ppp/ class=md-nav__link> <span class=md-ellipsis> ppp </span> </a> </li> <li class=md-nav__item> <a href=../../daily/34-kickstart/ class=md-nav__link> <span class=md-ellipsis> kickstart </span> </a> </li> <li class=md-nav__item> <a href=../../daily/35-mogilefs/ class=md-nav__link> <span class=md-ellipsis> mogilefs </span> </a> </li> <li class=md-nav__item> <a href=../../daily/36-postgresql/ class=md-nav__link> <span class=md-ellipsis> postgresql </span> </a> </li> <li class=md-nav__item> <a href=../../daily/37-rabbitmq/ class=md-nav__link> <span class=md-ellipsis> rabbitmq </span> </a> </li> <li class=md-nav__item> <a href=../../daily/38-saltstack/ class=md-nav__link> <span class=md-ellipsis> saltstack </span> </a> </li> <li class=md-nav__item> <a href=../../daily/39-neo4j/ class=md-nav__link> <span class=md-ellipsis> neo4j </span> </a> </li> <li class=md-nav__item> <a href=../../daily/40-haproxy/ class=md-nav__link> <span class=md-ellipsis> haproxy </span> </a> </li> <li class=md-nav__item> <a href=../../daily/41-dnsmasq/ class=md-nav__link> <span class=md-ellipsis> dnsmasq </span> </a> </li> <li class=md-nav__item> <a href=../../daily/42-kvm/ class=md-nav__link> <span class=md-ellipsis> kvm </span> </a> </li> <li class=md-nav__item> <a href=../../daily/43-jumpserver/ class=md-nav__link> <span class=md-ellipsis> jumpServer </span> </a> </li> <li class=md-nav__item> <a href=../../daily/44-rsyncd/ class=md-nav__link> <span class=md-ellipsis> rsyncd </span> </a> </li> <li class=md-nav__item> <a href=../../daily/45-nfs/ class=md-nav__link> <span class=md-ellipsis> nfs </span> </a> </li> <li class=md-nav__item> <a href=../../daily/46-nginx/ class=md-nav__link> <span class=md-ellipsis> nginx </span> </a> </li> <li class=md-nav__item> <a href=../../daily/47-elastic/ class=md-nav__link> <span class=md-ellipsis> elastic </span> </a> </li> <li class=md-nav__item> <a href=../../daily/48-mysql/ class=md-nav__link> <span class=md-ellipsis> mysql </span> </a> </li> <li class=md-nav__item> <a href=../../daily/50-denyhosts/ class=md-nav__link> <span class=md-ellipsis> denyhosts </span> </a> </li> <li class=md-nav__item> <a href=../../daily/51-sentry/ class=md-nav__link> <span class=md-ellipsis> sentry </span> </a> </li> <li class=md-nav__item> <a href=../../daily/52-mitmproxy/ class=md-nav__link> <span class=md-ellipsis> mitmproxy </span> </a> </li> <li class=md-nav__item> <a href=../../daily/53-ntp/ class=md-nav__link> <span class=md-ellipsis> ntp </span> </a> </li> <li class=md-nav__item> <a href=../../daily/54-cloudstack/ class=md-nav__link> <span class=md-ellipsis> cloudstack </span> </a> </li> <li class=md-nav__item> <a href=../../daily/55-highon-coffee/ class=md-nav__link> <span class=md-ellipsis> highon.coffee </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex> <span class=md-ellipsis> 【快速搭建】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> 【快速搭建】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-cluster-init/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../01-cluster-init-flannel/ class=md-nav__link> <span class=md-ellipsis> Quick Start - Flannel </span> </a> </li> <li class=md-nav__item> <a href=../01-cluster-init-cilium/ class=md-nav__link> <span class=md-ellipsis> Quick Start - Cilium </span> </a> </li> <li class=md-nav__item> <a href=../01-cluster-init-calico/ class=md-nav__link> <span class=md-ellipsis> Quick Start - Calico </span> </a> </li> <li class=md-nav__item> <a href=../01-cluster-init-calico-1.31/ class=md-nav__link> <span class=md-ellipsis> Quick Start - Calico - v1.31.1 </span> </a> </li> <li class=md-nav__item> <a href=../02-cluster-reset/ class=md-nav__link> <span class=md-ellipsis> Quick Reset </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> 【升级版本】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 【升级版本】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../06-cluster-renew-certs/ class=md-nav__link> <span class=md-ellipsis> Renew certs </span> </a> </li> <li class=md-nav__item> <a href=../06-cluster-upgrade/ class=md-nav__link> <span class=md-ellipsis> Upgrade </span> </a> </li> <li class=md-nav__item> <a href=../06-cluster-upgrade-1.24/ class=md-nav__link> <span class=md-ellipsis> Upgrade - v1.24.0 </span> </a> </li> <li class=md-nav__item> <a href=../06-cluster-upgrade-1.25/ class=md-nav__link> <span class=md-ellipsis> Upgrade - v1.25.0 </span> </a> </li> <li class=md-nav__item> <a href=../06-cluster-upgrade-1.26/ class=md-nav__link> <span class=md-ellipsis> Upgrade - v1.26.0 </span> </a> </li> <li class=md-nav__item> <a href=../06-cluster-upgrade-qa/ class=md-nav__link> <span class=md-ellipsis> 常见问题 </span> </a> </li> <li class=md-nav__item> <a href=../07-app-migrate/ class=md-nav__link> <span class=md-ellipsis> 迁移容器 </span> </a> </li> <li class=md-nav__item> <a href=../08-docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> 【常用组件】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 【常用组件】 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> ArgoCD </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> ArgoCD </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一、安装 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 二、使用 </span> </a> <nav class=md-nav aria-label=二、使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> <span class=md-ellipsis> 2.1 多集群 </span> </a> </li> <li class=md-nav__item> <a href=#22-accounts class=md-nav__link> <span class=md-ellipsis> 2.2 accounts </span> </a> </li> <li class=md-nav__item> <a href=#23 class=md-nav__link> <span class=md-ellipsis> 2.3 存储 </span> </a> </li> <li class=md-nav__item> <a href=#24 class=md-nav__link> <span class=md-ellipsis> 2.4 综合 </span> </a> </li> <li class=md-nav__item> <a href=#25-cluster class=md-nav__link> <span class=md-ellipsis> 2.5 cluster </span> </a> </li> <li class=md-nav__item> <a href=#26-proj class=md-nav__link> <span class=md-ellipsis> 2.6 proj </span> </a> </li> <li class=md-nav__item> <a href=#27-repo class=md-nav__link> <span class=md-ellipsis> 2.7 repo </span> </a> </li> <li class=md-nav__item> <a href=#28-app class=md-nav__link> <span class=md-ellipsis> 2.8 app </span> </a> </li> <li class=md-nav__item> <a href=#29-app-helm-template class=md-nav__link> <span class=md-ellipsis> 2.9 app Helm Template </span> </a> </li> <li class=md-nav__item> <a href=#210-app-helm-dependency class=md-nav__link> <span class=md-ellipsis> 2.10 app Helm Dependency </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#argocd_1 class=md-nav__link> <span class=md-ellipsis> 三、ArgoCD 场景 </span> </a> <nav class=md-nav aria-label="三、ArgoCD 场景"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-calico class=md-nav__link> <span class=md-ellipsis> 3.1 calico </span> </a> </li> <li class=md-nav__item> <a href=#32-metallb class=md-nav__link> <span class=md-ellipsis> 3.2 metallb </span> </a> </li> <li class=md-nav__item> <a href=#33-ingress-nginx class=md-nav__link> <span class=md-ellipsis> 3.3 ingress-nginx </span> </a> </li> <li class=md-nav__item> <a href=#34-dashboard class=md-nav__link> <span class=md-ellipsis> 3.4 dashboard </span> </a> </li> <li class=md-nav__item> <a href=#35-toolkit class=md-nav__link> <span class=md-ellipsis> 3.5 toolkit </span> </a> </li> <li class=md-nav__item> <a href=#36-mysql class=md-nav__link> <span class=md-ellipsis> 3.6 mysql </span> </a> </li> <li class=md-nav__item> <a href=#37-minio class=md-nav__link> <span class=md-ellipsis> 3.7 minio </span> </a> </li> <li class=md-nav__item> <a href=#38-nfs-provider class=md-nav__link> <span class=md-ellipsis> 3.8 nfs-provider </span> </a> </li> <li class=md-nav__item> <a href=#39-cert class=md-nav__link> <span class=md-ellipsis> 3.9 cert </span> </a> <nav class=md-nav aria-label="3.9 cert"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#391-cert-manager class=md-nav__link> <span class=md-ellipsis> 3.9.1 cert-manager </span> </a> </li> <li class=md-nav__item> <a href=#392-imroc class=md-nav__link> <span class=md-ellipsis> 3.9.2 imroc </span> </a> </li> <li class=md-nav__item> <a href=#393-extension class=md-nav__link> <span class=md-ellipsis> 3.9.3 extension </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#310-prometheus class=md-nav__link> <span class=md-ellipsis> 3.10 prometheus </span> </a> <nav class=md-nav aria-label="3.10 prometheus"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3101-prometheus class=md-nav__link> <span class=md-ellipsis> 3.10.1 prometheus </span> </a> </li> <li class=md-nav__item> <a href=#3102-extention class=md-nav__link> <span class=md-ellipsis> 3.10.2 extention </span> </a> </li> <li class=md-nav__item> <a href=#3103-blackbox class=md-nav__link> <span class=md-ellipsis> 3.10.3 blackbox </span> </a> </li> <li class=md-nav__item> <a href=#3104-grafana class=md-nav__link> <span class=md-ellipsis> 3.10.4 grafana </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#311-elastic class=md-nav__link> <span class=md-ellipsis> 3.11 elastic </span> </a> <nav class=md-nav aria-label="3.11 elastic"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3111-elastic class=md-nav__link> <span class=md-ellipsis> 3.11.1 elastic </span> </a> </li> <li class=md-nav__item> <a href=#3112-kibana class=md-nav__link> <span class=md-ellipsis> 3.11.2 kibana </span> </a> </li> <li class=md-nav__item> <a href=#3113-kafka class=md-nav__link> <span class=md-ellipsis> 3.11.3 kafka </span> </a> </li> <li class=md-nav__item> <a href=#3114-logstash class=md-nav__link> <span class=md-ellipsis> 3.11.4 logstash </span> </a> </li> <li class=md-nav__item> <a href=#3115-filebeat class=md-nav__link> <span class=md-ellipsis> 3.11.5 filebeat </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#312-cmdb class=md-nav__link> <span class=md-ellipsis> 3.12 cmdb </span> </a> <nav class=md-nav aria-label="3.12 cmdb"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3121-zookeeper class=md-nav__link> <span class=md-ellipsis> 3.12.1 zookeeper </span> </a> </li> <li class=md-nav__item> <a href=#3132-mongo class=md-nav__link> <span class=md-ellipsis> 3.13.2 mongo </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 四、常见问题 </span> </a> <nav class=md-nav aria-label=四、常见问题> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> <span class=md-ellipsis> 4.1 加入集群认证问题 </span> </a> </li> <li class=md-nav__item> <a href=#42-kubernetes-cluster-argocd class=md-nav__link> <span class=md-ellipsis> 4.2 kubernetes cluster 多套 argocd </span> </a> </li> <li class=md-nav__item> <a href=#43-parameters-valuesyaml class=md-nav__link> <span class=md-ellipsis> 4.3 界面 PARAMETERS 无法识别出 values.yaml </span> </a> </li> <li class=md-nav__item> <a href=#44-configmap class=md-nav__link> <span class=md-ellipsis> 4.4 生成的configmap未跨行 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../05-helm/ class=md-nav__link> <span class=md-ellipsis> Helm </span> </a> </li> <li class=md-nav__item> <a href=../20-prometheus/ class=md-nav__link> <span class=md-ellipsis> Helm + Prometheus </span> </a> </li> <li class=md-nav__item> <a href=../21-mysql/ class=md-nav__link> <span class=md-ellipsis> Helm + MySQL </span> </a> </li> <li class=md-nav__item> <a href=../22-mongo/ class=md-nav__link> <span class=md-ellipsis> Helm + MongoDB </span> </a> </li> <li class=md-nav__item> <a href=../23-grafana/ class=md-nav__link> <span class=md-ellipsis> Helm + Grafana </span> </a> </li> <li class=md-nav__item> <a href=../24-redis/ class=md-nav__link> <span class=md-ellipsis> Helm + Redis </span> </a> </li> <li class=md-nav__item> <a href=../25-elastic/ class=md-nav__link> <span class=md-ellipsis> Helm + Elastic </span> </a> </li> <li class=md-nav__item> <a href=../26-harbor/ class=md-nav__link> <span class=md-ellipsis> Harbor </span> </a> </li> <li class=md-nav__item> <a href=../27-kong/ class=md-nav__link> <span class=md-ellipsis> Kong </span> </a> </li> <li class=md-nav__item> <a href=../28-rabbitmq/ class=md-nav__link> <span class=md-ellipsis> Rabbitmq </span> </a> </li> <li class=md-nav__item> <a href=../42-metallb/ class=md-nav__link> <span class=md-ellipsis> MetalLB </span> </a> </li> <li class=md-nav__item> <a href=../29-dashboard/ class=md-nav__link> <span class=md-ellipsis> Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../29-controller/ class=md-nav__link> <span class=md-ellipsis> Controller </span> </a> </li> <li class=md-nav__item> <a href=../29-rancher/ class=md-nav__link> <span class=md-ellipsis> Rancher </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> 【日常应用】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> 【日常应用】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../30-resource/ class=md-nav__link> <span class=md-ellipsis> 资源集锦 </span> </a> </li> <li class=md-nav__item> <a href=../30-readme/ class=md-nav__link> <span class=md-ellipsis> 应用集锦 </span> </a> </li> <li class=md-nav__item> <a href=../09-account/ class=md-nav__link> <span class=md-ellipsis> 用户体系 </span> </a> </li> <li class=md-nav__item> <a href=../10-access-image/ class=md-nav__link> <span class=md-ellipsis> 加速镜像 </span> </a> </li> <li class=md-nav__item> <a href=../20-promql/ class=md-nav__link> <span class=md-ellipsis> PromQL </span> </a> </li> <li class=md-nav__item> <a href=../20-promql-func/ class=md-nav__link> <span class=md-ellipsis> PromQL 内置函数 </span> </a> </li> <li class=md-nav__item> <a href=../31-kubeconfig/ class=md-nav__link> <span class=md-ellipsis> kubeconfig </span> </a> </li> <li class=md-nav__item> <a href=../32-daemonset/ class=md-nav__link> <span class=md-ellipsis> daemon set </span> </a> </li> <li class=md-nav__item> <a href=../33-statefulset/ class=md-nav__link> <span class=md-ellipsis> statefulset </span> </a> </li> <li class=md-nav__item> <a href=../39-etcd/ class=md-nav__link> <span class=md-ellipsis> etcd </span> </a> </li> <li class=md-nav__item> <a href=../44-jsonpath/ class=md-nav__link> <span class=md-ellipsis> JsonPath </span> </a> </li> <li class=md-nav__item> <a href=../45-taint-and-toleration/ class=md-nav__link> <span class=md-ellipsis> Taints and Tolerations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> 【存储】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> 【存储】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../51-minio/ class=md-nav__link> <span class=md-ellipsis> MinIO </span> </a> </li> <li class=md-nav__item> <a href=../52-nfs-provider/ class=md-nav__link> <span class=md-ellipsis> NFS Provider </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> 【安全】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> 【安全】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../61-audit/ class=md-nav__link> <span class=md-ellipsis> Kubernetes Audit </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 运维进阶 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 运维进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ops/01-devops/ class=md-nav__link> <span class=md-ellipsis> DevOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/02-dataops/ class=md-nav__link> <span class=md-ellipsis> DataOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/03-aiops/ class=md-nav__link> <span class=md-ellipsis> AIOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/04-devsecops/ class=md-nav__link> <span class=md-ellipsis> DevSecOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/05-chatops/ class=md-nav__link> <span class=md-ellipsis> ChatOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/06-finops/ class=md-nav__link> <span class=md-ellipsis> FinOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/07-autoops/ class=md-nav__link> <span class=md-ellipsis> AutoOps </span> </a> </li> <li class=md-nav__item> <a href=../../ops/08-xops/ class=md-nav__link> <span class=md-ellipsis> XOps </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex=0> <span class=md-ellipsis> 【SRE】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> 【SRE】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ops/50-sre-mogu/ class=md-nav__link> <span class=md-ellipsis> SRE实战 </span> </a> </li> <li class=md-nav__item> <a href=../../ops/51-sre-didi/ class=md-nav__link> <span class=md-ellipsis> 稳定性思考 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_10> <label class=md-nav__link for=__nav_4_10 id=__nav_4_10_label tabindex=0> <span class=md-ellipsis> 【监控】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_10_label aria-expanded=false> <label class=md-nav__title for=__nav_4_10> <span class="md-nav__icon md-icon"></span> 【监控】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ops/60-monitor/ class=md-nav__link> <span class=md-ellipsis> 建设监控 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_11> <label class=md-nav__link for=__nav_4_11 id=__nav_4_11_label tabindex=0> <span class=md-ellipsis> 【安全】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_11_label aria-expanded=false> <label class=md-nav__title for=__nav_4_11> <span class="md-nav__icon md-icon"></span> 【安全】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ops/70-pam/ class=md-nav__link> <span class=md-ellipsis> PAM </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> 运维开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 运维开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1 id=__nav_5_1_label tabindex=0> <span class=md-ellipsis> 【Golang】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 【Golang】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/10-golang/ class=md-nav__link> <span class=md-ellipsis> Golang </span> </a> </li> <li class=md-nav__item> <a href=../../dev/11-cleint-go/ class=md-nav__link> <span class=md-ellipsis> client-go </span> </a> </li> <li class=md-nav__item> <a href=../../dev/12-chromedp/ class=md-nav__link> <span class=md-ellipsis> chromedp </span> </a> </li> <li class=md-nav__item> <a href=../../dev/13-smtp/ class=md-nav__link> <span class=md-ellipsis> smtp </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> 【Python】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> 【Python】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/20-python/ class=md-nav__link> <span class=md-ellipsis> python </span> </a> </li> <li class=md-nav__item> <a href=../../dev/21-conda/ class=md-nav__link> <span class=md-ellipsis> conda </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> 【HTML】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> 【HTML】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/70-admin/ class=md-nav__link> <span class=md-ellipsis> admin </span> </a> </li> <li class=md-nav__item> <a href=../../dev/80-html/ class=md-nav__link> <span class=md-ellipsis> html </span> </a> </li> <li class=md-nav__item> <a href=../../dev/81-vue/ class=md-nav__link> <span class=md-ellipsis> vue </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> 【MarkDown】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> 【MarkDown】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/90-gitbook/ class=md-nav__link> <span class=md-ellipsis> gitbook </span> </a> </li> <li class=md-nav__item> <a href=../../dev/91-docsify/ class=md-nav__link> <span class=md-ellipsis> docsify </span> </a> </li> <li class=md-nav__item> <a href=../../dev/92-mkdocs/ class=md-nav__link> <span class=md-ellipsis> mkdocs </span> </a> </li> <li class=md-nav__item> <a href=../../dev/96-macbook/ class=md-nav__link> <span class=md-ellipsis> MacBook </span> </a> </li> <li class=md-nav__item> <a href=../../dev/99-article/ class=md-nav__link> <span class=md-ellipsis> 文章管理 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> 数据处理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 数据处理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/01-mysql/ class=md-nav__link> <span class=md-ellipsis> MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../data/02-neo4j/ class=md-nav__link> <span class=md-ellipsis> Neo4J </span> </a> </li> <li class=md-nav__item> <a href=../../data/03-redis/ class=md-nav__link> <span class=md-ellipsis> Redis </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> 【NLP】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> 【NLP】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/10-chatgpt/ class=md-nav__link> <span class=md-ellipsis> chatgpt </span> </a> </li> <li class=md-nav__item> <a href=../../data/11-huggingface/ class=md-nav__link> <span class=md-ellipsis> huggingface </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> 【LLM】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> 【LLM】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/20-llm/ class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> 生活随记 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 生活随记 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../note/00-class/ class=md-nav__link> <span class=md-ellipsis> 经典语录 </span> </a> </li> <li class=md-nav__item> <a href=../../note/01-effect/ class=md-nav__link> <span class=md-ellipsis> 心理效应 </span> </a> </li> <li class=md-nav__item> <a href=../../note/02-start/ class=md-nav__link> <span class=md-ellipsis> 新年寄语 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> 【私野别墅】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> 【私野别墅】 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4_1> <label class=md-nav__link for=__nav_7_4_1 id=__nav_7_4_1_label tabindex=0> <span class=md-ellipsis> 一层 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4_1> <span class="md-nav__icon md-icon"></span> 一层 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../note/84-villa-00-01/ class=md-nav__link> <span class=md-ellipsis> 别墅【00-01】 </span> </a> </li> <li class=md-nav__item> <a href=../../note/84-villa-00-02/ class=md-nav__link> <span class=md-ellipsis> 别墅【00-02】 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4_2> <label class=md-nav__link for=__nav_7_4_2 id=__nav_7_4_2_label tabindex=0> <span class=md-ellipsis> 二层 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_7_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4_2> <span class="md-nav__icon md-icon"></span> 二层 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../note/84-villa-00-70/ class=md-nav__link> <span class=md-ellipsis> 别墅【00-70】 </span> </a> </li> <li class=md-nav__item> <a href=../../note/84-villa-34-80/ class=md-nav__link> <span class=md-ellipsis> 别墅【34-80】 </span> </a> </li> <li class=md-nav__item> <a href=../../note/84-villa-82-90/ class=md-nav__link> <span class=md-ellipsis> 别墅【82-90】 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_5> <label class=md-nav__link for=__nav_7_5 id=__nav_7_5_label tabindex=0> <span class=md-ellipsis> 【工具集锦】 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_5_label aria-expanded=false> <label class=md-nav__title for=__nav_7_5> <span class="md-nav__icon md-icon"></span> 【工具集锦】 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../note/90-hls-repair/ class=md-nav__link> <span class=md-ellipsis> 海信电视 </span> </a> </li> <li class=md-nav__item> <a href=../../note/91-qywx/ class=md-nav__link> <span class=md-ellipsis> 企业微信 </span> </a> </li> <li class=md-nav__item> <a href=../../note/92-bt/ class=md-nav__link> <span class=md-ellipsis> BT </span> </a> </li> <li class=md-nav__item> <a href=../../note/93-vmware-funsion/ class=md-nav__link> <span class=md-ellipsis> vmware fusion </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> 关于我 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> 关于我 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> <span class=md-ellipsis> 关于我 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 一、安装 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 二、使用 </span> </a> <nav class=md-nav aria-label=二、使用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> <span class=md-ellipsis> 2.1 多集群 </span> </a> </li> <li class=md-nav__item> <a href=#22-accounts class=md-nav__link> <span class=md-ellipsis> 2.2 accounts </span> </a> </li> <li class=md-nav__item> <a href=#23 class=md-nav__link> <span class=md-ellipsis> 2.3 存储 </span> </a> </li> <li class=md-nav__item> <a href=#24 class=md-nav__link> <span class=md-ellipsis> 2.4 综合 </span> </a> </li> <li class=md-nav__item> <a href=#25-cluster class=md-nav__link> <span class=md-ellipsis> 2.5 cluster </span> </a> </li> <li class=md-nav__item> <a href=#26-proj class=md-nav__link> <span class=md-ellipsis> 2.6 proj </span> </a> </li> <li class=md-nav__item> <a href=#27-repo class=md-nav__link> <span class=md-ellipsis> 2.7 repo </span> </a> </li> <li class=md-nav__item> <a href=#28-app class=md-nav__link> <span class=md-ellipsis> 2.8 app </span> </a> </li> <li class=md-nav__item> <a href=#29-app-helm-template class=md-nav__link> <span class=md-ellipsis> 2.9 app Helm Template </span> </a> </li> <li class=md-nav__item> <a href=#210-app-helm-dependency class=md-nav__link> <span class=md-ellipsis> 2.10 app Helm Dependency </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#argocd_1 class=md-nav__link> <span class=md-ellipsis> 三、ArgoCD 场景 </span> </a> <nav class=md-nav aria-label="三、ArgoCD 场景"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-calico class=md-nav__link> <span class=md-ellipsis> 3.1 calico </span> </a> </li> <li class=md-nav__item> <a href=#32-metallb class=md-nav__link> <span class=md-ellipsis> 3.2 metallb </span> </a> </li> <li class=md-nav__item> <a href=#33-ingress-nginx class=md-nav__link> <span class=md-ellipsis> 3.3 ingress-nginx </span> </a> </li> <li class=md-nav__item> <a href=#34-dashboard class=md-nav__link> <span class=md-ellipsis> 3.4 dashboard </span> </a> </li> <li class=md-nav__item> <a href=#35-toolkit class=md-nav__link> <span class=md-ellipsis> 3.5 toolkit </span> </a> </li> <li class=md-nav__item> <a href=#36-mysql class=md-nav__link> <span class=md-ellipsis> 3.6 mysql </span> </a> </li> <li class=md-nav__item> <a href=#37-minio class=md-nav__link> <span class=md-ellipsis> 3.7 minio </span> </a> </li> <li class=md-nav__item> <a href=#38-nfs-provider class=md-nav__link> <span class=md-ellipsis> 3.8 nfs-provider </span> </a> </li> <li class=md-nav__item> <a href=#39-cert class=md-nav__link> <span class=md-ellipsis> 3.9 cert </span> </a> <nav class=md-nav aria-label="3.9 cert"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#391-cert-manager class=md-nav__link> <span class=md-ellipsis> 3.9.1 cert-manager </span> </a> </li> <li class=md-nav__item> <a href=#392-imroc class=md-nav__link> <span class=md-ellipsis> 3.9.2 imroc </span> </a> </li> <li class=md-nav__item> <a href=#393-extension class=md-nav__link> <span class=md-ellipsis> 3.9.3 extension </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#310-prometheus class=md-nav__link> <span class=md-ellipsis> 3.10 prometheus </span> </a> <nav class=md-nav aria-label="3.10 prometheus"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3101-prometheus class=md-nav__link> <span class=md-ellipsis> 3.10.1 prometheus </span> </a> </li> <li class=md-nav__item> <a href=#3102-extention class=md-nav__link> <span class=md-ellipsis> 3.10.2 extention </span> </a> </li> <li class=md-nav__item> <a href=#3103-blackbox class=md-nav__link> <span class=md-ellipsis> 3.10.3 blackbox </span> </a> </li> <li class=md-nav__item> <a href=#3104-grafana class=md-nav__link> <span class=md-ellipsis> 3.10.4 grafana </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#311-elastic class=md-nav__link> <span class=md-ellipsis> 3.11 elastic </span> </a> <nav class=md-nav aria-label="3.11 elastic"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3111-elastic class=md-nav__link> <span class=md-ellipsis> 3.11.1 elastic </span> </a> </li> <li class=md-nav__item> <a href=#3112-kibana class=md-nav__link> <span class=md-ellipsis> 3.11.2 kibana </span> </a> </li> <li class=md-nav__item> <a href=#3113-kafka class=md-nav__link> <span class=md-ellipsis> 3.11.3 kafka </span> </a> </li> <li class=md-nav__item> <a href=#3114-logstash class=md-nav__link> <span class=md-ellipsis> 3.11.4 logstash </span> </a> </li> <li class=md-nav__item> <a href=#3115-filebeat class=md-nav__link> <span class=md-ellipsis> 3.11.5 filebeat </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#312-cmdb class=md-nav__link> <span class=md-ellipsis> 3.12 cmdb </span> </a> <nav class=md-nav aria-label="3.12 cmdb"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#3121-zookeeper class=md-nav__link> <span class=md-ellipsis> 3.12.1 zookeeper </span> </a> </li> <li class=md-nav__item> <a href=#3132-mongo class=md-nav__link> <span class=md-ellipsis> 3.13.2 mongo </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 四、常见问题 </span> </a> <nav class=md-nav aria-label=四、常见问题> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> <span class=md-ellipsis> 4.1 加入集群认证问题 </span> </a> </li> <li class=md-nav__item> <a href=#42-kubernetes-cluster-argocd class=md-nav__link> <span class=md-ellipsis> 4.2 kubernetes cluster 多套 argocd </span> </a> </li> <li class=md-nav__item> <a href=#43-parameters-valuesyaml class=md-nav__link> <span class=md-ellipsis> 4.3 界面 PARAMETERS 无法识别出 values.yaml </span> </a> </li> <li class=md-nav__item> <a href=#44-configmap class=md-nav__link> <span class=md-ellipsis> 4.4 生成的configmap未跨行 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=argocd>ArgoCD<a class=headerlink href=#argocd title="Permanent link">&para;</a></h1> <h2 id=_1>一、安装<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>argoproj<span class=w> </span>https://argoproj.github.io/argo-helm
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>argoproj
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>argo-cd
helm<span class=w> </span>show<span class=w> </span>values<span class=w> </span>argoproj/argo-cd<span class=w> </span>--version<span class=w> </span><span class=m>5</span>.13.8<span class=w> </span>&gt;<span class=w> </span>argocd-configs.yaml-5.13.8-default

<span class=c1># Example</span>
<span class=c1>#   https://books.8ops.top/attachment/argoproj/helm/argocd-configs.yaml-5.13.8</span>
<span class=c1>#   https://books.8ops.top/attachment/argoproj/helm/argocd-configs.yaml-5.4.2</span>
<span class=c1># </span>

helm<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>argo-cd<span class=w> </span>argoproj/argo-cd<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-n<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>argocd-configs.yaml-5.13.8<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--version<span class=w> </span><span class=m>5</span>.13.8

helm<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>uninstall<span class=w> </span>argo-cd

kubectl<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>argocd-initial-admin-secret<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.data.password}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>-D<span class=p>;</span><span class=w> </span><span class=nb>echo</span><span class=w> </span>
</code></pre></div> <h2 id=_2>二、使用<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>可以通过 <code>UI</code> 界面向导操作，也可以通过 <code>argocd</code> 命令操作</p> <div class=highlight><pre><span></span><code>curl<span class=w> </span>-sSL<span class=w> </span>-o<span class=w> </span>~/bin/argocd<span class=w> </span>https://github.com/argoproj/argo-cd/releases/download/v2.5.2/argocd-linux-amd64
chmod<span class=w> </span>+x<span class=w> </span>~/bin/argocd
</code></pre></div> <h3 id=21>2.1 多集群<a class=headerlink href=#21 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># 查看 kubeconfig</span>
kubectl<span class=w> </span>config<span class=w> </span>get-contexts

<span class=c1># 登录 argo-cd</span>
argocd<span class=w> </span>login<span class=w> </span>argo-cd.8ops.top<span class=w> </span>--username<span class=o>=</span>admin<span class=w> </span>--password<span class=o>=</span>xx<span class=w> </span>--grpc-web
argocd<span class=w> </span>context<span class=w> </span>--grpc-web

<span class=c1># 添加 kubernetes cluster</span>
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span>kubeconfig-guest-name<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--kubeconfig<span class=w> </span>~/.kube/config<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--name<span class=w> </span>argocd-cluster-name<span class=w> </span>--grpc-web

<span class=c1># 非安全模式 - token认证</span>
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span>kube-context-name<span class=w> </span>--name<span class=w> </span>argocd-context-name<span class=w> </span>--grpc-web
argocd<span class=w> </span>cluster<span class=w> </span>list<span class=w> </span>--grpc-web
</code></pre></div> <blockquote> <p>argocd添加外部kubernetes cluster步骤</p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1># 第一步，通过ingress-nginx暴露流量</span>
kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>kube-apiserver-ingress.yaml

<span class=c1># 第二步，在kubeconfig添加context</span>

<span class=c1># 第三步，登录argocd</span>
argocd<span class=w> </span>login<span class=w> </span>argocd.8ops.top

<span class=c1># 第四步，添加cluster</span>
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span>kube-context-name<span class=w> </span>--name<span class=w> </span>argocd-context-name<span class=w> </span>--grpc-web
<span class=c1># 添加完成后会在对应的 kubernetes cluster 创建 ServiceAccount/argocd-manager</span>
<span class=c1># kubectl -n kube-system get ServiceAccount/argocd-manager ClusterRole/argocd-manager-role ClusterRoleBinding/argocd-manager-role-binding</span>

<span class=c1># 第五步，查看cluster</span>
argocd<span class=w> </span>cluster<span class=w> </span>list<span class=w> </span>--grpc-web
</code></pre></div> <blockquote> <p>kube-apiserver-ingress.yaml</p> </blockquote> <div class=highlight><pre><span></span><code>apiVersion:<span class=w> </span>networking.k8s.io/v1
kind:<span class=w> </span>Ingress
metadata:
<span class=w>  </span>annotations:
<span class=w>    </span>nginx.ingress.kubernetes.io/backend-protocol:<span class=w> </span>HTTPS
<span class=w>    </span>service.alpha.kubernetes.io/app-protocols:<span class=w> </span><span class=s1>&#39;{&quot;https&quot;:&quot;HTTPS&quot;}&#39;</span>
<span class=w>    </span>nginx.ingress.kubernetes.io/whitelist-source-range:<span class=w> </span><span class=m>10</span>.1.1.0/28
<span class=w>  </span>name:<span class=w> </span>kube-apiserver
<span class=w>  </span>namespace:<span class=w> </span>default
spec:
<span class=w>  </span>ingressClassName:<span class=w> </span>external
<span class=w>  </span>rules:
<span class=w>  </span>-<span class=w> </span>host:<span class=w> </span>kube-apiserver.8ops.top
<span class=w>    </span>http:
<span class=w>      </span>paths:
<span class=w>      </span>-<span class=w> </span>backend:
<span class=w>          </span>service:
<span class=w>            </span>name:<span class=w> </span>kubernetes
<span class=w>            </span>port:
<span class=w>              </span>number:<span class=w> </span><span class=m>443</span>
<span class=w>        </span>path:<span class=w> </span>/
<span class=w>        </span>pathType:<span class=w> </span>Prefix
<span class=w>  </span>tls:
<span class=w>  </span>-<span class=w> </span>hosts:
<span class=w>    </span>-<span class=w> </span>kube-apiserver.8ops.top
<span class=w>    </span>secretName:<span class=w> </span>tls-8ops.top
</code></pre></div> <blockquote> <p>kubeconfig</p> </blockquote> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>clusters</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>cluster</span><span class=p>:</span>
<span class=w>    </span><span class=nt>insecure-skip-tls-verify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://kube-apiserver.8ops.top</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-external-insecure</span>
<span class=nt>contexts</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>context</span><span class=p>:</span>
<span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-external-insecure</span>
<span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-external-user</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-external-insecure</span><span class=w>  </span>
<span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-external-insecure</span><span class=w> </span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Config</span>
<span class=nt>preferences</span><span class=p>:</span>
<span class=w>  </span><span class=nt>colors</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>users</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-external-user</span>
<span class=w>  </span><span class=nt>user</span><span class=p>:</span>
<span class=w>    </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;data&gt;</span><span class=w>  </span>
</code></pre></div> <blockquote> <p>view</p> </blockquote> <div class=highlight><pre><span></span><code>SERVER<span class=w>                          </span>NAME<span class=w>                   </span>VERSION<span class=w> </span>STATUS<span class=w>     </span>MESSAGE<span class=w> </span>PROJECT
https://kube-apiserver.8ops.top<span class=w> </span>kube-external-insecure<span class=w> </span><span class=m>1</span>.23<span class=w>    </span>Successful
https://kubernetes.default.svc<span class=w>  </span><span class=k>in</span>-cluster<span class=w>             </span><span class=m>1</span>.25<span class=w>    </span>Successful
</code></pre></div> <h3 id=22-accounts>2.2 accounts<a class=headerlink href=#22-accounts title="Permanent link">&para;</a></h3> <p>Reference</p> <ul> <li> <p><a href=https://argoproj.github.io/argo-cd/operator-manual/user-management/ >用户管理</a></p> </li> <li> <p><a href=https://argoproj.github.io/argo-cd/operator-manual/rbac/ >RBAC控制</a></p> </li> </ul> <div class=highlight><pre><span></span><code><span class=c1># get account admin&#39;s pass</span>
~<span class=w> </span>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>argocd-initial-admin-secret<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.data.password}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>--decode

<span class=c1># add account jesse</span>
~<span class=w> </span>$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>edit<span class=w> </span>cm<span class=w> </span>argocd-cm
data:
<span class=w>  </span>……
<span class=w>  </span>accounts.jesse:<span class=w> </span>login
<span class=w>  </span>accounts.jesse.enabled:<span class=w> </span><span class=s2>&quot;true&quot;</span>

<span class=c1># setting account jesse&#39;s pass</span>
<span class=c1># --current-password is admin&#39;s pass required</span>
~<span class=w> </span>$<span class=w> </span>argocd<span class=w> </span>account<span class=w> </span>update-password<span class=w>  </span>--account<span class=w> </span>jesse<span class=w> </span>--current-password<span class=w> </span>xxxx<span class=w> </span>--new-password<span class=w> </span>xxxx<span class=w> </span>--grpc-web

kubectl<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>edit<span class=w> </span>cm<span class=w> </span>argocd-rbac-cm
<span class=c1># policy</span>
<span class=c1># p, user, *, *, project/*, allow   ---- p=policy，用户名，资源，动作，项目，allow或deny</span>
<span class=c1># policy.default: role:readonly     ---- 默认策略</span>
<span class=c1>#</span>
<span class=w>  </span>policy.csv:<span class=w> </span><span class=p>|</span>
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>applications,<span class=w> </span>*,<span class=w> </span>*/*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>clusters,<span class=w> </span>*,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>certificates,<span class=w> </span>get,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>repositories,<span class=w> </span>get,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>projects,<span class=w> </span>get,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>accounts,<span class=w> </span>get,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>gpgkeys,<span class=w> </span>get,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>logs,<span class=w> </span>get,<span class=w> </span>*,<span class=w> </span>allow
<span class=w>    </span>p,<span class=w> </span>jesse,<span class=w> </span>exec,<span class=w> </span>create,<span class=w> </span>*/*,<span class=w> </span>allow

argocd<span class=w> </span>login<span class=w> </span>argo-cd.8ops.top<span class=w> </span>--grpc-web
argocd<span class=w> </span>account<span class=w> </span>list<span class=w> </span>--grpc-web


<span class=c1># Can I sync any app?</span>
argocd<span class=w> </span>account<span class=w> </span>can-i<span class=w> </span>sync<span class=w> </span>applications<span class=w> </span><span class=s1>&#39;*&#39;</span>

<span class=c1># Can I update a project?</span>
argocd<span class=w> </span>account<span class=w> </span>can-i<span class=w> </span>update<span class=w> </span>projects<span class=w> </span><span class=s1>&#39;default&#39;</span>

<span class=c1># Can I create a cluster?</span>
argocd<span class=w> </span>account<span class=w> </span>can-i<span class=w> </span>create<span class=w> </span>clusters<span class=w> </span><span class=s1>&#39;*&#39;</span>

Actions:<span class=w> </span><span class=o>[</span>get<span class=w> </span>create<span class=w> </span>update<span class=w> </span>delete<span class=w> </span>sync<span class=w> </span>override<span class=o>]</span>
Resources:<span class=w> </span><span class=o>[</span>clusters<span class=w> </span>projects<span class=w> </span>applications<span class=w> </span>applicationsets<span class=w> </span>repositories<span class=w> </span>certificates<span class=w> </span>logs<span class=w> </span>exec<span class=o>]</span>
</code></pre></div> <h3 id=23>2.3 存储<a class=headerlink href=#23 title="Permanent link">&para;</a></h3> <p>相关元信息存储在 kubernetes cluster's etcd 中</p> <div class=highlight><pre><span></span><code><span class=c1># 1，获取资源类型</span>
$<span class=w> </span>kubectl<span class=w> </span>api-resources<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>argo
applications<span class=w>      </span>app,apps<span class=w>         </span>argoproj.io/v1alpha1<span class=w>  </span><span class=nb>true</span><span class=w>  </span>Application
applicationsets<span class=w>   </span>appset,appsets<span class=w>   </span>argoproj.io/v1alpha1<span class=w>  </span><span class=nb>true</span><span class=w>  </span>ApplicationSet
appprojects<span class=w>       </span>appproj,appprojs<span class=w> </span>argoproj.io/v1alpha1<span class=w>  </span><span class=nb>true</span><span class=w>  </span>AppProject
argocdextensions<span class=w>                   </span>argoproj.io/v1alpha1<span class=w>  </span><span class=nb>true</span><span class=w>  </span>ArgoCDExtension

<span class=c1># 2，获取资源列表</span>
$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>get<span class=w> </span>applications
NAME<span class=w>             </span>SYNC<span class=w> </span>STATUS<span class=w>   </span>HEALTH<span class=w> </span>STATUS
helm-guestbook<span class=w>   </span>Synced<span class=w>        </span>Healthy

<span class=c1># 3，展开详情</span>
$<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>kube-server<span class=w> </span>get<span class=w> </span>applications<span class=w> </span>helm-guestbook<span class=w> </span>-o<span class=w> </span>yaml
apiVersion:<span class=w> </span>argoproj.io/v1alpha1
kind:<span class=w> </span>Application
metadata:
<span class=w>  </span>creationTimestamp:<span class=w> </span><span class=s2>&quot;2022-10-11T05:37:49Z&quot;</span>
<span class=w>  </span>generation:<span class=w> </span><span class=m>19734</span>
<span class=w>  </span>name:<span class=w> </span>helm-guestbook
<span class=w>  </span>namespace:<span class=w> </span>kube-server
<span class=w>  </span>resourceVersion:<span class=w> </span><span class=s2>&quot;18247691&quot;</span>
<span class=w>  </span>uid:<span class=w> </span>c26e8225-c6cc-4338-a494-525f572cae4a
spec:
<span class=w>  </span>destination:
<span class=w>    </span>namespace:<span class=w> </span>kube-app
<span class=w>    </span>server:<span class=w> </span>https://kubernetes.default.svc
<span class=w>  </span>project:<span class=w> </span>argo-example-apps
<span class=w>  </span>source:
<span class=w>    </span>helm:
<span class=w>      </span>parameters:
<span class=w>      </span>-<span class=w> </span>name:<span class=w> </span>replicaCount
<span class=w>        </span>value:<span class=w> </span><span class=s2>&quot;2&quot;</span>
<span class=w>    </span>path:<span class=w> </span>helm-guestbook
<span class=w>    </span>repoURL:<span class=w> </span>https://git.8ops.top/gce/argocd-example-apps.git
<span class=w>    </span>targetRevision:<span class=w> </span>HEAD
……<span class=w>    </span>
</code></pre></div> <h3 id=24>2.4 综合<a class=headerlink href=#24 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>login<span class=w> </span>argo-cd.8ops.top<span class=w> </span>--username<span class=o>=</span>admin<span class=w> </span>--password<span class=o>=</span>xx<span class=w> </span>--grpc-web
argocd<span class=w> </span>account<span class=w> </span>update-password<span class=w> </span>--account<span class=w> </span>jesse<span class=w> </span>--current-password<span class=w> </span>xx<span class=w> </span>--new-password<span class=w> </span>xx<span class=w> </span>--grpc-web

argocd<span class=w> </span>ctx<span class=w> </span>list

argocd<span class=w> </span>cluster<span class=w> </span>list
argocd<span class=w> </span>proj<span class=w>    </span>list
argocd<span class=w> </span>repo<span class=w>    </span>list
argocd<span class=w> </span>app<span class=w>     </span>list

<span class=c1># backup</span>
argocd<span class=w> </span>cluster<span class=w> </span>list<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span>&gt;<span class=w> </span><span class=m>01</span>-argocd-cluster-list.yaml
argocd<span class=w> </span>proj<span class=w>    </span>list<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span>&gt;<span class=w> </span><span class=m>02</span>-argocd-proj-list.yaml
argocd<span class=w> </span>repo<span class=w>    </span>list<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span>&gt;<span class=w> </span><span class=m>03</span>-argocd-repo-list.yaml
argocd<span class=w> </span>app<span class=w>     </span>list<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span>&gt;<span class=w> </span><span class=m>04</span>-argocd-app-list.yaml

kubectl<span class=w> </span>run<span class=w> </span>redis-client<span class=w> </span>--restart<span class=o>=</span><span class=s1>&#39;Never&#39;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--image<span class=w> </span>hub.8ops.top/bitnami/redis:7.0.4<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--command<span class=w> </span>--<span class=w> </span>sleep<span class=w> </span>infinity
</code></pre></div> <h3 id=25-cluster>2.5 cluster<a class=headerlink href=#25-cluster title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>cluster<span class=w> </span>list
argocd<span class=w> </span>cluster<span class=w> </span>rm<span class=w> </span><span class=m>11</span>-dev-ofc

<span class=c1># cluster add</span>
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span><span class=m>11</span>-dev-ofc-insecure<span class=w>  </span>--name<span class=o>=</span><span class=m>11</span>-dev-ofc<span class=w>  </span>--grpc-web
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span><span class=m>12</span>-test-ali-insecure<span class=w> </span>--name<span class=o>=</span><span class=m>12</span>-test-ali<span class=w> </span>--grpc-web
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span><span class=m>13</span>-stage-sh-insecure<span class=w> </span>--name<span class=o>=</span><span class=m>13</span>-stage-sh<span class=w> </span>--grpc-web
argocd<span class=w> </span>cluster<span class=w> </span>add<span class=w> </span><span class=m>14</span>-prod-sh-insecure<span class=w>  </span>--name<span class=o>=</span><span class=m>14</span>-prod-sh<span class=w>  </span>--grpc-web
</code></pre></div> <h3 id=26-proj>2.6 proj<a class=headerlink href=#26-proj title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>proj<span class=w> </span>list
argocd<span class=w> </span>proj<span class=w> </span>delete<span class=w> </span>argo-example-proj
argocd<span class=w> </span>proj<span class=w> </span>create<span class=w> </span>argo-example-proj<span class=w> </span>--description<span class=w> </span><span class=s2>&quot;argo example proj&quot;</span><span class=w> </span>

<span class=c1># argocd proj add-source</span>
argocd<span class=w> </span>proj<span class=w> </span>remove-source<span class=w> </span>argo-example-proj<span class=w>  </span><span class=se>\</span>
<span class=w>    </span>https://git.8ops.top/ops/argocd-example-apps.git
argocd<span class=w> </span>proj<span class=w> </span>add-source<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://git.8ops.top/ops/argocd-example-apps.git

<span class=c1># argocd proj add-destination argo-example-proj in-cluster kube-app --name</span>
argocd<span class=w> </span>proj<span class=w> </span>remove-destination<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>kube-app
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>kube-app<span class=w> </span>
argocd<span class=w> </span>proj<span class=w> </span>get<span class=w> </span>argo-example-proj

<span class=c1># argocd proj allow-cluster-resource</span>
argocd<span class=w> </span>proj<span class=w> </span>allow-cluster-resource<span class=w> </span>argo-example-proj<span class=w> </span><span class=s1>&#39;*&#39;</span><span class=w> </span><span class=s1>&#39;*&#39;</span><span class=w> </span>-l<span class=w> </span>allow

<span class=c1># argocd proj allow-namespace-resource</span>
argocd<span class=w> </span>proj<span class=w> </span>allow-namespace-resource<span class=w> </span>argo-example-proj<span class=w> </span><span class=s1>&#39;*&#39;</span><span class=w> </span><span class=s1>&#39;*&#39;</span><span class=w> </span>-l<span class=w> </span>allow

<span class=c1># ---</span>
argocd<span class=w> </span>proj<span class=w> </span>create<span class=w> </span>control-plane-proj<span class=w> </span>--description<span class=w> </span><span class=s2>&quot;control plane proj&quot;</span><span class=w> </span>
argocd<span class=w> </span>proj<span class=w> </span>add-source<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://git.8ops.top/ops/control-plane-ops.git
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>default<span class=w> </span>
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>kube-server<span class=w> </span>
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>kube-system
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>elastic-system
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>cert-manager
argocd<span class=w> </span>proj<span class=w> </span>get<span class=w> </span>control-plane-proj
</code></pre></div> <h3 id=27-repo>2.7 repo<a class=headerlink href=#27-repo title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>repo<span class=w> </span>list
argocd<span class=w> </span>repo<span class=w> </span>rm<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git
argocd<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--name<span class=w> </span>argo-example-repo<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--username<span class=w> </span>gitlab-read<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--password<span class=w> </span>xx<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--insecure-skip-server-verification
argocd<span class=w> </span>repo<span class=w> </span>get<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git

<span class=c1># ---</span>

argocd<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--name<span class=w> </span>control-plane-repo<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--username<span class=w> </span>gitlab-read<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--password<span class=w> </span>xx<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--insecure-skip-server-verification<span class=w>    </span>
</code></pre></div> <h3 id=28-app>2.8 app<a class=headerlink href=#28-app title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>app<span class=w> </span>list

<span class=c1># Create a directory app</span>
argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>guestbook
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>guestbook<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>guestbook<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span>

<span class=c1># Create a Helm app</span>
argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-guestbook
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-guestbook<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-guestbook<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span>

argocd<span class=w> </span>app<span class=w> </span><span class=nb>set</span><span class=w> </span>helm-guestbook<span class=w> </span>--values<span class=w> </span>values-production.yaml

<span class=c1># Create a Helm app from a Helm repo</span>
argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://charts.bitnami.com/bitnami<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-chart<span class=w> </span>redis<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span><span class=m>17</span>.3.14<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span>global.imageRegistry<span class=o>=</span>hub.8ops.top<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span>image.tag<span class=o>=</span><span class=m>7</span>.0.5<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span><span class=nv>architecture</span><span class=o>=</span>standalone<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span>auth.password<span class=o>=</span>xx<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span>master.persistence.enabled<span class=o>=</span><span class=nb>false</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span>metrics.enabled<span class=o>=</span><span class=nb>true</span><span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-set<span class=w> </span>metrics.image.tag<span class=o>=</span><span class=m>1</span>.37.0<span class=w> </span>

argocd<span class=w> </span>app<span class=w> </span><span class=nb>set</span><span class=w> </span>helm-repo-redis<span class=w> </span>--helm-set<span class=w> </span>master.count<span class=o>=</span><span class=m>1</span>
argocd<span class=w> </span>app<span class=w> </span><span class=nb>set</span><span class=w> </span>helm-repo-redis<span class=w> </span>--helm-set<span class=w> </span>replica.persistence.enabled<span class=o>=</span><span class=nb>false</span>

<span class=c1># # Create a Helm app from a Helm repo</span>
<span class=c1># argocd app delete helm-repo-redis-cluster</span>
<span class=c1># argocd app create helm-repo-redis-cluster \</span>
<span class=c1>#     --repo https://charts.bitnami.com/bitnami \</span>
<span class=c1>#     --helm-chart redis-cluster \</span>
<span class=c1>#     --revision 7.5.0 \</span>
<span class=c1>#     --dest-namespace kube-app \</span>
<span class=c1>#     --dest-server https://kubernetes.default.svc \</span>
<span class=c1>#     --label author=jesse \</span>
<span class=c1>#     --label tier=helm </span>
<span class=c1>#     --values-literal-file cluster-values.yaml</span>
<span class=c1># </span>
<span class=c1># # TODO persistence 未成功移除</span>
<span class=c1># argocd app set helm-repo-redis-cluster --helm-set persistence.enabled=false </span>
<span class=c1># argocd app set helm-repo-redis-cluster --helm-set redis.useAOFPersistence=false </span>
</code></pre></div> <h3 id=29-app-helm-template>2.9 app Helm Template<a class=headerlink href=#29-app-helm-template title="Permanent link">&para;</a></h3> <p>Create a Helm app from a Helm Templates</p> <blockquote> <p>sentinel</p> </blockquote> <div class=highlight><pre><span></span><code>helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>redis

helm<span class=w> </span>pull<span class=w> </span>bitnami/redis<span class=w> </span>--version<span class=w> </span><span class=m>17</span>.3.14<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/redis-17.3.14.tgz<span class=w> </span>-C<span class=w> </span>.
mv<span class=w> </span>redis<span class=w> </span>helm-repo-redis-sentinel-tpl

vim<span class=w> </span>helm-repo-redis-sentinel-tpl/values.yaml

helm<span class=w> </span>install<span class=w> </span>--generate-name<span class=w> </span>--dry-run<span class=w> </span>--debug<span class=w> </span><span class=se>\</span>
<span class=w>  </span>helm-repo-redis-sentinel-tpl<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-f<span class=w> </span>helm-repo-redis-sentinel-tpl/values.yaml

helm<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>uninstall<span class=w> </span>helm-repo-redis-sentinel-tpl-standalone
helm<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>helm-repo-redis-sentinel-tpl-standalone<span class=w> </span><span class=se>\</span>
<span class=w>    </span>helm-repo-redis-sentinel-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>helm-repo-redis-sentinel-tpl/sentinel-standalone-values.yaml

helm<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>uninstall<span class=w> </span>helm-repo-redis-sentinel-tpl-replication
helm<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>helm-repo-redis-sentinel-tpl-replication<span class=w> </span><span class=se>\</span>
<span class=w>    </span>helm-repo-redis-sentinel-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>helm-repo-redis-sentinel-tpl/sentinel-replication-values.yaml

kubectl<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>redis-client<span class=w> </span>bash
redis-cli<span class=w> </span>-h<span class=w> </span>helm-repo-redis-sentinel-tpl-standalone-headless<span class=w> </span>-a<span class=w> </span>jesse
config<span class=w> </span>get<span class=w> </span>maxmemory

redis-cli<span class=w> </span>-h<span class=w> </span>helm-repo-redis-sentinel-tpl-replication-headless<span class=w> </span>-a<span class=w> </span>jesse<span class=w> </span>info<span class=w> </span>replication
redis-cli<span class=w> </span>-h<span class=w> </span>helm-repo-redis-sentinel-tpl-replication<span class=w> </span>-a<span class=w> </span>jesse<span class=w> </span>info<span class=w> </span>replication
redis-cli<span class=w> </span>-h<span class=w> </span>helm-repo-redis-sentinel-tpl-replication-node-0.helm-repo-redis-sentinel-tpl-replication-headless.kube-app.svc.cluster.local<span class=w> </span>-a<span class=w> </span>jesse<span class=w> </span>info<span class=w> </span>replication

argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis-sentinel-tpl-standalone
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis-sentinel-tpl-standalone<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-repo-redis-sentinel-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>standalone-values.yaml

argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis-sentinel-tpl-replication
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis-sentinel-tpl-replication<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-repo-redis-sentinel-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>replication-values.yaml
</code></pre></div> <blockquote> <p>cluster</p> </blockquote> <div class=highlight><pre><span></span><code>helm<span class=w> </span>pull<span class=w> </span>bitnami/redis-cluster<span class=w> </span>--version<span class=w> </span><span class=m>8</span>.3.1<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/redis-cluster-8.3.1.tgz<span class=w> </span>-C<span class=w> </span>.
mv<span class=w> </span>redis-cluster<span class=w> </span>helm-repo-redis-cluster-tpl

vim<span class=w> </span>helm-repo-redis-cluster-tpl/values.yaml

helm<span class=w> </span>install<span class=w> </span>--generate-name<span class=w> </span>--dry-run<span class=w> </span>--debug<span class=w> </span><span class=se>\</span>
<span class=w>  </span>helm-repo-redis-cluster-tpl<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-f<span class=w> </span>helm-repo-redis-cluster-tpl/values.yaml

helm<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>uninstall<span class=w> </span>helm-repo-redis-cluster-tpl
helm<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>helm-repo-redis-cluster-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>helm-repo-redis-cluster-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>helm-repo-redis-cluster-tpl/cluster-values.yaml

kubectl<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span>rollout<span class=w> </span>restart<span class=w> </span>sts<span class=w> </span>helm-repo-redis-cluster-tpl
kubectl<span class=w> </span>-n<span class=w> </span>kube-app<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>redis-client<span class=w> </span>bash
redis-cli<span class=w> </span>-h<span class=w> </span>helm-repo-redis-cluster-tpl-headless<span class=w> </span>-a<span class=w> </span>jesse<span class=w> </span>-c
config<span class=w> </span>get<span class=w> </span>maxmemory

argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis-cluster-tpl
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis-cluster-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-repo-redis-cluster-tpl<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>cluster-values.yaml
</code></pre></div> <h3 id=210-app-helm-dependency>2.10 app Helm Dependency<a class=headerlink href=#210-app-helm-dependency title="Permanent link">&para;</a></h3> <p>Create a Helm app from a Helm Dependency</p> <blockquote> <p>sentinel</p> </blockquote> <div class=highlight><pre><span></span><code>mkdir<span class=w> </span>-p<span class=w> </span>helm-repo-redis-sentinel-dep
<span class=nb>cd</span><span class=w> </span>helm-repo-redis-sentinel-dep

<span class=c1># - name: redis 必须是 bitnami 里面存在的 Charts</span>
cat<span class=w> </span><span class=s>&lt;&lt;EOF | tee Chart.yaml</span>
<span class=s>apiVersion: v2</span>
<span class=s>name: bitnami-redis</span>
<span class=s>version: &quot;17.3.14&quot;</span>
<span class=s>dependencies:</span>
<span class=s>- name: redis</span>
<span class=s>  version: &quot;17.3.14&quot;</span>
<span class=s>  repository: &quot;https://charts.bitnami.com/bitnami&quot;</span>
<span class=s>EOF</span>

vim<span class=w> </span>sentinel-values.yaml

helm<span class=w> </span>dep<span class=w> </span>build<span class=w> </span>--skip-refresh
helm<span class=w> </span>dep<span class=w> </span>list

helm<span class=w> </span>install<span class=w> </span>--generate-name<span class=w> </span>--dry-run<span class=w> </span>--debug<span class=w> </span><span class=se>\</span>
<span class=w>  </span>helm-repo-redis-sentinel-dep<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-f<span class=w> </span>helm-repo-redis-sentinel-dep/standalone-values.yaml

helm<span class=w> </span>install<span class=w> </span>--generate-name<span class=w> </span>--dry-run<span class=w> </span>--debug<span class=w> </span><span class=se>\</span>
<span class=w>  </span>helm-repo-redis-sentinel-dep<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-f<span class=w> </span>helm-repo-redis-sentinel-dep/replication-values.yaml

argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis-sentinel-dep-standalone
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis-sentinel-dep-standalone<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-repo-redis-sentinel-dep<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--release-name<span class=w> </span>helm-repo-redis-sentinel-dep-standalone<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>standalone-values.yaml

argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis-sentinel-dep-replication
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis-sentinel-dep-replication<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-repo-redis-sentinel-dep<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--release-name<span class=w> </span>helm-repo-redis-sentinel-dep-replication<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>replication-values.yaml
</code></pre></div> <blockquote> <p>cluster</p> </blockquote> <div class=highlight><pre><span></span><code>mkdir<span class=w> </span>-p<span class=w> </span>helm-repo-redis-cluster-dep
<span class=nb>cd</span><span class=w> </span>helm-repo-redis-cluster-dep

<span class=c1># - name: redis-cluster 必须是 bitnami 里面存在的 Charts</span>
cat<span class=w> </span><span class=s>&lt;&lt;EOF | tee Chart.yaml</span>
<span class=s>apiVersion: v2</span>
<span class=s>name: bitnami-redis</span>
<span class=s>version: &quot;8.3.1&quot;</span>
<span class=s>dependencies:</span>
<span class=s>- name: redis-cluster</span>
<span class=s>  version: &quot;8.3.1&quot;</span>
<span class=s>  repository: &quot;https://charts.bitnami.com/bitnami&quot;</span>
<span class=s>EOF</span>

vim<span class=w> </span>cluster-values.yaml

helm<span class=w> </span>dep<span class=w> </span>build<span class=w> </span>--skip-refresh
helm<span class=w> </span>dep<span class=w> </span>list

helm<span class=w> </span>install<span class=w> </span>--generate-name<span class=w> </span>--dry-run<span class=w> </span>--debug<span class=w> </span><span class=se>\</span>
<span class=w>  </span>helm-repo-redis-cluster-dep<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-f<span class=w> </span>helm-repo-redis-cluster-dep/cluster-values.yaml

argocd<span class=w> </span>app<span class=w> </span>delete<span class=w> </span>helm-repo-redis-cluster-dep
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>helm-repo-redis-cluster-dep<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/argocd-example-apps.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>helm-repo-redis-cluster-dep<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>argo-example-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-app<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>cluster-values.yaml

<span class=c1># #经验证是非必须的</span>
<span class=c1>#    --release-name helm-repo-redis-cluster-dep \ </span>
<span class=c1># argocd app delete argo-cd --cascade=false</span>
</code></pre></div> <h2 id=argocd_1>三、ArgoCD 场景<a class=headerlink href=#argocd_1 title="Permanent link">&para;</a></h2> <p>尝试自举 argocd </p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>argoproj<span class=w> </span>https://argoproj.github.io/argo-helm
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>argoproj
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>argo-cd
helm<span class=w> </span>pull<span class=w> </span>argoproj/argo-cd<span class=w> </span>--version<span class=w> </span><span class=m>5</span>.13.8<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/argo-cd-5.13.8.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>argo-cd
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>argo-cd<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>devops/argo-cd<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml

<span class=c1># 貌似不允许这样</span>
<span class=c1># argocd app delete argo-cd</span>
</code></pre></div> <h3 id=31-calico>3.1 calico<a class=headerlink href=#31-calico title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>projectcalico<span class=w> </span>https://projectcalico.docs.tigera.io/charts
helm<span class=w> </span>repo<span class=w> </span>update
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>tigera-operator
helm<span class=w> </span>pull<span class=w> </span>projectcalico/tigera-operator<span class=w> </span>--version<span class=w> </span>v3.24.1<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/tigera-operator-v3.24.1.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>tigera-operator
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>proj<span class=w> </span>allow-cluster-resource<span class=w> </span>control-plane-proj<span class=w> </span>*<span class=w> </span>*<span class=w> </span>
argocd<span class=w> </span>proj<span class=w> </span>allow-namespace-resource<span class=w> </span>control-plane-proj<span class=w> </span>*<span class=w> </span>*<span class=w> </span>
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>kube-system
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>kube-server
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>default
argocd<span class=w> </span>proj<span class=w> </span>get<span class=w> </span>control-plane-proj

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>calico<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>tigera-operator<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-skip-crds

<span class=c1># 由于此前使用Helm安装过calico</span>
</code></pre></div> <h3 id=32-metallb>3.2 metallb<a class=headerlink href=#32-metallb title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>metallb<span class=w> </span>https://metallb.github.io/metallb
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>metallb
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>metallb
helm<span class=w> </span>pull<span class=w> </span>metallb/metallb<span class=w> </span>--version<span class=w> </span><span class=m>0</span>.13.7<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/metallb-0.13.7.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>metallb
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>metallb<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>metallb<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--helm-skip-crds

<span class=c1># 【不建议这样】</span>
<span class=c1># argocd app delete metallb</span>
<span class=c1># 其中资源 bgppeers.metallb.io + addresspools.metallb.io 会一直报 OutOfSync</span>

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>metallb-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>metallb/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span>
argocd<span class=w> </span>app<span class=w> </span><span class=nb>set</span><span class=w> </span>metallb-extention<span class=w> </span>--sync-policy<span class=w> </span>automated
</code></pre></div> <h3 id=33-ingress-nginx>3.3 ingress-nginx<a class=headerlink href=#33-ingress-nginx title="Permanent link">&para;</a></h3> <p><a href=../05-helm/#ingress-nginx>Reference</a></p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>ingress-nginx<span class=w> </span>https://kubernetes.github.io/ingress-nginx
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>ingress-nginx
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>ingress-nginx
helm<span class=w> </span>pull<span class=w> </span>ingress-nginx/ingress-nginx<span class=w> </span>--version<span class=w> </span><span class=m>4</span>.4.0<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/ingress-nginx-4.4.0.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>ingress-nginx
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>ingress-nginx<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>ingress-nginx<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h3 id=34-dashboard>3.4 dashboard<a class=headerlink href=#34-dashboard title="Permanent link">&para;</a></h3> <p><a href=../05-helm/#dashboard>Reference</a></p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>kubernetes-dashboard<span class=w> </span>https://kubernetes.github.io/dashboard/
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>kubernetes-dashboard
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>kubernetes-dashboard
helm<span class=w> </span>pull<span class=w> </span>kubernetes-dashboard/kubernetes-dashboard<span class=w> </span>--version<span class=w> </span><span class=m>6</span>.0.0<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/kubernetes-dashboard-6.0.0.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>kubernetes-dashboard
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>kubernetes-dashboard<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>kubernetes-dashboard<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h3 id=35-toolkit>3.5 toolkit<a class=headerlink href=#35-toolkit title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># echoserver</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>toolkit<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>toolkit<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>default<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span>
</code></pre></div> <h3 id=36-mysql>3.6 mysql<a class=headerlink href=#36-mysql title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>bitnami<span class=w> </span>https://charts.bitnami.com/bitnami
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>bitnami
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>mysql
helm<span class=w> </span>pull<span class=w> </span>bitnami/mysql<span class=w> </span>--version<span class=w> </span><span class=m>9</span>.4.5<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/mysql-9.4.5.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>mysql
vim<span class=w> </span>values-standalone.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>mysql-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>mysql/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w>     </span>

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>mysql-standalone<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>mysql<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-standalone.yaml
</code></pre></div> <h3 id=37-minio>3.7 minio<a class=headerlink href=#37-minio title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>minio<span class=w> </span>https://charts.min.io/
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>minio
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>minio
helm<span class=w> </span>pull<span class=w> </span>minio/minio<span class=w> </span>--version<span class=w> </span><span class=m>5</span>.0.4<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/minio-5.0.4.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>minio
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>minio-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>minio/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w>     </span>

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>minio<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>minio<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml

helm<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>minio<span class=w> </span>minio/minio<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-f<span class=w> </span>minio.yaml-5.0.4<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--namespace<span class=o>=</span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--create-namespace<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--version<span class=w> </span><span class=m>5</span>.0.4<span class=w>   </span>
</code></pre></div> <h3 id=38-nfs-provider>3.8 nfs-provider<a class=headerlink href=#38-nfs-provider title="Permanent link">&para;</a></h3> <p><a href=https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner>Reference</a></p> <p><a href=../52-nfs-provider/ >sample</a></p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>nfs-provider<span class=w> </span>https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>nfs-provider
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>nfs
helm<span class=w> </span>pull<span class=w> </span>nfs-provider/nfs-subdir-external-provisioner<span class=w> </span>--version<span class=w> </span><span class=m>4</span>.0.17<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/nfs-subdir-external-provisioner-4.0.17.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>nfs-subdir-external-provisioner
vim<span class=w> </span>values-ops.yaml

<span class=c1># 需要在节点上支持 mount.nfs，否则 Pod 会报错误</span>
<span class=c1># Warning  FailedMount  3m51s (x650 over 21h)  kubelet  MountVolume.SetUp failed for volume &quot;nfs-subdir-external-provisioner-root&quot; : mount failed: exit status 32</span>
apt<span class=w> </span>install<span class=w> </span>nfs-common

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>nfs-subdir-external-provisioner<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>nfs-subdir-external-provisioner<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml

<span class=c1># extention</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>nfs-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>nfs-subdir-external-provisioner/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>default<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span>
</code></pre></div> <h3 id=39-cert>3.9 cert<a class=headerlink href=#39-cert title="Permanent link">&para;</a></h3> <p><a href=../05-helm/#cert-manager>Reference</a></p> <h4 id=391-cert-manager>3.9.1 cert-manager<a class=headerlink href=#391-cert-manager title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>jetstack<span class=w> </span>https://charts.jetstack.io
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>jetstack
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>cert-manager
helm<span class=w> </span>pull<span class=w> </span>jetstack/cert-manager<span class=w> </span>--version<span class=w> </span>v1.11.0<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/cert-manager-v1.11.0.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>cert-manager
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h4 id=392-imroc>3.9.2 imroc<a class=headerlink href=#392-imroc title="Permanent link">&para;</a></h4> <p>webhook-dnspod</p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>imroc<span class=w> </span>https://charts.imroc.cc
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>imroc
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>cert-manager-webhook-dnspod
helm<span class=w> </span>pull<span class=w> </span>imroc/cert-manager-webhook-dnspod<span class=w> </span>--version<span class=w> </span><span class=m>1</span>.2.0<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/cert-manager-webhook-dnspod-1.2.0.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>cert-manager-webhook-dnspod
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>cert-manager-webhook-dnspod<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>cert-manager-webhook-dnspod<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h4 id=393-extension>3.9.3 extension<a class=headerlink href=#393-extension title="Permanent link">&para;</a></h4> <p>cluster-issuer + certificate</p> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>cert-manager-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>cert-manager/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span>
</code></pre></div> <h3 id=310-prometheus>3.10 prometheus<a class=headerlink href=#310-prometheus title="Permanent link">&para;</a></h3> <p><a href=../20-prometheus/#11-prometheus>Reference</a></p> <h4 id=3101-prometheus>3.10.1 prometheus<a class=headerlink href=#3101-prometheus title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>prometheus-community<span class=w> </span>https://prometheus-community.github.io/helm-charts
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>prometheus-community
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>prometheus
helm<span class=w> </span>pull<span class=w> </span>prometheus-community/prometheus<span class=w> </span>--version<span class=w> </span><span class=m>15</span>.8.5<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/prometheus-15.8.5.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>prometheus
vim<span class=w> </span>values-server.yaml
vim<span class=w> </span>values-alertmanager.yaml
vim<span class=w> </span>values-extra.yaml

<span class=w>  </span><span class=c1># strategy:</span>
<span class=w>  </span><span class=c1>#   type: Recreate</span>

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>prometheus<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>prometheus<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-server.yaml<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-alertmanager.yaml<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-extra.yaml
</code></pre></div> <h4 id=3102-extention>3.10.2 extention<a class=headerlink href=#3102-extention title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>prometheus-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>prometheus/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>directory<span class=w> </span>
</code></pre></div> <h4 id=3103-blackbox>3.10.3 blackbox<a class=headerlink href=#3103-blackbox title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>prometheus-blackbox-exporter
helm<span class=w> </span>pull<span class=w> </span>prometheus-community/prometheus-blackbox-exporter<span class=w> </span>--version<span class=w> </span><span class=m>7</span>.0.0<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/prometheus-blackbox-exporter-7.0.0.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>prometheus-blackbox-exporter
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>prometheus-blackbox-exporter<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>prometheus-blackbox-exporter<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h4 id=3104-grafana>3.10.4 grafana<a class=headerlink href=#3104-grafana title="Permanent link">&para;</a></h4> <p><a href=#36-mysql>mysql</a></p> <p><a href=https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-authentication/gitlab/ >auth.gitlab</a></p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>grafana<span class=w> </span>https://grafana.github.io/helm-charts
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>grafana
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>grafana
helm<span class=w> </span>pull<span class=w> </span>grafana/grafana<span class=w> </span>--version<span class=w> </span><span class=m>6</span>.38.1<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/grafana-6.38.1.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>grafana
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>grafana<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>grafana<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>kube-server<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <blockquote> <p>grafana.ini</p> </blockquote> <div class=highlight><pre><span></span><code>grafana.ini:
<span class=w>  </span>paths:
<span class=w>    </span>data:<span class=w> </span>/var/lib/grafana/
<span class=w>    </span>logs:<span class=w> </span>/var/log/grafana
<span class=w>    </span>plugins:<span class=w> </span>/var/lib/grafana/plugins
<span class=w>    </span>provisioning:<span class=w> </span>/etc/grafana/provisioning
<span class=w>  </span>analytics:
<span class=w>    </span>check_for_updates:<span class=w> </span><span class=nb>true</span>
<span class=w>  </span>log:
<span class=w>    </span>mode:<span class=w> </span>console
<span class=w>  </span>server:
<span class=w>    </span>domain:<span class=w> </span><span class=s2>&quot;{{ if (and .Values.ingress.enabled .Values.ingress.hosts) }}{{ .Values.ingress.hosts | first }}{{ end }}&quot;</span>
<span class=w>    </span>root_url:<span class=w> </span><span class=s2>&quot;https://{{ if (and .Values.ingress.enabled .Values.ingress.hosts) }}{{ .Values.ingress.hosts | first }}{{ end }}&quot;</span>
<span class=w>  </span>database:
<span class=w>    </span>type:<span class=w> </span>mysql
<span class=w>    </span>host:<span class=w> </span>mysql-standalone
<span class=w>    </span>name:<span class=w> </span>grafana
<span class=w>    </span>user:<span class=w> </span>grafana
<span class=w>    </span>password:<span class=w> </span>xx
<span class=w>  </span>auth.anonymous:
<span class=w>    </span>enabled:<span class=w> </span><span class=nb>true</span><span class=w> </span><span class=c1># 允许匿名访问</span>
<span class=w>  </span>auth.gitlab:
<span class=w>    </span>enabled:<span class=w> </span><span class=nb>true</span>
<span class=w>    </span>allow_sign_up:<span class=w> </span><span class=nb>true</span>
<span class=w>    </span>auto_login:<span class=w> </span><span class=nb>true</span>
<span class=w>    </span>client_id:<span class=w> </span>a1fd48ae1a25482c9fda1377065f424c5b519e5a91c4e385a5ab97cce65556e7
<span class=w>    </span>client_secret:<span class=w> </span>d06a9893f80001e9c714fb3dc231d41e16a2a2a9b900acaf8340304cfb686871
<span class=w>    </span>scopes:<span class=w> </span>read_api
<span class=w>    </span>auth_url:<span class=w> </span>https://git.8ops.top/oauth/authorize
<span class=w>    </span>token_url:<span class=w> </span>https://git.8ops.top/oauth/token
<span class=w>    </span>api_url:<span class=w> </span>https://git.8ops.top/api/v4
<span class=w>    </span>tls_skip_verify_insecure:<span class=w> </span><span class=nb>true</span><span class=w> </span><span class=c1># 允许私有证书</span>
</code></pre></div> <h3 id=311-elastic>3.11 elastic<a class=headerlink href=#311-elastic title="Permanent link">&para;</a></h3> <p><a href=../05-helm/#elastic>Reference</a></p> <h4 id=3111-elastic>3.11.1 elastic<a class=headerlink href=#3111-elastic title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>elastic<span class=w> </span>https://helm.elastic.co
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>elastic
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>elastic
helm<span class=w> </span>pull<span class=w> </span>elastic/elasticsearch<span class=w> </span>--version<span class=w> </span><span class=m>7</span>.17.3<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/elasticsearch-7.17.3.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>elasticsearch
vim<span class=w> </span>values-master.yaml
vim<span class=w> </span>values-data.yaml
vim<span class=w> </span>values-client.yaml

argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>elastic-system

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>elastic-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>elasticsearch/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w>        </span>

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>elastic-master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>elasticsearch<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-master.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>elastic-data<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>elasticsearch<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-data.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>elastic-client<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>elasticsearch<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-client.yaml
</code></pre></div> <h4 id=3112-kibana>3.11.2 kibana<a class=headerlink href=#3112-kibana title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>kibana
helm<span class=w> </span>pull<span class=w> </span>elastic/kibana<span class=w> </span>--version<span class=w> </span><span class=m>7</span>.17.3<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/kibana-7.17.3.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>kibana
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>kibana<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>kibana<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h4 id=3113-kafka>3.11.3 kafka<a class=headerlink href=#3113-kafka title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>bitnami
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>kafka
helm<span class=w> </span>pull<span class=w> </span>bitnami/kafka<span class=w> </span>--version<span class=w> </span><span class=m>19</span>.0.1<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/kafka-19.0.1.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>kafka
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>kafka<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>kafka<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml

<span class=c1># kafka-ui</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>kafka-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>kafka/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--auto-prune<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>directory<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>owner</span><span class=o>=</span>ops<span class=w> </span>
</code></pre></div> <p><a href=https://books.8ops.top/attachment/kafka/95-kafka-ui.yaml>Reference</a></p> <h4 id=3114-logstash>3.11.4 logstash<a class=headerlink href=#3114-logstash title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>logstash
helm<span class=w> </span>pull<span class=w> </span>elastic/logstash<span class=w> </span>--version<span class=w> </span><span class=m>7</span>.17.3<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/logstash-7.17.3.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=nb>cd</span><span class=w> </span>kibana
vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>logstash<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>logstash<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h4 id=3115-filebeat>3.11.5 filebeat<a class=headerlink href=#3115-filebeat title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=c1># demo</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>logstash-extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>logstash/extention<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>control-plane-proj<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--directory-recurse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w>     </span>

<span class=c1># daemonset</span>
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>filebeat
helm<span class=w> </span>pull<span class=w> </span>elastic/filebeat<span class=w> </span>--version<span class=w> </span><span class=m>7</span>.17.3<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/filebeat-7.17.3.tgz<span class=w> </span>-C<span class=w> </span>.

vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>filebeat<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>filebeat<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>infrastructure<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>elastic-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>owner</span><span class=o>=</span>ops<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h3 id=312-cmdb>3.12 cmdb<a class=headerlink href=#312-cmdb title="Permanent link">&para;</a></h3> <h4 id=3121-zookeeper>3.12.1 zookeeper<a class=headerlink href=#3121-zookeeper title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>proj<span class=w> </span>get<span class=w> </span>infrastructure
argocd<span class=w> </span>proj<span class=w> </span>add-destination<span class=w> </span>infrastructure<span class=w> </span><span class=se>\</span>
<span class=w>    </span>https://kubernetes.default.svc<span class=w> </span>cmdb-system

<span class=w> </span><span class=c1># app version: 3.8.1</span>
helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>zookeeper
helm<span class=w> </span>pull<span class=w> </span>bitnami/zookeeper<span class=w> </span>--version<span class=w> </span><span class=m>11</span>.4.2<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/zookeeper-11.4.2.tgz<span class=w> </span>-C<span class=w> </span>.

vim<span class=w> </span>values-ops.yaml

argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>zookeeper<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>zookeeper<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>infrastructure<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cmdb-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>owner</span><span class=o>=</span>ops<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-ops.yaml
</code></pre></div> <h4 id=3132-mongo>3.13.2 mongo<a class=headerlink href=#3132-mongo title="Permanent link">&para;</a></h4> <p><a href=https://www.runoob.com/mongodb/mongodb-sharding.html>Reference</a></p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>mongodb
helm<span class=w> </span>pull<span class=w> </span>bitnami/mongodb<span class=w> </span>--version<span class=w> </span><span class=m>13</span>.15.1<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/mongodb-13.15.1.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=c1># app version: 6.0.6</span>
vim<span class=w> </span>values-single.yaml
<span class=c1># vim values-replicaset.yaml</span>
<span class=c1># vim values-sharded.yaml</span>

<span class=c1># standalone</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>mongodb<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>mongodb<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>infrastructure<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cmdb-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>owner</span><span class=o>=</span>ops<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-standalone.yaml

<span class=c1># replicaset</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>mongodb<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>mongodb<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>infrastructure<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cmdb-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>owner</span><span class=o>=</span>ops<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-replicaset.yaml

helm<span class=w> </span>search<span class=w> </span>repo<span class=w> </span>mongodb-sharded
helm<span class=w> </span>pull<span class=w> </span>bitnami/mongodb-sharded<span class=w> </span>--version<span class=w> </span><span class=m>6</span>.5.3<span class=w> </span>-d<span class=w> </span>/tmp
tar<span class=w> </span>xf<span class=w> </span>/tmp/mongodb-sharded-6.5.3.tgz<span class=w> </span>-C<span class=w> </span>.

<span class=c1># sharded</span>
argocd<span class=w> </span>app<span class=w> </span>create<span class=w> </span>mongodb-sharded<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--repo<span class=w> </span>https://git.8ops.top/ops/control-plane-ops.git<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--path<span class=w> </span>mongodb-sharded<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--project<span class=w> </span>infrastructure<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-namespace<span class=w> </span>cmdb-system<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--dest-server<span class=w> </span>https://kubernetes.default.svc<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--revision<span class=w> </span>master<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--sync-policy<span class=w> </span>automated<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>author</span><span class=o>=</span>jesse<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>tier</span><span class=o>=</span>helm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--label<span class=w> </span><span class=nv>owner</span><span class=o>=</span>ops<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--values<span class=w> </span>values-sharded.yaml<span class=w>    </span>

mongosh<span class=w> </span>-u<span class=w> </span>root<span class=w> </span>-p<span class=w> </span>jesse
show<span class=w> </span>dbs
show<span class=w> </span>users<span class=p>;</span>
rs.status<span class=o>()</span><span class=p>;</span>
use<span class=w> </span>test<span class=p>;</span>
db.createUser<span class=o>({</span>user:<span class=w> </span><span class=s2>&quot;test&quot;</span>,pwd:<span class=w> </span><span class=s2>&quot;test&quot;</span>,roles:<span class=w> </span><span class=o>[</span><span class=w> </span><span class=o>{</span><span class=w> </span>role:<span class=w> </span><span class=s2>&quot;readWrite&quot;</span>,<span class=w> </span>db:<span class=w> </span><span class=s2>&quot;test&quot;</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>]})</span><span class=p>;</span>
</code></pre></div> <h2 id=_3>四、常见问题<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <h3 id=41>4.1 加入集群认证问题<a class=headerlink href=#41 title="Permanent link">&para;</a></h3> <ol> <li>白名单</li> <li>通过 token 走 insecure</li> <li>通过 kubeconfig 当引用外部 ca 文件时注意引入目录</li> </ol> <h3 id=42-kubernetes-cluster-argocd>4.2 kubernetes cluster 多套 argocd<a class=headerlink href=#42-kubernetes-cluster-argocd title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># helm values</span>
crds:
<span class=w>  </span>install:<span class=w> </span><span class=nb>false</span>
<span class=w>  </span>keep:<span class=w> </span><span class=nb>true</span>
</code></pre></div> <p>当同一命名空间多次部署时，不管是否是同一套 argocd 会自动加载之前的配置信息。</p> <h3 id=43-parameters-valuesyaml>4.3 界面 PARAMETERS 无法识别出 values.yaml<a class=headerlink href=#43-parameters-valuesyaml title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>argocd<span class=w> </span>proj<span class=w> </span>add-source<span class=w> </span>argo-example-proj<span class=w> </span>https://git.8ops.top/gce/argocd-example-apps.git
</code></pre></div> <h3 id=44-configmap>4.4 生成的configmap未跨行<a class=headerlink href=#44-configmap title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># 是由于yaml文件存在行末有空格</span>

<span class=c1># e.g.</span>
a:
<span class=w>  </span>b:
<span class=w>  </span>-<span class=w> </span><span class=m>1</span>
<span class=w>  </span>-<span class=w> </span><span class=m>2</span><span class=w> </span>xxxxx
</code></pre></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../08-docker/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Docker"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> Docker </div> </div> </a> <a href=../05-helm/ class="md-footer__link md-footer__link--next" aria-label="下一页: Helm"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> Helm </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=https://books.8ops.top/ target=_blank>爱运维</a> &nbsp; <a target=_blank href=/sitemap.xml>XML</a><br> <a href=http://beian.miit.gov.cn/ target=_blank>沪ICP备18030892号</a><br> <a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011502401428"><img src=/images/wa.png style=float:left;height:20px;>沪公网安备31011502401428号</a><br> <a target=_blank href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"><img src=/images/upyun.png style=float:left;height:20px;>提供CDN加速/云存储服务</a><br> Copyright &copy; 2017 - 2027 8OPS </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.f1b6f286.min.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>